function a5(n,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const r in i)if(r!=="default"&&!(r in n)){const o=Object.getOwnPropertyDescriptor(i,r);o&&Object.defineProperty(n,r,o.get?o:{enumerable:!0,get:()=>i[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();const MM=!1;var R2=Array.isArray,l5=Array.prototype.indexOf,Uw=Array.from,Ak=Object.defineProperty,wg=Object.getOwnPropertyDescriptor,Pk=Object.getOwnPropertyDescriptors,c5=Object.prototype,u5=Array.prototype,L2=Object.getPrototypeOf,EP=Object.isExtensible;const ts=()=>{};function h5(n){return n()}function CM(n){for(var e=0;e<n.length;e++)n[e]()}function Ik(){var n,e,t=new Promise((i,r)=>{n=i,e=r});return{promise:t,resolve:n,reject:e}}function tl(n,e){if(Array.isArray(n))return n;if(!(Symbol.iterator in n))return Array.from(n);const t=[];for(const i of n)if(t.push(i),t.length===e)break;return t}const _o=2,k2=4,jw=8,d5=1<<24,Rh=16,Lh=32,bp=64,Gw=128,Cc=512,Ro=1024,xa=2048,fu=4096,rl=8192,ph=16384,D2=32768,up=65536,AP=1<<17,F2=1<<18,t_=1<<19,Rk=1<<20,dh=1<<25,hp=32768,EM=1<<21,O2=1<<22,Cd=1<<23,mh=Symbol("$state"),f5=Symbol("legacy props"),p5=Symbol(""),gg=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function z2(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function m5(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function g5(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function _5(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function v5(n){throw new Error("https://svelte.dev/e/effect_orphan")}function y5(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function b5(n){throw new Error("https://svelte.dev/e/props_invalid_value")}function x5(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function w5(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function S5(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function T5(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const M5=1,C5=2,Lk=4,E5=8,A5=16,P5=1,I5=2,R5=4,L5=8,k5=16,D5=1,F5=2,Ao=Symbol(),O5="http://www.w3.org/1999/xhtml";function z5(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function B5(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function kk(n){return n===this.v}function Dk(n,e){return n!=n?e==e:n!==e||n!==null&&typeof n=="object"||typeof n=="function"}function Fk(n){return!Dk(n,this.v)}let i_=!1,N5=!1;function $5(){i_=!0}let Ur=null;function kg(n){Ur=n}function n_(n){return Ok().get(n)}function r_(n,e){return Ok().set(n,e),e}function Qi(n,e=!1,t){Ur={p:Ur,i:!1,c:null,e:null,s:n,x:null,l:i_&&!e?{s:null,u:null,$:[]}:null}}function en(n){var e=Ur,t=e.e;if(t!==null){e.e=null;for(var i of t)Qk(i)}return n!==void 0&&(e.x=n),e.i=!0,Ur=e.p,n??{}}function s_(){return!i_||Ur!==null&&Ur.l===null}function Ok(n){return Ur===null&&z2(),Ur.c??=new Map(V5(Ur)||void 0)}function V5(n){let e=n.p;for(;e!==null;){const t=e.c;if(t!==null)return t;e=e.p}return null}let Xf=[];function zk(){var n=Xf;Xf=[],CM(n)}function Dd(n){if(Xf.length===0&&!ny){var e=Xf;queueMicrotask(()=>{e===Xf&&zk()})}Xf.push(n)}function U5(){for(;Xf.length>0;)zk()}function Bk(n){var e=ir;if(e===null)return Dn.f|=Cd,n;if((e.f&D2)===0){if((e.f&Gw)===0)throw n;e.b.error(n)}else Dg(n,e)}function Dg(n,e){for(;e!==null;){if((e.f&Gw)!==0)try{e.b.error(n);return}catch(t){n=t}e=e.parent}throw n}const wb=new Set;let Bn=null,iy=null,Fl=null,Ll=[],qw=null,AM=!1,ny=!1;class su{committed=!1;current=new Map;previous=new Map;#t=new Set;#e=new Set;#i=0;#n=0;#s=null;#r=new Set;#o=new Set;skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#n>0}process(e){Ll=[],iy=null,this.apply();var t={parent:null,effect:null,effects:[],render_effects:[]};for(const i of e)this.#a(i,t);this.is_fork||this.#u(),this.is_deferred()?(this.#l(t.effects),this.#l(t.render_effects)):(iy=this,Bn=null,PP(t.render_effects),PP(t.effects),iy=null,this.#s?.resolve()),Fl=null}#a(e,t){e.f^=Ro;for(var i=e.first;i!==null;){var r=i.f,o=(r&(Lh|bp))!==0,c=o&&(r&Ro)!==0,s=c||(r&rl)!==0||this.skipped_effects.has(i);if((i.f&Gw)!==0&&i.b?.is_pending()&&(t={parent:t,effect:i,effects:[],render_effects:[]}),!s&&i.fn!==null){o?i.f^=Ro:(r&k2)!==0?t.effects.push(i):r0(i)&&((i.f&Rh)!==0&&this.#r.add(i),Ty(i));var d=i.first;if(d!==null){i=d;continue}}var p=i.parent;for(i=i.next;i===null&&p!==null;)p===t.effect&&(this.#l(t.effects),this.#l(t.render_effects),t=t.parent),i=p.next,p=p.parent}}#l(e){for(const t of e)(t.f&xa)!==0?this.#r.add(t):(t.f&fu)!==0&&this.#o.add(t),this.#c(t.deps),ko(t,Ro)}#c(e){if(e!==null)for(const t of e)(t.f&_o)===0||(t.f&hp)===0||(t.f^=hp,this.#c(t.deps))}capture(e,t){this.previous.has(e)||this.previous.set(e,t),(e.f&Cd)===0&&(this.current.set(e,e.v),Fl?.set(e,e.v))}activate(){Bn=this,this.apply()}deactivate(){Bn===this&&(Bn=null,Fl=null)}flush(){if(this.activate(),Ll.length>0){if(Nk(),Bn!==null&&Bn!==this)return}else this.#i===0&&this.process([]);this.deactivate()}discard(){for(const e of this.#e)e(this);this.#e.clear()}#u(){if(this.#n===0){for(const e of this.#t)e();this.#t.clear()}this.#i===0&&this.#h()}#h(){if(wb.size>1){this.previous.clear();var e=Fl,t=!0,i={parent:null,effect:null,effects:[],render_effects:[]};for(const o of wb){if(o===this){t=!1;continue}const c=[];for(const[d,p]of this.current){if(o.current.has(d))if(t&&p!==o.current.get(d))o.current.set(d,p);else continue;c.push(d)}if(c.length===0)continue;const s=[...o.current.keys()].filter(d=>!this.current.has(d));if(s.length>0){var r=Ll;Ll=[];const d=new Set,p=new Map;for(const g of c)$k(g,s,d,p);if(Ll.length>0){Bn=o,o.apply();for(const g of Ll)o.#a(g,i);o.deactivate()}Ll=r}}Bn=null,Fl=e}this.committed=!0,wb.delete(this)}increment(e){this.#i+=1,e&&(this.#n+=1)}decrement(e){this.#i-=1,e&&(this.#n-=1),this.revive()}revive(){for(const e of this.#r)this.#o.delete(e),ko(e,xa),dp(e);for(const e of this.#o)ko(e,fu),dp(e);this.flush()}oncommit(e){this.#t.add(e)}ondiscard(e){this.#e.add(e)}settled(){return(this.#s??=Ik()).promise}static ensure(){if(Bn===null){const e=Bn=new su;wb.add(Bn),ny||su.enqueue(()=>{Bn===e&&e.flush()})}return Bn}static enqueue(e){Dd(e)}apply(){}}function j5(n){var e=ny;ny=!0;try{for(var t;;){if(U5(),Ll.length===0&&(Bn?.flush(),Ll.length===0))return qw=null,t;Nk()}}finally{ny=e}}function Nk(){var n=tp;AM=!0;var e=null;try{var t=0;for(Qx(!0);Ll.length>0;){var i=su.ensure();if(t++>1e3){var r,o;G5()}i.process(Ll),Ed.clear()}}finally{AM=!1,Qx(n),qw=null}}function G5(){try{y5()}catch(n){Dg(n,qw)}}let ch=null;function PP(n){var e=n.length;if(e!==0){for(var t=0;t<e;){var i=n[t++];if((i.f&(ph|rl))===0&&r0(i)&&(ch=new Set,Ty(i),i.deps===null&&i.first===null&&i.nodes===null&&(i.teardown===null&&i.ac===null?iD(i):i.fn=null),ch?.size>0)){Ed.clear();for(const r of ch){if((r.f&(ph|rl))!==0)continue;const o=[r];let c=r.parent;for(;c!==null;)ch.has(c)&&(ch.delete(c),o.push(c)),c=c.parent;for(let s=o.length-1;s>=0;s--){const d=o[s];(d.f&(ph|rl))===0&&Ty(d)}}ch.clear()}}ch=null}}function $k(n,e,t,i){if(!t.has(n)&&(t.add(n),n.reactions!==null))for(const r of n.reactions){const o=r.f;(o&_o)!==0?$k(r,e,t,i):(o&(O2|Rh))!==0&&(o&xa)===0&&Vk(r,e,i)&&(ko(r,xa),dp(r))}}function Vk(n,e,t){const i=t.get(n);if(i!==void 0)return i;if(n.deps!==null)for(const r of n.deps){if(e.includes(r))return!0;if((r.f&_o)!==0&&Vk(r,e,t))return t.set(r,!0),!0}return t.set(n,!1),!1}function dp(n){for(var e=qw=n;e.parent!==null;){e=e.parent;var t=e.f;if(AM&&e===ir&&(t&Rh)!==0&&(t&F2)===0)return;if((t&(bp|Lh))!==0){if((t&Ro)===0)return;e.f^=Ro}}Ll.push(e)}function q5(n){let e=0,t=wh(0),i;return()=>{wy()&&(te(t),n0(()=>(e===0&&(i=bs(()=>n(()=>Ja(t)))),e+=1,()=>{Dd(()=>{e-=1,e===0&&(i?.(),i=void 0,Ja(t))})})))}}var W5=up|t_|Gw;function H5(n,e,t){new Z5(n,e,t)}class Z5{parent;#t=!1;#e;#i=null;#n;#s;#r;#o=null;#a=null;#l=null;#c=null;#u=null;#h=0;#d=0;#p=!1;#f=null;#y=q5(()=>(this.#f=wh(this.#h),()=>{this.#f=null}));constructor(e,t,i){this.#e=e,this.#n=t,this.#s=i,this.parent=ir.b,this.#t=!!this.#n.pending,this.#r=o_(()=>{ir.b=this;{var r=this.#_();try{this.#o=kl(()=>i(r))}catch(o){this.error(o)}this.#d>0?this.#g():this.#t=!1}return()=>{this.#u?.remove()}},W5)}#b(){try{this.#o=kl(()=>this.#s(this.#e))}catch(e){this.error(e)}this.#t=!1}#x(){const e=this.#n.pending;e&&(this.#a=kl(()=>e(this.#e)),su.enqueue(()=>{var t=this.#_();this.#o=this.#m(()=>(su.ensure(),kl(()=>this.#s(t)))),this.#d>0?this.#g():(ep(this.#a,()=>{this.#a=null}),this.#t=!1)}))}#_(){var e=this.#e;return this.#t&&(this.#u=uu(),this.#e.before(this.#u),e=this.#u),e}is_pending(){return this.#t||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!this.#n.pending}#m(e){var t=ir,i=Dn,r=Ur;pu(this.#r),ya(this.#r),kg(this.#r.ctx);try{return e()}catch(o){return Bk(o),null}finally{pu(t),ya(i),kg(r)}}#g(){const e=this.#n.pending;this.#o!==null&&(this.#c=document.createDocumentFragment(),this.#c.append(this.#u),sD(this.#o,this.#c)),this.#a===null&&(this.#a=kl(()=>e(this.#e)))}#v(e){if(!this.has_pending_snippet()){this.parent&&this.parent.#v(e);return}this.#d+=e,this.#d===0&&(this.#t=!1,this.#a&&ep(this.#a,()=>{this.#a=null}),this.#c&&(this.#e.before(this.#c),this.#c=null))}update_pending_count(e){this.#v(e),this.#h+=e,this.#f&&Fg(this.#f,this.#h)}get_effect_pending(){return this.#y(),te(this.#f)}error(e){var t=this.#n.onerror;let i=this.#n.failed;if(this.#p||!t&&!i)throw e;this.#o&&(ba(this.#o),this.#o=null),this.#a&&(ba(this.#a),this.#a=null),this.#l&&(ba(this.#l),this.#l=null);var r=!1,o=!1;const c=()=>{if(r){B5();return}r=!0,o&&T5(),su.ensure(),this.#h=0,this.#l!==null&&ep(this.#l,()=>{this.#l=null}),this.#t=this.has_pending_snippet(),this.#o=this.#m(()=>(this.#p=!1,kl(()=>this.#s(this.#e)))),this.#d>0?this.#g():this.#t=!1};var s=Dn;try{ya(null),o=!0,t?.(e,c),o=!1}catch(d){Dg(d,this.#r&&this.#r.parent)}finally{ya(s)}i&&Dd(()=>{this.#l=this.#m(()=>{su.ensure(),this.#p=!0;try{return kl(()=>{i(this.#e,()=>e,()=>c)})}catch(d){return Dg(d,this.#r.parent),null}finally{this.#p=!1}})})}}function X5(n,e,t,i){const r=s_()?e0:B2;if(t.length===0&&n.length===0){i(e.map(r));return}var o=Bn,c=ir,s=Y5();function d(){Promise.all(t.map(p=>K5(p))).then(p=>{s();try{i([...e.map(r),...p])}catch(g){(c.f&ph)===0&&Dg(g,c)}o?.deactivate(),Kx()}).catch(p=>{Dg(p,c)})}n.length>0?Promise.all(n).then(()=>{s();try{return d()}finally{o?.deactivate(),Kx()}}):d()}function Y5(){var n=ir,e=Dn,t=Ur,i=Bn;return function(o=!0){pu(n),ya(e),kg(t),o&&i?.activate()}}function Kx(){pu(null),ya(null),kg(null)}function e0(n){var e=_o|xa,t=Dn!==null&&(Dn.f&_o)!==0?Dn:null;return ir!==null&&(ir.f|=t_),{ctx:Ur,deps:null,effects:null,equals:kk,f:e,fn:n,reactions:null,rv:0,v:Ao,wv:0,parent:t??ir,ac:null}}function K5(n,e){let t=ir;t===null&&m5();var i=t.b,r=void 0,o=wh(Ao),c=!Dn,s=new Map;return s6(()=>{var d=Ik();r=d.promise;try{Promise.resolve(n()).then(d.resolve,d.reject).then(()=>{p===Bn&&p.committed&&p.deactivate(),Kx()})}catch(x){d.reject(x),Kx()}var p=Bn;if(c){var g=!i.is_pending();i.update_pending_count(1),p.increment(g),s.get(p)?.reject(gg),s.delete(p),s.set(p,d)}const _=(x,b=void 0)=>{if(p.activate(),b)b!==gg&&(o.f|=Cd,Fg(o,b));else{(o.f&Cd)!==0&&(o.f^=Cd),Fg(o,x);for(const[S,P]of s){if(s.delete(S),S===p)break;P.reject(gg)}}c&&(i.update_pending_count(-1),p.decrement(g))};d.promise.then(_,x=>_(null,x||"unknown"))}),i0(()=>{for(const d of s.values())d.reject(gg)}),new Promise(d=>{function p(g){function _(){g===r?d(o):p(r)}g.then(_,_)}p(r)})}function Kt(n){const e=e0(n);return oD(e),e}function B2(n){const e=e0(n);return e.equals=Fk,e}function Uk(n){var e=n.effects;if(e!==null){n.effects=null;for(var t=0;t<e.length;t+=1)ba(e[t])}}function J5(n){for(var e=n.parent;e!==null;){if((e.f&_o)===0)return(e.f&ph)===0?e:null;e=e.parent}return null}function N2(n){var e,t=ir;pu(J5(n));try{n.f&=~hp,Uk(n),e=uD(n)}finally{pu(t)}return e}function jk(n){var e=N2(n);if(n.equals(e)||(Bn?.is_fork||(n.v=e),n.wv=lD()),!xp)if(Fl!==null)(wy()||Bn?.is_fork)&&Fl.set(n,e);else{var t=(n.f&Cc)===0?fu:Ro;ko(n,t)}}let PM=new Set;const Ed=new Map;let Gk=!1;function wh(n,e){var t={f:0,v:n,reactions:null,equals:kk,rv:0,wv:0};return t}function ii(n,e){const t=wh(n);return oD(t),t}function qk(n,e=!1,t=!0){const i=wh(n);return e||(i.equals=Fk),i_&&t&&Ur!==null&&Ur.l!==null&&(Ur.l.s??=[]).push(i),i}function Ct(n,e,t=!1){Dn!==null&&(!ou||(Dn.f&AP)!==0)&&s_()&&(Dn.f&(_o|Rh|O2|AP))!==0&&!gh?.includes(n)&&S5();let i=t?Ss(e):e;return Fg(n,i)}function Fg(n,e){if(!n.equals(e)){var t=n.v;xp?Ed.set(n,e):Ed.set(n,t),n.v=e;var i=su.ensure();i.capture(n,t),(n.f&_o)!==0&&((n.f&xa)!==0&&N2(n),ko(n,(n.f&Cc)!==0?Ro:fu)),n.wv=lD(),Wk(n,xa),s_()&&ir!==null&&(ir.f&Ro)!==0&&(ir.f&(Lh|bp))===0&&(Rl===null?l6([n]):Rl.push(n)),!i.is_fork&&PM.size>0&&!Gk&&Q5()}return e}function Q5(){Gk=!1;var n=tp;Qx(!0);const e=Array.from(PM);try{for(const t of e)(t.f&Ro)!==0&&ko(t,fu),r0(t)&&Ty(t)}finally{Qx(n)}PM.clear()}function Ja(n){Ct(n,n.v+1)}function Wk(n,e){var t=n.reactions;if(t!==null)for(var i=s_(),r=t.length,o=0;o<r;o++){var c=t[o],s=c.f;if(!(!i&&c===ir)){var d=(s&xa)===0;if(d&&ko(c,e),(s&_o)!==0){var p=c;Fl?.delete(p),(s&hp)===0&&(s&Cc&&(c.f|=hp),Wk(p,fu))}else d&&((s&Rh)!==0&&ch!==null&&ch.add(c),dp(c))}}}function Ss(n){if(typeof n!="object"||n===null||mh in n)return n;const e=L2(n);if(e!==c5&&e!==u5)return n;var t=new Map,i=R2(n),r=ii(0),o=xc,c=s=>{if(xc===o)return s();var d=Dn,p=xc;ya(null),kP(o);var g=s();return ya(d),kP(p),g};return i&&t.set("length",ii(n.length)),new Proxy(n,{defineProperty(s,d,p){(!("value"in p)||p.configurable===!1||p.enumerable===!1||p.writable===!1)&&x5();var g=t.get(d);return g===void 0?g=c(()=>{var _=ii(p.value);return t.set(d,_),_}):Ct(g,p.value,!0),!0},deleteProperty(s,d){var p=t.get(d);if(p===void 0){if(d in s){const g=c(()=>ii(Ao));t.set(d,g),Ja(r)}}else Ct(p,Ao),Ja(r);return!0},get(s,d,p){if(d===mh)return n;var g=t.get(d),_=d in s;if(g===void 0&&(!_||wg(s,d)?.writable)&&(g=c(()=>{var b=Ss(_?s[d]:Ao),S=ii(b);return S}),t.set(d,g)),g!==void 0){var x=te(g);return x===Ao?void 0:x}return Reflect.get(s,d,p)},getOwnPropertyDescriptor(s,d){var p=Reflect.getOwnPropertyDescriptor(s,d);if(p&&"value"in p){var g=t.get(d);g&&(p.value=te(g))}else if(p===void 0){var _=t.get(d),x=_?.v;if(_!==void 0&&x!==Ao)return{enumerable:!0,configurable:!0,value:x,writable:!0}}return p},has(s,d){if(d===mh)return!0;var p=t.get(d),g=p!==void 0&&p.v!==Ao||Reflect.has(s,d);if(p!==void 0||ir!==null&&(!g||wg(s,d)?.writable)){p===void 0&&(p=c(()=>{var x=g?Ss(s[d]):Ao,b=ii(x);return b}),t.set(d,p));var _=te(p);if(_===Ao)return!1}return g},set(s,d,p,g){var _=t.get(d),x=d in s;if(i&&d==="length")for(var b=p;b<_.v;b+=1){var S=t.get(b+"");S!==void 0?Ct(S,Ao):b in s&&(S=c(()=>ii(Ao)),t.set(b+"",S))}if(_===void 0)(!x||wg(s,d)?.writable)&&(_=c(()=>ii(void 0)),Ct(_,Ss(p)),t.set(d,_));else{x=_.v!==Ao;var P=c(()=>Ss(p));Ct(_,P)}var L=Reflect.getOwnPropertyDescriptor(s,d);if(L?.set&&L.set.call(g,p),!x){if(i&&typeof d=="string"){var E=t.get("length"),C=Number(d);Number.isInteger(C)&&C>=E.v&&Ct(E,C+1)}Ja(r)}return!0},ownKeys(s){te(r);var d=Reflect.ownKeys(s).filter(_=>{var x=t.get(_);return x===void 0||x.v!==Ao});for(var[p,g]of t)g.v!==Ao&&!(p in s)&&d.push(p);return d},setPrototypeOf(){w5()}})}function IP(n){try{if(n!==null&&typeof n=="object"&&mh in n)return n[mh]}catch{}return n}function Hk(n,e){return Object.is(IP(n),IP(e))}var xy,Zk,Xk,Yk;function e6(){if(xy===void 0){xy=window,Zk=/Firefox/.test(navigator.userAgent);var n=Element.prototype,e=Node.prototype,t=Text.prototype;Xk=wg(e,"firstChild").get,Yk=wg(e,"nextSibling").get,EP(n)&&(n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__style=void 0,n.__e=void 0),EP(t)&&(t.__t=void 0)}}function uu(n=""){return document.createTextNode(n)}function Jx(n){return Xk.call(n)}function t0(n){return Yk.call(n)}function zt(n,e){return Jx(n)}function ci(n,e=!1){{var t=Jx(n);return t instanceof Comment&&t.data===""?t0(t):t}}function _t(n,e=1,t=!1){let i=n;for(;e--;)i=t0(i);return i}function t6(n){n.textContent=""}function Kk(){return!1}let RP=!1;function i6(){RP||(RP=!0,document.addEventListener("reset",n=>{Promise.resolve().then(()=>{if(!n.defaultPrevented)for(const e of n.target.elements)e.__on_r?.()})},{capture:!0}))}function Ww(n){var e=Dn,t=ir;ya(null),pu(null);try{return n()}finally{ya(e),pu(t)}}function Hw(n,e,t,i=t){n.addEventListener(e,()=>Ww(t));const r=n.__on_r;r?n.__on_r=()=>{r(),i(!0)}:n.__on_r=()=>i(!0),i6()}function Jk(n){ir===null&&(Dn===null&&v5(),_5()),xp&&g5()}function n6(n,e){var t=e.last;t===null?e.last=e.first=n:(t.next=n,n.prev=t,e.last=n)}function yu(n,e,t){var i=ir;i!==null&&(i.f&rl)!==0&&(n|=rl);var r={ctx:Ur,deps:null,nodes:null,f:n|xa|Cc,first:null,fn:e,last:null,next:null,parent:i,b:i&&i.b,prev:null,teardown:null,wv:0,ac:null};if(t)try{Ty(r),r.f|=D2}catch(s){throw ba(r),s}else e!==null&&dp(r);var o=r;if(t&&o.deps===null&&o.teardown===null&&o.nodes===null&&o.first===o.last&&(o.f&t_)===0&&(o=o.first,(n&Rh)!==0&&(n&up)!==0&&o!==null&&(o.f|=up)),o!==null&&(o.parent=i,i!==null&&n6(o,i),Dn!==null&&(Dn.f&_o)!==0&&(n&bp)===0)){var c=Dn;(c.effects??=[]).push(o)}return r}function wy(){return Dn!==null&&!ou}function i0(n){const e=yu(jw,null,!1);return ko(e,Ro),e.teardown=n,e}function cn(n){Jk();var e=ir.f,t=!Dn&&(e&Lh)!==0&&(e&D2)===0;if(t){var i=Ur;(i.e??=[]).push(n)}else return Qk(n)}function Qk(n){return yu(k2|Rk,n,!1)}function $2(n){return Jk(),yu(jw|Rk,n,!0)}function r6(n){su.ensure();const e=yu(bp|t_,n,!0);return(t={})=>new Promise(i=>{t.outro?ep(e,()=>{ba(e),i(void 0)}):(ba(e),i(void 0))})}function V2(n){return yu(k2,n,!1)}function s6(n){return yu(O2|t_,n,!0)}function n0(n,e=0){return yu(jw|e,n,!0)}function Zi(n,e=[],t=[],i=[]){X5(i,e,t,r=>{yu(jw,()=>n(...r.map(te)),!0)})}function o_(n,e=0){var t=yu(Rh|e,n,!0);return t}function kl(n){return yu(Lh|t_,n,!0)}function eD(n){var e=n.teardown;if(e!==null){const t=xp,i=Dn;LP(!0),ya(null);try{e.call(null)}finally{LP(t),ya(i)}}}function tD(n,e=!1){var t=n.first;for(n.first=n.last=null;t!==null;){const r=t.ac;r!==null&&Ww(()=>{r.abort(gg)});var i=t.next;(t.f&bp)!==0?t.parent=null:ba(t,e),t=i}}function o6(n){for(var e=n.first;e!==null;){var t=e.next;(e.f&Lh)===0&&ba(e),e=t}}function ba(n,e=!0){var t=!1;(e||(n.f&F2)!==0)&&n.nodes!==null&&n.nodes.end!==null&&(a6(n.nodes.start,n.nodes.end),t=!0),tD(n,e&&!t),ew(n,0),ko(n,ph);var i=n.nodes&&n.nodes.t;if(i!==null)for(const o of i)o.stop();eD(n);var r=n.parent;r!==null&&r.first!==null&&iD(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes=n.ac=null}function a6(n,e){for(;n!==null;){var t=n===e?null:t0(n);n.remove(),n=t}}function iD(n){var e=n.parent,t=n.prev,i=n.next;t!==null&&(t.next=i),i!==null&&(i.prev=t),e!==null&&(e.first===n&&(e.first=i),e.last===n&&(e.last=t))}function ep(n,e,t=!0){var i=[];nD(n,i,!0);var r=()=>{t&&ba(n),e&&e()},o=i.length;if(o>0){var c=()=>--o||r();for(var s of i)s.out(c)}else r()}function nD(n,e,t){if((n.f&rl)===0){n.f^=rl;var i=n.nodes&&n.nodes.t;if(i!==null)for(const s of i)(s.is_global||t)&&e.push(s);for(var r=n.first;r!==null;){var o=r.next,c=(r.f&up)!==0||(r.f&Lh)!==0&&(n.f&Rh)!==0;nD(r,e,c?t:!1),r=o}}}function U2(n){rD(n,!0)}function rD(n,e){if((n.f&rl)!==0){n.f^=rl,(n.f&Ro)===0&&(ko(n,xa),dp(n));for(var t=n.first;t!==null;){var i=t.next,r=(t.f&up)!==0||(t.f&Lh)!==0;rD(t,r?e:!1),t=i}var o=n.nodes&&n.nodes.t;if(o!==null)for(const c of o)(c.is_global||e)&&c.in()}}function sD(n,e){if(n.nodes)for(var t=n.nodes.start,i=n.nodes.end;t!==null;){var r=t===i?null:t0(t);e.append(t),t=r}}let tp=!1;function Qx(n){tp=n}let xp=!1;function LP(n){xp=n}let Dn=null,ou=!1;function ya(n){Dn=n}let ir=null;function pu(n){ir=n}let gh=null;function oD(n){Dn!==null&&(gh===null?gh=[n]:gh.push(n))}let Yo=null,Za=0,Rl=null;function l6(n){Rl=n}let aD=1,Sy=0,xc=Sy;function kP(n){xc=n}function lD(){return++aD}function r0(n){var e=n.f;if((e&xa)!==0)return!0;if(e&_o&&(n.f&=~hp),(e&fu)!==0){var t=n.deps;if(t!==null)for(var i=t.length,r=0;r<i;r++){var o=t[r];if(r0(o)&&jk(o),o.wv>n.wv)return!0}(e&Cc)!==0&&Fl===null&&ko(n,Ro)}return!1}function cD(n,e,t=!0){var i=n.reactions;if(i!==null&&!gh?.includes(n))for(var r=0;r<i.length;r++){var o=i[r];(o.f&_o)!==0?cD(o,e,!1):e===o&&(t?ko(o,xa):(o.f&Ro)!==0&&ko(o,fu),dp(o))}}function uD(n){var e=Yo,t=Za,i=Rl,r=Dn,o=gh,c=Ur,s=ou,d=xc,p=n.f;Yo=null,Za=0,Rl=null,Dn=(p&(Lh|bp))===0?n:null,gh=null,kg(n.ctx),ou=!1,xc=++Sy,n.ac!==null&&(Ww(()=>{n.ac.abort(gg)}),n.ac=null);try{n.f|=EM;var g=n.fn,_=g(),x=n.deps;if(Yo!==null){var b;if(ew(n,Za),x!==null&&Za>0)for(x.length=Za+Yo.length,b=0;b<Yo.length;b++)x[Za+b]=Yo[b];else n.deps=x=Yo;if(wy()&&(n.f&Cc)!==0)for(b=Za;b<x.length;b++)(x[b].reactions??=[]).push(n)}else x!==null&&Za<x.length&&(ew(n,Za),x.length=Za);if(s_()&&Rl!==null&&!ou&&x!==null&&(n.f&(_o|fu|xa))===0)for(b=0;b<Rl.length;b++)cD(Rl[b],n);return r!==null&&r!==n&&(Sy++,Rl!==null&&(i===null?i=Rl:i.push(...Rl))),(n.f&Cd)!==0&&(n.f^=Cd),_}catch(S){return Bk(S)}finally{n.f^=EM,Yo=e,Za=t,Rl=i,Dn=r,gh=o,kg(c),ou=s,xc=d}}function c6(n,e){let t=e.reactions;if(t!==null){var i=l5.call(t,n);if(i!==-1){var r=t.length-1;r===0?t=e.reactions=null:(t[i]=t[r],t.pop())}}t===null&&(e.f&_o)!==0&&(Yo===null||!Yo.includes(e))&&(ko(e,fu),(e.f&Cc)!==0&&(e.f^=Cc,e.f&=~hp),Uk(e),ew(e,0))}function ew(n,e){var t=n.deps;if(t!==null)for(var i=e;i<t.length;i++)c6(n,t[i])}function Ty(n){var e=n.f;if((e&ph)===0){ko(n,Ro);var t=ir,i=tp;ir=n,tp=!0;try{(e&(Rh|d5))!==0?o6(n):tD(n),eD(n);var r=uD(n);n.teardown=typeof r=="function"?r:null,n.wv=aD;var o;MM&&N5&&(n.f&xa)!==0&&n.deps}finally{tp=i,ir=t}}}async function hD(){await Promise.resolve(),j5()}function te(n){var e=n.f,t=(e&_o)!==0;if(Dn!==null&&!ou){var i=ir!==null&&(ir.f&ph)!==0;if(!i&&!gh?.includes(n)){var r=Dn.deps;if((Dn.f&EM)!==0)n.rv<Sy&&(n.rv=Sy,Yo===null&&r!==null&&r[Za]===n?Za++:Yo===null?Yo=[n]:Yo.includes(n)||Yo.push(n));else{(Dn.deps??=[]).push(n);var o=n.reactions;o===null?n.reactions=[Dn]:o.includes(Dn)||o.push(Dn)}}}if(xp){if(Ed.has(n))return Ed.get(n);if(t){var c=n,s=c.v;return((c.f&Ro)===0&&c.reactions!==null||fD(c))&&(s=N2(c)),Ed.set(c,s),s}}else t&&(!Fl?.has(n)||Bn?.is_fork&&!wy())&&(c=n,r0(c)&&jk(c),tp&&wy()&&(c.f&Cc)===0&&dD(c));if(Fl?.has(n))return Fl.get(n);if((n.f&Cd)!==0)throw n.v;return n.v}function dD(n){if(n.deps!==null){n.f^=Cc;for(const e of n.deps)(e.reactions??=[]).push(n),(e.f&_o)!==0&&(e.f&Cc)===0&&dD(e)}}function fD(n){if(n.v===Ao)return!0;if(n.deps===null)return!1;for(const e of n.deps)if(Ed.has(e)||(e.f&_o)!==0&&fD(e))return!0;return!1}function bs(n){var e=ou;try{return ou=!0,n()}finally{ou=e}}const u6=-7169;function ko(n,e){n.f=n.f&u6|e}function h6(n){if(!(typeof n!="object"||!n||n instanceof EventTarget)){if(mh in n)IM(n);else if(!Array.isArray(n))for(let e in n){const t=n[e];typeof t=="object"&&t&&mh in t&&IM(t)}}}function IM(n,e=new Set){if(typeof n=="object"&&n!==null&&!(n instanceof EventTarget)&&!e.has(n)){e.add(n),n instanceof Date&&n.getTime();for(let i in n)try{IM(n[i],e)}catch{}const t=L2(n);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const i=Pk(t);for(let r in i){const o=i[r].get;if(o)try{o.call(n)}catch{}}}}}const d6=["touchstart","touchmove"];function f6(n){return d6.includes(n)}const pD=new Set,RM=new Set;function p6(n,e,t,i={}){function r(o){if(i.capture||Bv.call(e,o),!o.cancelBubble)return Ww(()=>t?.call(this,o))}return n.startsWith("pointer")||n.startsWith("touch")||n==="wheel"?Dd(()=>{e.addEventListener(n,r,i)}):e.addEventListener(n,r,i),r}function Zw(n,e,t,i,r){var o={capture:i,passive:r},c=p6(n,e,t,o);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&i0(()=>{e.removeEventListener(n,c,o)})}function ds(n){for(var e=0;e<n.length;e++)pD.add(n[e]);for(var t of RM)t(n)}let DP=null;function Bv(n){var e=this,t=e.ownerDocument,i=n.type,r=n.composedPath?.()||[],o=r[0]||n.target;DP=n;var c=0,s=DP===n&&n.__root;if(s){var d=r.indexOf(s);if(d!==-1&&(e===document||e===window)){n.__root=e;return}var p=r.indexOf(e);if(p===-1)return;d<=p&&(c=d)}if(o=r[c]||n.target,o!==e){Ak(n,"currentTarget",{configurable:!0,get(){return o||t}});var g=Dn,_=ir;ya(null),pu(null);try{for(var x,b=[];o!==null;){var S=o.assignedSlot||o.parentNode||o.host||null;try{var P=o["__"+i];P!=null&&(!o.disabled||n.target===o)&&P.call(o,n)}catch(L){x?b.push(L):x=L}if(n.cancelBubble||S===e||S===null)break;o=S}if(x){for(let L of b)queueMicrotask(()=>{throw L});throw x}}finally{n.__root=e,delete n.currentTarget,ya(g),pu(_)}}}function m6(n){var e=document.createElement("template");return e.innerHTML=n.replaceAll("<!>","<!---->"),e.content}function tw(n,e){var t=ir;t.nodes===null&&(t.nodes={start:n,end:e,a:null,t:null})}function qt(n,e){var t=(e&D5)!==0,i=(e&F5)!==0,r,o=!n.startsWith("<!>");return()=>{r===void 0&&(r=m6(o?n:"<!>"+n),t||(r=Jx(r)));var c=i||Zk?document.importNode(r,!0):r.cloneNode(!0);if(t){var s=Jx(c),d=c.lastChild;tw(s,d)}else tw(c,c);return c}}function Nn(n=""){{var e=uu(n+"");return tw(e,e),e}}function tr(){var n=document.createDocumentFragment(),e=document.createComment(""),t=uu();return n.append(e,t),tw(e,t),n}function bt(n,e){n!==null&&n.before(e)}function sn(n,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(n.__t??=n.nodeValue)&&(n.__t=t,n.nodeValue=t+"")}function g6(n,e){return _6(n,e)}const Om=new Map;function _6(n,{target:e,anchor:t,props:i={},events:r,context:o,intro:c=!0}){e6();var s=new Set,d=_=>{for(var x=0;x<_.length;x++){var b=_[x];if(!s.has(b)){s.add(b);var S=f6(b);e.addEventListener(b,Bv,{passive:S});var P=Om.get(b);P===void 0?(document.addEventListener(b,Bv,{passive:S}),Om.set(b,1)):Om.set(b,P+1)}}};d(Uw(pD)),RM.add(d);var p=void 0,g=r6(()=>{var _=t??e.appendChild(uu());return H5(_,{pending:()=>{}},x=>{if(o){Qi({});var b=Ur;b.c=o}r&&(i.$$events=r),p=n(x,i)||{},o&&en()}),()=>{for(var x of s){e.removeEventListener(x,Bv);var b=Om.get(x);--b===0?(document.removeEventListener(x,Bv),Om.delete(x)):Om.set(x,b)}RM.delete(d),_!==t&&_.parentNode?.removeChild(_)}});return v6.set(p,g),p}let v6=new WeakMap;class j2{anchor;#t=new Map;#e=new Map;#i=new Map;#n=new Set;#s=!0;constructor(e,t=!0){this.anchor=e,this.#s=t}#r=()=>{var e=Bn;if(this.#t.has(e)){var t=this.#t.get(e),i=this.#e.get(t);if(i)U2(i),this.#n.delete(t);else{var r=this.#i.get(t);r&&(this.#e.set(t,r.effect),this.#i.delete(t),r.fragment.lastChild.remove(),this.anchor.before(r.fragment),i=r.effect)}for(const[o,c]of this.#t){if(this.#t.delete(o),o===e)break;const s=this.#i.get(c);s&&(ba(s.effect),this.#i.delete(c))}for(const[o,c]of this.#e){if(o===t||this.#n.has(o))continue;const s=()=>{if(Array.from(this.#t.values()).includes(o)){var p=document.createDocumentFragment();sD(c,p),p.append(uu()),this.#i.set(o,{effect:c,fragment:p})}else ba(c);this.#n.delete(o),this.#e.delete(o)};this.#s||!i?(this.#n.add(o),ep(c,s,!1)):s()}}};#o=e=>{this.#t.delete(e);const t=Array.from(this.#t.values());for(const[i,r]of this.#i)t.includes(i)||(ba(r.effect),this.#i.delete(i))};ensure(e,t){var i=Bn,r=Kk();if(t&&!this.#e.has(e)&&!this.#i.has(e))if(r){var o=document.createDocumentFragment(),c=uu();o.append(c),this.#i.set(e,{effect:kl(()=>t(c)),fragment:o})}else this.#e.set(e,kl(()=>t(this.anchor)));if(this.#t.set(i,e),r){for(const[s,d]of this.#e)s===e?i.skipped_effects.delete(d):i.skipped_effects.add(d);for(const[s,d]of this.#i)s===e?i.skipped_effects.delete(d.effect):i.skipped_effects.add(d.effect);i.oncommit(this.#r),i.ondiscard(this.#o)}else this.#r()}}function Ji(n,e,t=!1){var i=new j2(n),r=t?up:0;function o(c,s){i.ensure(c,s)}o_(()=>{var c=!1;e((s,d=!0)=>{c=!0,o(d,s)}),c||o(!1,null)},r)}function s0(n,e,t){var i=new j2(n),r=!s_();o_(()=>{var o=e();r&&o!==null&&typeof o=="object"&&(o={}),i.ensure(o,t)})}function xs(n,e){return e}function y6(n,e,t){for(var i=[],r=e.length,o,c=e.length,s=0;s<r;s++){let _=e[s];ep(_,()=>{if(o){if(o.pending.delete(_),o.done.add(_),o.pending.size===0){var x=n.outrogroups;LM(Uw(o.done)),x.delete(o),x.size===0&&(n.outrogroups=null)}}else c-=1},!1)}if(c===0){var d=i.length===0&&t!==null;if(d){var p=t,g=p.parentNode;t6(g),g.append(p),n.items.clear()}LM(e,!d)}else o={pending:new Set(e),done:new Set},(n.outrogroups??=new Set).add(o)}function LM(n,e=!0){for(var t=0;t<n.length;t++)ba(n[t],e)}var FP;function ws(n,e,t,i,r,o=null){var c=n,s=new Map,d=(e&Lk)!==0;if(d){var p=n;c=p.appendChild(uu())}var g=null,_=B2(()=>{var E=t();return R2(E)?E:E==null?[]:Uw(E)}),x,b=!0;function S(){L.fallback=g,b6(L,x,c,e,i),g!==null&&(x.length===0?(g.f&dh)===0?U2(g):(g.f^=dh,Nv(g,null,c)):ep(g,()=>{g=null}))}var P=o_(()=>{x=te(_);for(var E=x.length,C=new Set,D=Bn,O=Kk(),U=0;U<E;U+=1){var q=x[U],G=i(q,U),N=b?null:s.get(G);N?(N.v&&Fg(N.v,q),N.i&&Fg(N.i,U),O&&D.skipped_effects.delete(N.e)):(N=x6(s,b?c:FP??=uu(),q,G,U,r,e,t),b||(N.e.f|=dh),s.set(G,N)),C.add(G)}if(E===0&&o&&!g&&(b?g=kl(()=>o(c)):(g=kl(()=>o(FP??=uu())),g.f|=dh)),!b)if(O){for(const[V,j]of s)C.has(V)||D.skipped_effects.add(j.e);D.oncommit(S),D.ondiscard(()=>{})}else S();te(_)}),L={effect:P,items:s,outrogroups:null,fallback:g};b=!1}function b6(n,e,t,i,r){var o=(i&E5)!==0,c=e.length,s=n.items,d=n.effect.first,p,g=null,_,x=[],b=[],S,P,L,E;if(o)for(E=0;E<c;E+=1)S=e[E],P=r(S,E),L=s.get(P).e,(L.f&dh)===0&&(L.nodes?.a?.measure(),(_??=new Set).add(L));for(E=0;E<c;E+=1){if(S=e[E],P=r(S,E),L=s.get(P).e,n.outrogroups!==null)for(const j of n.outrogroups)j.pending.delete(L),j.done.delete(L);if((L.f&dh)!==0)if(L.f^=dh,L===d)Nv(L,null,t);else{var C=g?g.next:d;L===n.effect.last&&(n.effect.last=L.prev),L.prev&&(L.prev.next=L.next),L.next&&(L.next.prev=L.prev),ld(n,g,L),ld(n,L,C),Nv(L,C,t),g=L,x=[],b=[],d=g.next;continue}if((L.f&rl)!==0&&(U2(L),o&&(L.nodes?.a?.unfix(),(_??=new Set).delete(L))),L!==d){if(p!==void 0&&p.has(L)){if(x.length<b.length){var D=b[0],O;g=D.prev;var U=x[0],q=x[x.length-1];for(O=0;O<x.length;O+=1)Nv(x[O],D,t);for(O=0;O<b.length;O+=1)p.delete(b[O]);ld(n,U.prev,q.next),ld(n,g,U),ld(n,q,D),d=D,g=q,E-=1,x=[],b=[]}else p.delete(L),Nv(L,d,t),ld(n,L.prev,L.next),ld(n,L,g===null?n.effect.first:g.next),ld(n,g,L),g=L;continue}for(x=[],b=[];d!==null&&d!==L;)(p??=new Set).add(d),b.push(d),d=d.next;if(d===null)continue}(L.f&dh)===0&&x.push(L),g=L,d=L.next}if(n.outrogroups!==null){for(const j of n.outrogroups)j.pending.size===0&&(LM(Uw(j.done)),n.outrogroups?.delete(j));n.outrogroups.size===0&&(n.outrogroups=null)}if(d!==null||p!==void 0){var G=[];if(p!==void 0)for(L of p)(L.f&rl)===0&&G.push(L);for(;d!==null;)(d.f&rl)===0&&d!==n.fallback&&G.push(d),d=d.next;var N=G.length;if(N>0){var V=(i&Lk)!==0&&c===0?t:null;if(o){for(E=0;E<N;E+=1)G[E].nodes?.a?.measure();for(E=0;E<N;E+=1)G[E].nodes?.a?.fix()}y6(n,G,V)}}o&&Dd(()=>{if(_!==void 0)for(L of _)L.nodes?.a?.apply()})}function x6(n,e,t,i,r,o,c,s){var d=(c&M5)!==0?(c&A5)===0?qk(t,!1,!1):wh(t):null,p=(c&C5)!==0?wh(r):null;return{v:d,i:p,e:kl(()=>(o(e,d??t,p??r,s),()=>{n.delete(i)}))}}function Nv(n,e,t){if(n.nodes)for(var i=n.nodes.start,r=n.nodes.end,o=e&&(e.f&dh)===0?e.nodes.start:t;i!==null;){var c=t0(i);if(o.before(i),i===r)return;i=c}}function ld(n,e,t){e===null?n.effect.first=t:e.next=t,t===null?n.effect.last=e:t.prev=e}function hs(n,e,...t){var i=new j2(n);o_(()=>{const r=e()??null;i.ensure(r,r&&(o=>r(o,...t)))},up)}function w6(n,e){var t;t=document.head.appendChild(uu()),o_(()=>e(t),F2)}function S6(n,e,t){V2(()=>{var i=bs(()=>e(n,t?.())||{});if(i?.destroy)return()=>i.destroy()})}function mD(n){var e,t,i="";if(typeof n=="string"||typeof n=="number")i+=n;else if(typeof n=="object")if(Array.isArray(n)){var r=n.length;for(e=0;e<r;e++)n[e]&&(t=mD(n[e]))&&(i&&(i+=" "),i+=t)}else for(t in n)n[t]&&(i&&(i+=" "),i+=t);return i}function T6(){for(var n,e,t=0,i="",r=arguments.length;t<r;t++)(n=arguments[t])&&(e=mD(n))&&(i&&(i+=" "),i+=e);return i}function gD(n){return typeof n=="object"?T6(n):n??""}const OP=[...` 	
\r\fÂ \v\uFEFF`];function M6(n,e,t){var i=n==null?"":""+n;if(e&&(i=i?i+" "+e:e),t){for(var r in t)if(t[r])i=i?i+" "+r:r;else if(i.length)for(var o=r.length,c=0;(c=i.indexOf(r,c))>=0;){var s=c+o;(c===0||OP.includes(i[c-1]))&&(s===i.length||OP.includes(i[s]))?i=(c===0?"":i.substring(0,c))+i.substring(s+1):c=s}}return i===""?null:i}function zP(n,e=!1){var t=e?" !important;":";",i="";for(var r in n){var o=n[r];o!=null&&o!==""&&(i+=" "+r+": "+o+t)}return i}function OS(n){return n[0]!=="-"||n[1]!=="-"?n.toLowerCase():n}function C6(n,e){if(e){var t="",i,r;if(Array.isArray(e)?(i=e[0],r=e[1]):i=e,n){n=String(n).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var o=!1,c=0,s=!1,d=[];i&&d.push(...Object.keys(i).map(OS)),r&&d.push(...Object.keys(r).map(OS));var p=0,g=-1;const P=n.length;for(var _=0;_<P;_++){var x=n[_];if(s?x==="/"&&n[_-1]==="*"&&(s=!1):o?o===x&&(o=!1):x==="/"&&n[_+1]==="*"?s=!0:x==='"'||x==="'"?o=x:x==="("?c++:x===")"&&c--,!s&&o===!1&&c===0){if(x===":"&&g===-1)g=_;else if(x===";"||_===P-1){if(g!==-1){var b=OS(n.substring(p,g).trim());if(!d.includes(b)){x!==";"&&_++;var S=n.substring(p,_).trim();t+=" "+S+";"}}p=_+1,g=-1}}}}return i&&(t+=zP(i)),r&&(t+=zP(r,!0)),t=t.trim(),t===""?null:t}return n==null?null:String(n)}function fp(n,e,t,i,r,o){var c=n.__className;if(c!==t||c===void 0){var s=M6(t,i,o);s==null?n.removeAttribute("class"):n.className=s,n.__className=t}else if(o&&r!==o)for(var d in o){var p=!!o[d];(r==null||p!==!!r[d])&&n.classList.toggle(d,p)}return o}function zS(n,e={},t,i){for(var r in t){var o=t[r];e[r]!==o&&(t[r]==null?n.style.removeProperty(r):n.style.setProperty(r,o,i))}}function _h(n,e,t,i){var r=n.__style;if(r!==e){var o=C6(e,i);o==null?n.removeAttribute("style"):n.style.cssText=o,n.__style=e}else i&&(Array.isArray(i)?(zS(n,t?.[0],i[0]),zS(n,t?.[1],i[1],"important")):zS(n,t,i));return i}function _D(n,e,t=!1){if(n.multiple){if(e==null)return;if(!R2(e))return z5();for(var i of n.options)i.selected=e.includes(ry(i));return}for(i of n.options){var r=ry(i);if(Hk(r,e)){i.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function E6(n){var e=new MutationObserver(()=>{_D(n,n.__value)});e.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),i0(()=>{e.disconnect()})}function A6(n,e,t=e){var i=new WeakSet,r=!0;Hw(n,"change",o=>{var c=o?"[selected]":":checked",s;if(n.multiple)s=[].map.call(n.querySelectorAll(c),ry);else{var d=n.querySelector(c)??n.querySelector("option:not([disabled])");s=d&&ry(d)}t(s),Bn!==null&&i.add(Bn)}),V2(()=>{var o=e();if(n===document.activeElement){var c=iy??Bn;if(i.has(c))return}if(_D(n,o,r),r&&o===void 0){var s=n.querySelector(":checked");s!==null&&(o=ry(s),t(o))}n.__value=o,r=!1}),E6(n)}function ry(n){return"__value"in n?n.__value:n.value}const P6=Symbol("is custom element"),I6=Symbol("is html");function R6(n,e){var t=vD(n);t.value===(t.value=e??void 0)||n.value===e&&(e!==0||n.nodeName!=="PROGRESS")||(n.value=e??"")}function Bl(n,e,t,i){var r=vD(n);r[e]!==(r[e]=t)&&(e==="loading"&&(n[p5]=t),t==null?n.removeAttribute(e):typeof t!="string"&&L6(n).includes(e)?n[e]=t:n.setAttribute(e,t))}function vD(n){return n.__attributes??={[P6]:n.nodeName.includes("-"),[I6]:n.namespaceURI===O5}}var BP=new Map;function L6(n){var e=n.getAttribute("is")||n.nodeName,t=BP.get(e);if(t)return t;BP.set(e,t=[]);for(var i,r=n,o=Element.prototype;o!==r;){i=Pk(r);for(var c in i)i[c].set&&t.push(c);r=L2(r)}return t}function Sg(n,e,t=e){var i=new WeakSet;Hw(n,"input",async r=>{var o=r?n.defaultValue:n.value;if(o=NS(n)?$S(o):o,t(o),Bn!==null&&i.add(Bn),await hD(),o!==(o=e())){var c=n.selectionStart,s=n.selectionEnd,d=n.value.length;if(n.value=o??"",s!==null){var p=n.value.length;c===s&&s===d&&p>d?(n.selectionStart=p,n.selectionEnd=p):(n.selectionStart=c,n.selectionEnd=Math.min(s,p))}}}),bs(e)==null&&n.value&&(t(NS(n)?$S(n.value):n.value),Bn!==null&&i.add(Bn)),n0(()=>{var r=e();if(n===document.activeElement){var o=iy??Bn;if(i.has(o))return}NS(n)&&r===$S(n.value)||n.type==="date"&&!r&&!n.value||r!==n.value&&(n.value=r??"")})}const BS=new Set;function Dx(n,e,t,i,r=i){var o=t.getAttribute("type")==="checkbox",c=n;if(e!==null)for(var s of e)c=c[s]??=[];c.push(t),Hw(t,"change",()=>{var d=t.__value;o&&(d=D6(c,d,t.checked)),r(d)},()=>r(o?[]:null)),n0(()=>{var d=i();o?(d=d||[],t.checked=d.includes(t.__value)):t.checked=Hk(t.__value,d)}),i0(()=>{var d=c.indexOf(t);d!==-1&&c.splice(d,1)}),BS.has(c)||(BS.add(c),Dd(()=>{c.sort((d,p)=>d.compareDocumentPosition(p)===4?-1:1),BS.delete(c)})),Dd(()=>{})}function k6(n,e,t=e){Hw(n,"change",i=>{var r=i?n.defaultChecked:n.checked;t(r)}),bs(e)==null&&t(n.checked),n0(()=>{var i=e();n.checked=!!i})}function D6(n,e,t){for(var i=new Set,r=0;r<n.length;r+=1)n[r].checked&&i.add(n[r].__value);return t||i.delete(e),Array.from(i)}function NS(n){var e=n.type;return e==="number"||e==="range"}function $S(n){return n===""?null:+n}function NP(n,e){return n===e||n?.[mh]===e}function wc(n={},e,t,i){return V2(()=>{var r,o;return n0(()=>{r=o,o=[],bs(()=>{n!==t(...o)&&(e(n,...o),r&&NP(t(...r),n)&&e(null,...r))})}),()=>{Dd(()=>{o&&NP(t(...o),n)&&e(null,...o)})}}),n}function Xw(n=!1){const e=Ur,t=e.l.u;if(!t)return;let i=()=>h6(e.s);if(n){let r=0,o={};const c=e0(()=>{let s=!1;const d=e.s;for(const p in d)d[p]!==o[p]&&(o[p]=d[p],s=!0);return s&&r++,r});i=()=>te(c)}t.b.length&&$2(()=>{$P(e,i),CM(t.b)}),cn(()=>{const r=bs(()=>t.m.map(h5));return()=>{for(const o of r)typeof o=="function"&&o()}}),t.a.length&&cn(()=>{$P(e,i),CM(t.a)})}function $P(n,e){if(n.l.s)for(const t of n.l.s)te(t);e()}function yD(n,e,t){if(n==null)return e(void 0),ts;const i=bs(()=>n.subscribe(e,t));return i.unsubscribe?()=>i.unsubscribe():i}const zm=[];function ql(n,e=ts){let t=null;const i=new Set;function r(s){if(Dk(n,s)&&(n=s,t)){const d=!zm.length;for(const p of i)p[1](),zm.push(p,n);if(d){for(let p=0;p<zm.length;p+=2)zm[p][0](zm[p+1]);zm.length=0}}}function o(s){r(s(n))}function c(s,d=ts){const p=[s,d];return i.add(p),i.size===1&&(t=e(r,o)||ts),s(n),()=>{i.delete(p),i.size===0&&t&&(t(),t=null)}}return{set:r,update:o,subscribe:c}}function bD(n){let e;return yD(n,t=>e=t)(),e}let $v=!1,kM=Symbol();function nn(n,e,t){const i=t[e]??={store:null,source:qk(void 0),unsubscribe:ts};if(i.store!==n&&!(kM in t))if(i.unsubscribe(),i.store=n??null,n==null)i.source.v=void 0,i.unsubscribe=ts;else{var r=!0;i.unsubscribe=yD(n,o=>{r?i.source.v=o:Ct(i.source,o)}),r=!1}return n&&kM in t?bD(n):te(i.source)}function ia(n,e){return n.set(e),e}function is(){const n={};function e(){i0(()=>{for(var t in n)n[t].unsubscribe();Ak(n,kM,{enumerable:!1,value:!0})})}return[n,e]}function Sb(n,e,t){return n.set(t),e}function ip(n,e,t=1){return n.set(e+t),e}function xD(){$v=!0}function F6(n){var e=$v;try{return $v=!1,[n(),$v]}finally{$v=e}}const O6={get(n,e){if(!n.exclude.includes(e))return n.props[e]},set(n,e){return!1},getOwnPropertyDescriptor(n,e){if(!n.exclude.includes(e)&&e in n.props)return{enumerable:!0,configurable:!0,value:n.props[e]}},has(n,e){return n.exclude.includes(e)?!1:e in n.props},ownKeys(n){return Reflect.ownKeys(n.props).filter(e=>!n.exclude.includes(e))}};function z6(n,e,t){return new Proxy({props:n,exclude:e},O6)}function ft(n,e,t,i){var r=!i_||(t&I5)!==0,o=(t&L5)!==0,c=(t&k5)!==0,s=i,d=!0,p=()=>(d&&(d=!1,s=c?bs(i):i),s),g;if(o){var _=mh in n||f5 in n;g=wg(n,e)?.set??(_&&e in n?D=>n[e]=D:void 0)}var x,b=!1;o?[x,b]=F6(()=>n[e]):x=n[e],x===void 0&&i!==void 0&&(x=p(),g&&(r&&b5(),g(x)));var S;if(r?S=()=>{var D=n[e];return D===void 0?p():(d=!0,D)}:S=()=>{var D=n[e];return D!==void 0&&(s=void 0),D===void 0?s:D},r&&(t&R5)===0)return S;if(g){var P=n.$$legacy;return(function(D,O){return arguments.length>0?((!r||!O||P||b)&&g(O?S():D),D):S()})}var L=!1,E=((t&P5)!==0?e0:B2)(()=>(L=!1,S()));o&&te(E);var C=ir;return(function(D,O){if(arguments.length>0){const U=O?te(E):r&&o?Ss(D):D;return Ct(E,U),L=!0,s!==void 0&&(s=U),D}return xp&&L||(C.f&ph)!==0?E.v:te(E)})}function G2(n){Ur===null&&z2(),i_&&Ur.l!==null?B6(Ur).m.push(n):cn(()=>{const e=bs(n);if(typeof e=="function")return e})}function wa(n){Ur===null&&z2(),G2(()=>()=>bs(n))}function B6(n){var e=n.l;return e.u??={a:[],b:[],m:[]}}const N6="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(N6);var Og=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function wD(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function q2(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function i(){var r=!1;try{r=this instanceof i}catch{}return r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}),t}var Fx={exports:{}},sa="top",ol="bottom",al="right",oa="left",Yw="auto",a_=[sa,ol,al,oa],pp="start",zg="end",SD="clippingParents",W2="viewport",ug="popper",TD="reference",DM=a_.reduce(function(n,e){return n.concat([e+"-"+pp,e+"-"+zg])},[]),H2=[].concat(a_,[Yw]).reduce(function(n,e){return n.concat([e,e+"-"+pp,e+"-"+zg])},[]),MD="beforeRead",CD="read",ED="afterRead",AD="beforeMain",PD="main",ID="afterMain",RD="beforeWrite",LD="write",kD="afterWrite",DD=[MD,CD,ED,AD,PD,ID,RD,LD,kD];function mu(n){return n?(n.nodeName||"").toLowerCase():null}function ll(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var e=n.ownerDocument;return e&&e.defaultView||window}return n}function mp(n){var e=ll(n).Element;return n instanceof e||n instanceof Element}function Nl(n){var e=ll(n).HTMLElement;return n instanceof e||n instanceof HTMLElement}function Z2(n){if(typeof ShadowRoot>"u")return!1;var e=ll(n).ShadowRoot;return n instanceof e||n instanceof ShadowRoot}function $6(n){var e=n.state;Object.keys(e.elements).forEach(function(t){var i=e.styles[t]||{},r=e.attributes[t]||{},o=e.elements[t];!Nl(o)||!mu(o)||(Object.assign(o.style,i),Object.keys(r).forEach(function(c){var s=r[c];s===!1?o.removeAttribute(c):o.setAttribute(c,s===!0?"":s)}))})}function V6(n){var e=n.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow),function(){Object.keys(e.elements).forEach(function(i){var r=e.elements[i],o=e.attributes[i]||{},c=Object.keys(e.styles.hasOwnProperty(i)?e.styles[i]:t[i]),s=c.reduce(function(d,p){return d[p]="",d},{});!Nl(r)||!mu(r)||(Object.assign(r.style,s),Object.keys(o).forEach(function(d){r.removeAttribute(d)}))})}}const X2={name:"applyStyles",enabled:!0,phase:"write",fn:$6,effect:V6,requires:["computeStyles"]};function hu(n){return n.split("-")[0]}var np=Math.max,iw=Math.min,Bg=Math.round;function FM(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function FD(){return!/^((?!chrome|android).)*safari/i.test(FM())}function Ng(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!1);var i=n.getBoundingClientRect(),r=1,o=1;e&&Nl(n)&&(r=n.offsetWidth>0&&Bg(i.width)/n.offsetWidth||1,o=n.offsetHeight>0&&Bg(i.height)/n.offsetHeight||1);var c=mp(n)?ll(n):window,s=c.visualViewport,d=!FD()&&t,p=(i.left+(d&&s?s.offsetLeft:0))/r,g=(i.top+(d&&s?s.offsetTop:0))/o,_=i.width/r,x=i.height/o;return{width:_,height:x,top:g,right:p+_,bottom:g+x,left:p,x:p,y:g}}function Y2(n){var e=Ng(n),t=n.offsetWidth,i=n.offsetHeight;return Math.abs(e.width-t)<=1&&(t=e.width),Math.abs(e.height-i)<=1&&(i=e.height),{x:n.offsetLeft,y:n.offsetTop,width:t,height:i}}function OD(n,e){var t=e.getRootNode&&e.getRootNode();if(n.contains(e))return!0;if(t&&Z2(t)){var i=e;do{if(i&&n.isSameNode(i))return!0;i=i.parentNode||i.host}while(i)}return!1}function Sh(n){return ll(n).getComputedStyle(n)}function U6(n){return["table","td","th"].indexOf(mu(n))>=0}function Wd(n){return((mp(n)?n.ownerDocument:n.document)||window.document).documentElement}function Kw(n){return mu(n)==="html"?n:n.assignedSlot||n.parentNode||(Z2(n)?n.host:null)||Wd(n)}function VP(n){return!Nl(n)||Sh(n).position==="fixed"?null:n.offsetParent}function j6(n){var e=/firefox/i.test(FM()),t=/Trident/i.test(FM());if(t&&Nl(n)){var i=Sh(n);if(i.position==="fixed")return null}var r=Kw(n);for(Z2(r)&&(r=r.host);Nl(r)&&["html","body"].indexOf(mu(r))<0;){var o=Sh(r);if(o.transform!=="none"||o.perspective!=="none"||o.contain==="paint"||["transform","perspective"].indexOf(o.willChange)!==-1||e&&o.willChange==="filter"||e&&o.filter&&o.filter!=="none")return r;r=r.parentNode}return null}function o0(n){for(var e=ll(n),t=VP(n);t&&U6(t)&&Sh(t).position==="static";)t=VP(t);return t&&(mu(t)==="html"||mu(t)==="body"&&Sh(t).position==="static")?e:t||j6(n)||e}function K2(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function sy(n,e,t){return np(n,iw(e,t))}function G6(n,e,t){var i=sy(n,e,t);return i>t?t:i}function zD(){return{top:0,right:0,bottom:0,left:0}}function BD(n){return Object.assign({},zD(),n)}function ND(n,e){return e.reduce(function(t,i){return t[i]=n,t},{})}var q6=function(e,t){return e=typeof e=="function"?e(Object.assign({},t.rects,{placement:t.placement})):e,BD(typeof e!="number"?e:ND(e,a_))};function W6(n){var e,t=n.state,i=n.name,r=n.options,o=t.elements.arrow,c=t.modifiersData.popperOffsets,s=hu(t.placement),d=K2(s),p=[oa,al].indexOf(s)>=0,g=p?"height":"width";if(!(!o||!c)){var _=q6(r.padding,t),x=Y2(o),b=d==="y"?sa:oa,S=d==="y"?ol:al,P=t.rects.reference[g]+t.rects.reference[d]-c[d]-t.rects.popper[g],L=c[d]-t.rects.reference[d],E=o0(o),C=E?d==="y"?E.clientHeight||0:E.clientWidth||0:0,D=P/2-L/2,O=_[b],U=C-x[g]-_[S],q=C/2-x[g]/2+D,G=sy(O,q,U),N=d;t.modifiersData[i]=(e={},e[N]=G,e.centerOffset=G-q,e)}}function H6(n){var e=n.state,t=n.options,i=t.element,r=i===void 0?"[data-popper-arrow]":i;r!=null&&(typeof r=="string"&&(r=e.elements.popper.querySelector(r),!r)||OD(e.elements.popper,r)&&(e.elements.arrow=r))}const $D={name:"arrow",enabled:!0,phase:"main",fn:W6,effect:H6,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function $g(n){return n.split("-")[1]}var Z6={top:"auto",right:"auto",bottom:"auto",left:"auto"};function X6(n,e){var t=n.x,i=n.y,r=e.devicePixelRatio||1;return{x:Bg(t*r)/r||0,y:Bg(i*r)/r||0}}function UP(n){var e,t=n.popper,i=n.popperRect,r=n.placement,o=n.variation,c=n.offsets,s=n.position,d=n.gpuAcceleration,p=n.adaptive,g=n.roundOffsets,_=n.isFixed,x=c.x,b=x===void 0?0:x,S=c.y,P=S===void 0?0:S,L=typeof g=="function"?g({x:b,y:P}):{x:b,y:P};b=L.x,P=L.y;var E=c.hasOwnProperty("x"),C=c.hasOwnProperty("y"),D=oa,O=sa,U=window;if(p){var q=o0(t),G="clientHeight",N="clientWidth";if(q===ll(t)&&(q=Wd(t),Sh(q).position!=="static"&&s==="absolute"&&(G="scrollHeight",N="scrollWidth")),q=q,r===sa||(r===oa||r===al)&&o===zg){O=ol;var V=_&&q===U&&U.visualViewport?U.visualViewport.height:q[G];P-=V-i.height,P*=d?1:-1}if(r===oa||(r===sa||r===ol)&&o===zg){D=al;var j=_&&q===U&&U.visualViewport?U.visualViewport.width:q[N];b-=j-i.width,b*=d?1:-1}}var z=Object.assign({position:s},p&&Z6),Q=g===!0?X6({x:b,y:P},ll(t)):{x:b,y:P};if(b=Q.x,P=Q.y,d){var X;return Object.assign({},z,(X={},X[O]=C?"0":"",X[D]=E?"0":"",X.transform=(U.devicePixelRatio||1)<=1?"translate("+b+"px, "+P+"px)":"translate3d("+b+"px, "+P+"px, 0)",X))}return Object.assign({},z,(e={},e[O]=C?P+"px":"",e[D]=E?b+"px":"",e.transform="",e))}function Y6(n){var e=n.state,t=n.options,i=t.gpuAcceleration,r=i===void 0?!0:i,o=t.adaptive,c=o===void 0?!0:o,s=t.roundOffsets,d=s===void 0?!0:s,p={placement:hu(e.placement),variation:$g(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:r,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,UP(Object.assign({},p,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:c,roundOffsets:d})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,UP(Object.assign({},p,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:d})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const J2={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:Y6,data:{}};var Tb={passive:!0};function K6(n){var e=n.state,t=n.instance,i=n.options,r=i.scroll,o=r===void 0?!0:r,c=i.resize,s=c===void 0?!0:c,d=ll(e.elements.popper),p=[].concat(e.scrollParents.reference,e.scrollParents.popper);return o&&p.forEach(function(g){g.addEventListener("scroll",t.update,Tb)}),s&&d.addEventListener("resize",t.update,Tb),function(){o&&p.forEach(function(g){g.removeEventListener("scroll",t.update,Tb)}),s&&d.removeEventListener("resize",t.update,Tb)}}const Q2={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:K6,data:{}};var J6={left:"right",right:"left",bottom:"top",top:"bottom"};function Ox(n){return n.replace(/left|right|bottom|top/g,function(e){return J6[e]})}var Q6={start:"end",end:"start"};function jP(n){return n.replace(/start|end/g,function(e){return Q6[e]})}function eC(n){var e=ll(n),t=e.pageXOffset,i=e.pageYOffset;return{scrollLeft:t,scrollTop:i}}function tC(n){return Ng(Wd(n)).left+eC(n).scrollLeft}function eV(n,e){var t=ll(n),i=Wd(n),r=t.visualViewport,o=i.clientWidth,c=i.clientHeight,s=0,d=0;if(r){o=r.width,c=r.height;var p=FD();(p||!p&&e==="fixed")&&(s=r.offsetLeft,d=r.offsetTop)}return{width:o,height:c,x:s+tC(n),y:d}}function tV(n){var e,t=Wd(n),i=eC(n),r=(e=n.ownerDocument)==null?void 0:e.body,o=np(t.scrollWidth,t.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),c=np(t.scrollHeight,t.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0),s=-i.scrollLeft+tC(n),d=-i.scrollTop;return Sh(r||t).direction==="rtl"&&(s+=np(t.clientWidth,r?r.clientWidth:0)-o),{width:o,height:c,x:s,y:d}}function iC(n){var e=Sh(n),t=e.overflow,i=e.overflowX,r=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+r+i)}function VD(n){return["html","body","#document"].indexOf(mu(n))>=0?n.ownerDocument.body:Nl(n)&&iC(n)?n:VD(Kw(n))}function oy(n,e){var t;e===void 0&&(e=[]);var i=VD(n),r=i===((t=n.ownerDocument)==null?void 0:t.body),o=ll(i),c=r?[o].concat(o.visualViewport||[],iC(i)?i:[]):i,s=e.concat(c);return r?s:s.concat(oy(Kw(c)))}function OM(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function iV(n,e){var t=Ng(n,!1,e==="fixed");return t.top=t.top+n.clientTop,t.left=t.left+n.clientLeft,t.bottom=t.top+n.clientHeight,t.right=t.left+n.clientWidth,t.width=n.clientWidth,t.height=n.clientHeight,t.x=t.left,t.y=t.top,t}function GP(n,e,t){return e===W2?OM(eV(n,t)):mp(e)?iV(e,t):OM(tV(Wd(n)))}function nV(n){var e=oy(Kw(n)),t=["absolute","fixed"].indexOf(Sh(n).position)>=0,i=t&&Nl(n)?o0(n):n;return mp(i)?e.filter(function(r){return mp(r)&&OD(r,i)&&mu(r)!=="body"}):[]}function rV(n,e,t,i){var r=e==="clippingParents"?nV(n):[].concat(e),o=[].concat(r,[t]),c=o[0],s=o.reduce(function(d,p){var g=GP(n,p,i);return d.top=np(g.top,d.top),d.right=iw(g.right,d.right),d.bottom=iw(g.bottom,d.bottom),d.left=np(g.left,d.left),d},GP(n,c,i));return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}function UD(n){var e=n.reference,t=n.element,i=n.placement,r=i?hu(i):null,o=i?$g(i):null,c=e.x+e.width/2-t.width/2,s=e.y+e.height/2-t.height/2,d;switch(r){case sa:d={x:c,y:e.y-t.height};break;case ol:d={x:c,y:e.y+e.height};break;case al:d={x:e.x+e.width,y:s};break;case oa:d={x:e.x-t.width,y:s};break;default:d={x:e.x,y:e.y}}var p=r?K2(r):null;if(p!=null){var g=p==="y"?"height":"width";switch(o){case pp:d[p]=d[p]-(e[g]/2-t[g]/2);break;case zg:d[p]=d[p]+(e[g]/2-t[g]/2);break}}return d}function Vg(n,e){e===void 0&&(e={});var t=e,i=t.placement,r=i===void 0?n.placement:i,o=t.strategy,c=o===void 0?n.strategy:o,s=t.boundary,d=s===void 0?SD:s,p=t.rootBoundary,g=p===void 0?W2:p,_=t.elementContext,x=_===void 0?ug:_,b=t.altBoundary,S=b===void 0?!1:b,P=t.padding,L=P===void 0?0:P,E=BD(typeof L!="number"?L:ND(L,a_)),C=x===ug?TD:ug,D=n.rects.popper,O=n.elements[S?C:x],U=rV(mp(O)?O:O.contextElement||Wd(n.elements.popper),d,g,c),q=Ng(n.elements.reference),G=UD({reference:q,element:D,placement:r}),N=OM(Object.assign({},D,G)),V=x===ug?N:q,j={top:U.top-V.top+E.top,bottom:V.bottom-U.bottom+E.bottom,left:U.left-V.left+E.left,right:V.right-U.right+E.right},z=n.modifiersData.offset;if(x===ug&&z){var Q=z[r];Object.keys(j).forEach(function(X){var re=[al,ol].indexOf(X)>=0?1:-1,se=[sa,ol].indexOf(X)>=0?"y":"x";j[X]+=Q[se]*re})}return j}function sV(n,e){e===void 0&&(e={});var t=e,i=t.placement,r=t.boundary,o=t.rootBoundary,c=t.padding,s=t.flipVariations,d=t.allowedAutoPlacements,p=d===void 0?H2:d,g=$g(i),_=g?s?DM:DM.filter(function(S){return $g(S)===g}):a_,x=_.filter(function(S){return p.indexOf(S)>=0});x.length===0&&(x=_);var b=x.reduce(function(S,P){return S[P]=Vg(n,{placement:P,boundary:r,rootBoundary:o,padding:c})[hu(P)],S},{});return Object.keys(b).sort(function(S,P){return b[S]-b[P]})}function oV(n){if(hu(n)===Yw)return[];var e=Ox(n);return[jP(n),e,jP(e)]}function aV(n){var e=n.state,t=n.options,i=n.name;if(!e.modifiersData[i]._skip){for(var r=t.mainAxis,o=r===void 0?!0:r,c=t.altAxis,s=c===void 0?!0:c,d=t.fallbackPlacements,p=t.padding,g=t.boundary,_=t.rootBoundary,x=t.altBoundary,b=t.flipVariations,S=b===void 0?!0:b,P=t.allowedAutoPlacements,L=e.options.placement,E=hu(L),C=E===L,D=d||(C||!S?[Ox(L)]:oV(L)),O=[L].concat(D).reduce(function(De,ot){return De.concat(hu(ot)===Yw?sV(e,{placement:ot,boundary:g,rootBoundary:_,padding:p,flipVariations:S,allowedAutoPlacements:P}):ot)},[]),U=e.rects.reference,q=e.rects.popper,G=new Map,N=!0,V=O[0],j=0;j<O.length;j++){var z=O[j],Q=hu(z),X=$g(z)===pp,re=[sa,ol].indexOf(Q)>=0,se=re?"width":"height",le=Vg(e,{placement:z,boundary:g,rootBoundary:_,altBoundary:x,padding:p}),ce=re?X?al:oa:X?ol:sa;U[se]>q[se]&&(ce=Ox(ce));var be=Ox(ce),Ee=[];if(o&&Ee.push(le[Q]<=0),s&&Ee.push(le[ce]<=0,le[be]<=0),Ee.every(function(De){return De})){V=z,N=!1;break}G.set(z,Ee)}if(N)for(var $e=S?3:1,Ve=function(ot){var xe=O.find(function(Be){var Je=G.get(Be);if(Je)return Je.slice(0,ot).every(function(ct){return ct})});if(xe)return V=xe,"break"},nt=$e;nt>0;nt--){var He=Ve(nt);if(He==="break")break}e.placement!==V&&(e.modifiersData[i]._skip=!0,e.placement=V,e.reset=!0)}}const jD={name:"flip",enabled:!0,phase:"main",fn:aV,requiresIfExists:["offset"],data:{_skip:!1}};function qP(n,e,t){return t===void 0&&(t={x:0,y:0}),{top:n.top-e.height-t.y,right:n.right-e.width+t.x,bottom:n.bottom-e.height+t.y,left:n.left-e.width-t.x}}function WP(n){return[sa,al,ol,oa].some(function(e){return n[e]>=0})}function lV(n){var e=n.state,t=n.name,i=e.rects.reference,r=e.rects.popper,o=e.modifiersData.preventOverflow,c=Vg(e,{elementContext:"reference"}),s=Vg(e,{altBoundary:!0}),d=qP(c,i),p=qP(s,r,o),g=WP(d),_=WP(p);e.modifiersData[t]={referenceClippingOffsets:d,popperEscapeOffsets:p,isReferenceHidden:g,hasPopperEscaped:_},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":g,"data-popper-escaped":_})}const GD={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:lV};function cV(n,e,t){var i=hu(n),r=[oa,sa].indexOf(i)>=0?-1:1,o=typeof t=="function"?t(Object.assign({},e,{placement:n})):t,c=o[0],s=o[1];return c=c||0,s=(s||0)*r,[oa,al].indexOf(i)>=0?{x:s,y:c}:{x:c,y:s}}function uV(n){var e=n.state,t=n.options,i=n.name,r=t.offset,o=r===void 0?[0,0]:r,c=H2.reduce(function(g,_){return g[_]=cV(_,e.rects,o),g},{}),s=c[e.placement],d=s.x,p=s.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=d,e.modifiersData.popperOffsets.y+=p),e.modifiersData[i]=c}const qD={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:uV};function hV(n){var e=n.state,t=n.name;e.modifiersData[t]=UD({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const nC={name:"popperOffsets",enabled:!0,phase:"read",fn:hV,data:{}};function dV(n){return n==="x"?"y":"x"}function fV(n){var e=n.state,t=n.options,i=n.name,r=t.mainAxis,o=r===void 0?!0:r,c=t.altAxis,s=c===void 0?!1:c,d=t.boundary,p=t.rootBoundary,g=t.altBoundary,_=t.padding,x=t.tether,b=x===void 0?!0:x,S=t.tetherOffset,P=S===void 0?0:S,L=Vg(e,{boundary:d,rootBoundary:p,padding:_,altBoundary:g}),E=hu(e.placement),C=$g(e.placement),D=!C,O=K2(E),U=dV(O),q=e.modifiersData.popperOffsets,G=e.rects.reference,N=e.rects.popper,V=typeof P=="function"?P(Object.assign({},e.rects,{placement:e.placement})):P,j=typeof V=="number"?{mainAxis:V,altAxis:V}:Object.assign({mainAxis:0,altAxis:0},V),z=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,Q={x:0,y:0};if(q){if(o){var X,re=O==="y"?sa:oa,se=O==="y"?ol:al,le=O==="y"?"height":"width",ce=q[O],be=ce+L[re],Ee=ce-L[se],$e=b?-N[le]/2:0,Ve=C===pp?G[le]:N[le],nt=C===pp?-N[le]:-G[le],He=e.elements.arrow,De=b&&He?Y2(He):{width:0,height:0},ot=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:zD(),xe=ot[re],Be=ot[se],Je=sy(0,G[le],De[le]),ct=D?G[le]/2-$e-Je-xe-j.mainAxis:Ve-Je-xe-j.mainAxis,xt=D?-G[le]/2+$e+Je+Be+j.mainAxis:nt+Je+Be+j.mainAxis,Se=e.elements.arrow&&o0(e.elements.arrow),me=Se?O==="y"?Se.clientTop||0:Se.clientLeft||0:0,qe=(X=z?.[O])!=null?X:0,st=ce+ct-qe-me,Rt=ce+xt-qe,gt=sy(b?iw(be,st):be,ce,b?np(Ee,Rt):Ee);q[O]=gt,Q[O]=gt-ce}if(s){var Ae,we=O==="x"?sa:oa,vt=O==="x"?ol:al,ye=q[U],ie=U==="y"?"height":"width",ae=ye+L[we],ke=ye-L[vt],Ze=[sa,oa].indexOf(E)!==-1,yt=(Ae=z?.[U])!=null?Ae:0,Me=Ze?ae:ye-G[ie]-N[ie]-yt+j.altAxis,ee=Ze?ye+G[ie]+N[ie]-yt-j.altAxis:ke,de=b&&Ze?G6(Me,ye,ee):sy(b?Me:ae,ye,b?ee:ke);q[U]=de,Q[U]=de-ye}e.modifiersData[i]=Q}}const WD={name:"preventOverflow",enabled:!0,phase:"main",fn:fV,requiresIfExists:["offset"]};function pV(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function mV(n){return n===ll(n)||!Nl(n)?eC(n):pV(n)}function gV(n){var e=n.getBoundingClientRect(),t=Bg(e.width)/n.offsetWidth||1,i=Bg(e.height)/n.offsetHeight||1;return t!==1||i!==1}function _V(n,e,t){t===void 0&&(t=!1);var i=Nl(e),r=Nl(e)&&gV(e),o=Wd(e),c=Ng(n,r,t),s={scrollLeft:0,scrollTop:0},d={x:0,y:0};return(i||!i&&!t)&&((mu(e)!=="body"||iC(o))&&(s=mV(e)),Nl(e)?(d=Ng(e,!0),d.x+=e.clientLeft,d.y+=e.clientTop):o&&(d.x=tC(o))),{x:c.left+s.scrollLeft-d.x,y:c.top+s.scrollTop-d.y,width:c.width,height:c.height}}function vV(n){var e=new Map,t=new Set,i=[];n.forEach(function(o){e.set(o.name,o)});function r(o){t.add(o.name);var c=[].concat(o.requires||[],o.requiresIfExists||[]);c.forEach(function(s){if(!t.has(s)){var d=e.get(s);d&&r(d)}}),i.push(o)}return n.forEach(function(o){t.has(o.name)||r(o)}),i}function yV(n){var e=vV(n);return DD.reduce(function(t,i){return t.concat(e.filter(function(r){return r.phase===i}))},[])}function bV(n){var e;return function(){return e||(e=new Promise(function(t){Promise.resolve().then(function(){e=void 0,t(n())})})),e}}function xV(n){var e=n.reduce(function(t,i){var r=t[i.name];return t[i.name]=r?Object.assign({},r,i,{options:Object.assign({},r.options,i.options),data:Object.assign({},r.data,i.data)}):i,t},{});return Object.keys(e).map(function(t){return e[t]})}var HP={placement:"bottom",modifiers:[],strategy:"absolute"};function ZP(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return!e.some(function(i){return!(i&&typeof i.getBoundingClientRect=="function")})}function Jw(n){n===void 0&&(n={});var e=n,t=e.defaultModifiers,i=t===void 0?[]:t,r=e.defaultOptions,o=r===void 0?HP:r;return function(s,d,p){p===void 0&&(p=o);var g={placement:"bottom",orderedModifiers:[],options:Object.assign({},HP,o),modifiersData:{},elements:{reference:s,popper:d},attributes:{},styles:{}},_=[],x=!1,b={state:g,setOptions:function(E){var C=typeof E=="function"?E(g.options):E;P(),g.options=Object.assign({},o,g.options,C),g.scrollParents={reference:mp(s)?oy(s):s.contextElement?oy(s.contextElement):[],popper:oy(d)};var D=yV(xV([].concat(i,g.options.modifiers)));return g.orderedModifiers=D.filter(function(O){return O.enabled}),S(),b.update()},forceUpdate:function(){if(!x){var E=g.elements,C=E.reference,D=E.popper;if(ZP(C,D)){g.rects={reference:_V(C,o0(D),g.options.strategy==="fixed"),popper:Y2(D)},g.reset=!1,g.placement=g.options.placement,g.orderedModifiers.forEach(function(j){return g.modifiersData[j.name]=Object.assign({},j.data)});for(var O=0;O<g.orderedModifiers.length;O++){if(g.reset===!0){g.reset=!1,O=-1;continue}var U=g.orderedModifiers[O],q=U.fn,G=U.options,N=G===void 0?{}:G,V=U.name;typeof q=="function"&&(g=q({state:g,options:N,name:V,instance:b})||g)}}}},update:bV(function(){return new Promise(function(L){b.forceUpdate(),L(g)})}),destroy:function(){P(),x=!0}};if(!ZP(s,d))return b;b.setOptions(p).then(function(L){!x&&p.onFirstUpdate&&p.onFirstUpdate(L)});function S(){g.orderedModifiers.forEach(function(L){var E=L.name,C=L.options,D=C===void 0?{}:C,O=L.effect;if(typeof O=="function"){var U=O({state:g,name:E,instance:b,options:D}),q=function(){};_.push(U||q)}})}function P(){_.forEach(function(L){return L()}),_=[]}return b}}var wV=Jw(),SV=[Q2,nC,J2,X2],TV=Jw({defaultModifiers:SV}),MV=[Q2,nC,J2,X2,qD,jD,WD,$D,GD],CV=Jw({defaultModifiers:MV});const EV=Object.freeze(Object.defineProperty({__proto__:null,afterMain:ID,afterRead:ED,afterWrite:kD,applyStyles:X2,arrow:$D,auto:Yw,basePlacements:a_,beforeMain:AD,beforeRead:MD,beforeWrite:RD,bottom:ol,clippingParents:SD,computeStyles:J2,createPopper:CV,createPopperBase:wV,createPopperLite:TV,detectOverflow:Vg,end:zg,eventListeners:Q2,flip:jD,hide:GD,left:oa,main:PD,modifierPhases:DD,offset:qD,placements:H2,popper:ug,popperGenerator:Jw,popperOffsets:nC,preventOverflow:WD,read:CD,reference:TD,right:al,start:pp,top:sa,variationPlacements:DM,viewport:W2,write:LD},Symbol.toStringTag,{value:"Module"})),AV=q2(EV);var PV=Fx.exports,XP;function IV(){return XP||(XP=1,(function(n,e){(function(t,i){n.exports=i(AV)})(PV,function(t){function i(ut){const Y=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(ut){for(const Te in ut)if(Te!=="default"){const ht=Object.getOwnPropertyDescriptor(ut,Te);Object.defineProperty(Y,Te,ht.get?ht:{enumerable:!0,get:()=>ut[Te]})}}return Y.default=ut,Object.freeze(Y)}const r=i(t),o=new Map,c={set(ut,Y,Te){o.has(ut)||o.set(ut,new Map);const ht=o.get(ut);ht.has(Y)||ht.size===0?ht.set(Y,Te):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(ht.keys())[0]}.`)},get:(ut,Y)=>o.has(ut)&&o.get(ut).get(Y)||null,remove(ut,Y){if(!o.has(ut))return;const Te=o.get(ut);Te.delete(Y),Te.size===0&&o.delete(ut)}},s="transitionend",d=ut=>(ut&&window.CSS&&window.CSS.escape&&(ut=ut.replace(/#([^\s"#']+)/g,(Y,Te)=>`#${CSS.escape(Te)}`)),ut),p=ut=>ut==null?`${ut}`:Object.prototype.toString.call(ut).match(/\s([a-z]+)/i)[1].toLowerCase(),g=ut=>{ut.dispatchEvent(new Event(s))},_=ut=>!(!ut||typeof ut!="object")&&(ut.jquery!==void 0&&(ut=ut[0]),ut.nodeType!==void 0),x=ut=>_(ut)?ut.jquery?ut[0]:ut:typeof ut=="string"&&ut.length>0?document.querySelector(d(ut)):null,b=ut=>{if(!_(ut)||ut.getClientRects().length===0)return!1;const Y=getComputedStyle(ut).getPropertyValue("visibility")==="visible",Te=ut.closest("details:not([open])");if(!Te)return Y;if(Te!==ut){const ht=ut.closest("summary");if(ht&&ht.parentNode!==Te||ht===null)return!1}return Y},S=ut=>!ut||ut.nodeType!==Node.ELEMENT_NODE||!!ut.classList.contains("disabled")||(ut.disabled!==void 0?ut.disabled:ut.hasAttribute("disabled")&&ut.getAttribute("disabled")!=="false"),P=ut=>{if(!document.documentElement.attachShadow)return null;if(typeof ut.getRootNode=="function"){const Y=ut.getRootNode();return Y instanceof ShadowRoot?Y:null}return ut instanceof ShadowRoot?ut:ut.parentNode?P(ut.parentNode):null},L=()=>{},E=ut=>{ut.offsetHeight},C=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,D=[],O=()=>document.documentElement.dir==="rtl",U=ut=>{var Y;Y=()=>{const Te=C();if(Te){const ht=ut.NAME,Ht=Te.fn[ht];Te.fn[ht]=ut.jQueryInterface,Te.fn[ht].Constructor=ut,Te.fn[ht].noConflict=()=>(Te.fn[ht]=Ht,ut.jQueryInterface)}},document.readyState==="loading"?(D.length||document.addEventListener("DOMContentLoaded",()=>{for(const Te of D)Te()}),D.push(Y)):Y()},q=(ut,Y=[],Te=ut)=>typeof ut=="function"?ut.call(...Y):Te,G=(ut,Y,Te=!0)=>{if(!Te)return void q(ut);const ht=(Ti=>{if(!Ti)return 0;let{transitionDuration:_n,transitionDelay:fr}=window.getComputedStyle(Ti);const Es=Number.parseFloat(_n),ji=Number.parseFloat(fr);return Es||ji?(_n=_n.split(",")[0],fr=fr.split(",")[0],1e3*(Number.parseFloat(_n)+Number.parseFloat(fr))):0})(Y)+5;let Ht=!1;const di=({target:Ti})=>{Ti===Y&&(Ht=!0,Y.removeEventListener(s,di),q(ut))};Y.addEventListener(s,di),setTimeout(()=>{Ht||g(Y)},ht)},N=(ut,Y,Te,ht)=>{const Ht=ut.length;let di=ut.indexOf(Y);return di===-1?!Te&&ht?ut[Ht-1]:ut[0]:(di+=Te?1:-1,ht&&(di=(di+Ht)%Ht),ut[Math.max(0,Math.min(di,Ht-1))])},V=/[^.]*(?=\..*)\.|.*/,j=/\..*/,z=/::\d+$/,Q={};let X=1;const re={mouseenter:"mouseover",mouseleave:"mouseout"},se=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function le(ut,Y){return Y&&`${Y}::${X++}`||ut.uidEvent||X++}function ce(ut){const Y=le(ut);return ut.uidEvent=Y,Q[Y]=Q[Y]||{},Q[Y]}function be(ut,Y,Te=null){return Object.values(ut).find(ht=>ht.callable===Y&&ht.delegationSelector===Te)}function Ee(ut,Y,Te){const ht=typeof Y=="string",Ht=ht?Te:Y||Te;let di=He(ut);return se.has(di)||(di=ut),[ht,Ht,di]}function $e(ut,Y,Te,ht,Ht){if(typeof Y!="string"||!ut)return;let[di,Ti,_n]=Ee(Y,Te,ht);Y in re&&(Ti=(jo=>function(Go){if(!Go.relatedTarget||Go.relatedTarget!==Go.delegateTarget&&!Go.delegateTarget.contains(Go.relatedTarget))return jo.call(this,Go)})(Ti));const fr=ce(ut),Es=fr[_n]||(fr[_n]={}),ji=be(Es,Ti,di?Te:null);if(ji)return void(ji.oneOff=ji.oneOff&&Ht);const Ks=le(Ti,Y.replace(V,"")),ka=di?(function(ca,jo,Go){return function zu(Bu){const M_=ca.querySelectorAll(jo);for(let{target:Da}=Bu;Da&&Da!==this;Da=Da.parentNode)for(const $c of M_)if($c===Da)return ot(Bu,{delegateTarget:Da}),zu.oneOff&&De.off(ca,Bu.type,jo,Go),Go.apply(Da,[Bu])}})(ut,Te,Ti):(function(ca,jo){return function Go(zu){return ot(zu,{delegateTarget:ca}),Go.oneOff&&De.off(ca,zu.type,jo),jo.apply(ca,[zu])}})(ut,Ti);ka.delegationSelector=di?Te:null,ka.callable=Ti,ka.oneOff=Ht,ka.uidEvent=Ks,Es[Ks]=ka,ut.addEventListener(_n,ka,di)}function Ve(ut,Y,Te,ht,Ht){const di=be(Y[Te],ht,Ht);di&&(ut.removeEventListener(Te,di,!!Ht),delete Y[Te][di.uidEvent])}function nt(ut,Y,Te,ht){const Ht=Y[Te]||{};for(const[di,Ti]of Object.entries(Ht))di.includes(ht)&&Ve(ut,Y,Te,Ti.callable,Ti.delegationSelector)}function He(ut){return ut=ut.replace(j,""),re[ut]||ut}const De={on(ut,Y,Te,ht){$e(ut,Y,Te,ht,!1)},one(ut,Y,Te,ht){$e(ut,Y,Te,ht,!0)},off(ut,Y,Te,ht){if(typeof Y!="string"||!ut)return;const[Ht,di,Ti]=Ee(Y,Te,ht),_n=Ti!==Y,fr=ce(ut),Es=fr[Ti]||{},ji=Y.startsWith(".");if(di===void 0){if(ji)for(const Ks of Object.keys(fr))nt(ut,fr,Ks,Y.slice(1));for(const[Ks,ka]of Object.entries(Es)){const ca=Ks.replace(z,"");_n&&!Y.includes(ca)||Ve(ut,fr,Ti,ka.callable,ka.delegationSelector)}}else{if(!Object.keys(Es).length)return;Ve(ut,fr,Ti,di,Ht?Te:null)}},trigger(ut,Y,Te){if(typeof Y!="string"||!ut)return null;const ht=C();let Ht=null,di=!0,Ti=!0,_n=!1;Y!==He(Y)&&ht&&(Ht=ht.Event(Y,Te),ht(ut).trigger(Ht),di=!Ht.isPropagationStopped(),Ti=!Ht.isImmediatePropagationStopped(),_n=Ht.isDefaultPrevented());const fr=ot(new Event(Y,{bubbles:di,cancelable:!0}),Te);return _n&&fr.preventDefault(),Ti&&ut.dispatchEvent(fr),fr.defaultPrevented&&Ht&&Ht.preventDefault(),fr}};function ot(ut,Y={}){for(const[Te,ht]of Object.entries(Y))try{ut[Te]=ht}catch{Object.defineProperty(ut,Te,{configurable:!0,get:()=>ht})}return ut}function xe(ut){if(ut==="true")return!0;if(ut==="false")return!1;if(ut===Number(ut).toString())return Number(ut);if(ut===""||ut==="null")return null;if(typeof ut!="string")return ut;try{return JSON.parse(decodeURIComponent(ut))}catch{return ut}}function Be(ut){return ut.replace(/[A-Z]/g,Y=>`-${Y.toLowerCase()}`)}const Je={setDataAttribute(ut,Y,Te){ut.setAttribute(`data-bs-${Be(Y)}`,Te)},removeDataAttribute(ut,Y){ut.removeAttribute(`data-bs-${Be(Y)}`)},getDataAttributes(ut){if(!ut)return{};const Y={},Te=Object.keys(ut.dataset).filter(ht=>ht.startsWith("bs")&&!ht.startsWith("bsConfig"));for(const ht of Te){let Ht=ht.replace(/^bs/,"");Ht=Ht.charAt(0).toLowerCase()+Ht.slice(1),Y[Ht]=xe(ut.dataset[ht])}return Y},getDataAttribute:(ut,Y)=>xe(ut.getAttribute(`data-bs-${Be(Y)}`))};class ct{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(Y){return Y=this._mergeConfigObj(Y),Y=this._configAfterMerge(Y),this._typeCheckConfig(Y),Y}_configAfterMerge(Y){return Y}_mergeConfigObj(Y,Te){const ht=_(Te)?Je.getDataAttribute(Te,"config"):{};return{...this.constructor.Default,...typeof ht=="object"?ht:{},..._(Te)?Je.getDataAttributes(Te):{},...typeof Y=="object"?Y:{}}}_typeCheckConfig(Y,Te=this.constructor.DefaultType){for(const[ht,Ht]of Object.entries(Te)){const di=Y[ht],Ti=_(di)?"element":p(di);if(!new RegExp(Ht).test(Ti))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${ht}" provided type "${Ti}" but expected type "${Ht}".`)}}}class xt extends ct{constructor(Y,Te){super(),(Y=x(Y))&&(this._element=Y,this._config=this._getConfig(Te),c.set(this._element,this.constructor.DATA_KEY,this))}dispose(){c.remove(this._element,this.constructor.DATA_KEY),De.off(this._element,this.constructor.EVENT_KEY);for(const Y of Object.getOwnPropertyNames(this))this[Y]=null}_queueCallback(Y,Te,ht=!0){G(Y,Te,ht)}_getConfig(Y){return Y=this._mergeConfigObj(Y,this._element),Y=this._configAfterMerge(Y),this._typeCheckConfig(Y),Y}static getInstance(Y){return c.get(x(Y),this.DATA_KEY)}static getOrCreateInstance(Y,Te={}){return this.getInstance(Y)||new this(Y,typeof Te=="object"?Te:null)}static get VERSION(){return"5.3.8"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(Y){return`${Y}${this.EVENT_KEY}`}}const Se=ut=>{let Y=ut.getAttribute("data-bs-target");if(!Y||Y==="#"){let Te=ut.getAttribute("href");if(!Te||!Te.includes("#")&&!Te.startsWith("."))return null;Te.includes("#")&&!Te.startsWith("#")&&(Te=`#${Te.split("#")[1]}`),Y=Te&&Te!=="#"?Te.trim():null}return Y?Y.split(",").map(Te=>d(Te)).join(","):null},me={find:(ut,Y=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(Y,ut)),findOne:(ut,Y=document.documentElement)=>Element.prototype.querySelector.call(Y,ut),children:(ut,Y)=>[].concat(...ut.children).filter(Te=>Te.matches(Y)),parents(ut,Y){const Te=[];let ht=ut.parentNode.closest(Y);for(;ht;)Te.push(ht),ht=ht.parentNode.closest(Y);return Te},prev(ut,Y){let Te=ut.previousElementSibling;for(;Te;){if(Te.matches(Y))return[Te];Te=Te.previousElementSibling}return[]},next(ut,Y){let Te=ut.nextElementSibling;for(;Te;){if(Te.matches(Y))return[Te];Te=Te.nextElementSibling}return[]},focusableChildren(ut){const Y=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(Te=>`${Te}:not([tabindex^="-"])`).join(",");return this.find(Y,ut).filter(Te=>!S(Te)&&b(Te))},getSelectorFromElement(ut){const Y=Se(ut);return Y&&me.findOne(Y)?Y:null},getElementFromSelector(ut){const Y=Se(ut);return Y?me.findOne(Y):null},getMultipleElementsFromSelector(ut){const Y=Se(ut);return Y?me.find(Y):[]}},qe=(ut,Y="hide")=>{const Te=`click.dismiss${ut.EVENT_KEY}`,ht=ut.NAME;De.on(document,Te,`[data-bs-dismiss="${ht}"]`,function(Ht){if(["A","AREA"].includes(this.tagName)&&Ht.preventDefault(),S(this))return;const di=me.getElementFromSelector(this)||this.closest(`.${ht}`);ut.getOrCreateInstance(di)[Y]()})},st=".bs.alert",Rt=`close${st}`,gt=`closed${st}`;class Ae extends xt{static get NAME(){return"alert"}close(){if(De.trigger(this._element,Rt).defaultPrevented)return;this._element.classList.remove("show");const Y=this._element.classList.contains("fade");this._queueCallback(()=>this._destroyElement(),this._element,Y)}_destroyElement(){this._element.remove(),De.trigger(this._element,gt),this.dispose()}static jQueryInterface(Y){return this.each(function(){const Te=Ae.getOrCreateInstance(this);if(typeof Y=="string"){if(Te[Y]===void 0||Y.startsWith("_")||Y==="constructor")throw new TypeError(`No method named "${Y}"`);Te[Y](this)}})}}qe(Ae,"close"),U(Ae);const we='[data-bs-toggle="button"]';class vt extends xt{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(Y){return this.each(function(){const Te=vt.getOrCreateInstance(this);Y==="toggle"&&Te[Y]()})}}De.on(document,"click.bs.button.data-api",we,ut=>{ut.preventDefault();const Y=ut.target.closest(we);vt.getOrCreateInstance(Y).toggle()}),U(vt);const ye=".bs.swipe",ie=`touchstart${ye}`,ae=`touchmove${ye}`,ke=`touchend${ye}`,Ze=`pointerdown${ye}`,yt=`pointerup${ye}`,Me={endCallback:null,leftCallback:null,rightCallback:null},ee={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class de extends ct{constructor(Y,Te){super(),this._element=Y,Y&&de.isSupported()&&(this._config=this._getConfig(Te),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return Me}static get DefaultType(){return ee}static get NAME(){return"swipe"}dispose(){De.off(this._element,ye)}_start(Y){this._supportPointerEvents?this._eventIsPointerPenTouch(Y)&&(this._deltaX=Y.clientX):this._deltaX=Y.touches[0].clientX}_end(Y){this._eventIsPointerPenTouch(Y)&&(this._deltaX=Y.clientX-this._deltaX),this._handleSwipe(),q(this._config.endCallback)}_move(Y){this._deltaX=Y.touches&&Y.touches.length>1?0:Y.touches[0].clientX-this._deltaX}_handleSwipe(){const Y=Math.abs(this._deltaX);if(Y<=40)return;const Te=Y/this._deltaX;this._deltaX=0,Te&&q(Te>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(De.on(this._element,Ze,Y=>this._start(Y)),De.on(this._element,yt,Y=>this._end(Y)),this._element.classList.add("pointer-event")):(De.on(this._element,ie,Y=>this._start(Y)),De.on(this._element,ae,Y=>this._move(Y)),De.on(this._element,ke,Y=>this._end(Y)))}_eventIsPointerPenTouch(Y){return this._supportPointerEvents&&(Y.pointerType==="pen"||Y.pointerType==="touch")}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const pe=".bs.carousel",Le=".data-api",Oe="ArrowLeft",dt="ArrowRight",pt="next",rt="prev",St="left",Dt="right",Bt=`slide${pe}`,Jt=`slid${pe}`,vi=`keydown${pe}`,$i=`mouseenter${pe}`,vn=`mouseleave${pe}`,on=`dragstart${pe}`,Tt=`load${pe}${Le}`,gn=`click${pe}${Le}`,Er="carousel",Di="active",yn=".active",Yn=".carousel-item",Cn=yn+Yn,Un={[Oe]:Dt,[dt]:St},En={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},dr={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class Xe extends xt{constructor(Y,Te){super(Y,Te),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=me.findOne(".carousel-indicators",this._element),this._addEventListeners(),this._config.ride===Er&&this.cycle()}static get Default(){return En}static get DefaultType(){return dr}static get NAME(){return"carousel"}next(){this._slide(pt)}nextWhenVisible(){!document.hidden&&b(this._element)&&this.next()}prev(){this._slide(rt)}pause(){this._isSliding&&g(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){this._config.ride&&(this._isSliding?De.one(this._element,Jt,()=>this.cycle()):this.cycle())}to(Y){const Te=this._getItems();if(Y>Te.length-1||Y<0)return;if(this._isSliding)return void De.one(this._element,Jt,()=>this.to(Y));const ht=this._getItemIndex(this._getActive());if(ht===Y)return;const Ht=Y>ht?pt:rt;this._slide(Ht,Te[Y])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(Y){return Y.defaultInterval=Y.interval,Y}_addEventListeners(){this._config.keyboard&&De.on(this._element,vi,Y=>this._keydown(Y)),this._config.pause==="hover"&&(De.on(this._element,$i,()=>this.pause()),De.on(this._element,vn,()=>this._maybeEnableCycle())),this._config.touch&&de.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const Te of me.find(".carousel-item img",this._element))De.on(Te,on,ht=>ht.preventDefault());const Y={leftCallback:()=>this._slide(this._directionToOrder(St)),rightCallback:()=>this._slide(this._directionToOrder(Dt)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),500+this._config.interval))}};this._swipeHelper=new de(this._element,Y)}_keydown(Y){if(/input|textarea/i.test(Y.target.tagName))return;const Te=Un[Y.key];Te&&(Y.preventDefault(),this._slide(this._directionToOrder(Te)))}_getItemIndex(Y){return this._getItems().indexOf(Y)}_setActiveIndicatorElement(Y){if(!this._indicatorsElement)return;const Te=me.findOne(yn,this._indicatorsElement);Te.classList.remove(Di),Te.removeAttribute("aria-current");const ht=me.findOne(`[data-bs-slide-to="${Y}"]`,this._indicatorsElement);ht&&(ht.classList.add(Di),ht.setAttribute("aria-current","true"))}_updateInterval(){const Y=this._activeElement||this._getActive();if(!Y)return;const Te=Number.parseInt(Y.getAttribute("data-bs-interval"),10);this._config.interval=Te||this._config.defaultInterval}_slide(Y,Te=null){if(this._isSliding)return;const ht=this._getActive(),Ht=Y===pt,di=Te||N(this._getItems(),ht,Ht,this._config.wrap);if(di===ht)return;const Ti=this._getItemIndex(di),_n=Ks=>De.trigger(this._element,Ks,{relatedTarget:di,direction:this._orderToDirection(Y),from:this._getItemIndex(ht),to:Ti});if(_n(Bt).defaultPrevented||!ht||!di)return;const fr=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(Ti),this._activeElement=di;const Es=Ht?"carousel-item-start":"carousel-item-end",ji=Ht?"carousel-item-next":"carousel-item-prev";di.classList.add(ji),E(di),ht.classList.add(Es),di.classList.add(Es),this._queueCallback(()=>{di.classList.remove(Es,ji),di.classList.add(Di),ht.classList.remove(Di,ji,Es),this._isSliding=!1,_n(Jt)},ht,this._isAnimated()),fr&&this.cycle()}_isAnimated(){return this._element.classList.contains("slide")}_getActive(){return me.findOne(Cn,this._element)}_getItems(){return me.find(Yn,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(Y){return O()?Y===St?rt:pt:Y===St?pt:rt}_orderToDirection(Y){return O()?Y===rt?St:Dt:Y===rt?Dt:St}static jQueryInterface(Y){return this.each(function(){const Te=Xe.getOrCreateInstance(this,Y);if(typeof Y!="number"){if(typeof Y=="string"){if(Te[Y]===void 0||Y.startsWith("_")||Y==="constructor")throw new TypeError(`No method named "${Y}"`);Te[Y]()}}else Te.to(Y)})}}De.on(document,gn,"[data-bs-slide], [data-bs-slide-to]",function(ut){const Y=me.getElementFromSelector(this);if(!Y||!Y.classList.contains(Er))return;ut.preventDefault();const Te=Xe.getOrCreateInstance(Y),ht=this.getAttribute("data-bs-slide-to");return ht?(Te.to(ht),void Te._maybeEnableCycle()):Je.getDataAttribute(this,"slide")==="next"?(Te.next(),void Te._maybeEnableCycle()):(Te.prev(),void Te._maybeEnableCycle())}),De.on(window,Tt,()=>{const ut=me.find('[data-bs-ride="carousel"]');for(const Y of ut)Xe.getOrCreateInstance(Y)}),U(Xe);const kt=".bs.collapse",lt=`show${kt}`,Ft=`shown${kt}`,Wt=`hide${kt}`,qi=`hidden${kt}`,Ii=`click${kt}.data-api`,Nt="show",ai="collapse",pi="collapsing",Wi=`:scope .${ai} .${ai}`,wt='[data-bs-toggle="collapse"]',Ri={parent:null,toggle:!0},bi={parent:"(null|element)",toggle:"boolean"};class Ni extends xt{constructor(Y,Te){super(Y,Te),this._isTransitioning=!1,this._triggerArray=[];const ht=me.find(wt);for(const Ht of ht){const di=me.getSelectorFromElement(Ht),Ti=me.find(di).filter(_n=>_n===this._element);di!==null&&Ti.length&&this._triggerArray.push(Ht)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return Ri}static get DefaultType(){return bi}static get NAME(){return"collapse"}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let Y=[];if(this._config.parent&&(Y=this._getFirstLevelChildren(".collapse.show, .collapse.collapsing").filter(Ht=>Ht!==this._element).map(Ht=>Ni.getOrCreateInstance(Ht,{toggle:!1}))),Y.length&&Y[0]._isTransitioning||De.trigger(this._element,lt).defaultPrevented)return;for(const Ht of Y)Ht.hide();const Te=this._getDimension();this._element.classList.remove(ai),this._element.classList.add(pi),this._element.style[Te]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const ht=`scroll${Te[0].toUpperCase()+Te.slice(1)}`;this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(pi),this._element.classList.add(ai,Nt),this._element.style[Te]="",De.trigger(this._element,Ft)},this._element,!0),this._element.style[Te]=`${this._element[ht]}px`}hide(){if(this._isTransitioning||!this._isShown()||De.trigger(this._element,Wt).defaultPrevented)return;const Y=this._getDimension();this._element.style[Y]=`${this._element.getBoundingClientRect()[Y]}px`,E(this._element),this._element.classList.add(pi),this._element.classList.remove(ai,Nt);for(const Te of this._triggerArray){const ht=me.getElementFromSelector(Te);ht&&!this._isShown(ht)&&this._addAriaAndCollapsedClass([Te],!1)}this._isTransitioning=!0,this._element.style[Y]="",this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(pi),this._element.classList.add(ai),De.trigger(this._element,qi)},this._element,!0)}_isShown(Y=this._element){return Y.classList.contains(Nt)}_configAfterMerge(Y){return Y.toggle=!!Y.toggle,Y.parent=x(Y.parent),Y}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(!this._config.parent)return;const Y=this._getFirstLevelChildren(wt);for(const Te of Y){const ht=me.getElementFromSelector(Te);ht&&this._addAriaAndCollapsedClass([Te],this._isShown(ht))}}_getFirstLevelChildren(Y){const Te=me.find(Wi,this._config.parent);return me.find(Y,this._config.parent).filter(ht=>!Te.includes(ht))}_addAriaAndCollapsedClass(Y,Te){if(Y.length)for(const ht of Y)ht.classList.toggle("collapsed",!Te),ht.setAttribute("aria-expanded",Te)}static jQueryInterface(Y){const Te={};return typeof Y=="string"&&/show|hide/.test(Y)&&(Te.toggle=!1),this.each(function(){const ht=Ni.getOrCreateInstance(this,Te);if(typeof Y=="string"){if(ht[Y]===void 0)throw new TypeError(`No method named "${Y}"`);ht[Y]()}})}}De.on(document,Ii,wt,function(ut){(ut.target.tagName==="A"||ut.delegateTarget&&ut.delegateTarget.tagName==="A")&&ut.preventDefault();for(const Y of me.getMultipleElementsFromSelector(this))Ni.getOrCreateInstance(Y,{toggle:!1}).toggle()}),U(Ni);const Kn="dropdown",Xi=".bs.dropdown",jn=".data-api",an="ArrowUp",zr="ArrowDown",Gn=`hide${Xi}`,ln=`hidden${Xi}`,tn=`show${Xi}`,ns=`shown${Xi}`,ro=`click${Xi}${jn}`,dl=`keydown${Xi}${jn}`,xo=`keyup${Xi}${jn}`,Ar="show",nr='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',Hl=`${nr}.${Ar}`,Zl=".dropdown-menu",_r=O()?"top-end":"top-start",Pp=O()?"top-start":"top-end",Ip=O()?"bottom-end":"bottom-start",Su=O()?"bottom-start":"bottom-end",Rp=O()?"left-start":"right-start",Lp=O()?"right-start":"left-start",kp={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},Fh={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class so extends xt{constructor(Y,Te){super(Y,Te),this._popper=null,this._parent=this._element.parentNode,this._menu=me.next(this._element,Zl)[0]||me.prev(this._element,Zl)[0]||me.findOne(Zl,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return kp}static get DefaultType(){return Fh}static get NAME(){return Kn}toggle(){return this._isShown()?this.hide():this.show()}show(){if(S(this._element)||this._isShown())return;const Y={relatedTarget:this._element};if(!De.trigger(this._element,tn,Y).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(".navbar-nav"))for(const Te of[].concat(...document.body.children))De.on(Te,"mouseover",L);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(Ar),this._element.classList.add(Ar),De.trigger(this._element,ns,Y)}}hide(){if(S(this._element)||!this._isShown())return;const Y={relatedTarget:this._element};this._completeHide(Y)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(Y){if(!De.trigger(this._element,Gn,Y).defaultPrevented){if("ontouchstart"in document.documentElement)for(const Te of[].concat(...document.body.children))De.off(Te,"mouseover",L);this._popper&&this._popper.destroy(),this._menu.classList.remove(Ar),this._element.classList.remove(Ar),this._element.setAttribute("aria-expanded","false"),Je.removeDataAttribute(this._menu,"popper"),De.trigger(this._element,ln,Y)}}_getConfig(Y){if(typeof(Y=super._getConfig(Y)).reference=="object"&&!_(Y.reference)&&typeof Y.reference.getBoundingClientRect!="function")throw new TypeError(`${Kn.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return Y}_createPopper(){if(r===void 0)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org/docs/v2/)");let Y=this._element;this._config.reference==="parent"?Y=this._parent:_(this._config.reference)?Y=x(this._config.reference):typeof this._config.reference=="object"&&(Y=this._config.reference);const Te=this._getPopperConfig();this._popper=r.createPopper(Y,this._menu,Te)}_isShown(){return this._menu.classList.contains(Ar)}_getPlacement(){const Y=this._parent;if(Y.classList.contains("dropend"))return Rp;if(Y.classList.contains("dropstart"))return Lp;if(Y.classList.contains("dropup-center"))return"top";if(Y.classList.contains("dropdown-center"))return"bottom";const Te=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return Y.classList.contains("dropup")?Te?Pp:_r:Te?Su:Ip}_detectNavbar(){return this._element.closest(".navbar")!==null}_getOffset(){const{offset:Y}=this._config;return typeof Y=="string"?Y.split(",").map(Te=>Number.parseInt(Te,10)):typeof Y=="function"?Te=>Y(Te,this._element):Y}_getPopperConfig(){const Y={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(Je.setDataAttribute(this._menu,"popper","static"),Y.modifiers=[{name:"applyStyles",enabled:!1}]),{...Y,...q(this._config.popperConfig,[void 0,Y])}}_selectMenuItem({key:Y,target:Te}){const ht=me.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter(Ht=>b(Ht));ht.length&&N(ht,Te,Y===zr,!ht.includes(Te)).focus()}static jQueryInterface(Y){return this.each(function(){const Te=so.getOrCreateInstance(this,Y);if(typeof Y=="string"){if(Te[Y]===void 0)throw new TypeError(`No method named "${Y}"`);Te[Y]()}})}static clearMenus(Y){if(Y.button===2||Y.type==="keyup"&&Y.key!=="Tab")return;const Te=me.find(Hl);for(const ht of Te){const Ht=so.getInstance(ht);if(!Ht||Ht._config.autoClose===!1)continue;const di=Y.composedPath(),Ti=di.includes(Ht._menu);if(di.includes(Ht._element)||Ht._config.autoClose==="inside"&&!Ti||Ht._config.autoClose==="outside"&&Ti||Ht._menu.contains(Y.target)&&(Y.type==="keyup"&&Y.key==="Tab"||/input|select|option|textarea|form/i.test(Y.target.tagName)))continue;const _n={relatedTarget:Ht._element};Y.type==="click"&&(_n.clickEvent=Y),Ht._completeHide(_n)}}static dataApiKeydownHandler(Y){const Te=/input|textarea/i.test(Y.target.tagName),ht=Y.key==="Escape",Ht=[an,zr].includes(Y.key);if(!Ht&&!ht||Te&&!ht)return;Y.preventDefault();const di=this.matches(nr)?this:me.prev(this,nr)[0]||me.next(this,nr)[0]||me.findOne(nr,Y.delegateTarget.parentNode),Ti=so.getOrCreateInstance(di);if(Ht)return Y.stopPropagation(),Ti.show(),void Ti._selectMenuItem(Y);Ti._isShown()&&(Y.stopPropagation(),Ti.hide(),di.focus())}}De.on(document,dl,nr,so.dataApiKeydownHandler),De.on(document,dl,Zl,so.dataApiKeydownHandler),De.on(document,ro,so.clearMenus),De.on(document,xo,so.clearMenus),De.on(document,ro,nr,function(ut){ut.preventDefault(),so.getOrCreateInstance(this).toggle()}),U(so);const Oh="backdrop",zh="show",Bh=`mousedown.bs.${Oh}`,v_={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},Tu={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class Mu extends ct{constructor(Y){super(),this._config=this._getConfig(Y),this._isAppended=!1,this._element=null}static get Default(){return v_}static get DefaultType(){return Tu}static get NAME(){return Oh}show(Y){if(!this._config.isVisible)return void q(Y);this._append();const Te=this._getElement();this._config.isAnimated&&E(Te),Te.classList.add(zh),this._emulateAnimation(()=>{q(Y)})}hide(Y){this._config.isVisible?(this._getElement().classList.remove(zh),this._emulateAnimation(()=>{this.dispose(),q(Y)})):q(Y)}dispose(){this._isAppended&&(De.off(this._element,Bh),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const Y=document.createElement("div");Y.className=this._config.className,this._config.isAnimated&&Y.classList.add("fade"),this._element=Y}return this._element}_configAfterMerge(Y){return Y.rootElement=x(Y.rootElement),Y}_append(){if(this._isAppended)return;const Y=this._getElement();this._config.rootElement.append(Y),De.on(Y,Bh,()=>{q(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(Y){G(Y,this._getElement(),this._config.isAnimated)}}const Cu=".bs.focustrap",Ic=`focusin${Cu}`,Jd=`keydown.tab${Cu}`,Rc="backward",fl={autofocus:!0,trapElement:null},Lc={autofocus:"boolean",trapElement:"element"};class rn extends ct{constructor(Y){super(),this._config=this._getConfig(Y),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return fl}static get DefaultType(){return Lc}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),De.off(document,Cu),De.on(document,Ic,Y=>this._handleFocusin(Y)),De.on(document,Jd,Y=>this._handleKeydown(Y)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,De.off(document,Cu))}_handleFocusin(Y){const{trapElement:Te}=this._config;if(Y.target===document||Y.target===Te||Te.contains(Y.target))return;const ht=me.focusableChildren(Te);ht.length===0?Te.focus():this._lastTabNavDirection===Rc?ht[ht.length-1].focus():ht[0].focus()}_handleKeydown(Y){Y.key==="Tab"&&(this._lastTabNavDirection=Y.shiftKey?Rc:"forward")}}const Nh=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",Dp=".sticky-top",kc="padding-right",Ns="margin-right";class fs{constructor(){this._element=document.body}getWidth(){const Y=document.documentElement.clientWidth;return Math.abs(window.innerWidth-Y)}hide(){const Y=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,kc,Te=>Te+Y),this._setElementAttributes(Nh,kc,Te=>Te+Y),this._setElementAttributes(Dp,Ns,Te=>Te-Y)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,kc),this._resetElementAttributes(Nh,kc),this._resetElementAttributes(Dp,Ns)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(Y,Te,ht){const Ht=this.getWidth();this._applyManipulationCallback(Y,di=>{if(di!==this._element&&window.innerWidth>di.clientWidth+Ht)return;this._saveInitialAttribute(di,Te);const Ti=window.getComputedStyle(di).getPropertyValue(Te);di.style.setProperty(Te,`${ht(Number.parseFloat(Ti))}px`)})}_saveInitialAttribute(Y,Te){const ht=Y.style.getPropertyValue(Te);ht&&Je.setDataAttribute(Y,Te,ht)}_resetElementAttributes(Y,Te){this._applyManipulationCallback(Y,ht=>{const Ht=Je.getDataAttribute(ht,Te);Ht!==null?(Je.removeDataAttribute(ht,Te),ht.style.setProperty(Te,Ht)):ht.style.removeProperty(Te)})}_applyManipulationCallback(Y,Te){if(_(Y))Te(Y);else for(const ht of me.find(Y,this._element))Te(ht)}}const xn=".bs.modal",Gi=`hide${xn}`,On=`hidePrevented${xn}`,Sa=`hidden${xn}`,Ms=`show${xn}`,oo=`shown${xn}`,$s=`resize${xn}`,Dc=`click.dismiss${xn}`,pl=`mousedown.dismiss${xn}`,Pr=`keydown.dismiss${xn}`,Xl=`click${xn}.data-api`,No="modal-open",Eu="show",Cs="modal-static",Yl={backdrop:!0,focus:!0,keyboard:!0},Ta={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class ml extends xt{constructor(Y,Te){super(Y,Te),this._dialog=me.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new fs,this._addEventListeners()}static get Default(){return Yl}static get DefaultType(){return Ta}static get NAME(){return"modal"}toggle(Y){return this._isShown?this.hide():this.show(Y)}show(Y){this._isShown||this._isTransitioning||De.trigger(this._element,Ms,{relatedTarget:Y}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(No),this._adjustDialog(),this._backdrop.show(()=>this._showElement(Y)))}hide(){this._isShown&&!this._isTransitioning&&(De.trigger(this._element,Gi).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(Eu),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated())))}dispose(){De.off(window,xn),De.off(this._dialog,xn),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new Mu({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new rn({trapElement:this._element})}_showElement(Y){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const Te=me.findOne(".modal-body",this._dialog);Te&&(Te.scrollTop=0),E(this._element),this._element.classList.add(Eu),this._queueCallback(()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,De.trigger(this._element,oo,{relatedTarget:Y})},this._dialog,this._isAnimated())}_addEventListeners(){De.on(this._element,Pr,Y=>{Y.key==="Escape"&&(this._config.keyboard?this.hide():this._triggerBackdropTransition())}),De.on(window,$s,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),De.on(this._element,pl,Y=>{De.one(this._element,Dc,Te=>{this._element===Y.target&&this._element===Te.target&&(this._config.backdrop!=="static"?this._config.backdrop&&this.hide():this._triggerBackdropTransition())})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(No),this._resetAdjustments(),this._scrollBar.reset(),De.trigger(this._element,Sa)})}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(De.trigger(this._element,On).defaultPrevented)return;const Y=this._element.scrollHeight>document.documentElement.clientHeight,Te=this._element.style.overflowY;Te==="hidden"||this._element.classList.contains(Cs)||(Y||(this._element.style.overflowY="hidden"),this._element.classList.add(Cs),this._queueCallback(()=>{this._element.classList.remove(Cs),this._queueCallback(()=>{this._element.style.overflowY=Te},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const Y=this._element.scrollHeight>document.documentElement.clientHeight,Te=this._scrollBar.getWidth(),ht=Te>0;if(ht&&!Y){const Ht=O()?"paddingLeft":"paddingRight";this._element.style[Ht]=`${Te}px`}if(!ht&&Y){const Ht=O()?"paddingRight":"paddingLeft";this._element.style[Ht]=`${Te}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(Y,Te){return this.each(function(){const ht=ml.getOrCreateInstance(this,Y);if(typeof Y=="string"){if(ht[Y]===void 0)throw new TypeError(`No method named "${Y}"`);ht[Y](Te)}})}}De.on(document,Xl,'[data-bs-toggle="modal"]',function(ut){const Y=me.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&ut.preventDefault(),De.one(Y,Ms,ht=>{ht.defaultPrevented||De.one(Y,Sa,()=>{b(this)&&this.focus()})});const Te=me.findOne(".modal.show");Te&&ml.getInstance(Te).hide(),ml.getOrCreateInstance(Y).toggle(this)}),qe(ml),U(ml);const $o=".bs.offcanvas",gl=".data-api",zn=`load${$o}${gl}`,Kl="show",pn="showing",Ki="hiding",Jl=".offcanvas.show",bn=`show${$o}`,Au=`shown${$o}`,wo=`hide${$o}`,Ql=`hidePrevented${$o}`,Ma=`hidden${$o}`,Fp=`resize${$o}`,Pu=`click${$o}${gl}`,Qd=`keydown.dismiss${$o}`,y_={backdrop:!0,keyboard:!0,scroll:!1},Op={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class vr extends xt{constructor(Y,Te){super(Y,Te),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return y_}static get DefaultType(){return Op}static get NAME(){return"offcanvas"}toggle(Y){return this._isShown?this.hide():this.show(Y)}show(Y){this._isShown||De.trigger(this._element,bn,{relatedTarget:Y}).defaultPrevented||(this._isShown=!0,this._backdrop.show(),this._config.scroll||new fs().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(pn),this._queueCallback(()=>{this._config.scroll&&!this._config.backdrop||this._focustrap.activate(),this._element.classList.add(Kl),this._element.classList.remove(pn),De.trigger(this._element,Au,{relatedTarget:Y})},this._element,!0))}hide(){this._isShown&&(De.trigger(this._element,wo).defaultPrevented||(this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(Ki),this._backdrop.hide(),this._queueCallback(()=>{this._element.classList.remove(Kl,Ki),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new fs().reset(),De.trigger(this._element,Ma)},this._element,!0)))}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const Y=!!this._config.backdrop;return new Mu({className:"offcanvas-backdrop",isVisible:Y,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:Y?()=>{this._config.backdrop!=="static"?this.hide():De.trigger(this._element,Ql)}:null})}_initializeFocusTrap(){return new rn({trapElement:this._element})}_addEventListeners(){De.on(this._element,Qd,Y=>{Y.key==="Escape"&&(this._config.keyboard?this.hide():De.trigger(this._element,Ql))})}static jQueryInterface(Y){return this.each(function(){const Te=vr.getOrCreateInstance(this,Y);if(typeof Y=="string"){if(Te[Y]===void 0||Y.startsWith("_")||Y==="constructor")throw new TypeError(`No method named "${Y}"`);Te[Y](this)}})}}De.on(document,Pu,'[data-bs-toggle="offcanvas"]',function(ut){const Y=me.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&ut.preventDefault(),S(this))return;De.one(Y,Ma,()=>{b(this)&&this.focus()});const Te=me.findOne(Jl);Te&&Te!==Y&&vr.getInstance(Te).hide(),vr.getOrCreateInstance(Y).toggle(this)}),De.on(window,zn,()=>{for(const ut of me.find(Jl))vr.getOrCreateInstance(ut).show()}),De.on(window,Fp,()=>{for(const ut of me.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(ut).position!=="fixed"&&vr.getOrCreateInstance(ut).hide()}),qe(vr),U(vr);const Vo={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},rr=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),ec=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,ef=(ut,Y)=>{const Te=ut.nodeName.toLowerCase();return Y.includes(Te)?!rr.has(Te)||!!ec.test(ut.nodeValue):Y.filter(ht=>ht instanceof RegExp).some(ht=>ht.test(Te))},Iu={allowList:Vo,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},yr={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},zp={entry:"(string|element|function|null)",selector:"(string|element)"};class tf extends ct{constructor(Y){super(),this._config=this._getConfig(Y)}static get Default(){return Iu}static get DefaultType(){return yr}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map(Y=>this._resolvePossibleFunction(Y)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(Y){return this._checkContent(Y),this._config.content={...this._config.content,...Y},this}toHtml(){const Y=document.createElement("div");Y.innerHTML=this._maybeSanitize(this._config.template);for(const[Ht,di]of Object.entries(this._config.content))this._setContent(Y,di,Ht);const Te=Y.children[0],ht=this._resolvePossibleFunction(this._config.extraClass);return ht&&Te.classList.add(...ht.split(" ")),Te}_typeCheckConfig(Y){super._typeCheckConfig(Y),this._checkContent(Y.content)}_checkContent(Y){for(const[Te,ht]of Object.entries(Y))super._typeCheckConfig({selector:Te,entry:ht},zp)}_setContent(Y,Te,ht){const Ht=me.findOne(ht,Y);Ht&&((Te=this._resolvePossibleFunction(Te))?_(Te)?this._putElementInTemplate(x(Te),Ht):this._config.html?Ht.innerHTML=this._maybeSanitize(Te):Ht.textContent=Te:Ht.remove())}_maybeSanitize(Y){return this._config.sanitize?(function(Te,ht,Ht){if(!Te.length)return Te;if(Ht&&typeof Ht=="function")return Ht(Te);const di=new window.DOMParser().parseFromString(Te,"text/html"),Ti=[].concat(...di.body.querySelectorAll("*"));for(const _n of Ti){const fr=_n.nodeName.toLowerCase();if(!Object.keys(ht).includes(fr)){_n.remove();continue}const Es=[].concat(..._n.attributes),ji=[].concat(ht["*"]||[],ht[fr]||[]);for(const Ks of Es)ef(Ks,ji)||_n.removeAttribute(Ks.nodeName)}return di.body.innerHTML})(Y,this._config.allowList,this._config.sanitizeFn):Y}_resolvePossibleFunction(Y){return q(Y,[void 0,this])}_putElementInTemplate(Y,Te){if(this._config.html)return Te.innerHTML="",void Te.append(Y);Te.textContent=Y.textContent}}const Bp=new Set(["sanitize","allowList","sanitizeFn"]),nf="fade",Ca="show",$h=".tooltip-inner",tc=".modal",Vh="hide.bs.modal",Ea="hover",_l="focus",vl="click",qr={AUTO:"auto",TOP:"top",RIGHT:O()?"left":"right",BOTTOM:"bottom",LEFT:O()?"right":"left"},Np={allowList:Vo,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},Fc={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class Uo extends xt{constructor(Y,Te){if(r===void 0)throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org/docs/v2/)");super(Y,Te),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return Np}static get DefaultType(){return Fc}static get NAME(){return"tooltip"}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout),De.off(this._element.closest(tc),Vh,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!this._isWithContent()||!this._isEnabled)return;const Y=De.trigger(this._element,this.constructor.eventName("show")),Te=(P(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(Y.defaultPrevented||!Te)return;this._disposePopper();const ht=this._getTipElement();this._element.setAttribute("aria-describedby",ht.getAttribute("id"));const{container:Ht}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(Ht.append(ht),De.trigger(this._element,this.constructor.eventName("inserted"))),this._popper=this._createPopper(ht),ht.classList.add(Ca),"ontouchstart"in document.documentElement)for(const di of[].concat(...document.body.children))De.on(di,"mouseover",L);this._queueCallback(()=>{De.trigger(this._element,this.constructor.eventName("shown")),this._isHovered===!1&&this._leave(),this._isHovered=!1},this.tip,this._isAnimated())}hide(){if(this._isShown()&&!De.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented){if(this._getTipElement().classList.remove(Ca),"ontouchstart"in document.documentElement)for(const Y of[].concat(...document.body.children))De.off(Y,"mouseover",L);this._activeTrigger[vl]=!1,this._activeTrigger[_l]=!1,this._activeTrigger[Ea]=!1,this._isHovered=null,this._queueCallback(()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),De.trigger(this._element,this.constructor.eventName("hidden")))},this.tip,this._isAnimated())}}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(Y){const Te=this._getTemplateFactory(Y).toHtml();if(!Te)return null;Te.classList.remove(nf,Ca),Te.classList.add(`bs-${this.constructor.NAME}-auto`);const ht=(Ht=>{do Ht+=Math.floor(1e6*Math.random());while(document.getElementById(Ht));return Ht})(this.constructor.NAME).toString();return Te.setAttribute("id",ht),this._isAnimated()&&Te.classList.add(nf),Te}setContent(Y){this._newContent=Y,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(Y){return this._templateFactory?this._templateFactory.changeContent(Y):this._templateFactory=new tf({...this._config,content:Y,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[$h]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(Y){return this.constructor.getOrCreateInstance(Y.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(nf)}_isShown(){return this.tip&&this.tip.classList.contains(Ca)}_createPopper(Y){const Te=q(this._config.placement,[this,Y,this._element]),ht=qr[Te.toUpperCase()];return r.createPopper(this._element,Y,this._getPopperConfig(ht))}_getOffset(){const{offset:Y}=this._config;return typeof Y=="string"?Y.split(",").map(Te=>Number.parseInt(Te,10)):typeof Y=="function"?Te=>Y(Te,this._element):Y}_resolvePossibleFunction(Y){return q(Y,[this._element,this._element])}_getPopperConfig(Y){const Te={placement:Y,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:ht=>{this._getTipElement().setAttribute("data-popper-placement",ht.state.placement)}}]};return{...Te,...q(this._config.popperConfig,[void 0,Te])}}_setListeners(){const Y=this._config.trigger.split(" ");for(const Te of Y)if(Te==="click")De.on(this._element,this.constructor.eventName("click"),this._config.selector,ht=>{const Ht=this._initializeOnDelegatedTarget(ht);Ht._activeTrigger[vl]=!(Ht._isShown()&&Ht._activeTrigger[vl]),Ht.toggle()});else if(Te!=="manual"){const ht=Te===Ea?this.constructor.eventName("mouseenter"):this.constructor.eventName("focusin"),Ht=Te===Ea?this.constructor.eventName("mouseleave"):this.constructor.eventName("focusout");De.on(this._element,ht,this._config.selector,di=>{const Ti=this._initializeOnDelegatedTarget(di);Ti._activeTrigger[di.type==="focusin"?_l:Ea]=!0,Ti._enter()}),De.on(this._element,Ht,this._config.selector,di=>{const Ti=this._initializeOnDelegatedTarget(di);Ti._activeTrigger[di.type==="focusout"?_l:Ea]=Ti._element.contains(di.relatedTarget),Ti._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},De.on(this._element.closest(tc),Vh,this._hideModalHandler)}_fixTitle(){const Y=this._element.getAttribute("title");Y&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",Y),this._element.setAttribute("data-bs-original-title",Y),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(Y,Te){clearTimeout(this._timeout),this._timeout=setTimeout(Y,Te)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(Y){const Te=Je.getDataAttributes(this._element);for(const ht of Object.keys(Te))Bp.has(ht)&&delete Te[ht];return Y={...Te,...typeof Y=="object"&&Y?Y:{}},Y=this._mergeConfigObj(Y),Y=this._configAfterMerge(Y),this._typeCheckConfig(Y),Y}_configAfterMerge(Y){return Y.container=Y.container===!1?document.body:x(Y.container),typeof Y.delay=="number"&&(Y.delay={show:Y.delay,hide:Y.delay}),typeof Y.title=="number"&&(Y.title=Y.title.toString()),typeof Y.content=="number"&&(Y.content=Y.content.toString()),Y}_getDelegateConfig(){const Y={};for(const[Te,ht]of Object.entries(this._config))this.constructor.Default[Te]!==ht&&(Y[Te]=ht);return Y.selector=!1,Y.trigger="manual",Y}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(Y){return this.each(function(){const Te=Uo.getOrCreateInstance(this,Y);if(typeof Y=="string"){if(Te[Y]===void 0)throw new TypeError(`No method named "${Y}"`);Te[Y]()}})}}U(Uo);const ic=".popover-header",b_=".popover-body",Uh={...Uo.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},x_={...Uo.DefaultType,content:"(null|string|element|function)"};class Aa extends Uo{static get Default(){return Uh}static get DefaultType(){return x_}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[ic]:this._getTitle(),[b_]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(Y){return this.each(function(){const Te=Aa.getOrCreateInstance(this,Y);if(typeof Y=="string"){if(Te[Y]===void 0)throw new TypeError(`No method named "${Y}"`);Te[Y]()}})}}U(Aa);const Oc=".bs.scrollspy",$p=`activate${Oc}`,rf=`click${Oc}`,sf=`load${Oc}.data-api`,yl="active",Ru="[href]",of=".nav-link",Vp=`${of}, .nav-item > ${of}, .list-group-item`,Up={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},nc={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class zc extends xt{constructor(Y,Te){super(Y,Te),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return Up}static get DefaultType(){return nc}static get NAME(){return"scrollspy"}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const Y of this._observableSections.values())this._observer.observe(Y)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(Y){return Y.target=x(Y.target)||document.body,Y.rootMargin=Y.offset?`${Y.offset}px 0px -30%`:Y.rootMargin,typeof Y.threshold=="string"&&(Y.threshold=Y.threshold.split(",").map(Te=>Number.parseFloat(Te))),Y}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(De.off(this._config.target,rf),De.on(this._config.target,rf,Ru,Y=>{const Te=this._observableSections.get(Y.target.hash);if(Te){Y.preventDefault();const ht=this._rootElement||window,Ht=Te.offsetTop-this._element.offsetTop;if(ht.scrollTo)return void ht.scrollTo({top:Ht,behavior:"smooth"});ht.scrollTop=Ht}}))}_getNewObserver(){const Y={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(Te=>this._observerCallback(Te),Y)}_observerCallback(Y){const Te=Ti=>this._targetLinks.get(`#${Ti.target.id}`),ht=Ti=>{this._previousScrollData.visibleEntryTop=Ti.target.offsetTop,this._process(Te(Ti))},Ht=(this._rootElement||document.documentElement).scrollTop,di=Ht>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=Ht;for(const Ti of Y){if(!Ti.isIntersecting){this._activeTarget=null,this._clearActiveClass(Te(Ti));continue}const _n=Ti.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(di&&_n){if(ht(Ti),!Ht)return}else di||_n||ht(Ti)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const Y=me.find(Ru,this._config.target);for(const Te of Y){if(!Te.hash||S(Te))continue;const ht=me.findOne(decodeURI(Te.hash),this._element);b(ht)&&(this._targetLinks.set(decodeURI(Te.hash),Te),this._observableSections.set(Te.hash,ht))}}_process(Y){this._activeTarget!==Y&&(this._clearActiveClass(this._config.target),this._activeTarget=Y,Y.classList.add(yl),this._activateParents(Y),De.trigger(this._element,$p,{relatedTarget:Y}))}_activateParents(Y){if(Y.classList.contains("dropdown-item"))me.findOne(".dropdown-toggle",Y.closest(".dropdown")).classList.add(yl);else for(const Te of me.parents(Y,".nav, .list-group"))for(const ht of me.prev(Te,Vp))ht.classList.add(yl)}_clearActiveClass(Y){Y.classList.remove(yl);const Te=me.find(`${Ru}.${yl}`,Y);for(const ht of Te)ht.classList.remove(yl)}static jQueryInterface(Y){return this.each(function(){const Te=zc.getOrCreateInstance(this,Y);if(typeof Y=="string"){if(Te[Y]===void 0||Y.startsWith("_")||Y==="constructor")throw new TypeError(`No method named "${Y}"`);Te[Y]()}})}}De.on(window,sf,()=>{for(const ut of me.find('[data-bs-spy="scroll"]'))zc.getOrCreateInstance(ut)}),U(zc);const Pa=".bs.tab",Bc=`hide${Pa}`,jp=`hidden${Pa}`,jh=`show${Pa}`,w_=`shown${Pa}`,S_=`click${Pa}`,Gp=`keydown${Pa}`,Lu=`load${Pa}`,qp="ArrowLeft",Gh="ArrowRight",Wp="ArrowUp",ku="ArrowDown",ao="Home",Du="End",Ia="active",qh="fade",Fu="show",Ou=".dropdown-toggle",Ra=`:not(${Ou})`,Wh='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',af=`.nav-link${Ra}, .list-group-item${Ra}, [role="tab"]${Ra}, ${Wh}`,Hp=`.${Ia}[data-bs-toggle="tab"], .${Ia}[data-bs-toggle="pill"], .${Ia}[data-bs-toggle="list"]`;class rc extends xt{constructor(Y){super(Y),this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),De.on(this._element,Gp,Te=>this._keydown(Te)))}static get NAME(){return"tab"}show(){const Y=this._element;if(this._elemIsActive(Y))return;const Te=this._getActiveElem(),ht=Te?De.trigger(Te,Bc,{relatedTarget:Y}):null;De.trigger(Y,jh,{relatedTarget:Te}).defaultPrevented||ht&&ht.defaultPrevented||(this._deactivate(Te,Y),this._activate(Y,Te))}_activate(Y,Te){Y&&(Y.classList.add(Ia),this._activate(me.getElementFromSelector(Y)),this._queueCallback(()=>{Y.getAttribute("role")==="tab"?(Y.removeAttribute("tabindex"),Y.setAttribute("aria-selected",!0),this._toggleDropDown(Y,!0),De.trigger(Y,w_,{relatedTarget:Te})):Y.classList.add(Fu)},Y,Y.classList.contains(qh)))}_deactivate(Y,Te){Y&&(Y.classList.remove(Ia),Y.blur(),this._deactivate(me.getElementFromSelector(Y)),this._queueCallback(()=>{Y.getAttribute("role")==="tab"?(Y.setAttribute("aria-selected",!1),Y.setAttribute("tabindex","-1"),this._toggleDropDown(Y,!1),De.trigger(Y,jp,{relatedTarget:Te})):Y.classList.remove(Fu)},Y,Y.classList.contains(qh)))}_keydown(Y){if(![qp,Gh,Wp,ku,ao,Du].includes(Y.key))return;Y.stopPropagation(),Y.preventDefault();const Te=this._getChildren().filter(Ht=>!S(Ht));let ht;if([ao,Du].includes(Y.key))ht=Te[Y.key===ao?0:Te.length-1];else{const Ht=[Gh,ku].includes(Y.key);ht=N(Te,Y.target,Ht,!0)}ht&&(ht.focus({preventScroll:!0}),rc.getOrCreateInstance(ht).show())}_getChildren(){return me.find(af,this._parent)}_getActiveElem(){return this._getChildren().find(Y=>this._elemIsActive(Y))||null}_setInitialAttributes(Y,Te){this._setAttributeIfNotExists(Y,"role","tablist");for(const ht of Te)this._setInitialAttributesOnChild(ht)}_setInitialAttributesOnChild(Y){Y=this._getInnerElement(Y);const Te=this._elemIsActive(Y),ht=this._getOuterElement(Y);Y.setAttribute("aria-selected",Te),ht!==Y&&this._setAttributeIfNotExists(ht,"role","presentation"),Te||Y.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(Y,"role","tab"),this._setInitialAttributesOnTargetPanel(Y)}_setInitialAttributesOnTargetPanel(Y){const Te=me.getElementFromSelector(Y);Te&&(this._setAttributeIfNotExists(Te,"role","tabpanel"),Y.id&&this._setAttributeIfNotExists(Te,"aria-labelledby",`${Y.id}`))}_toggleDropDown(Y,Te){const ht=this._getOuterElement(Y);if(!ht.classList.contains("dropdown"))return;const Ht=(di,Ti)=>{const _n=me.findOne(di,ht);_n&&_n.classList.toggle(Ti,Te)};Ht(Ou,Ia),Ht(".dropdown-menu",Fu),ht.setAttribute("aria-expanded",Te)}_setAttributeIfNotExists(Y,Te,ht){Y.hasAttribute(Te)||Y.setAttribute(Te,ht)}_elemIsActive(Y){return Y.classList.contains(Ia)}_getInnerElement(Y){return Y.matches(af)?Y:me.findOne(af,Y)}_getOuterElement(Y){return Y.closest(".nav-item, .list-group-item")||Y}static jQueryInterface(Y){return this.each(function(){const Te=rc.getOrCreateInstance(this);if(typeof Y=="string"){if(Te[Y]===void 0||Y.startsWith("_")||Y==="constructor")throw new TypeError(`No method named "${Y}"`);Te[Y]()}})}}De.on(document,S_,Wh,function(ut){["A","AREA"].includes(this.tagName)&&ut.preventDefault(),S(this)||rc.getOrCreateInstance(this).show()}),De.on(window,Lu,()=>{for(const ut of me.find(Hp))rc.getOrCreateInstance(ut)}),U(rc);const bl=".bs.toast",Zp=`mouseover${bl}`,T_=`mouseout${bl}`,Sn=`focusin${bl}`,Hh=`focusout${bl}`,Zh=`hide${bl}`,Xh=`hidden${bl}`,lf=`show${bl}`,sc=`shown${bl}`,Nc="hide",La="show",Vs="showing",Xp={animation:"boolean",autohide:"boolean",delay:"number"},Yp={animation:!0,autohide:!0,delay:5e3};class oc extends xt{constructor(Y,Te){super(Y,Te),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return Yp}static get DefaultType(){return Xp}static get NAME(){return"toast"}show(){De.trigger(this._element,lf).defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove(Nc),E(this._element),this._element.classList.add(La,Vs),this._queueCallback(()=>{this._element.classList.remove(Vs),De.trigger(this._element,sc),this._maybeScheduleHide()},this._element,this._config.animation))}hide(){this.isShown()&&(De.trigger(this._element,Zh).defaultPrevented||(this._element.classList.add(Vs),this._queueCallback(()=>{this._element.classList.add(Nc),this._element.classList.remove(Vs,La),De.trigger(this._element,Xh)},this._element,this._config.animation)))}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(La),super.dispose()}isShown(){return this._element.classList.contains(La)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(Y,Te){switch(Y.type){case"mouseover":case"mouseout":this._hasMouseInteraction=Te;break;case"focusin":case"focusout":this._hasKeyboardInteraction=Te}if(Te)return void this._clearTimeout();const ht=Y.relatedTarget;this._element===ht||this._element.contains(ht)||this._maybeScheduleHide()}_setListeners(){De.on(this._element,Zp,Y=>this._onInteraction(Y,!0)),De.on(this._element,T_,Y=>this._onInteraction(Y,!1)),De.on(this._element,Sn,Y=>this._onInteraction(Y,!0)),De.on(this._element,Hh,Y=>this._onInteraction(Y,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(Y){return this.each(function(){const Te=oc.getOrCreateInstance(this,Y);if(typeof Y=="string"){if(Te[Y]===void 0)throw new TypeError(`No method named "${Y}"`);Te[Y](this)}})}}return qe(oc),U(oc),{Alert:Ae,Button:vt,Carousel:Xe,Collapse:Ni,Dropdown:so,Modal:ml,Offcanvas:vr,Popover:Aa,ScrollSpy:zc,Tab:rc,Toast:oc,Tooltip:Uo}})})(Fx)),Fx.exports}IV();var Ga=63710088e-1,HD={centimeters:Ga*100,centimetres:Ga*100,degrees:360/(2*Math.PI),feet:Ga*3.28084,inches:Ga*39.37,kilometers:Ga/1e3,kilometres:Ga/1e3,meters:Ga,metres:Ga,miles:Ga/1609.344,millimeters:Ga*1e3,millimetres:Ga*1e3,nauticalmiles:Ga/1852,radians:1,yards:Ga*1.0936};function Ug(n,e,t={}){const i={type:"Feature"};return(t.id===0||t.id)&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.properties=e||{},i.geometry=n,i}function Yf(n,e,t={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!KP(n[0])||!KP(n[1]))throw new Error("coordinates must contain numbers");return Ug({type:"Point",coordinates:n},e,t)}function RV(n,e,t={}){for(const r of n){if(r.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(r[r.length-1].length!==r[0].length)throw new Error("First and last Position are not equivalent.");for(let o=0;o<r[r.length-1].length;o++)if(r[r.length-1][o]!==r[0][o])throw new Error("First and last Position are not equivalent.")}return Ug({type:"Polygon",coordinates:n},e,t)}function YP(n,e,t={}){if(n.length<2)throw new Error("coordinates must be an array of two or more positions");return Ug({type:"LineString",coordinates:n},e,t)}function LV(n,e="kilometers"){const t=HD[e];if(!t)throw new Error(e+" units is invalid");return n*t}function kV(n,e="kilometers"){const t=HD[e];if(!t)throw new Error(e+" units is invalid");return n/t}function nw(n){return n%(2*Math.PI)*180/Math.PI}function fh(n){return n%360*Math.PI/180}function KP(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function Tg(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function DV(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function VS(n,e,t={}){var i=Tg(n),r=Tg(e),o=fh(r[1]-i[1]),c=fh(r[0]-i[0]),s=fh(i[1]),d=fh(r[1]),p=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(c/2),2)*Math.cos(s)*Math.cos(d);return LV(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),t.units)}function ZD(n,e,t){if(n!==null)for(var i,r,o,c,s,d,p,g=0,_=0,x,b=n.type,S=b==="FeatureCollection",P=b==="Feature",L=S?n.features.length:1,E=0;E<L;E++){p=S?n.features[E].geometry:P?n.geometry:n,x=p?p.type==="GeometryCollection":!1,s=x?p.geometries.length:1;for(var C=0;C<s;C++){var D=0,O=0;if(c=x?p.geometries[C]:p,c!==null){d=c.coordinates;var U=c.type;switch(g=0,U){case null:break;case"Point":if(e(d,_,E,D,O)===!1)return!1;_++,D++;break;case"LineString":case"MultiPoint":for(i=0;i<d.length;i++){if(e(d[i],_,E,D,O)===!1)return!1;_++,U==="MultiPoint"&&D++}U==="LineString"&&D++;break;case"Polygon":case"MultiLineString":for(i=0;i<d.length;i++){for(r=0;r<d[i].length-g;r++){if(e(d[i][r],_,E,D,O)===!1)return!1;_++}U==="MultiLineString"&&D++,U==="Polygon"&&O++}U==="Polygon"&&D++;break;case"MultiPolygon":for(i=0;i<d.length;i++){for(O=0,r=0;r<d[i].length;r++){for(o=0;o<d[i][r].length-g;o++){if(e(d[i][r][o],_,E,D,O)===!1)return!1;_++}O++}D++}break;case"GeometryCollection":for(i=0;i<c.geometries.length;i++)if(ZD(c.geometries[i],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function FV(n,e){var t,i,r,o,c,s,d,p,g,_,x=0,b=n.type==="FeatureCollection",S=n.type==="Feature",P=b?n.features.length:1;for(t=0;t<P;t++){for(s=b?n.features[t].geometry:S?n.geometry:n,p=b?n.features[t].properties:S?n.properties:{},g=b?n.features[t].bbox:S?n.bbox:void 0,_=b?n.features[t].id:S?n.id:void 0,d=s?s.type==="GeometryCollection":!1,c=d?s.geometries.length:1,r=0;r<c;r++){if(o=d?s.geometries[r]:s,o===null){if(e(null,x,p,g,_)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,x,p,g,_)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<o.geometries.length;i++)if(e(o.geometries[i],x,p,g,_)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}x++}}function OV(n,e){FV(n,function(t,i,r,o,c){var s=t===null?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(Ug(t,r,{bbox:o,id:c}),i,0)===!1?!1:void 0}var d;switch(s){case"MultiPoint":d="Point";break;case"MultiLineString":d="LineString";break;case"MultiPolygon":d="Polygon";break}for(var p=0;p<t.coordinates.length;p++){var g=t.coordinates[p],_={type:d,coordinates:g};if(e(Ug(_,r),i,p)===!1)return!1}})}var zV=Object.defineProperty,BV=Object.defineProperties,NV=Object.getOwnPropertyDescriptors,JP=Object.getOwnPropertySymbols,$V=Object.prototype.hasOwnProperty,VV=Object.prototype.propertyIsEnumerable,QP=(n,e,t)=>e in n?zV(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,eI=(n,e)=>{for(var t in e||(e={}))$V.call(e,t)&&QP(n,t,e[t]);if(JP)for(var t of JP(e))VV.call(e,t)&&QP(n,t,e[t]);return n},tI=(n,e)=>BV(n,NV(e));function UV(n,e,t={}){if(!n||!e)throw new Error("lines and pt are required arguments");const i=Tg(e);let r=Yf([1/0,1/0],{dist:1/0,index:-1,multiFeatureIndex:-1,location:-1}),o=0;return OV(n,function(c,s,d){const p=DV(c);for(let g=0;g<p.length-1;g++){const _=Yf(p[g]),x=Tg(_),b=Yf(p[g+1]),S=Tg(b),P=VS(_,b,t);let L,E;S[0]===i[0]&&S[1]===i[1]?[L,E]=[S,!0]:x[0]===i[0]&&x[1]===i[1]?[L,E]=[x,!1]:[L,E]=qV(x,S,i);const C=Yf(L,{dist:VS(e,L,t),multiFeatureIndex:d,location:o+VS(_,L,t)});C.properties.dist<r.properties.dist&&(r=tI(eI({},C),{properties:tI(eI({},C.properties),{index:E?g+1:g})})),o+=P}}),r}function $f(n,e){const[t,i,r]=n,[o,c,s]=e;return t*o+i*c+r*s}function gv(n,e){const[t,i,r]=n,[o,c,s]=e;return[i*s-r*c,r*o-t*s,t*c-i*o]}function jV(n){return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2))}function iI(n){const e=jV(n);return[n[0]/e,n[1]/e,n[2]/e]}function US(n){const e=fh(n[1]),t=fh(n[0]);return[Math.cos(e)*Math.cos(t),Math.cos(e)*Math.sin(t),Math.sin(e)]}function GV(n){const[e,t,i]=n,r=Math.min(Math.max(i,-1),1),o=nw(Math.asin(r));return[nw(Math.atan2(t,e)),o]}function qV(n,e,t){const i=US(n),r=US(e),o=US(t),c=gv(i,r);if(c[0]===0&&c[1]===0&&c[2]===0)return $f(i,r)>0?[[...e],!0]:[[...t],!1];const s=gv(c,o);if(s[0]===0&&s[1]===0&&s[2]===0)return[[...e],!0];const d=gv(s,c),p=iI(d),g=[-p[0],-p[1],-p[2]],_=$f(o,p)>$f(o,g)?p:g,x=iI(c),b=$f(gv(i,_),x),S=$f(gv(_,r),x);return b>=0&&S>=0?[GV(_),!1]:$f(i,o)>$f(r,o)?[[...n],!1]:[[...e],!0]}var WV=UV;const HV=["==",["geometry-type"],"Polygon"],ZV=["==",["geometry-type"],"LineString"],XV=["==",["geometry-type"],"Point"];function XD(){return{type:"FeatureCollection",features:[]}}function jS(n){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:YD(n)}}}function YD(n){return[Math.round(n[0]*1e7)/1e7,Math.round(n[1]*1e7)/1e7]}const KD=ql(XD()),JD=ql(0),YV=100;class KV{map;active;eventListenersSuccess;eventListenersUpdated;eventListenersFailure;points;cursor;hover;dragFrom;previousStates;constructor(e){this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove=e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,i=this.dragFrom[1]-e.lngLat.lat;for(let r of this.points)r[0]-=t,r[1]-=i}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}};onClick=e=>{if(this.beforeUpdate(),this.active&&this.cursor){let t=[];if(nI(this.points).forEach((i,r)=>{t.push([r+1,WV(i,this.cursor).properties.dist])}),t.sort((i,r)=>i[1]-r[1]),t.length>0){let i=t[0][0];this.points.splice(i,0,this.cursor.geometry.coordinates),this.hover=i}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))};onDoubleClick=e=>{this.active&&(e.preventDefault(),this.cursor=jS(e.lngLat.toArray()),this.onClick(e),this.finish())};onMouseDown=e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())};onMouseUp=()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())};onKeypress=e=>{if(!this.active)return;let t=e.target.tagName;t=="INPUT"||t=="TEXTAREA"||(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())};onKeyDown=e=>{if(!this.active)return;let t=e.target.tagName;t=="INPUT"||t=="TEXTAREA"||e.key=="Escape"&&(e.stopPropagation(),this.cancel())};addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=XD();this.points.forEach((r,o)=>{let c=jS(r);c.properties.hover=this.hover==o,c.properties.idx=o,e.features.push(c)}),e.features=e.features.concat(nI(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),KD.set(e);let i="crosshair";this.hover!=null&&(i=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=i,JD.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersUpdated)t(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=jS(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(YD),t=[JSON.parse(JSON.stringify(e))];return t[0].push(JSON.parse(JSON.stringify(t[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:t},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>YV&&this.previousStates.shift()}}function nI(n){let e=[];for(let t=0;t<n.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[n[t],n[t+1]]},properties:{}});return n.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[n[n.length-1],n[0]]},properties:{}}),e}var JV=qt('<div style="display: flex; justify-content: space-between;"><button>Finish</button> <button>Cancel</button> <button><!></button></div> <ul><li><b>Click</b> the map to add a vertex</li> <li><b>Click</b> a vertex to delete it</li> <li><b>Drag</b> a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b> to undo your last change</li> <li>Press <b>Enter</b> or <b>double click</b> to finish</li> <li>Press <b>Escape</b> to cancel</li></ul>',1);function QV(n,e){Qi(e,!0);const t=()=>nn(JD,"$undoLength",i),[i,r]=is();var o=JV(),c=ci(o),s=zt(c);s.__click=()=>e.polygonTool.finish();var d=_t(s,2);d.__click=()=>e.polygonTool.cancel();var p=_t(d,2);p.__click=()=>e.polygonTool.undo();var g=zt(p);{var _=b=>{var S=Nn("Undo");bt(b,S)},x=b=>{var S=Nn();Zi(()=>sn(S,`Undo (${t()??""})`)),bt(b,S)};Ji(g,b=>{t()==0?b(_):b(x,!1)})}Zi(()=>p.disabled=t()==0),bt(n,o),en(),r()}ds(["click"]);$5();var e8=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],t8=["difference","intersection","symmetricDifference","union"],rI=!1;class rw extends Set{#t=new Map;#e=ii(0);#i=ii(0);#n=xc||-1;constructor(e){if(super(),e){for(var t of e)super.add(t);this.#i.v=super.size}rI||this.#r()}#s(e){return xc===this.#n?ii(e):wh(e)}#r(){rI=!0;var e=rw.prototype,t=Set.prototype;for(const i of e8)e[i]=function(...r){return te(this.#e),t[i].apply(this,r)};for(const i of t8)e[i]=function(...r){te(this.#e);var o=t[i].apply(this,r);return new rw(o)}}has(e){var t=super.has(e),i=this.#t,r=i.get(e);if(r===void 0){if(!t)return te(this.#e),!1;r=this.#s(!0),i.set(e,r)}return te(r),t}add(e){return super.has(e)||(super.add(e),Ct(this.#i,super.size),Ja(this.#e)),this}delete(e){var t=super.delete(e),i=this.#t,r=i.get(e);return r!==void 0&&(i.delete(e),Ct(r,!1)),t&&(Ct(this.#i,super.size),Ja(this.#e)),t}clear(){if(super.size!==0){super.clear();var e=this.#t;for(var t of e.values())Ct(t,!1);e.clear(),Ct(this.#i,0),Ja(this.#e)}}keys(){return this.values()}values(){return te(this.#e),super.values()}entries(){return te(this.#e),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return te(this.#i)}}class i8 extends Map{#t=new Map;#e=ii(0);#i=ii(0);#n=xc||-1;constructor(e){if(super(),e){for(var[t,i]of e)super.set(t,i);this.#i.v=super.size}}#s(e){return xc===this.#n?ii(e):wh(e)}has(e){var t=this.#t,i=t.get(e);if(i===void 0){var r=super.get(e);if(r!==void 0)i=this.#s(0),t.set(e,i);else return te(this.#e),!1}return te(i),!0}forEach(e,t){this.#r(),super.forEach(e,t)}get(e){var t=this.#t,i=t.get(e);if(i===void 0){var r=super.get(e);if(r!==void 0)i=this.#s(0),t.set(e,i);else{te(this.#e);return}}return te(i),super.get(e)}set(e,t){var i=this.#t,r=i.get(e),o=super.get(e),c=super.set(e,t),s=this.#e;if(r===void 0)r=this.#s(0),i.set(e,r),Ct(this.#i,super.size),Ja(s);else if(o!==t){Ja(r);var d=s.reactions===null?null:new Set(s.reactions),p=d===null||!r.reactions?.every(g=>d.has(g));p&&Ja(s)}return c}delete(e){var t=this.#t,i=t.get(e),r=super.delete(e);return i!==void 0&&(t.delete(e),Ct(this.#i,super.size),Ct(i,-1),Ja(this.#e)),r}clear(){if(super.size!==0){super.clear();var e=this.#t;Ct(this.#i,0);for(var t of e.values())Ct(t,-1);Ja(this.#e),e.clear()}}#r(){te(this.#e);var e=this.#t;if(this.#i.v!==e.size){for(var t of super.keys())if(!e.has(t)){var i=this.#s(0);e.set(t,i)}}for([,i]of this.#t)te(i)}keys(){return te(this.#e),super.keys()}values(){return this.#r(),super.values()}entries(){return this.#r(),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return te(this.#i),super.size}}let n8=Date.now();function wp(n){return`${n}-${n8++}`}class My{#t=ii();get value(){return te(this.#t)}set value(e){Ct(this.#t,e,!0)}constructor(e){this.value=e}}class r8{#t=ii();get map(){return te(this.#t)}set map(e){Ct(this.#t,e,!0)}#e=ii(!1);get loaded(){return te(this.#e)}set loaded(e){Ct(this.#e,e,!0)}loadedImages=new rw;#i=ii(0);get minzoom(){return te(this.#i)}set minzoom(e){Ct(this.#i,e,!0)}#n=ii(24);get maxzoom(){return te(this.#n)}set maxzoom(e){Ct(this.#n,e,!0)}layerInfo=new Map;eventTracker=new WeakMap;_eventTopMost(e){let t=this.eventTracker.get(e.originalEvent);if(t!==void 0)return t;let r=e.target.queryRenderedFeatures(e.point).find(o=>this.layerInfo.get(o.layer.id)?.interactive)?.layer.id;return this.eventTracker.set(e.originalEvent,r),r}eventTopMost;markerClickManager=new y8;constructor(){this.eventTopMost=this._eventTopMost.bind(this)}}function s8(n){r_(iF,n)}function o8(){return n_(iF)}function a8(n){r_(nF,n)}function l8(){return n_(nF)}function c8(n){r_(tF,n)}function u8(){return n_(tF)}function h8(n){r_(p8,n)}function d8(){return n_(rF)}function QD(n){r_(rF,n)}function f8(){return n_(m8)}const eF=Symbol.for("svelte-maplibre"),tF=Symbol.for("svelte-maplibre.popup-target"),iF=Symbol.for("svelte-maplibre.layer"),nF=Symbol.for("svelte-maplibre.source"),p8=Symbol.for("svelte-maplibre.cluster"),rF=Symbol.for("svelte-maplibre.layer-event"),m8=Symbol.for("svelte-maplibre.lng-lat");function Ec(){return n_(eF)}function g8(){return r_(eF,new r8)}function sF(){const n=new My(void 0),e=new My(void 0);return a8(n),h8(e),{source:n,cluster:e}}function _8(n=!0){const e=new My(void 0),t=new My(void 0);return s8(e),n&&(c8(e),QD(t)),{layer:e,layerEvent:t}}function v8(n){return"layerType"in n&&n.layerType==="deckgl"}class y8{_handlers=new Set;add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const t of this._handlers)t(e)}}var zx={exports:{}};var b8=zx.exports,sI;function x8(){return sI||(sI=1,(function(n,e){(function(t,i){n.exports=i()})(b8,(function(){var t={},i={};function r(c,s,d){if(i[c]=d,c==="index"){var p="var sharedModule = {}; ("+i.shared+")(sharedModule); ("+i.worker+")(sharedModule);",g={};return i.shared(g),i.index(t,g),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([p],{type:"text/javascript"}))),t}}r("shared",["exports"],(function(c){function s(h,a,u,m){return new(u||(u=Promise))((function(y,T){function M($){try{F(m.next($))}catch(H){T(H)}}function R($){try{F(m.throw($))}catch(H){T(H)}}function F($){var H;$.done?y($.value):(H=$.value,H instanceof u?H:new u((function(K){K(H)}))).then(M,R)}F((m=m.apply(h,a||[])).next())}))}function d(h,a){this.x=h,this.y=a}function p(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var g,_;typeof SuppressedError=="function"&&SuppressedError,d.prototype={clone(){return new d(this.x,this.y)},add(h){return this.clone()._add(h)},sub(h){return this.clone()._sub(h)},multByPoint(h){return this.clone()._multByPoint(h)},divByPoint(h){return this.clone()._divByPoint(h)},mult(h){return this.clone()._mult(h)},div(h){return this.clone()._div(h)},rotate(h){return this.clone()._rotate(h)},rotateAround(h,a){return this.clone()._rotateAround(h,a)},matMult(h){return this.clone()._matMult(h)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(h){return this.x===h.x&&this.y===h.y},dist(h){return Math.sqrt(this.distSqr(h))},distSqr(h){const a=h.x-this.x,u=h.y-this.y;return a*a+u*u},angle(){return Math.atan2(this.y,this.x)},angleTo(h){return Math.atan2(this.y-h.y,this.x-h.x)},angleWith(h){return this.angleWithSep(h.x,h.y)},angleWithSep(h,a){return Math.atan2(this.x*a-this.y*h,this.x*h+this.y*a)},_matMult(h){const a=h[2]*this.x+h[3]*this.y;return this.x=h[0]*this.x+h[1]*this.y,this.y=a,this},_add(h){return this.x+=h.x,this.y+=h.y,this},_sub(h){return this.x-=h.x,this.y-=h.y,this},_mult(h){return this.x*=h,this.y*=h,this},_div(h){return this.x/=h,this.y/=h,this},_multByPoint(h){return this.x*=h.x,this.y*=h.y,this},_divByPoint(h){return this.x/=h.x,this.y/=h.y,this},_unit(){return this._div(this.mag()),this},_perp(){const h=this.y;return this.y=this.x,this.x=-h,this},_rotate(h){const a=Math.cos(h),u=Math.sin(h),m=u*this.x+a*this.y;return this.x=a*this.x-u*this.y,this.y=m,this},_rotateAround(h,a){const u=Math.cos(h),m=Math.sin(h),y=a.y+m*(this.x-a.x)+u*(this.y-a.y);return this.x=a.x+u*(this.x-a.x)-m*(this.y-a.y),this.y=y,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:d},d.convert=function(h){if(h instanceof d)return h;if(Array.isArray(h))return new d(+h[0],+h[1]);if(h.x!==void 0&&h.y!==void 0)return new d(+h.x,+h.y);throw new Error("Expected [x, y] or {x, y} point format")};var x=(function(){if(_)return g;function h(a,u,m,y){this.cx=3*a,this.bx=3*(m-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(y-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=u,this.p2x=m,this.p2y=y}return _=1,g=h,h.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,u){if(u===void 0&&(u=1e-6),a<0)return 0;if(a>1)return 1;for(var m=a,y=0;y<8;y++){var T=this.sampleCurveX(m)-a;if(Math.abs(T)<u)return m;var M=this.sampleCurveDerivativeX(m);if(Math.abs(M)<1e-6)break;m-=T/M}var R=0,F=1;for(m=a,y=0;y<20&&(T=this.sampleCurveX(m),!(Math.abs(T-a)<u));y++)a>T?R=m:F=m,m=.5*(F-R)+R;return m},solve:function(a,u){return this.sampleCurveY(this.solveCurveX(a,u))}},g})(),b=p(x);let S,P;function L(){return S==null&&(S=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),S}function E(){if(P==null&&(P=!1,L())){const a=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(a){for(let m=0;m<25;m++){const y=4*m;a.fillStyle=`rgb(${y},${y+1},${y+2})`,a.fillRect(m%5,Math.floor(m/5),1,1)}const u=a.getImageData(0,0,5,5).data;for(let m=0;m<100;m++)if(m%4!=3&&u[m]!==m){P=!0;break}}}return P||!1}var C=1e-6,D=typeof Float32Array<"u"?Float32Array:Array;function O(){var h=new D(9);return D!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[5]=0,h[6]=0,h[7]=0),h[0]=1,h[4]=1,h[8]=1,h}function U(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=1,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=1,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h}function q(){var h=new D(3);return D!=Float32Array&&(h[0]=0,h[1]=0,h[2]=0),h}function G(h){var a=h[0],u=h[1],m=h[2];return Math.sqrt(a*a+u*u+m*m)}function N(h,a,u){var m=new D(3);return m[0]=h,m[1]=a,m[2]=u,m}function V(h,a,u){return h[0]=a[0]+u[0],h[1]=a[1]+u[1],h[2]=a[2]+u[2],h}function j(h,a,u){return h[0]=a[0]*u,h[1]=a[1]*u,h[2]=a[2]*u,h}function z(h,a,u){var m=a[0],y=a[1],T=a[2],M=u[0],R=u[1],F=u[2];return h[0]=y*F-T*R,h[1]=T*M-m*F,h[2]=m*R-y*M,h}var Q,X=G;function re(h,a,u){var m=a[0],y=a[1],T=a[2],M=a[3];return h[0]=u[0]*m+u[4]*y+u[8]*T+u[12]*M,h[1]=u[1]*m+u[5]*y+u[9]*T+u[13]*M,h[2]=u[2]*m+u[6]*y+u[10]*T+u[14]*M,h[3]=u[3]*m+u[7]*y+u[11]*T+u[15]*M,h}function se(){var h=new D(4);return D!=Float32Array&&(h[0]=0,h[1]=0,h[2]=0),h[3]=1,h}function le(h,a,u,m){var y=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",T=Math.PI/360;a*=T,m*=T,u*=T;var M=Math.sin(a),R=Math.cos(a),F=Math.sin(u),$=Math.cos(u),H=Math.sin(m),K=Math.cos(m);switch(y){case"xyz":h[0]=M*$*K+R*F*H,h[1]=R*F*K-M*$*H,h[2]=R*$*H+M*F*K,h[3]=R*$*K-M*F*H;break;case"xzy":h[0]=M*$*K-R*F*H,h[1]=R*F*K-M*$*H,h[2]=R*$*H+M*F*K,h[3]=R*$*K+M*F*H;break;case"yxz":h[0]=M*$*K+R*F*H,h[1]=R*F*K-M*$*H,h[2]=R*$*H-M*F*K,h[3]=R*$*K+M*F*H;break;case"yzx":h[0]=M*$*K+R*F*H,h[1]=R*F*K+M*$*H,h[2]=R*$*H-M*F*K,h[3]=R*$*K-M*F*H;break;case"zxy":h[0]=M*$*K-R*F*H,h[1]=R*F*K+M*$*H,h[2]=R*$*H+M*F*K,h[3]=R*$*K-M*F*H;break;case"zyx":h[0]=M*$*K-R*F*H,h[1]=R*F*K+M*$*H,h[2]=R*$*H-M*F*K,h[3]=R*$*K+M*F*H;break;default:throw new Error("Unknown angle order "+y)}return h}function ce(){var h=new D(2);return D!=Float32Array&&(h[0]=0,h[1]=0),h}function be(h,a){var u=new D(2);return u[0]=h,u[1]=a,u}q(),Q=new D(4),D!=Float32Array&&(Q[0]=0,Q[1]=0,Q[2]=0,Q[3]=0),q(),N(1,0,0),N(0,1,0),se(),se(),O(),ce();const Ee=8192;function $e(h,a,u){return a*(Ee/(h.tileSize*Math.pow(2,u-h.tileID.overscaledZ)))}function Ve(h,a){return(h%a+a)%a}function nt(h,a,u){return h*(1-u)+a*u}function He(h){if(h<=0)return 0;if(h>=1)return 1;const a=h*h,u=a*h;return 4*(h<.5?u:3*(h-a)+u-.75)}function De(h,a,u,m){const y=new b(h,a,u,m);return T=>y.solve(T)}const ot=De(.25,.1,.25,1);function xe(h,a,u){return Math.min(u,Math.max(a,h))}function Be(h,a,u){const m=u-a,y=((h-a)%m+m)%m+a;return y===a?u:y}function Je(h,...a){for(const u of a)for(const m in u)h[m]=u[m];return h}let ct=1;function xt(h,a,u){const m={};for(const y in h)m[y]=a.call(this,h[y],y,h);return m}function Se(h,a,u){const m={};for(const y in h)a.call(this,h[y],y,h)&&(m[y]=h[y]);return m}function me(h){return Array.isArray(h)?h.map(me):typeof h=="object"&&h?xt(h,me):h}const qe={};function st(h){qe[h]||(typeof console<"u"&&console.warn(h),qe[h]=!0)}function Rt(h,a,u){return(u.y-h.y)*(a.x-h.x)>(a.y-h.y)*(u.x-h.x)}function gt(h){return typeof WorkerGlobalScope<"u"&&h!==void 0&&h instanceof WorkerGlobalScope}let Ae=null;function we(h){return typeof ImageBitmap<"u"&&h instanceof ImageBitmap}const vt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ye(h,a,u,m,y){return s(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const T=new VideoFrame(h,{timestamp:0});try{const M=T?.format;if(!M||!M.startsWith("BGR")&&!M.startsWith("RGB"))throw new Error(`Unrecognized format ${M}`);const R=M.startsWith("BGR"),F=new Uint8ClampedArray(m*y*4);if(yield T.copyTo(F,(function($,H,K,ne,oe){const fe=4*Math.max(-H,0),ge=(Math.max(0,K)-K)*ne*4+fe,ve=4*ne,Pe=Math.max(0,H),Ge=Math.max(0,K);return{rect:{x:Pe,y:Ge,width:Math.min($.width,H+ne)-Pe,height:Math.min($.height,K+oe)-Ge},layout:[{offset:ge,stride:ve}]}})(h,a,u,m,y)),R)for(let $=0;$<F.length;$+=4){const H=F[$];F[$]=F[$+2],F[$+2]=H}return F}finally{T.close()}}))}let ie,ae;function ke(h,a,u,m){return h.addEventListener(a,u,m),{unsubscribe:()=>{h.removeEventListener(a,u,m)}}}function Ze(h){return h*Math.PI/180}function yt(h){return h/Math.PI*180}const Me={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},ee={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},de="AbortError";class pe extends Error{constructor(a=de){super(a instanceof Error?a.message:a),this.name=de,a instanceof Error&&a.stack&&(this.stack=a.stack)}}function Le(h){return h.name===de}const Oe={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function dt(h){return Oe.REGISTERED_PROTOCOLS[h.substring(0,h.indexOf("://"))]}const pt="global-dispatcher";class rt extends Error{constructor(a,u,m,y){super(`AJAXError: ${u} (${a}): ${m}`),this.status=a,this.statusText=u,this.url=m,this.body=y}}const St=()=>gt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Dt=function(h,a){if(/:\/\//.test(h.url)&&!/^https?:|^file:/.test(h.url)){const m=dt(h.url);if(m)return m(h,a);if(gt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:h,targetMapId:pt},a)}if(!(/^file:/.test(u=h.url)||/^file:/.test(St())&&!/^\w+:/.test(u))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(m,y){return s(this,void 0,void 0,(function*(){const T=new Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,cache:m.cache,referrer:St(),signal:y.signal});let M,R;m.type!=="json"||T.headers.has("Accept")||T.headers.set("Accept","application/json");try{M=yield fetch(T)}catch($){throw Le($)?$:new rt(0,$.message,m.url,new Blob)}if(!M.ok){const $=yield M.blob();throw new rt(M.status,M.statusText,m.url,$)}R=m.type==="arrayBuffer"||m.type==="image"?M.arrayBuffer():m.type==="json"?M.json():M.text();const F=yield R;return y.signal.throwIfAborted(),{data:F,cacheControl:M.headers.get("Cache-Control"),expires:M.headers.get("Expires")}}))})(h,a);if(gt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:h,mustQueue:!0,targetMapId:pt},a)}var u;return(function(m,y){return new Promise(((T,M)=>{var R;const F=new XMLHttpRequest;F.open(m.method||"GET",m.url,!0),m.type!=="arrayBuffer"&&m.type!=="image"||(F.responseType="arraybuffer");for(const $ in m.headers)F.setRequestHeader($,m.headers[$]);m.type==="json"&&(F.responseType="text",!((R=m.headers)===null||R===void 0)&&R.Accept||F.setRequestHeader("Accept","application/json")),F.withCredentials=m.credentials==="include",F.onerror=()=>{M(new Error(F.statusText))},F.onload=()=>{if(!y.signal.aborted)if((F.status>=200&&F.status<300||F.status===0)&&F.response!==null){let $=F.response;if(m.type==="json")try{$=JSON.parse(F.response)}catch(H){return void M(H)}T({data:$,cacheControl:F.getResponseHeader("Cache-Control"),expires:F.getResponseHeader("Expires")})}else{const $=new Blob([F.response],{type:F.getResponseHeader("Content-Type")});M(new rt(F.status,F.statusText,m.url,$))}},y.signal.addEventListener("abort",(()=>{F.abort(),M(new pe(y.signal.reason))})),F.send(m.body)}))})(h,a)};function Bt(h){if(!h||h.indexOf("://")<=0||h.indexOf("data:image/")===0||h.indexOf("blob:")===0)return!0;const a=new URL(h),u=window.location;return a.protocol===u.protocol&&a.host===u.host}function Jt(h,a,u){u[h]&&u[h].indexOf(a)!==-1||(u[h]=u[h]||[],u[h].push(a))}function vi(h,a,u){if(u&&u[h]){const m=u[h].indexOf(a);m!==-1&&u[h].splice(m,1)}}class $i{constructor(a,u={}){Je(this,u),this.type=a}}class vn extends $i{constructor(a,u={}){super("error",Je({error:a},u))}}class on{on(a,u){return this._listeners=this._listeners||{},Jt(a,u,this._listeners),{unsubscribe:()=>{this.off(a,u)}}}off(a,u){return vi(a,u,this._listeners),vi(a,u,this._oneTimeListeners),this}once(a,u){return u?(this._oneTimeListeners=this._oneTimeListeners||{},Jt(a,u,this._oneTimeListeners),this):new Promise((m=>this.once(a,m)))}fire(a,u){typeof a=="string"&&(a=new $i(a,u||{}));const m=a.type;if(this.listens(m)){a.target=this;const y=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const R of y)R.call(this,a);const T=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const R of T)vi(m,R,this._oneTimeListeners),R.call(this,a);const M=this._eventedParent;M&&(Je(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),M.fire(a))}else a instanceof vn&&console.error(a.error);return this}listens(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)}setEventedParent(a,u){return this._eventedParent=a,this._eventedParentData=u,this}}var Tt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};const gn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Er(h,a){const u={};for(const m in h)m!=="ref"&&(u[m]=h[m]);return gn.forEach((m=>{m in a&&(u[m]=a[m])})),u}function Di(h,a){if(Array.isArray(h)){if(!Array.isArray(a)||h.length!==a.length)return!1;for(let u=0;u<h.length;u++)if(!Di(h[u],a[u]))return!1;return!0}if(typeof h=="object"&&h!==null&&a!==null){if(typeof a!="object"||Object.keys(h).length!==Object.keys(a).length)return!1;for(const u in h)if(!Di(h[u],a[u]))return!1;return!0}return h===a}function yn(h,a){h.push(a)}function Yn(h,a,u){yn(u,{command:"addSource",args:[h,a[h]]})}function Cn(h,a,u){yn(a,{command:"removeSource",args:[h]}),u[h]=!0}function Un(h,a,u,m){Cn(h,u,m),Yn(h,a,u)}function En(h,a,u){let m;for(m in h[u])if(Object.prototype.hasOwnProperty.call(h[u],m)&&m!=="data"&&!Di(h[u][m],a[u][m]))return!1;for(m in a[u])if(Object.prototype.hasOwnProperty.call(a[u],m)&&m!=="data"&&!Di(h[u][m],a[u][m]))return!1;return!0}function dr(h,a,u,m,y,T){h=h||{},a=a||{};for(const M in h)Object.prototype.hasOwnProperty.call(h,M)&&(Di(h[M],a[M])||u.push({command:T,args:[m,M,a[M],y]}));for(const M in a)Object.prototype.hasOwnProperty.call(a,M)&&!Object.prototype.hasOwnProperty.call(h,M)&&(Di(h[M],a[M])||u.push({command:T,args:[m,M,a[M],y]}))}function Xe(h){return h.id}function kt(h,a){return h[a.id]=a,h}class lt{constructor(a,u,m,y){this.message=(a?`${a}: `:"")+m,y&&(this.identifier=y),u!=null&&u.__line__&&(this.line=u.__line__)}}function Ft(h,...a){for(const u of a)for(const m in u)h[m]=u[m];return h}class Wt extends Error{constructor(a,u){super(u),this.message=u,this.key=a}}class qi{constructor(a,u=[]){this.parent=a,this.bindings={};for(const[m,y]of u)this.bindings[m]=y}concat(a){return new qi(this,a)}get(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(`${a} not found in scope.`)}has(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)}}const Ii={kind:"null"},Nt={kind:"number"},ai={kind:"string"},pi={kind:"boolean"},Wi={kind:"color"},wt={kind:"projectionDefinition"},Ri={kind:"object"},bi={kind:"value"},Ni={kind:"collator"},Kn={kind:"formatted"},Xi={kind:"padding"},jn={kind:"colorArray"},an={kind:"numberArray"},zr={kind:"resolvedImage"},Gn={kind:"variableAnchorOffsetCollection"};function ln(h,a){return{kind:"array",itemType:h,N:a}}function tn(h){if(h.kind==="array"){const a=tn(h.itemType);return typeof h.N=="number"?`array<${a}, ${h.N}>`:h.itemType.kind==="value"?"array":`array<${a}>`}return h.kind}const ns=[Ii,Nt,ai,pi,Wi,wt,Kn,Ri,ln(bi),Xi,an,jn,zr,Gn];function ro(h,a){if(a.kind==="error")return null;if(h.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!ro(h.itemType,a.itemType))&&(typeof h.N!="number"||h.N===a.N))return null}else{if(h.kind===a.kind)return null;if(h.kind==="value"){for(const u of ns)if(!ro(u,a))return null}}return`Expected ${tn(h)} but found ${tn(a)} instead.`}function dl(h,a){return a.some((u=>u.kind===h.kind))}function xo(h,a){return a.some((u=>u==="null"?h===null:u==="array"?Array.isArray(h):u==="object"?h&&!Array.isArray(h)&&typeof h=="object":u===typeof h))}function Ar(h,a){return h.kind==="array"&&a.kind==="array"?h.itemType.kind===a.itemType.kind&&typeof h.N=="number":h.kind===a.kind}const nr=.96422,Hl=.82521,Zl=4/29,_r=6/29,Pp=3*_r*_r,Ip=_r*_r*_r,Su=Math.PI/180,Rp=180/Math.PI;function Lp(h){return(h%=360)<0&&(h+=360),h}function kp([h,a,u,m]){let y,T;const M=so((.2225045*(h=Fh(h))+.7168786*(a=Fh(a))+.0606169*(u=Fh(u)))/1);h===a&&a===u?y=T=M:(y=so((.4360747*h+.3850649*a+.1430804*u)/nr),T=so((.0139322*h+.0971045*a+.7141733*u)/Hl));const R=116*M-16;return[R<0?0:R,500*(y-M),200*(M-T),m]}function Fh(h){return h<=.04045?h/12.92:Math.pow((h+.055)/1.055,2.4)}function so(h){return h>Ip?Math.pow(h,1/3):h/Pp+Zl}function Oh([h,a,u,m]){let y=(h+16)/116,T=isNaN(a)?y:y+a/500,M=isNaN(u)?y:y-u/200;return y=1*Bh(y),T=nr*Bh(T),M=Hl*Bh(M),[zh(3.1338561*T-1.6168667*y-.4906146*M),zh(-.9787684*T+1.9161415*y+.033454*M),zh(.0719453*T-.2289914*y+1.4052427*M),m]}function zh(h){return(h=h<=.00304?12.92*h:1.055*Math.pow(h,1/2.4)-.055)<0?0:h>1?1:h}function Bh(h){return h>_r?h*h*h:Pp*(h-Zl)}const v_=Object.hasOwn||function(h,a){return Object.prototype.hasOwnProperty.call(h,a)};function Tu(h,a){return v_(h,a)?h[a]:void 0}function Mu(h){return parseInt(h.padEnd(2,h),16)/255}function Cu(h,a){return Ic(a?h/100:h,0,1)}function Ic(h,a,u){return Math.min(Math.max(a,h),u)}function Jd(h){return!h.some(Number.isNaN)}const Rc={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function fl(h,a,u){return h+u*(a-h)}function Lc(h,a,u){return h.map(((m,y)=>fl(m,a[y],u)))}class rn{constructor(a,u,m,y=1,T=!0){this.r=a,this.g=u,this.b=m,this.a=y,T||(this.r*=y,this.g*=y,this.b*=y,y||this.overwriteGetter("rgb",[a,u,m,y]))}static parse(a){if(a instanceof rn)return a;if(typeof a!="string")return;const u=(function(m){if((m=m.toLowerCase().trim())==="transparent")return[0,0,0,0];const y=Tu(Rc,m);if(y){const[M,R,F]=y;return[M/255,R/255,F/255,1]}if(m.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(m)){const M=m.length<6?1:2;let R=1;return[Mu(m.slice(R,R+=M)),Mu(m.slice(R,R+=M)),Mu(m.slice(R,R+=M)),Mu(m.slice(R,R+M)||"ff")]}if(m.startsWith("rgb")){const M=m.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(M){const[R,F,$,H,K,ne,oe,fe,ge,ve,Pe,Ge]=M,Ie=[H||" ",oe||" ",ve].join("");if(Ie==="  "||Ie==="  /"||Ie===",,"||Ie===",,,"){const Re=[$,ne,ge].join(""),Ye=Re==="%%%"?100:Re===""?255:0;if(Ye){const et=[Ic(+F/Ye,0,1),Ic(+K/Ye,0,1),Ic(+fe/Ye,0,1),Pe?Cu(+Pe,Ge):1];if(Jd(et))return et}}return}}const T=m.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(T){const[M,R,F,$,H,K,ne,oe,fe]=T,ge=[F||" ",H||" ",ne].join("");if(ge==="  "||ge==="  /"||ge===",,"||ge===",,,"){const ve=[+R,Ic(+$,0,100),Ic(+K,0,100),oe?Cu(+oe,fe):1];if(Jd(ve))return(function([Pe,Ge,Ie,Re]){function Ye(et){const Mt=(et+Pe/30)%12,Ut=Ge*Math.min(Ie,1-Ie);return Ie-Ut*Math.max(-1,Math.min(Mt-3,9-Mt,1))}return Pe=Lp(Pe),Ge/=100,Ie/=100,[Ye(0),Ye(8),Ye(4),Re]})(ve)}}})(a);return u?new rn(...u,!1):void 0}get rgb(){const{r:a,g:u,b:m,a:y}=this,T=y||1/0;return this.overwriteGetter("rgb",[a/T,u/T,m/T,y])}get hcl(){return this.overwriteGetter("hcl",(function(a){const[u,m,y,T]=kp(a),M=Math.sqrt(m*m+y*y);return[Math.round(1e4*M)?Lp(Math.atan2(y,m)*Rp):NaN,M,u,T]})(this.rgb))}get lab(){return this.overwriteGetter("lab",kp(this.rgb))}overwriteGetter(a,u){return Object.defineProperty(this,a,{value:u}),u}toString(){const[a,u,m,y]=this.rgb;return`rgba(${[a,u,m].map((T=>Math.round(255*T))).join(",")},${y})`}static interpolate(a,u,m,y="rgb"){switch(y){case"rgb":{const[T,M,R,F]=Lc(a.rgb,u.rgb,m);return new rn(T,M,R,F,!1)}case"hcl":{const[T,M,R,F]=a.hcl,[$,H,K,ne]=u.hcl;let oe,fe;if(isNaN(T)||isNaN($))isNaN(T)?isNaN($)?oe=NaN:(oe=$,R!==1&&R!==0||(fe=H)):(oe=T,K!==1&&K!==0||(fe=M));else{let Ie=$-T;$>T&&Ie>180?Ie-=360:$<T&&T-$>180&&(Ie+=360),oe=T+m*Ie}const[ge,ve,Pe,Ge]=(function([Ie,Re,Ye,et]){return Ie=isNaN(Ie)?0:Ie*Su,Oh([Ye,Math.cos(Ie)*Re,Math.sin(Ie)*Re,et])})([oe,fe??fl(M,H,m),fl(R,K,m),fl(F,ne,m)]);return new rn(ge,ve,Pe,Ge,!1)}case"lab":{const[T,M,R,F]=Oh(Lc(a.lab,u.lab,m));return new rn(T,M,R,F,!1)}}}}rn.black=new rn(0,0,0,1),rn.white=new rn(1,1,1,1),rn.transparent=new rn(0,0,0,0),rn.red=new rn(1,0,0,1);class Nh{constructor(a,u,m){this.sensitivity=a?u?"variant":"case":u?"accent":"base",this.locale=m,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(a,u){return this.collator.compare(a,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Dp=["bottom","center","top"];class kc{constructor(a,u,m,y,T,M){this.text=a,this.image=u,this.scale=m,this.fontStack=y,this.textColor=T,this.verticalAlign=M}}class Ns{constructor(a){this.sections=a}static fromString(a){return new Ns([new kc(a,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((a=>a.text.length!==0||a.image&&a.image.name.length!==0))}static factory(a){return a instanceof Ns?a:Ns.fromString(a)}toString(){return this.sections.length===0?"":this.sections.map((a=>a.text)).join("")}}class fs{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof fs)return a;if(typeof a=="number")return new fs([a,a,a,a]);if(Array.isArray(a)&&!(a.length<1||a.length>4)){for(const u of a)if(typeof u!="number")return;switch(a.length){case 1:a=[a[0],a[0],a[0],a[0]];break;case 2:a=[a[0],a[1],a[0],a[1]];break;case 3:a=[a[0],a[1],a[2],a[1]]}return new fs(a)}}toString(){return JSON.stringify(this.values)}static interpolate(a,u,m){return new fs(Lc(a.values,u.values,m))}}class xn{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof xn)return a;if(typeof a=="number")return new xn([a]);if(Array.isArray(a)){for(const u of a)if(typeof u!="number")return;return new xn(a)}}toString(){return JSON.stringify(this.values)}static interpolate(a,u,m){return new xn(Lc(a.values,u.values,m))}}class Gi{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof Gi)return a;if(typeof a=="string"){const m=rn.parse(a);return m?new Gi([m]):void 0}if(!Array.isArray(a))return;const u=[];for(const m of a){if(typeof m!="string")return;const y=rn.parse(m);if(!y)return;u.push(y)}return new Gi(u)}toString(){return JSON.stringify(this.values)}static interpolate(a,u,m,y="rgb"){const T=[];if(a.values.length!=u.values.length)throw new Error(`colorArray: Arrays have mismatched length (${a.values.length} vs. ${u.values.length}), cannot interpolate.`);for(let M=0;M<a.values.length;M++)T.push(rn.interpolate(a.values[M],u.values[M],m,y));return new Gi(T)}}class On extends Error{constructor(a){super(a),this.name="RuntimeError"}toJSON(){return this.message}}const Sa=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ms{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof Ms)return a;if(Array.isArray(a)&&!(a.length<1)&&a.length%2==0){for(let u=0;u<a.length;u+=2){const m=a[u],y=a[u+1];if(typeof m!="string"||!Sa.has(m)||!Array.isArray(y)||y.length!==2||typeof y[0]!="number"||typeof y[1]!="number")return}return new Ms(a)}}toString(){return JSON.stringify(this.values)}static interpolate(a,u,m){const y=a.values,T=u.values;if(y.length!==T.length)throw new On(`Cannot interpolate values of different length. from: ${a.toString()}, to: ${u.toString()}`);const M=[];for(let R=0;R<y.length;R+=2){if(y[R]!==T[R])throw new On(`Cannot interpolate values containing mismatched anchors. from[${R}]: ${y[R]}, to[${R}]: ${T[R]}`);M.push(y[R]);const[F,$]=y[R+1],[H,K]=T[R+1];M.push([fl(F,H,m),fl($,K,m)])}return new Ms(M)}}class oo{constructor(a){this.name=a.name,this.available=a.available}toString(){return this.name}static fromString(a){return a?new oo({name:a,available:!1}):null}}class $s{constructor(a,u,m){this.from=a,this.to=u,this.transition=m}static interpolate(a,u,m){return new $s(a,u,m)}static parse(a){return a instanceof $s?a:Array.isArray(a)&&a.length===3&&typeof a[0]=="string"&&typeof a[1]=="string"&&typeof a[2]=="number"?new $s(a[0],a[1],a[2]):typeof a=="object"&&typeof a.from=="string"&&typeof a.to=="string"&&typeof a.transition=="number"?new $s(a.from,a.to,a.transition):typeof a=="string"?new $s(a,a,1):void 0}}function Dc(h,a,u,m){return typeof h=="number"&&h>=0&&h<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof u=="number"&&u>=0&&u<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:`Invalid rgba value [${[h,a,u,m].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof m=="number"?[h,a,u,m]:[h,a,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function pl(h){if(h===null||typeof h=="string"||typeof h=="boolean"||typeof h=="number"||h instanceof $s||h instanceof rn||h instanceof Nh||h instanceof Ns||h instanceof fs||h instanceof xn||h instanceof Gi||h instanceof Ms||h instanceof oo)return!0;if(Array.isArray(h)){for(const a of h)if(!pl(a))return!1;return!0}if(typeof h=="object"){for(const a in h)if(!pl(h[a]))return!1;return!0}return!1}function Pr(h){if(h===null)return Ii;if(typeof h=="string")return ai;if(typeof h=="boolean")return pi;if(typeof h=="number")return Nt;if(h instanceof rn)return Wi;if(h instanceof $s)return wt;if(h instanceof Nh)return Ni;if(h instanceof Ns)return Kn;if(h instanceof fs)return Xi;if(h instanceof xn)return an;if(h instanceof Gi)return jn;if(h instanceof Ms)return Gn;if(h instanceof oo)return zr;if(Array.isArray(h)){const a=h.length;let u;for(const m of h){const y=Pr(m);if(u){if(u===y)continue;u=bi;break}u=y}return ln(u||bi,a)}return Ri}function Xl(h){const a=typeof h;return h===null?"":a==="string"||a==="number"||a==="boolean"?String(h):h instanceof rn||h instanceof $s||h instanceof Ns||h instanceof fs||h instanceof xn||h instanceof Gi||h instanceof Ms||h instanceof oo?h.toString():JSON.stringify(h)}class No{constructor(a,u){this.type=a,this.value=u}static parse(a,u){if(a.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${a.length-1} instead.`);if(!pl(a[1]))return u.error("invalid value");const m=a[1];let y=Pr(m);const T=u.expectedType;return y.kind!=="array"||y.N!==0||!T||T.kind!=="array"||typeof T.N=="number"&&T.N!==0||(y=T),new No(y,m)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Eu={string:ai,number:Nt,boolean:pi,object:Ri};class Cs{constructor(a,u){this.type=a,this.args=u}static parse(a,u){if(a.length<2)return u.error("Expected at least one argument.");let m,y=1;const T=a[0];if(T==="array"){let R,F;if(a.length>2){const $=a[1];if(typeof $!="string"||!($ in Eu)||$==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);R=Eu[$],y++}else R=bi;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return u.error('The length argument to "array" must be a positive integer literal',2);F=a[2],y++}m=ln(R,F)}else{if(!Eu[T])throw new Error(`Types doesn't contain name = ${T}`);m=Eu[T]}const M=[];for(;y<a.length;y++){const R=u.parse(a[y],y,bi);if(!R)return null;M.push(R)}return new Cs(m,M)}evaluate(a){for(let u=0;u<this.args.length;u++){const m=this.args[u].evaluate(a);if(!ro(this.type,Pr(m)))return m;if(u===this.args.length-1)throw new On(`Expected value to be of type ${tn(this.type)}, but found ${tn(Pr(m))} instead.`)}throw new Error}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every((a=>a.outputDefined()))}}const Yl={"to-boolean":pi,"to-color":Wi,"to-number":Nt,"to-string":ai};class Ta{constructor(a,u){this.type=a,this.args=u}static parse(a,u){if(a.length<2)return u.error("Expected at least one argument.");const m=a[0];if(!Yl[m])throw new Error(`Can't parse ${m} as it is not part of the known types`);if((m==="to-boolean"||m==="to-string")&&a.length!==2)return u.error("Expected one argument.");const y=Yl[m],T=[];for(let M=1;M<a.length;M++){const R=u.parse(a[M],M,bi);if(!R)return null;T.push(R)}return new Ta(y,T)}evaluate(a){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(a);case"color":{let u,m;for(const y of this.args){if(u=y.evaluate(a),m=null,u instanceof rn)return u;if(typeof u=="string"){const T=a.parseColor(u);if(T)return T}else if(Array.isArray(u)&&(m=u.length<3||u.length>4?`Invalid rgba value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:Dc(u[0],u[1],u[2],u[3]),!m))return new rn(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new On(m||`Could not parse color from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"padding":{let u;for(const m of this.args){u=m.evaluate(a);const y=fs.parse(u);if(y)return y}throw new On(`Could not parse padding from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"numberArray":{let u;for(const m of this.args){u=m.evaluate(a);const y=xn.parse(u);if(y)return y}throw new On(`Could not parse numberArray from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"colorArray":{let u;for(const m of this.args){u=m.evaluate(a);const y=Gi.parse(u);if(y)return y}throw new On(`Could not parse colorArray from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"variableAnchorOffsetCollection":{let u;for(const m of this.args){u=m.evaluate(a);const y=Ms.parse(u);if(y)return y}throw new On(`Could not parse variableAnchorOffsetCollection from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"number":{let u=null;for(const m of this.args){if(u=m.evaluate(a),u===null)return 0;const y=Number(u);if(!isNaN(y))return y}throw new On(`Could not convert ${JSON.stringify(u)} to number.`)}case"formatted":return Ns.fromString(Xl(this.args[0].evaluate(a)));case"resolvedImage":return oo.fromString(Xl(this.args[0].evaluate(a)));case"projectionDefinition":return this.args[0].evaluate(a);default:return Xl(this.args[0].evaluate(a))}}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every((a=>a.outputDefined()))}}const ml=["Unknown","Point","LineString","Polygon"];class $o{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ml[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(a){let u=this._parseColorCache.get(a);return u||(u=rn.parse(a),this._parseColorCache.set(a,u)),u}}class gl{constructor(a,u,m=[],y,T=new qi,M=[]){this.registry=a,this.path=m,this.key=m.map((R=>`[${R}]`)).join(""),this.scope=T,this.errors=M,this.expectedType=y,this._isConstant=u}parse(a,u,m,y,T={}){return u?this.concat(u,m,y)._parse(a,T):this._parse(a,T)}_parse(a,u){function m(y,T,M){return M==="assert"?new Cs(T,[y]):M==="coerce"?new Ta(T,[y]):y}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const y=a[0];if(typeof y!="string")return this.error(`Expression name must be a string, but found ${typeof y} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const T=this.registry[y];if(T){let M=T.parse(a,this);if(!M)return null;if(this.expectedType){const R=this.expectedType,F=M.type;if(R.kind!=="string"&&R.kind!=="number"&&R.kind!=="boolean"&&R.kind!=="object"&&R.kind!=="array"||F.kind!=="value"){if(R.kind==="projectionDefinition"&&["string","array"].includes(F.kind)||["color","formatted","resolvedImage"].includes(R.kind)&&["value","string"].includes(F.kind)||["padding","numberArray"].includes(R.kind)&&["value","number","array"].includes(F.kind)||R.kind==="colorArray"&&["value","string","array"].includes(F.kind)||R.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(F.kind))M=m(M,R,u.typeAnnotation||"coerce");else if(this.checkSubtype(R,F))return null}else M=m(M,R,u.typeAnnotation||"assert")}if(!(M instanceof No)&&M.type.kind!=="resolvedImage"&&this._isConstant(M)){const R=new $o;try{M=new No(M.type,M.evaluate(R))}catch(F){return this.error(F.message),null}}return M}return this.error(`Unknown expression "${y}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof a} instead.`)}concat(a,u,m){const y=typeof a=="number"?this.path.concat(a):this.path,T=m?this.scope.concat(m):this.scope;return new gl(this.registry,this._isConstant,y,u||null,T,this.errors)}error(a,...u){const m=`${this.key}${u.map((y=>`[${y}]`)).join("")}`;this.errors.push(new Wt(m,a))}checkSubtype(a,u){const m=ro(a,u);return m&&this.error(m),m}}class zn{constructor(a,u){this.type=u.type,this.bindings=[].concat(a),this.result=u}evaluate(a){return this.result.evaluate(a)}eachChild(a){for(const u of this.bindings)a(u[1]);a(this.result)}static parse(a,u){if(a.length<4)return u.error(`Expected at least 3 arguments, but found ${a.length-1} instead.`);const m=[];for(let T=1;T<a.length-1;T+=2){const M=a[T];if(typeof M!="string")return u.error(`Expected string, but found ${typeof M} instead.`,T);if(/[^a-zA-Z0-9_]/.test(M))return u.error("Variable names must contain only alphanumeric characters or '_'.",T);const R=u.parse(a[T+1],T+1);if(!R)return null;m.push([M,R])}const y=u.parse(a[a.length-1],a.length-1,u.expectedType,m);return y?new zn(m,y):null}outputDefined(){return this.result.outputDefined()}}class Kl{constructor(a,u){this.type=u.type,this.name=a,this.boundExpression=u}static parse(a,u){if(a.length!==2||typeof a[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");const m=a[1];return u.scope.has(m)?new Kl(m,u.scope.get(m)):u.error(`Unknown variable "${m}". Make sure "${m}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(a){return this.boundExpression.evaluate(a)}eachChild(){}outputDefined(){return!1}}class pn{constructor(a,u,m){this.type=a,this.index=u,this.input=m}static parse(a,u){if(a.length!==3)return u.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const m=u.parse(a[1],1,Nt),y=u.parse(a[2],2,ln(u.expectedType||bi));return m&&y?new pn(y.type.itemType,m,y):null}evaluate(a){const u=this.index.evaluate(a),m=this.input.evaluate(a);if(u<0)throw new On(`Array index out of bounds: ${u} < 0.`);if(u>=m.length)throw new On(`Array index out of bounds: ${u} > ${m.length-1}.`);if(u!==Math.floor(u))throw new On(`Array index must be an integer, but found ${u} instead.`);return m[u]}eachChild(a){a(this.index),a(this.input)}outputDefined(){return!1}}class Ki{constructor(a,u){this.type=pi,this.needle=a,this.haystack=u}static parse(a,u){if(a.length!==3)return u.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const m=u.parse(a[1],1,bi),y=u.parse(a[2],2,bi);return m&&y?dl(m.type,[pi,ai,Nt,Ii,bi])?new Ki(m,y):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${tn(m.type)} instead`):null}evaluate(a){const u=this.needle.evaluate(a),m=this.haystack.evaluate(a);if(!m)return!1;if(!xo(u,["boolean","string","number","null"]))throw new On(`Expected first argument to be of type boolean, string, number or null, but found ${tn(Pr(u))} instead.`);if(!xo(m,["string","array"]))throw new On(`Expected second argument to be of type array or string, but found ${tn(Pr(m))} instead.`);return m.indexOf(u)>=0}eachChild(a){a(this.needle),a(this.haystack)}outputDefined(){return!0}}class Jl{constructor(a,u,m){this.type=Nt,this.needle=a,this.haystack=u,this.fromIndex=m}static parse(a,u){if(a.length<=2||a.length>=5)return u.error(`Expected 2 or 3 arguments, but found ${a.length-1} instead.`);const m=u.parse(a[1],1,bi),y=u.parse(a[2],2,bi);if(!m||!y)return null;if(!dl(m.type,[pi,ai,Nt,Ii,bi]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${tn(m.type)} instead`);if(a.length===4){const T=u.parse(a[3],3,Nt);return T?new Jl(m,y,T):null}return new Jl(m,y)}evaluate(a){const u=this.needle.evaluate(a),m=this.haystack.evaluate(a);if(!xo(u,["boolean","string","number","null"]))throw new On(`Expected first argument to be of type boolean, string, number or null, but found ${tn(Pr(u))} instead.`);let y;if(this.fromIndex&&(y=this.fromIndex.evaluate(a)),xo(m,["string"])){const T=m.indexOf(u,y);return T===-1?-1:[...m.slice(0,T)].length}if(xo(m,["array"]))return m.indexOf(u,y);throw new On(`Expected second argument to be of type array or string, but found ${tn(Pr(m))} instead.`)}eachChild(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)}outputDefined(){return!1}}class bn{constructor(a,u,m,y,T,M){this.inputType=a,this.type=u,this.input=m,this.cases=y,this.outputs=T,this.otherwise=M}static parse(a,u){if(a.length<5)return u.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if(a.length%2!=1)return u.error("Expected an even number of arguments.");let m,y;u.expectedType&&u.expectedType.kind!=="value"&&(y=u.expectedType);const T={},M=[];for(let $=2;$<a.length-1;$+=2){let H=a[$];const K=a[$+1];Array.isArray(H)||(H=[H]);const ne=u.concat($);if(H.length===0)return ne.error("Expected at least one branch label.");for(const fe of H){if(typeof fe!="number"&&typeof fe!="string")return ne.error("Branch labels must be numbers or strings.");if(typeof fe=="number"&&Math.abs(fe)>Number.MAX_SAFE_INTEGER)return ne.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof fe=="number"&&Math.floor(fe)!==fe)return ne.error("Numeric branch labels must be integer values.");if(m){if(ne.checkSubtype(m,Pr(fe)))return null}else m=Pr(fe);if(T[String(fe)]!==void 0)return ne.error("Branch labels must be unique.");T[String(fe)]=M.length}const oe=u.parse(K,$,y);if(!oe)return null;y=y||oe.type,M.push(oe)}const R=u.parse(a[1],1,bi);if(!R)return null;const F=u.parse(a[a.length-1],a.length-1,y);return F?R.type.kind!=="value"&&u.concat(1).checkSubtype(m,R.type)?null:new bn(m,y,R,T,M,F):null}evaluate(a){const u=this.input.evaluate(a);return(Pr(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(a)}eachChild(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)}outputDefined(){return this.outputs.every((a=>a.outputDefined()))&&this.otherwise.outputDefined()}}class Au{constructor(a,u,m){this.type=a,this.branches=u,this.otherwise=m}static parse(a,u){if(a.length<4)return u.error(`Expected at least 3 arguments, but found only ${a.length-1}.`);if(a.length%2!=0)return u.error("Expected an odd number of arguments.");let m;u.expectedType&&u.expectedType.kind!=="value"&&(m=u.expectedType);const y=[];for(let M=1;M<a.length-1;M+=2){const R=u.parse(a[M],M,pi);if(!R)return null;const F=u.parse(a[M+1],M+1,m);if(!F)return null;y.push([R,F]),m=m||F.type}const T=u.parse(a[a.length-1],a.length-1,m);if(!T)return null;if(!m)throw new Error("Can't infer output type");return new Au(m,y,T)}evaluate(a){for(const[u,m]of this.branches)if(u.evaluate(a))return m.evaluate(a);return this.otherwise.evaluate(a)}eachChild(a){for(const[u,m]of this.branches)a(u),a(m);a(this.otherwise)}outputDefined(){return this.branches.every((([a,u])=>u.outputDefined()))&&this.otherwise.outputDefined()}}class wo{constructor(a,u,m,y){this.type=a,this.input=u,this.beginIndex=m,this.endIndex=y}static parse(a,u){if(a.length<=2||a.length>=5)return u.error(`Expected 2 or 3 arguments, but found ${a.length-1} instead.`);const m=u.parse(a[1],1,bi),y=u.parse(a[2],2,Nt);if(!m||!y)return null;if(!dl(m.type,[ln(bi),ai,bi]))return u.error(`Expected first argument to be of type array or string, but found ${tn(m.type)} instead`);if(a.length===4){const T=u.parse(a[3],3,Nt);return T?new wo(m.type,m,y,T):null}return new wo(m.type,m,y)}evaluate(a){const u=this.input.evaluate(a),m=this.beginIndex.evaluate(a);let y;if(this.endIndex&&(y=this.endIndex.evaluate(a)),xo(u,["string"]))return[...u].slice(m,y).join("");if(xo(u,["array"]))return u.slice(m,y);throw new On(`Expected first argument to be of type array or string, but found ${tn(Pr(u))} instead.`)}eachChild(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)}outputDefined(){return!1}}function Ql(h,a){const u=h.length-1;let m,y,T=0,M=u,R=0;for(;T<=M;)if(R=Math.floor((T+M)/2),m=h[R],y=h[R+1],m<=a){if(R===u||a<y)return R;T=R+1}else{if(!(m>a))throw new On("Input is not a number.");M=R-1}return 0}class Ma{constructor(a,u,m){this.type=a,this.input=u,this.labels=[],this.outputs=[];for(const[y,T]of m)this.labels.push(y),this.outputs.push(T)}static parse(a,u){if(a.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return u.error("Expected an even number of arguments.");const m=u.parse(a[1],1,Nt);if(!m)return null;const y=[];let T=null;u.expectedType&&u.expectedType.kind!=="value"&&(T=u.expectedType);for(let M=1;M<a.length;M+=2){const R=M===1?-1/0:a[M],F=a[M+1],$=M,H=M+1;if(typeof R!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',$);if(y.length&&y[y.length-1][0]>=R)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',$);const K=u.parse(F,H,T);if(!K)return null;T=T||K.type,y.push([R,K])}return new Ma(T,m,y)}evaluate(a){const u=this.labels,m=this.outputs;if(u.length===1)return m[0].evaluate(a);const y=this.input.evaluate(a);if(y<=u[0])return m[0].evaluate(a);const T=u.length;return y>=u[T-1]?m[T-1].evaluate(a):m[Ql(u,y)].evaluate(a)}eachChild(a){a(this.input);for(const u of this.outputs)a(u)}outputDefined(){return this.outputs.every((a=>a.outputDefined()))}}function Fp(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var Pu,Qd,y_=(function(){if(Qd)return Pu;function h(a,u,m,y){this.cx=3*a,this.bx=3*(m-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(y-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=u,this.p2x=m,this.p2y=y}return Qd=1,Pu=h,h.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,u){if(u===void 0&&(u=1e-6),a<0)return 0;if(a>1)return 1;for(var m=a,y=0;y<8;y++){var T=this.sampleCurveX(m)-a;if(Math.abs(T)<u)return m;var M=this.sampleCurveDerivativeX(m);if(Math.abs(M)<1e-6)break;m-=T/M}var R=0,F=1;for(m=a,y=0;y<20&&(T=this.sampleCurveX(m),!(Math.abs(T-a)<u));y++)a>T?R=m:F=m,m=.5*(F-R)+R;return m},solve:function(a,u){return this.sampleCurveY(this.solveCurveX(a,u))}},Pu})(),Op=Fp(y_);class vr{constructor(a,u,m,y,T){this.type=a,this.operator=u,this.interpolation=m,this.input=y,this.labels=[],this.outputs=[];for(const[M,R]of T)this.labels.push(M),this.outputs.push(R)}static interpolationFactor(a,u,m,y){let T=0;if(a.name==="exponential")T=Vo(u,a.base,m,y);else if(a.name==="linear")T=Vo(u,1,m,y);else if(a.name==="cubic-bezier"){const M=a.controlPoints;T=new Op(M[0],M[1],M[2],M[3]).solve(Vo(u,1,m,y))}return T}static parse(a,u){let[m,y,T,...M]=a;if(!Array.isArray(y)||y.length===0)return u.error("Expected an interpolation type expression.",1);if(y[0]==="linear")y={name:"linear"};else if(y[0]==="exponential"){const $=y[1];if(typeof $!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);y={name:"exponential",base:$}}else{if(y[0]!=="cubic-bezier")return u.error(`Unknown interpolation type ${String(y[0])}`,1,0);{const $=y.slice(1);if($.length!==4||$.some((H=>typeof H!="number"||H<0||H>1)))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);y={name:"cubic-bezier",controlPoints:$}}}if(a.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(T=u.parse(T,2,Nt),!T)return null;const R=[];let F=null;m!=="interpolate-hcl"&&m!=="interpolate-lab"||u.expectedType==jn?u.expectedType&&u.expectedType.kind!=="value"&&(F=u.expectedType):F=Wi;for(let $=0;$<M.length;$+=2){const H=M[$],K=M[$+1],ne=$+3,oe=$+4;if(typeof H!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ne);if(R.length&&R[R.length-1][0]>=H)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ne);const fe=u.parse(K,oe,F);if(!fe)return null;F=F||fe.type,R.push([H,fe])}return Ar(F,Nt)||Ar(F,wt)||Ar(F,Wi)||Ar(F,Xi)||Ar(F,an)||Ar(F,jn)||Ar(F,Gn)||Ar(F,ln(Nt))?new vr(F,m,y,T,R):u.error(`Type ${tn(F)} is not interpolatable.`)}evaluate(a){const u=this.labels,m=this.outputs;if(u.length===1)return m[0].evaluate(a);const y=this.input.evaluate(a);if(y<=u[0])return m[0].evaluate(a);const T=u.length;if(y>=u[T-1])return m[T-1].evaluate(a);const M=Ql(u,y),R=vr.interpolationFactor(this.interpolation,y,u[M],u[M+1]),F=m[M].evaluate(a),$=m[M+1].evaluate(a);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return fl(F,$,R);case"color":return rn.interpolate(F,$,R);case"padding":return fs.interpolate(F,$,R);case"colorArray":return Gi.interpolate(F,$,R);case"numberArray":return xn.interpolate(F,$,R);case"variableAnchorOffsetCollection":return Ms.interpolate(F,$,R);case"array":return Lc(F,$,R);case"projectionDefinition":return $s.interpolate(F,$,R)}case"interpolate-hcl":switch(this.type.kind){case"color":return rn.interpolate(F,$,R,"hcl");case"colorArray":return Gi.interpolate(F,$,R,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return rn.interpolate(F,$,R,"lab");case"colorArray":return Gi.interpolate(F,$,R,"lab")}}}eachChild(a){a(this.input);for(const u of this.outputs)a(u)}outputDefined(){return this.outputs.every((a=>a.outputDefined()))}}function Vo(h,a,u,m){const y=m-u,T=h-u;return y===0?0:a===1?T/y:(Math.pow(a,T)-1)/(Math.pow(a,y)-1)}const rr={color:rn.interpolate,number:fl,padding:fs.interpolate,numberArray:xn.interpolate,colorArray:Gi.interpolate,variableAnchorOffsetCollection:Ms.interpolate,array:Lc};class ec{constructor(a,u){this.type=a,this.args=u}static parse(a,u){if(a.length<2)return u.error("Expected at least one argument.");let m=null;const y=u.expectedType;y&&y.kind!=="value"&&(m=y);const T=[];for(const R of a.slice(1)){const F=u.parse(R,1+T.length,m,void 0,{typeAnnotation:"omit"});if(!F)return null;m=m||F.type,T.push(F)}if(!m)throw new Error("No output type");const M=y&&T.some((R=>ro(y,R.type)));return new ec(M?bi:m,T)}evaluate(a){let u,m=null,y=0;for(const T of this.args)if(y++,m=T.evaluate(a),m&&m instanceof oo&&!m.available&&(u||(u=m.name),m=null,y===this.args.length&&(m=u)),m!==null)break;return m}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every((a=>a.outputDefined()))}}function ef(h,a){return h==="=="||h==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function Iu(h,a,u,m){return m.compare(a,u)===0}function yr(h,a,u){const m=h!=="=="&&h!=="!=";return class oF{constructor(T,M,R){this.type=pi,this.lhs=T,this.rhs=M,this.collator=R,this.hasUntypedArgument=T.type.kind==="value"||M.type.kind==="value"}static parse(T,M){if(T.length!==3&&T.length!==4)return M.error("Expected two or three arguments.");const R=T[0];let F=M.parse(T[1],1,bi);if(!F)return null;if(!ef(R,F.type))return M.concat(1).error(`"${R}" comparisons are not supported for type '${tn(F.type)}'.`);let $=M.parse(T[2],2,bi);if(!$)return null;if(!ef(R,$.type))return M.concat(2).error(`"${R}" comparisons are not supported for type '${tn($.type)}'.`);if(F.type.kind!==$.type.kind&&F.type.kind!=="value"&&$.type.kind!=="value")return M.error(`Cannot compare types '${tn(F.type)}' and '${tn($.type)}'.`);m&&(F.type.kind==="value"&&$.type.kind!=="value"?F=new Cs($.type,[F]):F.type.kind!=="value"&&$.type.kind==="value"&&($=new Cs(F.type,[$])));let H=null;if(T.length===4){if(F.type.kind!=="string"&&$.type.kind!=="string"&&F.type.kind!=="value"&&$.type.kind!=="value")return M.error("Cannot use collator to compare non-string types.");if(H=M.parse(T[3],3,Ni),!H)return null}return new oF(F,$,H)}evaluate(T){const M=this.lhs.evaluate(T),R=this.rhs.evaluate(T);if(m&&this.hasUntypedArgument){const F=Pr(M),$=Pr(R);if(F.kind!==$.kind||F.kind!=="string"&&F.kind!=="number")throw new On(`Expected arguments for "${h}" to be (string, string) or (number, number), but found (${F.kind}, ${$.kind}) instead.`)}if(this.collator&&!m&&this.hasUntypedArgument){const F=Pr(M),$=Pr(R);if(F.kind!=="string"||$.kind!=="string")return a(T,M,R)}return this.collator?u(T,M,R,this.collator.evaluate(T)):a(T,M,R)}eachChild(T){T(this.lhs),T(this.rhs),this.collator&&T(this.collator)}outputDefined(){return!0}}}const zp=yr("==",(function(h,a,u){return a===u}),Iu),tf=yr("!=",(function(h,a,u){return a!==u}),(function(h,a,u,m){return!Iu(0,a,u,m)})),Bp=yr("<",(function(h,a,u){return a<u}),(function(h,a,u,m){return m.compare(a,u)<0})),nf=yr(">",(function(h,a,u){return a>u}),(function(h,a,u,m){return m.compare(a,u)>0})),Ca=yr("<=",(function(h,a,u){return a<=u}),(function(h,a,u,m){return m.compare(a,u)<=0})),$h=yr(">=",(function(h,a,u){return a>=u}),(function(h,a,u,m){return m.compare(a,u)>=0}));class tc{constructor(a,u,m){this.type=Ni,this.locale=m,this.caseSensitive=a,this.diacriticSensitive=u}static parse(a,u){if(a.length!==2)return u.error("Expected one argument.");const m=a[1];if(typeof m!="object"||Array.isArray(m))return u.error("Collator options argument must be an object.");const y=u.parse(m["case-sensitive"]!==void 0&&m["case-sensitive"],1,pi);if(!y)return null;const T=u.parse(m["diacritic-sensitive"]!==void 0&&m["diacritic-sensitive"],1,pi);if(!T)return null;let M=null;return m.locale&&(M=u.parse(m.locale,1,ai),!M)?null:new tc(y,T,M)}evaluate(a){return new Nh(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)}eachChild(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)}outputDefined(){return!1}}class Vh{constructor(a,u,m,y,T){this.type=ai,this.number=a,this.locale=u,this.currency=m,this.minFractionDigits=y,this.maxFractionDigits=T}static parse(a,u){if(a.length!==3)return u.error("Expected two arguments.");const m=u.parse(a[1],1,Nt);if(!m)return null;const y=a[2];if(typeof y!="object"||Array.isArray(y))return u.error("NumberFormat options argument must be an object.");let T=null;if(y.locale&&(T=u.parse(y.locale,1,ai),!T))return null;let M=null;if(y.currency&&(M=u.parse(y.currency,1,ai),!M))return null;let R=null;if(y["min-fraction-digits"]&&(R=u.parse(y["min-fraction-digits"],1,Nt),!R))return null;let F=null;return y["max-fraction-digits"]&&(F=u.parse(y["max-fraction-digits"],1,Nt),!F)?null:new Vh(m,T,M,R,F)}evaluate(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))}eachChild(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)}outputDefined(){return!1}}class Ea{constructor(a){this.type=Kn,this.sections=a}static parse(a,u){if(a.length<2)return u.error("Expected at least one argument.");const m=a[1];if(!Array.isArray(m)&&typeof m=="object")return u.error("First argument must be an image or text section.");const y=[];let T=!1;for(let M=1;M<=a.length-1;++M){const R=a[M];if(T&&typeof R=="object"&&!Array.isArray(R)){T=!1;let F=null;if(R["font-scale"]&&(F=u.parse(R["font-scale"],1,Nt),!F))return null;let $=null;if(R["text-font"]&&($=u.parse(R["text-font"],1,ln(ai)),!$))return null;let H=null;if(R["text-color"]&&(H=u.parse(R["text-color"],1,Wi),!H))return null;let K=null;if(R["vertical-align"]){if(typeof R["vertical-align"]=="string"&&!Dp.includes(R["vertical-align"]))return u.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${R["vertical-align"]}' instead.`);if(K=u.parse(R["vertical-align"],1,ai),!K)return null}const ne=y[y.length-1];ne.scale=F,ne.font=$,ne.textColor=H,ne.verticalAlign=K}else{const F=u.parse(a[M],1,bi);if(!F)return null;const $=F.type.kind;if($!=="string"&&$!=="value"&&$!=="null"&&$!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");T=!0,y.push({content:F,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Ea(y)}evaluate(a){return new Ns(this.sections.map((u=>{const m=u.content.evaluate(a);return Pr(m)===zr?new kc("",m,null,null,null,u.verticalAlign?u.verticalAlign.evaluate(a):null):new kc(Xl(m),null,u.scale?u.scale.evaluate(a):null,u.font?u.font.evaluate(a).join(","):null,u.textColor?u.textColor.evaluate(a):null,u.verticalAlign?u.verticalAlign.evaluate(a):null)})))}eachChild(a){for(const u of this.sections)a(u.content),u.scale&&a(u.scale),u.font&&a(u.font),u.textColor&&a(u.textColor),u.verticalAlign&&a(u.verticalAlign)}outputDefined(){return!1}}class _l{constructor(a){this.type=zr,this.input=a}static parse(a,u){if(a.length!==2)return u.error("Expected two arguments.");const m=u.parse(a[1],1,ai);return m?new _l(m):u.error("No image name provided.")}evaluate(a){const u=this.input.evaluate(a),m=oo.fromString(u);return m&&a.availableImages&&(m.available=a.availableImages.indexOf(u)>-1),m}eachChild(a){a(this.input)}outputDefined(){return!1}}class vl{constructor(a){this.type=Nt,this.input=a}static parse(a,u){if(a.length!==2)return u.error(`Expected 1 argument, but found ${a.length-1} instead.`);const m=u.parse(a[1],1);return m?m.type.kind!=="array"&&m.type.kind!=="string"&&m.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${tn(m.type)} instead.`):new vl(m):null}evaluate(a){const u=this.input.evaluate(a);if(typeof u=="string")return[...u].length;if(Array.isArray(u))return u.length;throw new On(`Expected value to be of type string or array, but found ${tn(Pr(u))} instead.`)}eachChild(a){a(this.input)}outputDefined(){return!1}}const qr=8192;function Np(h,a){const u=(180+h[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h[1]*Math.PI/360)))/360,y=Math.pow(2,a.z);return[Math.round(u*y*qr),Math.round(m*y*qr)]}function Fc(h,a){const u=Math.pow(2,a.z);return[(y=(h[0]/qr+a.x)/u,360*y-180),(m=(h[1]/qr+a.y)/u,360/Math.PI*Math.atan(Math.exp((180-360*m)*Math.PI/180))-90)];var m,y}function Uo(h,a){h[0]=Math.min(h[0],a[0]),h[1]=Math.min(h[1],a[1]),h[2]=Math.max(h[2],a[0]),h[3]=Math.max(h[3],a[1])}function ic(h,a){return!(h[0]<=a[0]||h[2]>=a[2]||h[1]<=a[1]||h[3]>=a[3])}function b_(h,a,u){const m=h[0]-a[0],y=h[1]-a[1],T=h[0]-u[0],M=h[1]-u[1];return m*M-T*y==0&&m*T<=0&&y*M<=0}function Uh(h,a,u,m){return(y=[m[0]-u[0],m[1]-u[1]])[0]*(T=[a[0]-h[0],a[1]-h[1]])[1]-y[1]*T[0]!=0&&!(!sf(h,a,u,m)||!sf(u,m,h,a));var y,T}function x_(h,a,u){for(const m of u)for(let y=0;y<m.length-1;++y)if(Uh(h,a,m[y],m[y+1]))return!0;return!1}function Aa(h,a,u=!1){let m=!1;for(const R of a)for(let F=0;F<R.length-1;F++){if(b_(h,R[F],R[F+1]))return u;(T=R[F])[1]>(y=h)[1]!=(M=R[F+1])[1]>y[1]&&y[0]<(M[0]-T[0])*(y[1]-T[1])/(M[1]-T[1])+T[0]&&(m=!m)}var y,T,M;return m}function Oc(h,a){for(const u of a)if(Aa(h,u))return!0;return!1}function $p(h,a){for(const u of h)if(!Aa(u,a))return!1;for(let u=0;u<h.length-1;++u)if(x_(h[u],h[u+1],a))return!1;return!0}function rf(h,a){for(const u of a)if($p(h,u))return!0;return!1}function sf(h,a,u,m){const y=m[0]-u[0],T=m[1]-u[1],M=(h[0]-u[0])*T-y*(h[1]-u[1]),R=(a[0]-u[0])*T-y*(a[1]-u[1]);return M>0&&R<0||M<0&&R>0}function yl(h,a,u){const m=[];for(let y=0;y<h.length;y++){const T=[];for(let M=0;M<h[y].length;M++){const R=Np(h[y][M],u);Uo(a,R),T.push(R)}m.push(T)}return m}function Ru(h,a,u){const m=[];for(let y=0;y<h.length;y++){const T=yl(h[y],a,u);m.push(T)}return m}function of(h,a,u,m){if(h[0]<u[0]||h[0]>u[2]){const y=.5*m;let T=h[0]-u[0]>y?-m:u[0]-h[0]>y?m:0;T===0&&(T=h[0]-u[2]>y?-m:u[2]-h[0]>y?m:0),h[0]+=T}Uo(a,h)}function Vp(h,a,u,m){const y=Math.pow(2,m.z)*qr,T=[m.x*qr,m.y*qr],M=[];for(const R of h)for(const F of R){const $=[F.x+T[0],F.y+T[1]];of($,a,u,y),M.push($)}return M}function Up(h,a,u,m){const y=Math.pow(2,m.z)*qr,T=[m.x*qr,m.y*qr],M=[];for(const F of h){const $=[];for(const H of F){const K=[H.x+T[0],H.y+T[1]];Uo(a,K),$.push(K)}M.push($)}if(a[2]-a[0]<=y/2){(R=a)[0]=R[1]=1/0,R[2]=R[3]=-1/0;for(const F of M)for(const $ of F)of($,a,u,y)}var R;return M}class nc{constructor(a,u){this.type=pi,this.geojson=a,this.geometries=u}static parse(a,u){if(a.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${a.length-1} instead.`);if(pl(a[1])){const m=a[1];if(m.type==="FeatureCollection"){const y=[];for(const T of m.features){const{type:M,coordinates:R}=T.geometry;M==="Polygon"&&y.push(R),M==="MultiPolygon"&&y.push(...R)}if(y.length)return new nc(m,{type:"MultiPolygon",coordinates:y})}else if(m.type==="Feature"){const y=m.geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new nc(m,m.geometry)}else if(m.type==="Polygon"||m.type==="MultiPolygon")return new nc(m,m)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return(function(u,m){const y=[1/0,1/0,-1/0,-1/0],T=[1/0,1/0,-1/0,-1/0],M=u.canonicalID();if(m.type==="Polygon"){const R=yl(m.coordinates,T,M),F=Vp(u.geometry(),y,T,M);if(!ic(y,T))return!1;for(const $ of F)if(!Aa($,R))return!1}if(m.type==="MultiPolygon"){const R=Ru(m.coordinates,T,M),F=Vp(u.geometry(),y,T,M);if(!ic(y,T))return!1;for(const $ of F)if(!Oc($,R))return!1}return!0})(a,this.geometries);if(a.geometryType()==="LineString")return(function(u,m){const y=[1/0,1/0,-1/0,-1/0],T=[1/0,1/0,-1/0,-1/0],M=u.canonicalID();if(m.type==="Polygon"){const R=yl(m.coordinates,T,M),F=Up(u.geometry(),y,T,M);if(!ic(y,T))return!1;for(const $ of F)if(!$p($,R))return!1}if(m.type==="MultiPolygon"){const R=Ru(m.coordinates,T,M),F=Up(u.geometry(),y,T,M);if(!ic(y,T))return!1;for(const $ of F)if(!rf($,R))return!1}return!0})(a,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let zc=class{constructor(h=[],a=(u,m)=>u<m?-1:u>m?1:0){if(this.data=h,this.length=this.data.length,this.compare=a,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(h){this.data.push(h),this._up(this.length++)}pop(){if(this.length===0)return;const h=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),h}peek(){return this.data[0]}_up(h){const{data:a,compare:u}=this,m=a[h];for(;h>0;){const y=h-1>>1,T=a[y];if(u(m,T)>=0)break;a[h]=T,h=y}a[h]=m}_down(h){const{data:a,compare:u}=this,m=this.length>>1,y=a[h];for(;h<m;){let T=1+(h<<1);const M=T+1;if(M<this.length&&u(a[M],a[T])<0&&(T=M),u(a[T],y)>=0)break;a[h]=a[T],h=T}a[h]=y}};function Pa(h,a,u=0,m=h.length-1,y=jp){for(;m>u;){if(m-u>600){const F=m-u+1,$=a-u+1,H=Math.log(F),K=.5*Math.exp(2*H/3),ne=.5*Math.sqrt(H*K*(F-K)/F)*($-F/2<0?-1:1);Pa(h,a,Math.max(u,Math.floor(a-$*K/F+ne)),Math.min(m,Math.floor(a+(F-$)*K/F+ne)),y)}const T=h[a];let M=u,R=m;for(Bc(h,u,a),y(h[m],T)>0&&Bc(h,u,m);M<R;){for(Bc(h,M,R),M++,R--;y(h[M],T)<0;)M++;for(;y(h[R],T)>0;)R--}y(h[u],T)===0?Bc(h,u,R):(R++,Bc(h,R,m)),R<=a&&(u=R+1),a<=R&&(m=R-1)}}function Bc(h,a,u){const m=h[a];h[a]=h[u],h[u]=m}function jp(h,a){return h<a?-1:h>a?1:0}function jh(h,a){if(h.length<=1)return[h];const u=[];let m,y;for(const T of h){const M=S_(T);M!==0&&(T.area=Math.abs(M),y===void 0&&(y=M<0),y===M<0?(m&&u.push(m),m=[T]):m.push(T))}if(m&&u.push(m),a>1)for(let T=0;T<u.length;T++)u[T].length<=a||(Pa(u[T],a,1,u[T].length-1,w_),u[T]=u[T].slice(0,a));return u}function w_(h,a){return a.area-h.area}function S_(h){let a=0;for(let u,m,y=0,T=h.length,M=T-1;y<T;M=y++)u=h[y],m=h[M],a+=(m.x-u.x)*(u.y+m.y);return a}const Gp=1/298.257223563,Lu=Gp*(2-Gp),qp=Math.PI/180;class Gh{constructor(a){const u=6378.137*qp*1e3,m=Math.cos(a*qp),y=1/(1-Lu*(1-m*m)),T=Math.sqrt(y);this.kx=u*T*m,this.ky=u*T*y*(1-Lu)}distance(a,u){const m=this.wrap(a[0]-u[0])*this.kx,y=(a[1]-u[1])*this.ky;return Math.sqrt(m*m+y*y)}pointOnLine(a,u){let m,y,T,M,R=1/0;for(let F=0;F<a.length-1;F++){let $=a[F][0],H=a[F][1],K=this.wrap(a[F+1][0]-$)*this.kx,ne=(a[F+1][1]-H)*this.ky,oe=0;K===0&&ne===0||(oe=(this.wrap(u[0]-$)*this.kx*K+(u[1]-H)*this.ky*ne)/(K*K+ne*ne),oe>1?($=a[F+1][0],H=a[F+1][1]):oe>0&&($+=K/this.kx*oe,H+=ne/this.ky*oe)),K=this.wrap(u[0]-$)*this.kx,ne=(u[1]-H)*this.ky;const fe=K*K+ne*ne;fe<R&&(R=fe,m=$,y=H,T=F,M=oe)}return{point:[m,y],index:T,t:Math.max(0,Math.min(1,M))}}wrap(a){for(;a<-180;)a+=360;for(;a>180;)a-=360;return a}}function Wp(h,a){return a[0]-h[0]}function ku(h){return h[1]-h[0]+1}function ao(h,a){return h[1]>=h[0]&&h[1]<a}function Du(h,a){if(h[0]>h[1])return[null,null];const u=ku(h);if(a){if(u===2)return[h,null];const y=Math.floor(u/2);return[[h[0],h[0]+y],[h[0]+y,h[1]]]}if(u===1)return[h,null];const m=Math.floor(u/2)-1;return[[h[0],h[0]+m],[h[0]+m+1,h[1]]]}function Ia(h,a){if(!ao(a,h.length))return[1/0,1/0,-1/0,-1/0];const u=[1/0,1/0,-1/0,-1/0];for(let m=a[0];m<=a[1];++m)Uo(u,h[m]);return u}function qh(h){const a=[1/0,1/0,-1/0,-1/0];for(const u of h)for(const m of u)Uo(a,m);return a}function Fu(h){return h[0]!==-1/0&&h[1]!==-1/0&&h[2]!==1/0&&h[3]!==1/0}function Ou(h,a,u){if(!Fu(h)||!Fu(a))return NaN;let m=0,y=0;return h[2]<a[0]&&(m=a[0]-h[2]),h[0]>a[2]&&(m=h[0]-a[2]),h[1]>a[3]&&(y=h[1]-a[3]),h[3]<a[1]&&(y=a[1]-h[3]),u.distance([0,0],[m,y])}function Ra(h,a,u){const m=u.pointOnLine(a,h);return u.distance(h,m.point)}function Wh(h,a,u,m,y){const T=Math.min(Ra(h,[u,m],y),Ra(a,[u,m],y)),M=Math.min(Ra(u,[h,a],y),Ra(m,[h,a],y));return Math.min(T,M)}function af(h,a,u,m,y){if(!ao(a,h.length)||!ao(m,u.length))return 1/0;let T=1/0;for(let M=a[0];M<a[1];++M){const R=h[M],F=h[M+1];for(let $=m[0];$<m[1];++$){const H=u[$],K=u[$+1];if(Uh(R,F,H,K))return 0;T=Math.min(T,Wh(R,F,H,K,y))}}return T}function Hp(h,a,u,m,y){if(!ao(a,h.length)||!ao(m,u.length))return NaN;let T=1/0;for(let M=a[0];M<=a[1];++M)for(let R=m[0];R<=m[1];++R)if(T=Math.min(T,y.distance(h[M],u[R])),T===0)return T;return T}function rc(h,a,u){if(Aa(h,a,!0))return 0;let m=1/0;for(const y of a){const T=y[0],M=y[y.length-1];if(T!==M&&(m=Math.min(m,Ra(h,[M,T],u)),m===0))return m;const R=u.pointOnLine(y,h);if(m=Math.min(m,u.distance(h,R.point)),m===0)return m}return m}function bl(h,a,u,m){if(!ao(a,h.length))return NaN;for(let T=a[0];T<=a[1];++T)if(Aa(h[T],u,!0))return 0;let y=1/0;for(let T=a[0];T<a[1];++T){const M=h[T],R=h[T+1];for(const F of u)for(let $=0,H=F.length,K=H-1;$<H;K=$++){const ne=F[K],oe=F[$];if(Uh(M,R,ne,oe))return 0;y=Math.min(y,Wh(M,R,ne,oe,m))}}return y}function Zp(h,a){for(const u of h)for(const m of u)if(Aa(m,a,!0))return!0;return!1}function T_(h,a,u,m=1/0){const y=qh(h),T=qh(a);if(m!==1/0&&Ou(y,T,u)>=m)return m;if(ic(y,T)){if(Zp(h,a))return 0}else if(Zp(a,h))return 0;let M=1/0;for(const R of h)for(let F=0,$=R.length,H=$-1;F<$;H=F++){const K=R[H],ne=R[F];for(const oe of a)for(let fe=0,ge=oe.length,ve=ge-1;fe<ge;ve=fe++){const Pe=oe[ve],Ge=oe[fe];if(Uh(K,ne,Pe,Ge))return 0;M=Math.min(M,Wh(K,ne,Pe,Ge,u))}}return M}function Sn(h,a,u,m,y,T){if(!T)return;const M=Ou(Ia(m,T),y,u);M<a&&h.push([M,T,[0,0]])}function Hh(h,a,u,m,y,T,M){if(!T||!M)return;const R=Ou(Ia(m,T),Ia(y,M),u);R<a&&h.push([R,T,M])}function Zh(h,a,u,m,y=1/0){let T=Math.min(m.distance(h[0],u[0][0]),y);if(T===0)return T;const M=new zc([[0,[0,h.length-1],[0,0]]],Wp),R=qh(u);for(;M.length>0;){const F=M.pop();if(F[0]>=T)continue;const $=F[1],H=a?50:100;if(ku($)<=H){if(!ao($,h.length))return NaN;if(a){const K=bl(h,$,u,m);if(isNaN(K)||K===0)return K;T=Math.min(T,K)}else for(let K=$[0];K<=$[1];++K){const ne=rc(h[K],u,m);if(T=Math.min(T,ne),T===0)return 0}}else{const K=Du($,a);Sn(M,T,m,h,R,K[0]),Sn(M,T,m,h,R,K[1])}}return T}function Xh(h,a,u,m,y,T=1/0){let M=Math.min(T,y.distance(h[0],u[0]));if(M===0)return M;const R=new zc([[0,[0,h.length-1],[0,u.length-1]]],Wp);for(;R.length>0;){const F=R.pop();if(F[0]>=M)continue;const $=F[1],H=F[2],K=a?50:100,ne=m?50:100;if(ku($)<=K&&ku(H)<=ne){if(!ao($,h.length)&&ao(H,u.length))return NaN;let oe;if(a&&m)oe=af(h,$,u,H,y),M=Math.min(M,oe);else if(a&&!m){const fe=h.slice($[0],$[1]+1);for(let ge=H[0];ge<=H[1];++ge)if(oe=Ra(u[ge],fe,y),M=Math.min(M,oe),M===0)return M}else if(!a&&m){const fe=u.slice(H[0],H[1]+1);for(let ge=$[0];ge<=$[1];++ge)if(oe=Ra(h[ge],fe,y),M=Math.min(M,oe),M===0)return M}else oe=Hp(h,$,u,H,y),M=Math.min(M,oe)}else{const oe=Du($,a),fe=Du(H,m);Hh(R,M,y,h,u,oe[0],fe[0]),Hh(R,M,y,h,u,oe[0],fe[1]),Hh(R,M,y,h,u,oe[1],fe[0]),Hh(R,M,y,h,u,oe[1],fe[1])}}return M}function lf(h){return h.type==="MultiPolygon"?h.coordinates.map((a=>({type:"Polygon",coordinates:a}))):h.type==="MultiLineString"?h.coordinates.map((a=>({type:"LineString",coordinates:a}))):h.type==="MultiPoint"?h.coordinates.map((a=>({type:"Point",coordinates:a}))):[h]}class sc{constructor(a,u){this.type=Nt,this.geojson=a,this.geometries=u}static parse(a,u){if(a.length!==2)return u.error(`'distance' expression requires exactly one argument, but found ${a.length-1} instead.`);if(pl(a[1])){const m=a[1];if(m.type==="FeatureCollection")return new sc(m,m.features.map((y=>lf(y.geometry))).flat());if(m.type==="Feature")return new sc(m,lf(m.geometry));if("type"in m&&"coordinates"in m)return new sc(m,lf(m))}return u.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return(function(u,m){const y=u.geometry(),T=y.flat().map((F=>Fc([F.x,F.y],u.canonical)));if(y.length===0)return NaN;const M=new Gh(T[0][1]);let R=1/0;for(const F of m){switch(F.type){case"Point":R=Math.min(R,Xh(T,!1,[F.coordinates],!1,M,R));break;case"LineString":R=Math.min(R,Xh(T,!1,F.coordinates,!0,M,R));break;case"Polygon":R=Math.min(R,Zh(T,!1,F.coordinates,M,R))}if(R===0)return R}return R})(a,this.geometries);if(a.geometryType()==="LineString")return(function(u,m){const y=u.geometry(),T=y.flat().map((F=>Fc([F.x,F.y],u.canonical)));if(y.length===0)return NaN;const M=new Gh(T[0][1]);let R=1/0;for(const F of m){switch(F.type){case"Point":R=Math.min(R,Xh(T,!0,[F.coordinates],!1,M,R));break;case"LineString":R=Math.min(R,Xh(T,!0,F.coordinates,!0,M,R));break;case"Polygon":R=Math.min(R,Zh(T,!0,F.coordinates,M,R))}if(R===0)return R}return R})(a,this.geometries);if(a.geometryType()==="Polygon")return(function(u,m){const y=u.geometry();if(y.length===0||y[0].length===0)return NaN;const T=jh(y,0).map((F=>F.map(($=>$.map((H=>Fc([H.x,H.y],u.canonical))))))),M=new Gh(T[0][0][0][1]);let R=1/0;for(const F of m)for(const $ of T){switch(F.type){case"Point":R=Math.min(R,Zh([F.coordinates],!1,$,M,R));break;case"LineString":R=Math.min(R,Zh(F.coordinates,!0,$,M,R));break;case"Polygon":R=Math.min(R,T_($,F.coordinates,M,R))}if(R===0)return R}return R})(a,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Nc{constructor(a){this.type=bi,this.key=a}static parse(a,u){if(a.length!==2)return u.error(`Expected 1 argument, but found ${a.length-1} instead.`);const m=a[1];return m==null?u.error("Global state property must be defined."):typeof m!="string"?u.error(`Global state property must be string, but found ${typeof a[1]} instead.`):new Nc(m)}evaluate(a){var u;const m=(u=a.globals)===null||u===void 0?void 0:u.globalState;return m&&Object.keys(m).length!==0?Tu(m,this.key):null}eachChild(){}outputDefined(){return!1}}const La={"==":zp,"!=":tf,">":nf,"<":Bp,">=":$h,"<=":Ca,array:Cs,at:pn,boolean:Cs,case:Au,coalesce:ec,collator:tc,format:Ea,image:_l,in:Ki,"index-of":Jl,interpolate:vr,"interpolate-hcl":vr,"interpolate-lab":vr,length:vl,let:zn,literal:No,match:bn,number:Cs,"number-format":Vh,object:Cs,slice:wo,step:Ma,string:Cs,"to-boolean":Ta,"to-color":Ta,"to-number":Ta,"to-string":Ta,var:Kl,within:nc,distance:sc,"global-state":Nc};class Vs{constructor(a,u,m,y){this.name=a,this.type=u,this._evaluate=m,this.args=y}evaluate(a){return this._evaluate(a,this.args)}eachChild(a){this.args.forEach(a)}outputDefined(){return!1}static parse(a,u){const m=a[0],y=Vs.definitions[m];if(!y)return u.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0);const T=Array.isArray(y)?y[0]:y.type,M=Array.isArray(y)?[[y[1],y[2]]]:y.overloads,R=M.filter((([$])=>!Array.isArray($)||$.length===a.length-1));let F=null;for(const[$,H]of R){F=new gl(u.registry,Y,u.path,null,u.scope);const K=[];let ne=!1;for(let oe=1;oe<a.length;oe++){const fe=a[oe],ge=Array.isArray($)?$[oe-1]:$.type,ve=F.parse(fe,1+K.length,ge);if(!ve){ne=!0;break}K.push(ve)}if(!ne)if(Array.isArray($)&&$.length!==K.length)F.error(`Expected ${$.length} arguments, but found ${K.length} instead.`);else{for(let oe=0;oe<K.length;oe++){const fe=Array.isArray($)?$[oe]:$.type,ge=K[oe];F.concat(oe+1).checkSubtype(fe,ge.type)}if(F.errors.length===0)return new Vs(m,T,H,K)}}if(R.length===1)u.errors.push(...F.errors);else{const $=(R.length?R:M).map((([K])=>{return ne=K,Array.isArray(ne)?`(${ne.map(tn).join(", ")})`:`(${tn(ne.type)}...)`;var ne})).join(" | "),H=[];for(let K=1;K<a.length;K++){const ne=u.parse(a[K],1+H.length);if(!ne)return null;H.push(tn(ne.type))}u.error(`Expected arguments of type ${$}, but found (${H.join(", ")}) instead.`)}return null}static register(a,u){Vs.definitions=u;for(const m in u)a[m]=Vs}}function Xp(h,[a,u,m,y]){a=a.evaluate(h),u=u.evaluate(h),m=m.evaluate(h);const T=y?y.evaluate(h):1,M=Dc(a,u,m,T);if(M)throw new On(M);return new rn(a/255,u/255,m/255,T,!1)}function Yp(h,a){return h in a}function oc(h,a){const u=a[h];return u===void 0?null:u}function ut(h){return{type:h}}function Y(h){if(h instanceof Kl)return Y(h.boundExpression);if(h instanceof Vs&&h.name==="error"||h instanceof tc||h instanceof nc||h instanceof sc||h instanceof Nc)return!1;const a=h instanceof Ta||h instanceof Cs;let u=!0;return h.eachChild((m=>{u=a?u&&Y(m):u&&m instanceof No})),!!u&&Te(h)&&Ht(h,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Te(h){if(h instanceof Vs&&(h.name==="get"&&h.args.length===1||h.name==="feature-state"||h.name==="has"&&h.args.length===1||h.name==="properties"||h.name==="geometry-type"||h.name==="id"||/^filter-/.test(h.name))||h instanceof nc||h instanceof sc)return!1;let a=!0;return h.eachChild((u=>{a&&!Te(u)&&(a=!1)})),a}function ht(h){if(h instanceof Vs&&h.name==="feature-state")return!1;let a=!0;return h.eachChild((u=>{a&&!ht(u)&&(a=!1)})),a}function Ht(h,a){if(h instanceof Vs&&a.indexOf(h.name)>=0)return!1;let u=!0;return h.eachChild((m=>{u&&!Ht(m,a)&&(u=!1)})),u}function di(h){return{result:"success",value:h}}function Ti(h){return{result:"error",value:h}}function _n(h){return h["property-type"]==="data-driven"||h["property-type"]==="cross-faded-data-driven"}function fr(h){return!!h.expression&&h.expression.parameters.indexOf("zoom")>-1}function Es(h){return!!h.expression&&h.expression.interpolated}function ji(h){return h instanceof Number?"number":h instanceof String?"string":h instanceof Boolean?"boolean":Array.isArray(h)?"array":h===null?"null":typeof h}function Ks(h){return typeof h=="object"&&h!==null&&!Array.isArray(h)&&Pr(h)===Ri}function ka(h){return h}function ca(h,a){const u=h.stops&&typeof h.stops[0][0]=="object",m=u||!(u||h.property!==void 0),y=h.type||(Es(a)?"exponential":"interval"),T=(function(H){switch(H.type){case"color":return rn.parse;case"padding":return fs.parse;case"numberArray":return xn.parse;case"colorArray":return Gi.parse;default:return null}})(a);if(T&&((h=Ft({},h)).stops&&(h.stops=h.stops.map((H=>[H[0],T(H[1])]))),h.default=T(h.default?h.default:a.default)),h.colorSpace&&(M=h.colorSpace)!=="rgb"&&M!=="hcl"&&M!=="lab")throw new Error(`Unknown color space: "${h.colorSpace}"`);var M;const R=(function(H){switch(H){case"exponential":return Bu;case"interval":return zu;case"categorical":return Go;case"identity":return M_;default:throw new Error(`Unknown function type "${H}"`)}})(y);let F,$;if(y==="categorical"){F=Object.create(null);for(const H of h.stops)F[H[0]]=H[1];$=typeof h.stops[0][0]}if(u){const H={},K=[];for(let fe=0;fe<h.stops.length;fe++){const ge=h.stops[fe],ve=ge[0].zoom;H[ve]===void 0&&(H[ve]={zoom:ve,type:h.type,property:h.property,default:h.default,stops:[]},K.push(ve)),H[ve].stops.push([ge[0].value,ge[1]])}const ne=[];for(const fe of K)ne.push([H[fe].zoom,ca(H[fe],a)]);const oe={name:"linear"};return{kind:"composite",interpolationType:oe,interpolationFactor:vr.interpolationFactor.bind(void 0,oe),zoomStops:ne.map((fe=>fe[0])),evaluate:({zoom:fe},ge)=>Bu({stops:ne,base:h.base},a,fe).evaluate(fe,ge)}}if(m){const H=y==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:H,interpolationFactor:vr.interpolationFactor.bind(void 0,H),zoomStops:h.stops.map((K=>K[0])),evaluate:({zoom:K})=>R(h,a,K,F,$)}}return{kind:"source",evaluate(H,K){const ne=K&&K.properties?K.properties[h.property]:void 0;return ne===void 0?jo(h.default,a.default):R(h,a,ne,F,$)}}}function jo(h,a,u){return h!==void 0?h:a!==void 0?a:u!==void 0?u:void 0}function Go(h,a,u,m,y){return jo(typeof u===y?m[u]:void 0,h.default,a.default)}function zu(h,a,u){if(ji(u)!=="number")return jo(h.default,a.default);const m=h.stops.length;if(m===1||u<=h.stops[0][0])return h.stops[0][1];if(u>=h.stops[m-1][0])return h.stops[m-1][1];const y=Ql(h.stops.map((T=>T[0])),u);return h.stops[y][1]}function Bu(h,a,u){const m=h.base!==void 0?h.base:1;if(ji(u)!=="number")return jo(h.default,a.default);const y=h.stops.length;if(y===1||u<=h.stops[0][0])return h.stops[0][1];if(u>=h.stops[y-1][0])return h.stops[y-1][1];const T=Ql(h.stops.map((H=>H[0])),u),M=(function(H,K,ne,oe){const fe=oe-ne,ge=H-ne;return fe===0?0:K===1?ge/fe:(Math.pow(K,ge)-1)/(Math.pow(K,fe)-1)})(u,m,h.stops[T][0],h.stops[T+1][0]),R=h.stops[T][1],F=h.stops[T+1][1],$=rr[a.type]||ka;return typeof R.evaluate=="function"?{evaluate(...H){const K=R.evaluate.apply(void 0,H),ne=F.evaluate.apply(void 0,H);if(K!==void 0&&ne!==void 0)return $(K,ne,M,h.colorSpace)}}:$(R,F,M,h.colorSpace)}function M_(h,a,u){switch(a.type){case"color":u=rn.parse(u);break;case"formatted":u=Ns.fromString(u.toString());break;case"resolvedImage":u=oo.fromString(u.toString());break;case"padding":u=fs.parse(u);break;case"colorArray":u=Gi.parse(u);break;case"numberArray":u=xn.parse(u);break;default:ji(u)===a.type||a.type==="enum"&&a.values[u]||(u=void 0)}return jo(u,h.default,a.default)}Vs.register(La,{error:[{kind:"error"},[ai],(h,[a])=>{throw new On(a.evaluate(h))}],typeof:[ai,[bi],(h,[a])=>tn(Pr(a.evaluate(h)))],"to-rgba":[ln(Nt,4),[Wi],(h,[a])=>{const[u,m,y,T]=a.evaluate(h).rgb;return[255*u,255*m,255*y,T]}],rgb:[Wi,[Nt,Nt,Nt],Xp],rgba:[Wi,[Nt,Nt,Nt,Nt],Xp],has:{type:pi,overloads:[[[ai],(h,[a])=>Yp(a.evaluate(h),h.properties())],[[ai,Ri],(h,[a,u])=>Yp(a.evaluate(h),u.evaluate(h))]]},get:{type:bi,overloads:[[[ai],(h,[a])=>oc(a.evaluate(h),h.properties())],[[ai,Ri],(h,[a,u])=>oc(a.evaluate(h),u.evaluate(h))]]},"feature-state":[bi,[ai],(h,[a])=>oc(a.evaluate(h),h.featureState||{})],properties:[Ri,[],h=>h.properties()],"geometry-type":[ai,[],h=>h.geometryType()],id:[bi,[],h=>h.id()],zoom:[Nt,[],h=>h.globals.zoom],"heatmap-density":[Nt,[],h=>h.globals.heatmapDensity||0],elevation:[Nt,[],h=>h.globals.elevation||0],"line-progress":[Nt,[],h=>h.globals.lineProgress||0],accumulated:[bi,[],h=>h.globals.accumulated===void 0?null:h.globals.accumulated],"+":[Nt,ut(Nt),(h,a)=>{let u=0;for(const m of a)u+=m.evaluate(h);return u}],"*":[Nt,ut(Nt),(h,a)=>{let u=1;for(const m of a)u*=m.evaluate(h);return u}],"-":{type:Nt,overloads:[[[Nt,Nt],(h,[a,u])=>a.evaluate(h)-u.evaluate(h)],[[Nt],(h,[a])=>-a.evaluate(h)]]},"/":[Nt,[Nt,Nt],(h,[a,u])=>a.evaluate(h)/u.evaluate(h)],"%":[Nt,[Nt,Nt],(h,[a,u])=>a.evaluate(h)%u.evaluate(h)],ln2:[Nt,[],()=>Math.LN2],pi:[Nt,[],()=>Math.PI],e:[Nt,[],()=>Math.E],"^":[Nt,[Nt,Nt],(h,[a,u])=>Math.pow(a.evaluate(h),u.evaluate(h))],sqrt:[Nt,[Nt],(h,[a])=>Math.sqrt(a.evaluate(h))],log10:[Nt,[Nt],(h,[a])=>Math.log(a.evaluate(h))/Math.LN10],ln:[Nt,[Nt],(h,[a])=>Math.log(a.evaluate(h))],log2:[Nt,[Nt],(h,[a])=>Math.log(a.evaluate(h))/Math.LN2],sin:[Nt,[Nt],(h,[a])=>Math.sin(a.evaluate(h))],cos:[Nt,[Nt],(h,[a])=>Math.cos(a.evaluate(h))],tan:[Nt,[Nt],(h,[a])=>Math.tan(a.evaluate(h))],asin:[Nt,[Nt],(h,[a])=>Math.asin(a.evaluate(h))],acos:[Nt,[Nt],(h,[a])=>Math.acos(a.evaluate(h))],atan:[Nt,[Nt],(h,[a])=>Math.atan(a.evaluate(h))],min:[Nt,ut(Nt),(h,a)=>Math.min(...a.map((u=>u.evaluate(h))))],max:[Nt,ut(Nt),(h,a)=>Math.max(...a.map((u=>u.evaluate(h))))],abs:[Nt,[Nt],(h,[a])=>Math.abs(a.evaluate(h))],round:[Nt,[Nt],(h,[a])=>{const u=a.evaluate(h);return u<0?-Math.round(-u):Math.round(u)}],floor:[Nt,[Nt],(h,[a])=>Math.floor(a.evaluate(h))],ceil:[Nt,[Nt],(h,[a])=>Math.ceil(a.evaluate(h))],"filter-==":[pi,[ai,bi],(h,[a,u])=>h.properties()[a.value]===u.value],"filter-id-==":[pi,[bi],(h,[a])=>h.id()===a.value],"filter-type-==":[pi,[ai],(h,[a])=>h.geometryType()===a.value],"filter-<":[pi,[ai,bi],(h,[a,u])=>{const m=h.properties()[a.value],y=u.value;return typeof m==typeof y&&m<y}],"filter-id-<":[pi,[bi],(h,[a])=>{const u=h.id(),m=a.value;return typeof u==typeof m&&u<m}],"filter->":[pi,[ai,bi],(h,[a,u])=>{const m=h.properties()[a.value],y=u.value;return typeof m==typeof y&&m>y}],"filter-id->":[pi,[bi],(h,[a])=>{const u=h.id(),m=a.value;return typeof u==typeof m&&u>m}],"filter-<=":[pi,[ai,bi],(h,[a,u])=>{const m=h.properties()[a.value],y=u.value;return typeof m==typeof y&&m<=y}],"filter-id-<=":[pi,[bi],(h,[a])=>{const u=h.id(),m=a.value;return typeof u==typeof m&&u<=m}],"filter->=":[pi,[ai,bi],(h,[a,u])=>{const m=h.properties()[a.value],y=u.value;return typeof m==typeof y&&m>=y}],"filter-id->=":[pi,[bi],(h,[a])=>{const u=h.id(),m=a.value;return typeof u==typeof m&&u>=m}],"filter-has":[pi,[bi],(h,[a])=>a.value in h.properties()],"filter-has-id":[pi,[],h=>h.id()!==null&&h.id()!==void 0],"filter-type-in":[pi,[ln(ai)],(h,[a])=>a.value.indexOf(h.geometryType())>=0],"filter-id-in":[pi,[ln(bi)],(h,[a])=>a.value.indexOf(h.id())>=0],"filter-in-small":[pi,[ai,ln(bi)],(h,[a,u])=>u.value.indexOf(h.properties()[a.value])>=0],"filter-in-large":[pi,[ai,ln(bi)],(h,[a,u])=>(function(m,y,T,M){for(;T<=M;){const R=T+M>>1;if(y[R]===m)return!0;y[R]>m?M=R-1:T=R+1}return!1})(h.properties()[a.value],u.value,0,u.value.length-1)],all:{type:pi,overloads:[[[pi,pi],(h,[a,u])=>a.evaluate(h)&&u.evaluate(h)],[ut(pi),(h,a)=>{for(const u of a)if(!u.evaluate(h))return!1;return!0}]]},any:{type:pi,overloads:[[[pi,pi],(h,[a,u])=>a.evaluate(h)||u.evaluate(h)],[ut(pi),(h,a)=>{for(const u of a)if(u.evaluate(h))return!0;return!1}]]},"!":[pi,[pi],(h,[a])=>!a.evaluate(h)],"is-supported-script":[pi,[ai],(h,[a])=>{const u=h.globals&&h.globals.isSupportedScript;return!u||u(a.evaluate(h))}],upcase:[ai,[ai],(h,[a])=>a.evaluate(h).toUpperCase()],downcase:[ai,[ai],(h,[a])=>a.evaluate(h).toLowerCase()],concat:[ai,ut(bi),(h,a)=>a.map((u=>Xl(u.evaluate(h)))).join("")],"resolved-locale":[ai,[Ni],(h,[a])=>a.evaluate(h).resolvedLocale()]});class Da{constructor(a,u,m){this.expression=a,this._warningHistory={},this._evaluator=new $o,this._defaultValue=u?(function(y){if(y.type==="color"&&Ks(y.default))return new rn(0,0,0,0);switch(y.type){case"color":return rn.parse(y.default)||null;case"padding":return fs.parse(y.default)||null;case"numberArray":return xn.parse(y.default)||null;case"colorArray":return Gi.parse(y.default)||null;case"variableAnchorOffsetCollection":return Ms.parse(y.default)||null;case"projectionDefinition":return $s.parse(y.default)||null;default:return y.default===void 0?null:y.default}})(u):null,this._enumValues=u&&u.type==="enum"?u.values:null,this._globalState=m}evaluateWithoutErrorHandling(a,u,m,y,T,M){return this._globalState&&(a=Nu(a,this._globalState)),this._evaluator.globals=a,this._evaluator.feature=u,this._evaluator.featureState=m,this._evaluator.canonical=y,this._evaluator.availableImages=T||null,this._evaluator.formattedSection=M,this.expression.evaluate(this._evaluator)}evaluate(a,u,m,y,T,M){this._globalState&&(a=Nu(a,this._globalState)),this._evaluator.globals=a,this._evaluator.feature=u||null,this._evaluator.featureState=m||null,this._evaluator.canonical=y,this._evaluator.availableImages=T||null,this._evaluator.formattedSection=M||null;try{const R=this.expression.evaluate(this._evaluator);if(R==null||typeof R=="number"&&R!=R)return this._defaultValue;if(this._enumValues&&!(R in this._enumValues))throw new On(`Expected value to be one of ${Object.keys(this._enumValues).map((F=>JSON.stringify(F))).join(", ")}, but found ${JSON.stringify(R)} instead.`);return R}catch(R){return this._warningHistory[R.message]||(this._warningHistory[R.message]=!0,typeof console<"u"&&console.warn(R.message)),this._defaultValue}}}function $c(h){return Array.isArray(h)&&h.length>0&&typeof h[0]=="string"&&h[0]in La}function cf(h,a,u){const m=new gl(La,Y,[],a?(function(T){const M={color:Wi,string:ai,number:Nt,enum:ai,boolean:pi,formatted:Kn,padding:Xi,numberArray:an,colorArray:jn,projectionDefinition:wt,resolvedImage:zr,variableAnchorOffsetCollection:Gn};return T.type==="array"?ln(M[T.value]||bi,T.length):M[T.type]})(a):void 0),y=m.parse(h,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return y?di(new Da(y,a,u)):Ti(m.errors)}class Kp{constructor(a,u,m){this.kind=a,this._styleExpression=u,this.isStateDependent=a!=="constant"&&!ht(u.expression),this.globalStateRefs=Vc(u.expression),this._globalState=m}evaluateWithoutErrorHandling(a,u,m,y,T,M){return this._globalState&&(a=Nu(a,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(a,u,m,y,T,M)}evaluate(a,u,m,y,T,M){return this._globalState&&(a=Nu(a,this._globalState)),this._styleExpression.evaluate(a,u,m,y,T,M)}}class C_{constructor(a,u,m,y,T){this.kind=a,this.zoomStops=m,this._styleExpression=u,this.isStateDependent=a!=="camera"&&!ht(u.expression),this.globalStateRefs=Vc(u.expression),this.interpolationType=y,this._globalState=T}evaluateWithoutErrorHandling(a,u,m,y,T,M){return this._globalState&&(a=Nu(a,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(a,u,m,y,T,M)}evaluate(a,u,m,y,T,M){return this._globalState&&(a=Nu(a,this._globalState)),this._styleExpression.evaluate(a,u,m,y,T,M)}interpolationFactor(a,u,m){return this.interpolationType?vr.interpolationFactor(this.interpolationType,a,u,m):0}}function E_(h,a,u){const m=cf(h,a,u);if(m.result==="error")return m;const y=m.value.expression,T=Te(y);if(!T&&!_n(a))return Ti([new Wt("","data expressions not supported")]);const M=Ht(y,["zoom"]);if(!M&&!fr(a))return Ti([new Wt("","zoom expressions not supported")]);const R=Qp(y);return R||M?R instanceof Wt?Ti([R]):R instanceof vr&&!Es(a)?Ti([new Wt("",'"interpolate" expressions cannot be used with this property')]):di(R?new C_(T?"camera":"composite",m.value,R.labels,R instanceof vr?R.interpolation:void 0,u):new Kp(T?"constant":"source",m.value,u)):Ti([new Wt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Jp{constructor(a,u){this._parameters=a,this._specification=u,Ft(this,ca(this._parameters,this._specification))}static deserialize(a){return new Jp(a._parameters,a._specification)}static serialize(a){return{_parameters:a._parameters,_specification:a._specification}}}function Qp(h){let a=null;if(h instanceof zn)a=Qp(h.result);else if(h instanceof ec){for(const u of h.args)if(a=Qp(u),a)break}else(h instanceof Ma||h instanceof vr)&&h.input instanceof Vs&&h.input.name==="zoom"&&(a=h);return a instanceof Wt||h.eachChild((u=>{const m=Qp(u);m instanceof Wt?a=m:!a&&m?a=new Wt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):a&&m&&a!==m&&(a=new Wt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),a}function Vc(h,a=new Set){return h instanceof Nc&&a.add(h.key),h.eachChild((u=>{Vc(u,a)})),a}function Nu(h,a){const{zoom:u,heatmapDensity:m,elevation:y,lineProgress:T,isSupportedScript:M,accumulated:R}=h??{};return{zoom:u,heatmapDensity:m,elevation:y,lineProgress:T,isSupportedScript:M,accumulated:R,globalState:a}}function A_(h){if(h===!0||h===!1)return!0;if(!Array.isArray(h)||h.length===0)return!1;switch(h[0]){case"has":return h.length>=2&&h[1]!=="$id"&&h[1]!=="$type";case"in":return h.length>=3&&(typeof h[1]!="string"||Array.isArray(h[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return h.length!==3||Array.isArray(h[1])||Array.isArray(h[2]);case"any":case"all":for(const a of h.slice(1))if(!A_(a)&&typeof a!="boolean")return!1;return!0;default:return!0}}const A1={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function uf(h,a){if(h==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};A_(h)||(h=hf(h));const u=cf(h,A1,a);if(u.result==="error")throw new Error(u.value.map((m=>`${m.key}: ${m.message}`)).join(", "));return{filter:(m,y,T)=>u.value.evaluate(m,y,{},T),needGeometry:T0(h),getGlobalStateRefs:()=>Vc(u.value.expression)}}function P1(h,a){return h<a?-1:h>a?1:0}function T0(h){if(!Array.isArray(h))return!1;if(h[0]==="within"||h[0]==="distance")return!0;for(let a=1;a<h.length;a++)if(T0(h[a]))return!0;return!1}function hf(h){if(!h)return!0;const a=h[0];return h.length<=1?a!=="any":a==="=="?em(h[1],h[2],"=="):a==="!="?df(em(h[1],h[2],"==")):a==="<"||a===">"||a==="<="||a===">="?em(h[1],h[2],a):a==="any"?(u=h.slice(1),["any"].concat(u.map(hf))):a==="all"?["all"].concat(h.slice(1).map(hf)):a==="none"?["all"].concat(h.slice(1).map(hf).map(df)):a==="in"?M0(h[1],h.slice(2)):a==="!in"?df(M0(h[1],h.slice(2))):a==="has"?C0(h[1]):a!=="!has"||df(C0(h[1]));var u}function em(h,a,u){switch(h){case"$type":return[`filter-type-${u}`,a];case"$id":return[`filter-id-${u}`,a];default:return[`filter-${u}`,h,a]}}function M0(h,a){if(a.length===0)return!1;switch(h){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some((u=>typeof u!=typeof a[0]))?["filter-in-large",h,["literal",a.sort(P1)]]:["filter-in-small",h,["literal",a]]}}function C0(h){switch(h){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",h]}}function df(h){return["!",h]}function tm(h){const a=typeof h;if(a==="number"||a==="boolean"||a==="string"||h==null)return JSON.stringify(h);if(Array.isArray(h)){let y="[";for(const T of h)y+=`${tm(T)},`;return`${y}]`}const u=Object.keys(h).sort();let m="{";for(let y=0;y<u.length;y++)m+=`${JSON.stringify(u[y])}:${tm(h[u[y]])},`;return`${m}}`}function E0(h){let a="";for(const u of gn)a+=`/${tm(h[u])}`;return a}function A0(h){const a=h.value;return a?[new lt(h.key,a,"constants have been deprecated as of v8")]:[]}function Wr(h){return h instanceof Number||h instanceof String||h instanceof Boolean?h.valueOf():h}function $u(h){if(Array.isArray(h))return h.map($u);if(h instanceof Object&&!(h instanceof Number||h instanceof String||h instanceof Boolean)){const a={};for(const u in h)a[u]=$u(h[u]);return a}return Wr(h)}function qo(h){const a=h.key,u=h.value,m=h.valueSpec||{},y=h.objectElementValidators||{},T=h.style,M=h.styleSpec,R=h.validateSpec;let F=[];const $=ji(u);if($!=="object")return[new lt(a,u,`object expected, ${$} found`)];for(const H in u){const K=H.split(".")[0],ne=Tu(m,K)||m["*"];let oe;if(Tu(y,K))oe=y[K];else if(Tu(m,K)){if(u[H]===void 0)continue;oe=R}else if(y["*"])oe=y["*"];else{if(!m["*"]){F.push(new lt(a,u[H],`unknown property "${H}"`));continue}oe=R}F=F.concat(oe({key:(a&&`${a}.`)+H,value:u[H],valueSpec:ne,style:T,styleSpec:M,object:u,objectKey:H,validateSpec:R},u))}for(const H in m)y[H]||m[H].required&&m[H].default===void 0&&u[H]===void 0&&F.push(new lt(a,u,`missing required property "${H}"`));return F}function im(h){const a=h.value,u=h.valueSpec,m=h.style,y=h.styleSpec,T=h.key,M=h.arrayElementValidator||h.validateSpec;if(ji(a)!=="array")return[new lt(T,a,`array expected, ${ji(a)} found`)];if(u.length&&a.length!==u.length)return[new lt(T,a,`array length ${u.length} expected, length ${a.length} found`)];let R={type:u.value,values:u.values};y.$version<7&&(R.function=u.function),ji(u.value)==="object"&&(R=u.value);let F=[];for(let $=0;$<a.length;$++)F=F.concat(M({array:a,arrayIndex:$,value:a[$],valueSpec:R,validateSpec:h.validateSpec,style:m,styleSpec:y,key:`${T}[${$}]`}));return F}function ff(h){const a=h.key,u=h.value,m=h.valueSpec;let y=ji(u);return y==="number"&&u!=u&&(y="NaN"),y!=="number"?[new lt(a,u,`number expected, ${y} found`)]:"minimum"in m&&u<m.minimum?[new lt(a,u,`${u} is less than the minimum value ${m.minimum}`)]:"maximum"in m&&u>m.maximum?[new lt(a,u,`${u} is greater than the maximum value ${m.maximum}`)]:[]}function nm(h){const a=h.valueSpec,u=Wr(h.value.type);let m,y,T,M={};const R=u!=="categorical"&&h.value.property===void 0,F=!R,$=ji(h.value.stops)==="array"&&ji(h.value.stops[0])==="array"&&ji(h.value.stops[0][0])==="object",H=qo({key:h.key,value:h.value,valueSpec:h.styleSpec.function,validateSpec:h.validateSpec,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(oe){if(u==="identity")return[new lt(oe.key,oe.value,'identity function may not have a "stops" property')];let fe=[];const ge=oe.value;return fe=fe.concat(im({key:oe.key,value:ge,valueSpec:oe.valueSpec,validateSpec:oe.validateSpec,style:oe.style,styleSpec:oe.styleSpec,arrayElementValidator:K})),ji(ge)==="array"&&ge.length===0&&fe.push(new lt(oe.key,ge,"array must have at least one stop")),fe},default:function(oe){return oe.validateSpec({key:oe.key,value:oe.value,valueSpec:a,validateSpec:oe.validateSpec,style:oe.style,styleSpec:oe.styleSpec})}}});return u==="identity"&&R&&H.push(new lt(h.key,h.value,'missing required property "property"')),u==="identity"||h.value.stops||H.push(new lt(h.key,h.value,'missing required property "stops"')),u==="exponential"&&h.valueSpec.expression&&!Es(h.valueSpec)&&H.push(new lt(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(F&&!_n(h.valueSpec)?H.push(new lt(h.key,h.value,"property functions not supported")):R&&!fr(h.valueSpec)&&H.push(new lt(h.key,h.value,"zoom functions not supported"))),u!=="categorical"&&!$||h.value.property!==void 0||H.push(new lt(h.key,h.value,'"property" property is required')),H;function K(oe){let fe=[];const ge=oe.value,ve=oe.key;if(ji(ge)!=="array")return[new lt(ve,ge,`array expected, ${ji(ge)} found`)];if(ge.length!==2)return[new lt(ve,ge,`array length 2 expected, length ${ge.length} found`)];if($){if(ji(ge[0])!=="object")return[new lt(ve,ge,`object expected, ${ji(ge[0])} found`)];if(ge[0].zoom===void 0)return[new lt(ve,ge,"object stop key must have zoom")];if(ge[0].value===void 0)return[new lt(ve,ge,"object stop key must have value")];if(T&&T>Wr(ge[0].zoom))return[new lt(ve,ge[0].zoom,"stop zoom values must appear in ascending order")];Wr(ge[0].zoom)!==T&&(T=Wr(ge[0].zoom),y=void 0,M={}),fe=fe.concat(qo({key:`${ve}[0]`,value:ge[0],valueSpec:{zoom:{}},validateSpec:oe.validateSpec,style:oe.style,styleSpec:oe.styleSpec,objectElementValidators:{zoom:ff,value:ne}}))}else fe=fe.concat(ne({key:`${ve}[0]`,value:ge[0],validateSpec:oe.validateSpec,style:oe.style,styleSpec:oe.styleSpec},ge));return $c($u(ge[1]))?fe.concat([new lt(`${ve}[1]`,ge[1],"expressions are not allowed in function stops.")]):fe.concat(oe.validateSpec({key:`${ve}[1]`,value:ge[1],valueSpec:a,validateSpec:oe.validateSpec,style:oe.style,styleSpec:oe.styleSpec}))}function ne(oe,fe){const ge=ji(oe.value),ve=Wr(oe.value),Pe=oe.value!==null?oe.value:fe;if(m){if(ge!==m)return[new lt(oe.key,Pe,`${ge} stop domain type must match previous stop domain type ${m}`)]}else m=ge;if(ge!=="number"&&ge!=="string"&&ge!=="boolean")return[new lt(oe.key,Pe,"stop domain value must be a number, string, or boolean")];if(ge!=="number"&&u!=="categorical"){let Ge=`number expected, ${ge} found`;return _n(a)&&u===void 0&&(Ge+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new lt(oe.key,Pe,Ge)]}return u!=="categorical"||ge!=="number"||isFinite(ve)&&Math.floor(ve)===ve?u!=="categorical"&&ge==="number"&&y!==void 0&&ve<y?[new lt(oe.key,Pe,"stop domain values must appear in ascending order")]:(y=ve,u==="categorical"&&ve in M?[new lt(oe.key,Pe,"stop domain values must be unique")]:(M[ve]=!0,[])):[new lt(oe.key,Pe,`integer expected, found ${ve}`)]}}function Uc(h){const a=(h.expressionContext==="property"?E_:cf)($u(h.value),h.valueSpec);if(a.result==="error")return a.value.map((m=>new lt(`${h.key}${m.key}`,h.value,m.message)));const u=a.value.expression||a.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!u.outputDefined())return[new lt(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!ht(u))return[new lt(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter"&&!ht(u))return[new lt(h.key,h.value,'"feature-state" data expressions are not supported with filters.')];if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!Ht(u,["zoom","feature-state"]))return[new lt(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!Te(u))return[new lt(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function pf(h){const a=h.key,u=h.value,m=ji(u);return m!=="string"?[new lt(a,u,`color expected, ${m} found`)]:rn.parse(String(u))?[]:[new lt(a,u,`color expected, "${u}" found`)]}function Vu(h){const a=h.key,u=h.value,m=h.valueSpec,y=[];return Array.isArray(m.values)?m.values.indexOf(Wr(u))===-1&&y.push(new lt(a,u,`expected one of [${m.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(m.values).indexOf(Wr(u))===-1&&y.push(new lt(a,u,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(u)} found`)),y}function Yh(h){return A_($u(h.value))?Uc(Ft({},h,{expressionContext:"filter",valueSpec:{value:"boolean"}})):P0(h)}function P0(h){const a=h.value,u=h.key;if(ji(a)!=="array")return[new lt(u,a,`array expected, ${ji(a)} found`)];const m=h.styleSpec;let y,T=[];if(a.length<1)return[new lt(u,a,"filter array must have at least 1 element")];switch(T=T.concat(Vu({key:`${u}[0]`,value:a[0],valueSpec:m.filter_operator,style:h.style,styleSpec:h.styleSpec})),Wr(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&Wr(a[1])==="$type"&&T.push(new lt(u,a,`"$type" cannot be use with operator "${a[0]}"`));case"==":case"!=":a.length!==3&&T.push(new lt(u,a,`filter array for operator "${a[0]}" must have 3 elements`));case"in":case"!in":a.length>=2&&(y=ji(a[1]),y!=="string"&&T.push(new lt(`${u}[1]`,a[1],`string expected, ${y} found`)));for(let M=2;M<a.length;M++)y=ji(a[M]),Wr(a[1])==="$type"?T=T.concat(Vu({key:`${u}[${M}]`,value:a[M],valueSpec:m.geometry_type,style:h.style,styleSpec:h.styleSpec})):y!=="string"&&y!=="number"&&y!=="boolean"&&T.push(new lt(`${u}[${M}]`,a[M],`string, number, or boolean expected, ${y} found`));break;case"any":case"all":case"none":for(let M=1;M<a.length;M++)T=T.concat(P0({key:`${u}[${M}]`,value:a[M],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":y=ji(a[1]),a.length!==2?T.push(new lt(u,a,`filter array for "${a[0]}" operator must have 2 elements`)):y!=="string"&&T.push(new lt(`${u}[1]`,a[1],`string expected, ${y} found`))}return T}function I0(h,a){const u=h.key,m=h.validateSpec,y=h.style,T=h.styleSpec,M=h.value,R=h.objectKey,F=T[`${a}_${h.layerType}`];if(!F)return[];const $=R.match(/^(.*)-transition$/);if(a==="paint"&&$&&F[$[1]]&&F[$[1]].transition)return m({key:u,value:M,valueSpec:T.transition,style:y,styleSpec:T});const H=h.valueSpec||F[R];if(!H)return[new lt(u,M,`unknown property "${R}"`)];let K;if(ji(M)==="string"&&_n(H)&&!H.tokens&&(K=/^{([^}]+)}$/.exec(M)))return[new lt(u,M,`"${R}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(K[1])} }\`.`)];const ne=[];return h.layerType==="symbol"&&R==="text-font"&&Ks($u(M))&&Wr(M.type)==="identity"&&ne.push(new lt(u,M,'"text-font" does not support identity functions')),ne.concat(m({key:h.key,value:M,valueSpec:H,style:y,styleSpec:T,expressionContext:"property",propertyType:a,propertyKey:R}))}function R0(h){return I0(h,"paint")}function L0(h){return I0(h,"layout")}function k0(h){let a=[];const u=h.value,m=h.key,y=h.style,T=h.styleSpec;if(ji(u)!=="object")return[new lt(m,u,`object expected, ${ji(u)} found`)];u.type||u.ref||a.push(new lt(m,u,'either "type" or "ref" is required'));let M=Wr(u.type);const R=Wr(u.ref);if(u.id){const F=Wr(u.id);for(let $=0;$<h.arrayIndex;$++){const H=y.layers[$];Wr(H.id)===F&&a.push(new lt(m,u.id,`duplicate layer id "${u.id}", previously used at line ${H.id.__line__}`))}}if("ref"in u){let F;["type","source","source-layer","filter","layout"].forEach(($=>{$ in u&&a.push(new lt(m,u[$],`"${$}" is prohibited for ref layers`))})),y.layers.forEach(($=>{Wr($.id)===R&&(F=$)})),F?F.ref?a.push(new lt(m,u.ref,"ref cannot reference another ref layer")):M=Wr(F.type):a.push(new lt(m,u.ref,`ref layer "${R}" not found`))}else if(M!=="background")if(u.source){const F=y.sources&&y.sources[u.source],$=F&&Wr(F.type);F?$==="vector"&&M==="raster"?a.push(new lt(m,u.source,`layer "${u.id}" requires a raster source`)):$!=="raster-dem"&&M==="hillshade"||$!=="raster-dem"&&M==="color-relief"?a.push(new lt(m,u.source,`layer "${u.id}" requires a raster-dem source`)):$==="raster"&&M!=="raster"?a.push(new lt(m,u.source,`layer "${u.id}" requires a vector source`)):$!=="vector"||u["source-layer"]?$==="raster-dem"&&M!=="hillshade"&&M!=="color-relief"?a.push(new lt(m,u.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):M!=="line"||!u.paint||!u.paint["line-gradient"]||$==="geojson"&&F.lineMetrics||a.push(new lt(m,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):a.push(new lt(m,u,`layer "${u.id}" must specify a "source-layer"`)):a.push(new lt(m,u.source,`source "${u.source}" not found`))}else a.push(new lt(m,u,'missing required property "source"'));return a=a.concat(qo({key:m,value:u,valueSpec:T.layer,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,objectElementValidators:{"*":()=>[],type:()=>h.validateSpec({key:`${m}.type`,value:u.type,valueSpec:T.layer.type,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,object:u,objectKey:"type"}),filter:Yh,layout:F=>qo({layer:u,key:F.key,value:F.value,style:F.style,styleSpec:F.styleSpec,validateSpec:F.validateSpec,objectElementValidators:{"*":$=>L0(Ft({layerType:M},$))}}),paint:F=>qo({layer:u,key:F.key,value:F.value,style:F.style,styleSpec:F.styleSpec,validateSpec:F.validateSpec,objectElementValidators:{"*":$=>R0(Ft({layerType:M},$))}})}})),a}function jc(h){const a=h.value,u=h.key,m=ji(a);return m!=="string"?[new lt(u,a,`string expected, ${m} found`)]:[]}const P_={promoteId:function({key:h,value:a}){if(ji(a)==="string")return jc({key:h,value:a});{const u=[];for(const m in a)u.push(...jc({key:`${h}.${m}`,value:a[m]}));return u}}};function I_(h){const a=h.value,u=h.key,m=h.styleSpec,y=h.style,T=h.validateSpec;if(!a.type)return[new lt(u,a,'"type" is required')];const M=Wr(a.type);let R;switch(M){case"vector":case"raster":return R=qo({key:u,value:a,valueSpec:m[`source_${M.replace("-","_")}`],style:h.style,styleSpec:m,objectElementValidators:P_,validateSpec:T}),R;case"raster-dem":return R=(function(F){var $;const H=($=F.sourceName)!==null&&$!==void 0?$:"",K=F.value,ne=F.styleSpec,oe=ne.source_raster_dem,fe=F.style;let ge=[];const ve=ji(K);if(K===void 0)return ge;if(ve!=="object")return ge.push(new lt("source_raster_dem",K,`object expected, ${ve} found`)),ge;const Pe=Wr(K.encoding)==="custom",Ge=["redFactor","greenFactor","blueFactor","baseShift"],Ie=F.value.encoding?`"${F.value.encoding}"`:"Default";for(const Re in K)!Pe&&Ge.includes(Re)?ge.push(new lt(Re,K[Re],`In "${H}": "${Re}" is only valid when "encoding" is set to "custom". ${Ie} encoding found`)):oe[Re]?ge=ge.concat(F.validateSpec({key:Re,value:K[Re],valueSpec:oe[Re],validateSpec:F.validateSpec,style:fe,styleSpec:ne})):ge.push(new lt(Re,K[Re],`unknown property "${Re}"`));return ge})({sourceName:u,value:a,style:h.style,styleSpec:m,validateSpec:T}),R;case"geojson":if(R=qo({key:u,value:a,valueSpec:m.source_geojson,style:y,styleSpec:m,validateSpec:T,objectElementValidators:P_}),a.cluster)for(const F in a.clusterProperties){const[$,H]=a.clusterProperties[F],K=typeof $=="string"?[$,["accumulated"],["get",F]]:$;R.push(...Uc({key:`${u}.${F}.map`,value:H,expressionContext:"cluster-map"})),R.push(...Uc({key:`${u}.${F}.reduce`,value:K,expressionContext:"cluster-reduce"}))}return R;case"video":return qo({key:u,value:a,valueSpec:m.source_video,style:y,validateSpec:T,styleSpec:m});case"image":return qo({key:u,value:a,valueSpec:m.source_image,style:y,validateSpec:T,styleSpec:m});case"canvas":return[new lt(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Vu({key:`${u}.type`,value:a.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function mf(h){const a=h.value,u=h.styleSpec,m=u.light,y=h.style;let T=[];const M=ji(a);if(a===void 0)return T;if(M!=="object")return T=T.concat([new lt("light",a,`object expected, ${M} found`)]),T;for(const R in a){const F=R.match(/^(.*)-transition$/);T=T.concat(F&&m[F[1]]&&m[F[1]].transition?h.validateSpec({key:R,value:a[R],valueSpec:u.transition,validateSpec:h.validateSpec,style:y,styleSpec:u}):m[R]?h.validateSpec({key:R,value:a[R],valueSpec:m[R],validateSpec:h.validateSpec,style:y,styleSpec:u}):[new lt(R,a[R],`unknown property "${R}"`)])}return T}function D0(h){const a=h.value,u=h.styleSpec,m=u.sky,y=h.style,T=ji(a);if(a===void 0)return[];if(T!=="object")return[new lt("sky",a,`object expected, ${T} found`)];let M=[];for(const R in a)M=M.concat(m[R]?h.validateSpec({key:R,value:a[R],valueSpec:m[R],style:y,styleSpec:u}):[new lt(R,a[R],`unknown property "${R}"`)]);return M}function R_(h){const a=h.value,u=h.styleSpec,m=u.terrain,y=h.style;let T=[];const M=ji(a);if(a===void 0)return T;if(M!=="object")return T=T.concat([new lt("terrain",a,`object expected, ${M} found`)]),T;for(const R in a)T=T.concat(m[R]?h.validateSpec({key:R,value:a[R],valueSpec:m[R],validateSpec:h.validateSpec,style:y,styleSpec:u}):[new lt(R,a[R],`unknown property "${R}"`)]);return T}function L_(h){let a=[];const u=h.value,m=h.key;if(Array.isArray(u)){const y=[],T=[];for(const M in u)u[M].id&&y.includes(u[M].id)&&a.push(new lt(m,u,`all the sprites' ids must be unique, but ${u[M].id} is duplicated`)),y.push(u[M].id),u[M].url&&T.includes(u[M].url)&&a.push(new lt(m,u,`all the sprites' URLs must be unique, but ${u[M].url} is duplicated`)),T.push(u[M].url),a=a.concat(qo({key:`${m}[${M}]`,value:u[M],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:h.validateSpec}));return a}return jc({key:m,value:u})}function F0(h){return!!h&&h.constructor===Object}function k_(h){return F0(h.value)?[]:[new lt(h.key,h.value,`object expected, ${ji(h.value)} found`)]}const D_={"*":()=>[],array:im,boolean:function(h){const a=h.value,u=h.key,m=ji(a);return m!=="boolean"?[new lt(u,a,`boolean expected, ${m} found`)]:[]},number:ff,color:pf,constants:A0,enum:Vu,filter:Yh,function:nm,layer:k0,object:qo,source:I_,light:mf,sky:D0,terrain:R_,projection:function(h){const a=h.value,u=h.styleSpec,m=u.projection,y=h.style,T=ji(a);if(a===void 0)return[];if(T!=="object")return[new lt("projection",a,`object expected, ${T} found`)];let M=[];for(const R in a)M=M.concat(m[R]?h.validateSpec({key:R,value:a[R],valueSpec:m[R],style:y,styleSpec:u}):[new lt(R,a[R],`unknown property "${R}"`)]);return M},projectionDefinition:function(h){const a=h.key;let u=h.value;u=u instanceof String?u.valueOf():u;const m=ji(u);return m!=="array"||(function(y){return Array.isArray(y)&&y.length===3&&typeof y[0]=="string"&&typeof y[1]=="string"&&typeof y[2]=="number"})(u)||(function(y){return!!["interpolate","step","literal"].includes(y[0])})(u)?["array","string"].includes(m)?[]:[new lt(a,u,`projection expected, invalid type "${m}" found`)]:[new lt(a,u,`projection expected, invalid array ${JSON.stringify(u)} found`)]},string:jc,formatted:function(h){return jc(h).length===0?[]:Uc(h)},resolvedImage:function(h){return jc(h).length===0?[]:Uc(h)},padding:function(h){const a=h.key,u=h.value;if(ji(u)==="array"){if(u.length<1||u.length>4)return[new lt(a,u,`padding requires 1 to 4 values; ${u.length} values found`)];const m={type:"number"};let y=[];for(let T=0;T<u.length;T++)y=y.concat(h.validateSpec({key:`${a}[${T}]`,value:u[T],validateSpec:h.validateSpec,valueSpec:m}));return y}return ff({key:a,value:u,valueSpec:{}})},numberArray:function(h){const a=h.key,u=h.value;if(ji(u)==="array"){const m={type:"number"};if(u.length<1)return[new lt(a,u,"array length at least 1 expected, length 0 found")];let y=[];for(let T=0;T<u.length;T++)y=y.concat(h.validateSpec({key:`${a}[${T}]`,value:u[T],validateSpec:h.validateSpec,valueSpec:m}));return y}return ff({key:a,value:u,valueSpec:{}})},colorArray:function(h){const a=h.key,u=h.value;if(ji(u)==="array"){if(u.length<1)return[new lt(a,u,"array length at least 1 expected, length 0 found")];let m=[];for(let y=0;y<u.length;y++)m=m.concat(pf({key:`${a}[${y}]`,value:u[y]}));return m}return pf({key:a,value:u})},variableAnchorOffsetCollection:function(h){const a=h.key,u=h.value,m=ji(u),y=h.styleSpec;if(m!=="array"||u.length<1||u.length%2!=0)return[new lt(a,u,"variableAnchorOffsetCollection requires a non-empty array of even length")];let T=[];for(let M=0;M<u.length;M+=2)T=T.concat(Vu({key:`${a}[${M}]`,value:u[M],valueSpec:y.layout_symbol["text-anchor"]})),T=T.concat(im({key:`${a}[${M+1}]`,value:u[M+1],valueSpec:{length:2,value:"number"},validateSpec:h.validateSpec,style:h.style,styleSpec:y}));return T},sprite:L_,state:k_,fontFaces:function(h){const a=h.key,u=h.value,m=h.validateSpec,y=h.styleSpec,T=h.style;if(!F0(u))return[new lt(a,u,`object expected, ${ji(u)} found`)];const M=[];for(const R in u){const F=u[R],$=ji(F);if($==="string")M.push(...jc({key:`${a}.${R}`,value:F}));else if($==="array"){const H={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(const[K,ne]of F.entries())M.push(...qo({key:`${a}.${R}[${K}]`,value:ne,valueSpec:H,styleSpec:y,style:T,validateSpec:m}))}else M.push(new lt(`${a}.${R}`,F,`string or array expected, ${$} found`))}return M}};function Gc(h){const a=h.value,u=h.valueSpec,m=h.styleSpec;return h.validateSpec=Gc,u.expression&&Ks(Wr(a))?nm(h):u.expression&&$c($u(a))?Uc(h):u.type&&D_[u.type]?D_[u.type](h):qo(Ft({},h,{valueSpec:u.type?m[u.type]:u}))}function O0(h){const a=h.value,u=h.key,m=jc(h);return m.length||(a.indexOf("{fontstack}")===-1&&m.push(new lt(u,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&m.push(new lt(u,a,'"glyphs" url must include a "{range}" token'))),m}function ua(h,a=Tt){let u=[];return u=u.concat(Gc({key:"",value:h,valueSpec:a.$root,styleSpec:a,style:h,validateSpec:Gc,objectElementValidators:{glyphs:O0,"*":()=>[]}})),h.constants&&(u=u.concat(A0({key:"constants",value:h.constants}))),z0(u)}function Fa(h){return function(a){return h(Object.assign({},a,{validateSpec:Gc}))}}function z0(h){return[].concat(h).sort(((a,u)=>a.line-u.line))}function Oa(h){return function(...a){return z0(h.apply(this,a))}}ua.source=Oa(Fa(I_)),ua.sprite=Oa(Fa(L_)),ua.glyphs=Oa(Fa(O0)),ua.light=Oa(Fa(mf)),ua.sky=Oa(Fa(D0)),ua.terrain=Oa(Fa(R_)),ua.state=Oa(Fa(k_)),ua.layer=Oa(Fa(k0)),ua.filter=Oa(Fa(Yh)),ua.paintProperty=Oa(Fa(R0)),ua.layoutProperty=Oa(Fa(L0));const I1={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class gf{constructor(a,u){this._globalState=u,this.setValue(a)}evaluate(){var a;return(a=this._literalValue)!==null&&a!==void 0?a:this._compiledValue.evaluate({})}setValue(a){if(a==null||a==="visible"||a==="none")return this._literalValue=a==="none"?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);const u=cf(a,I1,this._globalState);if(u.result==="error")throw this._literalValue="visible",this._compiledValue=void 0,new Error(u.value.map((m=>`${m.key}: ${m.message}`)).join(", "));this._literalValue=void 0,this._compiledValue=u.value,this._globalStateRefs=Vc(u.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}const _f=Tt,As=ua,vf=As.light,B0=As.sky,R1=As.paintProperty,L1=As.layoutProperty;function Kh(h,a){let u=!1;if(a&&a.length)for(const m of a)h.fire(new vn(new Error(m.message))),u=!0;return u}class Jh{constructor(a,u,m){const y=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;const M=new Int32Array(this.arrayBuffer);a=M[0],this.d=(u=M[1])+2*(m=M[2]);for(let F=0;F<this.d*this.d;F++){const $=M[3+F],H=M[3+F+1];y.push($===H?null:M.subarray($,H))}const R=M[3+y.length+1];this.keys=M.subarray(M[3+y.length],R),this.bboxes=M.subarray(R),this.insert=this._insertReadonly}else{this.d=u+2*m;for(let M=0;M<this.d*this.d;M++)y.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=a,this.padding=m,this.scale=u/a,this.uid=0;const T=m/u*a;this.min=-T,this.max=a+T}insert(a,u,m,y,T){this._forEachCell(u,m,y,T,this._insertCell,this.uid++,void 0,void 0),this.keys.push(a),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(y),this.bboxes.push(T)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(a,u,m,y,T,M){this.cells[T].push(M)}query(a,u,m,y,T){const M=this.min,R=this.max;if(a<=M&&u<=M&&R<=m&&R<=y&&!T)return Array.prototype.slice.call(this.keys);{const F=[];return this._forEachCell(a,u,m,y,this._queryCell,F,{},T),F}}_queryCell(a,u,m,y,T,M,R,F){const $=this.cells[T];if($!==null){const H=this.keys,K=this.bboxes;for(let ne=0;ne<$.length;ne++){const oe=$[ne];if(R[oe]===void 0){const fe=4*oe;(F?F(K[fe+0],K[fe+1],K[fe+2],K[fe+3]):a<=K[fe+2]&&u<=K[fe+3]&&m>=K[fe+0]&&y>=K[fe+1])?(R[oe]=!0,M.push(H[oe])):R[oe]=!1}}}}_forEachCell(a,u,m,y,T,M,R,F){const $=this._convertToCellCoord(a),H=this._convertToCellCoord(u),K=this._convertToCellCoord(m),ne=this._convertToCellCoord(y);for(let oe=$;oe<=K;oe++)for(let fe=H;fe<=ne;fe++){const ge=this.d*fe+oe;if((!F||F(this._convertFromCellCoord(oe),this._convertFromCellCoord(fe),this._convertFromCellCoord(oe+1),this._convertFromCellCoord(fe+1)))&&T.call(this,a,u,m,y,ge,M,R,F))return}}_convertFromCellCoord(a){return(a-this.padding)/this.scale}_convertToCellCoord(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const a=this.cells,u=3+this.cells.length+1+1;let m=0;for(let M=0;M<this.cells.length;M++)m+=this.cells[M].length;const y=new Int32Array(u+m+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;let T=u;for(let M=0;M<a.length;M++){const R=a[M];y[3+M]=T,y.set(R,T),T+=R.length}return y[3+a.length]=T,y.set(this.keys,T),T+=this.keys.length,y[3+a.length+1]=T,y.set(this.bboxes,T),T+=this.bboxes.length,y.buffer}static serialize(a,u){const m=a.toArrayBuffer();return u&&u.push(m),{buffer:m}}static deserialize(a){return new Jh(a.buffer)}}const za={};function mi(h,a,u={}){if(za[h])throw new Error(`${h} is already registered.`);Object.defineProperty(a,"_classRegistryKey",{value:h,writeable:!1}),za[h]={klass:a,omit:u.omit||[],shallow:u.shallow||[]}}mi("Object",Object),mi("Set",Set),mi("TransferableGridIndex",Jh),mi("Color",rn),mi("Error",Error),mi("AJAXError",rt),mi("ResolvedImage",oo),mi("StylePropertyFunction",Jp),mi("StyleExpression",Da,{omit:["_evaluator"]}),mi("ZoomDependentExpression",C_),mi("ZoomConstantExpression",Kp),mi("CompoundExpression",Vs,{omit:["_evaluate"]});for(const h in La)La[h]._classRegistryKey||mi(`Expression_${h}`,La[h]);function rm(h){return h&&typeof ArrayBuffer<"u"&&(h instanceof ArrayBuffer||h.constructor&&h.constructor.name==="ArrayBuffer")}function F_(h){return h.$name||h.constructor._classRegistryKey}function Qh(h){return!(function(a){if(a===null||typeof a!="object")return!1;const u=F_(a);return!(!u||u==="Object")})(h)&&(h==null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||h instanceof Boolean||h instanceof Number||h instanceof String||h instanceof Date||h instanceof RegExp||h instanceof Blob||h instanceof Error||rm(h)||we(h)||ArrayBuffer.isView(h)||h instanceof ImageData)}function yf(h,a){if(Qh(h))return(rm(h)||we(h))&&a&&a.push(h),ArrayBuffer.isView(h)&&a&&a.push(h.buffer),h instanceof ImageData&&a&&a.push(h.data.buffer),h;if(Array.isArray(h)){const T=[];for(const M of h)T.push(yf(M,a));return T}if(typeof h!="object")throw new Error("can't serialize object of type "+typeof h);const u=F_(h);if(!u)throw new Error(`can't serialize object of unregistered class ${h.constructor.name}`);if(!za[u])throw new Error(`${u} is not registered.`);const{klass:m}=za[u],y=m.serialize?m.serialize(h,a):{};if(m.serialize){if(a&&y===a[a.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const T in h){if(!h.hasOwnProperty(T)||za[u].omit.indexOf(T)>=0)continue;const M=h[T];y[T]=za[u].shallow.indexOf(T)>=0?M:yf(M,a)}h instanceof Error&&(y.message=h.message)}if(y.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(y.$name=u),y}function bf(h){if(Qh(h))return h;if(Array.isArray(h))return h.map(bf);if(typeof h!="object")throw new Error("can't deserialize object of type "+typeof h);const a=F_(h)||"Object";if(!za[a])throw new Error(`can't deserialize unregistered class ${a}`);const{klass:u}=za[a];if(!u)throw new Error(`can't deserialize unregistered class ${a}`);if(u.deserialize)return u.deserialize(h);const m=Object.create(u.prototype);for(const y of Object.keys(h)){if(y==="$name")continue;const T=h[y];m[y]=za[a].shallow.indexOf(y)>=0?T:bf(T)}return m}class O_{constructor(){this.first=!0}update(a,u){const m=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=m,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=m,!0):(this.lastFloorZoom>m?(this.lastIntegerZoom=m+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<m&&(this.lastIntegerZoom=m,this.lastIntegerZoomTime=u),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=m,!0))}}function xf(h){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(h))}function z_(h){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(h))}function N0(h){return/\s/u.test(String.fromCodePoint(h))}function ed(h){for(const a of h)if(z_(a.codePointAt(0)))return!0;return!1}function k1(h){for(const a of h)if(!$0(a.codePointAt(0)))return!1;return!0}function sm(h){const a=h.map((u=>{try{return new RegExp(`\\p{sc=${u}}`,"u").source}catch{return null}})).filter((u=>u));return new RegExp(a.join("|"),"u")}const om=sm(["Arab","Dupl","Mong","Ougr","Syrc"]);function $0(h){return!om.test(String.fromCodePoint(h))}function B_(h){return!(z_(h)||(a=h,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(a))));var a}const V0=sm(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function N_(h){return V0.test(String.fromCodePoint(h))}function $_(h,a){return!(!a&&N_(h)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(h)))}function U0(h){for(const a of h)if(N_(a.codePointAt(0)))return!0;return!1}const qc=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(h){this.pluginStatus=h.pluginStatus,this.pluginURL=h.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(h){if(qc.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=h.applyArabicShaping,this.processBidirectionalText=h.processBidirectionalText,this.processStyledBidirectionalText=h.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(h,a){return s(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(h.pluginStatus!=="loading")return this.setState(h),h;const u=h.pluginURL,m=new Promise((T=>{this.loadScriptResolve=T}));a(u);const y=new Promise((T=>setTimeout((()=>T()),this.TIMEOUT)));if(yield Promise.race([m,y]),this.isParsed()){const T={pluginStatus:"loaded",pluginURL:u};return this.setState(T),T}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${u}`)}))}};class qn{constructor(a,u){this.isSupportedScript=D1,this.zoom=a,u?(this.now=u.now||0,this.fadeDuration=u.fadeDuration||0,this.zoomHistory=u.zoomHistory||new O_,this.transition=u.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new O_,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const a=this.zoom,u=a-Math.floor(a),m=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*m}:{fromScale:.5,toScale:1,t:1-(1-m)*u}}}function D1(h){return(function(a,u){for(const m of a)if(!$_(m.codePointAt(0),u))return!1;return!0})(h,qc.getRTLTextPluginStatus()==="loaded")}const wf="-transition";class am{constructor(a,u,m){this.property=a,this.value=u,this.expression=(function(y,T,M){if(Ks(y))return new Jp(y,T);if($c(y)){const R=E_(y,T,M);if(R.result==="error")throw new Error(R.value.map((F=>`${F.key}: ${F.message}`)).join(", "));return R.value}{let R=y;return T.type==="color"&&typeof y=="string"?R=rn.parse(y):T.type!=="padding"||typeof y!="number"&&!Array.isArray(y)?T.type!=="numberArray"||typeof y!="number"&&!Array.isArray(y)?T.type!=="colorArray"||typeof y!="string"&&!Array.isArray(y)?T.type==="variableAnchorOffsetCollection"&&Array.isArray(y)?R=Ms.parse(y):T.type==="projectionDefinition"&&typeof y=="string"&&(R=$s.parse(y)):R=Gi.parse(y):R=xn.parse(y):R=fs.parse(y),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>R}}})(u===void 0?a.specification.default:u,a.specification,m)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(a,u,m){return this.property.possiblyEvaluate(this,a,u,m)}}class lm{constructor(a,u){this.property=a,this.value=new am(a,void 0,u)}transitioned(a,u){return new j0(this.property,this.value,u,Je({},a.transition,this.transition),a.now)}untransitioned(){return new j0(this.property,this.value,null,{},0)}}class V_{constructor(a,u){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues),this._globalState=u}getValue(a){return me(this._values[a].value.value)}setValue(a,u){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new lm(this._values[a].property,this._globalState)),this._values[a].value=new am(this._values[a].property,u===null?void 0:me(u),this._globalState)}getTransition(a){return me(this._values[a].transition)}setTransition(a,u){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new lm(this._values[a].property,this._globalState)),this._values[a].transition=me(u)||void 0}serialize(){const a={};for(const u of Object.keys(this._values)){const m=this.getValue(u);m!==void 0&&(a[u]=m);const y=this.getTransition(u);y!==void 0&&(a[`${u}${wf}`]=y)}return a}transitioned(a,u){const m=new G0(this._properties);for(const y of Object.keys(this._values))m._values[y]=this._values[y].transitioned(a,u._values[y]);return m}untransitioned(){const a=new G0(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].untransitioned();return a}}class j0{constructor(a,u,m,y,T){this.property=a,this.value=u,this.begin=T+y.delay||0,this.end=this.begin+y.duration||0,a.specification.transition&&(y.delay||y.duration)&&(this.prior=m)}possiblyEvaluate(a,u,m){const y=a.now||0,T=this.value.possiblyEvaluate(a,u,m),M=this.prior;if(M){if(y>this.end)return this.prior=null,T;if(this.value.isDataDriven())return this.prior=null,T;if(y<this.begin)return M.possiblyEvaluate(a,u,m);{const R=(y-this.begin)/(this.end-this.begin);return this.property.interpolate(M.possiblyEvaluate(a,u,m),T,He(R))}}return T}}class G0{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)}possiblyEvaluate(a,u,m){const y=new Sf(this._properties);for(const T of Object.keys(this._values))y._values[T]=this._values[T].possiblyEvaluate(a,u,m);return y}hasTransition(){for(const a of Object.keys(this._values))if(this._values[a].prior)return!0;return!1}}class q0{constructor(a,u){this._properties=a,this._values=Object.create(a.defaultPropertyValues),this._globalState=u}hasValue(a){return this._values[a].value!==void 0}getValue(a){return me(this._values[a].value)}setValue(a,u){this._values[a]=new am(this._values[a].property,u===null?void 0:me(u),this._globalState)}serialize(){const a={};for(const u of Object.keys(this._values)){const m=this.getValue(u);m!==void 0&&(a[u]=m)}return a}possiblyEvaluate(a,u,m){const y=new Sf(this._properties);for(const T of Object.keys(this._values))y._values[T]=this._values[T].possiblyEvaluate(a,u,m);return y}}class Ba{constructor(a,u,m){this.property=a,this.value=u,this.parameters=m}isConstant(){return this.value.kind==="constant"}constantOr(a){return this.value.kind==="constant"?this.value.value:a}evaluate(a,u,m,y){return this.property.evaluate(this.value,this.parameters,a,u,m,y)}}class Sf{constructor(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)}get(a){return this._values[a]}}class Mi{constructor(a){this.specification=a}possiblyEvaluate(a,u){if(a.isDataDriven())throw new Error("Value should not be data driven");return a.expression.evaluate(u)}interpolate(a,u,m){const y=rr[this.specification.type];return y?y(a,u,m):a}}class Fi{constructor(a,u){this.specification=a,this.overrides=u}possiblyEvaluate(a,u,m,y){return new Ba(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(u,null,{},m,y)}:a.expression,u)}interpolate(a,u,m){if(a.value.kind!=="constant"||u.value.kind!=="constant")return a;if(a.value.value===void 0||u.value.value===void 0)return new Ba(this,{kind:"constant",value:void 0},a.parameters);const y=rr[this.specification.type];if(y){const T=y(a.value.value,u.value.value,m);return new Ba(this,{kind:"constant",value:T},a.parameters)}return a}evaluate(a,u,m,y,T,M){return a.kind==="constant"?a.value:a.evaluate(u,m,y,T,M)}}class Tf extends Fi{possiblyEvaluate(a,u,m,y){if(a.value===void 0)return new Ba(this,{kind:"constant",value:void 0},u);if(a.expression.kind==="constant"){const T=a.expression.evaluate(u,null,{},m,y),M=a.property.specification.type==="resolvedImage"&&typeof T!="string"?T.name:T,R=this._calculate(M,M,M,u);return new Ba(this,{kind:"constant",value:R},u)}if(a.expression.kind==="camera"){const T=this._calculate(a.expression.evaluate({zoom:u.zoom-1}),a.expression.evaluate({zoom:u.zoom}),a.expression.evaluate({zoom:u.zoom+1}),u);return new Ba(this,{kind:"constant",value:T},u)}return new Ba(this,a.expression,u)}evaluate(a,u,m,y,T,M){if(a.kind==="source"){const R=a.evaluate(u,m,y,T,M);return this._calculate(R,R,R,u)}return a.kind==="composite"?this._calculate(a.evaluate({zoom:Math.floor(u.zoom)-1},m,y),a.evaluate({zoom:Math.floor(u.zoom)},m,y),a.evaluate({zoom:Math.floor(u.zoom)+1},m,y),u):a.value}_calculate(a,u,m,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:a,to:u}:{from:m,to:u}}interpolate(a){return a}}class cm{constructor(a){this.specification=a}possiblyEvaluate(a,u,m,y){if(a.value!==void 0){if(a.expression.kind==="constant"){const T=a.expression.evaluate(u,null,{},m,y);return this._calculate(T,T,T,u)}return this._calculate(a.expression.evaluate(new qn(Math.floor(u.zoom-1),u)),a.expression.evaluate(new qn(Math.floor(u.zoom),u)),a.expression.evaluate(new qn(Math.floor(u.zoom+1),u)),u)}}_calculate(a,u,m,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:a,to:u}:{from:m,to:u}}interpolate(a){return a}}class um{constructor(a){this.specification=a}possiblyEvaluate(a,u,m,y){return!!a.expression.evaluate(u,null,{},m,y)}interpolate(){return!1}}class lo{constructor(a){this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const u in a){const m=a[u];m.specification.overridable&&this.overridableProperties.push(u);const y=this.defaultPropertyValues[u]=new am(m,void 0,void 0),T=this.defaultTransitionablePropertyValues[u]=new lm(m,void 0);this.defaultTransitioningPropertyValues[u]=T.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=y.possiblyEvaluate({})}}}mi("DataDrivenProperty",Fi),mi("DataConstantProperty",Mi),mi("CrossFadedDataDrivenProperty",Tf),mi("CrossFadedProperty",cm),mi("ColorRampProperty",um);class ha extends on{constructor(a,u,m){if(super(),this.id=a.id,this.type=a.type,this._globalState=m,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},a.type!=="custom"&&(this.metadata=a.metadata,this.minzoom=a.minzoom,this.maxzoom=a.maxzoom,this._visibilityExpression=(function(y,T){return new gf(y,T)})(this.visibility,m),a.type!=="background"&&(this.source=a.source,this.sourceLayer=a["source-layer"],this.filter=a.filter,this._featureFilter=uf(a.filter,m)),u.layout&&(this._unevaluatedLayout=new q0(u.layout,m)),u.paint)){this._transitionablePaint=new V_(u.paint,m);for(const y in a.paint)this.setPaintProperty(y,a.paint[y],{validate:!1});for(const y in a.layout)this.setLayoutProperty(y,a.layout[y],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Sf(u.paint)}}setFilter(a){this.filter=a,this._featureFilter=uf(a,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(a){return a==="visibility"?this.visibility:this._unevaluatedLayout.getValue(a)}getLayoutAffectingGlobalStateRefs(){const a=new Set;for(const u of this._visibilityExpression.getGlobalStateRefs())a.add(u);if(this._unevaluatedLayout)for(const u in this._unevaluatedLayout._values){const m=this._unevaluatedLayout._values[u];for(const y of m.getGlobalStateRefs())a.add(y)}for(const u of this._featureFilter.getGlobalStateRefs())a.add(u);return a}getPaintAffectingGlobalStateRefs(){var a;const u=new globalThis.Map;if(this._transitionablePaint)for(const m in this._transitionablePaint._values){const y=this._transitionablePaint._values[m].value;for(const T of y.getGlobalStateRefs()){const M=(a=u.get(T))!==null&&a!==void 0?a:[];M.push({name:m,value:y.value}),u.set(T,M)}}return u}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(a,u,m={}){if(u==null||!this._validate(L1,`layers.${this.id}.layout.${a}`,a,u,m))return a==="visibility"?(this.visibility=u,this._visibilityExpression.setValue(u),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(a,u)}getPaintProperty(a){return a.endsWith(wf)?this._transitionablePaint.getTransition(a.slice(0,-11)):this._transitionablePaint.getValue(a)}setPaintProperty(a,u,m={}){if(u!=null&&this._validate(R1,`layers.${this.id}.paint.${a}`,a,u,m))return!1;if(a.endsWith(wf))return this._transitionablePaint.setTransition(a.slice(0,-11),u||void 0),!1;{const y=this._transitionablePaint._values[a],T=y.property.specification["property-type"]==="cross-faded-data-driven",M=y.value.isDataDriven(),R=y.value;this._transitionablePaint.setValue(a,u),this._handleSpecialPaintPropertyUpdate(a);const F=this._transitionablePaint._values[a].value;return F.isDataDriven()||M||T||this._handleOverridablePaintPropertyUpdate(a,R,F)}}_handleSpecialPaintPropertyUpdate(a){}_handleOverridablePaintPropertyUpdate(a,u,m){return!1}isHidden(a=this.minzoom,u=!1){return!!(this.minzoom&&a<(u?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&a>=this.maxzoom)||this._evaluatedVisibility==="none"}updateTransitions(a){this._transitioningPaint=this._transitionablePaint.transitioned(a,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(a,u){a.getCrossfadeParameters&&(this._crossfadeParameters=a.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(a,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(a,void 0,u)}serialize(){const a={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(a.layout=a.layout||{},a.layout.visibility=this.visibility),Se(a,((u,m)=>!(u===void 0||m==="layout"&&!Object.keys(u).length||m==="paint"&&!Object.keys(u).length)))}_validate(a,u,m,y,T={}){return(!T||T.validate!==!1)&&Kh(this,a.call(As,{key:u,layerType:this.type,objectKey:m,value:y,styleSpec:Tt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const a in this.paint._values){const u=this.paint.get(a);if(u instanceof Ba&&_n(u.property.specification)&&(u.value.kind==="source"||u.value.kind==="composite")&&u.value.isStateDependent)return!0}return!1}}let U_;var W0={get paint(){return U_=U_||new lo({"raster-opacity":new Mi(Tt.paint_raster["raster-opacity"]),"raster-hue-rotate":new Mi(Tt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Mi(Tt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Mi(Tt.paint_raster["raster-brightness-max"]),"raster-saturation":new Mi(Tt.paint_raster["raster-saturation"]),"raster-contrast":new Mi(Tt.paint_raster["raster-contrast"]),"raster-resampling":new Mi(Tt.paint_raster["raster-resampling"]),"raster-fade-duration":new Mi(Tt.paint_raster["raster-fade-duration"])})}};class F1 extends ha{constructor(a,u){super(a,W0,u)}}const O1={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Mf{constructor(a,u){this._structArray=a,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ir{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(a,u){return a._trim(),u&&(a.isTransferred=!0,u.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}}static deserialize(a){const u=Object.create(this.prototype);return u.arrayBuffer=a.arrayBuffer,u.length=a.length,u.capacity=a.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(a){this.reserve(a),this.length=a}reserve(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Hr(h,a=1){let u=0,m=0;return{members:h.map((y=>{const T=O1[y.type].BYTES_PER_ELEMENT,M=u=Uu(u,Math.max(a,T)),R=y.components||1;return m=Math.max(m,T),u+=T*R,{name:y.name,type:y.type,components:R,offset:M}})),size:Uu(u,Math.max(m,a)),alignment:a}}function Uu(h,a){return Math.ceil(h/a)*a}class Cf extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u){const m=this.length;return this.resize(m+1),this.emplace(m,a,u)}emplace(a,u,m){const y=2*a;return this.int16[y+0]=u,this.int16[y+1]=m,a}}Cf.prototype.bytesPerElement=4,mi("StructArrayLayout2i4",Cf);class hm extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,m){const y=this.length;return this.resize(y+1),this.emplace(y,a,u,m)}emplace(a,u,m,y){const T=3*a;return this.int16[T+0]=u,this.int16[T+1]=m,this.int16[T+2]=y,a}}hm.prototype.bytesPerElement=6,mi("StructArrayLayout3i6",hm);class j_ extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,m,y){const T=this.length;return this.resize(T+1),this.emplace(T,a,u,m,y)}emplace(a,u,m,y,T){const M=4*a;return this.int16[M+0]=u,this.int16[M+1]=m,this.int16[M+2]=y,this.int16[M+3]=T,a}}j_.prototype.bytesPerElement=8,mi("StructArrayLayout4i8",j_);class dm extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,m,y,T,M){const R=this.length;return this.resize(R+1),this.emplace(R,a,u,m,y,T,M)}emplace(a,u,m,y,T,M,R){const F=6*a;return this.int16[F+0]=u,this.int16[F+1]=m,this.int16[F+2]=y,this.int16[F+3]=T,this.int16[F+4]=M,this.int16[F+5]=R,a}}dm.prototype.bytesPerElement=12,mi("StructArrayLayout2i4i12",dm);class G_ extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,m,y,T,M){const R=this.length;return this.resize(R+1),this.emplace(R,a,u,m,y,T,M)}emplace(a,u,m,y,T,M,R){const F=4*a,$=8*a;return this.int16[F+0]=u,this.int16[F+1]=m,this.uint8[$+4]=y,this.uint8[$+5]=T,this.uint8[$+6]=M,this.uint8[$+7]=R,a}}G_.prototype.bytesPerElement=8,mi("StructArrayLayout2i4ub8",G_);class Ef extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u){const m=this.length;return this.resize(m+1),this.emplace(m,a,u)}emplace(a,u,m){const y=2*a;return this.float32[y+0]=u,this.float32[y+1]=m,a}}Ef.prototype.bytesPerElement=8,mi("StructArrayLayout2f8",Ef);class ac extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,m,y,T,M,R,F,$,H){const K=this.length;return this.resize(K+1),this.emplace(K,a,u,m,y,T,M,R,F,$,H)}emplace(a,u,m,y,T,M,R,F,$,H,K){const ne=10*a;return this.uint16[ne+0]=u,this.uint16[ne+1]=m,this.uint16[ne+2]=y,this.uint16[ne+3]=T,this.uint16[ne+4]=M,this.uint16[ne+5]=R,this.uint16[ne+6]=F,this.uint16[ne+7]=$,this.uint16[ne+8]=H,this.uint16[ne+9]=K,a}}ac.prototype.bytesPerElement=20,mi("StructArrayLayout10ui20",ac);class fm extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,m,y,T,M,R,F){const $=this.length;return this.resize($+1),this.emplace($,a,u,m,y,T,M,R,F)}emplace(a,u,m,y,T,M,R,F,$){const H=8*a;return this.uint16[H+0]=u,this.uint16[H+1]=m,this.uint16[H+2]=y,this.uint16[H+3]=T,this.uint16[H+4]=M,this.uint16[H+5]=R,this.uint16[H+6]=F,this.uint16[H+7]=$,a}}fm.prototype.bytesPerElement=16,mi("StructArrayLayout8ui16",fm);class Af extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,m,y,T,M,R,F,$,H,K,ne){const oe=this.length;return this.resize(oe+1),this.emplace(oe,a,u,m,y,T,M,R,F,$,H,K,ne)}emplace(a,u,m,y,T,M,R,F,$,H,K,ne,oe){const fe=12*a;return this.int16[fe+0]=u,this.int16[fe+1]=m,this.int16[fe+2]=y,this.int16[fe+3]=T,this.uint16[fe+4]=M,this.uint16[fe+5]=R,this.uint16[fe+6]=F,this.uint16[fe+7]=$,this.int16[fe+8]=H,this.int16[fe+9]=K,this.int16[fe+10]=ne,this.int16[fe+11]=oe,a}}Af.prototype.bytesPerElement=24,mi("StructArrayLayout4i4ui4i24",Af);class pm extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,m){const y=this.length;return this.resize(y+1),this.emplace(y,a,u,m)}emplace(a,u,m,y){const T=3*a;return this.float32[T+0]=u,this.float32[T+1]=m,this.float32[T+2]=y,a}}pm.prototype.bytesPerElement=12,mi("StructArrayLayout3f12",pm);class Pf extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a){const u=this.length;return this.resize(u+1),this.emplace(u,a)}emplace(a,u){return this.uint32[1*a+0]=u,a}}Pf.prototype.bytesPerElement=4,mi("StructArrayLayout1ul4",Pf);class q_ extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,m,y,T,M,R,F,$){const H=this.length;return this.resize(H+1),this.emplace(H,a,u,m,y,T,M,R,F,$)}emplace(a,u,m,y,T,M,R,F,$,H){const K=10*a,ne=5*a;return this.int16[K+0]=u,this.int16[K+1]=m,this.int16[K+2]=y,this.int16[K+3]=T,this.int16[K+4]=M,this.int16[K+5]=R,this.uint32[ne+3]=F,this.uint16[K+8]=$,this.uint16[K+9]=H,a}}q_.prototype.bytesPerElement=20,mi("StructArrayLayout6i1ul2ui20",q_);class td extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,m,y,T,M){const R=this.length;return this.resize(R+1),this.emplace(R,a,u,m,y,T,M)}emplace(a,u,m,y,T,M,R){const F=6*a;return this.int16[F+0]=u,this.int16[F+1]=m,this.int16[F+2]=y,this.int16[F+3]=T,this.int16[F+4]=M,this.int16[F+5]=R,a}}td.prototype.bytesPerElement=12,mi("StructArrayLayout2i2i2i12",td);class ju extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,m,y,T){const M=this.length;return this.resize(M+1),this.emplace(M,a,u,m,y,T)}emplace(a,u,m,y,T,M){const R=4*a,F=8*a;return this.float32[R+0]=u,this.float32[R+1]=m,this.float32[R+2]=y,this.int16[F+6]=T,this.int16[F+7]=M,a}}ju.prototype.bytesPerElement=16,mi("StructArrayLayout2f1f2i16",ju);class W_ extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,m,y,T,M){const R=this.length;return this.resize(R+1),this.emplace(R,a,u,m,y,T,M)}emplace(a,u,m,y,T,M,R){const F=16*a,$=4*a,H=8*a;return this.uint8[F+0]=u,this.uint8[F+1]=m,this.float32[$+1]=y,this.float32[$+2]=T,this.int16[H+6]=M,this.int16[H+7]=R,a}}W_.prototype.bytesPerElement=16,mi("StructArrayLayout2ub2f2i16",W_);class If extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,m){const y=this.length;return this.resize(y+1),this.emplace(y,a,u,m)}emplace(a,u,m,y){const T=3*a;return this.uint16[T+0]=u,this.uint16[T+1]=m,this.uint16[T+2]=y,a}}If.prototype.bytesPerElement=6,mi("StructArrayLayout3ui6",If);class Gu extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,m,y,T,M,R,F,$,H,K,ne,oe,fe,ge,ve,Pe){const Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,a,u,m,y,T,M,R,F,$,H,K,ne,oe,fe,ge,ve,Pe)}emplace(a,u,m,y,T,M,R,F,$,H,K,ne,oe,fe,ge,ve,Pe,Ge){const Ie=24*a,Re=12*a,Ye=48*a;return this.int16[Ie+0]=u,this.int16[Ie+1]=m,this.uint16[Ie+2]=y,this.uint16[Ie+3]=T,this.uint32[Re+2]=M,this.uint32[Re+3]=R,this.uint32[Re+4]=F,this.uint16[Ie+10]=$,this.uint16[Ie+11]=H,this.uint16[Ie+12]=K,this.float32[Re+7]=ne,this.float32[Re+8]=oe,this.uint8[Ye+36]=fe,this.uint8[Ye+37]=ge,this.uint8[Ye+38]=ve,this.uint32[Re+10]=Pe,this.int16[Ie+22]=Ge,a}}Gu.prototype.bytesPerElement=48,mi("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Gu);class H_ extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,m,y,T,M,R,F,$,H,K,ne,oe,fe,ge,ve,Pe,Ge,Ie,Re,Ye,et,Mt,Ut,Ot,Zt,ni,Yt){const $t=this.length;return this.resize($t+1),this.emplace($t,a,u,m,y,T,M,R,F,$,H,K,ne,oe,fe,ge,ve,Pe,Ge,Ie,Re,Ye,et,Mt,Ut,Ot,Zt,ni,Yt)}emplace(a,u,m,y,T,M,R,F,$,H,K,ne,oe,fe,ge,ve,Pe,Ge,Ie,Re,Ye,et,Mt,Ut,Ot,Zt,ni,Yt,$t){const It=32*a,fi=16*a;return this.int16[It+0]=u,this.int16[It+1]=m,this.int16[It+2]=y,this.int16[It+3]=T,this.int16[It+4]=M,this.int16[It+5]=R,this.int16[It+6]=F,this.int16[It+7]=$,this.uint16[It+8]=H,this.uint16[It+9]=K,this.uint16[It+10]=ne,this.uint16[It+11]=oe,this.uint16[It+12]=fe,this.uint16[It+13]=ge,this.uint16[It+14]=ve,this.uint16[It+15]=Pe,this.uint16[It+16]=Ge,this.uint16[It+17]=Ie,this.uint16[It+18]=Re,this.uint16[It+19]=Ye,this.uint16[It+20]=et,this.uint16[It+21]=Mt,this.uint16[It+22]=Ut,this.uint32[fi+12]=Ot,this.float32[fi+13]=Zt,this.float32[fi+14]=ni,this.uint16[It+30]=Yt,this.uint16[It+31]=$t,a}}H_.prototype.bytesPerElement=64,mi("StructArrayLayout8i15ui1ul2f2ui64",H_);class mm extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a){const u=this.length;return this.resize(u+1),this.emplace(u,a)}emplace(a,u){return this.float32[1*a+0]=u,a}}mm.prototype.bytesPerElement=4,mi("StructArrayLayout1f4",mm);class gm extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,m){const y=this.length;return this.resize(y+1),this.emplace(y,a,u,m)}emplace(a,u,m,y){const T=3*a;return this.uint16[6*a+0]=u,this.float32[T+1]=m,this.float32[T+2]=y,a}}gm.prototype.bytesPerElement=12,mi("StructArrayLayout1ui2f12",gm);class Z_ extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,m){const y=this.length;return this.resize(y+1),this.emplace(y,a,u,m)}emplace(a,u,m,y){const T=4*a;return this.uint32[2*a+0]=u,this.uint16[T+2]=m,this.uint16[T+3]=y,a}}Z_.prototype.bytesPerElement=8,mi("StructArrayLayout1ul2ui8",Z_);class A extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u){const m=this.length;return this.resize(m+1),this.emplace(m,a,u)}emplace(a,u,m){const y=2*a;return this.uint16[y+0]=u,this.uint16[y+1]=m,a}}A.prototype.bytesPerElement=4,mi("StructArrayLayout2ui4",A);class l extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a){const u=this.length;return this.resize(u+1),this.emplace(u,a)}emplace(a,u){return this.uint16[1*a+0]=u,a}}l.prototype.bytesPerElement=2,mi("StructArrayLayout1ui2",l);class f extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,m,y){const T=this.length;return this.resize(T+1),this.emplace(T,a,u,m,y)}emplace(a,u,m,y,T){const M=4*a;return this.float32[M+0]=u,this.float32[M+1]=m,this.float32[M+2]=y,this.float32[M+3]=T,a}}f.prototype.bytesPerElement=16,mi("StructArrayLayout4f16",f);class v extends Mf{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new d(this.anchorPointX,this.anchorPointY)}}v.prototype.size=20;class w extends q_{get(a){return new v(this,a)}}mi("CollisionBoxArray",w);class I extends Mf{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(a){this._structArray.uint8[this._pos1+37]=a}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(a){this._structArray.uint8[this._pos1+38]=a}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(a){this._structArray.uint32[this._pos4+10]=a}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}I.prototype.size=48;class k extends Gu{get(a){return new I(this,a)}}mi("PlacedSymbolArray",k);class B extends Mf{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(a){this._structArray.uint32[this._pos4+12]=a}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}B.prototype.size=64;class W extends H_{get(a){return new B(this,a)}}mi("SymbolInstanceArray",W);class Z extends mm{getoffsetX(a){return this.float32[1*a+0]}}mi("GlyphOffsetArray",Z);class J extends hm{getx(a){return this.int16[3*a+0]}gety(a){return this.int16[3*a+1]}gettileUnitDistanceFromAnchor(a){return this.int16[3*a+2]}}mi("SymbolLineVertexArray",J);class he extends Mf{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}he.prototype.size=12;class ue extends gm{get(a){return new he(this,a)}}mi("TextAnchorOffsetArray",ue);class _e extends Mf{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}_e.prototype.size=8;class Ce extends Z_{get(a){return new _e(this,a)}}mi("FeatureIndexArray",Ce);class Fe extends Cf{}class Ne extends Cf{}class ze extends Cf{}class We extends dm{}class tt extends G_{}class je extends Ef{}class Qe extends ac{}class at extends fm{}class Ke extends Af{}class mt extends pm{}class Lt extends Pf{}class Et extends td{}class At extends W_{}class Pt extends If{}class Qt extends A{}const ti=Hr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Xt}=ti;class si{constructor(a=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=a}prepareSegment(a,u,m,y){const T=this.segments[this.segments.length-1];return a>si.MAX_VERTEX_ARRAY_LENGTH&&st(`Max vertices per segment is ${si.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${a}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${si.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!T||T.vertexLength+a>si.MAX_VERTEX_ARRAY_LENGTH||T.sortKey!==y?this.createNewSegment(u,m,y):T}createNewSegment(a,u,m){const y={vertexOffset:a.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0,vaos:{}};return m!==void 0&&(y.sortKey=m),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(y),y}getOrCreateLatestSegment(a,u,m){return this.prepareSegment(0,a,u,m)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const a of this.segments)for(const u in a.vaos)a.vaos[u].destroy()}static simpleSegment(a,u,m,y){return new si([{vertexOffset:a,primitiveOffset:u,vertexLength:m,primitiveLength:y,vaos:{},sortKey:0}])}}function Yi(h,a){return 256*(h=xe(Math.floor(h),0,255))+xe(Math.floor(a),0,255)}si.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,mi("SegmentVector",si);const kn=Hr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),pr=Hr([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Jn,br,Qn,Br={exports:{}},xr={exports:{}},Ps={exports:{}},rs=(function(){if(Qn)return Br.exports;Qn=1;var h=(Jn||(Jn=1,xr.exports=function(u,m){var y,T,M,R,F,$,H,K;for(T=u.length-(y=3&u.length),M=m,F=3432918353,$=461845907,K=0;K<T;)H=255&u.charCodeAt(K)|(255&u.charCodeAt(++K))<<8|(255&u.charCodeAt(++K))<<16|(255&u.charCodeAt(++K))<<24,++K,M=27492+(65535&(R=5*(65535&(M=(M^=H=(65535&(H=(H=(65535&H)*F+(((H>>>16)*F&65535)<<16)&4294967295)<<15|H>>>17))*$+(((H>>>16)*$&65535)<<16)&4294967295)<<13|M>>>19))+((5*(M>>>16)&65535)<<16)&4294967295))+((58964+(R>>>16)&65535)<<16);switch(H=0,y){case 3:H^=(255&u.charCodeAt(K+2))<<16;case 2:H^=(255&u.charCodeAt(K+1))<<8;case 1:M^=H=(65535&(H=(H=(65535&(H^=255&u.charCodeAt(K)))*F+(((H>>>16)*F&65535)<<16)&4294967295)<<15|H>>>17))*$+(((H>>>16)*$&65535)<<16)&4294967295}return M^=u.length,M=2246822507*(65535&(M^=M>>>16))+((2246822507*(M>>>16)&65535)<<16)&4294967295,M=3266489909*(65535&(M^=M>>>13))+((3266489909*(M>>>16)&65535)<<16)&4294967295,(M^=M>>>16)>>>0}),xr.exports),a=(br||(br=1,Ps.exports=function(u,m){for(var y,T=u.length,M=m^T,R=0;T>=4;)y=1540483477*(65535&(y=255&u.charCodeAt(R)|(255&u.charCodeAt(++R))<<8|(255&u.charCodeAt(++R))<<16|(255&u.charCodeAt(++R))<<24))+((1540483477*(y>>>16)&65535)<<16),M=1540483477*(65535&M)+((1540483477*(M>>>16)&65535)<<16)^(y=1540483477*(65535&(y^=y>>>24))+((1540483477*(y>>>16)&65535)<<16)),T-=4,++R;switch(T){case 3:M^=(255&u.charCodeAt(R+2))<<16;case 2:M^=(255&u.charCodeAt(R+1))<<8;case 1:M=1540483477*(65535&(M^=255&u.charCodeAt(R)))+((1540483477*(M>>>16)&65535)<<16)}return M=1540483477*(65535&(M^=M>>>13))+((1540483477*(M>>>16)&65535)<<16),(M^=M>>>15)>>>0}),Ps.exports);return Br.exports=h,Br.exports.murmur3=h,Br.exports.murmur2=a,Br.exports})(),Zr=p(rs);class Us{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(a,u,m,y){this.ids.push(Wc(a)),this.positions.push(u,m,y)}getPositions(a){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const u=Wc(a);let m=0,y=this.ids.length-1;for(;m<y;){const M=m+y>>1;this.ids[M]>=u?y=M:m=M+1}const T=[];for(;this.ids[m]===u;)T.push({index:this.positions[3*m],start:this.positions[3*m+1],end:this.positions[3*m+2]}),m++;return T}static serialize(a,u){const m=new Float64Array(a.ids),y=new Uint32Array(a.positions);return lc(m,y,0,m.length-1),u&&u.push(m.buffer,y.buffer),{ids:m,positions:y}}static deserialize(a){const u=new Us;return u.ids=a.ids,u.positions=a.positions,u.indexed=!0,u}}function Wc(h){const a=+h;return!isNaN(a)&&a<=Number.MAX_SAFE_INTEGER?a:Zr(String(h))}function lc(h,a,u,m){for(;u<m;){const y=h[u+m>>1];let T=u-1,M=m+1;for(;;){do T++;while(h[T]<y);do M--;while(h[M]>y);if(T>=M)break;xl(h,T,M),xl(a,3*T,3*M),xl(a,3*T+1,3*M+1),xl(a,3*T+2,3*M+2)}M-u<m-M?(lc(h,a,u,M),u=M+1):(lc(h,a,M+1,m),m=M)}}function xl(h,a,u){const m=h[a];h[a]=h[u],h[u]=m}mi("FeaturePositionMap",Us);class So{constructor(a,u){this.gl=a.gl,this.location=u}}class qu extends So{constructor(a,u){super(a,u),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class Rf extends So{constructor(a,u){super(a,u),this.current=[0,0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3]))}}class Wu extends So{constructor(a,u){super(a,u),this.current=rn.transparent}set(a){a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a))}}const da=new Float32Array(16);function wl(h){return[Yi(255*h.r,255*h.g),Yi(255*h.b,255*h.a)]}class Na{constructor(a,u,m){this.value=a,this.uniformNames=u.map((y=>`u_${y}`)),this.type=m}setUniform(a,u,m){a.set(m.constantOr(this.value))}getBinding(a,u,m){return this.type==="color"?new Wu(a,u):new qu(a,u)}}class $a{constructor(a,u){this.uniformNames=u.map((m=>`u_${m}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(a,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=a.tlbr}setConstantDashPositions(a,u){this.dashTo=[0,a.y,a.height,a.width],this.dashFrom=[0,u.y,u.height,u.width]}setUniform(a,u,m,y){let T=null;y==="u_pattern_to"?T=this.patternTo:y==="u_pattern_from"?T=this.patternFrom:y==="u_dasharray_to"?T=this.dashTo:y==="u_dasharray_from"?T=this.dashFrom:y==="u_pixel_ratio_to"?T=this.pixelRatioTo:y==="u_pixel_ratio_from"&&(T=this.pixelRatioFrom),T!==null&&a.set(T)}getBinding(a,u,m){return m.substr(0,9)==="u_pattern"||m.substr(0,12)==="u_dasharray_"?new Rf(a,u):new qu(a,u)}}class sr{constructor(a,u,m,y){this.expression=a,this.type=m,this.maxValue=0,this.paintVertexAttributes=u.map((T=>({name:`a_${T}`,type:"Float32",components:m==="color"?2:1,offset:0}))),this.paintVertexArray=new y}populatePaintArray(a,u,m){const y=this.paintVertexArray.length,T=this.expression.evaluate(new qn(0,m),u,{},m.canonical,[],m.formattedSection);this.paintVertexArray.resize(a),this._setPaintValue(y,a,T)}updatePaintArray(a,u,m,y,T){const M=this.expression.evaluate(new qn(0,T),m,y);this._setPaintValue(a,u,M)}_setPaintValue(a,u,m){if(this.type==="color"){const y=wl(m);for(let T=a;T<u;T++)this.paintVertexArray.emplace(T,y[0],y[1])}else{for(let y=a;y<u;y++)this.paintVertexArray.emplace(y,m);this.maxValue=Math.max(this.maxValue,Math.abs(m))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class er{constructor(a,u,m,y,T,M){this.expression=a,this.uniformNames=u.map((R=>`u_${R}_t`)),this.type=m,this.useIntegerZoom=y,this.zoom=T,this.maxValue=0,this.paintVertexAttributes=u.map((R=>({name:`a_${R}`,type:"Float32",components:m==="color"?4:2,offset:0}))),this.paintVertexArray=new M}populatePaintArray(a,u,m){const y=this.expression.evaluate(new qn(this.zoom,m),u,{},m.canonical,[],m.formattedSection),T=this.expression.evaluate(new qn(this.zoom+1,m),u,{},m.canonical,[],m.formattedSection),M=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(M,a,y,T)}updatePaintArray(a,u,m,y,T){const M=this.expression.evaluate(new qn(this.zoom,T),m,y),R=this.expression.evaluate(new qn(this.zoom+1,T),m,y);this._setPaintValue(a,u,M,R)}_setPaintValue(a,u,m,y){if(this.type==="color"){const T=wl(m),M=wl(y);for(let R=a;R<u;R++)this.paintVertexArray.emplace(R,T[0],T[1],M[0],M[1])}else{for(let T=a;T<u;T++)this.paintVertexArray.emplace(T,m,y);this.maxValue=Math.max(this.maxValue,Math.abs(m),Math.abs(y))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(a,u){const m=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,y=xe(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);a.set(y)}getBinding(a,u,m){return new qu(a,u)}}class gs{constructor(a,u,m,y,T,M){this.expression=a,this.type=u,this.useIntegerZoom=m,this.zoom=y,this.layerId=M,this.zoomInPaintVertexArray=new T,this.zoomOutPaintVertexArray=new T}populatePaintArray(a,u,m){const y=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(y,a,this.getPositionIds(u),m)}updatePaintArray(a,u,m,y,T){this._setPaintValues(a,u,this.getPositionIds(m),T)}_setPaintValues(a,u,m,y){const T=this.getPositions(y);if(!T||!m)return;const M=T[m.min],R=T[m.mid],F=T[m.max];if(M&&R&&F)for(let $=a;$<u;$++)this.emplace(this.zoomInPaintVertexArray,$,R,M),this.emplace(this.zoomOutPaintVertexArray,$,R,F)}upload(a){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const u=this.getVertexAttributes();this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,u,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,u,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class _s extends gs{getPositions(a){return a.imagePositions}getPositionIds(a){return a.patterns&&a.patterns[this.layerId]}getVertexAttributes(){return kn.members}emplace(a,u,m,y){a.emplace(u,m.tlbr[0],m.tlbr[1],m.tlbr[2],m.tlbr[3],y.tlbr[0],y.tlbr[1],y.tlbr[2],y.tlbr[3],m.pixelRatio,y.pixelRatio)}}class H0 extends gs{getPositions(a){return a.dashPositions}getPositionIds(a){return a.dashes&&a.dashes[this.layerId]}getVertexAttributes(){return pr.members}emplace(a,u,m,y){a.emplace(u,0,m.y,m.height,m.width,0,y.y,y.height,y.width)}}class Z0{constructor(a,u,m){this.binders={},this._buffers=[];const y=[];for(const T in a.paint._values){if(!m(T))continue;const M=a.paint.get(T);if(!(M instanceof Ba&&_n(M.property.specification)))continue;const R=z1(T,a.type),F=M.value,$=M.property.specification.type,H=M.property.useIntegerZoom,K=M.property.specification["property-type"],ne=K==="cross-faded"||K==="cross-faded-data-driven";if(F.kind==="constant")this.binders[T]=ne?new $a(F.value,R):new Na(F.value,R,$),y.push(`/u_${T}`);else if(F.kind==="source"||ne){const oe=X0(T,$,"source");this.binders[T]=ne?T==="line-dasharray"?new H0(F,$,H,u,oe,a.id):new _s(F,$,H,u,oe,a.id):new sr(F,R,$,oe),y.push(`/a_${T}`)}else{const oe=X0(T,$,"composite");this.binders[T]=new er(F,R,$,H,u,oe),y.push(`/z_${T}`)}}this.cacheKey=y.sort().join("")}getMaxValue(a){const u=this.binders[a];return u instanceof sr||u instanceof er?u.maxValue:0}populatePaintArrays(a,u,m){for(const y in this.binders){const T=this.binders[y];(T instanceof sr||T instanceof er||T instanceof gs)&&T.populatePaintArray(a,u,m)}}setConstantPatternPositions(a,u){for(const m in this.binders){const y=this.binders[m];y instanceof $a&&y.setConstantPatternPositions(a,u)}}setConstantDashPositions(a,u){for(const m in this.binders){const y=this.binders[m];y instanceof $a&&y.setConstantDashPositions(a,u)}}updatePaintArrays(a,u,m,y,T){let M=!1;for(const R in a){const F=u.getPositions(R);for(const $ of F){const H=m.feature($.index);for(const K in this.binders){const ne=this.binders[K];if((ne instanceof sr||ne instanceof er||ne instanceof gs)&&ne.expression.isStateDependent===!0){const oe=y.paint.get(K);ne.expression=oe.value,ne.updatePaintArray($.start,$.end,H,a[R],T),M=!0}}}}return M}defines(){const a=[];for(const u in this.binders){const m=this.binders[u];(m instanceof Na||m instanceof $a)&&a.push(...m.uniformNames.map((y=>`#define HAS_UNIFORM_${y}`)))}return a}getBinderAttributes(){const a=[];for(const u in this.binders){const m=this.binders[u];if(m instanceof sr||m instanceof er)for(let y=0;y<m.paintVertexAttributes.length;y++)a.push(m.paintVertexAttributes[y].name);else if(m instanceof gs){const y=m.getVertexAttributes();for(const T of y)a.push(T.name)}}return a}getBinderUniforms(){const a=[];for(const u in this.binders){const m=this.binders[u];if(m instanceof Na||m instanceof $a||m instanceof er)for(const y of m.uniformNames)a.push(y)}return a}getPaintVertexBuffers(){return this._buffers}getUniforms(a,u){const m=[];for(const y in this.binders){const T=this.binders[y];if(T instanceof Na||T instanceof $a||T instanceof er){for(const M of T.uniformNames)if(u[M]){const R=T.getBinding(a,u[M],M);m.push({name:M,property:y,binding:R})}}}return m}setUniforms(a,u,m,y){for(const{name:T,property:M,binding:R}of u)this.binders[M].setUniform(R,y,m.get(M),T)}updatePaintBuffers(a){this._buffers=[];for(const u in this.binders){const m=this.binders[u];if(a&&m instanceof gs){const y=a.fromScale===2?m.zoomInPaintVertexBuffer:m.zoomOutPaintVertexBuffer;y&&this._buffers.push(y)}else(m instanceof sr||m instanceof er)&&m.paintVertexBuffer&&this._buffers.push(m.paintVertexBuffer)}}upload(a){for(const u in this.binders){const m=this.binders[u];(m instanceof sr||m instanceof er||m instanceof gs)&&m.upload(a)}this.updatePaintBuffers()}destroy(){for(const a in this.binders){const u=this.binders[a];(u instanceof sr||u instanceof er||u instanceof gs)&&u.destroy()}}}class Hu{constructor(a,u,m=()=>!0){this.programConfigurations={};for(const y of a)this.programConfigurations[y.id]=new Z0(y,u,m);this.needsUpload=!1,this._featureMap=new Us,this._bufferOffset=0}populatePaintArrays(a,u,m,y){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(a,u,y);u.id!==void 0&&this._featureMap.add(u.id,m,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0}updatePaintArrays(a,u,m,y){for(const T of m)this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(a,this._featureMap,u,T,y)||this.needsUpload}get(a){return this.programConfigurations[a]}upload(a){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(a);this.needsUpload=!1}}destroy(){for(const a in this.programConfigurations)this.programConfigurations[a].destroy()}}function z1(h,a){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[h]||[h.replace(`${a}-`,"").replace(/-/g,"_")]}function X0(h,a,u){const m={color:{source:Ef,composite:f},number:{source:mm,composite:Ef}},y=(function(T){return{"line-pattern":{source:Qe,composite:Qe},"fill-pattern":{source:Qe,composite:Qe},"fill-extrusion-pattern":{source:Qe,composite:Qe},"line-dasharray":{source:at,composite:at}}[T]})(h);return y&&y[u]||m[a][u]}mi("ConstantBinder",Na),mi("CrossFadedConstantBinder",$a),mi("SourceExpressionBinder",sr),mi("CrossFadedPatternBinder",_s),mi("CrossFadedDasharrayBinder",H0),mi("CompositeExpressionBinder",er),mi("ProgramConfiguration",Z0,{omit:["_buffers"]}),mi("ProgramConfigurationSet",Hu);const X_=Math.pow(2,14)-1,Hc=-X_-1;function Zc(h){const a=Ee/h.extent,u=h.loadGeometry();for(let m=0;m<u.length;m++){const y=u[m];for(let T=0;T<y.length;T++){const M=y[T],R=Math.round(M.x*a),F=Math.round(M.y*a);M.x=xe(R,Hc,X_),M.y=xe(F,Hc,X_),(R<M.x||R>M.x+1||F<M.y||F>M.y+1)&&st("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return u}function Xc(h,a){return{type:h.type,id:h.id,properties:h.properties,geometry:a?Zc(h):[]}}const Y_=-32768;function K_(h,a,u,m,y){h.emplaceBack(Y_+8*a+m,Y_+8*u+y)}class _m{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=a.index,this.hasDependencies=!1,this.layoutVertexArray=new Ne,this.indexArray=new Pt,this.segments=new si,this.programConfigurations=new Hu(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id))}populate(a,u,m){const y=this.layers[0],T=[];let M=null,R=!1,F=y.type==="heatmap";if(y.type==="circle"){const H=y;M=H.layout.get("circle-sort-key"),R=!M.isConstant(),F=F||H.paint.get("circle-pitch-alignment")==="map"}const $=F?u.subdivisionGranularity.circle:1;for(const{feature:H,id:K,index:ne,sourceLayerIndex:oe}of a){const fe=this.layers[0]._featureFilter.needGeometry,ge=Xc(H,fe);if(!this.layers[0]._featureFilter.filter(new qn(this.zoom),ge,m))continue;const ve=R?M.evaluate(ge,{},m):void 0,Pe={id:K,properties:H.properties,type:H.type,sourceLayerIndex:oe,index:ne,geometry:fe?ge.geometry:Zc(H),patterns:{},sortKey:ve};T.push(Pe)}R&&T.sort(((H,K)=>H.sortKey-K.sortKey));for(const H of T){const{geometry:K,index:ne,sourceLayerIndex:oe}=H,fe=a[ne].feature;this.addFeature(H,K,ne,m,$),u.featureIndex.insert(fe,K,ne,oe,this.index)}}update(a,u,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,{imagePositions:m})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Xt),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(a,u,m,y,T=1){let M;switch(T){case 1:M=[0,7];break;case 3:M=[0,2,5,7];break;case 5:M=[0,1,3,4,6,7];break;case 7:M=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${T}; valid values are 1, 3, 5, 7.`)}const R=M.length;for(const F of u)for(const $ of F){const H=$.x,K=$.y;if(H<0||H>=Ee||K<0||K>=Ee)continue;const ne=this.segments.prepareSegment(R*R,this.layoutVertexArray,this.indexArray,a.sortKey),oe=ne.vertexLength;for(let fe=0;fe<R;fe++)for(let ge=0;ge<R;ge++)K_(this.layoutVertexArray,H,K,M[ge],M[fe]);for(let fe=0;fe<R-1;fe++)for(let ge=0;ge<R-1;ge++){const ve=oe+fe*R+ge,Pe=oe+(fe+1)*R+ge;this.indexArray.emplaceBack(ve,Pe+1,ve+1),this.indexArray.emplaceBack(ve,Pe,Pe+1)}ne.vertexLength+=R*R,ne.primitiveLength+=(R-1)*(R-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,m,{imagePositions:{},canonical:y})}}function vm(h,a){for(let u=0;u<h.length;u++)if(ym(a,h[u]))return!0;for(let u=0;u<a.length;u++)if(ym(h,a[u]))return!0;return!!B1(h,a)}function Y0(h,a,u){return!!ym(h,a)||!!N1(a,h,u)}function gE(h,a){if(h.length===1)return vE(a,h[0]);for(let u=0;u<a.length;u++){const m=a[u];for(let y=0;y<m.length;y++)if(ym(h,m[y]))return!0}for(let u=0;u<h.length;u++)if(vE(a,h[u]))return!0;for(let u=0;u<a.length;u++)if(B1(h,a[u]))return!0;return!1}function zN(h,a,u){if(h.length>1){if(B1(h,a))return!0;for(let m=0;m<a.length;m++)if(N1(a[m],h,u))return!0}for(let m=0;m<h.length;m++)if(N1(h[m],a,u))return!0;return!1}function B1(h,a){if(h.length===0||a.length===0)return!1;for(let u=0;u<h.length-1;u++){const m=h[u],y=h[u+1];for(let T=0;T<a.length-1;T++)if(BN(m,y,a[T],a[T+1]))return!0}return!1}function BN(h,a,u,m){return Rt(h,u,m)!==Rt(a,u,m)&&Rt(h,a,u)!==Rt(h,a,m)}function N1(h,a,u){const m=u*u;if(a.length===1)return h.distSqr(a[0])<m;for(let y=1;y<a.length;y++)if(_E(h,a[y-1],a[y])<m)return!0;return!1}function _E(h,a,u){const m=a.distSqr(u);if(m===0)return h.distSqr(a);const y=((h.x-a.x)*(u.x-a.x)+(h.y-a.y)*(u.y-a.y))/m;return h.distSqr(y<0?a:y>1?u:u.sub(a)._mult(y)._add(a))}function vE(h,a){let u,m,y,T=!1;for(let M=0;M<h.length;M++){u=h[M];for(let R=0,F=u.length-1;R<u.length;F=R++)m=u[R],y=u[F],m.y>a.y!=y.y>a.y&&a.x<(y.x-m.x)*(a.y-m.y)/(y.y-m.y)+m.x&&(T=!T)}return T}function ym(h,a){let u=!1;for(let m=0,y=h.length-1;m<h.length;y=m++){const T=h[m],M=h[y];T.y>a.y!=M.y>a.y&&a.x<(M.x-T.x)*(a.y-T.y)/(M.y-T.y)+T.x&&(u=!u)}return u}function NN(h,a,u){const m=u[0],y=u[2];if(h.x<m.x&&a.x<m.x||h.x>y.x&&a.x>y.x||h.y<m.y&&a.y<m.y||h.y>y.y&&a.y>y.y)return!1;const T=Rt(h,a,u[0]);return T!==Rt(h,a,u[1])||T!==Rt(h,a,u[2])||T!==Rt(h,a,u[3])}function bm(h,a,u){const m=a.paint.get(h).value;return m.kind==="constant"?m.value:u.programConfigurations.get(a.id).getMaxValue(h)}function K0(h){return Math.sqrt(h[0]*h[0]+h[1]*h[1])}function J0(h,a,u,m,y){if(!a[0]&&!a[1])return h;const T=d.convert(a)._mult(y);u==="viewport"&&T._rotate(-m);const M=[];for(let R=0;R<h.length;R++)M.push(h[R].sub(T));return M}function $N(h){const a=[];for(let u=0;u<h.length;u++){const m=h[u],y=a.at(-1);(u===0||y&&!m.equals(y))&&a.push(m)}return a}function VN({queryGeometry:h,size:a},u){return Y0(h,u,a)}function UN({queryGeometry:h,size:a,transform:u,unwrappedTileID:m,getElevation:y},T){return Y0(h,T,a*(u.projectTileCoordinates(T.x,T.y,m,y).signedDistanceFromCamera/u.cameraToCenterDistance))}function jN({queryGeometry:h,size:a,transform:u,unwrappedTileID:m,getElevation:y},T){const M=u.projectTileCoordinates(T.x,T.y,m,y).signedDistanceFromCamera,R=a*(u.cameraToCenterDistance/M);return Y0(h,$1(T,u,m,y),R)}function GN({queryGeometry:h,size:a,transform:u,unwrappedTileID:m,getElevation:y},T){return Y0(h,$1(T,u,m,y),a)}function yE({queryGeometry:h,size:a,transform:u,unwrappedTileID:m,getElevation:y,pitchAlignment:T="map",pitchScale:M="map"},R){const F=T==="map"?M==="map"?VN:UN:M==="map"?jN:GN,$={queryGeometry:h,size:a,transform:u,unwrappedTileID:m,getElevation:y};for(const H of R)for(const K of H)if(F($,K))return!0;return!1}function $1(h,a,u,m){const y=a.projectTileCoordinates(h.x,h.y,u,m).point;return new d((.5*y.x+.5)*a.width,(.5*-y.y+.5)*a.height)}let bE,xE;mi("CircleBucket",_m,{omit:["layers"]});var qN={get paint(){return xE=xE||new lo({"circle-radius":new Fi(Tt.paint_circle["circle-radius"]),"circle-color":new Fi(Tt.paint_circle["circle-color"]),"circle-blur":new Fi(Tt.paint_circle["circle-blur"]),"circle-opacity":new Fi(Tt.paint_circle["circle-opacity"]),"circle-translate":new Mi(Tt.paint_circle["circle-translate"]),"circle-translate-anchor":new Mi(Tt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Mi(Tt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Mi(Tt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Fi(Tt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Fi(Tt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Fi(Tt.paint_circle["circle-stroke-opacity"])})},get layout(){return bE=bE||new lo({"circle-sort-key":new Fi(Tt.layout_circle["circle-sort-key"])})}};class WN extends ha{constructor(a,u){super(a,qN,u)}createBucket(a){return new _m(a)}queryRadius(a){const u=a;return bm("circle-radius",this,u)+bm("circle-stroke-width",this,u)+K0(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:a,feature:u,featureState:m,geometry:y,transform:T,pixelsToTileUnits:M,unwrappedTileID:R,getElevation:F}){const $=J0(a,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-T.bearingInRadians,M),H=this.paint.get("circle-radius").evaluate(u,m)+this.paint.get("circle-stroke-width").evaluate(u,m),K=this.paint.get("circle-pitch-scale"),ne=this.paint.get("circle-pitch-alignment");let oe,fe;return ne==="map"?(oe=$,fe=H*M):(oe=(function(ge,ve,Pe,Ge){return ge.map((Ie=>$1(Ie,ve,Pe,Ge)))})($,T,R,F),fe=H),yE({queryGeometry:oe,size:fe,transform:T,unwrappedTileID:R,getElevation:F,pitchAlignment:ne,pitchScale:K},y)}}class wE extends _m{}let SE;mi("HeatmapBucket",wE,{omit:["layers"]});var HN={get paint(){return SE=SE||new lo({"heatmap-radius":new Fi(Tt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Fi(Tt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Mi(Tt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new um(Tt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Mi(Tt.paint_heatmap["heatmap-opacity"])})}};function V1(h,{width:a,height:u},m,y){if(y){if(y instanceof Uint8ClampedArray)y=new Uint8Array(y.buffer);else if(y.length!==a*u*m)throw new RangeError(`mismatched image size. expected: ${y.length} but got: ${a*u*m}`)}else y=new Uint8Array(a*u*m);return h.width=a,h.height=u,h.data=y,h}function TE(h,{width:a,height:u},m){if(a===h.width&&u===h.height)return;const y=V1({},{width:a,height:u},m);U1(h,y,{x:0,y:0},{x:0,y:0},{width:Math.min(h.width,a),height:Math.min(h.height,u)},m),h.width=a,h.height=u,h.data=y.data}function U1(h,a,u,m,y,T){if(y.width===0||y.height===0)return a;if(y.width>h.width||y.height>h.height||u.x>h.width-y.width||u.y>h.height-y.height)throw new RangeError("out of range source coordinates for image copy");if(y.width>a.width||y.height>a.height||m.x>a.width-y.width||m.y>a.height-y.height)throw new RangeError("out of range destination coordinates for image copy");const M=h.data,R=a.data;if(M===R)throw new Error("srcData equals dstData, so image is already copied");for(let F=0;F<y.height;F++){const $=((u.y+F)*h.width+u.x)*T,H=((m.y+F)*a.width+m.x)*T;for(let K=0;K<y.width*T;K++)R[H+K]=M[$+K]}return a}class J_{constructor(a,u){V1(this,a,1,u)}resize(a){TE(this,a,1)}clone(){return new J_({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,u,m,y,T){U1(a,u,m,y,T,1)}}class Wo{constructor(a,u){V1(this,a,4,u)}resize(a){TE(this,a,4)}replace(a,u){u?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a}clone(){return new Wo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,u,m,y,T){U1(a,u,m,y,T,4)}setPixel(a,u,m){const y=4*(a*this.width+u);this.data[y+0]=Math.round(255*m.r/m.a),this.data[y+1]=Math.round(255*m.g/m.a),this.data[y+2]=Math.round(255*m.b/m.a),this.data[y+3]=Math.round(255*m.a)}}function ME(h){const a={},u=h.resolution||256,m=h.clips?h.clips.length:1,y=h.image||new Wo({width:u,height:m});if(Math.log(u)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${u}`);const T=(M,R,F)=>{a[h.evaluationKey]=F;const $=h.expression.evaluate(a);y.setPixel(M/4/u,R/4,$)};if(h.clips)for(let M=0,R=0;M<m;++M,R+=4*u)for(let F=0,$=0;F<u;F++,$+=4){const H=F/(u-1),{start:K,end:ne}=h.clips[M];T(R,$,K*(1-H)+ne*H)}else for(let M=0,R=0;M<u;M++,R+=4)T(0,R,M/(u-1));return y}mi("AlphaImage",J_),mi("RGBAImage",Wo);const j1="big-fb";class ZN extends ha{createBucket(a){return new wE(a)}constructor(a,u){super(a,HN,u),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ME({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(j1)&&this.heatmapFbos.delete(j1)}queryRadius(a){return bm("heatmap-radius",this,a)}queryIntersectsFeature({queryGeometry:a,feature:u,featureState:m,geometry:y,transform:T,pixelsToTileUnits:M,unwrappedTileID:R,getElevation:F}){return yE({queryGeometry:a,size:this.paint.get("heatmap-radius").evaluate(u,m)*M,transform:T,unwrappedTileID:R,getElevation:F},y)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&!this.isHidden()}}let CE;var XN={get paint(){return CE=CE||new lo({"hillshade-illumination-direction":new Mi(Tt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Mi(Tt.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Mi(Tt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Mi(Tt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Mi(Tt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Mi(Tt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Mi(Tt.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Mi(Tt.paint_hillshade["hillshade-method"])})}};class YN extends ha{constructor(a,u){super(a,XN,u),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let a=this.paint.get("hillshade-illumination-direction").values,u=this.paint.get("hillshade-illumination-altitude").values,m=this.paint.get("hillshade-highlight-color").values,y=this.paint.get("hillshade-shadow-color").values;const T=Math.max(a.length,u.length,m.length,y.length);a=a.concat(Array(T-a.length).fill(a.at(-1))),u=u.concat(Array(T-u.length).fill(u.at(-1))),m=m.concat(Array(T-m.length).fill(m.at(-1))),y=y.concat(Array(T-y.length).fill(y.at(-1)));const M=u.map(Ze);return{directionRadians:a.map(Ze),altitudeRadians:M,shadowColor:y,highlightColor:m}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&!this.isHidden()}}let EE;var KN={get paint(){return EE=EE||new lo({"color-relief-opacity":new Mi(Tt["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new um(Tt["paint_color-relief"]["color-relief-color"])})}};class G1{constructor(a,u,m,y){this.context=a,this.format=m,this.texture=a.gl.createTexture(),this.update(u,y)}update(a,u,m){const{width:y,height:T}=a,M=!(this.size&&this.size[0]===y&&this.size[1]===T||m),{context:R}=this,{gl:F}=R;if(this.useMipmap=!!(u&&u.useMipmap),F.bindTexture(F.TEXTURE_2D,this.texture),R.pixelStoreUnpackFlipY.set(!1),R.pixelStoreUnpack.set(1),R.pixelStoreUnpackPremultiplyAlpha.set(this.format===F.RGBA&&(!u||u.premultiply!==!1)),M)this.size=[y,T],a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||we(a)?F.texImage2D(F.TEXTURE_2D,0,this.format,this.format,F.UNSIGNED_BYTE,a):F.texImage2D(F.TEXTURE_2D,0,this.format,y,T,0,this.format,F.UNSIGNED_BYTE,a.data);else{const{x:$,y:H}=m||{x:0,y:0};a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||we(a)?F.texSubImage2D(F.TEXTURE_2D,0,$,H,F.RGBA,F.UNSIGNED_BYTE,a):F.texSubImage2D(F.TEXTURE_2D,0,$,H,y,T,F.RGBA,F.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&F.generateMipmap(F.TEXTURE_2D),R.pixelStoreUnpackFlipY.setDefault(),R.pixelStoreUnpack.setDefault(),R.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(a,u,m){const{context:y}=this,{gl:T}=y;T.bindTexture(T.TEXTURE_2D,this.texture),m!==T.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(m=T.LINEAR),a!==this.filter&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,a),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,m||a),this.filter=a),u!==this.wrap&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,u),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,u),this.wrap=u)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}}class AE{constructor(a,u,m,y=1,T=1,M=1,R=0){if(this.uid=a,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(m&&!["mapbox","terrarium","custom"].includes(m))return void st(`"${m}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=u.height;const F=this.dim=u.height-2;switch(this.data=new Uint32Array(u.data.buffer),m){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=y,this.greenFactor=T,this.blueFactor=M,this.baseShift=R;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let $=0;$<F;$++)this.data[this._idx(-1,$)]=this.data[this._idx(0,$)],this.data[this._idx(F,$)]=this.data[this._idx(F-1,$)],this.data[this._idx($,-1)]=this.data[this._idx($,0)],this.data[this._idx($,F)]=this.data[this._idx($,F-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(F,-1)]=this.data[this._idx(F-1,0)],this.data[this._idx(-1,F)]=this.data[this._idx(0,F-1)],this.data[this._idx(F,F)]=this.data[this._idx(F-1,F-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let $=0;$<F;$++)for(let H=0;H<F;H++){const K=this.get($,H);K>this.max&&(this.max=K),K<this.min&&(this.min=K)}}get(a,u){const m=new Uint8Array(this.data.buffer),y=4*this._idx(a,u);return this.unpack(m[y],m[y+1],m[y+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(a,u){if(a<-1||a>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${a}, y: ${u}, dim: ${this.dim}`);return(u+1)*this.stride+(a+1)}unpack(a,u,m){return a*this.redFactor+u*this.greenFactor+m*this.blueFactor-this.baseShift}pack(a){return PE(a,this.getUnpackVector())}getPixels(){return new Wo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(a,u,m){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");let y=u*this.dim,T=u*this.dim+this.dim,M=m*this.dim,R=m*this.dim+this.dim;switch(u){case-1:y=T-1;break;case 1:T=y+1}switch(m){case-1:M=R-1;break;case 1:R=M+1}const F=-u*this.dim,$=-m*this.dim;for(let H=M;H<R;H++)for(let K=y;K<T;K++)this.data[this._idx(K,H)]=a.data[this._idx(K+F,H+$)]}}function PE(h,a){const u=a[0],m=a[1],y=a[2],T=a[3],M=Math.min(u,m,y),R=Math.round((h+T)/M);return{r:Math.floor(R*M/u)%256,g:Math.floor(R*M/m)%256,b:Math.floor(R*M/y)%256}}mi("DEMData",AE);class JN extends ha{constructor(a,u){super(a,KN,u)}_createColorRamp(a){const u={elevationStops:[],colorStops:[]},m=this._transitionablePaint._values["color-relief-color"].value.expression;if(m instanceof Kp&&m._styleExpression.expression instanceof vr){this.colorRampExpression=m;const M=m._styleExpression.expression;u.elevationStops=M.labels,u.colorStops=[];for(const R of u.elevationStops)u.colorStops.push(M.evaluate({globals:{elevation:R}}))}if(u.elevationStops.length<1&&(u.elevationStops=[0],u.colorStops=[rn.transparent]),u.elevationStops.length<2&&(u.elevationStops.push(u.elevationStops[0]+1),u.colorStops.push(u.colorStops[0])),u.elevationStops.length<=a)return u;const y={elevationStops:[],colorStops:[]},T=(u.elevationStops.length-1)/(a-1);for(let M=0;M<u.elevationStops.length-.5;M+=T)y.elevationStops.push(u.elevationStops[Math.round(M)]),y.colorStops.push(u.colorStops[Math.round(M)]);return st(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${a}, provided: ${u.elevationStops.length}`),y}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(a,u,m){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const y=this._createColorRamp(u),T=new Wo({width:y.colorStops.length,height:1}),M=new Wo({width:y.colorStops.length,height:1});for(let R=0;R<y.elevationStops.length;R++){const F=PE(y.elevationStops[R],m);M.setPixel(0,R,new rn(F.r/255,F.g/255,F.b/255,1)),T.setPixel(0,R,y.colorStops[R])}return this.colorRampTextures={elevationTexture:new G1(a,M,a.gl.RGBA),colorTexture:new G1(a,T,a.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}const QN=Hr([{name:"a_pos",components:2,type:"Int16"}],4),{members:e4}=QN;function Q0(h,a,u){const m=u.patternDependencies;let y=!1;for(const T of a){const M=T.paint.get(`${h}-pattern`);M.isConstant()||(y=!0);const R=M.constantOr(null);R&&(y=!0,m[R.to]=!0,m[R.from]=!0)}return y}function q1(h,a,u,m,y){const{zoom:T}=m,M=y.patternDependencies;for(const R of a){const F=R.paint.get(`${h}-pattern`).value;if(F.kind!=="constant"){let $=F.evaluate({zoom:T-1},u,{},y.availableImages),H=F.evaluate({zoom:T},u,{},y.availableImages),K=F.evaluate({zoom:T+1},u,{},y.availableImages);$=$&&$.name?$.name:$,H=H&&H.name?H.name:H,K=K&&K.name?K.name:K,M[$]=!0,M[H]=!0,M[K]=!0,u.patterns[R.id]={min:$,mid:H,max:K}}}return u}function IE(h,a,u,m,y){let T;if(y===(function(M,R,F,$){let H=0;for(let K=R,ne=F-$;K<F;K+=$)H+=(M[ne]-M[K])*(M[K+1]+M[ne+1]),ne=K;return H})(h,a,u,m)>0)for(let M=a;M<u;M+=m)T=DE(M/m|0,h[M],h[M+1],T);else for(let M=u-m;M>=a;M-=m)T=DE(M/m|0,h[M],h[M+1],T);return T&&xm(T,T.next)&&(iv(T),T=T.next),T}function Lf(h,a){if(!h)return h;a||(a=h);let u,m=h;do if(u=!1,m.steiner||!xm(m,m.next)&&ss(m.prev,m,m.next)!==0)m=m.next;else{if(iv(m),m=a=m.prev,m===m.next)break;u=!0}while(u||m!==a);return a}function Q_(h,a,u,m,y,T,M){if(!h)return;!M&&T&&(function(F,$,H,K){let ne=F;do ne.z===0&&(ne.z=W1(ne.x,ne.y,$,H,K)),ne.prevZ=ne.prev,ne.nextZ=ne.next,ne=ne.next;while(ne!==F);ne.prevZ.nextZ=null,ne.prevZ=null,(function(oe){let fe,ge=1;do{let ve,Pe=oe;oe=null;let Ge=null;for(fe=0;Pe;){fe++;let Ie=Pe,Re=0;for(let et=0;et<ge&&(Re++,Ie=Ie.nextZ,Ie);et++);let Ye=ge;for(;Re>0||Ye>0&&Ie;)Re!==0&&(Ye===0||!Ie||Pe.z<=Ie.z)?(ve=Pe,Pe=Pe.nextZ,Re--):(ve=Ie,Ie=Ie.nextZ,Ye--),Ge?Ge.nextZ=ve:oe=ve,ve.prevZ=Ge,Ge=ve;Pe=Ie}Ge.nextZ=null,ge*=2}while(fe>1)})(ne)})(h,m,y,T);let R=h;for(;h.prev!==h.next;){const F=h.prev,$=h.next;if(T?i4(h,m,y,T):t4(h))a.push(F.i,h.i,$.i),iv(h),h=$.next,R=$.next;else if((h=$)===R){M?M===1?Q_(h=n4(Lf(h),a),a,u,m,y,T,2):M===2&&r4(h,a,u,m,y,T):Q_(Lf(h),a,u,m,y,T,1);break}}}function t4(h){const a=h.prev,u=h,m=h.next;if(ss(a,u,m)>=0)return!1;const y=a.x,T=u.x,M=m.x,R=a.y,F=u.y,$=m.y,H=Math.min(y,T,M),K=Math.min(R,F,$),ne=Math.max(y,T,M),oe=Math.max(R,F,$);let fe=m.next;for(;fe!==a;){if(fe.x>=H&&fe.x<=ne&&fe.y>=K&&fe.y<=oe&&ev(y,R,T,F,M,$,fe.x,fe.y)&&ss(fe.prev,fe,fe.next)>=0)return!1;fe=fe.next}return!0}function i4(h,a,u,m){const y=h.prev,T=h,M=h.next;if(ss(y,T,M)>=0)return!1;const R=y.x,F=T.x,$=M.x,H=y.y,K=T.y,ne=M.y,oe=Math.min(R,F,$),fe=Math.min(H,K,ne),ge=Math.max(R,F,$),ve=Math.max(H,K,ne),Pe=W1(oe,fe,a,u,m),Ge=W1(ge,ve,a,u,m);let Ie=h.prevZ,Re=h.nextZ;for(;Ie&&Ie.z>=Pe&&Re&&Re.z<=Ge;){if(Ie.x>=oe&&Ie.x<=ge&&Ie.y>=fe&&Ie.y<=ve&&Ie!==y&&Ie!==M&&ev(R,H,F,K,$,ne,Ie.x,Ie.y)&&ss(Ie.prev,Ie,Ie.next)>=0||(Ie=Ie.prevZ,Re.x>=oe&&Re.x<=ge&&Re.y>=fe&&Re.y<=ve&&Re!==y&&Re!==M&&ev(R,H,F,K,$,ne,Re.x,Re.y)&&ss(Re.prev,Re,Re.next)>=0))return!1;Re=Re.nextZ}for(;Ie&&Ie.z>=Pe;){if(Ie.x>=oe&&Ie.x<=ge&&Ie.y>=fe&&Ie.y<=ve&&Ie!==y&&Ie!==M&&ev(R,H,F,K,$,ne,Ie.x,Ie.y)&&ss(Ie.prev,Ie,Ie.next)>=0)return!1;Ie=Ie.prevZ}for(;Re&&Re.z<=Ge;){if(Re.x>=oe&&Re.x<=ge&&Re.y>=fe&&Re.y<=ve&&Re!==y&&Re!==M&&ev(R,H,F,K,$,ne,Re.x,Re.y)&&ss(Re.prev,Re,Re.next)>=0)return!1;Re=Re.nextZ}return!0}function n4(h,a){let u=h;do{const m=u.prev,y=u.next.next;!xm(m,y)&&LE(m,u,u.next,y)&&tv(m,y)&&tv(y,m)&&(a.push(m.i,u.i,y.i),iv(u),iv(u.next),u=h=y),u=u.next}while(u!==h);return Lf(u)}function r4(h,a,u,m,y,T){let M=h;do{let R=M.next.next;for(;R!==M.prev;){if(M.i!==R.i&&c4(M,R)){let F=kE(M,R);return M=Lf(M,M.next),F=Lf(F,F.next),Q_(M,a,u,m,y,T,0),void Q_(F,a,u,m,y,T,0)}R=R.next}M=M.next}while(M!==h)}function s4(h,a){let u=h.x-a.x;return u===0&&(u=h.y-a.y,u===0)&&(u=(h.next.y-h.y)/(h.next.x-h.x)-(a.next.y-a.y)/(a.next.x-a.x)),u}function o4(h,a){const u=(function(y,T){let M=T;const R=y.x,F=y.y;let $,H=-1/0;if(xm(y,M))return M;do{if(xm(y,M.next))return M.next;if(F<=M.y&&F>=M.next.y&&M.next.y!==M.y){const ge=M.x+(F-M.y)*(M.next.x-M.x)/(M.next.y-M.y);if(ge<=R&&ge>H&&(H=ge,$=M.x<M.next.x?M:M.next,ge===R))return $}M=M.next}while(M!==T);if(!$)return null;const K=$,ne=$.x,oe=$.y;let fe=1/0;M=$;do{if(R>=M.x&&M.x>=ne&&R!==M.x&&RE(F<oe?R:H,F,ne,oe,F<oe?H:R,F,M.x,M.y)){const ge=Math.abs(F-M.y)/(R-M.x);tv(M,y)&&(ge<fe||ge===fe&&(M.x>$.x||M.x===$.x&&a4($,M)))&&($=M,fe=ge)}M=M.next}while(M!==K);return $})(h,a);if(!u)return a;const m=kE(u,h);return Lf(m,m.next),Lf(u,u.next)}function a4(h,a){return ss(h.prev,h,a.prev)<0&&ss(a.next,h,h.next)<0}function W1(h,a,u,m,y){return(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h=(h-u)*y|0)|h<<8))|h<<4))|h<<2))|h<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-m)*y|0)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function l4(h){let a=h,u=h;do(a.x<u.x||a.x===u.x&&a.y<u.y)&&(u=a),a=a.next;while(a!==h);return u}function RE(h,a,u,m,y,T,M,R){return(y-M)*(a-R)>=(h-M)*(T-R)&&(h-M)*(m-R)>=(u-M)*(a-R)&&(u-M)*(T-R)>=(y-M)*(m-R)}function ev(h,a,u,m,y,T,M,R){return!(h===M&&a===R)&&RE(h,a,u,m,y,T,M,R)}function c4(h,a){return h.next.i!==a.i&&h.prev.i!==a.i&&!(function(u,m){let y=u;do{if(y.i!==u.i&&y.next.i!==u.i&&y.i!==m.i&&y.next.i!==m.i&&LE(y,y.next,u,m))return!0;y=y.next}while(y!==u);return!1})(h,a)&&(tv(h,a)&&tv(a,h)&&(function(u,m){let y=u,T=!1;const M=(u.x+m.x)/2,R=(u.y+m.y)/2;do y.y>R!=y.next.y>R&&y.next.y!==y.y&&M<(y.next.x-y.x)*(R-y.y)/(y.next.y-y.y)+y.x&&(T=!T),y=y.next;while(y!==u);return T})(h,a)&&(ss(h.prev,h,a.prev)||ss(h,a.prev,a))||xm(h,a)&&ss(h.prev,h,h.next)>0&&ss(a.prev,a,a.next)>0)}function ss(h,a,u){return(a.y-h.y)*(u.x-a.x)-(a.x-h.x)*(u.y-a.y)}function xm(h,a){return h.x===a.x&&h.y===a.y}function LE(h,a,u,m){const y=tb(ss(h,a,u)),T=tb(ss(h,a,m)),M=tb(ss(u,m,h)),R=tb(ss(u,m,a));return y!==T&&M!==R||!(y!==0||!eb(h,u,a))||!(T!==0||!eb(h,m,a))||!(M!==0||!eb(u,h,m))||!(R!==0||!eb(u,a,m))}function eb(h,a,u){return a.x<=Math.max(h.x,u.x)&&a.x>=Math.min(h.x,u.x)&&a.y<=Math.max(h.y,u.y)&&a.y>=Math.min(h.y,u.y)}function tb(h){return h>0?1:h<0?-1:0}function tv(h,a){return ss(h.prev,h,h.next)<0?ss(h,a,h.next)>=0&&ss(h,h.prev,a)>=0:ss(h,a,h.prev)<0||ss(h,h.next,a)<0}function kE(h,a){const u=H1(h.i,h.x,h.y),m=H1(a.i,a.x,a.y),y=h.next,T=a.prev;return h.next=a,a.prev=h,u.next=y,y.prev=u,m.next=u,u.prev=m,T.next=m,m.prev=T,m}function DE(h,a,u,m){const y=H1(h,a,u);return m?(y.next=m.next,y.prev=m,m.next.prev=y,m.next=y):(y.prev=y,y.next=y),y}function iv(h){h.next.prev=h.prev,h.prev.next=h.next,h.prevZ&&(h.prevZ.nextZ=h.nextZ),h.nextZ&&(h.nextZ.prevZ=h.prevZ)}function H1(h,a,u){return{i:h,x:a,y:u,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class wm{constructor(a,u){if(u>a)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=a,this._minGranularity=u}getGranularityForZoomLevel(a){return Math.max(Math.floor(this._baseZoomGranularity/(1<<a)),this._minGranularity,1)}}class ib{constructor(a){this.fill=a.fill,this.line=a.line,this.tile=a.tile,this.stencil=a.stencil,this.circle=a.circle}}ib.noSubdivision=new ib({fill:new wm(0,0),line:new wm(0,0),tile:new wm(0,0),stencil:new wm(0,0),circle:1}),mi("SubdivisionGranularityExpression",wm),mi("SubdivisionGranularitySetting",ib);const Sm=-32768,nv=32767;class u4{constructor(a,u){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=a,this._granularityCellSize=Ee/a,this._canonical=u}_getKey(a,u){return(a+=32768)<<16|u+32768}_vertexToIndex(a,u){if(a<-32768||u<-32768||a>32767||u>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const m=0|Math.round(a),y=0|Math.round(u),T=this._getKey(m,y);if(this._vertexDictionary.has(T))return this._vertexDictionary.get(T);const M=this._vertexBuffer.length/2;return this._vertexDictionary.set(T,M),this._vertexBuffer.push(m,y),M}_subdivideTrianglesScanline(a){if(this._granularity<2)return(function(y,T){const M=[];for(let R=0;R<T.length;R+=3){const F=T[R],$=T[R+1],H=T[R+2],K=y[2*F],ne=y[2*F+1];(y[2*$]-K)*(y[2*H+1]-ne)-(y[2*$+1]-ne)*(y[2*H]-K)>0?(M.push(F),M.push(H),M.push($)):(M.push(F),M.push($),M.push(H))}return M})(this._vertexBuffer,a);const u=[],m=a.length;for(let y=0;y<m;y+=3){const T=[a[y+0],a[y+1],a[y+2]],M=[this._vertexBuffer[2*a[y+0]+0],this._vertexBuffer[2*a[y+0]+1],this._vertexBuffer[2*a[y+1]+0],this._vertexBuffer[2*a[y+1]+1],this._vertexBuffer[2*a[y+2]+0],this._vertexBuffer[2*a[y+2]+1]];let R=1/0,F=1/0,$=-1/0,H=-1/0;for(let ge=0;ge<3;ge++){const ve=M[2*ge],Pe=M[2*ge+1];R=Math.min(R,ve),$=Math.max($,ve),F=Math.min(F,Pe),H=Math.max(H,Pe)}if(R===$||F===H)continue;const K=Math.floor(R/this._granularityCellSize),ne=Math.ceil($/this._granularityCellSize),oe=Math.floor(F/this._granularityCellSize),fe=Math.ceil(H/this._granularityCellSize);if(K!==ne||oe!==fe)for(let ge=oe;ge<fe;ge++){const ve=this._scanlineGenerateVertexRingForCellRow(ge,M,T);h4(this._vertexBuffer,ve,u)}else u.push(...T)}return u}_scanlineGenerateVertexRingForCellRow(a,u,m){const y=a*this._granularityCellSize,T=y+this._granularityCellSize,M=[];for(let R=0;R<3;R++){const F=u[2*R],$=u[2*R+1],H=u[2*(R+1)%6],K=u[(2*(R+1)+1)%6],ne=u[2*(R+2)%6],oe=u[(2*(R+2)+1)%6],fe=H-F,ge=K-$,ve=fe===0,Pe=ge===0,Ge=(y-$)/ge,Ie=(T-$)/ge,Re=Math.min(Ge,Ie),Ye=Math.max(Ge,Ie);if(!Pe&&(Re>=1||Ye<=0)||Pe&&($<y||$>T)){K>=y&&K<=T&&M.push(m[(R+1)%3]);continue}!Pe&&Re>0&&M.push(this._vertexToIndex(F+fe*Re,$+ge*Re));const et=F+fe*Math.max(Re,0),Mt=F+fe*Math.min(Ye,1);ve||this._generateIntraEdgeVertices(M,F,$,H,K,et,Mt),!Pe&&Ye<1&&M.push(this._vertexToIndex(F+fe*Ye,$+ge*Ye)),(Pe||K>=y&&K<=T)&&M.push(m[(R+1)%3]),!Pe&&(K<=y||K>=T)&&this._generateInterEdgeVertices(M,F,$,H,K,ne,oe,Mt,y,T)}return M}_generateIntraEdgeVertices(a,u,m,y,T,M,R){const F=y-u,$=T-m,H=$===0,K=H?Math.min(u,y):Math.min(M,R),ne=H?Math.max(u,y):Math.max(M,R),oe=Math.floor(K/this._granularityCellSize)+1,fe=Math.ceil(ne/this._granularityCellSize)-1;if(H?u<y:M<R)for(let ge=oe;ge<=fe;ge++){const ve=ge*this._granularityCellSize;a.push(this._vertexToIndex(ve,m+$*(ve-u)/F))}else for(let ge=fe;ge>=oe;ge--){const ve=ge*this._granularityCellSize;a.push(this._vertexToIndex(ve,m+$*(ve-u)/F))}}_generateInterEdgeVertices(a,u,m,y,T,M,R,F,$,H){const K=T-m,ne=M-y,oe=R-T,fe=($-T)/oe,ge=(H-T)/oe,ve=Math.min(fe,ge),Pe=Math.max(fe,ge),Ge=y+ne*ve;let Ie=Math.floor(Math.min(Ge,F)/this._granularityCellSize)+1,Re=Math.ceil(Math.max(Ge,F)/this._granularityCellSize)-1,Ye=F<Ge;const et=oe===0;if(et&&(R===$||R===H))return;if(et||ve>=1||Pe<=0){const Ut=m-R,Ot=M+(u-M)*Math.min(($-R)/Ut,(H-R)/Ut);Ie=Math.floor(Math.min(Ot,F)/this._granularityCellSize)+1,Re=Math.ceil(Math.max(Ot,F)/this._granularityCellSize)-1,Ye=F<Ot}const Mt=K>0?H:$;if(Ye)for(let Ut=Ie;Ut<=Re;Ut++)a.push(this._vertexToIndex(Ut*this._granularityCellSize,Mt));else for(let Ut=Re;Ut>=Ie;Ut--)a.push(this._vertexToIndex(Ut*this._granularityCellSize,Mt))}_generateOutline(a){const u=[];for(const m of a){const y=kf(m,this._granularity,!0),T=this._pointArrayToIndices(y),M=[];for(let R=1;R<T.length;R++)M.push(T[R-1]),M.push(T[R]);u.push(M)}return u}_handlePoles(a){let u=!1,m=!1;this._canonical&&(this._canonical.y===0&&(u=!0),this._canonical.y===(1<<this._canonical.z)-1&&(m=!0)),(u||m)&&this._fillPoles(a,u,m)}_ensureNoPoleVertices(){const a=this._vertexBuffer;for(let u=0;u<a.length;u+=2){const m=a[u+1];m===Sm&&(a[u+1]=-32767),m===nv&&(a[u+1]=32766)}}_generatePoleQuad(a,u,m,y,T,M){y>T!=(M===Sm)?(a.push(u),a.push(m),a.push(this._vertexToIndex(y,M)),a.push(m),a.push(this._vertexToIndex(T,M)),a.push(this._vertexToIndex(y,M))):(a.push(m),a.push(u),a.push(this._vertexToIndex(y,M)),a.push(this._vertexToIndex(T,M)),a.push(m),a.push(this._vertexToIndex(y,M)))}_fillPoles(a,u,m){const y=this._vertexBuffer,T=Ee,M=a.length;for(let R=2;R<M;R+=3){const F=a[R-2],$=a[R-1],H=a[R],K=y[2*F],ne=y[2*F+1],oe=y[2*$],fe=y[2*$+1],ge=y[2*H],ve=y[2*H+1];u&&(ne===0&&fe===0&&this._generatePoleQuad(a,F,$,K,oe,Sm),fe===0&&ve===0&&this._generatePoleQuad(a,$,H,oe,ge,Sm),ve===0&&ne===0&&this._generatePoleQuad(a,H,F,ge,K,Sm)),m&&(ne===T&&fe===T&&this._generatePoleQuad(a,F,$,K,oe,nv),fe===T&&ve===T&&this._generatePoleQuad(a,$,H,oe,ge,nv),ve===T&&ne===T&&this._generatePoleQuad(a,H,F,ge,K,nv))}}_initializeVertices(a){for(let u=0;u<a.length;u+=2)this._vertexToIndex(a[u],a[u+1])}subdividePolygonInternal(a,u){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:m,holeIndices:y}=(function(R){const F=[],$=[];for(const H of R)if(H.length!==0){H!==R[0]&&F.push($.length/2);for(let K=0;K<H.length;K++)$.push(H[K].x),$.push(H[K].y)}return{flattened:$,holeIndices:F}})(a);let T;this._initializeVertices(m);try{const R=(function($,H,K=2){const ne=H&&H.length,oe=ne?H[0]*K:$.length;let fe=IE($,0,oe,K,!0);const ge=[];if(!fe||fe.next===fe.prev)return ge;let ve,Pe,Ge;if(ne&&(fe=(function(Ie,Re,Ye,et){const Mt=[];for(let Ut=0,Ot=Re.length;Ut<Ot;Ut++){const Zt=IE(Ie,Re[Ut]*et,Ut<Ot-1?Re[Ut+1]*et:Ie.length,et,!1);Zt===Zt.next&&(Zt.steiner=!0),Mt.push(l4(Zt))}Mt.sort(s4);for(let Ut=0;Ut<Mt.length;Ut++)Ye=o4(Mt[Ut],Ye);return Ye})($,H,fe,K)),$.length>80*K){ve=$[0],Pe=$[1];let Ie=ve,Re=Pe;for(let Ye=K;Ye<oe;Ye+=K){const et=$[Ye],Mt=$[Ye+1];et<ve&&(ve=et),Mt<Pe&&(Pe=Mt),et>Ie&&(Ie=et),Mt>Re&&(Re=Mt)}Ge=Math.max(Ie-ve,Re-Pe),Ge=Ge!==0?32767/Ge:0}return Q_(fe,ge,K,ve,Pe,Ge,0),ge})(m,y),F=this._convertIndices(m,R);T=this._subdivideTrianglesScanline(F)}catch(R){console.error(R)}let M=[];return u&&(M=this._generateOutline(a)),this._ensureNoPoleVertices(),this._handlePoles(T),{verticesFlattened:this._vertexBuffer,indicesTriangles:T,indicesLineList:M}}_convertIndices(a,u){const m=[];for(let y=0;y<u.length;y++)m.push(this._vertexToIndex(a[2*u[y]],a[2*u[y]+1]));return m}_pointArrayToIndices(a){const u=[];for(let m=0;m<a.length;m++){const y=a[m];u.push(this._vertexToIndex(y.x,y.y))}return u}}function FE(h,a,u,m=!0){return new u4(u,a).subdividePolygonInternal(h,m)}function kf(h,a,u=!1){if(!h||h.length<1)return[];if(h.length<2)return[];const m=h[0],y=h[h.length-1],T=u&&(m.x!==y.x||m.y!==y.y);if(a<2)return T?[...h,h[0]]:[...h];const M=Math.floor(Ee/a),R=[];R.push(new d(h[0].x,h[0].y));const F=h.length,$=T?F:F-1;for(let H=0;H<$;H++){const K=h[H],ne=H<F-1?h[H+1]:h[0],oe=K.x,fe=K.y,ge=ne.x,ve=ne.y,Pe=oe!==ge,Ge=fe!==ve;if(!Pe&&!Ge)continue;const Ie=ge-oe,Re=ve-fe,Ye=Math.abs(Ie),et=Math.abs(Re);let Mt=oe,Ut=fe;for(;;){const Zt=Ie>0?(Math.floor(Mt/M)+1)*M:(Math.ceil(Mt/M)-1)*M,ni=Re>0?(Math.floor(Ut/M)+1)*M:(Math.ceil(Ut/M)-1)*M,Yt=Math.abs(Mt-Zt),$t=Math.abs(Ut-ni),It=Math.abs(Mt-ge),fi=Math.abs(Ut-ve),hi=Pe?Yt/Ye:Number.POSITIVE_INFINITY,_i=Ge?$t/et:Number.POSITIVE_INFINITY;if((It<=Yt||!Pe)&&(fi<=$t||!Ge))break;if(hi<_i&&Pe||!Ge){Mt=Zt,Ut+=Re*hi;const ui=new d(Mt,Math.round(Ut));R[R.length-1].x===ui.x&&R[R.length-1].y===ui.y||R.push(ui)}else{Mt+=Ie*_i,Ut=ni;const ui=new d(Math.round(Mt),Ut);R[R.length-1].x===ui.x&&R[R.length-1].y===ui.y||R.push(ui)}}const Ot=new d(ge,ve);R[R.length-1].x===Ot.x&&R[R.length-1].y===Ot.y||R.push(Ot)}return R}function h4(h,a,u){if(a.length===0)throw new Error("Subdivision vertex ring is empty.");let m=0,y=h[2*a[0]];for(let F=1;F<a.length;F++){const $=h[2*a[F]];$<y&&(y=$,m=F)}const T=a.length;let M=m,R=(M+1)%T;for(;;){const F=M-1>=0?M-1:T-1,$=(R+1)%T,H=h[2*a[F]],K=h[2*a[$]],ne=h[2*a[M]],oe=h[2*a[M]+1],fe=h[2*a[R]+1];let ge=!1;if(H<K)ge=!0;else if(H>K)ge=!1;else{const ve=fe-oe,Pe=-(h[2*a[R]]-ne),Ge=oe<fe?1:-1;((H-ne)*ve+(h[2*a[F]+1]-oe)*Pe)*Ge>((K-ne)*ve+(h[2*a[$]+1]-oe)*Pe)*Ge&&(ge=!0)}if(ge){const ve=a[F],Pe=a[M],Ge=a[R];ve!==Pe&&ve!==Ge&&Pe!==Ge&&u.push(Ge,Pe,ve),M--,M<0&&(M=T-1)}else{const ve=a[$],Pe=a[M],Ge=a[R];ve!==Pe&&ve!==Ge&&Pe!==Ge&&u.push(Ge,Pe,ve),R++,R>=T&&(R=0)}if(F===$)break}}function OE(h,a,u,m,y,T,M,R,F){const $=y.length/2,H=M&&R&&F;if($<si.MAX_VERTEX_ARRAY_LENGTH){const K=a.prepareSegment($,u,m),ne=K.vertexLength;for(let ge=0;ge<T.length;ge+=3)m.emplaceBack(ne+T[ge],ne+T[ge+1],ne+T[ge+2]);let oe,fe;K.vertexLength+=$,K.primitiveLength+=T.length/3,H&&(fe=M.prepareSegment($,u,R),oe=fe.vertexLength,fe.vertexLength+=$);for(let ge=0;ge<y.length;ge+=2)h(y[ge],y[ge+1]);if(H)for(let ge=0;ge<F.length;ge++){const ve=F[ge];for(let Pe=1;Pe<ve.length;Pe+=2)R.emplaceBack(oe+ve[Pe-1],oe+ve[Pe]);fe.primitiveLength+=ve.length/2}}else(function(K,ne,oe,fe,ge,ve){const Pe=[];for(let et=0;et<fe.length/2;et++)Pe.push(-1);const Ge={count:0};let Ie=0,Re=K.getOrCreateLatestSegment(ne,oe),Ye=Re.vertexLength;for(let et=2;et<ge.length;et+=3){const Mt=ge[et-2],Ut=ge[et-1],Ot=ge[et];let Zt=Pe[Mt]<Ie,ni=Pe[Ut]<Ie,Yt=Pe[Ot]<Ie;Re.vertexLength+((Zt?1:0)+(ni?1:0)+(Yt?1:0))>si.MAX_VERTEX_ARRAY_LENGTH&&(Re=K.createNewSegment(ne,oe),Ie=Ge.count,Zt=!0,ni=!0,Yt=!0,Ye=0);const $t=rv(Pe,fe,ve,Ge,Mt,Zt,Re),It=rv(Pe,fe,ve,Ge,Ut,ni,Re),fi=rv(Pe,fe,ve,Ge,Ot,Yt,Re);oe.emplaceBack(Ye+$t-Ie,Ye+It-Ie,Ye+fi-Ie),Re.primitiveLength++}})(a,u,m,y,T,h),H&&(function(K,ne,oe,fe,ge,ve){const Pe=[];for(let et=0;et<fe.length/2;et++)Pe.push(-1);const Ge={count:0};let Ie=0,Re=K.getOrCreateLatestSegment(ne,oe),Ye=Re.vertexLength;for(let et=0;et<ge.length;et++){const Mt=ge[et];for(let Ut=1;Ut<ge[et].length;Ut+=2){const Ot=Mt[Ut-1],Zt=Mt[Ut];let ni=Pe[Ot]<Ie,Yt=Pe[Zt]<Ie;Re.vertexLength+((ni?1:0)+(Yt?1:0))>si.MAX_VERTEX_ARRAY_LENGTH&&(Re=K.createNewSegment(ne,oe),Ie=Ge.count,ni=!0,Yt=!0,Ye=0);const $t=rv(Pe,fe,ve,Ge,Ot,ni,Re),It=rv(Pe,fe,ve,Ge,Zt,Yt,Re);oe.emplaceBack(Ye+$t-Ie,Ye+It-Ie),Re.primitiveLength++}}})(M,u,R,y,F,h),a.forceNewSegmentOnNextPrepare(),M?.forceNewSegmentOnNextPrepare()}function rv(h,a,u,m,y,T,M){if(T){const R=m.count;return u(a[2*y],a[2*y+1]),h[y]=m.count,m.count++,M.vertexLength++,R}return h[y]}class Z1{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=a.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new ze,this.indexArray=new Pt,this.indexArray2=new Qt,this.programConfigurations=new Hu(a.layers,a.zoom),this.segments=new si,this.segments2=new si,this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id))}populate(a,u,m){this.hasDependencies=Q0("fill",this.layers,u);const y=this.layers[0].layout.get("fill-sort-key"),T=!y.isConstant(),M=[];for(const{feature:R,id:F,index:$,sourceLayerIndex:H}of a){const K=this.layers[0]._featureFilter.needGeometry,ne=Xc(R,K);if(!this.layers[0]._featureFilter.filter(new qn(this.zoom),ne,m))continue;const oe=T?y.evaluate(ne,{},m,u.availableImages):void 0,fe={id:F,properties:R.properties,type:R.type,sourceLayerIndex:H,index:$,geometry:K?ne.geometry:Zc(R),patterns:{},sortKey:oe};M.push(fe)}T&&M.sort(((R,F)=>R.sortKey-F.sortKey));for(const R of M){const{geometry:F,index:$,sourceLayerIndex:H}=R;if(this.hasDependencies){const K=q1("fill",this.layers,R,{zoom:this.zoom},u);this.patternFeatures.push(K)}else this.addFeature(R,F,$,m,{},u.subdivisionGranularity);u.featureIndex.insert(a[$].feature,F,$,H,this.index)}}update(a,u,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,{imagePositions:m})}addFeatures(a,u,m){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,u,m,a.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,e4),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(a,u,m,y,T,M){for(const R of jh(u,500)){const F=FE(R,y,M.fill.getGranularityForZoomLevel(y.z)),$=this.layoutVertexArray;OE(((H,K)=>{$.emplaceBack(H,K)}),this.segments,this.layoutVertexArray,this.indexArray,F.verticesFlattened,F.indicesTriangles,this.segments2,this.indexArray2,F.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,m,{imagePositions:T,canonical:y})}}let zE,BE;mi("FillBucket",Z1,{omit:["layers","patternFeatures"]});var d4={get paint(){return BE=BE||new lo({"fill-antialias":new Mi(Tt.paint_fill["fill-antialias"]),"fill-opacity":new Fi(Tt.paint_fill["fill-opacity"]),"fill-color":new Fi(Tt.paint_fill["fill-color"]),"fill-outline-color":new Fi(Tt.paint_fill["fill-outline-color"]),"fill-translate":new Mi(Tt.paint_fill["fill-translate"]),"fill-translate-anchor":new Mi(Tt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Tf(Tt.paint_fill["fill-pattern"])})},get layout(){return zE=zE||new lo({"fill-sort-key":new Fi(Tt.layout_fill["fill-sort-key"])})}};class f4 extends ha{constructor(a,u){super(a,d4,u)}recalculate(a,u){super.recalculate(a,u);const m=this.paint._values["fill-outline-color"];m.value.kind==="constant"&&m.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new Z1(a)}queryRadius(){return K0(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:a,geometry:u,transform:m,pixelsToTileUnits:y}){return gE(J0(a,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-m.bearingInRadians,y),u)}isTileClipped(){return!0}}const p4=Hr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),m4=Hr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:g4}=p4;class sv{constructor(a,u,m,y,T){this.properties={},this.extent=m,this.type=0,this.id=void 0,this._pbf=a,this._geometry=-1,this._keys=y,this._values=T,a.readFields(_4,this,u)}loadGeometry(){const a=this._pbf;a.pos=this._geometry;const u=a.readVarint()+a.pos,m=[];let y,T=1,M=0,R=0,F=0;for(;a.pos<u;){if(M<=0){const $=a.readVarint();T=7&$,M=$>>3}if(M--,T===1||T===2)R+=a.readSVarint(),F+=a.readSVarint(),T===1&&(y&&m.push(y),y=[]),y&&y.push(new d(R,F));else{if(T!==7)throw new Error(`unknown command ${T}`);y&&y.push(y[0].clone())}}return y&&m.push(y),m}bbox(){const a=this._pbf;a.pos=this._geometry;const u=a.readVarint()+a.pos;let m=1,y=0,T=0,M=0,R=1/0,F=-1/0,$=1/0,H=-1/0;for(;a.pos<u;){if(y<=0){const K=a.readVarint();m=7&K,y=K>>3}if(y--,m===1||m===2)T+=a.readSVarint(),M+=a.readSVarint(),T<R&&(R=T),T>F&&(F=T),M<$&&($=M),M>H&&(H=M);else if(m!==7)throw new Error(`unknown command ${m}`)}return[R,$,F,H]}toGeoJSON(a,u,m){const y=this.extent*Math.pow(2,m),T=this.extent*a,M=this.extent*u,R=this.loadGeometry();function F(ne){return[360*(ne.x+T)/y-180,360/Math.PI*Math.atan(Math.exp((1-2*(ne.y+M)/y)*Math.PI))-90]}function $(ne){return ne.map(F)}let H;if(this.type===1){const ne=[];for(const fe of R)ne.push(fe[0]);const oe=$(ne);H=ne.length===1?{type:"Point",coordinates:oe[0]}:{type:"MultiPoint",coordinates:oe}}else if(this.type===2){const ne=R.map($);H=ne.length===1?{type:"LineString",coordinates:ne[0]}:{type:"MultiLineString",coordinates:ne}}else{if(this.type!==3)throw new Error("unknown feature type");{const ne=NE(R),oe=[];for(const fe of ne)oe.push(fe.map($));H=oe.length===1?{type:"Polygon",coordinates:oe[0]}:{type:"MultiPolygon",coordinates:oe}}}const K={type:"Feature",geometry:H,properties:this.properties};return this.id!=null&&(K.id=this.id),K}}function _4(h,a,u){h===1?a.id=u.readVarint():h===2?(function(m,y){const T=m.readVarint()+m.pos;for(;m.pos<T;){const M=y._keys[m.readVarint()],R=y._values[m.readVarint()];y.properties[M]=R}})(u,a):h===3?a.type=u.readVarint():h===4&&(a._geometry=u.pos)}function NE(h){const a=h.length;if(a<=1)return[h];const u=[];let m,y;for(let T=0;T<a;T++){const M=v4(h[T]);M!==0&&(y===void 0&&(y=M<0),y===M<0?(m&&u.push(m),m=[h[T]]):m&&m.push(h[T]))}return m&&u.push(m),u}function v4(h){let a=0;for(let u,m,y=0,T=h.length,M=T-1;y<T;M=y++)u=h[y],m=h[M],a+=(m.x-u.x)*(u.y+m.y);return a}sv.types=["Unknown","Point","LineString","Polygon"];class y4{constructor(a,u){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(b4,this,u),this.length=this._features.length}feature(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];const u=this._pbf.readVarint()+this._pbf.pos;return new sv(this._pbf,u,this.extent,this._keys,this._values)}}function b4(h,a,u){h===15?a.version=u.readVarint():h===1?a.name=u.readString():h===5?a.extent=u.readVarint():h===2?a._features.push(u.pos):h===3?a._keys.push(u.readString()):h===4&&a._values.push((function(m){let y=null;const T=m.readVarint()+m.pos;for(;m.pos<T;){const M=m.readVarint()>>3;y=M===1?m.readString():M===2?m.readFloat():M===3?m.readDouble():M===4?m.readVarint64():M===5?m.readVarint():M===6?m.readSVarint():M===7?m.readBoolean():null}if(y==null)throw new Error("unknown feature value");return y})(u))}class $E{constructor(a,u){this.layers=a.readFields(x4,{},u)}}function x4(h,a,u){if(h===3){const m=new y4(u,u.readVarint()+u.pos);m.length&&(a[m.name]=m)}}const X1=Math.pow(2,13);function ov(h,a,u,m,y,T,M,R){h.emplaceBack(a,u,2*Math.floor(m*X1)+M,y*X1*2,T*X1*2,Math.round(R))}class Y1{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=a.index,this.hasDependencies=!1,this.layoutVertexArray=new We,this.centroidVertexArray=new Fe,this.indexArray=new Pt,this.programConfigurations=new Hu(a.layers,a.zoom),this.segments=new si,this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id))}populate(a,u,m){this.features=[],this.hasDependencies=Q0("fill-extrusion",this.layers,u);for(const{feature:y,id:T,index:M,sourceLayerIndex:R}of a){const F=this.layers[0]._featureFilter.needGeometry,$=Xc(y,F);if(!this.layers[0]._featureFilter.filter(new qn(this.zoom),$,m))continue;const H={id:T,sourceLayerIndex:R,index:M,geometry:F?$.geometry:Zc(y),properties:y.properties,type:y.type,patterns:{}};this.hasDependencies?this.features.push(q1("fill-extrusion",this.layers,H,{zoom:this.zoom},u)):this.addFeature(H,H.geometry,M,m,{},u.subdivisionGranularity),u.featureIndex.insert(y,H.geometry,M,R,this.index,!0)}}addFeatures(a,u,m){for(const y of this.features){const{geometry:T}=y;this.addFeature(y,T,y.index,u,m,a.subdivisionGranularity)}}update(a,u,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,{imagePositions:m})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,g4),this.centroidVertexBuffer=a.createVertexBuffer(this.centroidVertexArray,m4.members,!0),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(a,u,m,y,T,M){for(const R of jh(u,500)){const F={x:0,y:0,sampleCount:0},$=this.layoutVertexArray.length;this.processPolygon(F,y,a,R,M);const H=this.layoutVertexArray.length-$,K=Math.floor(F.x/F.sampleCount),ne=Math.floor(F.y/F.sampleCount);for(let oe=0;oe<H;oe++)this.centroidVertexArray.emplaceBack(K,ne)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,m,{imagePositions:T,canonical:y})}processPolygon(a,u,m,y,T){if(y.length<1||VE(y[0]))return;for(const K of y)K.length!==0&&w4(a,K);const M={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},R=T.fill.getGranularityForZoomLevel(u.z),F=sv.types[m.type]==="Polygon";for(const K of y){if(K.length===0||VE(K))continue;const ne=kf(K,R,F);this._generateSideFaces(ne,M)}if(!F)return;const $=FE(y,u,R,!1),H=this.layoutVertexArray;OE(((K,ne)=>{ov(H,K,ne,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,$.verticesFlattened,$.indicesTriangles)}_generateSideFaces(a,u){let m=0;for(let y=1;y<a.length;y++){const T=a[y],M=a[y-1];if(S4(T,M))continue;u.segment.vertexLength+4>si.MAX_VERTEX_ARRAY_LENGTH&&(u.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const R=T.sub(M)._perp()._unit(),F=M.dist(T);m+F>32768&&(m=0),ov(this.layoutVertexArray,T.x,T.y,R.x,R.y,0,0,m),ov(this.layoutVertexArray,T.x,T.y,R.x,R.y,0,1,m),m+=F,ov(this.layoutVertexArray,M.x,M.y,R.x,R.y,0,0,m),ov(this.layoutVertexArray,M.x,M.y,R.x,R.y,0,1,m);const $=u.segment.vertexLength;this.indexArray.emplaceBack($,$+2,$+1),this.indexArray.emplaceBack($+1,$+2,$+3),u.segment.vertexLength+=4,u.segment.primitiveLength+=2}}}function w4(h,a){for(let u=0;u<a.length;u++){const m=a[u];u===a.length-1&&a[0].x===m.x&&a[0].y===m.y||(h.x+=m.x,h.y+=m.y,h.sampleCount++)}}function S4(h,a){return h.x===a.x&&(h.x<0||h.x>Ee)||h.y===a.y&&(h.y<0||h.y>Ee)}function VE(h){return h.every((a=>a.x<0))||h.every((a=>a.x>Ee))||h.every((a=>a.y<0))||h.every((a=>a.y>Ee))}let UE;mi("FillExtrusionBucket",Y1,{omit:["layers","features"]});var T4={get paint(){return UE=UE||new lo({"fill-extrusion-opacity":new Mi(Tt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Fi(Tt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Mi(Tt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Mi(Tt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Tf(Tt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Fi(Tt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Fi(Tt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Mi(Tt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class M4 extends ha{constructor(a,u){super(a,T4,u)}createBucket(a){return new Y1(a)}queryRadius(){return K0(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:a,feature:u,featureState:m,geometry:y,transform:T,pixelsToTileUnits:M,pixelPosMatrix:R}){const F=J0(a,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-T.bearingInRadians,M),$=this.paint.get("fill-extrusion-height").evaluate(u,m),H=this.paint.get("fill-extrusion-base").evaluate(u,m),K=(function(oe,fe){const ge=[];for(const ve of oe){const Pe=[ve.x,ve.y,0,1];re(Pe,Pe,fe),ge.push(new d(Pe[0]/Pe[3],Pe[1]/Pe[3]))}return ge})(F,R),ne=(function(oe,fe,ge,ve){const Pe=[],Ge=[],Ie=ve[8]*fe,Re=ve[9]*fe,Ye=ve[10]*fe,et=ve[11]*fe,Mt=ve[8]*ge,Ut=ve[9]*ge,Ot=ve[10]*ge,Zt=ve[11]*ge;for(const ni of oe){const Yt=[],$t=[];for(const It of ni){const fi=It.x,hi=It.y,_i=ve[0]*fi+ve[4]*hi+ve[12],ui=ve[1]*fi+ve[5]*hi+ve[13],Ci=ve[2]*fi+ve[6]*hi+ve[14],wn=ve[3]*fi+ve[7]*hi+ve[15],un=Ci+Ye,wr=wn+et,eo=_i+Mt,ps=ui+Ut,Sr=Ci+Ot,mr=wn+Zt,In=new d((_i+Ie)/wr,(ui+Re)/wr);In.z=un/wr,Yt.push(In);const Nr=new d(eo/mr,ps/mr);Nr.z=Sr/mr,$t.push(Nr)}Pe.push(Yt),Ge.push($t)}return[Pe,Ge]})(y,H,$,R);return(function(oe,fe,ge){let ve=1/0;gE(ge,fe)&&(ve=jE(ge,fe[0]));for(let Pe=0;Pe<fe.length;Pe++){const Ge=fe[Pe],Ie=oe[Pe];for(let Re=0;Re<Ge.length-1;Re++){const Ye=Ge[Re],et=[Ye,Ge[Re+1],Ie[Re+1],Ie[Re],Ye];vm(ge,et)&&(ve=Math.min(ve,jE(ge,et)))}}return ve!==1/0&&ve})(ne[0],ne[1],K)}}function av(h,a){return h.x*a.x+h.y*a.y}function jE(h,a){if(h.length===1){let u=0;const m=a[u++];let y;for(;!y||m.equals(y);)if(y=a[u++],!y)return 1/0;for(;u<a.length;u++){const T=a[u],M=h[0],R=y.sub(m),F=T.sub(m),$=M.sub(m),H=av(R,R),K=av(R,F),ne=av(F,F),oe=av($,R),fe=av($,F),ge=H*ne-K*K,ve=(ne*oe-K*fe)/ge,Pe=(H*fe-K*oe)/ge,Ge=m.z*(1-ve-Pe)+y.z*ve+T.z*Pe;if(isFinite(Ge))return Ge}return 1/0}{let u=1/0;for(const m of a)u=Math.min(u,m.z);return u}}const C4=Hr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:E4}=C4,A4=Hr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:P4}=A4,I4=Math.cos(Math.PI/180*37.5),GE=Math.pow(2,14)/.5;class K1{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=a.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((u=>{this.gradients[u.id]={}})),this.layoutVertexArray=new tt,this.layoutVertexArray2=new je,this.indexArray=new Pt,this.programConfigurations=new Hu(a.layers,a.zoom),this.segments=new si,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id))}populate(a,u,m){this.hasDependencies=Q0("line",this.layers,u)||this.hasLineDasharray(this.layers);const y=this.layers[0].layout.get("line-sort-key"),T=!y.isConstant(),M=[];for(const{feature:R,id:F,index:$,sourceLayerIndex:H}of a){const K=this.layers[0]._featureFilter.needGeometry,ne=Xc(R,K);if(!this.layers[0]._featureFilter.filter(new qn(this.zoom),ne,m))continue;const oe=T?y.evaluate(ne,{},m):void 0,fe={id:F,properties:R.properties,type:R.type,sourceLayerIndex:H,index:$,geometry:K?ne.geometry:Zc(R),patterns:{},dashes:{},sortKey:oe};M.push(fe)}T&&M.sort(((R,F)=>R.sortKey-F.sortKey));for(const R of M){const{geometry:F,index:$,sourceLayerIndex:H}=R;this.hasDependencies?(Q0("line",this.layers,u)?q1("line",this.layers,R,{zoom:this.zoom},u):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,R,this.zoom,u),this.patternFeatures.push(R)):this.addFeature(R,F,$,m,{},{},u.subdivisionGranularity),u.featureIndex.insert(a[$].feature,F,$,H,this.index)}}update(a,u,m,y){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,{imagePositions:m,dashPositions:y})}addFeatures(a,u,m,y){for(const T of this.patternFeatures)this.addFeature(T,T.geometry,T.index,u,m,y,a.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,P4)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,E4),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(a){if(a.properties&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}}addFeature(a,u,m,y,T,M,R){const F=this.layers[0].layout,$=F.get("line-join").evaluate(a,{}),H=F.get("line-cap"),K=F.get("line-miter-limit"),ne=F.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(const oe of u)this.addLine(oe,a,$,H,K,ne,y,R);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,m,{imagePositions:T,dashPositions:M,canonical:y})}addLine(a,u,m,y,T,M,R,F){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,a=kf(a,R?F.line.getGranularityForZoomLevel(R.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ie=0;Ie<a.length-1;Ie++)this.totalDistance+=a[Ie].dist(a[Ie+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const $=sv.types[u.type]==="Polygon";let H=a.length;for(;H>=2&&a[H-1].equals(a[H-2]);)H--;let K=0;for(;K<H-1&&a[K].equals(a[K+1]);)K++;if(H<($?3:2))return;m==="bevel"&&(T=1.05);const ne=this.overscaling<=16?122880/(512*this.overscaling):0,oe=this.segments.prepareSegment(10*H,this.layoutVertexArray,this.indexArray);let fe,ge,ve,Pe,Ge;this.e1=this.e2=-1,$&&(fe=a[H-2],Ge=a[K].sub(fe)._unit()._perp());for(let Ie=K;Ie<H;Ie++){if(ve=Ie===H-1?$?a[K+1]:void 0:a[Ie+1],ve&&a[Ie].equals(ve))continue;Ge&&(Pe=Ge),fe&&(ge=fe),fe=a[Ie],Ge=ve?ve.sub(fe)._unit()._perp():Pe,Pe=Pe||Ge;let Re=Pe.add(Ge);Re.x===0&&Re.y===0||Re._unit();const Ye=Pe.x*Ge.x+Pe.y*Ge.y,et=Re.x*Ge.x+Re.y*Ge.y,Mt=et!==0?1/et:1/0,Ut=2*Math.sqrt(2-2*et),Ot=et<I4&&ge&&ve,Zt=Pe.x*Ge.y-Pe.y*Ge.x>0;if(Ot&&Ie>K){const $t=fe.dist(ge);if($t>2*ne){const It=fe.sub(fe.sub(ge)._mult(ne/$t)._round());this.updateDistance(ge,It),this.addCurrentVertex(It,Pe,0,0,oe),ge=It}}const ni=ge&&ve;let Yt=ni?m:$?"butt":y;if(ni&&Yt==="round"&&(Mt<M?Yt="miter":Mt<=2&&(Yt="fakeround")),Yt==="miter"&&Mt>T&&(Yt="bevel"),Yt==="bevel"&&(Mt>2&&(Yt="flipbevel"),Mt<T&&(Yt="miter")),ge&&this.updateDistance(ge,fe),Yt==="miter")Re._mult(Mt),this.addCurrentVertex(fe,Re,0,0,oe);else if(Yt==="flipbevel"){if(Mt>100)Re=Ge.mult(-1);else{const $t=Mt*Pe.add(Ge).mag()/Pe.sub(Ge).mag();Re._perp()._mult($t*(Zt?-1:1))}this.addCurrentVertex(fe,Re,0,0,oe),this.addCurrentVertex(fe,Re.mult(-1),0,0,oe)}else if(Yt==="bevel"||Yt==="fakeround"){const $t=-Math.sqrt(Mt*Mt-1),It=Zt?$t:0,fi=Zt?0:$t;if(ge&&this.addCurrentVertex(fe,Pe,It,fi,oe),Yt==="fakeround"){const hi=Math.round(180*Ut/Math.PI/20);for(let _i=1;_i<hi;_i++){let ui=_i/hi;if(ui!==.5){const wn=ui-.5;ui+=ui*wn*(ui-1)*((1.0904+Ye*(Ye*(3.55645-1.43519*Ye)-3.2452))*wn*wn+(.848013+Ye*(.215638*Ye-1.06021)))}const Ci=Ge.sub(Pe)._mult(ui)._add(Pe)._unit()._mult(Zt?-1:1);this.addHalfVertex(fe,Ci.x,Ci.y,!1,Zt,0,oe)}}ve&&this.addCurrentVertex(fe,Ge,-It,-fi,oe)}else if(Yt==="butt")this.addCurrentVertex(fe,Re,0,0,oe);else if(Yt==="square"){const $t=ge?1:-1;this.addCurrentVertex(fe,Re,$t,$t,oe)}else Yt==="round"&&(ge&&(this.addCurrentVertex(fe,Pe,0,0,oe),this.addCurrentVertex(fe,Pe,1,1,oe,!0)),ve&&(this.addCurrentVertex(fe,Ge,-1,-1,oe,!0),this.addCurrentVertex(fe,Ge,0,0,oe)));if(Ot&&Ie<H-1){const $t=fe.dist(ve);if($t>2*ne){const It=fe.add(ve.sub(fe)._mult(ne/$t)._round());this.updateDistance(fe,It),this.addCurrentVertex(It,Ge,0,0,oe),fe=It}}}}addCurrentVertex(a,u,m,y,T,M=!1){const R=u.y*y-u.x,F=-u.y-u.x*y;this.addHalfVertex(a,u.x+u.y*m,u.y-u.x*m,M,!1,m,T),this.addHalfVertex(a,R,F,M,!0,-y,T),this.distance>GE/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(a,u,m,y,T,M))}addHalfVertex({x:a,y:u},m,y,T,M,R,F){const $=.5*(this.lineClips?this.scaledDistance*(GE-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a<<1)+(T?1:0),(u<<1)+(M?1:0),Math.round(63*m)+128,Math.round(63*y)+128,1+(R===0?0:R<0?-1:1)|(63&$)<<2,$>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const H=F.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,H,this.e2),F.primitiveLength++),M?this.e2=H:this.e1=H}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(a,u){this.distance+=a.dist(u),this.updateScaledDistance()}hasLineDasharray(a){for(const u of a){const m=u.paint.get("line-dasharray");if(m&&!m.isConstant())return!0}return!1}addLineDashDependencies(a,u,m,y){for(const T of a){const M=T.paint.get("line-dasharray");if(!M||M.value.kind==="constant")continue;const R=T.layout.get("line-cap")==="round",F={dasharray:M.value.evaluate({zoom:m-1},u,{}),round:R},$={dasharray:M.value.evaluate({zoom:m},u,{}),round:R},H={dasharray:M.value.evaluate({zoom:m+1},u,{}),round:R},K=`${F.dasharray.join(",")},${F.round}`,ne=`${$.dasharray.join(",")},${$.round}`,oe=`${H.dasharray.join(",")},${H.round}`;y.dashDependencies[K]=F,y.dashDependencies[ne]=$,y.dashDependencies[oe]=H,u.dashes[T.id]={min:K,mid:ne,max:oe}}}}let qE,WE;mi("LineBucket",K1,{omit:["layers","patternFeatures"]});var HE={get paint(){return WE=WE||new lo({"line-opacity":new Fi(Tt.paint_line["line-opacity"]),"line-color":new Fi(Tt.paint_line["line-color"]),"line-translate":new Mi(Tt.paint_line["line-translate"]),"line-translate-anchor":new Mi(Tt.paint_line["line-translate-anchor"]),"line-width":new Fi(Tt.paint_line["line-width"]),"line-gap-width":new Fi(Tt.paint_line["line-gap-width"]),"line-offset":new Fi(Tt.paint_line["line-offset"]),"line-blur":new Fi(Tt.paint_line["line-blur"]),"line-dasharray":new Tf(Tt.paint_line["line-dasharray"]),"line-pattern":new Tf(Tt.paint_line["line-pattern"]),"line-gradient":new um(Tt.paint_line["line-gradient"])})},get layout(){return qE=qE||new lo({"line-cap":new Mi(Tt.layout_line["line-cap"]),"line-join":new Fi(Tt.layout_line["line-join"]),"line-miter-limit":new Mi(Tt.layout_line["line-miter-limit"]),"line-round-limit":new Mi(Tt.layout_line["line-round-limit"]),"line-sort-key":new Fi(Tt.layout_line["line-sort-key"])})}};class R4 extends Fi{possiblyEvaluate(a,u){return u=new qn(Math.floor(u.zoom),{now:u.now,fadeDuration:u.fadeDuration,zoomHistory:u.zoomHistory,transition:u.transition}),super.possiblyEvaluate(a,u)}evaluate(a,u,m,y){return u=Je({},u,{zoom:Math.floor(u.zoom)}),super.evaluate(a,u,m,y)}}let nb;class L4 extends ha{constructor(a,u){super(a,HE,u),this.gradientVersion=0,nb||(nb=new R4(HE.paint.properties["line-width"].specification),nb.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const u=this.gradientExpression();this.stepInterpolant=!!(function(m){return m._styleExpression!==void 0})(u)&&u._styleExpression.expression instanceof Ma,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,u){super.recalculate(a,u),this.paint._values["line-floorwidth"]=nb.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new K1(a)}queryRadius(a){const u=a,m=ZE(bm("line-width",this,u),bm("line-gap-width",this,u)),y=bm("line-offset",this,u);return m/2+Math.abs(y)+K0(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:a,feature:u,featureState:m,geometry:y,transform:T,pixelsToTileUnits:M}){const R=J0(a,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-T.bearingInRadians,M),F=M/2*ZE(this.paint.get("line-width").evaluate(u,m),this.paint.get("line-gap-width").evaluate(u,m)),$=this.paint.get("line-offset").evaluate(u,m);return $&&(y=(function(H,K){const ne=[];for(let oe=0;oe<H.length;oe++){const fe=$N(H[oe]),ge=[];for(let ve=0;ve<fe.length;ve++){const Pe=fe[ve],Ge=fe[ve-1],Ie=fe[ve+1],Re=ve===0?new d(0,0):Pe.sub(Ge)._unit()._perp(),Ye=ve===fe.length-1?new d(0,0):Ie.sub(Pe)._unit()._perp(),et=Re._add(Ye)._unit(),Mt=et.x*Ye.x+et.y*Ye.y;Mt!==0&&et._mult(1/Mt),ge.push(et._mult(K)._add(Pe))}ne.push(ge)}return ne})(y,$*M)),(function(H,K,ne){for(let oe=0;oe<K.length;oe++){const fe=K[oe];if(H.length>=3){for(let ge=0;ge<fe.length;ge++)if(ym(H,fe[ge]))return!0}if(zN(H,fe,ne))return!0}return!1})(R,y,F)}isTileClipped(){return!0}}function ZE(h,a){return a>0?a+2*h:h}const k4=Hr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),D4=Hr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Hr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const F4=Hr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Hr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const XE=Hr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),O4=Hr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function z4(h,a,u){return h.sections.forEach((m=>{m.text=(function(y,T,M){const R=T.layout.get("text-transform").evaluate(M,{});return R==="uppercase"?y=y.toLocaleUpperCase():R==="lowercase"&&(y=y.toLocaleLowerCase()),qc.applyArabicShaping&&(y=qc.applyArabicShaping(y)),y})(m.text,a,u)})),h}Hr([{name:"triangle",components:3,type:"Uint16"}]),Hr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Hr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Hr([{type:"Float32",name:"offsetX"}]),Hr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Hr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var Is=24;const lv={"!":"ï¸","#":"ï¼",$:"ï¼","%":"ï¼","&":"ï¼","(":"ï¸µ",")":"ï¸¶","*":"ï¼","+":"ï¼",",":"ï¸","-":"ï¸²",".":"ã»","/":"ï¼",":":"ï¸",";":"ï¸","<":"ï¸¿","=":"ï¼",">":"ï¹","?":"ï¸","@":"ï¼ ","[":"ï¹","\\":"ï¼¼","]":"ï¹","^":"ï¼¾",_:"ï¸³","`":"ï½","{":"ï¸·","|":"â","}":"ï¸¸","~":"ï½","Â¢":"ï¿ ","Â£":"ï¿¡","Â¥":"ï¿¥","Â¦":"ï¿¤","Â¬":"ï¿¢","Â¯":"ï¿£","â":"ï¸²","â":"ï¸±","â":"ï¹","â":"ï¹","â":"ï¹","â":"ï¹","â¦":"ï¸","â¯":"ï¸","â§":"ã»","â©":"ï¿¦","ã":"ï¸","ã":"ï¸","ã":"ï¸¿","ã":"ï¹","ã":"ï¸½","ã":"ï¸¾","ã":"ï¹","ã":"ï¹","ã":"ï¹","ã":"ï¹","ã":"ï¸»","ã":"ï¸¼","ã":"ï¸¹","ã":"ï¸º","ã":"ï¸","ã":"ï¸","ï¼":"ï¸","ï¼":"ï¸µ","ï¼":"ï¸¶","ï¼":"ï¸","ï¼":"ï¸²","ï¼":"ã»","ï¼":"ï¸","ï¼":"ï¸","ï¼":"ï¸¿","ï¼":"ï¹","ï¼":"ï¸","ï¼»":"ï¹","ï¼½":"ï¹","ï¼¿":"ï¸³","ï½":"ï¸·","ï½":"â","ï½":"ï¸¸","ï½":"ï¸µ","ï½ ":"ï¸¶","ï½¡":"ï¸","ï½¢":"ï¹","ï½£":"ï¹"},B4={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},N4={40:!0};function YE(h,a,u,m,y,T){if("fontStack"in a){const M=u[a.fontStack],R=M&&M[h];return R?R.metrics.advance*a.scale+y:0}{const M=m[a.imageName];return M?M.displaySize[0]*a.scale*Is/T+y:0}}function KE(h,a,u,m){const y=Math.pow(h-a,2);return m?h<a?y/2:2*y:y+Math.abs(u)*u}function $4(h,a,u){let m=0;return h===10&&(m-=1e4),u&&(m+=150),h!==40&&h!==65288||(m+=50),a!==41&&a!==65289||(m+=50),m}function JE(h,a,u,m,y,T){let M=null,R=KE(a,u,y,T);for(const F of m){const $=KE(a-F.x,u,y,T)+F.badness;$<=R&&(M=F,R=$)}return{index:h,x:a,priorBreak:M,badness:R}}function QE(h){return h?QE(h.priorBreak).concat(h.index):[]}class Tm{constructor(a="",u=[],m=[]){this.text=a,this.sections=u,this.sectionIndex=m,this.imageSectionID=null}static fromFeature(a,u){const m=new Tm;for(let y=0;y<a.sections.length;y++){const T=a.sections[y];T.image?m.addImageSection(T):m.addTextSection(T,u)}return m}length(){return[...this.text].length}getSection(a){return this.sections[this.sectionIndex[a]]}getSectionIndex(a){return this.sectionIndex[a]}verticalizePunctuation(){this.text=(function(a){let u="",m={premature:!0,value:void 0};const y=a[Symbol.iterator]();let T=y.next();const M=a[Symbol.iterator]();M.next();let R=M.next();for(;!T.done;)u+=!R.done&&B_(R.value.codePointAt(0))&&!lv[R.value]||!m.premature&&B_(m.value.codePointAt(0))&&!lv[m.value]||!lv[T.value]?T.value:lv[T.value],m={value:T.value,premature:!1},T=y.next(),R=M.next();return u})(this.text)}hasZeroWidthSpaces(){return this.text.includes("â")}trim(){const a=this.text.match(/^\s*/),u=a?a[0].length:0,m=this.text.match(/\S\s*$/),y=m?m[0].length-1:0;this.text=this.text.substring(u,this.text.length-y),this.sectionIndex=this.sectionIndex.slice(u,this.sectionIndex.length-y)}substring(a,u){const m=[...this.text].slice(a,u).join(""),y=this.sectionIndex.slice(a,u);return new Tm(m,this.sections,y)}toCodeUnitIndex(a){return[...this.text].slice(0,a).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((a,u)=>Math.max(a,this.sections[u].scale)),0)}getMaxImageSize(a){let u=0,m=0;for(let y=0;y<this.length();y++){const T=this.getSection(y);if("imageName"in T){const M=a[T.imageName];if(!M)continue;const R=M.displaySize;u=Math.max(u,R[0]),m=Math.max(m,R[1])}}return{maxImageWidth:u,maxImageHeight:m}}addTextSection(a,u){this.text+=a.text,this.sections.push({scale:a.scale||1,verticalAlign:a.verticalAlign||"bottom",fontStack:a.fontStack||u});const m=this.sections.length-1;this.sectionIndex.push(...[...a.text].map((()=>m)))}addImageSection(a){const u=a.image?a.image.name:"";if(u.length===0)return void st("Can't add FormattedSection with an empty image.");const m=this.getNextImageSectionCharCode();m?(this.text+=String.fromCharCode(m),this.sections.push({scale:1,verticalAlign:a.verticalAlign||"bottom",imageName:u}),this.sectionIndex.push(this.sections.length-1)):st("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(a,u,m,y,T){const M=[],R=this.determineAverageLineWidth(a,u,m,y,T),F=this.hasZeroWidthSpaces();let $=0,H=0;const K=this.text[Symbol.iterator]();let ne=K.next();const oe=this.text[Symbol.iterator]();oe.next();let fe=oe.next();const ge=this.text[Symbol.iterator]();ge.next(),ge.next();let ve=ge.next();for(;!ne.done;){const Pe=this.getSection(H),Ge=ne.value.codePointAt(0);if(N0(Ge)||($+=YE(Ge,Pe,m,y,a,T)),!fe.done){const Ie=xf(Ge),Re=fe.value.codePointAt(0);(B4[Ge]||Ie||"imageName"in Pe||!ve.done&&N4[Re])&&M.push(JE(H+1,$,R,M,$4(Ge,Re,Ie&&F),!1))}H++,ne=K.next(),fe=oe.next(),ve=ge.next()}return QE(JE(this.length(),$,R,M,0,!0))}determineAverageLineWidth(a,u,m,y,T){let M=0,R=0;for(const F of this.text){const $=this.getSection(R);M+=YE(F.codePointAt(0),$,m,y,a,T),R++}return M/Math.max(1,Math.ceil(M/u))}}const J1=4294967296,eA=1/J1,tA=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class rb{constructor(a=new Uint8Array(16)){this.buf=ArrayBuffer.isView(a)?a:new Uint8Array(a),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(a,u,m=this.length){for(;this.pos<m;){const y=this.readVarint(),T=y>>3,M=this.pos;this.type=7&y,a(T,u,this),this.pos===M&&this.skip(y)}return u}readMessage(a,u){return this.readFields(a,u,this.readVarint()+this.pos)}readFixed32(){const a=this.dataView.getUint32(this.pos,!0);return this.pos+=4,a}readSFixed32(){const a=this.dataView.getInt32(this.pos,!0);return this.pos+=4,a}readFixed64(){const a=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*J1;return this.pos+=8,a}readSFixed64(){const a=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*J1;return this.pos+=8,a}readFloat(){const a=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,a}readDouble(){const a=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,a}readVarint(a){const u=this.buf;let m,y;return y=u[this.pos++],m=127&y,y<128?m:(y=u[this.pos++],m|=(127&y)<<7,y<128?m:(y=u[this.pos++],m|=(127&y)<<14,y<128?m:(y=u[this.pos++],m|=(127&y)<<21,y<128?m:(y=u[this.pos],m|=(15&y)<<28,(function(T,M,R){const F=R.buf;let $,H;if(H=F[R.pos++],$=(112&H)>>4,H<128||(H=F[R.pos++],$|=(127&H)<<3,H<128)||(H=F[R.pos++],$|=(127&H)<<10,H<128)||(H=F[R.pos++],$|=(127&H)<<17,H<128)||(H=F[R.pos++],$|=(127&H)<<24,H<128)||(H=F[R.pos++],$|=(1&H)<<31,H<128))return Mm(T,$,M);throw new Error("Expected varint not more than 10 bytes")})(m,a,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const a=this.readVarint();return a%2==1?(a+1)/-2:a/2}readBoolean(){return!!this.readVarint()}readString(){const a=this.readVarint()+this.pos,u=this.pos;return this.pos=a,a-u>=12&&tA?tA.decode(this.buf.subarray(u,a)):(function(m,y,T){let M="",R=y;for(;R<T;){const F=m[R];let $,H,K,ne=null,oe=F>239?4:F>223?3:F>191?2:1;if(R+oe>T)break;oe===1?F<128&&(ne=F):oe===2?($=m[R+1],(192&$)==128&&(ne=(31&F)<<6|63&$,ne<=127&&(ne=null))):oe===3?($=m[R+1],H=m[R+2],(192&$)==128&&(192&H)==128&&(ne=(15&F)<<12|(63&$)<<6|63&H,(ne<=2047||ne>=55296&&ne<=57343)&&(ne=null))):oe===4&&($=m[R+1],H=m[R+2],K=m[R+3],(192&$)==128&&(192&H)==128&&(192&K)==128&&(ne=(15&F)<<18|(63&$)<<12|(63&H)<<6|63&K,(ne<=65535||ne>=1114112)&&(ne=null))),ne===null?(ne=65533,oe=1):ne>65535&&(ne-=65536,M+=String.fromCharCode(ne>>>10&1023|55296),ne=56320|1023&ne),M+=String.fromCharCode(ne),R+=oe}return M})(this.buf,u,a)}readBytes(){const a=this.readVarint()+this.pos,u=this.buf.subarray(this.pos,a);return this.pos=a,u}readPackedVarint(a=[],u){const m=this.readPackedEnd();for(;this.pos<m;)a.push(this.readVarint(u));return a}readPackedSVarint(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readSVarint());return a}readPackedBoolean(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readBoolean());return a}readPackedFloat(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readFloat());return a}readPackedDouble(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readDouble());return a}readPackedFixed32(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readFixed32());return a}readPackedSFixed32(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readSFixed32());return a}readPackedFixed64(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readFixed64());return a}readPackedSFixed64(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readSFixed64());return a}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(a){const u=7&a;if(u===0)for(;this.buf[this.pos++]>127;);else if(u===2)this.pos=this.readVarint()+this.pos;else if(u===5)this.pos+=4;else{if(u!==1)throw new Error(`Unimplemented type: ${u}`);this.pos+=8}}writeTag(a,u){this.writeVarint(a<<3|u)}realloc(a){let u=this.length||16;for(;u<this.pos+a;)u*=2;if(u!==this.length){const m=new Uint8Array(u);m.set(this.buf),this.buf=m,this.dataView=new DataView(m.buffer),this.length=u}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeSFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*eA),!0),this.pos+=8}writeSFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*eA),!0),this.pos+=8}writeVarint(a){(a=+a||0)>268435455||a<0?(function(u,m){let y,T;if(u>=0?(y=u%4294967296|0,T=u/4294967296|0):(y=~(-u%4294967296),T=~(-u/4294967296),4294967295^y?y=y+1|0:(y=0,T=T+1|0)),u>=18446744073709552e3||u<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");m.realloc(10),(function(M,R,F){F.buf[F.pos++]=127&M|128,M>>>=7,F.buf[F.pos++]=127&M|128,M>>>=7,F.buf[F.pos++]=127&M|128,M>>>=7,F.buf[F.pos++]=127&M|128,F.buf[F.pos]=127&(M>>>=7)})(y,0,m),(function(M,R){const F=(7&M)<<4;R.buf[R.pos++]|=F|((M>>>=3)?128:0),M&&(R.buf[R.pos++]=127&M|((M>>>=7)?128:0),M&&(R.buf[R.pos++]=127&M|((M>>>=7)?128:0),M&&(R.buf[R.pos++]=127&M|((M>>>=7)?128:0),M&&(R.buf[R.pos++]=127&M|((M>>>=7)?128:0),M&&(R.buf[R.pos++]=127&M)))))})(T,m)})(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))}writeSVarint(a){this.writeVarint(a<0?2*-a-1:2*a)}writeBoolean(a){this.writeVarint(+a)}writeString(a){a=String(a),this.realloc(4*a.length),this.pos++;const u=this.pos;this.pos=(function(y,T,M){for(let R,F,$=0;$<T.length;$++){if(R=T.charCodeAt($),R>55295&&R<57344){if(!F){R>56319||$+1===T.length?(y[M++]=239,y[M++]=191,y[M++]=189):F=R;continue}if(R<56320){y[M++]=239,y[M++]=191,y[M++]=189,F=R;continue}R=F-55296<<10|R-56320|65536,F=null}else F&&(y[M++]=239,y[M++]=191,y[M++]=189,F=null);R<128?y[M++]=R:(R<2048?y[M++]=R>>6|192:(R<65536?y[M++]=R>>12|224:(y[M++]=R>>18|240,y[M++]=R>>12&63|128),y[M++]=R>>6&63|128),y[M++]=63&R|128)}return M})(this.buf,a,this.pos);const m=this.pos-u;m>=128&&iA(u,m,this),this.pos=u-1,this.writeVarint(m),this.pos+=m}writeFloat(a){this.realloc(4),this.dataView.setFloat32(this.pos,a,!0),this.pos+=4}writeDouble(a){this.realloc(8),this.dataView.setFloat64(this.pos,a,!0),this.pos+=8}writeBytes(a){const u=a.length;this.writeVarint(u),this.realloc(u);for(let m=0;m<u;m++)this.buf[this.pos++]=a[m]}writeRawMessage(a,u){this.pos++;const m=this.pos;a(u,this);const y=this.pos-m;y>=128&&iA(m,y,this),this.pos=m-1,this.writeVarint(y),this.pos+=y}writeMessage(a,u,m){this.writeTag(a,2),this.writeRawMessage(u,m)}writePackedVarint(a,u){u.length&&this.writeMessage(a,V4,u)}writePackedSVarint(a,u){u.length&&this.writeMessage(a,U4,u)}writePackedBoolean(a,u){u.length&&this.writeMessage(a,q4,u)}writePackedFloat(a,u){u.length&&this.writeMessage(a,j4,u)}writePackedDouble(a,u){u.length&&this.writeMessage(a,G4,u)}writePackedFixed32(a,u){u.length&&this.writeMessage(a,W4,u)}writePackedSFixed32(a,u){u.length&&this.writeMessage(a,H4,u)}writePackedFixed64(a,u){u.length&&this.writeMessage(a,Z4,u)}writePackedSFixed64(a,u){u.length&&this.writeMessage(a,X4,u)}writeBytesField(a,u){this.writeTag(a,2),this.writeBytes(u)}writeFixed32Field(a,u){this.writeTag(a,5),this.writeFixed32(u)}writeSFixed32Field(a,u){this.writeTag(a,5),this.writeSFixed32(u)}writeFixed64Field(a,u){this.writeTag(a,1),this.writeFixed64(u)}writeSFixed64Field(a,u){this.writeTag(a,1),this.writeSFixed64(u)}writeVarintField(a,u){this.writeTag(a,0),this.writeVarint(u)}writeSVarintField(a,u){this.writeTag(a,0),this.writeSVarint(u)}writeStringField(a,u){this.writeTag(a,2),this.writeString(u)}writeFloatField(a,u){this.writeTag(a,5),this.writeFloat(u)}writeDoubleField(a,u){this.writeTag(a,1),this.writeDouble(u)}writeBooleanField(a,u){this.writeVarintField(a,+u)}}function Mm(h,a,u){return u?4294967296*a+(h>>>0):4294967296*(a>>>0)+(h>>>0)}function iA(h,a,u){const m=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));u.realloc(m);for(let y=u.pos-1;y>=h;y--)u.buf[y+m]=u.buf[y]}function V4(h,a){for(let u=0;u<h.length;u++)a.writeVarint(h[u])}function U4(h,a){for(let u=0;u<h.length;u++)a.writeSVarint(h[u])}function j4(h,a){for(let u=0;u<h.length;u++)a.writeFloat(h[u])}function G4(h,a){for(let u=0;u<h.length;u++)a.writeDouble(h[u])}function q4(h,a){for(let u=0;u<h.length;u++)a.writeBoolean(h[u])}function W4(h,a){for(let u=0;u<h.length;u++)a.writeFixed32(h[u])}function H4(h,a){for(let u=0;u<h.length;u++)a.writeSFixed32(h[u])}function Z4(h,a){for(let u=0;u<h.length;u++)a.writeFixed64(h[u])}function X4(h,a){for(let u=0;u<h.length;u++)a.writeSFixed64(h[u])}function Y4(h,a,u){h===1&&u.readMessage(K4,a)}function K4(h,a,u){if(h===3){const{id:m,bitmap:y,width:T,height:M,left:R,top:F,advance:$}=u.readMessage(J4,{});a.push({id:m,bitmap:new J_({width:T+6,height:M+6},y),metrics:{width:T,height:M,left:R,top:F,advance:$}})}}function J4(h,a,u){h===1?a.id=u.readVarint():h===2?a.bitmap=u.readBytes():h===3?a.width=u.readVarint():h===4?a.height=u.readVarint():h===5?a.left=u.readSVarint():h===6?a.top=u.readSVarint():h===7&&(a.advance=u.readVarint())}function nA(h){let a=0,u=0;for(const M of h)a+=M.w*M.h,u=Math.max(u,M.w);h.sort(((M,R)=>R.h-M.h));const m=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),u),h:1/0}];let y=0,T=0;for(const M of h)for(let R=m.length-1;R>=0;R--){const F=m[R];if(!(M.w>F.w||M.h>F.h)){if(M.x=F.x,M.y=F.y,T=Math.max(T,M.y+M.h),y=Math.max(y,M.x+M.w),M.w===F.w&&M.h===F.h){const $=m.pop();$&&R<m.length&&(m[R]=$)}else M.h===F.h?(F.x+=M.w,F.w-=M.w):M.w===F.w?(F.y+=M.h,F.h-=M.h):(m.push({x:F.x+M.w,y:F.y,w:F.w-M.w,h:M.h}),F.y+=M.h,F.h-=M.h);break}}return{w:y,h:T,fill:a/(y*T)||0}}class Q1{constructor(a,{pixelRatio:u,version:m,stretchX:y,stretchY:T,content:M,textFitWidth:R,textFitHeight:F}){this.paddedRect=a,this.pixelRatio=u,this.stretchX=y,this.stretchY=T,this.content=M,this.version=m,this.textFitWidth=R,this.textFitHeight=F}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class rA{constructor(a,u){const m={},y={};this.haveRenderCallbacks=[];const T=[];this.addImages(a,m,T),this.addImages(u,y,T);const{w:M,h:R}=nA(T),F=new Wo({width:M||1,height:R||1});for(const $ in a){const H=a[$],K=m[$].paddedRect;Wo.copy(H.data,F,{x:0,y:0},{x:K.x+1,y:K.y+1},H.data)}for(const $ in u){const H=u[$],K=y[$].paddedRect,ne=K.x+1,oe=K.y+1,fe=H.data.width,ge=H.data.height;Wo.copy(H.data,F,{x:0,y:0},{x:ne,y:oe},H.data),Wo.copy(H.data,F,{x:0,y:ge-1},{x:ne,y:oe-1},{width:fe,height:1}),Wo.copy(H.data,F,{x:0,y:0},{x:ne,y:oe+ge},{width:fe,height:1}),Wo.copy(H.data,F,{x:fe-1,y:0},{x:ne-1,y:oe},{width:1,height:ge}),Wo.copy(H.data,F,{x:0,y:0},{x:ne+fe,y:oe},{width:1,height:ge})}this.image=F,this.iconPositions=m,this.patternPositions=y}addImages(a,u,m){for(const y in a){const T=a[y],M={x:0,y:0,w:T.data.width+2,h:T.data.height+2};m.push(M),u[y]=new Q1(M,T),T.hasRenderCallback&&this.haveRenderCallbacks.push(y)}}patchUpdatedImages(a,u){a.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const m in a.updatedImages)this.patchUpdatedImage(this.iconPositions[m],a.getImage(m),u),this.patchUpdatedImage(this.patternPositions[m],a.getImage(m),u)}patchUpdatedImage(a,u,m){if(!a||!u||a.version===u.version)return;a.version=u.version;const[y,T]=a.tl;m.update(u.data,void 0,{x:y,y:T})}}var id;function sb(h,a,u,m,y,T,M,R,F,$,H,K,ne,oe,fe){const ge=Tm.fromFeature(h,y);let ve;K===c.az.vertical&&ge.verticalizePunctuation();let Pe=ge.determineLineBreaks($,T,a,m,oe);const{processBidirectionalText:Ge,processStyledBidirectionalText:Ie}=qc;if(Ge&&ge.sections.length===1){ve=[],Pe=Pe.map((Mt=>ge.toCodeUnitIndex(Mt)));const et=Ge(ge.toString(),Pe);for(const Mt of et){const Ut=[...Mt].map((()=>0));ve.push(new Tm(Mt,ge.sections,Ut))}}else if(Ie){ve=[],Pe=Pe.map((Ot=>ge.toCodeUnitIndex(Ot)));let et=0;const Mt=[];for(const Ot of ge.text)Mt.push(...Array(Ot.length).fill(ge.sectionIndex[et])),et++;const Ut=Ie(ge.text,Mt,Pe);for(const Ot of Ut){const Zt=[];let ni="";for(const Yt of Ot[0])Zt.push(Ot[1][ni.length]),ni+=Yt;ve.push(new Tm(Ot[0],ge.sections,Zt))}}else ve=(function(et,Mt){const Ut=[];let Ot=0;for(const Zt of Mt)Ut.push(et.substring(Ot,Zt)),Ot=Zt;return Ot<et.length()&&Ut.push(et.substring(Ot,et.length())),Ut})(ge,Pe);const Re=[],Ye={positionedLines:Re,text:ge.toString(),top:H[1],bottom:H[1],left:H[0],right:H[0],writingMode:K,iconsInText:!1,verticalizable:!1};return(function(et,Mt,Ut,Ot,Zt,ni,Yt,$t,It,fi,hi,_i){let ui=0,Ci=0,wn=0,un=0;const wr=$t==="right"?1:$t==="left"?0:.5,eo=Is/_i;let ps=0;for(const In of Zt){In.trim();const Nr=In.getMaxScale(),Xr={positionedGlyphs:[],lineOffset:0};et.positionedLines[ps]=Xr;const or=Xr.positionedGlyphs;let Ho=0;if(!In.length()){Ci+=ni,++ps;continue}const to=Q4(Ot,In,eo);let Zo=0;for(const ks of In.text){const Rr=In.getSection(Zo),ms=ks.codePointAt(0),$r=e$(It,hi,ms),Ds={glyph:ms,imageName:null,x:ui,y:Ci+-17,vertical:$r,scale:1,fontStack:"",sectionIndex:In.getSectionIndex(Zo),metrics:null,rect:null};let Yu;if("fontStack"in Rr){if(Yu=t$(Rr,ms,$r,to,Mt,Ut),!Yu)continue;Ds.fontStack=Rr.fontStack}else{if(et.iconsInText=!0,Rr.scale*=eo,Yu=i$(Rr,$r,Nr,to,Ot),!Yu)continue;Ho=Math.max(Ho,Yu.imageOffset),Ds.imageName=Rr.imageName}const{rect:hc,metrics:mv,baselineOffset:ad}=Yu;Ds.y+=ad,Ds.scale=Rr.scale,Ds.metrics=mv,Ds.rect=hc,or.push(Ds),$r?(et.verticalizable=!0,ui+=("imageName"in Rr?mv.advance:Is)*Rr.scale+fi):ui+=mv.advance*Rr.scale+fi,Zo++}or.length!==0&&(wn=Math.max(ui-fi,wn),n$(or,0,or.length-1,wr)),ui=0,Xr.lineOffset=Math.max(Ho,(Nr-1)*Is);const Sl=ni*Nr+Ho;Ci+=Sl,un=Math.max(Sl,un),++ps}const{horizontalAlign:Sr,verticalAlign:mr}=eS(Yt);(function(In,Nr,Xr,or,Ho,to,Zo,Sl,ks){const Rr=(Nr-Xr)*Ho;let ms=0;ms=to!==Zo?-Sl*or- -17:-or*ks*Zo+.5*Zo;for(const $r of In)for(const Ds of $r.positionedGlyphs)Ds.x+=Rr,Ds.y+=ms})(et.positionedLines,wr,Sr,mr,wn,un,ni,Ci,Zt.length),et.top+=-mr*Ci,et.bottom=et.top+Ci,et.left+=-Sr*wn,et.right=et.left+wn})(Ye,a,u,m,ve,M,R,F,K,$,ne,fe),!(function(et){for(const Mt of et)if(Mt.positionedGlyphs.length!==0)return!1;return!0})(Re)&&Ye}function eS(h){let a=.5,u=.5;switch(h){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(h){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:a,verticalAlign:u}}function Q4(h,a,u){const m=a.getMaxScale()*Is,{maxImageWidth:y,maxImageHeight:T}=a.getMaxImageSize(h),M=Math.max(m,T*u);return{verticalLineContentWidth:Math.max(m,y*u),horizontalLineContentHeight:M}}function sA(h){switch(h){case"top":return 0;case"center":return .5;default:return 1}}function e$(h,a,u){return!(h===c.az.horizontal||!a&&!z_(u)||a&&(N0(u)||(m=u,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(m)))));var m}function t$(h,a,u,m,y,T){const M=T[h.fontStack],R=(function($,H,K,ne){if($&&$.rect)return $;const oe=H[K.fontStack],fe=oe&&oe[ne];return fe?{rect:null,metrics:fe.metrics}:null})(M&&M[a],y,h,a);if(R===null)return null;let F;if(u)F=m.verticalLineContentWidth-h.scale*Is;else{const $=sA(h.verticalAlign);F=(m.horizontalLineContentHeight-h.scale*Is)*$}return{rect:R.rect,metrics:R.metrics,baselineOffset:F}}function i$(h,a,u,m,y){const T=y[h.imageName];if(!T)return null;const M=T.paddedRect,R=T.displaySize,F={width:R[0],height:R[1],left:1,top:-3,advance:a?R[1]:R[0]};let $;if(a)$=m.verticalLineContentWidth-R[1]*h.scale;else{const H=sA(h.verticalAlign);$=(m.horizontalLineContentHeight-R[1]*h.scale)*H}return{rect:M,metrics:F,baselineOffset:$,imageOffset:(a?R[0]:R[1])*h.scale-Is*u}}function n$(h,a,u,m){if(m===0)return;const y=h[u],T=(h[u].x+y.metrics.advance*y.scale)*m;for(let M=a;M<=u;M++)h[M].x-=T}function r$(h,a,u){const{horizontalAlign:m,verticalAlign:y}=eS(u),T=a[0]-h.displaySize[0]*m,M=a[1]-h.displaySize[1]*y;return{image:h,top:M,bottom:M+h.displaySize[1],left:T,right:T+h.displaySize[0]}}function oA(h){var a,u;let m=h.left,y=h.top,T=h.right-m,M=h.bottom-y;const R=(a=h.image.textFitWidth)!==null&&a!==void 0?a:"stretchOrShrink",F=(u=h.image.textFitHeight)!==null&&u!==void 0?u:"stretchOrShrink",$=(h.image.content[2]-h.image.content[0])/(h.image.content[3]-h.image.content[1]);if(F==="proportional"){if(R==="stretchOnly"&&T/M<$||R==="proportional"){const H=Math.ceil(M*$);m*=H/T,T=H}}else if(R==="proportional"&&F==="stretchOnly"&&$!==0&&T/M>$){const H=Math.ceil(T/$);y*=H/M,M=H}return{x1:m,y1:y,x2:m+T,y2:y+M}}function aA(h,a,u,m,y,T){const M=h.image;let R;if(M.content){const ve=M.content,Pe=M.pixelRatio||1;R=[ve[0]/Pe,ve[1]/Pe,M.displaySize[0]-ve[2]/Pe,M.displaySize[1]-ve[3]/Pe]}const F=a.left*T,$=a.right*T;let H,K,ne,oe;u==="width"||u==="both"?(oe=y[0]+F-m[3],K=y[0]+$+m[1]):(oe=y[0]+(F+$-M.displaySize[0])/2,K=oe+M.displaySize[0]);const fe=a.top*T,ge=a.bottom*T;return u==="height"||u==="both"?(H=y[1]+fe-m[0],ne=y[1]+ge+m[2]):(H=y[1]+(fe+ge-M.displaySize[1])/2,ne=H+M.displaySize[1]),{image:M,top:H,right:K,bottom:ne,left:oe,collisionPadding:R}}mi("ImagePosition",Q1),mi("ImageAtlas",rA),c.az=void 0,(id=c.az||(c.az={}))[id.none=0]="none",id[id.horizontal=1]="horizontal",id[id.vertical=2]="vertical",id[id.horizontalOnly=3]="horizontalOnly";const Zu=128,nd=32640;function lA(h,a){const{expression:u}=a;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new qn(h+1))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:m,interpolationType:y}=u;let T=0;for(;T<m.length&&m[T]<=h;)T++;T=Math.max(0,T-1);let M=T;for(;M<m.length&&m[M]<h+1;)M++;M=Math.min(m.length-1,M);const R=m[T],F=m[M];return u.kind==="composite"?{kind:"composite",minZoom:R,maxZoom:F,interpolationType:y}:{kind:"camera",minZoom:R,maxZoom:F,minSize:u.evaluate(new qn(R)),maxSize:u.evaluate(new qn(F)),interpolationType:y}}}function tS(h,a,u){let m="never";const y=h.get(a);return y?m=y:h.get(u)&&(m="always"),m}const s$=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ob(h,a,u,m,y,T,M,R,F,$,H,K,ne){const oe=R?Math.min(nd,Math.round(R[0])):0,fe=R?Math.min(nd,Math.round(R[1])):0;h.emplaceBack(a,u,Math.round(32*m),Math.round(32*y),T,M,(oe<<1)+(F?1:0),fe,16*$,16*H,256*K,256*ne)}function iS(h,a,u){h.emplaceBack(a.x,a.y,u),h.emplaceBack(a.x,a.y,u),h.emplaceBack(a.x,a.y,u),h.emplaceBack(a.x,a.y,u)}function o$(h){for(const a of h.sections)if(U0(a.text))return!0;return!1}class nS{constructor(a){this.layoutVertexArray=new Ke,this.indexArray=new Pt,this.programConfigurations=a,this.segments=new si,this.dynamicLayoutVertexArray=new mt,this.opacityVertexArray=new Lt,this.hasVisibleVertices=!1,this.placedSymbolArray=new k}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(a,u,m,y){this.isEmpty()||(m&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,k4.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,D4.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,s$,!0),this.opacityVertexBuffer.itemSize=1),(m||y)&&this.programConfigurations.upload(a))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}mi("SymbolBuffers",nS);class rS{constructor(a,u,m){this.layoutVertexArray=new a,this.layoutAttributes=u,this.indexArray=new m,this.segments=new si,this.collisionVertexArray=new At}upload(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,F4.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}mi("CollisionBuffers",rS);class Cm{constructor(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((M=>M.id)),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=lA(this.zoom,u["text-size"]),this.iconSizeData=lA(this.zoom,u["icon-size"]);const m=this.layers[0].layout,y=m.get("symbol-sort-key"),T=m.get("symbol-z-order");this.canOverlap=tS(m,"text-overlap","text-allow-overlap")!=="never"||tS(m,"icon-overlap","icon-allow-overlap")!=="never"||m.get("text-ignore-placement")||m.get("icon-ignore-placement"),this.sortFeaturesByKey=T!=="viewport-y"&&!y.isConstant(),this.sortFeaturesByY=(T==="viewport-y"||T==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,m.get("symbol-placement")==="point"&&(this.writingModes=m.get("text-writing-mode").map((M=>c.az[M]))),this.stateDependentLayerIds=this.layers.filter((M=>M.isStateDependent())).map((M=>M.id)),this.sourceID=a.sourceID}createArrays(){this.text=new nS(new Hu(this.layers,this.zoom,(a=>/^text/.test(a)))),this.icon=new nS(new Hu(this.layers,this.zoom,(a=>/^icon/.test(a)))),this.glyphOffsetArray=new Z,this.lineVertexArray=new J,this.symbolInstances=new W,this.textAnchorOffsets=new ue}calculateGlyphDependencies(a,u,m,y,T){for(const M of a)if(u[M.codePointAt(0)]=!0,(m||y)&&T){const R=lv[M];R&&(u[R.codePointAt(0)]=!0)}}populate(a,u,m){const y=this.layers[0],T=y.layout,M=T.get("text-font"),R=T.get("text-field"),F=T.get("icon-image"),$=(R.value.kind!=="constant"||R.value.value instanceof Ns&&!R.value.value.isEmpty()||R.value.value.toString().length>0)&&(M.value.kind!=="constant"||M.value.value.length>0),H=F.value.kind!=="constant"||!!F.value.value||Object.keys(F.parameters).length>0,K=T.get("symbol-sort-key");if(this.features=[],!$&&!H)return;const ne=u.iconDependencies,oe=u.glyphDependencies,fe=u.availableImages,ge=new qn(this.zoom);for(const{feature:ve,id:Pe,index:Ge,sourceLayerIndex:Ie}of a){const Re=y._featureFilter.needGeometry,Ye=Xc(ve,Re);if(!y._featureFilter.filter(ge,Ye,m))continue;let et,Mt;if(Re||(Ye.geometry=Zc(ve)),$){const Ot=y.getValueAndResolveTokens("text-field",Ye,m,fe),Zt=Ns.factory(Ot),ni=this.hasRTLText=this.hasRTLText||o$(Zt);(!ni||qc.getRTLTextPluginStatus()==="unavailable"||ni&&qc.isParsed())&&(et=z4(Zt,y,Ye))}if(H){const Ot=y.getValueAndResolveTokens("icon-image",Ye,m,fe);Mt=Ot instanceof oo?Ot:oo.fromString(Ot)}if(!et&&!Mt)continue;const Ut=this.sortFeaturesByKey?K.evaluate(Ye,{},m):void 0;if(this.features.push({id:Pe,text:et,icon:Mt,index:Ge,sourceLayerIndex:Ie,geometry:Ye.geometry,properties:ve.properties,type:sv.types[ve.type],sortKey:Ut}),Mt&&(ne[Mt.name]=!0),et){const Ot=M.evaluate(Ye,{},m).join(","),Zt=T.get("text-rotation-alignment")!=="viewport"&&T.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(c.az.vertical)>=0;for(const ni of et.sections)if(ni.image)ne[ni.image.name]=!0;else{const Yt=ed(et.toString()),$t=ni.fontStack||Ot,It=oe[$t]=oe[$t]||{};this.calculateGlyphDependencies(ni.text,It,Zt,this.allowVerticalPlacement,Yt)}}}T.get("symbol-placement")==="line"&&(this.features=(function(ve){const Pe={},Ge={},Ie=[];let Re=0;function Ye(Ot){Ie.push(ve[Ot]),Re++}function et(Ot,Zt,ni){const Yt=Ge[Ot];return delete Ge[Ot],Ge[Zt]=Yt,Ie[Yt].geometry[0].pop(),Ie[Yt].geometry[0]=Ie[Yt].geometry[0].concat(ni[0]),Yt}function Mt(Ot,Zt,ni){const Yt=Pe[Zt];return delete Pe[Zt],Pe[Ot]=Yt,Ie[Yt].geometry[0].shift(),Ie[Yt].geometry[0]=ni[0].concat(Ie[Yt].geometry[0]),Yt}function Ut(Ot,Zt,ni){const Yt=ni?Zt[0][Zt[0].length-1]:Zt[0][0];return`${Ot}:${Yt.x}:${Yt.y}`}for(let Ot=0;Ot<ve.length;Ot++){const Zt=ve[Ot],ni=Zt.geometry,Yt=Zt.text?Zt.text.toString():null;if(!Yt){Ye(Ot);continue}const $t=Ut(Yt,ni),It=Ut(Yt,ni,!0);if($t in Ge&&It in Pe&&Ge[$t]!==Pe[It]){const fi=Mt($t,It,ni),hi=et($t,It,Ie[fi].geometry);delete Pe[$t],delete Ge[It],Ge[Ut(Yt,Ie[hi].geometry,!0)]=hi,Ie[fi].geometry=null}else $t in Ge?et($t,It,ni):It in Pe?Mt($t,It,ni):(Ye(Ot),Pe[$t]=Re-1,Ge[It]=Re-1)}return Ie.filter((Ot=>Ot.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((ve,Pe)=>ve.sortKey-Pe.sortKey))}update(a,u,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,u,this.layers,{imagePositions:m}),this.icon.programConfigurations.updatePaintArrays(a,u,this.layers,{imagePositions:m}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(a,u){const m=this.lineVertexArray.length;if(a.segment!==void 0){let y=a.dist(u[a.segment+1]),T=a.dist(u[a.segment]);const M={};for(let R=a.segment+1;R<u.length;R++)M[R]={x:u[R].x,y:u[R].y,tileUnitDistanceFromAnchor:y},R<u.length-1&&(y+=u[R+1].dist(u[R]));for(let R=a.segment||0;R>=0;R--)M[R]={x:u[R].x,y:u[R].y,tileUnitDistanceFromAnchor:T},R>0&&(T+=u[R-1].dist(u[R]));for(let R=0;R<u.length;R++){const F=M[R];this.lineVertexArray.emplaceBack(F.x,F.y,F.tileUnitDistanceFromAnchor)}}return{lineStartIndex:m,lineLength:this.lineVertexArray.length-m}}addSymbols(a,u,m,y,T,M,R,F,$,H,K,ne){const oe=a.indexArray,fe=a.layoutVertexArray,ge=a.segments.prepareSegment(4*u.length,fe,oe,this.canOverlap?M.sortKey:void 0),ve=this.glyphOffsetArray.length,Pe=ge.vertexLength,Ge=this.allowVerticalPlacement&&R===c.az.vertical?Math.PI/2:0,Ie=M.text&&M.text.sections;for(let Re=0;Re<u.length;Re++){const{tl:Ye,tr:et,bl:Mt,br:Ut,tex:Ot,pixelOffsetTL:Zt,pixelOffsetBR:ni,minFontScaleX:Yt,minFontScaleY:$t,glyphOffset:It,isSDF:fi,sectionIndex:hi}=u[Re],_i=ge.vertexLength,ui=It[1];ob(fe,F.x,F.y,Ye.x,ui+Ye.y,Ot.x,Ot.y,m,fi,Zt.x,Zt.y,Yt,$t),ob(fe,F.x,F.y,et.x,ui+et.y,Ot.x+Ot.w,Ot.y,m,fi,ni.x,Zt.y,Yt,$t),ob(fe,F.x,F.y,Mt.x,ui+Mt.y,Ot.x,Ot.y+Ot.h,m,fi,Zt.x,ni.y,Yt,$t),ob(fe,F.x,F.y,Ut.x,ui+Ut.y,Ot.x+Ot.w,Ot.y+Ot.h,m,fi,ni.x,ni.y,Yt,$t),iS(a.dynamicLayoutVertexArray,F,Ge),oe.emplaceBack(_i,_i+2,_i+1),oe.emplaceBack(_i+1,_i+2,_i+3),ge.vertexLength+=4,ge.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(It[0]),Re!==u.length-1&&hi===u[Re+1].sectionIndex||a.programConfigurations.populatePaintArrays(fe.length,M,M.index,{imagePositions:{},canonical:ne,formattedSection:Ie&&Ie[hi]})}a.placedSymbolArray.emplaceBack(F.x,F.y,ve,this.glyphOffsetArray.length-ve,Pe,$,H,F.segment,m?m[0]:0,m?m[1]:0,y[0],y[1],R,0,!1,0,K)}_addCollisionDebugVertex(a,u,m,y,T,M){return u.emplaceBack(0,0),a.emplaceBack(m.x,m.y,y,T,Math.round(M.x),Math.round(M.y))}addCollisionDebugVertices(a,u,m,y,T,M,R){const F=T.segments.prepareSegment(4,T.layoutVertexArray,T.indexArray),$=F.vertexLength,H=T.layoutVertexArray,K=T.collisionVertexArray,ne=R.anchorX,oe=R.anchorY;this._addCollisionDebugVertex(H,K,M,ne,oe,new d(a,u)),this._addCollisionDebugVertex(H,K,M,ne,oe,new d(m,u)),this._addCollisionDebugVertex(H,K,M,ne,oe,new d(m,y)),this._addCollisionDebugVertex(H,K,M,ne,oe,new d(a,y)),F.vertexLength+=4;const fe=T.indexArray;fe.emplaceBack($,$+1),fe.emplaceBack($+1,$+2),fe.emplaceBack($+2,$+3),fe.emplaceBack($+3,$),F.primitiveLength+=4}addDebugCollisionBoxes(a,u,m,y){for(let T=a;T<u;T++){const M=this.collisionBoxArray.get(T);this.addCollisionDebugVertices(M.x1,M.y1,M.x2,M.y2,y?this.textCollisionBox:this.iconCollisionBox,M.anchorPoint,m)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new rS(Et,XE.members,Qt),this.iconCollisionBox=new rS(Et,XE.members,Qt);for(let a=0;a<this.symbolInstances.length;a++){const u=this.symbolInstances.get(a);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}}_deserializeCollisionBoxesForSymbol(a,u,m,y,T,M,R,F,$){const H={};for(let K=u;K<m;K++){const ne=a.get(K);H.textBox={x1:ne.x1,y1:ne.y1,x2:ne.x2,y2:ne.y2,anchorPointX:ne.anchorPointX,anchorPointY:ne.anchorPointY},H.textFeatureIndex=ne.featureIndex;break}for(let K=y;K<T;K++){const ne=a.get(K);H.verticalTextBox={x1:ne.x1,y1:ne.y1,x2:ne.x2,y2:ne.y2,anchorPointX:ne.anchorPointX,anchorPointY:ne.anchorPointY},H.verticalTextFeatureIndex=ne.featureIndex;break}for(let K=M;K<R;K++){const ne=a.get(K);H.iconBox={x1:ne.x1,y1:ne.y1,x2:ne.x2,y2:ne.y2,anchorPointX:ne.anchorPointX,anchorPointY:ne.anchorPointY},H.iconFeatureIndex=ne.featureIndex;break}for(let K=F;K<$;K++){const ne=a.get(K);H.verticalIconBox={x1:ne.x1,y1:ne.y1,x2:ne.x2,y2:ne.y2,anchorPointX:ne.anchorPointX,anchorPointY:ne.anchorPointY},H.verticalIconFeatureIndex=ne.featureIndex;break}return H}deserializeCollisionBoxes(a){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const m=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,m.textBoxStartIndex,m.textBoxEndIndex,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m.iconBoxStartIndex,m.iconBoxEndIndex,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(a,u){const m=a.placedSymbolArray.get(u),y=m.vertexStartIndex+4*m.numGlyphs;for(let T=m.vertexStartIndex;T<y;T+=4)a.indexArray.emplaceBack(T,T+2,T+1),a.indexArray.emplaceBack(T+1,T+2,T+3)}getSortedSymbolIndexes(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const u=Math.sin(a),m=Math.cos(a),y=[],T=[],M=[];for(let R=0;R<this.symbolInstances.length;++R){M.push(R);const F=this.symbolInstances.get(R);y.push(0|Math.round(u*F.anchorX+m*F.anchorY)),T.push(F.featureIndex)}return M.sort(((R,F)=>y[R]-y[F]||T[F]-T[R])),M}addToSortKeyRanges(a,u){const m=this.sortKeyRanges[this.sortKeyRanges.length-1];m&&m.sortKey===u?m.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:a,symbolInstanceEnd:a+1})}sortFeatures(a){if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const m=this.symbolInstances.get(u);this.featureSortOrder.push(m.featureIndex),[m.rightJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.leftJustifiedTextSymbolIndex].forEach(((y,T,M)=>{y>=0&&M.indexOf(y)===T&&this.addIndicesForPlacedSymbol(this.text,y)})),m.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,m.verticalPlacedTextSymbolIndex),m.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.placedIconSymbolIndex),m.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let cA,uA;mi("SymbolBucket",Cm,{omit:["layers","collisionBoxArray","features","compareText"]}),Cm.MAX_GLYPHS=65535,Cm.addDynamicAttributes=iS;var sS={get paint(){return uA=uA||new lo({"icon-opacity":new Fi(Tt.paint_symbol["icon-opacity"]),"icon-color":new Fi(Tt.paint_symbol["icon-color"]),"icon-halo-color":new Fi(Tt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Fi(Tt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Fi(Tt.paint_symbol["icon-halo-blur"]),"icon-translate":new Mi(Tt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Mi(Tt.paint_symbol["icon-translate-anchor"]),"text-opacity":new Fi(Tt.paint_symbol["text-opacity"]),"text-color":new Fi(Tt.paint_symbol["text-color"],{runtimeType:Wi,getOverride:h=>h.textColor,hasOverride:h=>!!h.textColor}),"text-halo-color":new Fi(Tt.paint_symbol["text-halo-color"]),"text-halo-width":new Fi(Tt.paint_symbol["text-halo-width"]),"text-halo-blur":new Fi(Tt.paint_symbol["text-halo-blur"]),"text-translate":new Mi(Tt.paint_symbol["text-translate"]),"text-translate-anchor":new Mi(Tt.paint_symbol["text-translate-anchor"])})},get layout(){return cA=cA||new lo({"symbol-placement":new Mi(Tt.layout_symbol["symbol-placement"]),"symbol-spacing":new Mi(Tt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Mi(Tt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Fi(Tt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Mi(Tt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Mi(Tt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Mi(Tt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Mi(Tt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Mi(Tt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Mi(Tt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Fi(Tt.layout_symbol["icon-size"]),"icon-text-fit":new Mi(Tt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Mi(Tt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Fi(Tt.layout_symbol["icon-image"]),"icon-rotate":new Fi(Tt.layout_symbol["icon-rotate"]),"icon-padding":new Fi(Tt.layout_symbol["icon-padding"]),"icon-keep-upright":new Mi(Tt.layout_symbol["icon-keep-upright"]),"icon-offset":new Fi(Tt.layout_symbol["icon-offset"]),"icon-anchor":new Fi(Tt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Mi(Tt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Mi(Tt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Mi(Tt.layout_symbol["text-rotation-alignment"]),"text-field":new Fi(Tt.layout_symbol["text-field"]),"text-font":new Fi(Tt.layout_symbol["text-font"]),"text-size":new Fi(Tt.layout_symbol["text-size"]),"text-max-width":new Fi(Tt.layout_symbol["text-max-width"]),"text-line-height":new Mi(Tt.layout_symbol["text-line-height"]),"text-letter-spacing":new Fi(Tt.layout_symbol["text-letter-spacing"]),"text-justify":new Fi(Tt.layout_symbol["text-justify"]),"text-radial-offset":new Fi(Tt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Mi(Tt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Fi(Tt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Fi(Tt.layout_symbol["text-anchor"]),"text-max-angle":new Mi(Tt.layout_symbol["text-max-angle"]),"text-writing-mode":new Mi(Tt.layout_symbol["text-writing-mode"]),"text-rotate":new Fi(Tt.layout_symbol["text-rotate"]),"text-padding":new Mi(Tt.layout_symbol["text-padding"]),"text-keep-upright":new Mi(Tt.layout_symbol["text-keep-upright"]),"text-transform":new Fi(Tt.layout_symbol["text-transform"]),"text-offset":new Fi(Tt.layout_symbol["text-offset"]),"text-allow-overlap":new Mi(Tt.layout_symbol["text-allow-overlap"]),"text-overlap":new Mi(Tt.layout_symbol["text-overlap"]),"text-ignore-placement":new Mi(Tt.layout_symbol["text-ignore-placement"]),"text-optional":new Mi(Tt.layout_symbol["text-optional"])})}};class hA{constructor(a){if(a.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=a.property.overrides?a.property.overrides.runtimeType:Ii,this.defaultValue=a}evaluate(a){if(a.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(a.formattedSection))return u.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default}eachChild(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}mi("FormatSectionOverride",hA,{omit:["defaultValue"]});class ab extends ha{constructor(a,u){super(a,sS,u)}recalculate(a,u){if(super.recalculate(a,u),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const m=this.layout.get("text-writing-mode");if(m){const y=[];for(const T of m)y.indexOf(T)<0&&y.push(T);this.layout._values["text-writing-mode"]=y}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(a,u,m,y){const T=this.layout.get(a).evaluate(u,{},m,y),M=this._unevaluatedLayout._values[a];return M.isDataDriven()||$c(M.value)||!T?T:(function(R,F){return F.replace(/{([^{}]+)}/g,(($,H)=>R&&H in R?String(R[H]):""))})(u.properties,T)}createBucket(a){return new Cm(a)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const a of sS.paint.overridableProperties){if(!ab.hasPaintOverride(this.layout,a))continue;const u=this.paint.get(a),m=new hA(u),y=new Da(m,u.property.specification);let T=null;T=u.value.kind==="constant"||u.value.kind==="source"?new Kp("source",y):new C_("composite",y,u.value.zoomStops),this.paint._values[a]=new Ba(u.property,T,u.parameters)}}_handleOverridablePaintPropertyUpdate(a,u,m){return!(!this.layout||u.isDataDriven()||m.isDataDriven())&&ab.hasPaintOverride(this.layout,a)}static hasPaintOverride(a,u){const m=a.get("text-field"),y=sS.paint.properties[u];let T=!1;const M=R=>{for(const F of R)if(y.overrides&&y.overrides.hasOverride(F))return void(T=!0)};if(m.value.kind==="constant"&&m.value.value instanceof Ns)M(m.value.value.sections);else if(m.value.kind==="source"||m.value.kind==="composite"){const R=$=>{T||($ instanceof No&&Pr($.value)===Kn?M($.value.sections):$ instanceof Ea?M($.sections):$.eachChild(R))},F=m.value;F._styleExpression&&R(F._styleExpression.expression)}return T}}let dA;var a$={get paint(){return dA=dA||new lo({"background-color":new Mi(Tt.paint_background["background-color"]),"background-pattern":new cm(Tt.paint_background["background-pattern"]),"background-opacity":new Mi(Tt.paint_background["background-opacity"])})}};class l$ extends ha{constructor(a,u){super(a,a$,u)}}class c$ extends ha{constructor(a,u){super(a,{},u),this.onAdd=m=>{this.implementation.onAdd&&this.implementation.onAdd(m,m.painter.context.gl)},this.onRemove=m=>{this.implementation.onRemove&&this.implementation.onRemove(m,m.painter.context.gl)},this.implementation=a}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class u${constructor(a){this._methodToThrottle=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const h$={once:!0},oS=63710088e-1;class rd{constructor(a,u){if(isNaN(a)||isNaN(u))throw new Error(`Invalid LngLat object: (${a}, ${u})`);if(this.lng=+a,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new rd(Be(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(a){const u=Math.PI/180,m=this.lat*u,y=a.lat*u,T=Math.sin(m)*Math.sin(y)+Math.cos(m)*Math.cos(y)*Math.cos((a.lng-this.lng)*u);return oS*Math.acos(Math.min(T,1))}static convert(a){if(a instanceof rd)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new rd(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new rd(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const fA=2*Math.PI*oS;function pA(h){return fA*Math.cos(h*Math.PI/180)}function mA(h){return(180+h)/360}function gA(h){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h*Math.PI/360)))/360}function _A(h,a){return h/pA(a)}function vA(h){return 360*h-180}function lb(h){return 360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90}function yA(h,a){return h*pA(lb(a))}class cv{constructor(a,u,m=0){this.x=+a,this.y=+u,this.z=+m}static fromLngLat(a,u=0){const m=rd.convert(a);return new cv(mA(m.lng),gA(m.lat),_A(u,m.lat))}toLngLat(){return new rd(vA(this.x),lb(this.y))}toAltitude(){return yA(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/fA*(a=lb(this.y),1/Math.cos(a*Math.PI/180));var a}}function bA(h,a,u){var m=2*Math.PI*6378137/256/Math.pow(2,u);return[h*m-2*Math.PI*6378137/2,a*m-2*Math.PI*6378137/2]}class aS{constructor(a,u,m){if(!(function(y,T,M){return!(y<0||y>25||M<0||M>=Math.pow(2,y)||T<0||T>=Math.pow(2,y))})(a,u,m))throw new Error(`x=${u}, y=${m}, z=${a} outside of bounds. 0<=x<${Math.pow(2,a)}, 0<=y<${Math.pow(2,a)} 0<=z<=25 `);this.z=a,this.x=u,this.y=m,this.key=Em(0,a,a,u,m)}equals(a){return this.z===a.z&&this.x===a.x&&this.y===a.y}url(a,u,m){const y=(function(M,R,F){var $=bA(256*M,256*(R=Math.pow(2,F)-R-1),F),H=bA(256*(M+1),256*(R+1),F);return $[0]+","+$[1]+","+H[0]+","+H[1]})(this.x,this.y,this.z),T=(function(M,R,F){let $,H="";for(let K=M;K>0;K--)$=1<<K-1,H+=(R&$?1:0)+(F&$?2:0);return H})(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(m==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,u>1?"@2x":"").replace(/{quadkey}/g,T).replace(/{bbox-epsg-3857}/g,y)}isChildOf(a){const u=this.z-a.z;return u>0&&a.x===this.x>>u&&a.y===this.y>>u}getTilePoint(a){const u=Math.pow(2,this.z);return new d((a.x*u-this.x)*Ee,(a.y*u-this.y)*Ee)}toString(){return`${this.z}/${this.x}/${this.y}`}}class xA{constructor(a,u){this.wrap=a,this.canonical=u,this.key=Em(a,u.z,u.z,u.x,u.y)}}class Va{constructor(a,u,m,y,T){if(this.terrainRttPosMatrix32f=null,a<m)throw new Error(`overscaledZ should be >= z; overscaledZ = ${a}; z = ${m}`);this.overscaledZ=a,this.wrap=u,this.canonical=new aS(m,+y,+T),this.key=Em(u,a,m,y,T)}clone(){return new Va(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)}scaledTo(a){if(a>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${a}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-a;return a>this.canonical.z?new Va(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Va(a,this.wrap,a,this.canonical.x>>u,this.canonical.y>>u)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(a,u){if(a>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${a}; overscaledZ = ${this.overscaledZ}`);const m=this.canonical.z-a;return a>this.canonical.z?Em(this.wrap*+u,a,this.canonical.z,this.canonical.x,this.canonical.y):Em(this.wrap*+u,a,a,this.canonical.x>>m,this.canonical.y>>m)}isChildOf(a){if(a.wrap!==this.wrap||this.overscaledZ-a.overscaledZ<=0)return!1;if(a.overscaledZ===0)return this.overscaledZ>0;const u=this.canonical.z-a.canonical.z;return!(u<0)&&a.canonical.x===this.canonical.x>>u&&a.canonical.y===this.canonical.y>>u}children(a){if(this.overscaledZ>=a)return[new Va(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,m=2*this.canonical.x,y=2*this.canonical.y;return[new Va(u,this.wrap,u,m,y),new Va(u,this.wrap,u,m+1,y),new Va(u,this.wrap,u,m,y+1),new Va(u,this.wrap,u,m+1,y+1)]}isLessThan(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))}wrapped(){return new Va(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(a){return new Va(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new xA(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(a){return this.canonical.getTilePoint(new cv(a.x-this.wrap,a.y))}}function Em(h,a,u,m,y){(h*=2)<0&&(h=-1*h-1);const T=1<<u;return(T*T*h+T*y+m).toString(36)+u.toString(36)+a.toString(36)}function lS(h,a){return a?h.properties[a]:h.id}function d$(h,a){const u={id:h.id};if(a.removeAllProperties&&(delete h.removeProperties,delete h.addOrUpdateProperties,delete a.removeProperties),a.removeProperties)for(const m of a.removeProperties){const y=h.addOrUpdateProperties.findIndex((T=>T.key===m));y>-1&&h.addOrUpdateProperties.splice(y,1)}return(h.removeAllProperties||a.removeAllProperties)&&(u.removeAllProperties=!0),(h.removeProperties||a.removeProperties)&&(u.removeProperties=[...h.removeProperties||[],...a.removeProperties||[]]),(h.addOrUpdateProperties||a.addOrUpdateProperties)&&(u.addOrUpdateProperties=[...h.addOrUpdateProperties||[],...a.addOrUpdateProperties||[]]),(h.newGeometry||a.newGeometry)&&(u.newGeometry=a.newGeometry||h.newGeometry),u}function wA(h){var a,u;if(!h)return{};const m={};return m.removeAll=h.removeAll,m.remove=new Set(h.remove||[]),m.add=new Map((a=h.add)===null||a===void 0?void 0:a.map((y=>[y.id,y]))),m.update=new Map((u=h.update)===null||u===void 0?void 0:u.map((y=>[y.id,y]))),m}mi("CanonicalTileID",aS),mi("OverscaledTileID",Va,{omit:["terrainRttPosMatrix32f"]});class Df{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(a){return this.minX=Math.min(this.minX,a.x),this.minY=Math.min(this.minY,a.y),this.maxX=Math.max(this.maxX,a.x),this.maxY=Math.max(this.maxY,a.y),this}expandBy(a){return this.minX-=a,this.minY-=a,this.maxX+=a,this.maxY+=a,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(a){return this.expandBy(-a)}map(a){const u=new Df;return u.extend(a(new d(this.minX,this.minY))),u.extend(a(new d(this.maxX,this.minY))),u.extend(a(new d(this.minX,this.maxY))),u.extend(a(new d(this.maxX,this.maxY))),u}static fromPoints(a){const u=new Df;for(const m of a)u.extend(m);return u}contains(a){return a.x>=this.minX&&a.x<=this.maxX&&a.y>=this.minY&&a.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(a){return!this.empty()&&!a.empty()&&a.minX>=this.minX&&a.maxX<=this.maxX&&a.minY>=this.minY&&a.maxY<=this.maxY}intersects(a){return!this.empty()&&!a.empty()&&a.minX<=this.maxX&&a.maxX>=this.minX&&a.minY<=this.maxY&&a.maxY>=this.minY}}class SA{constructor(a){this._stringToNumber={},this._numberToString=[];for(let u=0;u<a.length;u++){const m=a[u];this._stringToNumber[m]=u,this._numberToString[u]=m}}encode(a){return this._stringToNumber[a]}decode(a){if(a>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${a} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[a]}}class TA{constructor(a,u,m,y,T){this.type="Feature",this._vectorTileFeature=a,this._x=m,this._y=y,this._z=u,this.properties=a.properties,this.id=T}projectPoint(a,u,m,y){return[360*(a.x+u)/y-180,360/Math.PI*Math.atan(Math.exp((1-2*(a.y+m)/y)*Math.PI))-90]}projectLine(a,u,m,y){return a.map((T=>this.projectPoint(T,u,m,y)))}get geometry(){if(this._geometry)return this._geometry;const a=this._vectorTileFeature,u=a.extent*Math.pow(2,this._z),m=a.extent*this._x,y=a.extent*this._y,T=a.loadGeometry();switch(a.type){case 1:{const M=[];for(const F of T)M.push(F[0]);const R=this.projectLine(M,m,y,u);this._geometry=M.length===1?{type:"Point",coordinates:R[0]}:{type:"MultiPoint",coordinates:R};break}case 2:{const M=T.map((R=>this.projectLine(R,m,y,u)));this._geometry=M.length===1?{type:"LineString",coordinates:M[0]}:{type:"MultiLineString",coordinates:M};break}case 3:{const M=NE(T),R=[];for(const F of M)R.push(F.map(($=>this.projectLine($,m,y,u))));this._geometry=R.length===1?{type:"Polygon",coordinates:R[0]}:{type:"MultiPolygon",coordinates:R};break}default:throw new Error(`unknown feature type: ${a.type}`)}return this._geometry}set geometry(a){this._geometry=a}toJSON(){const a={geometry:this.geometry};for(const u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&u!=="_x"&&u!=="_y"&&u!=="_z"&&(a[u]=this[u]);return a}}class Am{_name;dataBuffer;nullabilityBuffer;_size;constructor(a,u,m){this._name=a,this.dataBuffer=u,typeof m=="number"?this._size=m:(this.nullabilityBuffer=m,this._size=m.size())}getValue(a){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(a)?null:this.getValueFromBuffer(a)}has(a){return this.nullabilityBuffer&&this.nullabilityBuffer.get(a)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class cb extends Am{}class cS extends cb{getValueFromBuffer(a){return this.dataBuffer[a]}}class uS extends cb{getValueFromBuffer(a){return this.dataBuffer[a]}}class MA extends Am{delta;constructor(a,u,m,y){super(a,u,y),this.delta=m}}class hS extends MA{constructor(a,u,m,y){super(a,Int32Array.of(u),m,y)}getValueFromBuffer(a){return this.dataBuffer[0]+a*this.delta}}class dS extends Am{constructor(a,u,m){super(a,Int32Array.of(u),m)}getValueFromBuffer(a){return this.dataBuffer[0]}}class f${_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(a,u,m,y,T=4096){this._name=a,this._geometryVector=u,this._idVector=m,this._propertyVectors=y,this._extent=T}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(a){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((u=>[u.name,u])))),this.propertyVectorsMap.get(a)}*[Symbol.iterator](){const a=this.geometryVector[Symbol.iterator]();let u=0;for(;u<this.numFeatures;){let m;this.idVector&&(m=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(u)):this.idVector.getValue(u));const y=a?.next().value,T={};for(const M of this.propertyVectors){if(!M)continue;const R=M.name,F=M.getValue(u);F!==null&&(T[R]=F)}u++,yield{id:m,geometry:y,properties:T}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const a=[],u=this.geometryVector.getGeometries();for(let m=0;m<this.numFeatures;m++){let y;this.idVector&&(y=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(m)):this.idVector.getValue(m));const T={coordinates:u[m],type:this.geometryVector.geometryType(m)},M={};for(const R of this.propertyVectors){if(!R)continue;const F=R.name,$=R.getValue(m);$!==null&&(M[F]=$)}a.push({id:y,geometry:T,properties:M})}return a}containsMaxSaveIntegerValues(a){return a instanceof cS||a instanceof dS&&a instanceof hS||a instanceof uS}}class p${value;constructor(a){this.value=a}get(){return this.value}set(a){this.value=a}increment(){return this.value++}add(a){this.value+=a}}var mn,Xu,Js,cc,Ff,fa,Rs,Ls,CA,Ua;function js(h,a,u){const m=new Int32Array(u);let y=0,T=a.get();for(let M=0;M<m.length;M++){let R=h[T++],F=127&R;R<128||(R=h[T++],F|=(127&R)<<7,R<128||(R=h[T++],F|=(127&R)<<14,R<128||(R=h[T++],F|=(127&R)<<21,R<128||(R=h[T++],F|=(15&R)<<28)))),m[y++]=F}return a.set(T),m}function ub(h,a,u){const m=new BigInt64Array(u);for(let y=0;y<m.length;y++)m[y]=g$(h,a);return m}function m$(h,a){let u,m;return m=h[a.get()],a.increment(),u=127&m,m<128?u:(m=h[a.get()],a.increment(),u|=(127&m)<<7,m<128?u:(m=h[a.get()],a.increment(),u|=(127&m)<<14,m<128?u:(m=h[a.get()],a.increment(),u|=(127&m)<<21,m<128?u:(m=h[a.get()],u|=(15&m)<<28,(function(y,T,M){let R,F;if(F=T[M.get()],M.increment(),R=(112&F)>>4,F<128||(F=T[M.get()],M.increment(),R|=(127&F)<<3,F<128)||(F=T[M.get()],M.increment(),R|=(127&F)<<10,F<128)||(F=T[M.get()],M.increment(),R|=(127&F)<<17,F<128)||(F=T[M.get()],M.increment(),R|=(127&F)<<24,F<128)||(F=T[M.get()],M.increment(),R|=(1&F)<<31,F<128))return 4294967296*R+(y>>>0);throw new Error("Expected varint not more than 10 bytes")})(u,h,a)))))}function EA(h,a,u,m){throw new Error("FastPFor is not implemented yet.")}function Of(h){return h>>>1^-(1&h)}function Pm(h){return h>>1n^-(1n&h)}function g$(h,a){let u=0n,m=0,y=a.get();for(;y<h.length;){const T=h[y++];if(u|=BigInt(127&T)<<BigInt(m),!(128&T))break;if(m+=7,m>=64)throw new Error("Varint too long")}return a.set(y),u}function AA(h,a,u){const m=new Int32Array(u);let y=0;for(let T=0;T<a;T++){const M=h[T];m.fill(h[T+a],y,y+M),y+=M}return m}function PA(h,a,u){const m=new BigInt64Array(u);let y=0;for(let T=0;T<a;T++){const M=Number(h[T]);m.fill(h[T+a],y,y+M),y+=M}return m}function IA(h,a,u){const m=new Float64Array(u);let y=0;for(let T=0;T<a;T++){const M=h[T];m.fill(h[T+a],y,y+M),y+=M}return m}function fS(h){const a=h.length/4*4;let u=1;if(a>=4)for(let m=h[0];u<a-4;u+=4)m=h[u]+=m,m=h[u+1]+=m,m=h[u+2]+=m,m=h[u+3]+=m;for(;u!=h.length;)h[u]+=h[u-1],++u}function RA(h){h[0]=h[0]>>>1^-(1&h[0]),h[1]=h[1]>>>1^-(1&h[1]);const a=h.length/4*4;let u=2;if(a>=4)for(;u<a-4;u+=4){const m=h[u],y=h[u+1],T=h[u+2],M=h[u+3];h[u]=(m>>>1^-(1&m))+h[u-2],h[u+1]=(y>>>1^-(1&y))+h[u-1],h[u+2]=(T>>>1^-(1&T))+h[u],h[u+3]=(M>>>1^-(1&M))+h[u+1]}for(;u!=h.length;u+=2)h[u]=(h[u]>>>1^-(1&h[u]))+h[u-2],h[u+1]=(h[u+1]>>>1^-(1&h[u+1]))+h[u-1]}(function(h){h.NONE="NONE",h.DELTA="DELTA",h.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",h.RLE="RLE",h.MORTON="MORTON",h.PDE="PDE"})(mn||(mn={})),(function(h){h.NONE="NONE",h.FAST_PFOR="FAST_PFOR",h.VARINT="VARINT",h.ALP="ALP"})(Xu||(Xu={})),(function(h){h.PRESENT="PRESENT",h.DATA="DATA",h.OFFSET="OFFSET",h.LENGTH="LENGTH"})(Js||(Js={}));class pS{_dictionaryType;_offsetType;_lengthType;constructor(a,u,m){this._dictionaryType=a,this._offsetType=u,this._lengthType=m}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function To(h,a){const u=(function(m,y){const T=m[y.get()],M=Object.values(Js)[T>>4];let R=null;switch(M){case Js.DATA:R=new pS(Object.values(cc)[15&T]);break;case Js.OFFSET:R=new pS(null,Object.values(Ff)[15&T]);break;case Js.LENGTH:R=new pS(null,null,Object.values(fa)[15&T])}y.increment();const F=m[y.get()],$=Object.values(mn)[F>>5],H=Object.values(mn)[F>>2&7],K=Object.values(Xu)[3&F];y.increment();const ne=js(m,y,2),oe=ne[0];return{physicalStreamType:M,logicalStreamType:R,logicalLevelTechnique1:$,logicalLevelTechnique2:H,physicalLevelTechnique:K,numValues:oe,byteLength:ne[1],decompressedCount:oe}})(h,a);return u.logicalLevelTechnique1===mn.MORTON?(function(m,y,T){const M=js(y,T,2);return{physicalStreamType:m.physicalStreamType,logicalStreamType:m.logicalStreamType,logicalLevelTechnique1:m.logicalLevelTechnique1,logicalLevelTechnique2:m.logicalLevelTechnique2,physicalLevelTechnique:m.physicalLevelTechnique,numValues:m.numValues,byteLength:m.byteLength,decompressedCount:m.decompressedCount,numBits:M[0],coordinateShift:M[1]}})(u,h,a):mn.RLE!==u.logicalLevelTechnique1&&mn.RLE!==u.logicalLevelTechnique2||Xu.NONE===u.physicalLevelTechnique?u:(function(m,y,T){const M=js(y,T,2);return{physicalStreamType:m.physicalStreamType,logicalStreamType:m.logicalStreamType,logicalLevelTechnique1:m.logicalLevelTechnique1,logicalLevelTechnique2:m.logicalLevelTechnique2,physicalLevelTechnique:m.physicalLevelTechnique,numValues:m.numValues,byteLength:m.byteLength,decompressedCount:M[1],runs:M[0],numRleValues:M[1]}})(u,h,a)}(function(h){h.NONE="NONE",h.SINGLE="SINGLE",h.SHARED="SHARED",h.VERTEX="VERTEX",h.MORTON="MORTON",h.FSST="FSST"})(cc||(cc={})),(function(h){h.VERTEX="VERTEX",h.INDEX="INDEX",h.STRING="STRING",h.KEY="KEY"})(Ff||(Ff={})),(function(h){h.VAR_BINARY="VAR_BINARY",h.GEOMETRIES="GEOMETRIES",h.PARTS="PARTS",h.RINGS="RINGS",h.TRIANGLES="TRIANGLES",h.SYMBOL="SYMBOL",h.DICTIONARY="DICTIONARY"})(fa||(fa={})),(function(h){h[h.FLAT=0]="FLAT",h[h.CONST=1]="CONST",h[h.SEQUENCE=2]="SEQUENCE",h[h.DICTIONARY=3]="DICTIONARY",h[h.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(Rs||(Rs={}));class uc{values;_size;constructor(a,u){this.values=a,this._size=u}get(a){const u=Math.floor(a/8);return(this.values[u]>>a%8&1)==1}set(a,u){const m=Math.floor(a/8);this.values[m]=this.values[m]|(u?1:0)<<a%8}getInt(a){const u=Math.floor(a/8);return this.values[u]>>a%8&1}size(){return this._size}getBuffer(){return this.values}}function Mo(h,a,u,m,y){return(function(T,M,R){switch(M.logicalLevelTechnique1){case mn.DELTA:return M.logicalLevelTechnique2===mn.RLE?(function(F,$,H){const K=new Int32Array(H);let ne=0,oe=0;for(let fe=0;fe<$;fe++){const ge=F[fe],ve=Of(F[fe+$]);for(let Pe=0;Pe<ge;Pe++)oe+=ve,K[ne++]=oe}return K})(T,M.runs,M.numRleValues):((function(F){F[0]=F[0]>>>1^-(1&F[0]);const $=F.length/4*4;let H=1;if($>=4)for(;H<$-4;H+=4){const K=F[H],ne=F[H+1],oe=F[H+2],fe=F[H+3];F[H]=(K>>>1^-(1&K))+F[H-1],F[H+1]=(ne>>>1^-(1&ne))+F[H],F[H+2]=(oe>>>1^-(1&oe))+F[H+1],F[H+3]=(fe>>>1^-(1&fe))+F[H+2]}for(;H!=F.length;++H)F[H]=(F[H]>>>1^-(1&F[H]))+F[H-1]})(T),T);case mn.RLE:return(function(F,$,H){return H?(function(K,ne,oe){const fe=new Int32Array(oe);let ge=0;for(let ve=0;ve<ne;ve++){const Pe=K[ve];let Ge=K[ve+ne];Ge=Ge>>>1^-(1&Ge),fe.fill(Ge,ge,ge+Pe),ge+=Pe}return fe})(F,$.runs,$.numRleValues):AA(F,$.runs,$.numRleValues)})(T,M,R);case mn.MORTON:return fS(T),T;case mn.COMPONENTWISE_DELTA:return RA(T),T;case mn.NONE:return R&&(function(F){for(let $=0;$<F.length;$++){const H=F[$];F[$]=H>>>1^-(1&H)}})(T),T;default:throw new Error(`The specified Logical level technique is not supported: ${M.logicalLevelTechnique1}`)}})(hb(h,a,u),u,m)}function sd(h,a,u){return(function(m,y){if(y.logicalLevelTechnique1===mn.DELTA&&y.logicalLevelTechnique2===mn.NONE)return(function(M){const R=new Int32Array(M.length+1);R[0]=0,R[1]=Of(M[0]);let F=R[1],$=2;for(;$!=R.length;++$){const H=M[$-1];F+=H>>>1^-(1&H),R[$]=R[$-1]+F}return R})(m);if(y.logicalLevelTechnique1===mn.RLE&&y.logicalLevelTechnique2===mn.NONE)return(function(M,R,F){const $=new Int32Array(F+1);$[0]=0;let H=1,K=$[0];for(let ne=0;ne<R;ne++){const oe=M[ne],fe=M[ne+R];for(let ge=H;ge<H+oe;ge++)$[ge]=fe+K,K=$[ge];H+=oe}return $})(m,y.runs,y.numRleValues);if(y.logicalLevelTechnique1===mn.NONE&&y.logicalLevelTechnique2===mn.NONE){(function(M){let R=0;for(let F=0;F<M.length;F++)M[F]+=R,R=M[F]})(m);const T=new Int32Array(y.numValues+1);return T[0]=0,T.set(m,1),T}if(y.logicalLevelTechnique1===mn.DELTA&&y.logicalLevelTechnique2===mn.RLE){const T=(function(M,R,F){const $=new Int32Array(F+1);$[0]=0;let H=1,K=$[0];for(let ne=0;ne<R;ne++){const oe=M[ne];let fe=M[ne+R];fe=fe>>>1^-(1&fe);for(let ge=H;ge<H+oe;ge++)$[ge]=fe+K,K=$[ge];H+=oe}return $})(m,y.runs,y.numRleValues);return fS(T),T}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(hb(h,a,u),u)}function hb(h,a,u){const m=u.physicalLevelTechnique;if(m===Xu.FAST_PFOR)return EA();if(m===Xu.VARINT)return js(h,a,u.numValues);if(m===Xu.NONE){const y=a.get();a.add(u.byteLength);const T=h.subarray(y,a.get());return new Int32Array(T)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function mS(h,a,u,m){const y=hb(h,a,u);if(y.length===1){const T=y[0];return m?Of(T):T}return m?(function(T){return Of(T[1])})(y):(function(T){return T[1]})(y)}function LA(h,a,u){return(function(m){if(m.length==2){const y=Of(m[1]);return[y,y]}return[Of(m[2]),Of(m[3])]})(hb(h,a,u))}function kA(h,a,u){return(function(m){if(m.length==2){const y=Pm(m[1]);return[y,y]}return[Pm(m[2]),Pm(m[3])]})(ub(h,a,u.numValues))}function DA(h,a,u,m){return(function(y,T,M){switch(T.logicalLevelTechnique1){case mn.DELTA:return T.logicalLevelTechnique2===mn.RLE?(function(R,F,$){const H=new BigInt64Array($);let K=0,ne=0n;for(let oe=0;oe<F;oe++){const fe=Number(R[oe]),ge=Pm(R[oe+F]);for(let ve=0;ve<fe;ve++)ne+=ge,H[K++]=ne}return H})(y,T.runs,T.numRleValues):((function(R){R[0]=R[0]>>1n^-(1n&R[0]);const F=R.length/4*4;let $=1;if(F>=4)for(;$<F-4;$+=4){const H=R[$],K=R[$+1],ne=R[$+2],oe=R[$+3];R[$]=(H>>1n^-(1n&H))+R[$-1],R[$+1]=(K>>1n^-(1n&K))+R[$],R[$+2]=(ne>>1n^-(1n&ne))+R[$+1],R[$+3]=(oe>>1n^-(1n&oe))+R[$+2]}for(;$!=R.length;++$)R[$]=(R[$]>>1n^-(1n&R[$]))+R[$-1]})(y),y);case mn.RLE:return(function(R,F,$){return $?(function(H,K,ne){const oe=new BigInt64Array(ne);let fe=0;for(let ge=0;ge<K;ge++){const ve=Number(H[ge]);let Pe=H[ge+K];Pe=Pe>>1n^-(1n&Pe),oe.fill(Pe,fe,fe+ve),fe+=ve}return oe})(R,F.runs,F.numRleValues):PA(R,F.runs,F.numRleValues)})(y,T,M);case mn.NONE:return M&&(function(R){for(let F=0;F<R.length;F++){const $=R[F];R[F]=$>>1n^-(1n&$)}})(y),y;default:throw new Error(`The specified Logical level technique is not supported: ${T.logicalLevelTechnique1}`)}})(ub(h,a,u.numValues),u,m)}function FA(h,a,u,m){const y=ub(h,a,u.numValues);if(y.length===1){const T=y[0];return m?Pm(T):T}return m?(function(T){return Pm(T[1])})(y):(function(T){return T[1]})(y)}function gS(h,a,u,m,y){return(function(T,M,R,F){switch(M.logicalLevelTechnique1){case mn.DELTA:return M.logicalLevelTechnique2===mn.RLE&&(T=AA(T,M.runs,M.numRleValues)),(function($,H){const K=new Int32Array($.size());let ne=0;$.get(0)?(K[0]=$.get(0)?H[0]>>>1^-(1&H[0]):0,ne=1):K[0]=0;let oe=1;for(;oe!=K.length;++oe)K[oe]=$.get(oe)?K[oe-1]+(H[ne]>>>1^-(1&H[ne++])):K[oe-1];return K})(F,T);case mn.RLE:return(function($,H,K,ne){const oe=H;return K?(function(fe,ge,ve){const Pe=new Int32Array(fe.size());let Ge=0;for(let Ie=0;Ie<ve;Ie++){const Re=ge[Ie];let Ye=ge[Ie+ve];Ye=Ye>>>1^-(1&Ye);for(let et=Ge;et<Ge+Re;et++)fe.get(et)?Pe[et]=Ye:(Pe[et]=0,Ge++);Ge+=Re}return Pe})(ne,$,oe.runs):(function(fe,ge,ve){const Pe=new Int32Array(fe.size());let Ge=0;for(let Ie=0;Ie<ve;Ie++){const Re=ge[Ie],Ye=ge[Ie+ve];for(let et=Ge;et<Ge+Re;et++)fe.get(et)?Pe[et]=Ye:(Pe[et]=0,Ge++);Ge+=Re}return Pe})(ne,$,oe.runs)})(T,M,R,F);case mn.MORTON:return fS(T),T;case mn.COMPONENTWISE_DELTA:return RA(T),T;case mn.NONE:return T=R?(function($,H){const K=new Int32Array($.size());let ne=0,oe=0;for(;oe!=K.length;++oe)if($.get(oe)){const fe=H[ne++];K[oe]=fe>>>1^-(1&fe)}else K[oe]=0;return K})(F,T):(function($,H){const K=new Int32Array($.size());let ne=0,oe=0;for(;oe!=K.length;++oe)K[oe]=$.get(oe)?H[ne++]:0;return K})(F,T),T;default:throw new Error("The specified Logical level technique is not supported")}})(u.physicalLevelTechnique===Xu.FAST_PFOR?EA():js(h,a,u.numValues),u,m,y)}function db(h,a,u,m){const y=h.logicalLevelTechnique1;if(y===mn.RLE)return h.runs===1?Rs.CONST:Rs.FLAT;const T=a instanceof uc?a.size():a;if(y===mn.DELTA&&h.logicalLevelTechnique2===mn.RLE){const M=h.runs,R=2;if(h.numRleValues!==T)return Rs.FLAT;if(M===1)return Rs.SEQUENCE;if(M===2){const F=m.get();let $;if(h.physicalLevelTechnique===Xu.VARINT)$=js(u,m,4);else{const H=m.get();$=new Int32Array(u.buffer,u.byteOffset+H,4)}if(m.set(F),$[2]===R&&$[3]===R)return Rs.SEQUENCE}}return h.numValues===1?Rs.CONST:Rs.FLAT}class OA extends cb{getValueFromBuffer(a){return this.dataBuffer[a]}}class zA extends MA{constructor(a,u,m,y){super(a,BigInt64Array.of(u),m,y)}getValueFromBuffer(a){return this.dataBuffer[0]+BigInt(a)*this.delta}}class Im{_geometryOffsets;_partOffsets;_ringOffsets;constructor(a,u,m){this._geometryOffsets=a,this._partOffsets=u,this._ringOffsets=m}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function _S(h,a,u){return{x:BA(h,a)-u,y:BA(h>>1,a)-u}}function BA(h,a){let u=0;for(let m=0;m<a;m++)u|=(h&1<<2*m)>>m;return u}(function(h){h[h.POINT=0]="POINT",h[h.LINESTRING=1]="LINESTRING",h[h.POLYGON=2]="POLYGON",h[h.MULTIPOINT=3]="MULTIPOINT",h[h.MULTILINESTRING=4]="MULTILINESTRING",h[h.MULTIPOLYGON=5]="MULTIPOLYGON"})(Ls||(Ls={})),(function(h){h[h.POINT=0]="POINT",h[h.LINESTRING=1]="LINESTRING",h[h.POLYGON=2]="POLYGON"})(CA||(CA={})),(function(h){h[h.MORTON=0]="MORTON",h[h.VEC_2=1]="VEC_2",h[h.VEC_3=2]="VEC_3"})(Ua||(Ua={}));class _${createPoint(a){return[[a]]}createMultiPoint(a){return a.map((u=>[u]))}createLineString(a){return[a]}createMultiLineString(a){return a}createPolygon(a,u){return[a].concat(u)}createMultiPolygon(a){return a.flat()}}function NA(h){const a=new Array(h.numGeometries);let u=1,m=1,y=1,T=0;const M=new _$;let R=0,F=0;const $=h.mortonSettings,H=h.topologyVector,K=H.geometryOffsets,ne=H.partOffsets,oe=H.ringOffsets,fe=h.vertexOffsets,ge=h.containsPolygonGeometry(),ve=h.vertexBuffer;for(let Pe=0;Pe<h.numGeometries;Pe++){const Ge=h.geometryType(Pe);if(Ge===Ls.POINT){if(fe&&fe.length!==0)if(h.vertexBufferType===Ua.VEC_2){const Ie=2*fe[F++],Re=new d(ve[Ie],ve[Ie+1]);a[T++]=M.createPoint(Re)}else{const Ie=_S(ve[fe[F++]],$.numBits,$.coordinateShift),Re=new d(Ie.x,Ie.y);a[T++]=M.createPoint(Re)}else{const Ie=new d(ve[R++],ve[R++]);a[T++]=M.createPoint(Ie)}K&&y++,ne&&u++,oe&&m++}else if(Ge===Ls.MULTIPOINT){const Ie=K[y]-K[y-1];y++;const Re=new Array(Ie);if(fe&&fe.length!==0){for(let Ye=0;Ye<Ie;Ye++){const et=2*fe[F++];Re[Ye]=new d(ve[et],ve[et+1])}a[T++]=M.createMultiPoint(Re)}else{for(let Ye=0;Ye<Ie;Ye++){const et=ve[R++],Mt=ve[R++];Re[Ye]=new d(et,Mt)}a[T++]=M.createMultiPoint(Re)}}else if(Ge===Ls.LINESTRING){let Ie,Re=0;ge?(Re=oe[m]-oe[m-1],m++):Re=ne[u]-ne[u-1],u++,fe&&fe.length!==0?(Ie=h.vertexBufferType===Ua.VEC_2?yS(ve,fe,F,Re,!1):bS(ve,fe,F,Re,!1,$),F+=Re):(Ie=vS(ve,R,Re,!1),R+=2*Re),a[T++]=M.createLineString(Ie),K&&y++}else if(Ge===Ls.POLYGON){const Ie=ne[u]-ne[u-1];u++;const Re=new Array(Ie-1);let Ye=oe[m]-oe[m-1];if(m++,fe&&fe.length!==0){const et=h.vertexBufferType===Ua.VEC_2?pb(ve,fe,F,Ye):mb(ve,fe,F,Ye,0,$);F+=Ye;for(let Mt=0;Mt<Re.length;Mt++)Ye=oe[m]-oe[m-1],m++,Re[Mt]=h.vertexBufferType===Ua.VEC_2?pb(ve,fe,F,Ye):mb(ve,fe,F,Ye,0,$),F+=Ye;a[T++]=M.createPolygon(et,Re)}else{const et=fb(ve,R,Ye);R+=2*Ye;for(let Mt=0;Mt<Re.length;Mt++)Ye=oe[m]-oe[m-1],m++,Re[Mt]=fb(ve,R,Ye),R+=2*Ye;a[T++]=M.createPolygon(et,Re)}K&&y++}else if(Ge===Ls.MULTILINESTRING){const Ie=K[y]-K[y-1];y++;const Re=new Array(Ie);if(fe&&fe.length!==0){for(let Ye=0;Ye<Ie;Ye++){let et=0;ge?(et=oe[m]-oe[m-1],m++):et=ne[u]-ne[u-1],u++;const Mt=h.vertexBufferType===Ua.VEC_2?yS(ve,fe,F,et,!1):bS(ve,fe,F,et,!1,$);Re[Ye]=Mt,F+=et}a[T++]=M.createMultiLineString(Re)}else{for(let Ye=0;Ye<Ie;Ye++){let et=0;ge?(et=oe[m]-oe[m-1],m++):et=ne[u]-ne[u-1],u++,Re[Ye]=vS(ve,R,et,!1),R+=2*et}a[T++]=M.createMultiLineString(Re)}}else{if(Ge!==Ls.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const Ie=K[y]-K[y-1];y++;const Re=new Array(Ie);let Ye=0;if(fe&&fe.length!==0){for(let et=0;et<Ie;et++){const Mt=ne[u]-ne[u-1];u++;const Ut=new Array(Mt-1);Ye=oe[m]-oe[m-1],m++;const Ot=h.vertexBufferType===Ua.VEC_2?pb(ve,fe,F,Ye):mb(ve,fe,F,Ye,0,$);F+=Ye;for(let Zt=0;Zt<Ut.length;Zt++)Ye=oe[m]-oe[m-1],m++,Ut[Zt]=h.vertexBufferType===Ua.VEC_2?pb(ve,fe,F,Ye):mb(ve,fe,F,Ye,0,$),F+=Ye;Re[et]=M.createPolygon(Ot,Ut)}a[T++]=M.createMultiPolygon(Re)}else{for(let et=0;et<Ie;et++){const Mt=ne[u]-ne[u-1];u++;const Ut=new Array(Mt-1);Ye=oe[m]-oe[m-1],m++;const Ot=fb(ve,R,Ye);R+=2*Ye;for(let Zt=0;Zt<Ut.length;Zt++){const ni=oe[m]-oe[m-1];m++,Ut[Zt]=fb(ve,R,ni),R+=2*ni}Re[et]=M.createPolygon(Ot,Ut)}a[T++]=M.createMultiPolygon(Re)}}}}return a}function fb(h,a,u){return vS(h,a,u,!0)}function pb(h,a,u,m){return yS(h,a,u,m,!0)}function mb(h,a,u,m,y,T){return bS(h,a,u,m,!0,T)}function vS(h,a,u,m){const y=new Array(m?u+1:u);for(let T=0;T<2*u;T+=2)y[T/2]=new d(h[a+T],h[a+T+1]);return m&&(y[y.length-1]=y[0]),y}function yS(h,a,u,m,y){const T=new Array(y?m+1:m);for(let M=0;M<2*m;M+=2){const R=2*a[u+M/2];T[M/2]=new d(h[R],h[R+1])}return y&&(T[T.length-1]=T[0]),T}function bS(h,a,u,m,y,T){const M=new Array(y?m+1:m);for(let R=0;R<m;R++){const F=_S(h[a[u+R]],T.numBits,T.coordinateShift);M[R]=new d(F.x,F.y)}return y&&(M[M.length-1]=M[0]),M}class $A{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(a,u,m,y,T){this._vertexBufferType=a,this._topologyVector=u,this._vertexOffsets=m,this._vertexBuffer=y,this._mortonSettings=T}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const a=NA(this);let u=0;for(;u<this.numGeometries;)yield{coordinates:a[u],type:this.geometryType(u)},u++}getSimpleEncodedVertex(a){const u=this.vertexOffsets?2*this.vertexOffsets[a]:2*a;return[this.vertexBuffer[u],this.vertexBuffer[u+1]]}getVertex(a){if(this.vertexOffsets&&this.mortonSettings){const m=_S(this.vertexBuffer[this.vertexOffsets[a]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[m.x,m.y]}const u=this.vertexOffsets?2*this.vertexOffsets[a]:2*a;return[this.vertexBuffer[u],this.vertexBuffer[u+1]]}getGeometries(){return NA(this)}get mortonSettings(){return this._mortonSettings}}class VA extends $A{_numGeometries;_geometryType;constructor(a,u,m,y,T,M,R){super(m,y,T,M,R),this._numGeometries=a,this._geometryType=u}geometryType(a){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===Ls.POLYGON||this._geometryType===Ls.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class UA extends $A{_geometryTypes;constructor(a,u,m,y,T,M){super(a,m,y,T,M),this._geometryTypes=u}geometryType(a){return this._geometryTypes[a]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let a=0;a<this.numGeometries;a++)if(this.geometryType(a)===Ls.POLYGON||this.geometryType(a)===Ls.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class jA{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(a,u,m,y){this._triangleOffsets=a,this._indexBuffer=u,this._vertexBuffer=m,this._topologyVector=y}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const a=new Array(this.numGeometries),u=this._topologyVector,m=u.partOffsets,y=u.ringOffsets,T=u.geometryOffsets;let M=0,R=1,F=1,$=1;for(let H=0;H<this.numGeometries;H++)switch(this.geometryType(H)){case Ls.POLYGON:{const K=m[R]-m[R-1];R++;const ne=[];for(let oe=0;oe<K;oe++){const fe=y[F]-y[F-1];F++;const ge=[];for(let ve=0;ve<fe;ve++){const Pe=this._vertexBuffer[M++],Ge=this._vertexBuffer[M++];ge.push(new d(Pe,Ge))}ge.length>0&&ge.push(ge[0]),ne.push(ge)}a[H]=ne,T&&$++}break;case Ls.MULTIPOLYGON:{const K=T[$]-T[$-1];$++;const ne=[];for(let oe=0;oe<K;oe++){const fe=m[R]-m[R-1];R++;for(let ge=0;ge<fe;ge++){const ve=y[F]-y[F-1];F++;const Pe=[];for(let Ge=0;Ge<ve;Ge++){const Ie=this._vertexBuffer[M++],Re=this._vertexBuffer[M++];Pe.push(new d(Ie,Re))}Pe.length>0&&Pe.push(Pe[0]),ne.push(Pe)}}a[H]=ne}}return a}[Symbol.iterator](){return null}}function GA(h,a,u,m,y,T){return new v$(h,a,u,m,y,T)}class v$ extends jA{_numGeometries;_geometryType;constructor(a,u,m,y,T,M){super(m,y,T,M),this._numGeometries=a,this._geometryType=u}geometryType(a){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function qA(h,a,u,m,y){return new y$(h,a,u,m,y)}class y$ extends jA{_geometryTypes;constructor(a,u,m,y,T){super(u,m,y,T),this._geometryTypes=a}geometryType(a){return this._geometryTypes[a]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function b$(h,a,u,m,y){const T=To(h,u);let M=null,R=null,F=null,$=null,H=null,K=null,ne=null,oe=null;if(db(T,m,h,u)===Rs.CONST){const ge=mS(h,u,T,!1);for(let ve=0;ve<a-1;ve++){const Pe=To(h,u);switch(Pe.physicalStreamType){case Js.LENGTH:switch(Pe.logicalStreamType.lengthType){case fa.GEOMETRIES:M=sd(h,u,Pe);break;case fa.PARTS:R=sd(h,u,Pe);break;case fa.RINGS:F=sd(h,u,Pe);break;case fa.TRIANGLES:ne=sd(h,u,Pe)}break;case Js.OFFSET:switch(Pe.logicalStreamType.offsetType){case Ff.VERTEX:$=Mo(h,u,Pe,!1);break;case Ff.INDEX:oe=Mo(h,u,Pe,!1)}break;case Js.DATA:cc.VERTEX===Pe.logicalStreamType.dictionaryType?H=Mo(h,u,Pe,!0):(K={numBits:Pe.numBits,coordinateShift:Pe.coordinateShift},H=Mo(h,u,Pe,!1))}}return oe!==null?M!=null||R!=null?GA(m,ge,ne,oe,H,new Im(M,R,F)):GA(m,ge,ne,oe,H):K===null?(function(ve,Pe,Ge,Ie,Re){return new VA(ve,Pe,Ua.VEC_2,Ge,Ie,Re)})(m,ge,new Im(M,R,F),$,H):(function(ve,Pe,Ge,Ie,Re,Ye){return new VA(ve,Pe,Ua.MORTON,Ge,Ie,Re,Ye)})(m,ge,new Im(M,R,F),$,H,K)}const fe=Mo(h,u,T,!1);for(let ge=0;ge<a-1;ge++){const ve=To(h,u);switch(ve.physicalStreamType){case Js.LENGTH:switch(ve.logicalStreamType.lengthType){case fa.GEOMETRIES:M=Mo(h,u,ve,!1);break;case fa.PARTS:R=Mo(h,u,ve,!1);break;case fa.RINGS:F=Mo(h,u,ve,!1);break;case fa.TRIANGLES:ne=sd(h,u,ve)}break;case Js.OFFSET:switch(ve.logicalStreamType.offsetType){case Ff.VERTEX:$=Mo(h,u,ve,!1);break;case Ff.INDEX:oe=Mo(h,u,ve,!1)}break;case Js.DATA:cc.VERTEX===ve.logicalStreamType.dictionaryType?H=Mo(h,u,ve,!0):(K={numBits:ve.numBits,coordinateShift:ve.coordinateShift},H=Mo(h,u,ve,!1))}}return oe!==null&&R===null?qA(fe,ne,oe,H):(M!==null?(M=xS(fe,M,2),R!==null&&F!==null?(R=WA(fe,M,R,!1),F=(function(ge,ve,Pe,Ge){const Ie=new Int32Array(Pe[Pe.length-1]+1);let Re=0;Ie[0]=Re;let Ye=1,et=1,Mt=0;for(let Ut=0;Ut<ge.length;Ut++){const Ot=ge[Ut],Zt=ve[Ut+1]-ve[Ut];if(Ot!==0&&Ot!==3)for(let ni=0;ni<Zt;ni++){const Yt=Pe[Ye]-Pe[Ye-1];Ye++;for(let $t=0;$t<Yt;$t++)Re=Ie[et++]=Re+Ge[Mt++]}else for(let ni=0;ni<Zt;ni++)Ie[et++]=++Re,Ye++}return Ie})(fe,M,R,F)):R!==null&&(R=(function(ge,ve,Pe){const Ge=new Int32Array(ve[ve.length-1]+1);let Ie=0;Ge[0]=Ie;let Re=1,Ye=0;for(let et=0;et<ge.length;et++){const Mt=ge[et],Ut=ve[et+1]-ve[et];if(Mt===4||Mt===1)for(let Ot=0;Ot<Ut;Ot++)Ie=Ge[Re++]=Ie+Pe[Ye++];else for(let Ot=0;Ot<Ut;Ot++)Ge[Re++]=++Ie}return Ge})(fe,M,R))):R!==null&&F!==null?(R=xS(fe,R,1),F=WA(fe,R,F,!0)):R!==null&&(R=xS(fe,R,0)),oe!==null?qA(fe,ne,oe,H,new Im(M,R,F)):K===null?(function(ge,ve,Pe,Ge){return new UA(Ua.VEC_2,ge,ve,Pe,Ge)})(fe,new Im(M,R,F),$,H):(function(ge,ve,Pe,Ge,Ie){return new UA(Ua.MORTON,ge,ve,Pe,Ge,Ie)})(fe,new Im(M,R,F),$,H,K))}function xS(h,a,u){const m=new Int32Array(h.length+1);let y=0;m[0]=y;let T=0;for(let M=0;M<h.length;M++)y=m[M+1]=y+(h[M]>u?a[T++]:1);return m}function WA(h,a,u,m){const y=new Int32Array(a[a.length-1]+1);let T=0;y[0]=T;let M=1,R=0;for(let F=0;F<h.length;F++){const $=h[F],H=a[F+1]-a[F];if($===5||$===2||m&&($===4||$===1))for(let K=0;K<H;K++)T=y[M++]=T+u[R++];else for(let K=0;K<H;K++)y[M++]=++T}return y}class x$ extends Am{dataVector;constructor(a,u,m){super(a,u.getBuffer(),m),this.dataVector=u}getValueFromBuffer(a){return this.dataVector.get(a)}}class w$ extends cb{getValueFromBuffer(a){return this.dataBuffer[a]}}class HA extends Am{constructor(a,u,m){super(a,BigInt64Array.of(u),m)}getValueFromBuffer(a){return this.dataBuffer[0]}}function uv(h,a,u){return ZA(h,Math.ceil(a/8),u)}function ZA(h,a,u){const m=new Uint8Array(a);let y=0;for(;y<a;){const T=h[u.increment()];if(T<=127){const M=T+3,R=h[u.increment()],F=y+M;m.fill(R,y,F),y=F}else{const M=256-T;for(let R=0;R<M;R++)m[y++]=h[u.increment()]}}return m}const S$=new TextDecoder;function wS(h,a,u){return u-a>=12?S$.decode(h.subarray(a,u)):(function(m,y,T){let M="",R=y;for(;R<T;){const F=m[R];let $,H,K,ne=null,oe=F>239?4:F>223?3:F>191?2:1;if(R+oe>T)break;oe===1?F<128&&(ne=F):oe===2?($=m[R+1],(192&$)==128&&(ne=(31&F)<<6|63&$,ne<=127&&(ne=null))):oe===3?($=m[R+1],H=m[R+2],(192&$)==128&&(192&H)==128&&(ne=(15&F)<<12|(63&$)<<6|63&H,(ne<=2047||ne>=55296&&ne<=57343)&&(ne=null))):oe===4&&($=m[R+1],H=m[R+2],K=m[R+3],(192&$)==128&&(192&H)==128&&(192&K)==128&&(ne=(15&F)<<18|(63&$)<<12|(63&H)<<6|63&K,(ne<=65535||ne>=1114112)&&(ne=null))),ne===null?(ne=65533,oe=1):ne>65535&&(ne-=65536,M+=String.fromCharCode(ne>>>10&1023|55296),ne=56320|1023&ne),M+=String.fromCharCode(ne),R+=oe}return M})(h,a,u)}class SS extends Am{offsetBuffer;constructor(a,u,m,y){super(a,m,y),this.offsetBuffer=u}}class XA extends SS{textEncoder;constructor(a,u,m,y){super(a,u,m,y??u.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(a){return wS(this.dataBuffer,this.offsetBuffer[a],this.offsetBuffer[a+1])}}class Rm extends SS{indexBuffer;textEncoder;constructor(a,u,m,y,T){super(a,m,y,T??u.length),this.indexBuffer=u,this.indexBuffer=u,this.textEncoder=new TextEncoder}getValueFromBuffer(a){const u=this.indexBuffer[a];return wS(this.dataBuffer,this.offsetBuffer[u],this.offsetBuffer[u+1])}}class YA extends SS{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(a,u,m,y,T,M,R){super(a,m,y,R),this.indexBuffer=u,this.symbolOffsetBuffer=T,this.symbolTableBuffer=M,this.textEncoder=new TextEncoder}getValueFromBuffer(a){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(m,y,T){const M=[],R=new Array(y.length).fill(0);for(let F=1;F<y.length;F++)R[F]=R[F-1]+y[F-1];for(let F=0;F<T.length;F++)if(T[F]===255)M.push(T[++F]);else{const $=y[T[F]],H=R[T[F]];for(let K=0;K<$;K++)M.push(m[H+K])}return new Uint8Array(M)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const u=this.indexBuffer[a];return wS(this.decodedDictionary,this.offsetBuffer[u],this.offsetBuffer[u+1])}offsetToLengthBuffer(a){const u=new Uint32Array(a.length-1);let m=a[0];for(let y=1;y<a.length;y++){const T=a[y];u[y-1]=T-m,m=T}return u}}function T$(h,a,u,m,y,T){return u.type==="scalarType"?(function(M,R,F,$,H,K){let ne=null,oe=0;if(M===0)return null;if(K.nullable){const ge=To(R,F);oe=ge.numValues;const ve=F.get(),Pe=uv(R,oe,F);F.set(ve+ge.byteLength),ne=new uc(Pe,ge.numValues)}const fe=ne??$;switch(H.physicalType){case 4:case 3:return(function(ge,ve,Pe,Ge,Ie){const Re=To(ge,ve),Ye=db(Re,Ie,ge,ve),et=Ge.physicalType===3;if(Ye===Rs.FLAT){const Mt=hv(Ie)?gS(ge,ve,Re,et,Ie):Mo(ge,ve,Re,et);return new cS(Pe.name,Mt,Ie)}if(Ye===Rs.SEQUENCE){const Mt=LA(ge,ve,Re);return new hS(Pe.name,Mt[0],Mt[1],Re.numRleValues)}{const Mt=mS(ge,ve,Re,et);return new dS(Pe.name,Mt,Ie)}})(R,F,K,H,fe);case 9:return(function(ge,ve,Pe,Ge,Ie){let Re=null,Ye=null,et=null,Mt=null,Ut=null,Ot=null,Zt=null,ni=null;for(let Yt=0;Yt<Ge;Yt++){const $t=To(ve,Pe);if($t.byteLength!==0)switch($t.physicalStreamType){case Js.PRESENT:{const It=uv(ve,$t.numValues,Pe);Ot=new uc(It,$t.numValues);break}case Js.OFFSET:Ye=Ie!=null||Ot!=null?gS(ve,Pe,$t,!1,Ie??Ot):Mo(ve,Pe,$t,!1);break;case Js.LENGTH:{const It=sd(ve,Pe,$t);fa.DICTIONARY===$t.logicalStreamType.lengthType?Re=It:fa.SYMBOL===$t.logicalStreamType.lengthType?Mt=It:Zt=It;break}case Js.DATA:{const It=ve.subarray(Pe.get(),Pe.get()+$t.byteLength);Pe.add($t.byteLength);const fi=$t.logicalStreamType.dictionaryType;cc.FSST===fi?Ut=It:cc.SINGLE===fi||cc.SHARED===fi?et=It:cc.NONE===fi&&(ni=It);break}}}return(function(Yt,$t,It,fi,hi,_i,ui){return $t?new YA(Yt,It,fi,hi,_i,$t,ui):null})(ge,Ut,Ye,Re,et,Mt,Ie??Ot)??(function(Yt,$t,It,fi,hi){return $t?hi?new Rm(Yt,It,fi,$t,hi):new Rm(Yt,It,fi,$t):null})(ge,et,Ye,Re,Ie??Ot)??(function(Yt,$t,It,fi,hi){if(!$t||!It)return null;if(fi)return hi?new Rm(Yt,fi,$t,It,hi):new Rm(Yt,fi,$t,It);if(hi&&hi.size()!==$t.length-1){const _i=new Int32Array(hi.size());let ui=0;for(let Ci=0;Ci<hi.size();Ci++)_i[Ci]=hi.get(Ci)?ui++:0;return new Rm(Yt,_i,$t,It,hi)}return hi?new XA(Yt,$t,It,hi):new XA(Yt,$t,It)})(ge,Zt,ni,Ye,Ie??Ot)})(K.name,R,F,K.nullable?M-1:M,ne);case 0:return(function(ge,ve,Pe,Ge,Ie){const Re=To(ge,ve),Ye=Re.numValues,et=ve.get(),Mt=hv(Ie)?(function(Ot,Zt,ni,Yt){const $t=ZA(Ot,Math.ceil(Zt/8),ni),It=new uc($t,Zt),fi=Yt.size(),hi=new uc(new Uint8Array(fi),fi);let _i=0;for(let ui=0;ui<Yt.size();ui++){const Ci=!!Yt.get(ui)&&It.get(_i++);hi.set(ui,Ci)}return hi.getBuffer()})(ge,Ye,ve,Ie):uv(ge,Ye,ve);ve.set(et+Re.byteLength);const Ut=new uc(Mt,Ye);return new x$(Pe.name,Ut,Ie)})(R,F,K,0,fe);case 6:case 5:return(function(ge,ve,Pe,Ge,Ie){const Re=To(ge,ve),Ye=db(Re,Ge,ge,ve),et=Ie.physicalType===5;if(Ye===Rs.FLAT){const Mt=hv(Ge)?(function(Ut,Ot,Zt,ni,Yt){return(function($t,It,fi,hi){switch(It.logicalLevelTechnique1){case mn.DELTA:return It.logicalLevelTechnique2===mn.RLE&&($t=PA($t,It.runs,It.numRleValues)),(function(_i,ui){const Ci=new BigInt64Array(_i.size());let wn=0;_i.get(0)?(Ci[0]=_i.get(0)?ui[0]>>1n^-(1n&ui[0]):0n,wn=1):Ci[0]=0n;let un=1;for(;un!=Ci.length;++un)Ci[un]=_i.get(un)?Ci[un-1]+(ui[wn]>>1n^-(1n&ui[wn++])):Ci[un-1];return Ci})(hi,$t);case mn.RLE:return(function(_i,ui,Ci,wn){const un=ui;return Ci?(function(wr,eo,ps){const Sr=new BigInt64Array(wr.size());let mr=0;for(let In=0;In<ps;In++){const Nr=Number(eo[In]);let Xr=eo[In+ps];Xr=Xr>>1n^-(1n&Xr);for(let or=mr;or<mr+Nr;or++)wr.get(or)?Sr[or]=Xr:(Sr[or]=0n,mr++);mr+=Nr}return Sr})(wn,_i,un.runs):(function(wr,eo,ps){const Sr=new BigInt64Array(wr.size());let mr=0;for(let In=0;In<ps;In++){const Nr=Number(eo[In]),Xr=eo[In+ps];for(let or=mr;or<mr+Nr;or++)wr.get(or)?Sr[or]=Xr:(Sr[or]=0n,mr++);mr+=Nr}return Sr})(wn,_i,un.runs)})($t,It,fi,hi);case mn.NONE:return $t=fi?(function(_i,ui){const Ci=new BigInt64Array(_i.size());let wn=0,un=0;for(;un!=Ci.length;++un)if(_i.get(un)){const wr=ui[wn++];Ci[un]=wr>>1n^-(1n&wr)}else Ci[un]=0n;return Ci})(hi,$t):(function(_i,ui){const Ci=new BigInt64Array(_i.size());let wn=0,un=0;for(;un!=Ci.length;++un)Ci[un]=_i.get(un)?ui[wn++]:0n;return Ci})(hi,$t),$t;default:throw new Error("The specified Logical level technique is not supported")}})(ub(Ut,Ot,Zt.numValues),Zt,ni,Yt)})(ge,ve,Re,et,Ge):DA(ge,ve,Re,et);return new OA(Pe.name,Mt,Ge)}if(Ye===Rs.SEQUENCE){const Mt=kA(ge,ve,Re);return new zA(Pe.name,Mt[0],Mt[1],Re.numRleValues)}{const Mt=FA(ge,ve,Re,et);return new HA(Pe.name,Mt,Ge)}})(R,F,K,fe,H);case 7:return(function(ge,ve,Pe,Ge){const Ie=To(ge,ve),Re=hv(Ge)?(function(Ye,et,Mt,Ut){const Ot=et.get(),Zt=Ot+Ut*Float32Array.BYTES_PER_ELEMENT,ni=new Uint8Array(Ye.subarray(Ot,Zt)).buffer,Yt=new Float32Array(ni);et.set(Zt);const $t=Mt.size(),It=new Float32Array($t);let fi=0;for(let hi=0;hi<$t;hi++)It[hi]=Mt.get(hi)?Yt[fi++]:0;return It})(ge,ve,Ge,Ie.numValues):(function(Ye,et,Mt){const Ut=et.get(),Ot=Ut+Mt*Float32Array.BYTES_PER_ELEMENT,Zt=new Uint8Array(Ye.subarray(Ut,Ot)).buffer,ni=new Float32Array(Zt);return et.set(Ot),ni})(ge,ve,Ie.numValues);return new w$(Pe.name,Re,Ge)})(R,F,K,fe);case 8:return(function(ge,ve,Pe,Ge){const Ie=To(ge,ve),Re=hv(Ge)?(function(Ye,et,Mt,Ut){const Ot=et.get(),Zt=Ot+Ut*Float64Array.BYTES_PER_ELEMENT,ni=new Uint8Array(Ye.subarray(Ot,Zt)).buffer,Yt=new Float64Array(ni);et.set(Zt);const $t=Mt.size(),It=new Float64Array($t);let fi=0;for(let hi=0;hi<$t;hi++)It[hi]=Mt.get(hi)?Yt[fi++]:0;return It})(ge,ve,Ge,Ie.numValues):(function(Ye,et,Mt){const Ut=et.get(),Ot=Ut+Mt*Float64Array.BYTES_PER_ELEMENT,Zt=new Uint8Array(Ye.subarray(Ut,Ot)).buffer,ni=new Float64Array(Zt);return et.set(Ot),ni})(ge,ve,Ie.numValues);return new uS(Pe.name,Re,Ge)})(R,F,K,fe);default:throw new Error(`The specified data type for the field is currently not supported: ${H}`)}})(m,h,a,y,u.scalarType,u):m!=1?null:(function(M,R,F,$){let H=null,K=null,ne=null,oe=null,fe=!1;for(;!fe;){const Ge=To(M,R);switch(Ge.physicalStreamType){case Js.LENGTH:fa.DICTIONARY===Ge.logicalStreamType.lengthType?H=sd(M,R,Ge):ne=sd(M,R,Ge);break;case Js.DATA:cc.SINGLE===Ge.logicalStreamType.dictionaryType||cc.SHARED===Ge.logicalStreamType.dictionaryType?(K=M.subarray(R.get(),R.get()+Ge.byteLength),fe=!0):oe=M.subarray(R.get(),R.get()+Ge.byteLength),R.add(Ge.byteLength)}}const ge=F.complexType.children,ve=[];let Pe=0;for(const Ge of ge){const Ie=js(M,R,1)[0];if(Ie==0)continue;const Re=`${F.name}${Ge.name==="default"?"":":"+Ge.name}`;if(Ie!==2||Ge.type!=="scalarField"||Ge.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const Ye=To(M,R),et=uv(M,Ye.numValues,R),Mt=To(M,R),Ut=Mt.decompressedCount!==$?gS(M,R,Mt,!1,new uc(et,Ye.numValues)):Mo(M,R,Mt,!1);ve[Pe++]=oe?new YA(Re,Ut,H,K,ne,oe,new uc(et,Ye.numValues)):new Rm(Re,Ut,H,K,new uc(et,Ye.numValues))}return ve})(h,a,u,y)}function hv(h){return h instanceof uc}function M$(h){if(h.name==="id")return!1;if(h.type==="scalarType"){const a=h.scalarType;if(a.type==="physicalType")switch(a.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(a.type==="logicalType")return!1}else if(h.type==="complexType"){const a=h.complexType;if(a.type==="physicalType")switch(a.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",h),!1}const C$=new TextDecoder;function KA(h,a){const u=js(h,a,1)[0];if(u===0)return"";const m=a.get(),y=h.subarray(m,m+u);return a.add(u),C$.decode(y)}function JA(h,a){const u=js(h,a,1)[0]>>>0,m=!!(4&u),y=!!(2&u),T=js(h,a,1)[0]>>>0,M={};if(1&u&&(M.nullable=!0),y){const R={};if(m?(R.type="logicalType",R.logicalType=T):(R.type="physicalType",R.physicalType=T),8&u){const F=js(h,a,1)[0]>>>0;R.children=new Array(F);for(let $=0;$<F;$++)R.children[$]=JA(h,a)}M.type="complexField",M.complexField=R}else{const R={};m?(R.type="logicalType",R.logicalType=T):(R.type="physicalType",R.physicalType=T),M.type="scalarField",M.scalarField=R}return M}function E$(h,a){const u=js(h,a,1)[0]>>>0,m=(function(y){switch(y){case 0:case 1:case 2:case 3:{const T={};T.nullable=!!(1&y),T.columnScope=0;const M={};return M.physicalType=y>1?6:4,M.type="physicalType",T.scalarType=M,T.type="scalarType",T}case 4:{const T={nullable:!1,columnScope:0},M={type:"physicalType",physicalType:0};return T.type="complexType",T.complexType=M,T}case 30:{const T={nullable:!1,columnScope:0},M={type:"physicalType",physicalType:1};return T.type="complexType",T.complexType=M,T}default:return(function(T){let M=null;switch(T){case 10:case 11:M=0;break;case 12:case 13:M=1;break;case 14:case 15:M=2;break;case 16:case 17:M=3;break;case 18:case 19:M=4;break;case 20:case 21:M=5;break;case 22:case 23:M=6;break;case 24:case 25:M=7;break;case 26:case 27:M=8;break;case 28:case 29:M=9;break;default:return null}const R={};R.nullable=!!(1&T),R.columnScope=0;const F={type:"physicalType"};return F.physicalType=M,R.type="scalarType",R.scalarType=F,R})(y)}})(u);if(!m)throw new Error(`Unsupported column type code: ${u}`);if((function(y){return y>=10})(u)?m.name=KA(h,a):u>=0&&u<=3?m.name="id":u===4&&(m.name="geometry"),(function(y){return y===30})(u)){const y=js(h,a,1)[0]>>>0,T=m.complexType;T.children=new Array(y);for(let M=0;M<y;M++)T.children[M]=JA(h,a)}return m}function A$(h,a){const u={featureTables:[]},m={};m.name=KA(h,a);const y=js(h,a,1)[0]>>>0,T=js(h,a,1)[0]>>>0;m.columns=new Array(T);for(let M=0;M<T;M++)m.columns[M]=E$(h,a);return u.featureTables.push(m),[u,y]}function P$(h,a,u,m,y,T,M=!1){const R=a.scalarType.physicalType,F=db(y,T,h,u);if(R===4)switch(F){case Rs.FLAT:{const $=Mo(h,u,y,!1);return new cS(m,$,T)}case Rs.SEQUENCE:{const $=LA(h,u,y);return new hS(m,$[0],$[1],y.numRleValues)}case Rs.CONST:{const $=mS(h,u,y,!1);return new dS(m,$,T)}}else switch(F){case Rs.FLAT:{if(M){const H=(function(K,ne,oe,fe){const ge=(function(ve,Pe,Ge){const Ie=new Float64Array(Pe);for(let Re=0;Re<Pe;Re++)Ie[Re]=m$(ve,Ge);return Ie})(K,oe.numValues,ne);return(function(ve,Pe,Ge){switch(Pe.logicalLevelTechnique1){case mn.DELTA:return Pe.logicalLevelTechnique2===mn.RLE&&(ve=IA(ve,Pe.runs,Pe.numRleValues)),(function(Ie){Ie[0]=Ie[0]%2==1?(Ie[0]+1)/-2:Ie[0]/2;const Re=Ie.length/4*4;let Ye=1;if(Re>=4)for(;Ye<Re-4;Ye+=4){const et=Ie[Ye],Mt=Ie[Ye+1],Ut=Ie[Ye+2],Ot=Ie[Ye+3];Ie[Ye]=(et%2==1?(et+1)/-2:et/2)+Ie[Ye-1],Ie[Ye+1]=(Mt%2==1?(Mt+1)/-2:Mt/2)+Ie[Ye],Ie[Ye+2]=(Ut%2==1?(Ut+1)/-2:Ut/2)+Ie[Ye+1],Ie[Ye+3]=(Ot%2==1?(Ot+1)/-2:Ot/2)+Ie[Ye+2]}for(;Ye!=Ie.length;++Ye)Ie[Ye]=(Ie[Ye]%2==1?(Ie[Ye]+1)/-2:Ie[Ye]/2)+Ie[Ye-1]})(ve),ve;case mn.RLE:return(function(Ie,Re,Ye){return IA(Ie,Re.runs,Re.numRleValues)})(ve,Pe);case mn.NONE:return ve;default:throw new Error(`The specified Logical level technique is not supported: ${Pe.logicalLevelTechnique1}`)}})(ge,oe)})(h,u,y);return new uS(m,H,T)}const $=DA(h,u,y,!1);return new OA(m,$,T)}case Rs.SEQUENCE:{const $=kA(h,u,y);return new zA(m,$[0],$[1],y.numRleValues)}case Rs.CONST:{const $=FA(h,u,y,!1);return new HA(m,$,T)}}throw new Error("Vector type not supported for id column.")}class I${constructor(a,u){var m;switch(this._featureData=a,this.properties=this._featureData.properties||{},(m=this._featureData.geometry)===null||m===void 0?void 0:m.type){case Ls.POINT:case Ls.MULTIPOINT:this.type=1;break;case Ls.LINESTRING:case Ls.MULTILINESTRING:this.type=2;break;case Ls.POLYGON:case Ls.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=u,this.id=Number(this._featureData.id)}loadGeometry(){const a=[];for(const u of this._featureData.geometry.coordinates){const m=[];for(const y of u)m.push(new d(y.x,y.y));a.push(m)}return a}}class R${constructor(a){this.features=[],this.featureTable=a,this.name=a.name,this.extent=a.extent,this.version=2,this.features=a.getFeatures(),this.length=this.features.length}feature(a){return new I$(this.features[a],this.extent)}}class QA{constructor(a){this.layers={};const u=(function(m,y,T=!0){const M=new p$(0),R=[];for(;M.get()<m.length;){const F=js(m,M,1)[0]>>>0,$=M.get()+F;if($>m.length)throw new Error(`Block overruns tile: ${$} > ${m.length}`);if(js(m,M,1)[0]>>>0!=1){M.set($);continue}const H=A$(m,M),K=H[1],ne=H[0].featureTables[0];let oe=null,fe=null;const ge=[];let ve=0;for(const Ge of ne.columns){const Ie=Ge.name;if(Ie==="id"){let Re=null;if(Ge.nullable){const et=To(m,M),Mt=M.get(),Ut=uv(m,et.numValues,M);M.set(Mt+et.byteLength),Re=new uc(Ut,et.numValues)}const Ye=To(m,M);ve=Ye.decompressedCount,oe=P$(m,Ge,M,Ie,Ye,Re??ve,T)}else if(Ie==="geometry"){const Re=js(m,M,1)[0];if(ve===0){const Ye=M.get();ve=To(m,M).decompressedCount,M.set(Ye)}fe=b$(m,Re,M,ve)}else{const Re=M$(Ge)?js(m,M,1)[0]:1;if(Re===0&&Ge.type==="scalarType")continue;const Ye=T$(m,M,Ge,Re,ve);if(Ye)if(Array.isArray(Ye))for(const et of Ye)ge.push(et);else ge.push(Ye)}}const Pe=new f$(ne.name,fe,oe,ge,K);R.push(Pe),M.set($)}return R})(new Uint8Array(a));this.layers=u.reduce(((m,y)=>Object.assign(Object.assign({},m),{[y.name]:new R$(y)})),{})}}class L${constructor(a,u){this.feature=a,this.type=a.type,this.properties=a.tags?a.tags:{},this.extent=u,"id"in a&&(typeof a.id=="string"?this.id=parseInt(a.id,10):typeof a.id!="number"||isNaN(a.id)||(this.id=a.id))}loadGeometry(){const a=[],u=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const m of u){const y=[];for(const T of m)y.push(new d(T[0],T[1]));a.push(y)}return a}}const dv="_geojsonTileLayer";function k$(h,a){a.writeVarintField(15,h.version||1),a.writeStringField(1,h.name||""),a.writeVarintField(5,h.extent||4096);const u={keys:[],values:[],keycache:{},valuecache:{}};for(let T=0;T<h.length;T++)u.feature=h.feature(T),a.writeMessage(2,D$,u);const m=u.keys;for(const T of m)a.writeStringField(3,T);const y=u.values;for(const T of y)a.writeMessage(4,z$,T)}function D$(h,a){if(!h.feature)return;const u=h.feature;u.id!==void 0&&a.writeVarintField(1,u.id),a.writeMessage(2,F$,h),a.writeVarintField(3,u.type),a.writeMessage(4,O$,u)}function F$(h,a){for(const u in h.feature?.properties){let m=h.feature.properties[u],y=h.keycache[u];if(m==null)continue;y===void 0&&(h.keys.push(u),y=h.keys.length-1,h.keycache[u]=y),a.writeVarint(y),typeof m!="string"&&typeof m!="boolean"&&typeof m!="number"&&(m=JSON.stringify(m));const T=typeof m+":"+m;let M=h.valuecache[T];M===void 0&&(h.values.push(m),M=h.values.length-1,h.valuecache[T]=M),a.writeVarint(M)}}function TS(h,a){return(a<<3)+(7&h)}function eP(h){return h<<1^h>>31}function O$(h,a){const u=h.loadGeometry(),m=h.type;let y=0,T=0;for(const M of u){let R=1;m===1&&(R=M.length),a.writeVarint(TS(1,R));const F=m===3?M.length-1:M.length;for(let $=0;$<F;$++){$===1&&m!==1&&a.writeVarint(TS(2,F-1));const H=M[$].x-y,K=M[$].y-T;a.writeVarint(eP(H)),a.writeVarint(eP(K)),y+=H,T+=K}h.type===3&&a.writeVarint(TS(7,1))}}function z$(h,a){const u=typeof h;u==="string"?a.writeStringField(1,h):u==="boolean"?a.writeBooleanField(7,h):u==="number"&&(h%1!=0?a.writeDoubleField(3,h):h<0?a.writeSVarintField(6,h):a.writeVarintField(5,h))}class tP{constructor(a,u){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new Jh(Ee,16,0),this.grid3D=new Jh(Ee,16,0),this.featureIndexArray=new Ce,this.promoteId=u}insert(a,u,m,y,T,M){const R=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(m,y,T);const F=M?this.grid3D:this.grid;for(let $=0;$<u.length;$++){const H=u[$],K=[1/0,1/0,-1/0,-1/0];for(let ne=0;ne<H.length;ne++){const oe=H[ne];K[0]=Math.min(K[0],oe.x),K[1]=Math.min(K[1],oe.y),K[2]=Math.max(K[2],oe.x),K[3]=Math.max(K[3],oe.y)}K[0]<Ee&&K[1]<Ee&&K[2]>=0&&K[3]>=0&&F.insert(R,K[0],K[1],K[2],K[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new $E(new rb(this.rawTileData)).layers:new QA(this.rawTileData).layers,this.sourceLayerCoder=new SA(this.vtLayers?Object.keys(this.vtLayers).sort():[dv])),this.vtLayers}query(a,u,m,y){this.loadVTLayers();const T=a.params,M=Ee/a.tileSize/a.scale,R=uf(T.filter,T.globalState),F=a.queryGeometry,$=a.queryPadding*M,H=Df.fromPoints(F),K=this.grid.query(H.minX-$,H.minY-$,H.maxX+$,H.maxY+$),ne=Df.fromPoints(a.cameraQueryGeometry).expandBy($),oe=this.grid3D.query(ne.minX,ne.minY,ne.maxX,ne.maxY,((ve,Pe,Ge,Ie)=>(function(Re,Ye,et,Mt,Ut){for(const Zt of Re)if(Ye<=Zt.x&&et<=Zt.y&&Mt>=Zt.x&&Ut>=Zt.y)return!0;const Ot=[new d(Ye,et),new d(Ye,Ut),new d(Mt,Ut),new d(Mt,et)];if(Re.length>2){for(const Zt of Ot)if(ym(Re,Zt))return!0}for(let Zt=0;Zt<Re.length-1;Zt++)if(NN(Re[Zt],Re[Zt+1],Ot))return!0;return!1})(a.cameraQueryGeometry,ve-$,Pe-$,Ge+$,Ie+$)));for(const ve of oe)K.push(ve);K.sort(B$);const fe={};let ge;for(let ve=0;ve<K.length;ve++){const Pe=K[ve];if(Pe===ge)continue;ge=Pe;const Ge=this.featureIndexArray.get(Pe);let Ie=null;this.loadMatchingFeature(fe,Ge.bucketIndex,Ge.sourceLayerIndex,Ge.featureIndex,R,T.layers,T.availableImages,u,m,y,((Re,Ye,et)=>(Ie||(Ie=Zc(Re)),Ye.queryIntersectsFeature({queryGeometry:F,feature:Re,featureState:et,geometry:Ie,zoom:this.z,transform:a.transform,pixelsToTileUnits:M,pixelPosMatrix:a.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:a.getElevation}))))}return fe}loadMatchingFeature(a,u,m,y,T,M,R,F,$,H,K){const ne=this.bucketLayerIDs[u];if(M&&!ne.some((ve=>M.has(ve))))return;const oe=this.sourceLayerCoder.decode(m),fe=this.vtLayers[oe].feature(y);if(T.needGeometry){const ve=Xc(fe,!0);if(!T.filter(new qn(this.tileID.overscaledZ),ve,this.tileID.canonical))return}else if(!T.filter(new qn(this.tileID.overscaledZ),fe))return;const ge=this.getId(fe,oe);for(let ve=0;ve<ne.length;ve++){const Pe=ne[ve];if(M&&!M.has(Pe))continue;const Ge=F[Pe];if(!Ge)continue;let Ie={};ge&&H&&(Ie=H.getState(Ge.sourceLayer||dv,ge));const Re=Je({},$[Pe]);Re.paint=iP(Re.paint,Ge.paint,fe,Ie,R),Re.layout=iP(Re.layout,Ge.layout,fe,Ie,R);const Ye=!K||K(fe,Ge,Ie);if(!Ye)continue;const et=new TA(fe,this.z,this.x,this.y,ge);et.layer=Re;let Mt=a[Pe];Mt===void 0&&(Mt=a[Pe]=[]),Mt.push({featureIndex:y,feature:et,intersectionZ:Ye})}}lookupSymbolFeatures(a,u,m,y,T,M,R,F){const $={};this.loadVTLayers();const H=uf(T.filterSpec,T.globalState);for(const K of a)this.loadMatchingFeature($,m,y,K,H,M,R,F,u);return $}hasLayer(a){for(const u of this.bucketLayerIDs)for(const m of u)if(a===m)return!0;return!1}getId(a,u){var m;let y=a.id;return this.promoteId&&(y=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]],typeof y=="boolean"&&(y=Number(y)),y===void 0&&(!((m=a.properties)===null||m===void 0)&&m.cluster)&&this.promoteId&&(y=Number(a.properties.cluster_id))),y}}function iP(h,a,u,m,y){return xt(h,((T,M)=>{const R=a instanceof Sf?a.get(M):null;return R&&R.evaluate?R.evaluate(u,m,y):R}))}function B$(h,a){return a-h}function nP(h,a,u,m,y){const T=[];for(let M=0;M<h.length;M++){const R=h[M];let F;for(let $=0;$<R.length-1;$++){let H=R[$],K=R[$+1];H.x<a&&K.x<a||(H.x<a?H=new d(a,H.y+(a-H.x)/(K.x-H.x)*(K.y-H.y))._round():K.x<a&&(K=new d(a,H.y+(a-H.x)/(K.x-H.x)*(K.y-H.y))._round()),H.y<u&&K.y<u||(H.y<u?H=new d(H.x+(u-H.y)/(K.y-H.y)*(K.x-H.x),u)._round():K.y<u&&(K=new d(H.x+(u-H.y)/(K.y-H.y)*(K.x-H.x),u)._round()),H.x>=m&&K.x>=m||(H.x>=m?H=new d(m,H.y+(m-H.x)/(K.x-H.x)*(K.y-H.y))._round():K.x>=m&&(K=new d(m,H.y+(m-H.x)/(K.x-H.x)*(K.y-H.y))._round()),H.y>=y&&K.y>=y||(H.y>=y?H=new d(H.x+(y-H.y)/(K.y-H.y)*(K.x-H.x),y)._round():K.y>=y&&(K=new d(H.x+(y-H.y)/(K.y-H.y)*(K.x-H.x),y)._round()),F&&H.equals(F[F.length-1])||(F=[H],T.push(F)),F.push(K)))))}}return T}function rP(h,a,u,m,y){switch(a){case 1:return(function(T,M,R,F){const $=[];for(const H of T)for(const K of H){const ne=F===0?K.x:K.y;ne>=M&&ne<=R&&$.push([K])}return $})(h,u,m,y);case 2:return sP(h,u,m,y,!1);case 3:return sP(h,u,m,y,!0)}return[]}function N$(h,a,u,m,y){const T=m===0?$$:V$;let M=[];const R=[];for(let H=0;H<h.length-1;H++){const K=h[H],ne=h[H+1],oe=m===0?K.x:K.y,fe=m===0?ne.x:ne.y;let ge=!1;oe<a?fe>a&&M.push(T(K,ne,a)):oe>u?fe<u&&M.push(T(K,ne,u)):M.push(K),fe<a&&oe>=a&&(M.push(T(K,ne,a)),ge=!0),fe>u&&oe<=u&&(M.push(T(K,ne,u)),ge=!0),!y&&ge&&(R.push(M),M=[])}const F=h.length-1,$=m===0?h[F].x:h[F].y;return $>=a&&$<=u&&M.push(h[F]),y&&M.length>0&&!M[0].equals(M[M.length-1])&&M.push(new d(M[0].x,M[0].y)),M.length>0&&R.push(M),R}function sP(h,a,u,m,y){const T=[];for(const M of h){const R=N$(M,a,u,m,y);R.length>0&&T.push(...R)}return T}function $$(h,a,u){return new d(u,h.y+(u-h.x)/(a.x-h.x)*(a.y-h.y))}function V$(h,a,u){return new d(h.x+(u-h.y)/(a.y-h.y)*(a.x-h.x),u)}mi("FeatureIndex",tP,{omit:["rawTileData","sourceLayerCoder"]});class od extends d{constructor(a,u,m,y){super(a,u),this.angle=m,y!==void 0&&(this.segment=y)}clone(){return new od(this.x,this.y,this.angle,this.segment)}}function oP(h,a,u,m,y){if(a.segment===void 0||u===0)return!0;let T=a,M=a.segment+1,R=0;for(;R>-u/2;){if(M--,M<0)return!1;R-=h[M].dist(T),T=h[M]}R+=h[M].dist(h[M+1]),M++;const F=[];let $=0;for(;R<u/2;){const H=h[M],K=h[M+1];if(!K)return!1;let ne=h[M-1].angleTo(H)-H.angleTo(K);for(ne=Math.abs((ne+3*Math.PI)%(2*Math.PI)-Math.PI),F.push({distance:R,angleDelta:ne}),$+=ne;R-F[0].distance>m;)$-=F.shift().angleDelta;if($>y)return!1;M++,R+=H.dist(K)}return!0}function aP(h){let a=0;for(let u=0;u<h.length-1;u++)a+=h[u].dist(h[u+1]);return a}function lP(h,a,u){return h?.6*a*u:0}function cP(h,a){return Math.max(h?h.right-h.left:0,a?a.right-a.left:0)}function U$(h,a,u,m,y,T){const M=lP(u,y,T),R=cP(u,m)*T;let F=0;const $=aP(h)/2;for(let H=0;H<h.length-1;H++){const K=h[H],ne=h[H+1],oe=K.dist(ne);if(F+oe>$){const fe=($-F)/oe,ge=rr.number(K.x,ne.x,fe),ve=rr.number(K.y,ne.y,fe),Pe=new od(ge,ve,ne.angleTo(K),H);return Pe._round(),!M||oP(h,Pe,R,M,a)?Pe:void 0}F+=oe}}function j$(h,a,u,m,y,T,M,R,F){const $=lP(m,T,M),H=cP(m,y),K=H*M,ne=h[0].x===0||h[0].x===F||h[0].y===0||h[0].y===F;return a-K<a/4&&(a=K+a/4),uP(h,ne?a/2*R%a:(H/2+2*T)*M*R%a,a,$,u,K,ne,!1,F)}function uP(h,a,u,m,y,T,M,R,F){const $=T/2,H=aP(h);let K=0,ne=a-u,oe=[];for(let fe=0;fe<h.length-1;fe++){const ge=h[fe],ve=h[fe+1],Pe=ge.dist(ve),Ge=ve.angleTo(ge);for(;ne+u<K+Pe;){ne+=u;const Ie=(ne-K)/Pe,Re=rr.number(ge.x,ve.x,Ie),Ye=rr.number(ge.y,ve.y,Ie);if(Re>=0&&Re<F&&Ye>=0&&Ye<F&&ne-$>=0&&ne+$<=H){const et=new od(Re,Ye,Ge,fe);et._round(),m&&!oP(h,et,T,m,y)||oe.push(et)}}K+=Pe}return R||oe.length||M||(oe=uP(h,K/2,u,m,y,T,M,!0,F)),oe}function hP(h,a,u,m){const y=[],T=h.image,M=T.pixelRatio,R=T.paddedRect.w-2,F=T.paddedRect.h-2;let $={x1:h.left,y1:h.top,x2:h.right,y2:h.bottom};const H=T.stretchX||[[0,R]],K=T.stretchY||[[0,F]],ne=(It,fi)=>It+fi[1]-fi[0],oe=H.reduce(ne,0),fe=K.reduce(ne,0),ge=R-oe,ve=F-fe;let Pe=0,Ge=oe,Ie=0,Re=fe,Ye=0,et=ge,Mt=0,Ut=ve;if(T.content&&m){const It=T.content,fi=It[2]-It[0],hi=It[3]-It[1];(T.textFitWidth||T.textFitHeight)&&($=oA(h)),Pe=gb(H,0,It[0]),Ie=gb(K,0,It[1]),Ge=gb(H,It[0],It[2]),Re=gb(K,It[1],It[3]),Ye=It[0]-Pe,Mt=It[1]-Ie,et=fi-Ge,Ut=hi-Re}const Ot=$.x1,Zt=$.y1,ni=$.x2-Ot,Yt=$.y2-Zt,$t=(It,fi,hi,_i)=>{const ui=_b(It.stretch-Pe,Ge,ni,Ot),Ci=vb(It.fixed-Ye,et,It.stretch,oe),wn=_b(fi.stretch-Ie,Re,Yt,Zt),un=vb(fi.fixed-Mt,Ut,fi.stretch,fe),wr=_b(hi.stretch-Pe,Ge,ni,Ot),eo=vb(hi.fixed-Ye,et,hi.stretch,oe),ps=_b(_i.stretch-Ie,Re,Yt,Zt),Sr=vb(_i.fixed-Mt,Ut,_i.stretch,fe),mr=new d(ui,wn),In=new d(wr,wn),Nr=new d(wr,ps),Xr=new d(ui,ps),or=new d(Ci/M,un/M),Ho=new d(eo/M,Sr/M),to=a*Math.PI/180;if(to){const ks=Math.sin(to),Rr=Math.cos(to),ms=[Rr,-ks,ks,Rr];mr._matMult(ms),In._matMult(ms),Xr._matMult(ms),Nr._matMult(ms)}const Zo=It.stretch+It.fixed,Sl=fi.stretch+fi.fixed;return{tl:mr,tr:In,bl:Xr,br:Nr,tex:{x:T.paddedRect.x+1+Zo,y:T.paddedRect.y+1+Sl,w:hi.stretch+hi.fixed-Zo,h:_i.stretch+_i.fixed-Sl},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:or,pixelOffsetBR:Ho,minFontScaleX:et/M/ni,minFontScaleY:Ut/M/Yt,isSDF:u}};if(m&&(T.stretchX||T.stretchY)){const It=dP(H,ge,oe),fi=dP(K,ve,fe);for(let hi=0;hi<It.length-1;hi++){const _i=It[hi],ui=It[hi+1];for(let Ci=0;Ci<fi.length-1;Ci++)y.push($t(_i,fi[Ci],ui,fi[Ci+1]))}}else y.push($t({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:R+1},{fixed:0,stretch:F+1}));return y}function gb(h,a,u){let m=0;for(const y of h)m+=Math.max(a,Math.min(u,y[1]))-Math.max(a,Math.min(u,y[0]));return m}function dP(h,a,u){const m=[{fixed:-1,stretch:0}];for(const[y,T]of h){const M=m[m.length-1];m.push({fixed:y-M.stretch,stretch:M.stretch}),m.push({fixed:y-M.stretch,stretch:M.stretch+(T-y)})}return m.push({fixed:a+1,stretch:u}),m}function _b(h,a,u,m){return h/a*u+m}function vb(h,a,u,m){return h-a*u/m}mi("Anchor",od);class yb{constructor(a,u,m,y,T,M,R,F,$,H){var K;if(this.boxStartIndex=a.length,$){let ne=M.top,oe=M.bottom;const fe=M.collisionPadding;fe&&(ne-=fe[1],oe+=fe[3]);let ge=oe-ne;ge>0&&(ge=Math.max(10,ge),this.circleDiameter=ge)}else{const ne=!((K=M.image)===null||K===void 0)&&K.content&&(M.image.textFitWidth||M.image.textFitHeight)?oA(M):{x1:M.left,y1:M.top,x2:M.right,y2:M.bottom};ne.y1=ne.y1*R-F[0],ne.y2=ne.y2*R+F[2],ne.x1=ne.x1*R-F[3],ne.x2=ne.x2*R+F[1];const oe=M.collisionPadding;if(oe&&(ne.x1-=oe[0]*R,ne.y1-=oe[1]*R,ne.x2+=oe[2]*R,ne.y2+=oe[3]*R),H){const fe=new d(ne.x1,ne.y1),ge=new d(ne.x2,ne.y1),ve=new d(ne.x1,ne.y2),Pe=new d(ne.x2,ne.y2),Ge=H*Math.PI/180;fe._rotate(Ge),ge._rotate(Ge),ve._rotate(Ge),Pe._rotate(Ge),ne.x1=Math.min(fe.x,ge.x,ve.x,Pe.x),ne.x2=Math.max(fe.x,ge.x,ve.x,Pe.x),ne.y1=Math.min(fe.y,ge.y,ve.y,Pe.y),ne.y2=Math.max(fe.y,ge.y,ve.y,Pe.y)}a.emplaceBack(u.x,u.y,ne.x1,ne.y1,ne.x2,ne.y2,m,y,T)}this.boxEndIndex=a.length}}class G${constructor(a=[],u=(m,y)=>m<y?-1:m>y?1:0){if(this.data=a,this.length=this.data.length,this.compare=u,this.length>0)for(let m=(this.length>>1)-1;m>=0;m--)this._down(m)}push(a){this.data.push(a),this._up(this.length++)}pop(){if(this.length===0)return;const a=this.data[0],u=this.data.pop();return--this.length>0&&(this.data[0]=u,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:u,compare:m}=this,y=u[a];for(;a>0;){const T=a-1>>1,M=u[T];if(m(y,M)>=0)break;u[a]=M,a=T}u[a]=y}_down(a){const{data:u,compare:m}=this,y=this.length>>1,T=u[a];for(;a<y;){let M=1+(a<<1);const R=M+1;if(R<this.length&&m(u[R],u[M])<0&&(M=R),m(u[M],T)>=0)break;u[a]=u[M],a=M}u[a]=T}}function q$(h,a=1,u=!1){const m=Df.fromPoints(h[0]),y=Math.min(m.width(),m.height());let T=y/2;const M=new G$([],W$),{minX:R,minY:F,maxX:$,maxY:H}=m;if(y===0)return new d(R,F);for(let oe=R;oe<$;oe+=y)for(let fe=F;fe<H;fe+=y)M.push(new Lm(oe+T,fe+T,T,h));let K=(function(oe){let fe=0,ge=0,ve=0;const Pe=oe[0];for(let Ge=0,Ie=Pe.length,Re=Ie-1;Ge<Ie;Re=Ge++){const Ye=Pe[Ge],et=Pe[Re],Mt=Ye.x*et.y-et.x*Ye.y;ge+=(Ye.x+et.x)*Mt,ve+=(Ye.y+et.y)*Mt,fe+=3*Mt}return new Lm(ge/fe,ve/fe,0,oe)})(h),ne=M.length;for(;M.length;){const oe=M.pop();(oe.d>K.d||!K.d)&&(K=oe,u&&console.log("found best %d after %d probes",Math.round(1e4*oe.d)/1e4,ne)),oe.max-K.d<=a||(T=oe.h/2,M.push(new Lm(oe.p.x-T,oe.p.y-T,T,h)),M.push(new Lm(oe.p.x+T,oe.p.y-T,T,h)),M.push(new Lm(oe.p.x-T,oe.p.y+T,T,h)),M.push(new Lm(oe.p.x+T,oe.p.y+T,T,h)),ne+=4)}return u&&(console.log(`num probes: ${ne}`),console.log(`best distance: ${K.d}`)),K.p}function W$(h,a){return a.max-h.max}function Lm(h,a,u,m){this.p=new d(h,a),this.h=u,this.d=(function(y,T){let M=!1,R=1/0;for(let F=0;F<T.length;F++){const $=T[F];for(let H=0,K=$.length,ne=K-1;H<K;ne=H++){const oe=$[H],fe=$[ne];oe.y>y.y!=fe.y>y.y&&y.x<(fe.x-oe.x)*(y.y-oe.y)/(fe.y-oe.y)+oe.x&&(M=!M),R=Math.min(R,_E(y,oe,fe))}}return(M?1:-1)*Math.sqrt(R)})(this.p,m),this.max=this.d+this.h*Math.SQRT2}var Qs;c.aP=void 0,(Qs=c.aP||(c.aP={}))[Qs.center=1]="center",Qs[Qs.left=2]="left",Qs[Qs.right=3]="right",Qs[Qs.top=4]="top",Qs[Qs.bottom=5]="bottom",Qs[Qs["top-left"]=6]="top-left",Qs[Qs["top-right"]=7]="top-right",Qs[Qs["bottom-left"]=8]="bottom-left",Qs[Qs["bottom-right"]=9]="bottom-right";const MS=Number.POSITIVE_INFINITY;function fP(h,a){return a[1]!==MS?(function(u,m,y){let T=0,M=0;switch(m=Math.abs(m),y=Math.abs(y),u){case"top-right":case"top-left":case"top":M=y-7;break;case"bottom-right":case"bottom-left":case"bottom":M=7-y}switch(u){case"top-right":case"bottom-right":case"right":T=-m;break;case"top-left":case"bottom-left":case"left":T=m}return[T,M]})(h,a[0],a[1]):(function(u,m){let y=0,T=0;m<0&&(m=0);const M=m/Math.SQRT2;switch(u){case"top-right":case"top-left":T=M-7;break;case"bottom-right":case"bottom-left":T=7-M;break;case"bottom":T=7-m;break;case"top":T=m-7}switch(u){case"top-right":case"bottom-right":y=-M;break;case"top-left":case"bottom-left":y=M;break;case"left":y=m;break;case"right":y=-m}return[y,T]})(h,a[0])}function pP(h,a,u){var m;const y=h.layout,T=(m=y.get("text-variable-anchor-offset"))===null||m===void 0?void 0:m.evaluate(a,{},u);if(T){const R=T.values,F=[];for(let $=0;$<R.length;$+=2){const H=F[$]=R[$],K=R[$+1].map((ne=>ne*Is));H.startsWith("top")?K[1]-=7:H.startsWith("bottom")&&(K[1]+=7),F[$+1]=K}return new Ms(F)}const M=y.get("text-variable-anchor");if(M){let R;R=h._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[y.get("text-radial-offset").evaluate(a,{},u)*Is,MS]:y.get("text-offset").evaluate(a,{},u).map(($=>$*Is));const F=[];for(const $ of M)F.push($,fP($,R));return new Ms(F)}return null}function CS(h){switch(h){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function H$(h,a,u,m,y,T,M,R,F,$,H,K){let ne=T.textMaxSize.evaluate(a,{});ne===void 0&&(ne=M);const oe=h.layers[0].layout,fe=oe.get("icon-offset").evaluate(a,{},H),ge=gP(u.horizontal),ve=M/24,Pe=h.tilePixelRatio*ve,Ge=h.tilePixelRatio*ne/24,Ie=h.tilePixelRatio*R,Re=h.tilePixelRatio*oe.get("symbol-spacing"),Ye=oe.get("text-padding")*h.tilePixelRatio,et=(function(hi,_i,ui,Ci=1){const wn=hi.get("icon-padding").evaluate(_i,{},ui),un=wn&&wn.values;return[un[0]*Ci,un[1]*Ci,un[2]*Ci,un[3]*Ci]})(oe,a,H,h.tilePixelRatio),Mt=oe.get("text-max-angle")/180*Math.PI,Ut=oe.get("text-rotation-alignment")!=="viewport"&&oe.get("symbol-placement")!=="point",Ot=oe.get("icon-rotation-alignment")==="map"&&oe.get("symbol-placement")!=="point",Zt=oe.get("symbol-placement"),ni=Re/2,Yt=oe.get("icon-text-fit");let $t;m&&Yt!=="none"&&(h.allowVerticalPlacement&&u.vertical&&($t=aA(m,u.vertical,Yt,oe.get("icon-text-fit-padding"),fe,ve)),ge&&(m=aA(m,ge,Yt,oe.get("icon-text-fit-padding"),fe,ve)));const It=H?K.line.getGranularityForZoomLevel(H.z):1,fi=(hi,_i)=>{_i.x<0||_i.x>=Ee||_i.y<0||_i.y>=Ee||(function(ui,Ci,wn,un,wr,eo,ps,Sr,mr,In,Nr,Xr,or,Ho,to,Zo,Sl,ks,Rr,ms,$r,Ds,Yu,hc,mv){const ad=ui.addToLineVertexArray(Ci,wn);let zf,km,Dm,Fm,bP=0,xP=0,wP=0,SP=0,DS=-1,FS=-1;const Ku={};let TP=Zr("");if(ui.allowVerticalPlacement&&un.vertical){const co=Sr.layout.get("text-rotate").evaluate($r,{},hc)+90;Dm=new yb(mr,Ci,In,Nr,Xr,un.vertical,or,Ho,to,co),ps&&(Fm=new yb(mr,Ci,In,Nr,Xr,ps,Sl,ks,to,co))}if(wr){const co=Sr.layout.get("icon-rotate").evaluate($r,{}),ja=Sr.layout.get("icon-text-fit")!=="none",Bf=hP(wr,co,Yu,ja),fc=ps?hP(ps,co,Yu,ja):void 0;km=new yb(mr,Ci,In,Nr,Xr,wr,Sl,ks,!1,co),bP=4*Bf.length;const Nf=ui.iconSizeData;let Yc=null;Nf.kind==="source"?(Yc=[Zu*Sr.layout.get("icon-size").evaluate($r,{})],Yc[0]>nd&&st(`${ui.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Nf.kind==="composite"&&(Yc=[Zu*Ds.compositeIconSizes[0].evaluate($r,{},hc),Zu*Ds.compositeIconSizes[1].evaluate($r,{},hc)],(Yc[0]>nd||Yc[1]>nd)&&st(`${ui.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ui.addSymbols(ui.icon,Bf,Yc,ms,Rr,$r,c.az.none,Ci,ad.lineStartIndex,ad.lineLength,-1,hc),DS=ui.icon.placedSymbolArray.length-1,fc&&(xP=4*fc.length,ui.addSymbols(ui.icon,fc,Yc,ms,Rr,$r,c.az.vertical,Ci,ad.lineStartIndex,ad.lineLength,-1,hc),FS=ui.icon.placedSymbolArray.length-1)}const MP=Object.keys(un.horizontal);for(const co of MP){const ja=un.horizontal[co];if(!zf){TP=Zr(ja.text);const fc=Sr.layout.get("text-rotate").evaluate($r,{},hc);zf=new yb(mr,Ci,In,Nr,Xr,ja,or,Ho,to,fc)}const Bf=ja.positionedLines.length===1;if(wP+=mP(ui,Ci,ja,eo,Sr,to,$r,Zo,ad,un.vertical?c.az.horizontal:c.az.horizontalOnly,Bf?MP:[co],Ku,DS,Ds,hc),Bf)break}un.vertical&&(SP+=mP(ui,Ci,un.vertical,eo,Sr,to,$r,Zo,ad,c.az.vertical,["vertical"],Ku,FS,Ds,hc));const Y$=zf?zf.boxStartIndex:ui.collisionBoxArray.length,K$=zf?zf.boxEndIndex:ui.collisionBoxArray.length,J$=Dm?Dm.boxStartIndex:ui.collisionBoxArray.length,Q$=Dm?Dm.boxEndIndex:ui.collisionBoxArray.length,e5=km?km.boxStartIndex:ui.collisionBoxArray.length,t5=km?km.boxEndIndex:ui.collisionBoxArray.length,i5=Fm?Fm.boxStartIndex:ui.collisionBoxArray.length,n5=Fm?Fm.boxEndIndex:ui.collisionBoxArray.length;let dc=-1;const xb=(co,ja)=>co&&co.circleDiameter?Math.max(co.circleDiameter,ja):ja;dc=xb(zf,dc),dc=xb(Dm,dc),dc=xb(km,dc),dc=xb(Fm,dc);const CP=dc>-1?1:0;CP&&(dc*=mv/Is),ui.glyphOffsetArray.length>=Cm.MAX_GLYPHS&&st("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),$r.sortKey!==void 0&&ui.addToSortKeyRanges(ui.symbolInstances.length,$r.sortKey);const r5=pP(Sr,$r,hc),[s5,o5]=(function(co,ja){const Bf=co.length,fc=ja?.values;if(fc?.length>0)for(let Nf=0;Nf<fc.length;Nf+=2){const Yc=fc[Nf+1];co.emplaceBack(c.aP[fc[Nf]],Yc[0],Yc[1])}return[Bf,co.length]})(ui.textAnchorOffsets,r5);ui.symbolInstances.emplaceBack(Ci.x,Ci.y,Ku.right>=0?Ku.right:-1,Ku.center>=0?Ku.center:-1,Ku.left>=0?Ku.left:-1,Ku.vertical||-1,DS,FS,TP,Y$,K$,J$,Q$,e5,t5,i5,n5,In,wP,SP,bP,xP,CP,0,or,dc,s5,o5)})(h,_i,hi,u,m,y,$t,h.layers[0],h.collisionBoxArray,a.index,a.sourceLayerIndex,h.index,Pe,[Ye,Ye,Ye,Ye],Ut,F,Ie,et,Ot,fe,a,T,$,H,M)};if(Zt==="line")for(const hi of nP(a.geometry,0,0,Ee,Ee)){const _i=kf(hi,It),ui=j$(_i,Re,Mt,u.vertical||ge,m,24,Ge,h.overscaling,Ee);for(const Ci of ui)ge&&Z$(h,ge.text,ni,Ci)||fi(_i,Ci)}else if(Zt==="line-center"){for(const hi of a.geometry)if(hi.length>1){const _i=kf(hi,It),ui=U$(_i,Mt,u.vertical||ge,m,24,Ge);ui&&fi(_i,ui)}}else if(a.type==="Polygon")for(const hi of jh(a.geometry,0)){const _i=q$(hi,16);fi(kf(hi[0],It,!0),new od(_i.x,_i.y,0))}else if(a.type==="LineString")for(const hi of a.geometry){const _i=kf(hi,It);fi(_i,new od(_i[0].x,_i[0].y,0))}else if(a.type==="Point")for(const hi of a.geometry)for(const _i of hi)fi([_i],new od(_i.x,_i.y,0))}function mP(h,a,u,m,y,T,M,R,F,$,H,K,ne,oe,fe){const ge=(function(Ge,Ie,Re,Ye,et,Mt,Ut,Ot){const Zt=Ye.layout.get("text-rotate").evaluate(Mt,{})*Math.PI/180,ni=[];for(const Yt of Ie.positionedLines)for(const $t of Yt.positionedGlyphs){if(!$t.rect)continue;const It=$t.rect||{};let fi=4,hi=!0,_i=1,ui=0;const Ci=(et||Ot)&&$t.vertical,wn=$t.metrics.advance*$t.scale/2;if(Ot&&Ie.verticalizable&&(ui=Yt.lineOffset/2-($t.imageName?-(Is-$t.metrics.width*$t.scale)/2:($t.scale-1)*Is)),$t.imageName){const ks=Ut[$t.imageName];hi=ks.sdf,_i=ks.pixelRatio,fi=1/_i}const un=et?[$t.x+wn,$t.y]:[0,0];let wr=et?[0,0]:[$t.x+wn+Re[0],$t.y+Re[1]-ui],eo=[0,0];Ci&&(eo=wr,wr=[0,0]);const ps=$t.metrics.isDoubleResolution?2:1,Sr=($t.metrics.left-fi)*$t.scale-wn+wr[0],mr=(-$t.metrics.top-fi)*$t.scale+wr[1],In=Sr+It.w/ps*$t.scale/_i,Nr=mr+It.h/ps*$t.scale/_i,Xr=new d(Sr,mr),or=new d(In,mr),Ho=new d(Sr,Nr),to=new d(In,Nr);if(Ci){const ks=new d(-wn,wn- -17),Rr=-Math.PI/2,ms=12-wn,$r=new d(22-ms,-($t.imageName?ms:0)),Ds=new d(...eo);Xr._rotateAround(Rr,ks)._add($r)._add(Ds),or._rotateAround(Rr,ks)._add($r)._add(Ds),Ho._rotateAround(Rr,ks)._add($r)._add(Ds),to._rotateAround(Rr,ks)._add($r)._add(Ds)}if(Zt){const ks=Math.sin(Zt),Rr=Math.cos(Zt),ms=[Rr,-ks,ks,Rr];Xr._matMult(ms),or._matMult(ms),Ho._matMult(ms),to._matMult(ms)}const Zo=new d(0,0),Sl=new d(0,0);ni.push({tl:Xr,tr:or,bl:Ho,br:to,tex:It,writingMode:Ie.writingMode,glyphOffset:un,sectionIndex:$t.sectionIndex,isSDF:hi,pixelOffsetTL:Zo,pixelOffsetBR:Sl,minFontScaleX:0,minFontScaleY:0})}return ni})(0,u,R,y,T,M,m,h.allowVerticalPlacement),ve=h.textSizeData;let Pe=null;ve.kind==="source"?(Pe=[Zu*y.layout.get("text-size").evaluate(M,{})],Pe[0]>nd&&st(`${h.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ve.kind==="composite"&&(Pe=[Zu*oe.compositeTextSizes[0].evaluate(M,{},fe),Zu*oe.compositeTextSizes[1].evaluate(M,{},fe)],(Pe[0]>nd||Pe[1]>nd)&&st(`${h.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),h.addSymbols(h.text,ge,Pe,R,T,M,$,a,F.lineStartIndex,F.lineLength,ne,fe);for(const Ge of H)K[Ge]=h.text.placedSymbolArray.length-1;return 4*ge.length}function gP(h){for(const a in h)return h[a];return null}function Z$(h,a,u,m){const y=h.compareText;if(a in y){const T=y[a];for(let M=T.length-1;M>=0;M--)if(m.dist(T[M])<u)return!0}else y[a]=[];return y[a].push(m),!1}const _P=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class ES{static from(a){if(!(a instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[u,m]=new Uint8Array(a,0,2);if(u!==219)throw new Error("Data does not appear to be in a KDBush format.");const y=m>>4;if(y!==1)throw new Error(`Got v${y} data when expected v1.`);const T=_P[15&m];if(!T)throw new Error("Unrecognized array type.");const[M]=new Uint16Array(a,2,1),[R]=new Uint32Array(a,4,1);return new ES(R,M,T,a)}constructor(a,u=64,m=Float64Array,y){if(isNaN(a)||a<0)throw new Error(`Unpexpected numItems value: ${a}.`);this.numItems=+a,this.nodeSize=Math.min(Math.max(+u,2),65535),this.ArrayType=m,this.IndexArrayType=a<65536?Uint16Array:Uint32Array;const T=_P.indexOf(this.ArrayType),M=2*a*this.ArrayType.BYTES_PER_ELEMENT,R=a*this.IndexArrayType.BYTES_PER_ELEMENT,F=(8-R%8)%8;if(T<0)throw new Error(`Unexpected typed array class: ${m}.`);y&&y instanceof ArrayBuffer?(this.data=y,this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+R+F,2*a),this._pos=2*a,this._finished=!0):(this.data=new ArrayBuffer(8+M+R+F),this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+R+F,2*a),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+T]),new Uint16Array(this.data,2,1)[0]=u,new Uint32Array(this.data,4,1)[0]=a)}add(a,u){const m=this._pos>>1;return this.ids[m]=m,this.coords[this._pos++]=a,this.coords[this._pos++]=u,m}finish(){const a=this._pos>>1;if(a!==this.numItems)throw new Error(`Added ${a} items when expected ${this.numItems}.`);return AS(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(a,u,m,y){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:T,coords:M,nodeSize:R}=this,F=[0,T.length-1,0],$=[];for(;F.length;){const H=F.pop()||0,K=F.pop()||0,ne=F.pop()||0;if(K-ne<=R){for(let ve=ne;ve<=K;ve++){const Pe=M[2*ve],Ge=M[2*ve+1];Pe>=a&&Pe<=m&&Ge>=u&&Ge<=y&&$.push(T[ve])}continue}const oe=ne+K>>1,fe=M[2*oe],ge=M[2*oe+1];fe>=a&&fe<=m&&ge>=u&&ge<=y&&$.push(T[oe]),(H===0?a<=fe:u<=ge)&&(F.push(ne),F.push(oe-1),F.push(1-H)),(H===0?m>=fe:y>=ge)&&(F.push(oe+1),F.push(K),F.push(1-H))}return $}within(a,u,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:T,nodeSize:M}=this,R=[0,y.length-1,0],F=[],$=m*m;for(;R.length;){const H=R.pop()||0,K=R.pop()||0,ne=R.pop()||0;if(K-ne<=M){for(let ve=ne;ve<=K;ve++)yP(T[2*ve],T[2*ve+1],a,u)<=$&&F.push(y[ve]);continue}const oe=ne+K>>1,fe=T[2*oe],ge=T[2*oe+1];yP(fe,ge,a,u)<=$&&F.push(y[oe]),(H===0?a-m<=fe:u-m<=ge)&&(R.push(ne),R.push(oe-1),R.push(1-H)),(H===0?a+m>=fe:u+m>=ge)&&(R.push(oe+1),R.push(K),R.push(1-H))}return F}}function AS(h,a,u,m,y,T){if(y-m<=u)return;const M=m+y>>1;vP(h,a,M,m,y,T),AS(h,a,u,m,M-1,1-T),AS(h,a,u,M+1,y,1-T)}function vP(h,a,u,m,y,T){for(;y>m;){if(y-m>600){const $=y-m+1,H=u-m+1,K=Math.log($),ne=.5*Math.exp(2*K/3),oe=.5*Math.sqrt(K*ne*($-ne)/$)*(H-$/2<0?-1:1);vP(h,a,u,Math.max(m,Math.floor(u-H*ne/$+oe)),Math.min(y,Math.floor(u+($-H)*ne/$+oe)),T)}const M=a[2*u+T];let R=m,F=y;for(fv(h,a,m,u),a[2*y+T]>M&&fv(h,a,m,y);R<F;){for(fv(h,a,R,F),R++,F--;a[2*R+T]<M;)R++;for(;a[2*F+T]>M;)F--}a[2*m+T]===M?fv(h,a,m,F):(F++,fv(h,a,F,y)),F<=u&&(m=F+1),u<=F&&(y=F-1)}}function fv(h,a,u,m){PS(h,u,m),PS(a,2*u,2*m),PS(a,2*u+1,2*m+1)}function PS(h,a,u){const m=h[a];h[a]=h[u],h[u]=m}function yP(h,a,u,m){const y=h-u,T=a-m;return y*y+T*T}var IS;c.cH=void 0,(IS=c.cH||(c.cH={})).create="create",IS.load="load",IS.fullLoad="fullLoad";let bb=null,pv=[];const RS=1e3/60,LS="loadTime",kS="fullLoadTime",X$={mark(h){performance.mark(h)},frame(h){const a=h;bb!=null&&pv.push(a-bb),bb=a},clearMetrics(){bb=null,pv=[],performance.clearMeasures(LS),performance.clearMeasures(kS);for(const h in c.cH)performance.clearMarks(c.cH[h])},getPerformanceMetrics(){performance.measure(LS,c.cH.create,c.cH.load),performance.measure(kS,c.cH.create,c.cH.fullLoad);const h=performance.getEntriesByName(LS)[0].duration,a=performance.getEntriesByName(kS)[0].duration,u=pv.length,m=1/(pv.reduce(((T,M)=>T+M),0)/u/1e3),y=pv.filter((T=>T>RS)).reduce(((T,M)=>T+(M-RS)/RS),0);return{loadTime:h,fullLoadTime:a,fps:m,percentDroppedFrames:y/(u+y)*100,totalFrames:u}}};c.$=L,c.A=D,c.B=Kh,c.C=As,c.D=Mi,c.E=on,c.F=function([h,a,u]){return a+=90,a*=Math.PI/180,u*=Math.PI/180,{x:h*Math.cos(a)*Math.sin(u),y:h*Math.sin(a)*Math.sin(u),z:h*Math.cos(u)}},c.G=rr,c.H=qn,c.I=Q1,c.J=B0,c.K=function(h){if(Ae==null){const a=h.navigator?h.navigator.userAgent:null;Ae=!!h.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return Ae},c.L=class{constructor(h,a){this.target=h,this.mapId=a,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new u$((()=>this.process())),this.subscription=ke(this.target,"message",(u=>this.receive(u)),!1),this.globalScope=gt(self)?h:window}registerMessageHandler(h,a){this.messageHandlers[h]=a}unregisterMessageHandler(h){delete this.messageHandlers[h]}sendAsync(h,a){return new Promise(((u,m)=>{const y=Math.round(1e18*Math.random()).toString(36).substring(0,10),T=a?ke(a.signal,"abort",(()=>{T?.unsubscribe(),delete this.resolveRejects[y];const F={id:y,type:"<cancel>",origin:location.origin,targetMapId:h.targetMapId,sourceMapId:this.mapId};this.target.postMessage(F)}),h$):null;this.resolveRejects[y]={resolve:F=>{T?.unsubscribe(),u(F)},reject:F=>{T?.unsubscribe(),m(F)}};const M=[],R=Object.assign(Object.assign({},h),{id:y,sourceMapId:this.mapId,origin:location.origin,data:yf(h.data,M)});this.target.postMessage(R,{transfer:M})}))}receive(h){const a=h.data,u=a.id;if(!(a.origin!=="file://"&&location.origin!=="file://"&&a.origin!=="resource://android"&&location.origin!=="resource://android"&&a.origin!==location.origin||a.targetMapId&&this.mapId!==a.targetMapId)){if(a.type==="<cancel>"){delete this.tasks[u];const m=this.abortControllers[u];return delete this.abortControllers[u],void(m&&m.abort())}if(gt(self)||a.mustQueue)return this.tasks[u]=a,this.taskQueue.push(u),void this.invoker.trigger();this.processTask(u,a)}}process(){if(this.taskQueue.length===0)return;const h=this.taskQueue.shift(),a=this.tasks[h];delete this.tasks[h],this.taskQueue.length>0&&this.invoker.trigger(),a&&this.processTask(h,a)}processTask(h,a){return s(this,void 0,void 0,(function*(){if(a.type==="<response>"){const y=this.resolveRejects[h];return delete this.resolveRejects[h],y?void(a.error?y.reject(bf(a.error)):y.resolve(bf(a.data))):void 0}if(!this.messageHandlers[a.type])return void this.completeTask(h,new Error(`Could not find a registered handler for ${a.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const u=bf(a.data),m=new AbortController;this.abortControllers[h]=m;try{const y=yield this.messageHandlers[a.type](a.sourceMapId,u,m);this.completeTask(h,null,y)}catch(y){this.completeTask(h,y)}}))}completeTask(h,a,u){const m=[];delete this.abortControllers[h];const y={id:h,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:a?yf(a):null,data:yf(u,m)};this.target.postMessage(y,{transfer:m})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},c.M=pt,c.N=function(){var h=new D(16);return D!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=0,h[12]=0,h[13]=0,h[14]=0),h[0]=1,h[5]=1,h[10]=1,h[15]=1,h},c.O=function(h,a,u){var m,y,T,M,R,F,$,H,K,ne,oe,fe,ge=u[0],ve=u[1],Pe=u[2];return a===h?(h[12]=a[0]*ge+a[4]*ve+a[8]*Pe+a[12],h[13]=a[1]*ge+a[5]*ve+a[9]*Pe+a[13],h[14]=a[2]*ge+a[6]*ve+a[10]*Pe+a[14],h[15]=a[3]*ge+a[7]*ve+a[11]*Pe+a[15]):(y=a[1],T=a[2],M=a[3],R=a[4],F=a[5],$=a[6],H=a[7],K=a[8],ne=a[9],oe=a[10],fe=a[11],h[0]=m=a[0],h[1]=y,h[2]=T,h[3]=M,h[4]=R,h[5]=F,h[6]=$,h[7]=H,h[8]=K,h[9]=ne,h[10]=oe,h[11]=fe,h[12]=m*ge+R*ve+K*Pe+a[12],h[13]=y*ge+F*ve+ne*Pe+a[13],h[14]=T*ge+$*ve+oe*Pe+a[14],h[15]=M*ge+H*ve+fe*Pe+a[15]),h},c.P=d,c.Q=function(h,a,u){var m=u[0],y=u[1],T=u[2];return h[0]=a[0]*m,h[1]=a[1]*m,h[2]=a[2]*m,h[3]=a[3]*m,h[4]=a[4]*y,h[5]=a[5]*y,h[6]=a[6]*y,h[7]=a[7]*y,h[8]=a[8]*T,h[9]=a[9]*T,h[10]=a[10]*T,h[11]=a[11]*T,h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15],h},c.R=Wo,c.S=function(h,a,u){var m=a[0],y=a[1],T=a[2],M=a[3],R=a[4],F=a[5],$=a[6],H=a[7],K=a[8],ne=a[9],oe=a[10],fe=a[11],ge=a[12],ve=a[13],Pe=a[14],Ge=a[15],Ie=u[0],Re=u[1],Ye=u[2],et=u[3];return h[0]=Ie*m+Re*R+Ye*K+et*ge,h[1]=Ie*y+Re*F+Ye*ne+et*ve,h[2]=Ie*T+Re*$+Ye*oe+et*Pe,h[3]=Ie*M+Re*H+Ye*fe+et*Ge,h[4]=(Ie=u[4])*m+(Re=u[5])*R+(Ye=u[6])*K+(et=u[7])*ge,h[5]=Ie*y+Re*F+Ye*ne+et*ve,h[6]=Ie*T+Re*$+Ye*oe+et*Pe,h[7]=Ie*M+Re*H+Ye*fe+et*Ge,h[8]=(Ie=u[8])*m+(Re=u[9])*R+(Ye=u[10])*K+(et=u[11])*ge,h[9]=Ie*y+Re*F+Ye*ne+et*ve,h[10]=Ie*T+Re*$+Ye*oe+et*Pe,h[11]=Ie*M+Re*H+Ye*fe+et*Ge,h[12]=(Ie=u[12])*m+(Re=u[13])*R+(Ye=u[14])*K+(et=u[15])*ge,h[13]=Ie*y+Re*F+Ye*ne+et*ve,h[14]=Ie*T+Re*$+Ye*oe+et*Pe,h[15]=Ie*M+Re*H+Ye*fe+et*Ge,h},c.T=G1,c.U=function(h,a){const u={};for(let m=0;m<a.length;m++){const y=a[m];y in h&&(u[y]=h[y])}return u},c.V=rd,c.W=Be,c.X=gA,c.Y=mA,c.Z=Le,c._=s,c.a=pe,c.a$=j,c.a0=E,c.a1=ye,c.a2=Va,c.a3=vA,c.a4=lb,c.a5=Ee,c.a6=function(h,a,u){if(!h)return a||{};if(!a)return h||{};const m=wA(h),y=wA(a);(function(M,R){R.removeAll&&(M.add.clear(),M.update.clear(),M.remove.clear(),R.remove.clear());for(const F of R.remove)M.add.delete(F),M.update.delete(F);for(const[F,$]of R.update){const H=M.update.get(F);H&&(R.update.set(F,d$(H,$)),M.update.delete(F))}})(m,y);const T={};if((m.removeAll||y.removeAll)&&(T.removeAll=!0),T.remove=new Set([...m.remove,...y.remove]),T.add=new Map([...m.add,...y.add]),T.update=new Map([...m.update,...y.update]),T.remove.size&&T.add.size)for(const M of T.add.keys())T.remove.delete(M);return(function(M){const R={};return M.removeAll&&(R.removeAll=M.removeAll),M.remove&&(R.remove=Array.from(M.remove)),M.add&&(R.add=Array.from(M.add.values())),M.update&&(R.update=Array.from(M.update.values())),R})(T)},c.a7=function(h,a){const u=new Map;if(h==null||h.type==null)return u;if(h.type==="Feature"){const m=lS(h,a);return m==null?void 0:(u.set(m,h),u)}if(h.type==="FeatureCollection"){const m=new Set;for(const y of h.features){const T=lS(y,a);if(T==null||m.has(T))return;m.add(T),u.set(T,y)}return u}},c.a8=function(h,a,u){var m,y;const T=[];if(a.removeAll)h.clear();else if(a.remove)for(const M of a.remove){const R=h.get(M);R&&(T.push(R.geometry),h.delete(M))}if(a.add)for(const M of a.add){const R=lS(M,u);if(R==null)continue;const F=h.get(R);F&&T.push(F.geometry),T.push(M.geometry),h.set(R,M)}if(a.update)for(const M of a.update){const R=h.get(M.id);if(!R)continue;const F=!!M.newGeometry,$=M.removeAllProperties||((m=M.removeProperties)===null||m===void 0?void 0:m.length)>0||((y=M.addOrUpdateProperties)===null||y===void 0?void 0:y.length)>0;if(!F&&!$)continue;T.push(R.geometry);const H=Object.assign({},R);if(h.set(M.id,H),F&&(T.push(M.newGeometry),H.geometry=M.newGeometry),$){if(H.properties=M.removeAllProperties?{}:Object.assign({},H.properties||{}),M.removeProperties)for(const K of M.removeProperties)delete H.properties[K];if(M.addOrUpdateProperties)for(const{key:K,value:ne}of M.addOrUpdateProperties)H.properties[K]=ne}}return T},c.a9=cv,c.aA=function(h,{uSize:a,uSizeT:u},{lowerSize:m,upperSize:y}){return h.kind==="source"?m/Zu:h.kind==="composite"?rr.number(m/Zu,y/Zu,u):a},c.aB=function(h,a){var u=a[0],m=a[1],y=a[2],T=a[3],M=a[4],R=a[5],F=a[6],$=a[7],H=a[8],K=a[9],ne=a[10],oe=a[11],fe=a[12],ge=a[13],ve=a[14],Pe=a[15],Ge=u*R-m*M,Ie=u*F-y*M,Re=u*$-T*M,Ye=m*F-y*R,et=m*$-T*R,Mt=y*$-T*F,Ut=H*ge-K*fe,Ot=H*ve-ne*fe,Zt=H*Pe-oe*fe,ni=K*ve-ne*ge,Yt=K*Pe-oe*ge,$t=ne*Pe-oe*ve,It=Ge*$t-Ie*Yt+Re*ni+Ye*Zt-et*Ot+Mt*Ut;return It?(h[0]=(R*$t-F*Yt+$*ni)*(It=1/It),h[1]=(y*Yt-m*$t-T*ni)*It,h[2]=(ge*Mt-ve*et+Pe*Ye)*It,h[3]=(ne*et-K*Mt-oe*Ye)*It,h[4]=(F*Zt-M*$t-$*Ot)*It,h[5]=(u*$t-y*Zt+T*Ot)*It,h[6]=(ve*Re-fe*Mt-Pe*Ie)*It,h[7]=(H*Mt-ne*Re+oe*Ie)*It,h[8]=(M*Yt-R*Zt+$*Ut)*It,h[9]=(m*Zt-u*Yt-T*Ut)*It,h[10]=(fe*et-ge*Re+Pe*Ge)*It,h[11]=(K*Re-H*et-oe*Ge)*It,h[12]=(R*Ot-M*ni-F*Ut)*It,h[13]=(u*ni-m*Ot+y*Ut)*It,h[14]=(ge*Ie-fe*Ye-ve*Ge)*It,h[15]=(H*Ye-K*Ie+ne*Ge)*It,h):null},c.aC=ce,c.aD=function(h){var a=h[0],u=h[1];return Math.sqrt(a*a+u*u)},c.aE=function(h){return h[0]=0,h[1]=0,h},c.aF=function(h,a,u){return h[0]=a[0]*u,h[1]=a[1]*u,h},c.aG=iS,c.aH=re,c.aI=function(h,a,u,m){const y=a.y-h.y,T=a.x-h.x,M=m.y-u.y,R=m.x-u.x,F=M*T-R*y;if(F===0)return null;const $=(R*(h.y-u.y)-M*(h.x-u.x))/F;return new d(h.x+$*T,h.y+$*y)},c.aJ=nP,c.aK=vm,c.aL=function(h){let a=1/0,u=1/0,m=-1/0,y=-1/0;for(const T of h)a=Math.min(a,T.x),u=Math.min(u,T.y),m=Math.max(m,T.x),y=Math.max(y,T.y);return[a,u,m,y]},c.aM=Is,c.aN=$e,c.aO=function(h,a,u,m,y=!1){if(!u[0]&&!u[1])return[0,0];const T=y?m==="map"?-h.bearingInRadians:0:m==="viewport"?h.bearingInRadians:0;if(T){const M=Math.sin(T),R=Math.cos(T);u=[u[0]*R-u[1]*M,u[0]*M+u[1]*R]}return[y?u[0]:$e(a,u[0],h.zoom),y?u[1]:$e(a,u[1],h.zoom)]},c.aQ=tS,c.aR=CS,c.aS=eS,c.aT=ES,c.aU=Hr,c.aV=ib,c.aW=Fe,c.aX=si,c.aY=Pt,c.aZ=yt,c.a_=yA,c.aa=Df,c.ab=25,c.ac=aS,c.ad=h=>{const a=window.document.createElement("video");return a.muted=!0,new Promise((u=>{a.onloadstart=()=>{u(a)};for(const m of h){const y=window.document.createElement("source");Bt(m)||(a.crossOrigin="Anonymous"),y.src=m,a.appendChild(y)}}))},c.ae=lt,c.af=function(){return ct++},c.ag=w,c.ah=Cm,c.ai=dv,c.aj=uf,c.ak=Xc,c.al=TA,c.am=function(h){const a={};if(h.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((u,m,y,T)=>{const M=y||T;return a[m]=!M||M.toLowerCase(),""})),a["max-age"]){const u=parseInt(a["max-age"],10);isNaN(u)?delete a["max-age"]:a["max-age"]=u}return a},c.an=xe,c.ao=85.051129,c.ap=Ze,c.aq=function(h){return Math.pow(2,h)},c.ar=U,c.as=_A,c.at=function(h){return Math.log(h)/Math.LN2},c.au=function(h){var a=h[0],u=h[1];return a*a+u*u},c.av=function(h){if(!h.length)return new Set;const a=Math.max(...h.map((F=>F.canonical.z)));let u=1/0,m=-1/0,y=1/0,T=-1/0;const M=[];for(const F of h){const{x:$,y:H,z:K}=F.canonical,ne=Math.pow(2,a-K),oe=$*ne,fe=H*ne;M.push({id:F,x:oe,y:fe}),oe<u&&(u=oe),oe>m&&(m=oe),fe<y&&(y=fe),fe>T&&(T=fe)}const R=new Set;for(const F of M)F.x!==u&&F.x!==m&&F.y!==y&&F.y!==T||R.add(F.id);return R},c.aw=function(h,a){const u=Math.abs(2*h.wrap)-+(h.wrap<0),m=Math.abs(2*a.wrap)-+(a.wrap<0);return h.overscaledZ-a.overscaledZ||m-u||a.canonical.y-h.canonical.y||a.canonical.x-h.canonical.x},c.ax=class{constructor(h,a){this.max=h,this.onRemove=a,this.reset()}reset(){for(const h in this.data)for(const a of this.data[h])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(h,a,u){const m=h.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const y={value:a,timeout:void 0};if(u!==void 0&&(y.timeout=setTimeout((()=>{this.remove(h,y)}),u)),this.data[m].push(y),this.order.push(m),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(h){return h.wrapped().key in this.data}getAndRemove(h){return this.has(h)?this._getAndRemoveByKey(h.wrapped().key):null}_getAndRemoveByKey(h){const a=this.data[h].shift();return a.timeout&&clearTimeout(a.timeout),this.data[h].length===0&&delete this.data[h],this.order.splice(this.order.indexOf(h),1),a.value}getByKey(h){const a=this.data[h];return a?a[0].value:null}get(h){return this.has(h)?this.data[h.wrapped().key][0].value:null}remove(h,a){if(!this.has(h))return this;const u=h.wrapped().key,m=a===void 0?0:this.data[u].indexOf(a),y=this.data[u][m];return this.data[u].splice(m,1),y.timeout&&clearTimeout(y.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(y.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(h){for(this.max=h;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(h){const a=[];for(const u in this.data)for(const m of this.data[u])h(m.value)||a.push(m);for(const u of a)this.remove(u.value.tileID,u)}},c.ay=function(h,a){let u=0,m=0;if(h.kind==="constant")m=h.layoutSize;else if(h.kind!=="source"){const{interpolationType:y,minZoom:T,maxZoom:M}=h,R=y?xe(vr.interpolationFactor(y,a,T,M),0,1):0;h.kind==="camera"?m=rr.number(h.minSize,h.maxSize,R):u=R}return{uSizeT:u,uSize:m}},c.b=we,c.b$=Wu,c.b0=V,c.b1=function(h){var a=new D(3);return a[0]=h[0],a[1]=h[1],a[2]=h[2],a},c.b2=function(h,a,u){return h[0]=a[0]-u[0],h[1]=a[1]-u[1],h[2]=a[2]-u[2],h},c.b3=function(h,a){var u=a[0],m=a[1],y=a[2],T=u*u+m*m+y*y;return T>0&&(T=1/Math.sqrt(T)),h[0]=a[0]*T,h[1]=a[1]*T,h[2]=a[2]*T,h},c.b4=z,c.b5=function(h,a){return h[0]*a[0]+h[1]*a[1]+h[2]*a[2]},c.b6=function(h,a,u){return h[0]=a[0]*u[0],h[1]=a[1]*u[1],h[2]=a[2]*u[2],h[3]=a[3]*u[3],h},c.b7=G,c.b8=function(h,a,u){const m=a[0]*u[0]+a[1]*u[1]+a[2]*u[2];return m===0?null:(-(h[0]*u[0]+h[1]*u[1]+h[2]*u[2])-u[3])/m},c.b9=X,c.bA=function(h,a,u,m){return h[0]=a[0]+u[0]*m,h[1]=a[1]+u[1]*m,h[2]=a[2]+u[2]*m,h},c.bB=le,c.bC=function(h,a,u){var m=u[0],y=u[1],T=u[2],M=u[3],R=a[0],F=a[1],$=a[2],H=y*$-T*F,K=T*R-m*$,ne=m*F-y*R;return h[0]=R+M*(H+=H)+y*(ne+=ne)-T*(K+=K),h[1]=F+M*K+T*H-m*ne,h[2]=$+M*ne+m*K-y*H,h},c.bD=function(h,a,u){const m=(function(F){var $=F[3],H=F[4],K=F[5],ne=F[6],oe=F[7],fe=F[8];return F[0]*(fe*H-K*oe)+F[1]*(-fe*$+K*ne)+F[2]*(oe*$-H*ne)})([h[0],h[1],h[2],a[0],a[1],a[2],u[0],u[1],u[2]]);if(m===0)return null;const y=z([],[a[0],a[1],a[2]],[u[0],u[1],u[2]]),T=z([],[u[0],u[1],u[2]],[h[0],h[1],h[2]]),M=z([],[h[0],h[1],h[2]],[a[0],a[1],a[2]]),R=j([],y,-h[3]);return V(R,R,j([],T,-a[3])),V(R,R,j([],M,-u[3])),j(R,R,1/m),R},c.bE=oS,c.bF=function(){return new Float64Array(4)},c.bG=function(h,a,u,m){var y=[],T=[];return y[0]=a[0]-u[0],y[1]=a[1]-u[1],y[2]=a[2]-u[2],T[0]=y[0]*Math.cos(m)-y[1]*Math.sin(m),T[1]=y[0]*Math.sin(m)+y[1]*Math.cos(m),T[2]=y[2],h[0]=T[0]+u[0],h[1]=T[1]+u[1],h[2]=T[2]+u[2],h},c.bH=function(h,a,u,m){var y=[],T=[];return y[0]=a[0]-u[0],y[1]=a[1]-u[1],y[2]=a[2]-u[2],T[0]=y[0],T[1]=y[1]*Math.cos(m)-y[2]*Math.sin(m),T[2]=y[1]*Math.sin(m)+y[2]*Math.cos(m),h[0]=T[0]+u[0],h[1]=T[1]+u[1],h[2]=T[2]+u[2],h},c.bI=function(h,a,u,m){var y=[],T=[];return y[0]=a[0]-u[0],y[1]=a[1]-u[1],y[2]=a[2]-u[2],T[0]=y[2]*Math.sin(m)+y[0]*Math.cos(m),T[1]=y[1],T[2]=y[2]*Math.cos(m)-y[0]*Math.sin(m),h[0]=T[0]+u[0],h[1]=T[1]+u[1],h[2]=T[2]+u[2],h},c.bJ=function(h,a,u){var m=Math.sin(u),y=Math.cos(u),T=a[0],M=a[1],R=a[2],F=a[3],$=a[8],H=a[9],K=a[10],ne=a[11];return a!==h&&(h[4]=a[4],h[5]=a[5],h[6]=a[6],h[7]=a[7],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]),h[0]=T*y-$*m,h[1]=M*y-H*m,h[2]=R*y-K*m,h[3]=F*y-ne*m,h[8]=T*m+$*y,h[9]=M*m+H*y,h[10]=R*m+K*y,h[11]=F*m+ne*y,h},c.bK=function(h,a){const u=Ve(h,360),m=Ve(a,360),y=m-u,T=m>u?y-360:y+360;return Math.abs(y)<Math.abs(T)?y:T},c.bL=function(h){return h[0]=0,h[1]=0,h[2]=0,h},c.bM=function(h,a,u,m){const y=Math.sqrt(h*h+a*a),T=Math.sqrt(u*u+m*m);h/=y,a/=y,u/=T,m/=T;const M=Math.acos(h*u+a*m);return-a*u+h*m>0?M:-M},c.bN=function(h,a){const u=Ve(h,2*Math.PI),m=Ve(a,2*Math.PI);return Math.min(Math.abs(u-m),Math.abs(u-m+2*Math.PI),Math.abs(u-m-2*Math.PI))},c.bO=function(){const h={},a=Tt.$version;for(const u in Tt.$root){const m=Tt.$root[u];if(m.required){let y=null;y=u==="version"?a:m.type==="array"?[]:{},y!=null&&(h[u]=y)}}return h},c.bP=St,c.bQ=O_,c.bR=function h(a,u){if(Array.isArray(a)){if(!Array.isArray(u)||a.length!==u.length)return!1;for(let m=0;m<a.length;m++)if(!h(a[m],u[m]))return!1;return!0}if(typeof a=="object"&&a!==null&&u!==null){if(typeof u!="object"||Object.keys(a).length!==Object.keys(u).length)return!1;for(const m in a)if(!h(a[m],u[m]))return!1;return!0}return a===u},c.bS=function(h){h=h.slice();const a=Object.create(null);for(let u=0;u<h.length;u++)a[h[u].id]=h[u];for(let u=0;u<h.length;u++)"ref"in h[u]&&(h[u]=Er(h[u],a[h[u].ref]));return h},c.bT=function(h,a){if(h.type==="custom")return new c$(h,a);switch(h.type){case"background":return new l$(h,a);case"circle":return new WN(h,a);case"color-relief":return new JN(h,a);case"fill":return new f4(h,a);case"fill-extrusion":return new M4(h,a);case"heatmap":return new ZN(h,a);case"hillshade":return new YN(h,a);case"line":return new L4(h,a);case"raster":return new F1(h,a);case"symbol":return new ab(h,a)}},c.bU=h=>h.type==="raster",c.bV=me,c.bW=function(h,a){if(!h)return[{command:"setStyle",args:[a]}];let u=[];try{if(!Di(h.version,a.version))return[{command:"setStyle",args:[a]}];Di(h.center,a.center)||u.push({command:"setCenter",args:[a.center]}),Di(h.state,a.state)||u.push({command:"setGlobalState",args:[a.state]}),Di(h.centerAltitude,a.centerAltitude)||u.push({command:"setCenterAltitude",args:[a.centerAltitude]}),Di(h.zoom,a.zoom)||u.push({command:"setZoom",args:[a.zoom]}),Di(h.bearing,a.bearing)||u.push({command:"setBearing",args:[a.bearing]}),Di(h.pitch,a.pitch)||u.push({command:"setPitch",args:[a.pitch]}),Di(h.roll,a.roll)||u.push({command:"setRoll",args:[a.roll]}),Di(h.sprite,a.sprite)||u.push({command:"setSprite",args:[a.sprite]}),Di(h.glyphs,a.glyphs)||u.push({command:"setGlyphs",args:[a.glyphs]}),Di(h.transition,a.transition)||u.push({command:"setTransition",args:[a.transition]}),Di(h.light,a.light)||u.push({command:"setLight",args:[a.light]}),Di(h.terrain,a.terrain)||u.push({command:"setTerrain",args:[a.terrain]}),Di(h.sky,a.sky)||u.push({command:"setSky",args:[a.sky]}),Di(h.projection,a.projection)||u.push({command:"setProjection",args:[a.projection]});const m={},y=[];(function(M,R,F,$){let H;for(H in R=R||{},M=M||{})Object.prototype.hasOwnProperty.call(M,H)&&(Object.prototype.hasOwnProperty.call(R,H)||Cn(H,F,$));for(H in R)Object.prototype.hasOwnProperty.call(R,H)&&(Object.prototype.hasOwnProperty.call(M,H)?Di(M[H],R[H])||(M[H].type==="geojson"&&R[H].type==="geojson"&&En(M,R,H)?yn(F,{command:"setGeoJSONSourceData",args:[H,R[H].data]}):Un(H,R,F,$)):Yn(H,R,F))})(h.sources,a.sources,y,m);const T=[];h.layers&&h.layers.forEach((M=>{"source"in M&&m[M.source]?u.push({command:"removeLayer",args:[M.id]}):T.push(M)})),u=u.concat(y),(function(M,R,F){R=R||[];const $=(M=M||[]).map(Xe),H=R.map(Xe),K=M.reduce(kt,{}),ne=R.reduce(kt,{}),oe=$.slice(),fe=Object.create(null);let ge,ve,Pe,Ge,Ie;for(let Re=0,Ye=0;Re<$.length;Re++)ge=$[Re],Object.prototype.hasOwnProperty.call(ne,ge)?Ye++:(yn(F,{command:"removeLayer",args:[ge]}),oe.splice(oe.indexOf(ge,Ye),1));for(let Re=0,Ye=0;Re<H.length;Re++)ge=H[H.length-1-Re],oe[oe.length-1-Re]!==ge&&(Object.prototype.hasOwnProperty.call(K,ge)?(yn(F,{command:"removeLayer",args:[ge]}),oe.splice(oe.lastIndexOf(ge,oe.length-Ye),1)):Ye++,Ge=oe[oe.length-Re],yn(F,{command:"addLayer",args:[ne[ge],Ge]}),oe.splice(oe.length-Re,0,ge),fe[ge]=!0);for(let Re=0;Re<H.length;Re++)if(ge=H[Re],ve=K[ge],Pe=ne[ge],!fe[ge]&&!Di(ve,Pe))if(Di(ve.source,Pe.source)&&Di(ve["source-layer"],Pe["source-layer"])&&Di(ve.type,Pe.type)){for(Ie in dr(ve.layout,Pe.layout,F,ge,null,"setLayoutProperty"),dr(ve.paint,Pe.paint,F,ge,null,"setPaintProperty"),Di(ve.filter,Pe.filter)||yn(F,{command:"setFilter",args:[ge,Pe.filter]}),Di(ve.minzoom,Pe.minzoom)&&Di(ve.maxzoom,Pe.maxzoom)||yn(F,{command:"setLayerZoomRange",args:[ge,Pe.minzoom,Pe.maxzoom]}),ve)Object.prototype.hasOwnProperty.call(ve,Ie)&&Ie!=="layout"&&Ie!=="paint"&&Ie!=="filter"&&Ie!=="metadata"&&Ie!=="minzoom"&&Ie!=="maxzoom"&&(Ie.indexOf("paint.")===0?dr(ve[Ie],Pe[Ie],F,ge,Ie.slice(6),"setPaintProperty"):Di(ve[Ie],Pe[Ie])||yn(F,{command:"setLayerProperty",args:[ge,Ie,Pe[Ie]]}));for(Ie in Pe)Object.prototype.hasOwnProperty.call(Pe,Ie)&&!Object.prototype.hasOwnProperty.call(ve,Ie)&&Ie!=="layout"&&Ie!=="paint"&&Ie!=="filter"&&Ie!=="metadata"&&Ie!=="minzoom"&&Ie!=="maxzoom"&&(Ie.indexOf("paint.")===0?dr(ve[Ie],Pe[Ie],F,ge,Ie.slice(6),"setPaintProperty"):Di(ve[Ie],Pe[Ie])||yn(F,{command:"setLayerProperty",args:[ge,Ie,Pe[Ie]]}))}else yn(F,{command:"removeLayer",args:[ge]}),Ge=oe[oe.lastIndexOf(ge)+1],yn(F,{command:"addLayer",args:[Pe,Ge]})})(T,a.layers,u)}catch(m){console.warn("Unable to compute style diff:",m),u=[{command:"setStyle",args:[a]}]}return u},c.bX=function(h){const a=[],u=h.id;return u===void 0&&a.push({message:`layers.${u}: missing required property "id"`}),h.render===void 0&&a.push({message:`layers.${u}: missing required method "render"`}),h.renderingMode&&h.renderingMode!=="2d"&&h.renderingMode!=="3d"&&a.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),a},c.bY=xt,c.bZ=Se,c.b_=class extends So{constructor(h,a){super(h,a),this.current=0}set(h){this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))}},c.ba=function(h,a,u){return h[0]=a[0]*u,h[1]=a[1]*u,h[2]=a[2]*u,h[3]=a[3]*u,h},c.bb=function(h,a){return h[0]*a[0]+h[1]*a[1]+h[2]*a[2]+h[3]},c.bc=xA,c.bd=Em,c.be=function(h,a,u,m,y){var T=1/Math.tan(a/2);if(h[0]=T/u,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=T,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=-1,h[12]=0,h[13]=0,h[15]=0,y!=null&&y!==1/0){var M=1/(m-y);h[10]=(y+m)*M,h[14]=2*y*m*M}else h[10]=-1,h[14]=-2*m;return h},c.bf=function(h){var a=new D(16);return a[0]=h[0],a[1]=h[1],a[2]=h[2],a[3]=h[3],a[4]=h[4],a[5]=h[5],a[6]=h[6],a[7]=h[7],a[8]=h[8],a[9]=h[9],a[10]=h[10],a[11]=h[11],a[12]=h[12],a[13]=h[13],a[14]=h[14],a[15]=h[15],a},c.bg=function(h,a,u){var m=Math.sin(u),y=Math.cos(u),T=a[0],M=a[1],R=a[2],F=a[3],$=a[4],H=a[5],K=a[6],ne=a[7];return a!==h&&(h[8]=a[8],h[9]=a[9],h[10]=a[10],h[11]=a[11],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]),h[0]=T*y+$*m,h[1]=M*y+H*m,h[2]=R*y+K*m,h[3]=F*y+ne*m,h[4]=$*y-T*m,h[5]=H*y-M*m,h[6]=K*y-R*m,h[7]=ne*y-F*m,h},c.bh=function(h,a,u){var m=Math.sin(u),y=Math.cos(u),T=a[4],M=a[5],R=a[6],F=a[7],$=a[8],H=a[9],K=a[10],ne=a[11];return a!==h&&(h[0]=a[0],h[1]=a[1],h[2]=a[2],h[3]=a[3],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]),h[4]=T*y+$*m,h[5]=M*y+H*m,h[6]=R*y+K*m,h[7]=F*y+ne*m,h[8]=$*y-T*m,h[9]=H*y-M*m,h[10]=K*y-R*m,h[11]=ne*y-F*m,h},c.bi=function(){const h=new Float32Array(16);return U(h),h},c.bj=function(){const h=new Float64Array(16);return U(h),h},c.bk=function(){return new Float64Array(16)},c.bl=function(h,a,u){const m=new Float64Array(4);return le(m,h,a-90,u),m},c.bm=function(h,a,u,m){var y,T,M,R,F,$=a[0],H=a[1],K=a[2],ne=a[3],oe=u[0],fe=u[1],ge=u[2],ve=u[3];return(T=$*oe+H*fe+K*ge+ne*ve)<0&&(T=-T,oe=-oe,fe=-fe,ge=-ge,ve=-ve),1-T>C?(y=Math.acos(T),M=Math.sin(y),R=Math.sin((1-m)*y)/M,F=Math.sin(m*y)/M):(R=1-m,F=m),h[0]=R*$+F*oe,h[1]=R*H+F*fe,h[2]=R*K+F*ge,h[3]=R*ne+F*ve,h},c.bn=function(h){const a=new Float64Array(9);(function(T,M){var R=M[0],F=M[1],$=M[2],H=M[3],K=R+R,ne=F+F,oe=$+$,fe=R*K,ge=F*K,ve=F*ne,Pe=$*K,Ge=$*ne,Ie=$*oe,Re=H*K,Ye=H*ne,et=H*oe;T[0]=1-ve-Ie,T[3]=ge-et,T[6]=Pe+Ye,T[1]=ge+et,T[4]=1-fe-Ie,T[7]=Ge-Re,T[2]=Pe-Ye,T[5]=Ge+Re,T[8]=1-fe-ve})(a,h);const u=yt(-Math.asin(xe(a[2],-1,1)));let m,y;return Math.hypot(a[5],a[8])<.001?(m=0,y=-yt(Math.atan2(a[3],a[4]))):(m=yt(a[5]===0&&a[8]===0?0:Math.atan2(a[5],a[8])),y=yt(a[1]===0&&a[0]===0?0:Math.atan2(a[1],a[0]))),{roll:m,pitch:u+90,bearing:y}},c.bo=function(h,a){return h.roll==a.roll&&h.pitch==a.pitch&&h.bearing==a.bearing},c.bp=rn,c.bq=qu,c.br=Sm,c.bs=nv,c.bt=wm,c.bu=nt,c.bv=He,c.bw=$s,c.bx=function(h,a,u,m,y){return nt(m,y,xe((h-a)/(u-a),0,1))},c.by=Ve,c.bz=function(){return new Float64Array(3)},c.c=Oe,c.c$=function(h,a,u,m,y){return s(this,void 0,void 0,(function*(){if(E())try{return yield ye(h,a,u,m,y)}catch{}return(function(T,M,R,F,$){const H=T.width,K=T.height;ie&&ae||(ie=new OffscreenCanvas(H,K),ae=ie.getContext("2d",{willReadFrequently:!0})),ie.width=H,ie.height=K,ae.drawImage(T,0,0,H,K);const ne=ae.getImageData(M,R,F,$);return ae.clearRect(0,0,H,K),ne.data})(h,a,u,m,y)}))},c.c0=class extends So{constructor(h,a){super(h,a),this.current=da}set(h){if(h[12]!==this.current[12]||h[0]!==this.current[0])return this.current=h,void this.gl.uniformMatrix4fv(this.location,!1,h);for(let a=1;a<16;a++)if(h[a]!==this.current[a]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}}},c.c1=Rf,c.c2=class extends So{constructor(h,a){super(h,a),this.current=[0,0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]||(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2]))}},c.c3=class extends So{constructor(h,a){super(h,a),this.current=[0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]||(this.current=h,this.gl.uniform2f(this.location,h[0],h[1]))}},c.c4=O,c.c5=function(h,a){var u=Math.sin(a),m=Math.cos(a);return h[0]=m,h[1]=u,h[2]=0,h[3]=-u,h[4]=m,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},c.c6=function(h,a,u){var m=a[0],y=a[1],T=a[2];return h[0]=m*u[0]+y*u[3]+T*u[6],h[1]=m*u[1]+y*u[4]+T*u[7],h[2]=m*u[2]+y*u[5]+T*u[8],h},c.c7=function(h,a,u,m,y,T,M){var R=1/(a-u),F=1/(m-y),$=1/(T-M);return h[0]=-2*R,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=-2*F,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=2*$,h[11]=0,h[12]=(a+u)*R,h[13]=(y+m)*F,h[14]=(M+T)*$,h[15]=1,h},c.c8=class extends So{constructor(h,a){super(h,a),this.current=new Array}set(h){if(h!=this.current){this.current=h;const a=new Float32Array(4*h.length);for(let u=0;u<h.length;u++)a[4*u]=h[u].r,a[4*u+1]=h[u].g,a[4*u+2]=h[u].b,a[4*u+3]=h[u].a;this.gl.uniform4fv(this.location,a)}}},c.c9=class extends So{constructor(h,a){super(h,a),this.current=new Array}set(h){if(h!=this.current){this.current=h;const a=new Float32Array(h);this.gl.uniform1fv(this.location,a)}}},c.cA=function(h,a){return Me[a]&&"touches"in h},c.cB=function(h){return Me[h]||ee[h]},c.cC=function(h,a,u){var m=a[0],y=a[1];return h[0]=u[0]*m+u[4]*y+u[12],h[1]=u[1]*m+u[5]*y+u[13],h},c.cD=function(h,a){const{x:u,y:m}=cv.fromLngLat(a);return!(h<0||h>25||m<0||m>=1||u<0||u>=1)},c.cE=function(h,a){return h[0]=a[0],h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=a[1],h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=a[2],h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h},c.cF=class extends hm{},c.cG=X$,c.cI=rt,c.cJ=function(h,a){Oe.REGISTERED_PROTOCOLS[h]=a},c.cK=function(h){delete Oe.REGISTERED_PROTOCOLS[h]},c.cL=function(h,a){const u={};for(let y=0;y<h.length;y++){const T=a&&a[h[y].id]||E0(h[y]);a&&(a[h[y].id]=T);let M=u[T];M||(M=u[T]=[]),M.push(h[y])}const m=[];for(const y in u)m.push(u[y]);return m},c.cM=mi,c.cN=SA,c.cO=tP,c.cP=rA,c.cQ=function(h){h.bucket.createArrays(),h.bucket.tilePixelRatio=Ee/(512*h.bucket.overscaling),h.bucket.compareText={},h.bucket.iconsNeedLinear=!1;const a=h.bucket.layers[0],u=a.layout,m=a._unevaluatedLayout._values,y={layoutIconSize:m["icon-size"].possiblyEvaluate(new qn(h.bucket.zoom+1),h.canonical),layoutTextSize:m["text-size"].possiblyEvaluate(new qn(h.bucket.zoom+1),h.canonical),textMaxSize:m["text-size"].possiblyEvaluate(new qn(18))};if(h.bucket.textSizeData.kind==="composite"){const{minZoom:$,maxZoom:H}=h.bucket.textSizeData;y.compositeTextSizes=[m["text-size"].possiblyEvaluate(new qn($),h.canonical),m["text-size"].possiblyEvaluate(new qn(H),h.canonical)]}if(h.bucket.iconSizeData.kind==="composite"){const{minZoom:$,maxZoom:H}=h.bucket.iconSizeData;y.compositeIconSizes=[m["icon-size"].possiblyEvaluate(new qn($),h.canonical),m["icon-size"].possiblyEvaluate(new qn(H),h.canonical)]}const T=u.get("text-line-height")*Is,M=u.get("text-rotation-alignment")!=="viewport"&&u.get("symbol-placement")!=="point",R=u.get("text-keep-upright"),F=u.get("text-size");for(const $ of h.bucket.features){const H=u.get("text-font").evaluate($,{},h.canonical).join(","),K=F.evaluate($,{},h.canonical),ne=y.layoutTextSize.evaluate($,{},h.canonical),oe=y.layoutIconSize.evaluate($,{},h.canonical),fe={horizontal:{},vertical:void 0},ge=$.text;let ve,Pe=[0,0];if(ge){const Re=ge.toString(),Ye=u.get("text-letter-spacing").evaluate($,{},h.canonical)*Is,et=k1(Re)?Ye:0,Mt=u.get("text-anchor").evaluate($,{},h.canonical),Ut=pP(a,$,h.canonical);if(!Ut){const Yt=u.get("text-radial-offset").evaluate($,{},h.canonical);Pe=Yt?fP(Mt,[Yt*Is,MS]):u.get("text-offset").evaluate($,{},h.canonical).map(($t=>$t*Is))}let Ot=M?"center":u.get("text-justify").evaluate($,{},h.canonical);const Zt=u.get("symbol-placement")==="point"?u.get("text-max-width").evaluate($,{},h.canonical)*Is:1/0,ni=()=>{h.bucket.allowVerticalPlacement&&ed(Re)&&(fe.vertical=sb(ge,h.glyphMap,h.glyphPositions,h.imagePositions,H,Zt,T,Mt,"left",et,Pe,c.az.vertical,!0,ne,K))};if(!M&&Ut){const Yt=new Set;if(Ot==="auto")for(let It=0;It<Ut.values.length;It+=2)Yt.add(CS(Ut.values[It]));else Yt.add(Ot);let $t=!1;for(const It of Yt)if(!fe.horizontal[It])if($t)fe.horizontal[It]=fe.horizontal[0];else{const fi=sb(ge,h.glyphMap,h.glyphPositions,h.imagePositions,H,Zt,T,"center",It,et,Pe,c.az.horizontal,!1,ne,K);fi&&(fe.horizontal[It]=fi,$t=fi.positionedLines.length===1)}ni()}else{Ot==="auto"&&(Ot=CS(Mt));const Yt=sb(ge,h.glyphMap,h.glyphPositions,h.imagePositions,H,Zt,T,Mt,Ot,et,Pe,c.az.horizontal,!1,ne,K);Yt&&(fe.horizontal[Ot]=Yt),ni(),ed(Re)&&M&&R&&(fe.vertical=sb(ge,h.glyphMap,h.glyphPositions,h.imagePositions,H,Zt,T,Mt,Ot,et,Pe,c.az.vertical,!1,ne,K))}}let Ge=!1;if($.icon&&$.icon.name){const Re=h.imageMap[$.icon.name];Re&&(ve=r$(h.imagePositions[$.icon.name],u.get("icon-offset").evaluate($,{},h.canonical),u.get("icon-anchor").evaluate($,{},h.canonical)),Ge=!!Re.sdf,h.bucket.sdfIcons===void 0?h.bucket.sdfIcons=Ge:h.bucket.sdfIcons!==Ge&&st("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Re.pixelRatio!==h.bucket.pixelRatio||u.get("icon-rotate").constantOr(1)!==0)&&(h.bucket.iconsNeedLinear=!0))}const Ie=gP(fe.horizontal)||fe.vertical;h.bucket.iconsInText=!!Ie&&Ie.iconsInText,(Ie||ve)&&H$(h.bucket,$,fe,ve,h.imageMap,y,ne,oe,Pe,Ge,h.canonical,h.subdivisionGranularity)}h.showCollisionBoxes&&h.bucket.generateCollisionDebugBuffers()},c.cR=Z1,c.cS=Y1,c.cT=K1,c.cU=function(h){const a=new rb;return(function(u,m){for(const y in u.layers)m.writeMessage(3,k$,u.layers[y])})(h,a),a.finish()},c.cV=function(h,a,u,m,y,T){let M=rP(h,a,u,y,0);return M=rP(M,a,m,T,1),M},c.cW=class{constructor(h){this.maxEntries=h,this.map=new Map}get(h){const a=this.map.get(h);return a!==void 0&&(this.map.delete(h),this.map.set(h,a)),a}set(h,a){if(this.map.has(h))this.map.delete(h);else if(this.map.size>=this.maxEntries){const u=this.map.keys().next().value;this.map.delete(u)}this.map.set(h,a)}clear(){this.map.clear()}},c.cX=$E,c.cY=rb,c.cZ=QA,c.c_=class{constructor(h){this._marks={start:[h.url,"start"].join("#"),end:[h.url,"end"].join("#"),measure:h.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let h=performance.getEntriesByName(this._marks.measure);return h.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),h=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),h}},c.ca=class extends ju{},c.cb=O4,c.cc=class extends If{},c.cd=j1,c.ce=function(h){return h<=1?1:Math.pow(2,Math.ceil(Math.log(h)/Math.LN2))},c.cf=ME,c.cg=function(h,a,u){var m=a[0],y=a[1],T=a[2],M=u[3]*m+u[7]*y+u[11]*T+u[15];return h[0]=(u[0]*m+u[4]*y+u[8]*T+u[12])/(M=M||1),h[1]=(u[1]*m+u[5]*y+u[9]*T+u[13])/M,h[2]=(u[2]*m+u[6]*y+u[10]*T+u[14])/M,h},c.ch=class extends j_{},c.ci=class extends l{},c.cj=function(h,a){return h[0]===a[0]&&h[1]===a[1]&&h[2]===a[2]&&h[3]===a[3]&&h[4]===a[4]&&h[5]===a[5]&&h[6]===a[6]&&h[7]===a[7]&&h[8]===a[8]&&h[9]===a[9]&&h[10]===a[10]&&h[11]===a[11]&&h[12]===a[12]&&h[13]===a[13]&&h[14]===a[14]&&h[15]===a[15]},c.ck=function(h,a){var u=h[0],m=h[1],y=h[2],T=h[3],M=h[4],R=h[5],F=h[6],$=h[7],H=h[8],K=h[9],ne=h[10],oe=h[11],fe=h[12],ge=h[13],ve=h[14],Pe=h[15],Ge=a[0],Ie=a[1],Re=a[2],Ye=a[3],et=a[4],Mt=a[5],Ut=a[6],Ot=a[7],Zt=a[8],ni=a[9],Yt=a[10],$t=a[11],It=a[12],fi=a[13],hi=a[14],_i=a[15];return Math.abs(u-Ge)<=C*Math.max(1,Math.abs(u),Math.abs(Ge))&&Math.abs(m-Ie)<=C*Math.max(1,Math.abs(m),Math.abs(Ie))&&Math.abs(y-Re)<=C*Math.max(1,Math.abs(y),Math.abs(Re))&&Math.abs(T-Ye)<=C*Math.max(1,Math.abs(T),Math.abs(Ye))&&Math.abs(M-et)<=C*Math.max(1,Math.abs(M),Math.abs(et))&&Math.abs(R-Mt)<=C*Math.max(1,Math.abs(R),Math.abs(Mt))&&Math.abs(F-Ut)<=C*Math.max(1,Math.abs(F),Math.abs(Ut))&&Math.abs($-Ot)<=C*Math.max(1,Math.abs($),Math.abs(Ot))&&Math.abs(H-Zt)<=C*Math.max(1,Math.abs(H),Math.abs(Zt))&&Math.abs(K-ni)<=C*Math.max(1,Math.abs(K),Math.abs(ni))&&Math.abs(ne-Yt)<=C*Math.max(1,Math.abs(ne),Math.abs(Yt))&&Math.abs(oe-$t)<=C*Math.max(1,Math.abs(oe),Math.abs($t))&&Math.abs(fe-It)<=C*Math.max(1,Math.abs(fe),Math.abs(It))&&Math.abs(ge-fi)<=C*Math.max(1,Math.abs(ge),Math.abs(fi))&&Math.abs(ve-hi)<=C*Math.max(1,Math.abs(ve),Math.abs(hi))&&Math.abs(Pe-_i)<=C*Math.max(1,Math.abs(Pe),Math.abs(_i))},c.cl=function(h,a){return h[0]=a[0],h[1]=a[1],h[2]=a[2],h[3]=a[3],h[4]=a[4],h[5]=a[5],h[6]=a[6],h[7]=a[7],h[8]=a[8],h[9]=a[9],h[10]=a[10],h[11]=a[11],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15],h},c.cm=h=>h.type==="symbol",c.cn=h=>h.type==="circle",c.co=h=>h.type==="heatmap",c.cp=h=>h.type==="line",c.cq=h=>h.type==="fill",c.cr=h=>h.type==="fill-extrusion",c.cs=h=>h.type==="hillshade",c.ct=h=>h.type==="color-relief",c.cu=h=>h.type==="background",c.cv=h=>h.type==="custom",c.cw=De,c.cx=function(h,a,u){const m=be(a.x-u.x,a.y-u.y),y=be(h.x-u.x,h.y-u.y),T=Math.atan2(m[0]*y[1]-m[1]*y[0],(function(M,R){return M[0]*R[0]+M[1]*R[1]})(m,y));return yt(T)},c.cy=ot,c.cz=function(h,a){return ee[a]&&(h instanceof MouseEvent||h instanceof WheelEvent)},c.d=Bt,c.d0=AE,c.d1=p,c.d2=class{constructor(h,a){this.layers={[dv]:this},this.name=dv,this.version=a?a.version:1,this.extent=a?a.extent:4096,this.length=h.length,this.features=h}feature(h){return new L$(this.features[h],this.extent)}},c.d3=cf,c.d4=qc,c.e=Je,c.f=h=>s(void 0,void 0,void 0,(function*(){if(h.byteLength===0)return createImageBitmap(new ImageData(1,1));const a=new Blob([new Uint8Array(h)],{type:"image/png"});try{return createImageBitmap(a)}catch(u){throw new Error(`Could not load image because of ${u.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),c.g=dt,c.h=h=>new Promise(((a,u)=>{const m=new Image;m.onload=()=>{a(m),URL.revokeObjectURL(m.src),m.onload=null,window.requestAnimationFrame((()=>{m.src=vt}))},m.onerror=()=>u(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const y=new Blob([new Uint8Array(h)],{type:"image/png"});m.src=h.byteLength?URL.createObjectURL(y):vt})),c.i=gt,c.j=(h,a)=>Dt(Je(h,{type:"json"}),a),c.k=vn,c.l=$i,c.m=Dt,c.n=(h,a)=>Dt(Je(h,{type:"arrayBuffer"}),a),c.o=function(h){return new rb(h).readFields(Y4,[])},c.p=nA,c.q=function(h){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(h))},c.r=J_,c.s=ke,c.t=lo,c.u=Tt,c.v=_f,c.w=st,c.x=V_,c.y=vf,c.z=wf})),r("worker",["./shared"],(function(c){class s{constructor(ee,de){this.keyCache={},ee&&this.replace(ee,de)}replace(ee,de){this._layerConfigs={},this._layers={},this.update(ee,[],de)}update(ee,de,pe){for(const Oe of ee){this._layerConfigs[Oe.id]=Oe;const dt=this._layers[Oe.id]=c.bT(Oe,pe);dt._featureFilter=c.aj(dt.filter,pe),this.keyCache[Oe.id]&&delete this.keyCache[Oe.id]}for(const Oe of de)delete this.keyCache[Oe],delete this._layerConfigs[Oe],delete this._layers[Oe];this.familiesBySource={};const Le=c.cL(Object.values(this._layerConfigs),this.keyCache);for(const Oe of Le){const dt=Oe.map((Jt=>this._layers[Jt.id])),pt=dt[0];if(pt.isHidden())continue;const rt=pt.source||"";let St=this.familiesBySource[rt];St||(St=this.familiesBySource[rt]={});const Dt=pt.sourceLayer||c.ai;let Bt=St[Dt];Bt||(Bt=St[Dt]=[]),Bt.push(dt)}}}class d{constructor(ee){const de={},pe=[];for(const pt in ee){const rt=ee[pt],St=de[pt]={};for(const Dt in rt){const Bt=rt[+Dt];if(!Bt||Bt.bitmap.width===0||Bt.bitmap.height===0)continue;const Jt={x:0,y:0,w:Bt.bitmap.width+2,h:Bt.bitmap.height+2};pe.push(Jt),St[Dt]={rect:Jt,metrics:Bt.metrics}}}const{w:Le,h:Oe}=c.p(pe),dt=new c.r({width:Le||1,height:Oe||1});for(const pt in ee){const rt=ee[pt];for(const St in rt){const Dt=rt[+St];if(!Dt||Dt.bitmap.width===0||Dt.bitmap.height===0)continue;const Bt=de[pt][St].rect;c.r.copy(Dt.bitmap,dt,{x:0,y:0},{x:Bt.x+1,y:Bt.y+1},Dt.bitmap)}}this.image=dt,this.positions=de}}c.cM("GlyphAtlas",d);class p{constructor(ee){this.tileID=new c.a2(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),this.uid=ee.uid,this.zoom=ee.zoom,this.pixelRatio=ee.pixelRatio,this.tileSize=ee.tileSize,this.source=ee.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ee.showCollisionBoxes,this.collectResourceTiming=!!ee.collectResourceTiming,this.returnDependencies=!!ee.returnDependencies,this.promoteId=ee.promoteId,this.inFlightDependencies=[]}parse(ee,de,pe,Le,Oe){return c._(this,void 0,void 0,(function*(){this.status="parsing",this.data=ee,this.collisionBoxArray=new c.ag;const dt=new c.cN(Object.keys(ee.layers).sort()),pt=new c.cO(this.tileID,this.promoteId);pt.bucketLayerIDs=[];const rt={},St={featureIndex:pt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:pe,subdivisionGranularity:Oe},Dt=de.familiesBySource[this.source];for(const En in Dt){const dr=ee.layers[En];if(!dr)continue;dr.version===1&&c.w(`Vector tile source "${this.source}" layer "${En}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Xe=dt.encode(En),kt=[];for(let lt=0;lt<dr.length;lt++){const Ft=dr.feature(lt),Wt=pt.getId(Ft,En);kt.push({feature:Ft,id:Wt,index:lt,sourceLayerIndex:Xe})}for(const lt of Dt[En]){const Ft=lt[0];Ft.source!==this.source&&c.w(`layer.source = ${Ft.source} does not equal this.source = ${this.source}`),Ft.isHidden(this.zoom,!0)||(g(lt,this.zoom,pe),(rt[Ft.id]=Ft.createBucket({index:pt.bucketLayerIDs.length,layers:lt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Xe,sourceID:this.source})).populate(kt,St,this.tileID.canonical),pt.bucketLayerIDs.push(lt.map((Wt=>Wt.id))))}}const Bt=c.bY(St.glyphDependencies,(En=>Object.keys(En).map(Number)));this.inFlightDependencies.forEach((En=>En?.abort())),this.inFlightDependencies=[];let Jt=Promise.resolve({});if(Object.keys(Bt).length){const En=new AbortController;this.inFlightDependencies.push(En),Jt=Le.sendAsync({type:"GG",data:{stacks:Bt,source:this.source,tileID:this.tileID,type:"glyphs"}},En)}const vi=Object.keys(St.iconDependencies);let $i=Promise.resolve({});if(vi.length){const En=new AbortController;this.inFlightDependencies.push(En),$i=Le.sendAsync({type:"GI",data:{icons:vi,source:this.source,tileID:this.tileID,type:"icons"}},En)}const vn=Object.keys(St.patternDependencies);let on=Promise.resolve({});if(vn.length){const En=new AbortController;this.inFlightDependencies.push(En),on=Le.sendAsync({type:"GI",data:{icons:vn,source:this.source,tileID:this.tileID,type:"patterns"}},En)}const Tt=St.dashDependencies;let gn=Promise.resolve({});if(Object.keys(Tt).length){const En=new AbortController;this.inFlightDependencies.push(En),gn=Le.sendAsync({type:"GDA",data:{dashes:Tt}},En)}const[Er,Di,yn,Yn]=yield Promise.all([Jt,$i,on,gn]),Cn=new d(Er),Un=new c.cP(Di,yn);for(const En in rt){const dr=rt[En];dr instanceof c.ah?(g(dr.layers,this.zoom,pe),c.cQ({bucket:dr,glyphMap:Er,glyphPositions:Cn.positions,imageMap:Di,imagePositions:Un.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:St.subdivisionGranularity})):dr.hasDependencies&&(dr instanceof c.cR||dr instanceof c.cS||dr instanceof c.cT)&&(g(dr.layers,this.zoom,pe),dr.addFeatures(St,this.tileID.canonical,Un.patternPositions,Yn))}return this.status="done",{buckets:Object.values(rt).filter((En=>!En.isEmpty())),featureIndex:pt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Cn.image,imageAtlas:Un,dashPositions:Yn,glyphMap:this.returnDependencies?Er:null,iconMap:this.returnDependencies?Di:null,glyphPositions:this.returnDependencies?Cn.positions:null}}))}}function g(Me,ee,de){const pe=new c.H(ee);for(const Le of Me)Le.recalculate(pe,de)}class _{constructor(ee,de,pe,Le,Oe){this.type=ee,this.properties=pe||{},this.extent=Oe,this.pointsArray=de,this.id=Le}loadGeometry(){return this.pointsArray.map((ee=>ee.map((de=>new c.P(de.x,de.y)))))}}class x{constructor(ee,de,pe){this.version=2,this._myFeatures=ee,this.name=de,this.length=ee.length,this.extent=pe}feature(ee){return this._myFeatures[ee]}}class b{constructor(){this.layers={}}addLayer(ee){this.layers[ee.name]=ee}}function S(Me){let ee=c.cU(Me);return ee.byteOffset===0&&ee.byteLength===ee.buffer.byteLength||(ee=new Uint8Array(ee)),{vectorTile:Me,rawData:ee.buffer}}function P(Me,ee,de){const{extent:pe}=Me,Le=Math.pow(2,de.z-ee.z),Oe=(de.x-ee.x*Le)*pe,dt=(de.y-ee.y*Le)*pe,pt=[];for(let rt=0;rt<Me.length;rt++){const St=Me.feature(rt);let Dt=St.loadGeometry();for(const Jt of Dt)for(const vi of Jt)vi.x=vi.x*Le-Oe,vi.y=vi.y*Le-dt;const Bt=128;Dt=c.cV(Dt,St.type,-Bt,-Bt,pe+Bt,pe+Bt),Dt.length!==0&&pt.push(new _(St.type,Dt,St.properties,St.id,pe))}return new x(pt,Me.name,pe)}class L{constructor(ee,de,pe){this.actor=ee,this.layerIndex=de,this.availableImages=pe,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new c.cW(1e3)}loadVectorTile(ee,de){return c._(this,void 0,void 0,(function*(){const pe=yield c.n(ee.request,de);try{return{vectorTile:ee.encoding!=="mlt"?new c.cX(new c.cY(pe.data)):new c.cZ(pe.data),rawData:pe.data,cacheControl:pe.cacheControl,expires:pe.expires}}catch(Le){const Oe=new Uint8Array(pe.data);let dt=`Unable to parse the tile at ${ee.request.url}, `;throw dt+=Oe[0]===31&&Oe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Le.message}`,new Error(dt)}}))}loadTile(ee){return c._(this,void 0,void 0,(function*(){const{uid:de,overzoomParameters:pe}=ee;pe&&(ee.request=pe.overzoomRequest);const Le=!!(ee&&ee.request&&ee.request.collectResourceTiming)&&new c.c_(ee.request),Oe=new p(ee);this.loading[de]=Oe;const dt=new AbortController;Oe.abort=dt;try{const pt=yield this.loadVectorTile(ee,dt);if(delete this.loading[de],!pt)return null;if(pe){const Jt=this._getOverzoomTile(ee,pt.vectorTile);pt.rawData=Jt.rawData,pt.vectorTile=Jt.vectorTile}const rt=pt.rawData,St={};pt.expires&&(St.expires=pt.expires),pt.cacheControl&&(St.cacheControl=pt.cacheControl);const Dt={};if(Le){const Jt=Le.finish();Jt&&(Dt.resourceTiming=JSON.parse(JSON.stringify(Jt)))}Oe.vectorTile=pt.vectorTile;const Bt=Oe.parse(pt.vectorTile,this.layerIndex,this.availableImages,this.actor,ee.subdivisionGranularity);this.loaded[de]=Oe,this.fetching[de]={rawTileData:rt,cacheControl:St,resourceTiming:Dt};try{const Jt=yield Bt;return c.e({rawTileData:rt.slice(0),encoding:ee.encoding},Jt,St,Dt)}finally{delete this.fetching[de]}}catch(pt){throw delete this.loading[de],Oe.status="done",this.loaded[de]=Oe,pt}}))}_getOverzoomTile(ee,de){const{tileID:pe,source:Le,overzoomParameters:Oe}=ee,{maxZoomTileID:dt}=Oe,pt=`${dt.key}_${pe.key}`,rt=this.overzoomedTileResultCache.get(pt);if(rt)return rt;const St=new b,Dt=this.layerIndex.familiesBySource[Le];for(const Jt in Dt){const vi=de.layers[Jt];if(!vi)continue;const $i=P(vi,dt,pe.canonical);$i.length>0&&St.addLayer($i)}const Bt=S(St);return this.overzoomedTileResultCache.set(pt,Bt),Bt}reloadTile(ee){return c._(this,void 0,void 0,(function*(){const de=ee.uid;if(!this.loaded||!this.loaded[de])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const pe=this.loaded[de];if(pe.showCollisionBoxes=ee.showCollisionBoxes,pe.status==="parsing"){const Le=yield pe.parse(pe.vectorTile,this.layerIndex,this.availableImages,this.actor,ee.subdivisionGranularity);let Oe;if(this.fetching[de]){const{rawTileData:dt,cacheControl:pt,resourceTiming:rt}=this.fetching[de];delete this.fetching[de],Oe=c.e({rawTileData:dt.slice(0),encoding:ee.encoding},Le,pt,rt)}else Oe=Le;return Oe}if(pe.status==="done"&&pe.vectorTile)return pe.parse(pe.vectorTile,this.layerIndex,this.availableImages,this.actor,ee.subdivisionGranularity)}))}abortTile(ee){return c._(this,void 0,void 0,(function*(){const de=this.loading,pe=ee.uid;de&&de[pe]&&de[pe].abort&&(de[pe].abort.abort(),delete de[pe])}))}removeTile(ee){return c._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[ee.uid]&&delete this.loaded[ee.uid]}))}}class E{constructor(){this.loaded={}}loadTile(ee){return c._(this,void 0,void 0,(function*(){const{uid:de,encoding:pe,rawImageData:Le,redFactor:Oe,greenFactor:dt,blueFactor:pt,baseShift:rt}=ee,St=Le.width+2,Dt=Le.height+2,Bt=c.b(Le)?new c.R({width:St,height:Dt},yield c.c$(Le,-1,-1,St,Dt)):Le,Jt=new c.d0(de,Bt,pe,Oe,dt,pt,rt);return this.loaded=this.loaded||{},this.loaded[de]=Jt,Jt}))}removeTile(ee){const de=this.loaded,pe=ee.uid;de&&de[pe]&&delete de[pe]}}var C,D,O=(function(){if(D)return C;function Me(de,pe){if(de.length!==0){ee(de[0],pe);for(var Le=1;Le<de.length;Le++)ee(de[Le],!pe)}}function ee(de,pe){for(var Le=0,Oe=0,dt=0,pt=de.length,rt=pt-1;dt<pt;rt=dt++){var St=(de[dt][0]-de[rt][0])*(de[rt][1]+de[dt][1]),Dt=Le+St;Oe+=Math.abs(Le)>=Math.abs(St)?Le-Dt+St:St-Dt+Le,Le=Dt}Le+Oe>=0!=!!pe&&de.reverse()}return D=1,C=function de(pe,Le){var Oe,dt=pe&&pe.type;if(dt==="FeatureCollection")for(Oe=0;Oe<pe.features.length;Oe++)de(pe.features[Oe],Le);else if(dt==="GeometryCollection")for(Oe=0;Oe<pe.geometries.length;Oe++)de(pe.geometries[Oe],Le);else if(dt==="Feature")de(pe.geometry,Le);else if(dt==="Polygon")Me(pe.coordinates,Le);else if(dt==="MultiPolygon")for(Oe=0;Oe<pe.coordinates.length;Oe++)Me(pe.coordinates[Oe],Le);return pe}})(),U=c.d1(O);const q={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Me=>Me},G=Math.fround||(N=new Float32Array(1),Me=>(N[0]=+Me,N[0]));var N;class V{constructor(ee){this.options=Object.assign(Object.create(q),ee),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ee){const{log:de,minZoom:pe,maxZoom:Le}=this.options;de&&console.time("total time");const Oe=`prepare ${ee.length} points`;de&&console.time(Oe),this.points=ee;const dt=[];for(let rt=0;rt<ee.length;rt++){const St=ee[rt];if(!St.geometry)continue;const[Dt,Bt]=St.geometry.coordinates,Jt=G(Q(Dt)),vi=G(X(Bt));dt.push(Jt,vi,1/0,rt,-1,1),this.options.reduce&&dt.push(0)}let pt=this.trees[Le+1]=this._createTree(dt);de&&console.timeEnd(Oe);for(let rt=Le;rt>=pe;rt--){const St=+Date.now();pt=this.trees[rt]=this._createTree(this._cluster(pt,rt)),de&&console.log("z%d: %d clusters in %dms",rt,pt.numItems,+Date.now()-St)}return de&&console.timeEnd("total time"),this}getClusters(ee,de){let pe=((ee[0]+180)%360+360)%360-180;const Le=Math.max(-90,Math.min(90,ee[1]));let Oe=ee[2]===180?180:((ee[2]+180)%360+360)%360-180;const dt=Math.max(-90,Math.min(90,ee[3]));if(ee[2]-ee[0]>=360)pe=-180,Oe=180;else if(pe>Oe){const Bt=this.getClusters([pe,Le,180,dt],de),Jt=this.getClusters([-180,Le,Oe,dt],de);return Bt.concat(Jt)}const pt=this.trees[this._limitZoom(de)],rt=pt.range(Q(pe),X(dt),Q(Oe),X(Le)),St=pt.data,Dt=[];for(const Bt of rt){const Jt=this.stride*Bt;Dt.push(St[Jt+5]>1?j(St,Jt,this.clusterProps):this.points[St[Jt+3]])}return Dt}getChildren(ee){const de=this._getOriginId(ee),pe=this._getOriginZoom(ee),Le="No cluster with the specified id.",Oe=this.trees[pe];if(!Oe)throw new Error(Le);const dt=Oe.data;if(de*this.stride>=dt.length)throw new Error(Le);const pt=this.options.radius/(this.options.extent*Math.pow(2,pe-1)),rt=Oe.within(dt[de*this.stride],dt[de*this.stride+1],pt),St=[];for(const Dt of rt){const Bt=Dt*this.stride;dt[Bt+4]===ee&&St.push(dt[Bt+5]>1?j(dt,Bt,this.clusterProps):this.points[dt[Bt+3]])}if(St.length===0)throw new Error(Le);return St}getLeaves(ee,de,pe){const Le=[];return this._appendLeaves(Le,ee,de=de||10,pe=pe||0,0),Le}getTile(ee,de,pe){const Le=this.trees[this._limitZoom(ee)],Oe=Math.pow(2,ee),{extent:dt,radius:pt}=this.options,rt=pt/dt,St=(pe-rt)/Oe,Dt=(pe+1+rt)/Oe,Bt={features:[]};return this._addTileFeatures(Le.range((de-rt)/Oe,St,(de+1+rt)/Oe,Dt),Le.data,de,pe,Oe,Bt),de===0&&this._addTileFeatures(Le.range(1-rt/Oe,St,1,Dt),Le.data,Oe,pe,Oe,Bt),de===Oe-1&&this._addTileFeatures(Le.range(0,St,rt/Oe,Dt),Le.data,-1,pe,Oe,Bt),Bt.features.length?Bt:null}getClusterExpansionZoom(ee){let de=this._getOriginZoom(ee)-1;for(;de<=this.options.maxZoom;){const pe=this.getChildren(ee);if(de++,pe.length!==1)break;ee=pe[0].properties.cluster_id}return de}_appendLeaves(ee,de,pe,Le,Oe){const dt=this.getChildren(de);for(const pt of dt){const rt=pt.properties;if(rt&&rt.cluster?Oe+rt.point_count<=Le?Oe+=rt.point_count:Oe=this._appendLeaves(ee,rt.cluster_id,pe,Le,Oe):Oe<Le?Oe++:ee.push(pt),ee.length===pe)break}return Oe}_createTree(ee){const de=new c.aT(ee.length/this.stride|0,this.options.nodeSize,Float32Array);for(let pe=0;pe<ee.length;pe+=this.stride)de.add(ee[pe],ee[pe+1]);return de.finish(),de.data=ee,de}_addTileFeatures(ee,de,pe,Le,Oe,dt){for(const pt of ee){const rt=pt*this.stride,St=de[rt+5]>1;let Dt,Bt,Jt;if(St)Dt=z(de,rt,this.clusterProps),Bt=de[rt],Jt=de[rt+1];else{const vn=this.points[de[rt+3]];Dt=vn.properties;const[on,Tt]=vn.geometry.coordinates;Bt=Q(on),Jt=X(Tt)}const vi={type:1,geometry:[[Math.round(this.options.extent*(Bt*Oe-pe)),Math.round(this.options.extent*(Jt*Oe-Le))]],tags:Dt};let $i;$i=St||this.options.generateId?de[rt+3]:this.points[de[rt+3]].id,$i!==void 0&&(vi.id=$i),dt.features.push(vi)}}_limitZoom(ee){return Math.max(this.options.minZoom,Math.min(Math.floor(+ee),this.options.maxZoom+1))}_cluster(ee,de){const{radius:pe,extent:Le,reduce:Oe,minPoints:dt}=this.options,pt=pe/(Le*Math.pow(2,de)),rt=ee.data,St=[],Dt=this.stride;for(let Bt=0;Bt<rt.length;Bt+=Dt){if(rt[Bt+2]<=de)continue;rt[Bt+2]=de;const Jt=rt[Bt],vi=rt[Bt+1],$i=ee.within(rt[Bt],rt[Bt+1],pt),vn=rt[Bt+5];let on=vn;for(const Tt of $i){const gn=Tt*Dt;rt[gn+2]>de&&(on+=rt[gn+5])}if(on>vn&&on>=dt){let Tt,gn=Jt*vn,Er=vi*vn,Di=-1;const yn=(Bt/Dt<<5)+(de+1)+this.points.length;for(const Yn of $i){const Cn=Yn*Dt;if(rt[Cn+2]<=de)continue;rt[Cn+2]=de;const Un=rt[Cn+5];gn+=rt[Cn]*Un,Er+=rt[Cn+1]*Un,rt[Cn+4]=yn,Oe&&(Tt||(Tt=this._map(rt,Bt,!0),Di=this.clusterProps.length,this.clusterProps.push(Tt)),Oe(Tt,this._map(rt,Cn)))}rt[Bt+4]=yn,St.push(gn/on,Er/on,1/0,yn,-1,on),Oe&&St.push(Di)}else{for(let Tt=0;Tt<Dt;Tt++)St.push(rt[Bt+Tt]);if(on>1)for(const Tt of $i){const gn=Tt*Dt;if(!(rt[gn+2]<=de)){rt[gn+2]=de;for(let Er=0;Er<Dt;Er++)St.push(rt[gn+Er])}}}}return St}_getOriginId(ee){return ee-this.points.length>>5}_getOriginZoom(ee){return(ee-this.points.length)%32}_map(ee,de,pe){if(ee[de+5]>1){const dt=this.clusterProps[ee[de+6]];return pe?Object.assign({},dt):dt}const Le=this.points[ee[de+3]].properties,Oe=this.options.map(Le);return pe&&Oe===Le?Object.assign({},Oe):Oe}}function j(Me,ee,de){return{type:"Feature",id:Me[ee+3],properties:z(Me,ee,de),geometry:{type:"Point",coordinates:[(pe=Me[ee],360*(pe-.5)),re(Me[ee+1])]}};var pe}function z(Me,ee,de){const pe=Me[ee+5],Le=pe>=1e4?`${Math.round(pe/1e3)}k`:pe>=1e3?Math.round(pe/100)/10+"k":pe,Oe=Me[ee+6],dt=Oe===-1?{}:Object.assign({},de[Oe]);return Object.assign(dt,{cluster:!0,cluster_id:Me[ee+3],point_count:pe,point_count_abbreviated:Le})}function Q(Me){return Me/360+.5}function X(Me){const ee=Math.sin(Me*Math.PI/180),de=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return de<0?0:de>1?1:de}function re(Me){const ee=(180-360*Me)*Math.PI/180;return 360*Math.atan(Math.exp(ee))/Math.PI-90}function se(Me,ee,de,pe){let Le=pe;const Oe=ee+(de-ee>>1);let dt,pt=de-ee;const rt=Me[ee],St=Me[ee+1],Dt=Me[de],Bt=Me[de+1];for(let Jt=ee+3;Jt<de;Jt+=3){const vi=le(Me[Jt],Me[Jt+1],rt,St,Dt,Bt);if(vi>Le)dt=Jt,Le=vi;else if(vi===Le){const $i=Math.abs(Jt-Oe);$i<pt&&(dt=Jt,pt=$i)}}Le>pe&&(dt-ee>3&&se(Me,ee,dt,pe),Me[dt+2]=Le,de-dt>3&&se(Me,dt,de,pe))}function le(Me,ee,de,pe,Le,Oe){let dt=Le-de,pt=Oe-pe;if(dt!==0||pt!==0){const rt=((Me-de)*dt+(ee-pe)*pt)/(dt*dt+pt*pt);rt>1?(de=Le,pe=Oe):rt>0&&(de+=dt*rt,pe+=pt*rt)}return dt=Me-de,pt=ee-pe,dt*dt+pt*pt}function ce(Me,ee,de,pe){const Le={id:Me??null,type:ee,geometry:de,tags:pe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ee==="Point"||ee==="MultiPoint"||ee==="LineString")be(Le,de);else if(ee==="Polygon")be(Le,de[0]);else if(ee==="MultiLineString")for(const Oe of de)be(Le,Oe);else if(ee==="MultiPolygon")for(const Oe of de)be(Le,Oe[0]);return Le}function be(Me,ee){for(let de=0;de<ee.length;de+=3)Me.minX=Math.min(Me.minX,ee[de]),Me.minY=Math.min(Me.minY,ee[de+1]),Me.maxX=Math.max(Me.maxX,ee[de]),Me.maxY=Math.max(Me.maxY,ee[de+1])}function Ee(Me,ee,de,pe){if(!ee.geometry)return;const Le=ee.geometry.coordinates;if(Le&&Le.length===0)return;const Oe=ee.geometry.type,dt=Math.pow(de.tolerance/((1<<de.maxZoom)*de.extent),2);let pt=[],rt=ee.id;if(de.promoteId?rt=ee.properties[de.promoteId]:de.generateId&&(rt=pe||0),Oe==="Point")$e(Le,pt);else if(Oe==="MultiPoint")for(const St of Le)$e(St,pt);else if(Oe==="LineString")Ve(Le,pt,dt,!1);else if(Oe==="MultiLineString"){if(de.lineMetrics){for(const St of Le)pt=[],Ve(St,pt,dt,!1),Me.push(ce(rt,"LineString",pt,ee.properties));return}nt(Le,pt,dt,!1)}else if(Oe==="Polygon")nt(Le,pt,dt,!0);else{if(Oe!=="MultiPolygon"){if(Oe==="GeometryCollection"){for(const St of ee.geometry.geometries)Ee(Me,{id:rt,geometry:St,properties:ee.properties},de,pe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const St of Le){const Dt=[];nt(St,Dt,dt,!0),pt.push(Dt)}}Me.push(ce(rt,Oe,pt,ee.properties))}function $e(Me,ee){ee.push(He(Me[0]),De(Me[1]),0)}function Ve(Me,ee,de,pe){let Le,Oe,dt=0;for(let rt=0;rt<Me.length;rt++){const St=He(Me[rt][0]),Dt=De(Me[rt][1]);ee.push(St,Dt,0),rt>0&&(dt+=pe?(Le*Dt-St*Oe)/2:Math.sqrt(Math.pow(St-Le,2)+Math.pow(Dt-Oe,2))),Le=St,Oe=Dt}const pt=ee.length-3;ee[2]=1,se(ee,0,pt,de),ee[pt+2]=1,ee.size=Math.abs(dt),ee.start=0,ee.end=ee.size}function nt(Me,ee,de,pe){for(let Le=0;Le<Me.length;Le++){const Oe=[];Ve(Me[Le],Oe,de,pe),ee.push(Oe)}}function He(Me){return Me/360+.5}function De(Me){const ee=Math.sin(Me*Math.PI/180),de=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return de<0?0:de>1?1:de}function ot(Me,ee,de,pe,Le,Oe,dt,pt){if(pe/=ee,Oe>=(de/=ee)&&dt<pe)return Me;if(dt<de||Oe>=pe)return null;const rt=[];for(const St of Me){const Dt=St.geometry;let Bt=St.type;const Jt=Le===0?St.minX:St.minY,vi=Le===0?St.maxX:St.maxY;if(Jt>=de&&vi<pe){rt.push(St);continue}if(vi<de||Jt>=pe)continue;let $i=[];if(Bt==="Point"||Bt==="MultiPoint")xe(Dt,$i,de,pe,Le);else if(Bt==="LineString")Be(Dt,$i,de,pe,Le,!1,pt.lineMetrics);else if(Bt==="MultiLineString")ct(Dt,$i,de,pe,Le,!1);else if(Bt==="Polygon")ct(Dt,$i,de,pe,Le,!0);else if(Bt==="MultiPolygon")for(const vn of Dt){const on=[];ct(vn,on,de,pe,Le,!0),on.length&&$i.push(on)}if($i.length){if(pt.lineMetrics&&Bt==="LineString"){for(const vn of $i)rt.push(ce(St.id,Bt,vn,St.tags));continue}Bt!=="LineString"&&Bt!=="MultiLineString"||($i.length===1?(Bt="LineString",$i=$i[0]):Bt="MultiLineString"),Bt!=="Point"&&Bt!=="MultiPoint"||(Bt=$i.length===3?"Point":"MultiPoint"),rt.push(ce(St.id,Bt,$i,St.tags))}}return rt.length?rt:null}function xe(Me,ee,de,pe,Le){for(let Oe=0;Oe<Me.length;Oe+=3){const dt=Me[Oe+Le];dt>=de&&dt<=pe&&xt(ee,Me[Oe],Me[Oe+1],Me[Oe+2])}}function Be(Me,ee,de,pe,Le,Oe,dt){let pt=Je(Me);const rt=Le===0?Se:me;let St,Dt,Bt=Me.start;for(let on=0;on<Me.length-3;on+=3){const Tt=Me[on],gn=Me[on+1],Er=Me[on+2],Di=Me[on+3],yn=Me[on+4],Yn=Le===0?Tt:gn,Cn=Le===0?Di:yn;let Un=!1;dt&&(St=Math.sqrt(Math.pow(Tt-Di,2)+Math.pow(gn-yn,2))),Yn<de?Cn>de&&(Dt=rt(pt,Tt,gn,Di,yn,de),dt&&(pt.start=Bt+St*Dt)):Yn>pe?Cn<pe&&(Dt=rt(pt,Tt,gn,Di,yn,pe),dt&&(pt.start=Bt+St*Dt)):xt(pt,Tt,gn,Er),Cn<de&&Yn>=de&&(Dt=rt(pt,Tt,gn,Di,yn,de),Un=!0),Cn>pe&&Yn<=pe&&(Dt=rt(pt,Tt,gn,Di,yn,pe),Un=!0),!Oe&&Un&&(dt&&(pt.end=Bt+St*Dt),ee.push(pt),pt=Je(Me)),dt&&(Bt+=St)}let Jt=Me.length-3;const vi=Me[Jt],$i=Me[Jt+1],vn=Le===0?vi:$i;vn>=de&&vn<=pe&&xt(pt,vi,$i,Me[Jt+2]),Jt=pt.length-3,Oe&&Jt>=3&&(pt[Jt]!==pt[0]||pt[Jt+1]!==pt[1])&&xt(pt,pt[0],pt[1],pt[2]),pt.length&&ee.push(pt)}function Je(Me){const ee=[];return ee.size=Me.size,ee.start=Me.start,ee.end=Me.end,ee}function ct(Me,ee,de,pe,Le,Oe){for(const dt of Me)Be(dt,ee,de,pe,Le,Oe,!1)}function xt(Me,ee,de,pe){Me.push(ee,de,pe)}function Se(Me,ee,de,pe,Le,Oe){const dt=(Oe-ee)/(pe-ee);return xt(Me,Oe,de+(Le-de)*dt,1),dt}function me(Me,ee,de,pe,Le,Oe){const dt=(Oe-de)/(Le-de);return xt(Me,ee+(pe-ee)*dt,Oe,1),dt}function qe(Me,ee){const de=[];for(let pe=0;pe<Me.length;pe++){const Le=Me[pe],Oe=Le.type;let dt;if(Oe==="Point"||Oe==="MultiPoint"||Oe==="LineString")dt=st(Le.geometry,ee);else if(Oe==="MultiLineString"||Oe==="Polygon"){dt=[];for(const pt of Le.geometry)dt.push(st(pt,ee))}else if(Oe==="MultiPolygon"){dt=[];for(const pt of Le.geometry){const rt=[];for(const St of pt)rt.push(st(St,ee));dt.push(rt)}}de.push(ce(Le.id,Oe,dt,Le.tags))}return de}function st(Me,ee){const de=[];de.size=Me.size,Me.start!==void 0&&(de.start=Me.start,de.end=Me.end);for(let pe=0;pe<Me.length;pe+=3)de.push(Me[pe]+ee,Me[pe+1],Me[pe+2]);return de}function Rt(Me,ee){if(Me.transformed)return Me;const de=1<<Me.z,pe=Me.x,Le=Me.y;for(const Oe of Me.features){const dt=Oe.geometry,pt=Oe.type;if(Oe.geometry=[],pt===1)for(let rt=0;rt<dt.length;rt+=2)Oe.geometry.push(gt(dt[rt],dt[rt+1],ee,de,pe,Le));else for(let rt=0;rt<dt.length;rt++){const St=[];for(let Dt=0;Dt<dt[rt].length;Dt+=2)St.push(gt(dt[rt][Dt],dt[rt][Dt+1],ee,de,pe,Le));Oe.geometry.push(St)}}return Me.transformed=!0,Me}function gt(Me,ee,de,pe,Le,Oe){return[Math.round(de*(Me*pe-Le)),Math.round(de*(ee*pe-Oe))]}function Ae(Me,ee,de,pe,Le){const Oe=ee===Le.maxZoom?0:Le.tolerance/((1<<ee)*Le.extent),dt={features:[],numPoints:0,numSimplified:0,numFeatures:Me.length,source:null,x:de,y:pe,z:ee,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const pt of Me)we(dt,pt,Oe,Le);return dt}function we(Me,ee,de,pe){const Le=ee.geometry,Oe=ee.type,dt=[];if(Me.minX=Math.min(Me.minX,ee.minX),Me.minY=Math.min(Me.minY,ee.minY),Me.maxX=Math.max(Me.maxX,ee.maxX),Me.maxY=Math.max(Me.maxY,ee.maxY),Oe==="Point"||Oe==="MultiPoint")for(let pt=0;pt<Le.length;pt+=3)dt.push(Le[pt],Le[pt+1]),Me.numPoints++,Me.numSimplified++;else if(Oe==="LineString")vt(dt,Le,Me,de,!1,!1);else if(Oe==="MultiLineString"||Oe==="Polygon")for(let pt=0;pt<Le.length;pt++)vt(dt,Le[pt],Me,de,Oe==="Polygon",pt===0);else if(Oe==="MultiPolygon")for(let pt=0;pt<Le.length;pt++){const rt=Le[pt];for(let St=0;St<rt.length;St++)vt(dt,rt[St],Me,de,!0,St===0)}if(dt.length){let pt=ee.tags||null;if(Oe==="LineString"&&pe.lineMetrics){pt={};for(const St in ee.tags)pt[St]=ee.tags[St];pt.mapbox_clip_start=Le.start/Le.size,pt.mapbox_clip_end=Le.end/Le.size}const rt={geometry:dt,type:Oe==="Polygon"||Oe==="MultiPolygon"?3:Oe==="LineString"||Oe==="MultiLineString"?2:1,tags:pt};ee.id!==null&&(rt.id=ee.id),Me.features.push(rt)}}function vt(Me,ee,de,pe,Le,Oe){const dt=pe*pe;if(pe>0&&ee.size<(Le?dt:pe))return void(de.numPoints+=ee.length/3);const pt=[];for(let rt=0;rt<ee.length;rt+=3)(pe===0||ee[rt+2]>dt)&&(de.numSimplified++,pt.push(ee[rt],ee[rt+1])),de.numPoints++;Le&&(function(rt,St){let Dt=0;for(let Bt=0,Jt=rt.length,vi=Jt-2;Bt<Jt;vi=Bt,Bt+=2)Dt+=(rt[Bt]-rt[vi])*(rt[Bt+1]+rt[vi+1]);if(Dt>0===St)for(let Bt=0,Jt=rt.length;Bt<Jt/2;Bt+=2){const vi=rt[Bt],$i=rt[Bt+1];rt[Bt]=rt[Jt-2-Bt],rt[Bt+1]=rt[Jt-1-Bt],rt[Jt-2-Bt]=vi,rt[Jt-1-Bt]=$i}})(pt,Oe),Me.push(pt)}const ye={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ie{constructor(ee,de){const pe=(de=this.options=(function(Oe,dt){for(const pt in dt)Oe[pt]=dt[pt];return Oe})(Object.create(ye),de)).debug;if(pe&&console.time("preprocess data"),de.maxZoom<0||de.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(de.promoteId&&de.generateId)throw new Error("promoteId and generateId cannot be used together.");let Le=(function(Oe,dt){const pt=[];if(Oe.type==="FeatureCollection")for(let rt=0;rt<Oe.features.length;rt++)Ee(pt,Oe.features[rt],dt,rt);else Ee(pt,Oe.type==="Feature"?Oe:{geometry:Oe},dt);return pt})(ee,de);this.tiles={},this.tileCoords=[],pe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",de.indexMaxZoom,de.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Le=(function(Oe,dt){const pt=dt.buffer/dt.extent;let rt=Oe;const St=ot(Oe,1,-1-pt,pt,0,-1,2,dt),Dt=ot(Oe,1,1-pt,2+pt,0,-1,2,dt);return(St||Dt)&&(rt=ot(Oe,1,-pt,1+pt,0,-1,2,dt)||[],St&&(rt=qe(St,1).concat(rt)),Dt&&(rt=rt.concat(qe(Dt,-1)))),rt})(Le,de),Le.length&&this.splitTile(Le,0,0,0),pe&&(Le.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ee,de,pe,Le,Oe,dt,pt){const rt=[ee,de,pe,Le],St=this.options,Dt=St.debug;for(;rt.length;){Le=rt.pop(),pe=rt.pop(),de=rt.pop(),ee=rt.pop();const Bt=1<<de,Jt=ae(de,pe,Le);let vi=this.tiles[Jt];if(!vi&&(Dt>1&&console.time("creation"),vi=this.tiles[Jt]=Ae(ee,de,pe,Le,St),this.tileCoords.push({z:de,x:pe,y:Le}),Dt)){Dt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",de,pe,Le,vi.numFeatures,vi.numPoints,vi.numSimplified),console.timeEnd("creation"));const Un=`z${de}`;this.stats[Un]=(this.stats[Un]||0)+1,this.total++}if(vi.source=ee,Oe==null){if(de===St.indexMaxZoom||vi.numPoints<=St.indexMaxPoints)continue}else{if(de===St.maxZoom||de===Oe)continue;if(Oe!=null){const Un=Oe-de;if(pe!==dt>>Un||Le!==pt>>Un)continue}}if(vi.source=null,ee.length===0)continue;Dt>1&&console.time("clipping");const $i=.5*St.buffer/St.extent,vn=.5-$i,on=.5+$i,Tt=1+$i;let gn=null,Er=null,Di=null,yn=null,Yn=ot(ee,Bt,pe-$i,pe+on,0,vi.minX,vi.maxX,St),Cn=ot(ee,Bt,pe+vn,pe+Tt,0,vi.minX,vi.maxX,St);ee=null,Yn&&(gn=ot(Yn,Bt,Le-$i,Le+on,1,vi.minY,vi.maxY,St),Er=ot(Yn,Bt,Le+vn,Le+Tt,1,vi.minY,vi.maxY,St),Yn=null),Cn&&(Di=ot(Cn,Bt,Le-$i,Le+on,1,vi.minY,vi.maxY,St),yn=ot(Cn,Bt,Le+vn,Le+Tt,1,vi.minY,vi.maxY,St),Cn=null),Dt>1&&console.timeEnd("clipping"),rt.push(gn||[],de+1,2*pe,2*Le),rt.push(Er||[],de+1,2*pe,2*Le+1),rt.push(Di||[],de+1,2*pe+1,2*Le),rt.push(yn||[],de+1,2*pe+1,2*Le+1)}}getTile(ee,de,pe){ee=+ee,de=+de,pe=+pe;const Le=this.options,{extent:Oe,debug:dt}=Le;if(ee<0||ee>24)return null;const pt=1<<ee,rt=ae(ee,de=de+pt&pt-1,pe);if(this.tiles[rt])return Rt(this.tiles[rt],Oe);dt>1&&console.log("drilling down to z%d-%d-%d",ee,de,pe);let St,Dt=ee,Bt=de,Jt=pe;for(;!St&&Dt>0;)Dt--,Bt>>=1,Jt>>=1,St=this.tiles[ae(Dt,Bt,Jt)];return St&&St.source?(dt>1&&(console.log("found parent tile z%d-%d-%d",Dt,Bt,Jt),console.time("drilling down")),this.splitTile(St.source,Dt,Bt,Jt,ee,de,pe),dt>1&&console.timeEnd("drilling down"),this.tiles[rt]?Rt(this.tiles[rt],Oe):null):null}}function ae(Me,ee,de){return 32*((1<<Me)*de+ee)+Me}class ke extends L{constructor(ee,de,pe,Le=Ze){super(ee,de,pe),this._dataUpdateable=new Map,this._createGeoJSONIndex=Le}loadVectorTile(ee,de){return c._(this,void 0,void 0,(function*(){const pe=ee.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Le=this._geoJSONIndex.getTile(pe.z,pe.x,pe.y);return Le?S(new c.d2(Le.features,{version:2,extent:c.a5})):null}))}loadData(ee){return c._(this,void 0,void 0,(function*(){var de;(de=this._pendingRequest)===null||de===void 0||de.abort();const pe=this._startPerformance(ee);this._pendingRequest=new AbortController;try{(!this._pendingData||ee.request||ee.data||ee.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(ee,this._pendingRequest));const Le=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(Le,ee),this.loaded={};const Oe={};return ee.request&&(Oe.data=Le),this._finishPerformance(pe,ee,Oe),Oe}catch(Le){if(delete this._pendingRequest,c.Z(Le))return{abandoned:!0};throw Le}}))}_startPerformance(ee){var de;if(!((de=ee?.request)===null||de===void 0)&&de.collectResourceTiming)return new c.c_(ee.request)}_finishPerformance(ee,de,pe){if(!ee)return;const Le=ee.finish();Le&&(pe.resourceTiming={},pe.resourceTiming[de.source]=JSON.parse(JSON.stringify(Le)))}getData(){return c._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(ee){const de=this.loaded;return de&&de[ee.uid]?super.reloadTile(ee):this.loadTile(ee)}loadAndProcessGeoJSON(ee,de){return c._(this,void 0,void 0,(function*(){let pe;if(ee.request?pe=yield this.loadGeoJSONFromUrl(ee.request,ee.promoteId,de):ee.data?pe=this._loadGeoJSONFromObject(ee.data,ee.promoteId):ee.dataDiff&&(pe=this._loadGeoJSONFromDiff(ee.dataDiff,ee.promoteId,ee.source)),delete this._pendingRequest,typeof pe!="object")throw new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`);return U(pe,!0),ee.filter&&(pe=this._filterGeoJSON(pe,ee.filter)),pe}))}loadGeoJSONFromUrl(ee,de,pe){return c._(this,void 0,void 0,(function*(){const Le=yield c.j(ee,pe);return this._dataUpdateable=c.a7(Le.data,de),Le.data}))}_loadGeoJSONFromObject(ee,de){return this._dataUpdateable=c.a7(ee,de),ee}_loadGeoJSONFromDiff(ee,de,pe){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${pe}`);c.a8(this._dataUpdateable,ee,de);const Le=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(Le)}_filterGeoJSON(ee,de){const pe=c.d3(de,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(pe.result==="error")throw new Error(pe.value.map((Oe=>`${Oe.key}: ${Oe.message}`)).join(", "));const Le=ee.features.filter((Oe=>pe.value.evaluate({zoom:0},Oe)));return this._toFeatureCollection(Le)}_toFeatureCollection(ee){return{type:"FeatureCollection",features:ee}}removeSource(ee){return c._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(ee){return this._geoJSONIndex.getClusterExpansionZoom(ee.clusterId)}getClusterChildren(ee){return this._geoJSONIndex.getChildren(ee.clusterId)}getClusterLeaves(ee){return this._geoJSONIndex.getLeaves(ee.clusterId,ee.limit,ee.offset)}}function Ze(Me,ee){return ee.cluster?new V((function({superclusterOptions:de,clusterProperties:pe}){if(!pe||!de)return de;const Le={},Oe={},dt={accumulated:null,zoom:0},pt={properties:null},rt=Object.keys(pe);for(const St of rt){const[Dt,Bt]=pe[St],Jt=c.d3(Bt),vi=c.d3(typeof Dt=="string"?[Dt,["accumulated"],["get",St]]:Dt);Le[St]=Jt.value,Oe[St]=vi.value}return de.map=St=>{pt.properties=St;const Dt={};for(const Bt of rt)Dt[Bt]=Le[Bt].evaluate(dt,pt);return Dt},de.reduce=(St,Dt)=>{pt.properties=Dt;for(const Bt of rt)dt.accumulated=St[Bt],St[Bt]=Oe[Bt].evaluate(dt,pt)},de})(ee)).load(Me.features):(function(de,pe){return new ie(de,pe)})(Me,ee.geojsonVtOptions)}class yt{constructor(ee){this.self=ee,this.actor=new c.L(ee),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(de,pe)=>{if(this.externalWorkerSourceTypes[de])throw new Error(`Worker source with name "${de}" already registered.`);this.externalWorkerSourceTypes[de]=pe},this.self.addProtocol=c.cJ,this.self.removeProtocol=c.cK,this.self.registerRTLTextPlugin=de=>{c.d4.setMethods(de)},this.actor.registerMessageHandler("LDT",((de,pe)=>this._getDEMWorkerSource(de,pe.source).loadTile(pe))),this.actor.registerMessageHandler("RDT",((de,pe)=>c._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(de,pe.source).removeTile(pe)})))),this.actor.registerMessageHandler("GCEZ",((de,pe)=>c._(this,void 0,void 0,(function*(){return this._getWorkerSource(de,pe.type,pe.source).getClusterExpansionZoom(pe)})))),this.actor.registerMessageHandler("GCC",((de,pe)=>c._(this,void 0,void 0,(function*(){return this._getWorkerSource(de,pe.type,pe.source).getClusterChildren(pe)})))),this.actor.registerMessageHandler("GCL",((de,pe)=>c._(this,void 0,void 0,(function*(){return this._getWorkerSource(de,pe.type,pe.source).getClusterLeaves(pe)})))),this.actor.registerMessageHandler("LD",((de,pe)=>this._getWorkerSource(de,pe.type,pe.source).loadData(pe))),this.actor.registerMessageHandler("GD",((de,pe)=>this._getWorkerSource(de,pe.type,pe.source).getData())),this.actor.registerMessageHandler("LT",((de,pe)=>this._getWorkerSource(de,pe.type,pe.source).loadTile(pe))),this.actor.registerMessageHandler("RT",((de,pe)=>this._getWorkerSource(de,pe.type,pe.source).reloadTile(pe))),this.actor.registerMessageHandler("AT",((de,pe)=>this._getWorkerSource(de,pe.type,pe.source).abortTile(pe))),this.actor.registerMessageHandler("RMT",((de,pe)=>this._getWorkerSource(de,pe.type,pe.source).removeTile(pe))),this.actor.registerMessageHandler("RS",((de,pe)=>c._(this,void 0,void 0,(function*(){if(!this.workerSources[de]||!this.workerSources[de][pe.type]||!this.workerSources[de][pe.type][pe.source])return;const Le=this.workerSources[de][pe.type][pe.source];delete this.workerSources[de][pe.type][pe.source],Le.removeSource!==void 0&&Le.removeSource(pe)})))),this.actor.registerMessageHandler("RM",(de=>c._(this,void 0,void 0,(function*(){delete this.layerIndexes[de],delete this.availableImages[de],delete this.workerSources[de],delete this.demWorkerSources[de],this.globalStates.delete(de)})))),this.actor.registerMessageHandler("SR",((de,pe)=>c._(this,void 0,void 0,(function*(){this.referrer=pe})))),this.actor.registerMessageHandler("SRPS",((de,pe)=>this._syncRTLPluginState(de,pe))),this.actor.registerMessageHandler("IS",((de,pe)=>c._(this,void 0,void 0,(function*(){this.self.importScripts(pe)})))),this.actor.registerMessageHandler("SI",((de,pe)=>this._setImages(de,pe))),this.actor.registerMessageHandler("UL",((de,pe)=>c._(this,void 0,void 0,(function*(){this._getLayerIndex(de).update(pe.layers,pe.removedIds,this._getGlobalState(de))})))),this.actor.registerMessageHandler("UGS",((de,pe)=>c._(this,void 0,void 0,(function*(){const Le=this._getGlobalState(de);for(const Oe in pe)Le[Oe]=pe[Oe]})))),this.actor.registerMessageHandler("SL",((de,pe)=>c._(this,void 0,void 0,(function*(){this._getLayerIndex(de).replace(pe,this._getGlobalState(de))}))))}_getGlobalState(ee){let de=this.globalStates.get(ee);return de||(de={},this.globalStates.set(ee,de)),de}_setImages(ee,de){return c._(this,void 0,void 0,(function*(){this.availableImages[ee]=de;for(const pe in this.workerSources[ee]){const Le=this.workerSources[ee][pe];for(const Oe in Le)Le[Oe].availableImages=de}}))}_syncRTLPluginState(ee,de){return c._(this,void 0,void 0,(function*(){return yield c.d4.syncState(de,this.self.importScripts)}))}_getAvailableImages(ee){let de=this.availableImages[ee];return de||(de=[]),de}_getLayerIndex(ee){let de=this.layerIndexes[ee];return de||(de=this.layerIndexes[ee]=new s),de}_getWorkerSource(ee,de,pe){if(this.workerSources[ee]||(this.workerSources[ee]={}),this.workerSources[ee][de]||(this.workerSources[ee][de]={}),!this.workerSources[ee][de][pe]){const Le={sendAsync:(Oe,dt)=>(Oe.targetMapId=ee,this.actor.sendAsync(Oe,dt))};switch(de){case"vector":this.workerSources[ee][de][pe]=new L(Le,this._getLayerIndex(ee),this._getAvailableImages(ee));break;case"geojson":this.workerSources[ee][de][pe]=new ke(Le,this._getLayerIndex(ee),this._getAvailableImages(ee));break;default:this.workerSources[ee][de][pe]=new this.externalWorkerSourceTypes[de](Le,this._getLayerIndex(ee),this._getAvailableImages(ee))}}return this.workerSources[ee][de][pe]}_getDEMWorkerSource(ee,de){return this.demWorkerSources[ee]||(this.demWorkerSources[ee]={}),this.demWorkerSources[ee][de]||(this.demWorkerSources[ee][de]=new E),this.demWorkerSources[ee][de]}}return c.i(self)&&(self.worker=new yt(self)),yt})),r("index",["exports","./shared"],(function(c,s){var d="5.15.0";function p(){var A=new s.A(4);return s.A!=Float32Array&&(A[1]=0,A[2]=0),A[0]=1,A[3]=1,A}let g,_,x;const b={frame(A,l,f){const v=requestAnimationFrame((I=>{w(),l(I)})),{unsubscribe:w}=s.s(A.signal,"abort",(()=>{w(),cancelAnimationFrame(v),f(new s.a(A.signal.reason))}),!1)},frameAsync(A){return new Promise(((l,f)=>{this.frame(A,l,f)}))},getImageData(A,l=0){return this.getImageCanvasContext(A).getImageData(-l,-l,A.width+2*l,A.height+2*l)},getImageCanvasContext(A){const l=window.document.createElement("canvas"),f=l.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return l.width=A.width,l.height=A.height,f.drawImage(A,0,0,A.width,A.height),f},resolveURL:A=>(g||(g=document.createElement("a")),g.href=A,g.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return x!==void 0?x:!!matchMedia&&(_==null&&(_=matchMedia("(prefers-reduced-motion: reduce)")),_.matches)},set prefersReducedMotion(A){x=A}},S=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(A){this._frozenAt=A}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function P(){return S.getCurrentTime()}class L{static testProp(l){if(!L.docStyle)return l[0];for(let f=0;f<l.length;f++)if(l[f]in L.docStyle)return l[f];return l[0]}static create(l,f,v){const w=window.document.createElement(l);return f!==void 0&&(w.className=f),v&&v.appendChild(w),w}static createNS(l,f){return window.document.createElementNS(l,f)}static disableDrag(){L.docStyle&&L.selectProp&&(L.userSelect=L.docStyle[L.selectProp],L.docStyle[L.selectProp]="none")}static enableDrag(){L.docStyle&&L.selectProp&&(L.docStyle[L.selectProp]=L.userSelect)}static setTransform(l,f){l.style[L.transformProp]=f}static addEventListener(l,f,v,w={}){l.addEventListener(f,v,"passive"in w?w:w.capture)}static removeEventListener(l,f,v,w={}){l.removeEventListener(f,v,"passive"in w?w:w.capture)}static suppressClickInternal(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",L.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",L.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",L.suppressClickInternal,!0)}),0)}static getScale(l){const f=l.getBoundingClientRect();return{x:f.width/l.offsetWidth||1,y:f.height/l.offsetHeight||1,boundingClientRect:f}}static getPoint(l,f,v){const w=f.boundingClientRect;return new s.P((v.clientX-w.left)/f.x-l.clientLeft,(v.clientY-w.top)/f.y-l.clientTop)}static mousePos(l,f){const v=L.getScale(l);return L.getPoint(l,v,f)}static touchPos(l,f){const v=[],w=L.getScale(l);for(let I=0;I<f.length;I++)v.push(L.getPoint(l,w,f[I]));return v}static mouseButton(l){return l.button}static remove(l){l.parentNode&&l.parentNode.removeChild(l)}static sanitize(l){const f=new DOMParser().parseFromString(l,"text/html").body||document.createElement("body"),v=f.querySelectorAll("script");for(const w of v)w.remove();return L.clean(f),f.innerHTML}static isPossiblyDangerous(l,f){const v=f.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(l)||!v.includes("javascript:")&&!v.includes("data:"))||!!l.startsWith("on")||void 0}static clean(l){const f=l.children;for(const v of f)L.removeAttributes(v),L.clean(v)}static removeAttributes(l){for(const{name:f,value:v}of l.attributes)L.isPossiblyDangerous(f,v)&&l.removeAttribute(f)}}L.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,L.selectProp=L.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),L.transformProp=L.testProp(["transform","WebkitTransform"]);const E={supported:!1,testSupport:function(A){!O&&D&&(U?q(A):C=A)}};let C,D,O=!1,U=!1;function q(A){const l=A.createTexture();A.bindTexture(A.TEXTURE_2D,l);try{if(A.texImage2D(A.TEXTURE_2D,0,A.RGBA,A.RGBA,A.UNSIGNED_BYTE,D),A.isContextLost())return;E.supported=!0}catch{}A.deleteTexture(l),O=!0}var G;typeof document<"u"&&(D=document.createElement("img"),D.onload=()=>{C&&q(C),C=null,U=!0},D.onerror=()=>{O=!0,C=null},D.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(A){let l,f,v,w;A.resetRequestQueue=()=>{l=[],f=0,v=0,w={}},A.addThrottleControl=W=>{const Z=v++;return w[Z]=W,Z},A.removeThrottleControl=W=>{delete w[W],k()},A.getImage=(W,Z,J=!0)=>new Promise(((he,ue)=>{E.supported&&(W.headers||(W.headers={}),W.headers.accept="image/webp,*/*"),s.e(W,{type:"image"}),l.push({abortController:Z,requestParameters:W,supportImageRefresh:J,state:"queued",onError:_e=>{ue(_e)},onSuccess:_e=>{he(_e)}}),k()}));const I=W=>s._(this,void 0,void 0,(function*(){W.state="running";const{requestParameters:Z,supportImageRefresh:J,onError:he,onSuccess:ue,abortController:_e}=W,Ce=J===!1&&!s.i(self)&&!s.g(Z.url)&&(!Z.headers||Object.keys(Z.headers).reduce(((ze,We)=>ze&&We==="accept"),!0));f++;const Fe=Ce?B(Z,_e):s.m(Z,_e);try{const ze=yield Fe;delete W.abortController,W.state="completed",ze.data instanceof HTMLImageElement||s.b(ze.data)?ue(ze):ze.data&&ue({data:yield(Ne=ze.data,typeof createImageBitmap=="function"?s.f(Ne):s.h(Ne)),cacheControl:ze.cacheControl,expires:ze.expires})}catch(ze){delete W.abortController,he(ze)}finally{f--,k()}var Ne})),k=()=>{const W=(()=>{for(const Z of Object.keys(w))if(w[Z]())return!0;return!1})()?s.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let Z=f;Z<W&&l.length>0;Z++){const J=l.shift();J.abortController.signal.aborted?Z--:I(J)}},B=(W,Z)=>new Promise(((J,he)=>{const ue=new Image,_e=W.url,Ce=W.credentials;Ce&&Ce==="include"?ue.crossOrigin="use-credentials":(Ce&&Ce==="same-origin"||!s.d(_e))&&(ue.crossOrigin="anonymous"),Z.signal.addEventListener("abort",(()=>{ue.src="",he(new s.a(Z.signal.reason))})),ue.fetchPriority="high",ue.onload=()=>{ue.onerror=ue.onload=null,J({data:ue})},ue.onerror=()=>{ue.onerror=ue.onload=null,Z.signal.aborted||he(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},ue.src=_e}))})(G||(G={})),G.resetRequestQueue();class N{constructor(l){this._transformRequestFn=l??null}transformRequest(l,f){return this._transformRequestFn&&this._transformRequestFn(l,f)||{url:l}}setTransformRequest(l){this._transformRequestFn=l}}function V(A){const l=[];if(typeof A=="string")l.push({id:"default",url:A});else if(A&&A.length>0){const f=[];for(const{id:v,url:w}of A){const I=`${v}${w}`;f.indexOf(I)===-1&&(f.push(I),l.push({id:v,url:w}))}}return l}function j(A,l,f){try{const v=new URL(A);return v.pathname+=`${l}${f}`,v.toString()}catch{throw new Error(`Invalid sprite URL "${A}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function z(A){const{userImage:l}=A;return!!(l&&l.render&&l.render())&&(A.data.replace(new Uint8Array(l.data.buffer)),!0)}class Q extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const l of Object.keys(this.images))this.removeImage(l);this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:f,promiseResolve:v}of this.requestors)v(this._getImagesForIds(f));this.requestors=[]}}getImage(l){const f=this.images[l];if(f&&!f.data&&f.spriteData){const v=f.spriteData;f.data=new s.R({width:v.width,height:v.height},v.context.getImageData(v.x,v.y,v.width,v.height).data),f.spriteData=null}return f}addImage(l,f){if(this.images[l])throw new Error(`Image id ${l} already exist, use updateImage instead`);this._validate(l,f)&&(this.images[l]=f)}_validate(l,f){let v=!0;const w=f.data||f.spriteData;return this._validateStretch(f.stretchX,w&&w.width)||(this.fire(new s.k(new Error(`Image "${l}" has invalid "stretchX" value`))),v=!1),this._validateStretch(f.stretchY,w&&w.height)||(this.fire(new s.k(new Error(`Image "${l}" has invalid "stretchY" value`))),v=!1),this._validateContent(f.content,f)||(this.fire(new s.k(new Error(`Image "${l}" has invalid "content" value`))),v=!1),v}_validateStretch(l,f){if(!l)return!0;let v=0;for(const w of l){if(w[0]<v||w[1]<w[0]||f<w[1])return!1;v=w[1]}return!0}_validateContent(l,f){if(!l)return!0;if(l.length!==4)return!1;const v=f.spriteData,w=v&&v.width||f.data.width,I=v&&v.height||f.data.height;return!(l[0]<0||w<l[0]||l[1]<0||I<l[1]||l[2]<0||w<l[2]||l[3]<0||I<l[3]||l[2]<l[0]||l[3]<l[1])}updateImage(l,f,v=!0){const w=this.getImage(l);if(v&&(w.data.width!==f.data.width||w.data.height!==f.data.height))throw new Error(`size mismatch between old image (${w.data.width}x${w.data.height}) and new image (${f.data.width}x${f.data.height}).`);f.version=w.version+1,this.images[l]=f,this.updatedImages[l]=!0}removeImage(l){const f=this.images[l];delete this.images[l],delete this.patterns[l],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l){return new Promise(((f,v)=>{let w=!0;if(!this.isLoaded())for(const I of l)this.images[I]||(w=!1);this.isLoaded()||w?f(this._getImagesForIds(l)):this.requestors.push({ids:l,promiseResolve:f})}))}_getImagesForIds(l){const f={};for(const v of l){let w=this.getImage(v);w||(this.fire(new s.l("styleimagemissing",{id:v})),w=this.getImage(v)),w?f[v]={data:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,textFitWidth:w.textFitWidth,textFitHeight:w.textFitHeight,hasRenderCallback:!!(w.userImage&&w.userImage.render)}:s.w(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return f}getPixelSize(){const{width:l,height:f}=this.atlasImage;return{width:l,height:f}}getPattern(l){const f=this.patterns[l],v=this.getImage(l);if(!v)return null;if(f&&f.position.version===v.version)return f.position;if(f)f.position.version=v.version;else{const w={w:v.data.width+2,h:v.data.height+2,x:0,y:0},I=new s.I(w,v);this.patterns[l]={bin:w,position:I}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const f=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.T(l,this.atlasImage,f.RGBA),this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const I in this.patterns)l.push(this.patterns[I].bin);const{w:f,h:v}=s.p(l),w=this.atlasImage;w.resize({width:f||1,height:v||1});for(const I in this.patterns){const{bin:k}=this.patterns[I],B=k.x+1,W=k.y+1,Z=this.getImage(I).data,J=Z.width,he=Z.height;s.R.copy(Z,w,{x:0,y:0},{x:B,y:W},{width:J,height:he}),s.R.copy(Z,w,{x:0,y:he-1},{x:B,y:W-1},{width:J,height:1}),s.R.copy(Z,w,{x:0,y:0},{x:B,y:W+he},{width:J,height:1}),s.R.copy(Z,w,{x:J-1,y:0},{x:B-1,y:W},{width:1,height:he}),s.R.copy(Z,w,{x:0,y:0},{x:B+J,y:W},{width:1,height:he})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const f of l){if(this.callbackDispatchedThisFrame[f])continue;this.callbackDispatchedThisFrame[f]=!0;const v=this.getImage(f);v||s.w(`Image with ID: "${f}" was not found`),z(v)&&this.updateImage(f,v)}}cloneImages(){const l={};for(const f in this.images){const v=this.images[f];l[f]=Object.assign(Object.assign({},v),{data:v.data?v.data.clone():null})}return l}}const X=1e20;function re(A,l,f,v,w,I,k,B,W){for(let Z=l;Z<l+v;Z++)se(A,f*I+Z,I,w,k,B,W);for(let Z=f;Z<f+w;Z++)se(A,Z*I+l,1,v,k,B,W)}function se(A,l,f,v,w,I,k){I[0]=0,k[0]=-X,k[1]=X,w[0]=A[l];for(let B=1,W=0,Z=0;B<v;B++){w[B]=A[l+B*f];const J=B*B;do{const he=I[W];Z=(w[B]-w[he]+J-he*he)/(B-he)/2}while(Z<=k[W]&&--W>-1);W++,I[W]=B,k[W]=Z,k[W+1]=X}for(let B=0,W=0;B<v;B++){for(;k[W+1]<B;)W++;const Z=I[W],J=B-Z;A[l+B*f]=w[Z]+J*J}}const le=s.v.layout_symbol["text-font"].default.join(",");class ce{constructor(l,f,v){this.requestManager=l,this.localIdeographFontFamily=f,this.entries={},this.lang=v}setURL(l){this.url=l}getGlyphs(l){return s._(this,void 0,void 0,(function*(){const f=[];for(const I in l)for(const k of l[I])f.push(this._getAndCacheGlyphsPromise(I,k));const v=yield Promise.all(f),w={};for(const{stack:I,id:k,glyph:B}of v)w[I]||(w[I]={}),w[I][k]=B&&{id:B.id,bitmap:B.bitmap.clone(),metrics:B.metrics};return w}))}_getAndCacheGlyphsPromise(l,f){return s._(this,void 0,void 0,(function*(){let v=this.entries[l];v||(v=this.entries[l]={glyphs:{},requests:{},ranges:{}});let w=v.glyphs[f];return w!==void 0?{stack:l,id:f,glyph:w}:!this.url||this._charUsesLocalIdeographFontFamily(f)?(w=v.glyphs[f]=this._drawGlyph(v,l,f),{stack:l,id:f,glyph:w}):yield this._downloadAndCacheRangePromise(l,f)}))}_downloadAndCacheRangePromise(l,f){return s._(this,void 0,void 0,(function*(){const v=this.entries[l],w=Math.floor(f/256);if(v.ranges[w])return{stack:l,id:f,glyph:null};if(!v.requests[w]){const I=ce.loadGlyphRange(l,w,this.url,this.requestManager);v.requests[w]=I}try{const I=yield v.requests[w];for(const k in I)v.glyphs[+k]=I[+k];return v.ranges[w]=!0,{stack:l,id:f,glyph:I[f]||null}}catch(I){const k=v.glyphs[f]=this._drawGlyph(v,l,f);return this._warnOnMissingGlyphRange(k,w,f,I),{stack:l,id:f,glyph:k}}}))}_warnOnMissingGlyphRange(l,f,v,w){const I=256*f,k=I+255,B=v.toString(16).padStart(4,"0").toUpperCase();s.w(`Unable to load glyph range ${f}, ${I}-${k}. Rendering codepoint U+${B} locally instead. ${w}`)}_charUsesLocalIdeographFontFamily(l){return!!this.localIdeographFontFamily&&s.q(l)}_drawGlyph(l,f,v){const w=f===le&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(v),I=w?"ideographTinySDF":"tinySDF";l[I]||(l[I]=this._createTinySDF(w?this.localIdeographFontFamily:f));const k=l[I].draw(String.fromCodePoint(v));return{id:v,bitmap:new s.r({width:k.width||60,height:k.height||60},k.data),metrics:{width:k.glyphWidth/2||24,height:k.glyphHeight/2||24,left:k.glyphLeft/2+.5||0,top:k.glyphTop/2-27.5||-8,advance:k.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(l){const f=l?l.split(","):[];f.push("sans-serif");const v=f.map((w=>/[-\w]+/.test(w)?w:`'${CSS.escape(w)}'`)).join(",");return new ce.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:v,fontWeight:this._fontWeight(f[0]),fontStyle:this._fontStyle(f[0]),lang:this.lang})}_fontStyle(l){return/italic/i.test(l)?"italic":/oblique/i.test(l)?"oblique":"normal"}_fontWeight(l){const f={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let v;for(const[w,I]of Object.entries(f))new RegExp(`\\b${w}\\b`,"i").test(l)&&(v=`${I}`);return v}destroy(){for(const l in this.entries){const f=this.entries[l];f.tinySDF&&(f.tinySDF=null),f.ideographTinySDF&&(f.ideographTinySDF=null),f.glyphs={},f.requests={},f.ranges={}}this.entries={}}}ce.loadGlyphRange=function(A,l,f,v){return s._(this,void 0,void 0,(function*(){const w=256*l,I=w+255,k=v.transformRequest(f.replace("{fontstack}",A).replace("{range}",`${w}-${I}`),"Glyphs"),B=yield s.n(k,new AbortController);if(!B||!B.data)throw new Error(`Could not load glyph range. range: ${l}, ${w}-${I}`);const W={};for(const Z of s.o(B.data))W[Z.id]=Z;return W}))},ce.TinySDF=class{constructor({fontSize:A=24,buffer:l=3,radius:f=8,cutoff:v=.25,fontFamily:w="sans-serif",fontWeight:I="normal",fontStyle:k="normal",lang:B=null}={}){this.buffer=l,this.cutoff=v,this.radius=f,this.lang=B;const W=this.size=A+4*l,Z=this._createCanvas(W),J=this.ctx=Z.getContext("2d",{willReadFrequently:!0});J.font=`${k} ${I} ${A}px ${w}`,J.textBaseline="alphabetic",J.textAlign="left",J.fillStyle="black",this.gridOuter=new Float64Array(W*W),this.gridInner=new Float64Array(W*W),this.f=new Float64Array(W),this.z=new Float64Array(W+1),this.v=new Uint16Array(W)}_createCanvas(A){const l=document.createElement("canvas");return l.width=l.height=A,l}draw(A){const{width:l,actualBoundingBoxAscent:f,actualBoundingBoxDescent:v,actualBoundingBoxLeft:w,actualBoundingBoxRight:I}=this.ctx.measureText(A),k=Math.ceil(f),B=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(I-w))),W=Math.min(this.size-this.buffer,k+Math.ceil(v)),Z=B+2*this.buffer,J=W+2*this.buffer,he=Math.max(Z*J,0),ue=new Uint8ClampedArray(he),_e={data:ue,width:Z,height:J,glyphWidth:B,glyphHeight:W,glyphTop:k,glyphLeft:0,glyphAdvance:l};if(B===0||W===0)return _e;const{ctx:Ce,buffer:Fe,gridInner:Ne,gridOuter:ze}=this;this.lang&&(Ce.lang=this.lang),Ce.clearRect(Fe,Fe,B,W),Ce.fillText(A,Fe,Fe+k);const We=Ce.getImageData(Fe,Fe,B,W);ze.fill(X,0,he),Ne.fill(0,0,he);for(let tt=0;tt<W;tt++)for(let je=0;je<B;je++){const Qe=We.data[4*(tt*B+je)+3]/255;if(Qe===0)continue;const at=(tt+Fe)*Z+je+Fe;if(Qe===1)ze[at]=0,Ne[at]=X;else{const Ke=.5-Qe;ze[at]=Ke>0?Ke*Ke:0,Ne[at]=Ke<0?Ke*Ke:0}}re(ze,0,0,Z,J,Z,this.f,this.v,this.z),re(Ne,Fe,Fe,B,W,Z,this.f,this.v,this.z);for(let tt=0;tt<he;tt++){const je=Math.sqrt(ze[tt])-Math.sqrt(Ne[tt]);ue[tt]=Math.round(255-255*(je/this.radius+this.cutoff))}return _e}};class be{constructor(){this.specification=s.u.light.position}possiblyEvaluate(l,f){return s.F(l.expression.evaluate(f))}interpolate(l,f,v){return{x:s.G.number(l.x,f.x,v),y:s.G.number(l.y,f.y,v),z:s.G.number(l.z,f.z,v)}}}let Ee;class $e extends s.E{constructor(l){super(),Ee=Ee||new s.t({anchor:new s.D(s.u.light.anchor),position:new be,color:new s.D(s.u.light.color),intensity:new s.D(s.u.light.intensity)}),this._transitionable=new s.x(Ee,void 0),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,f={}){if(!this._validate(s.y,l,f))for(const v in l){const w=l[v];v.endsWith(s.z)?this._transitionable.setTransition(v.slice(0,-s.z.length),w):this._transitionable.setValue(v,w)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,f,v){return(!v||v.validate!==!1)&&s.B(this,l.call(s.C,{value:f,style:{glyphs:!0,sprite:!0},styleSpec:s.u}))}}const Ve=new s.t({"sky-color":new s.D(s.u.sky["sky-color"]),"horizon-color":new s.D(s.u.sky["horizon-color"]),"fog-color":new s.D(s.u.sky["fog-color"]),"fog-ground-blend":new s.D(s.u.sky["fog-ground-blend"]),"horizon-fog-blend":new s.D(s.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new s.D(s.u.sky["sky-horizon-blend"]),"atmosphere-blend":new s.D(s.u.sky["atmosphere-blend"])});class nt extends s.E{constructor(l){super(),this._transitionable=new s.x(Ve,void 0),this.setSky(l),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.H(0))}setSky(l,f={}){if(!this._validate(s.J,l,f)){l||(l={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const v in l){const w=l[v];v.endsWith(s.z)?this._transitionable.setTransition(v.slice(0,-s.z.length),w):this._transitionable.setValue(v,w)}}}getSky(){return this._transitionable.serialize()}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,f,v={}){return v?.validate!==!1&&s.B(this,l.call(s.C,s.e({value:f,style:{glyphs:!0,sprite:!0},styleSpec:s.u})))}calculateFogBlendOpacity(l){return l<60?0:l<70?(l-60)/10:1}}class He{constructor(l,f){this.width=l,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(l,f){const v=l.join(",")+String(f);return this.dashEntry[v]||(this.dashEntry[v]=this.addDash(l,f)),this.dashEntry[v]}getDashRanges(l,f,v){const w=[];let I=l.length%2==1?-l[l.length-1]*v:0,k=l[0]*v,B=!0;w.push({left:I,right:k,isDash:B,zeroLength:l[0]===0});let W=l[0];for(let Z=1;Z<l.length;Z++){B=!B;const J=l[Z];I=W*v,W+=J,k=W*v,w.push({left:I,right:k,isDash:B,zeroLength:J===0})}return w}addRoundDash(l,f,v){const w=f/2;for(let I=-v;I<=v;I++){const k=this.width*(this.nextRow+v+I);let B=0,W=l[B];for(let Z=0;Z<this.width;Z++){Z/W.right>1&&(W=l[++B]);const J=Math.abs(Z-W.left),he=Math.abs(Z-W.right),ue=Math.min(J,he);let _e;const Ce=I/v*(w+1);if(W.isDash){const Fe=w-Math.abs(Ce);_e=Math.sqrt(ue*ue+Fe*Fe)}else _e=w-Math.sqrt(ue*ue+Ce*Ce);this.data[k+Z]=Math.max(0,Math.min(255,_e+128))}}}addRegularDash(l){for(let B=l.length-1;B>=0;--B){const W=l[B],Z=l[B+1];W.zeroLength?l.splice(B,1):Z&&Z.isDash===W.isDash&&(Z.left=W.left,l.splice(B,1))}const f=l[0],v=l[l.length-1];f.isDash===v.isDash&&(f.left=v.left-this.width,v.right=f.right+this.width);const w=this.width*this.nextRow;let I=0,k=l[I];for(let B=0;B<this.width;B++){B/k.right>1&&(k=l[++I]);const W=Math.abs(B-k.left),Z=Math.abs(B-k.right),J=Math.min(W,Z);this.data[w+B]=Math.max(0,Math.min(255,(k.isDash?J:-J)+128))}}addDash(l,f){const v=f?7:0,w=2*v+1;if(this.nextRow+w>this.height)return s.w("LineAtlas out of space"),null;let I=0;for(let B=0;B<l.length;B++)I+=l[B];if(I!==0){const B=this.width/I,W=this.getDashRanges(l,this.width,B);f?this.addRoundDash(W,B,v):this.addRegularDash(W)}const k={y:this.nextRow+v,height:2*v,width:I};return this.nextRow+=w,this.dirty=!0,k}bind(l){const f=l.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))}}const De="maplibre_preloaded_worker_pool";class ot{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<ot.workerCount;)this.workers.push(new Worker(s.c.WORKER_URL));return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach((f=>{f.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[De]}numActive(){return Object.keys(this.active).length}}const xe=Math.floor(b.hardwareConcurrency/2);let Be,Je;function ct(){return Be||(Be=new ot),Be}ot.workerCount=s.K(globalThis)?Math.max(Math.min(xe,3),1):1;class xt{constructor(l,f){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=f;const v=this.workerPool.acquire(f);for(let w=0;w<v.length;w++){const I=new s.L(v[w],f);I.name=`Worker ${w}`,this.actors.push(I)}if(!this.actors.length)throw new Error("No actors found")}broadcast(l,f){const v=[];for(const w of this.actors)v.push(w.sendAsync({type:l,data:f}));return Promise.all(v)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(l=!0){this.actors.forEach((f=>{f.remove()})),this.actors=[],l&&this.workerPool.release(this.id)}registerMessageHandler(l,f){for(const v of this.actors)v.registerMessageHandler(l,f)}unregisterMessageHandler(l){for(const f of this.actors)f.unregisterMessageHandler(l)}}function Se(){return Je||(Je=new xt(ct(),s.M),Je.registerMessageHandler("GR",((A,l,f)=>s.m(l,f)))),Je}function me(A,l){const f=s.N();return s.O(f,f,[1,1,0]),s.Q(f,f,[.5*A.width,.5*A.height,1]),A.calculatePosMatrix?s.S(f,f,A.calculatePosMatrix(l.toUnwrapped())):f}function qe(A,l,f,v,w,I,k){var B;const W=(function(ue,_e,Ce){if(ue)for(const Fe of ue){const Ne=_e[Fe];if(Ne&&Ne.source===Ce&&Ne.type==="fill-extrusion")return!0}else for(const Fe in _e){const Ne=_e[Fe];if(Ne.source===Ce&&Ne.type==="fill-extrusion")return!0}return!1})((B=w?.layers)!==null&&B!==void 0?B:null,l,A.id),Z=I.maxPitchScaleFactor(),J=A.tilesIn(v,Z,W);J.sort(st);const he=[];for(const ue of J)he.push({wrappedTileID:ue.tileID.wrapped().key,queryResults:ue.tile.queryRenderedFeatures(l,f,A.getState(),ue.queryGeometry,ue.cameraQueryGeometry,ue.scale,w,I,Z,me(I,ue.tileID),k?(_e,Ce)=>k(ue.tileID,_e,Ce):void 0)});return(function(ue,_e){for(const Ce in ue)for(const Fe of ue[Ce])Rt(Fe,_e);return ue})((function(ue){const _e={},Ce={};for(const Fe of ue){const Ne=Fe.queryResults,ze=Fe.wrappedTileID,We=Ce[ze]=Ce[ze]||{};for(const tt in Ne){const je=Ne[tt],Qe=We[tt]=We[tt]||{},at=_e[tt]=_e[tt]||[];for(const Ke of je)Qe[Ke.featureIndex]||(Qe[Ke.featureIndex]=!0,at.push(Ke))}}return _e})(he),A)}function st(A,l){const f=A.tileID,v=l.tileID;return f.overscaledZ-v.overscaledZ||f.canonical.y-v.canonical.y||f.wrap-v.wrap||f.canonical.x-v.canonical.x}function Rt(A,l){const f=A.feature,v=l.getFeatureState(f.layer["source-layer"],f.id);f.source=f.layer.source,f.layer["source-layer"]&&(f.sourceLayer=f.layer["source-layer"]),f.state=v}function gt(A,l,f){return s._(this,void 0,void 0,(function*(){let v=A;if(A.url?v=(yield s.j(l.transformRequest(A.url,"Source"),f)).data:yield b.frameAsync(f),!v)return null;const w=s.U(s.e(v,A),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in v&&v.vector_layers&&(w.vectorLayerIds=v.vector_layers.map((I=>I.id))),w}))}class Ae{constructor(l,f){l&&(f?this.setSouthWest(l).setNorthEast(f):Array.isArray(l)&&(l.length===4?this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]]):this.setSouthWest(l[0]).setNorthEast(l[1])))}setNorthEast(l){return this._ne=l instanceof s.V?new s.V(l.lng,l.lat):s.V.convert(l),this}setSouthWest(l){return this._sw=l instanceof s.V?new s.V(l.lng,l.lat):s.V.convert(l),this}extend(l){const f=this._sw,v=this._ne;let w,I;if(l instanceof s.V)w=l,I=l;else{if(!(l instanceof Ae))return Array.isArray(l)?l.length===4||l.every(Array.isArray)?this.extend(Ae.convert(l)):this.extend(s.V.convert(l)):l&&("lng"in l||"lon"in l)&&"lat"in l?this.extend(s.V.convert(l)):this;if(w=l._sw,I=l._ne,!w||!I)return this}return f||v?(f.lng=Math.min(w.lng,f.lng),f.lat=Math.min(w.lat,f.lat),v.lng=Math.max(I.lng,v.lng),v.lat=Math.max(I.lat,v.lat)):(this._sw=new s.V(w.lng,w.lat),this._ne=new s.V(I.lng,I.lat)),this}getCenter(){return new s.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.V(this.getWest(),this.getNorth())}getSouthEast(){return new s.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(l){const{lng:f,lat:v}=s.V.convert(l);let w=this._sw.lng<=f&&f<=this._ne.lng;return this._sw.lng>this._ne.lng&&(w=this._sw.lng>=f&&f>=this._ne.lng),this._sw.lat<=v&&v<=this._ne.lat&&w}intersects(l){if(!((l=Ae.convert(l)).getNorth()>=this.getSouth()&&l.getSouth()<=this.getNorth()))return!1;const f=Math.abs(this.getEast()-this.getWest()),v=Math.abs(l.getEast()-l.getWest());if(f>=360||v>=360)return!0;const w=s.W(this.getWest(),-180,180),I=s.W(this.getEast(),-180,180),k=s.W(l.getWest(),-180,180),B=s.W(l.getEast(),-180,180),W=w>=I,Z=k>=B;return!(!W||!Z)||(W?B>=w||k<=I:Z?I>=k||w<=B:k<=I&&B>=w)}static convert(l){return l instanceof Ae?l:l&&new Ae(l)}static fromLngLat(l,f=0){const v=360*f/40075017,w=v/Math.cos(Math.PI/180*l.lat);return new Ae(new s.V(l.lng-w,l.lat-v),new s.V(l.lng+w,l.lat+v))}adjustAntiMeridian(){const l=new s.V(this._sw.lng,this._sw.lat),f=new s.V(this._ne.lng,this._ne.lat);return new Ae(l,l.lng>f.lng?new s.V(f.lng+360,f.lat):f)}}class we{constructor(l,f,v){this.bounds=Ae.convert(this.validateBounds(l)),this.minzoom=f||0,this.maxzoom=v||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const f=Math.pow(2,l.z),v=Math.floor(s.Y(this.bounds.getWest())*f),w=Math.floor(s.X(this.bounds.getNorth())*f),I=Math.ceil(s.Y(this.bounds.getEast())*f),k=Math.ceil(s.X(this.bounds.getSouth())*f);return l.x>=v&&l.x<I&&l.y>=w&&l.y<k}}class vt extends s.E{constructor(l,f,v,w){if(super(),this.id=l,this.dispatcher=v,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.U(f,["url","scheme","tileSize","promoteId","encoding"])),this._options=s.e({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w)}load(){return s._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield gt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),l&&(s.e(this,l),l.bounds&&(this.tileBounds=new we(l.bounds,this.minzoom,this.maxzoom)),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.l("data",{dataType:"source",sourceDataType:"content"})))}catch(l){this._tileJSONRequest=null,this._loaded=!0,s.Z(l)||this.fire(new s.k(l))}}))}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}setSourceProperty(l){this._tileJSONRequest&&this._tileJSONRequest.abort(),l(),this.load()}setTiles(l){return this.setSourceProperty((()=>{this._options.tiles=l})),this}setUrl(l){return this.setSourceProperty((()=>{this.url=l,this._options.url=l})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return s.e({},this._options)}loadTile(l){return s._(this,void 0,void 0,(function*(){const f=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),v={request:this.map._requestManager.transformRequest(f,"Tile"),uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(l)};v.request.collectResourceTiming=this._collectResourceTiming;let w="RT";if(l.actor&&l.state!=="expired"){if(l.state==="loading")return new Promise(((I,k)=>{l.reloadPromise={resolve:I,reject:k}}))}else l.actor=this.dispatcher.getActor(),w="LT";l.abortController=new AbortController;try{const I=yield l.actor.sendAsync({type:w,data:v},l.abortController);if(delete l.abortController,l.aborted)return;this._afterTileLoadWorkerResponse(l,I)}catch(I){if(delete l.abortController,l.aborted)return;if(I&&I.status!==404)throw I;this._afterTileLoadWorkerResponse(l,null)}}))}_getOverzoomParameters(l){if(l.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const f=l.tileID.scaledTo(this.maxzoom).canonical,v=f.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:f,overzoomRequest:this.map._requestManager.transformRequest(v,"Tile")}}_afterTileLoadWorkerResponse(l,f){if(f&&f.resourceTiming&&(l.resourceTiming=f.resourceTiming),f&&this.map._refreshExpiredTiles&&l.setExpiryData(f),l.loadVectorData(f,this.map.painter),l.reloadPromise){const v=l.reloadPromise;l.reloadPromise=null,this.loadTile(l).then(v.resolve).catch(v.reject)}}abortTile(l){return s._(this,void 0,void 0,(function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.actor&&(yield l.actor.sendAsync({type:"AT",data:{uid:l.uid,type:this.type,source:this.id}}))}))}unloadTile(l){return s._(this,void 0,void 0,(function*(){l.unloadVectorData(),l.actor&&(yield l.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class ye extends s.E{constructor(l,f,v,w){super(),this.id=l,this.dispatcher=v,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},f),s.e(this,s.U(f,["url","scheme","tileSize"]))}load(){return s._(this,arguments,void 0,(function*(l=!1){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const f=yield gt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,f&&(s.e(this,f),f.bounds&&(this.tileBounds=new we(f.bounds,this.minzoom,this.maxzoom)),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:l})))}catch(f){this._tileJSONRequest=null,this._loaded=!0,s.Z(f)||this.fire(new s.k(f))}}))}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(l){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),l(),this.load(!0)}setTiles(l){return this.setSourceProperty((()=>{this._options.tiles=l})),this}setUrl(l){return this.setSourceProperty((()=>{this.url=l,this._options.url=l})),this}serialize(){return s.e({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l){return s._(this,void 0,void 0,(function*(){const f=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);l.abortController=new AbortController;try{const v=yield G.getImage(this.map._requestManager.transformRequest(f,"Tile"),l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(v&&v.data){this.map._refreshExpiredTiles&&(v.cacheControl||v.expires)&&l.setExpiryData({cacheControl:v.cacheControl,expires:v.expires});const w=this.map.painter.context,I=w.gl,k=v.data;l.texture=this.map.painter.getTileTexture(k.width),l.texture?l.texture.update(k,{useMipmap:!0}):(l.texture=new s.T(w,k,I.RGBA,{useMipmap:!0}),l.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST)),l.state="loaded"}}catch(v){if(delete l.abortController,l.aborted)l.state="unloaded";else if(v)throw l.state="errored",v}}))}abortTile(l){return s._(this,void 0,void 0,(function*(){l.abortController&&(l.abortController.abort(),delete l.abortController)}))}unloadTile(l){return s._(this,void 0,void 0,(function*(){l.texture&&this.map.painter.saveTileTexture(l.texture)}))}hasTransition(){return!1}}class ie extends ye{constructor(l,f,v,w){super(l,f,v,w),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},f),this.encoding=f.encoding||"mapbox",this.redFactor=f.redFactor,this.greenFactor=f.greenFactor,this.blueFactor=f.blueFactor,this.baseShift=f.baseShift}loadTile(l){return s._(this,void 0,void 0,(function*(){const f=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),v=this.map._requestManager.transformRequest(f,"Tile");l.neighboringTiles=this._getNeighboringTiles(l.tileID),l.abortController=new AbortController;try{const w=yield G.getImage(v,l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(w&&w.data){const I=w.data;this.map._refreshExpiredTiles&&(w.cacheControl||w.expires)&&l.setExpiryData({cacheControl:w.cacheControl,expires:w.expires});const k=s.b(I)&&s.$()?I:yield this.readImageNow(I),B={type:this.type,uid:l.uid,source:this.id,rawImageData:k,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!l.actor||l.state==="expired"){l.actor=this.dispatcher.getActor();const W=yield l.actor.sendAsync({type:"LDT",data:B});l.dem=W,l.needsHillshadePrepare=!0,l.needsTerrainPrepare=!0,l.state="loaded"}}}catch(w){if(delete l.abortController,l.aborted)l.state="unloaded";else if(w)throw l.state="errored",w}}))}readImageNow(l){return s._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&s.a0()){const f=l.width+2,v=l.height+2;try{return new s.R({width:f,height:v},yield s.a1(l,-1,-1,f,v))}catch{}}return b.getImageData(l,1)}))}_getNeighboringTiles(l){const f=l.canonical,v=Math.pow(2,f.z),w=(f.x-1+v)%v,I=f.x===0?l.wrap-1:l.wrap,k=(f.x+1+v)%v,B=f.x+1===v?l.wrap+1:l.wrap,W={};return W[new s.a2(l.overscaledZ,I,f.z,w,f.y).key]={backfilled:!1},W[new s.a2(l.overscaledZ,B,f.z,k,f.y).key]={backfilled:!1},f.y>0&&(W[new s.a2(l.overscaledZ,I,f.z,w,f.y-1).key]={backfilled:!1},W[new s.a2(l.overscaledZ,l.wrap,f.z,f.x,f.y-1).key]={backfilled:!1},W[new s.a2(l.overscaledZ,B,f.z,k,f.y-1).key]={backfilled:!1}),f.y+1<v&&(W[new s.a2(l.overscaledZ,I,f.z,w,f.y+1).key]={backfilled:!1},W[new s.a2(l.overscaledZ,l.wrap,f.z,f.x,f.y+1).key]={backfilled:!1},W[new s.a2(l.overscaledZ,B,f.z,k,f.y+1).key]={backfilled:!1}),W}unloadTile(l){return s._(this,void 0,void 0,(function*(){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded",l.actor&&(yield l.actor.sendAsync({type:"RDT",data:{type:this.type,uid:l.uid,source:this.id}}))}))}}function ae(A){return A.type==="GeometryCollection"?A.geometries.map((l=>l.coordinates)).flat(1/0):A.coordinates.flat(1/0)}function ke(A){const l=new Ae;let f;switch(A.type){case"FeatureCollection":f=A.features.map((v=>ae(v.geometry))).flat(1/0);break;case"Feature":f=ae(A.geometry);break;default:f=ae(A)}if(f.length==0)return l;for(let v=0;v<f.length-1;v+=2)l.extend([f[v],f[v+1]]);return l}class Ze extends s.E{constructor(l,f,v,w){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:f.data},this.actor=v.getActor(),this.setEventedParent(w),this._data=typeof f.data=="string"?{url:f.data}:{geojson:f.data},this._options=s.e({},f),this._collectResourceTiming=f.collectResourceTiming,f.maxzoom!==void 0&&(this.maxzoom=f.maxzoom),f.type&&(this.type=f.type),f.attribution&&(this.attribution=f.attribution),this.promoteId=f.promoteId,f.clusterMaxZoom!==void 0&&this.maxzoom<=f.clusterMaxZoom&&s.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${f.clusterMaxZoom}".`),this.workerOptions=s.e({source:this.id,cluster:f.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(f.buffer!==void 0?f.buffer:128),tolerance:this._pixelsToTileUnits(f.tolerance!==void 0?f.tolerance:.375),extent:s.a5,maxZoom:this.maxzoom,lineMetrics:f.lineMetrics||!1,generateId:f.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(f.clusterMaxZoom),minPoints:Math.max(2,f.clusterMinPoints||2),extent:s.a5,radius:this._pixelsToTileUnits(f.clusterRadius||50),log:!1,generateId:f.generateId||!1},clusterProperties:f.clusterProperties,filter:f.filter},f.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(l){return l*(s.a5/this.tileSize)}_getClusterMaxZoom(l){const f=l?Math.round(l):this.maxzoom-1;return Number.isInteger(l)||l===void 0||s.w(`Integer expected for option 'clusterMaxZoom': provided value "${l}" rounded to "${f}"`),f}load(){return s._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(l){this.map=l,this.load()}setData(l,f){this._data=typeof l=="string"?{url:l}:{geojson:l},this._pendingWorkerUpdate={data:l};const v=this._updateWorkerData();return f?v:this}updateData(l,f){this._pendingWorkerUpdate.diff=s.a6(this._pendingWorkerUpdate.diff,l);const v=this._updateWorkerData();return f?v:this}getData(){return s._(this,void 0,void 0,(function*(){const l=s.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:l})}))}getBounds(){return s._(this,void 0,void 0,(function*(){return ke(yield this.getData())}))}setClusterOptions(l){return this.workerOptions.cluster=l.cluster,l.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(l.clusterRadius)),l.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(l.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(l){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:l,source:this.id}})}getClusterChildren(l){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:l,source:this.id}})}getClusterLeaves(l,f,v){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:l,limit:f,offset:v}})}_updateWorkerData(){return s._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void s.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:l,diff:f}=this._pendingWorkerUpdate,v=s.e({type:this.type},this.workerOptions);l!==void 0?(typeof l=="string"?(v.request=this.map._requestManager.transformRequest(b.resolveURL(l),"Source"),v.request.collectResourceTiming=this._collectResourceTiming):v.data=l,this._pendingWorkerUpdate.data=void 0):f&&(v.dataDiff=f,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new s.l("dataloading",{dataType:"source"}));try{const w=yield this.actor.sendAsync({type:"LD",data:v});if(this._isUpdatingWorker=!1,this._removed||w.abandoned)return void this.fire(new s.l("dataabort",{dataType:"source"}));w.data&&(this._data={geojson:w.data});const I=this._applyDiffToSource(f),k=this._getShouldReloadTileOptions(I);let B=null;w.resourceTiming&&w.resourceTiming[this.id]&&(B=w.resourceTiming[this.id].slice(0));const W={dataType:"source"};this._collectResourceTiming&&B&&B.length>0&&s.e(W,{resourceTiming:B}),this.fire(new s.l("data",Object.assign(Object.assign({},W),{sourceDataType:"metadata"}))),this.fire(new s.l("data",Object.assign(Object.assign({},W),{sourceDataType:"content",shouldReloadTileOptions:k})))}catch(w){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new s.l("dataabort",{dataType:"source"}));this.fire(new s.k(w))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyDiffToSource(l){if(!l)return;const f=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){const w=s.a7(this._data.geojson,f);if(!w)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:w}}if(!this._data.updateable)return;const v=s.a8(this._data.updateable,l,f);return l.removeAll||this._options.cluster?void 0:v}_getShouldReloadTileOptions(l){if(l)return{affectedBounds:l.filter(Boolean).map((f=>ke(f)))}}shouldReloadTile(l,{affectedBounds:f}){if(l.state==="loading")return!0;if(l.state==="unloaded")return!1;const{buffer:v,extent:w}=this.workerOptions.geojsonVtOptions,I=(function({x:k,y:B,z:W},Z=0){const J=s.a3((k-Z)/Math.pow(2,W)),he=s.a4((B+1+Z)/Math.pow(2,W)),ue=s.a3((k+1+Z)/Math.pow(2,W)),_e=s.a4((B-Z)/Math.pow(2,W));return new Ae([J,he],[ue,_e])})(l.tileID.canonical,v/w);for(const k of f)if(I.intersects(k))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(l){return s._(this,void 0,void 0,(function*(){const f=l.actor?"RT":"LT";l.actor=this.actor;const v={type:this.type,uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};l.abortController=new AbortController;const w=yield this.actor.sendAsync({type:f,data:v},l.abortController);delete l.abortController,l.unloadVectorData(),l.aborted||l.loadVectorData(w,this.map.painter,f==="RT")}))}abortTile(l){return s._(this,void 0,void 0,(function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.aborted=!0}))}unloadTile(l){return s._(this,void 0,void 0,(function*(){l.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return s.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class yt extends s.E{constructor(l,f,v,w){super(),this.flippedWindingOrder=!1,this.id=l,this.dispatcher=v,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=f}load(l){return s._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const f=yield G.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,f&&f.data&&(this.image=f.data,l&&(this.coordinates=l),this._finishLoading())}catch(f){this._request=null,this._loaded=!0,s.Z(f)||this.fire(new s.k(f))}}))}loaded(){return this._loaded}updateImage(l){return l.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=l.url,this.load(l.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(l){this.coordinates=l;const f=l.map(s.a9.fromLngLat);var v;return this.tileID=(function(w){const I=s.aa.fromPoints(w),k=I.width(),B=I.height(),W=Math.max(k,B),Z=Math.max(0,Math.floor(-Math.log(W)/Math.LN2)),J=Math.pow(2,Z);return new s.ac(Z,Math.floor((I.minX+I.maxX)/2*J),Math.floor((I.minY+I.maxY)/2*J))})(f),this.terrainTileRanges=this._getOverlappingTileRanges(f),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=f.map((w=>this.tileID.getTilePoint(w)._round())),this.flippedWindingOrder=((v=this.tileCoords)[1].x-v[0].x)*(v[2].y-v[0].y)-(v[1].y-v[0].y)*(v[2].x-v[0].x)<0,this.fire(new s.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const l=this.map.painter.context,f=l.gl;this.texture||(this.texture=new s.T(l,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let v=!1;for(const w in this.tiles){const I=this.tiles[w];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture,v=!0)}v&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(l){return s._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={}):l.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(l){const{minX:f,minY:v,maxX:w,maxY:I}=s.aa.fromPoints(l),k={};for(let B=0;B<=s.ab;B++){const W=Math.pow(2,B),Z=Math.floor(f*W),J=Math.floor(v*W),he=Math.floor(w*W),ue=Math.floor(I*W);k[B]={minTileX:Z,minTileY:J,maxTileX:he,maxTileY:ue}}return k}}class Me extends yt{constructor(l,f,v,w){super(l,f,v,w),this.roundZoom=!0,this.type="video",this.options=f}load(){return s._(this,void 0,void 0,(function*(){this._loaded=!1;const l=this.options;this.urls=[];for(const f of l.urls)this.urls.push(this.map._requestManager.transformRequest(f,"Source").url);try{const f=yield s.ad(this.urls);if(this._loaded=!0,!f)return;this.video=f,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(f){this.fire(new s.k(f))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const f=this.video.seekable;l<f.start(0)||l>f.end(0)?this.fire(new s.k(new s.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${f.start(0)} and ${f.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,f=l.gl;this.texture?this.video.paused||(this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),f.texSubImage2D(f.TEXTURE_2D,0,0,0,f.RGBA,f.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(l,this.video,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let v=!1;for(const w in this.tiles){const I=this.tiles[w];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture,v=!0)}v&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ee extends yt{constructor(l,f,v,w){super(l,f,v,w),f.coordinates?Array.isArray(f.coordinates)&&f.coordinates.length===4&&!f.coordinates.some((I=>!Array.isArray(I)||I.length!==2||I.some((k=>typeof k!="number"))))||this.fire(new s.k(new s.ae(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.k(new s.ae(`sources.${l}`,null,'missing required property "coordinates"'))),f.animate&&typeof f.animate!="boolean"&&this.fire(new s.k(new s.ae(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),f.canvas?typeof f.canvas=="string"||f.canvas instanceof HTMLCanvasElement||this.fire(new s.k(new s.ae(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.k(new s.ae(`sources.${l}`,null,'missing required property "canvas"'))),this.options=f,this.animate=f.animate===void 0||f.animate}load(){return s._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const f=this.map.painter.context,v=f.gl;this.texture?(l||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new s.T(f,this.canvas,v.RGBA,{premultiply:!0}),this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE));let w=!1;for(const I in this.tiles){const k=this.tiles[I];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture,w=!0)}w&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}}const de={},pe=A=>{switch(A){case"geojson":return Ze;case"image":return yt;case"raster":return ye;case"raster-dem":return ie;case"vector":return vt;case"video":return Me;case"canvas":return ee}return de[A]},Le="RTLPluginLoaded";class Oe extends s.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Se()}_syncState(l){return this.status=l,this.dispatcher.broadcast("SRPS",{pluginStatus:l,pluginURL:this.url}).catch((f=>{throw this.status="error",f}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(l){return s._(this,arguments,void 0,(function*(f,v=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=b.resolveURL(f),!this.url)throw new Error(`requested url ${f} is invalid`);if(this.status==="unavailable"){if(!v)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return s._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new s.l(Le))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let dt=null;function pt(){return dt||(dt=new Oe),dt}var rt,St;(function(A){A[A.Base=0]="Base",A[A.Parent=1]="Parent"})(rt||(rt={})),(function(A){A[A.Departing=0]="Departing",A[A.Incoming=1]="Incoming"})(St||(St={}));class Dt{constructor(l,f){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=l,this.uid=s.af(),this.uses=0,this.tileSize=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(l){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(l||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:l,fadingDirection:f,fadingParentID:v,fadeEndTime:w}){this.resetFadeLogic(),this.fadingRole=l,this.fadingDirection=f,this.fadingParentID=v,this.fadeEndTime=w}setSelfFadeLogic(l){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=l}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=P(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(l){this.demTexture&&l.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(l,f,v){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",l){l.featureIndex&&(this.latestFeatureIndex=l.featureIndex,l.rawTileData?(this.latestRawTileData=l.rawTileData,this.latestFeatureIndex.rawTileData=l.rawTileData,this.latestFeatureIndex.encoding=l.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=l.collisionBoxArray,this.buckets=(function(w,I){const k={};if(!I)return k;for(const B of w){const W=B.layerIds.map((Z=>I.getLayer(Z))).filter(Boolean);if(W.length!==0){B.layers=W,B.stateDependentLayerIds&&(B.stateDependentLayers=B.stateDependentLayerIds.map((Z=>W.filter((J=>J.id===Z))[0])));for(const Z of W)k[Z.id]=B}}return k})(l.buckets,f?.style),this.hasSymbolBuckets=!1;for(const w in this.buckets){const I=this.buckets[w];if(I instanceof s.ah){if(this.hasSymbolBuckets=!0,!v)break;I.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const w in this.buckets){const I=this.buckets[w];if(I instanceof s.ah&&I.hasRTLText){this.hasRTLText=!0,pt().lazyLoad();break}}this.queryPadding=0;for(const w in this.buckets){const I=this.buckets[w];this.queryPadding=Math.max(this.queryPadding,f.style.getLayer(w).queryRadius(I))}l.imageAtlas&&(this.imageAtlas=l.imageAtlas),l.glyphAtlasImage&&(this.glyphAtlasImage=l.glyphAtlasImage),this.dashPositions=l.dashPositions}else this.collisionBoxArray=new s.ag}unloadVectorData(){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(l){return this.buckets[l.id]}upload(l){for(const v in this.buckets){const w=this.buckets[v];w.uploadPending()&&w.upload(l)}const f=l.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new s.T(l,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(l,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null)}prepare(l){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(l,this.imageAtlasTexture)}queryRenderedFeatures(l,f,v,w,I,k,B,W,Z,J,he){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:w,cameraQueryGeometry:I,scale:k,tileSize:this.tileSize,pixelPosMatrix:J,transform:W,params:B,queryPadding:this.queryPadding*Z,getElevation:he},l,f,v):{}}querySourceFeatures(l,f){const v=this.latestFeatureIndex;if(!v||!v.rawTileData)return;const w=v.loadVTLayers(),I=f&&f.sourceLayer?f.sourceLayer:"",k=w[s.ai]||w[I];if(!k)return;const B=s.aj(f?.filter,f?.globalState),{z:W,x:Z,y:J}=this.tileID.canonical,he={z:W,x:Z,y:J};for(let ue=0;ue<k.length;ue++){const _e=k.feature(ue);if(B.needGeometry){const Ne=s.ak(_e,!0);if(!B.filter(new s.H(this.tileID.overscaledZ),Ne,this.tileID.canonical))continue}else if(!B.filter(new s.H(this.tileID.overscaledZ),_e))continue;const Ce=v.getId(_e,I),Fe=new s.al(_e,W,Z,J,Ce);Fe.tile=he,l.push(Fe)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(l){const f=this.expirationTime;if(l.cacheControl){const v=s.am(l.cacheControl);v["max-age"]&&(this.expirationTime=Date.now()+1e3*v["max-age"])}else l.expires&&(this.expirationTime=new Date(l.expires).getTime());if(this.expirationTime){const v=Date.now();let w=!1;if(this.expirationTime>v)w=!1;else if(f)if(this.expirationTime<f)w=!0;else{const I=this.expirationTime-f;I?this.expirationTime=v+Math.max(I,3e4):w=!0}else w=!0;w?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(l,f){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(l).length===0)return;const v=this.latestFeatureIndex.loadVTLayers();for(const w in this.buckets){if(!f.style.hasLayer(w))continue;const I=this.buckets[w],k=I.layers[0].sourceLayer||s.ai,B=v[k],W=l[k];if(!B||!W||Object.keys(W).length===0)continue;I.update(W,B,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const Z=f&&f.style&&f.style.getLayer(w);Z&&(this.queryPadding=Math.max(this.queryPadding,Z.queryRadius(I)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<P()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(l){this.symbolFadeHoldUntil=P()+l}setDependencies(l,f){const v={};for(const w of f)v[w]=!0;this.dependencies[l]=v}hasDependency(l,f){for(const v of l){const w=this.dependencies[v];if(w){for(const I of f)if(w[I])return!0}}return!1}}class Bt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(l,f,v){const w=String(f);if(this.stateChanges[l]=this.stateChanges[l]||{},this.stateChanges[l][w]=this.stateChanges[l][w]||{},s.e(this.stateChanges[l][w],v),this.deletedStates[l]===null){this.deletedStates[l]={};for(const I in this.state[l])I!==w&&(this.deletedStates[l][I]=null)}else if(this.deletedStates[l]&&this.deletedStates[l][w]===null){this.deletedStates[l][w]={};for(const I in this.state[l][w])v[I]||(this.deletedStates[l][w][I]=null)}else for(const I in v)this.deletedStates[l]&&this.deletedStates[l][w]&&this.deletedStates[l][w][I]===null&&delete this.deletedStates[l][w][I]}removeFeatureState(l,f,v){if(this.deletedStates[l]===null)return;const w=String(f);if(this.deletedStates[l]=this.deletedStates[l]||{},v&&f!==void 0)this.deletedStates[l][w]!==null&&(this.deletedStates[l][w]=this.deletedStates[l][w]||{},this.deletedStates[l][w][v]=null);else if(f!==void 0)if(this.stateChanges[l]&&this.stateChanges[l][w])for(v in this.deletedStates[l][w]={},this.stateChanges[l][w])this.deletedStates[l][w][v]=null;else this.deletedStates[l][w]=null;else this.deletedStates[l]=null}getState(l,f){const v=String(f),w=s.e({},(this.state[l]||{})[v],(this.stateChanges[l]||{})[v]);if(this.deletedStates[l]===null)return{};if(this.deletedStates[l]){const I=this.deletedStates[l][f];if(I===null)return{};for(const k in I)delete w[k]}return w}initializeTileState(l,f){l.setFeatureState(this.state,f)}coalesceChanges(l,f){const v={};for(const w in this.stateChanges){this.state[w]=this.state[w]||{};const I={};for(const k in this.stateChanges[w])this.state[w][k]||(this.state[w][k]={}),s.e(this.state[w][k],this.stateChanges[w][k]),I[k]=this.state[w][k];v[w]=I}for(const w in this.deletedStates){this.state[w]=this.state[w]||{};const I={};if(this.deletedStates[w]===null)for(const k in this.state[w])I[k]={},this.state[w][k]={};else for(const k in this.deletedStates[w]){if(this.deletedStates[w][k]===null)this.state[w][k]={};else for(const B of Object.keys(this.deletedStates[w][k]))delete this.state[w][k][B];I[k]=this.state[w][k]}v[w]=v[w]||{},s.e(v[w],I)}this.stateChanges={},this.deletedStates={},Object.keys(v).length!==0&&l.setFeatureState(v,f)}}const Jt=89.25;function vi(A,l){const f=s.an(l.lat,-s.ao,s.ao);return new s.P(s.Y(l.lng)*A,s.X(f)*A)}function $i(A,l){return new s.a9(l.x/A,l.y/A).toLngLat()}function vn(A){return A.cameraToCenterDistance*Math.min(.85*Math.tan(s.ap(90-A.pitch)),Math.tan(s.ap(Jt-A.pitch)))}function on(A,l){const f=A.canonical,v=l/s.aq(f.z),w=f.x+Math.pow(2,f.z)*A.wrap,I=s.ar(new Float64Array(16));return s.O(I,I,[w*v,f.y*v,0]),s.Q(I,I,[v/s.a5,v/s.a5,1]),I}function Tt(A,l,f,v,w){const I=s.a9.fromLngLat(A,l),k=w*s.as(1,A.lat),{x:B,y:W,z:Z}=gn(f,v);return new s.a9(I.x+k*-B,I.y+k*-W,I.z+k*-Z)}function gn(A,l){const f=s.ap(A),v=s.ap(l),w=Math.cos(-f),I=Math.sin(f);return{x:I*Math.sin(v),y:-I*Math.cos(v),z:w}}function Er(A,l,f){const v=l.intersectsFrustum(A);if(!f||v===0)return v;const w=l.intersectsPlane(f);return w===0?0:v===2&&w===2?2:1}function Di(A,l,f){let v=0;const w=(f-l)/10;for(let I=0;I<10;I++)v+=w*Math.pow(Math.cos(l+(I+.5)/10*(f-l)),A);return v}function yn(A,l){return function(f,v,w,I,k){const B=2*((A-1)/s.at(Math.cos(s.ap(Jt-k))/Math.cos(s.ap(Jt)))-1),W=Math.acos(w/I),Z=2*Di(B-1,0,s.ap(k/2)),J=Math.min(s.ap(Jt),W+s.ap(k/2)),he=Di(B-1,Math.min(J,W-s.ap(k/2)),J),ue=Math.atan(v/w),_e=Math.hypot(v,w);let Ce=f;return Ce+=s.at(I/_e/Math.max(.5,Math.cos(s.ap(k/2)))),Ce+=B*s.at(Math.cos(ue))/2,Ce-=s.at(Math.max(1,he/Z/l))/2,Ce}}const Yn=yn(9.314,3);function Cn(A,l){const f=(l.roundZoom?Math.round:Math.floor)(A.zoom+s.at(A.tileSize/l.tileSize));return Math.max(0,f)}function Un(A,l){const f=A.getCameraFrustum(),v=A.getClippingPlane(),w=A.screenPointToMercatorCoordinate(A.getCameraPoint()),I=s.a9.fromLngLat(A.center,A.elevation);w.z=I.z+Math.cos(A.pitchInRadians)*A.cameraToCenterDistance/A.worldSize;const k=A.getCoveringTilesDetailsProvider(),B=k.allowVariableZoom(A,l),W=Cn(A,l),Z=l.minzoom||0,J=l.maxzoom!==void 0?l.maxzoom:A.maxZoom,he=Math.min(Math.max(0,W),J),ue=Math.pow(2,he),_e=[ue*w.x,ue*w.y,0],Ce=[ue*I.x,ue*I.y,0],Fe=Math.hypot(I.x-w.x,I.y-w.y),Ne=Math.abs(I.z-w.z),ze=Math.hypot(Fe,Ne),We=Qe=>({zoom:0,x:0,y:0,wrap:Qe,fullyVisible:!1}),tt=[],je=[];if(A.renderWorldCopies&&k.allowWorldCopies())for(let Qe=1;Qe<=3;Qe++)tt.push(We(-Qe)),tt.push(We(Qe));for(tt.push(We(0));tt.length>0;){const Qe=tt.pop(),at=Qe.x,Ke=Qe.y;let mt=Qe.fullyVisible;const Lt={x:at,y:Ke,z:Qe.zoom},Et=k.getTileBoundingVolume(Lt,Qe.wrap,A.elevation,l);if(!mt){const ti=Er(f,Et,v);if(ti===0)continue;mt=ti===2}const At=k.distanceToTile2d(w.x,w.y,Lt,Et);let Pt=W;B&&(Pt=(l.calculateTileZoom||Yn)(A.zoom+s.at(A.tileSize/l.tileSize),At,Ne,ze,A.fov)),Pt=(l.roundZoom?Math.round:Math.floor)(Pt),Pt=Math.max(0,Pt);const Qt=Math.min(Pt,J);if(Qe.wrap=k.getWrap(I,Lt,Qe.wrap),Qe.zoom>=Qt){if(Qe.zoom<Z)continue;const ti=he-Qe.zoom,Xt=_e[0]-.5-(at<<ti),si=_e[1]-.5-(Ke<<ti),Yi=l.reparseOverscaled?Math.max(Qe.zoom,Pt):Qe.zoom;je.push({tileID:new s.a2(Qe.zoom===J?Yi:Qe.zoom,Qe.wrap,Qe.zoom,at,Ke),distanceSq:s.au([Ce[0]-.5-at,Ce[1]-.5-Ke]),tileDistanceToCamera:Math.sqrt(Xt*Xt+si*si)})}else for(let ti=0;ti<4;ti++)tt.push({zoom:Qe.zoom+1,x:(at<<1)+ti%2,y:(Ke<<1)+(ti>>1),wrap:Qe.wrap,fullyVisible:mt})}return je.sort(((Qe,at)=>Qe.distanceSq-at.distanceSq)).map((Qe=>Qe.tileID))}const En=s.aa.fromPoints([new s.P(0,0),new s.P(s.a5,s.a5)]);function dr(A){return A==="raster"||A==="image"||A==="video"}function Xe(A,l,f,v,w,I,k){if(!l.hasData())return!1;const{tileID:B,fadingRole:W,fadingDirection:Z,fadingParentID:J}=l;if(W===rt.Base&&Z===St.Incoming&&J)return f[J.key]=J,!0;const he=Math.max(B.overscaledZ-w,I);for(let ue=B.overscaledZ-1;ue>=he;ue--){const _e=B.scaledTo(ue),Ce=A.getLoadedTile(_e);if(Ce)return l.setCrossFadeLogic({fadingRole:rt.Base,fadingDirection:St.Incoming,fadingParentID:Ce.tileID,fadeEndTime:v+k}),Ce.setCrossFadeLogic({fadingRole:rt.Parent,fadingDirection:St.Departing,fadeEndTime:v+k}),f[_e.key]=_e,!0}return!1}function kt(A,l,f,v,w,I){if(!l.hasData())return!1;const k=l.tileID.children(w);let B=lt(A,l,k,f,v,w,I);if(B)return!0;for(const W of k)lt(A,l,W.children(w),f,v,w,I)&&(B=!0);return B}function lt(A,l,f,v,w,I,k){if(f[0].overscaledZ>=I)return!1;let B=!1;for(const W of f){const Z=A.getLoadedTile(W);if(!Z)continue;const{fadingRole:J,fadingDirection:he,fadingParentID:ue}=Z;J===rt.Base&&he===St.Departing&&ue||(Z.setCrossFadeLogic({fadingRole:rt.Base,fadingDirection:St.Departing,fadingParentID:l.tileID,fadeEndTime:w+k}),l.setCrossFadeLogic({fadingRole:rt.Parent,fadingDirection:St.Incoming,fadeEndTime:w+k})),v[W.key]=W,B=!0}return B}function Ft(A,l,f,v){const w=A.tileID;return!!A.selfFading||!A.hasData()&&!!l.has(w)&&(A.setSelfFadeLogic(f+v),!0)}function Wt(A,l){var f;A.needsHillshadePrepare=!0,A.needsTerrainPrepare=!0;let v=l.tileID.canonical.x-A.tileID.canonical.x;const w=l.tileID.canonical.y-A.tileID.canonical.y,I=Math.pow(2,A.tileID.canonical.z),k=l.tileID.key;v===0&&w===0||Math.abs(w)>1||(Math.abs(v)>1&&(Math.abs(v+I)===1?v+=I:Math.abs(v-I)===1&&(v-=I)),l.dem&&A.dem&&(A.dem.backfillBorder(l.dem,v,w),!((f=A.neighboringTiles)===null||f===void 0)&&f[k]&&(A.neighboringTiles[k].backfilled=!0)))}class qi{constructor(){this._tiles={}}handleWrapJump(l){const f={};for(const v in this._tiles){const w=this._tiles[v];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+l),f[w.tileID.key]=w}this._tiles=f}setFeatureState(l,f){for(const v in this._tiles)this._tiles[v].setFeatureState(l,f)}getAllTiles(){return Object.values(this._tiles)}getAllIds(l=!1){return l?Object.values(this._tiles).map((f=>f.tileID)).sort(s.aw).map((f=>f.key)):Object.keys(this._tiles)}getTileById(l){return this._tiles[l]}setTile(l,f){this._tiles[l]=f}deleteTileById(l){delete this._tiles[l]}getLoadedTile(l){const f=this.getTileById(l.key);return f?.hasData()?f:null}isIdRenderable(l,f=!1){var v;return(v=this.getTileById(l))===null||v===void 0?void 0:v.isRenderable(f)}getRenderableIds(l=0,f){const v=[];for(const w of this.getAllIds())this.isIdRenderable(w,f)&&v.push(this.getTileById(w));return f?v.sort(((w,I)=>{const k=w.tileID,B=I.tileID,W=new s.P(k.canonical.x,k.canonical.y)._rotate(-l),Z=new s.P(B.canonical.x,B.canonical.y)._rotate(-l);return k.overscaledZ-B.overscaledZ||Z.y-W.y||Z.x-W.x})).map((w=>w.tileID.key)):v.map((w=>w.tileID)).sort(s.aw).map((w=>w.key))}}class Ii extends s.E{constructor(l,f,v){super(),this.id=l,this.dispatcher=v,this.on("data",(w=>this._dataHandler(w))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((w,I,k,B)=>{const W=new(pe(I.type))(w,I,k,B);if(W.id!==w)throw new Error(`Expected Source id to be ${w} instead of ${W.id}`);return W})(l,f,v,this),this._inViewTiles=new qi,this._outOfViewCache=new s.ax(0,(w=>this._unloadTile(w))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new Bt,this._didEmitContent=!1,this._updated=!1}onAdd(l){this.map=l,this._maxTileCacheSize=l?l._maxTileCacheSize:null,this._maxTileCacheZoomLevels=l?l._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(l)}onRemove(l){for(const f of this._inViewTiles.getAllTiles())f.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(l),this._inViewTiles=new qi}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const l of this._inViewTiles.getAllTiles())if(l.state!=="loaded"&&l.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const l=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,l&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(l,f,v){return s._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(l),this._tileLoaded(l,f,v)}catch(w){l.state="errored",w.status!==404?this._source.fire(new s.k(w,{tile:l})):this.update(this.transform,this.terrain)}}))}_unloadTile(l){this._source.unloadTile&&this._source.unloadTile(l)}_abortTile(l){this._source.abortTile&&this._source.abortTile(l),this._source.fire(new s.l("dataabort",{tile:l,coord:l.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(l){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const f of this._inViewTiles.getAllTiles())f.upload(l),f.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(l){var f;return this._inViewTiles.getRenderableIds((f=this.transform)===null||f===void 0?void 0:f.bearingInRadians,l)}hasRenderableParent(l){const f=l.overscaledZ-1;if(f>=this._source.minzoom){const v=this.getLoadedTile(l.scaledTo(f));if(v)return this._inViewTiles.isIdRenderable(v.tileID.key)}return!1}reload(l,f=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const v of this._inViewTiles.getAllIds()){const w=this._inViewTiles.getTileById(v);f&&!this._source.shouldReloadTile(w,f)||(l?this._reloadTile(v,"expired"):w.state!=="errored"&&this._reloadTile(v,"reloading"))}}}_reloadTile(l,f){return s._(this,void 0,void 0,(function*(){const v=this._inViewTiles.getTileById(l);v&&(v.state!=="loading"&&(v.state=f),yield this._loadTile(v,l,f))}))}_tileLoaded(l,f,v){l.timeAdded=P(),l.selfFading&&(l.fadeEndTime=l.timeAdded+this._rasterFadeDuration),v==="expired"&&(l.refreshedUponExpiration=!0),this._setTileReloadTimer(f,l),this.getSource().type==="raster-dem"&&l.dem&&(function(w,I){var k,B;const W=I.getRenderableIds();for(const Z of W){if(!w.neighboringTiles||!w.neighboringTiles[Z])continue;const J=I.getTileById(Z);w.neighboringTiles[Z].backfilled||Wt(w,J),!((B=(k=J.neighboringTiles)===null||k===void 0?void 0:k[w.tileID.key])===null||B===void 0)&&B.backfilled||Wt(J,w)}})(l,this._inViewTiles),this._state.initializeTileState(l,this.map?this.map.painter:null),l.aborted||this._source.fire(new s.l("data",{dataType:"source",tile:l,coord:l.tileID}))}getTile(l){return this.getTileByID(l.key)}getTileByID(l){return this._inViewTiles.getTileById(l)}_retainLoadedChildren(l,f){const v=this._getLoadedDescendents(f),w=new Set;for(const I of f){const k=v[I.key];if(!k?.length){w.add(I);continue}const B=I.overscaledZ+Ii.maxOverzooming,W=k.filter((he=>he.tileID.overscaledZ<=B));if(!W.length){w.add(I);continue}const Z=Math.min(...W.map((he=>he.tileID.overscaledZ))),J=W.filter((he=>he.tileID.overscaledZ===Z)).map((he=>he.tileID));for(const he of J)l[he.key]=he;this._areDescendentsComplete(J,Z,I.overscaledZ)||w.add(I)}return w}_getLoadedDescendents(l){var f;const v={};for(const w of this._inViewTiles.getAllTiles().filter((I=>I.hasData())))for(const I of l)w.tileID.isChildOf(I)&&(v[f=I.key]||(v[f]=[])).push(w);return v}_areDescendentsComplete(l,f,v){return l.length===1&&l[0].isOverscaled()?l[0].overscaledZ===f:Math.pow(4,f-v)===l.length}getLoadedTile(l){return this._inViewTiles.getLoadedTile(l)}updateCacheSize(l){const f=Math.ceil(l.width/this._source.tileSize)+1,v=Math.ceil(l.height/this._source.tileSize)+1,w=Math.floor(f*v*(this._maxTileCacheZoomLevels===null?s.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),I=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._outOfViewCache.setMaxSize(I)}handleWrapJump(l){const f=Math.round((l-(this._prevLng===void 0?l:this._prevLng))/360);this._prevLng=l,f&&(this._inViewTiles.handleWrapJump(f),this._resetTileReloadTimers())}update(l,f){if(!this._sourceLoaded||this._paused)return;let v;this.transform=l,this.terrain=f,this.updateCacheSize(l),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?v=l.getVisibleUnwrappedCoordinates(this._source.tileID).map((W=>new s.a2(W.canonical.z,W.wrap,W.canonical.z,W.canonical.x,W.canonical.y))):(v=Un(l,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?l.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:f,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(v=v.filter((W=>this._source.hasTile(W))))):v=[],this.usedForTerrain&&(v=this._addTerrainIdealTiles(v));const w=v.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new s.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const I=Cn(l,this._source),k=this._updateRetainedTiles(v,I),B=dr(this._source.type);B&&this._rasterFadeDuration>0&&!f&&(function(W,Z,J,he,ue,_e,Ce){const Fe=P(),Ne=s.av(Z);for(const ze of Z){const We=W.getTileById(ze.key);We.fadingDirection!==St.Departing&&We.fadeOpacity!==0||We.resetFadeLogic(),Xe(W,We,J,Fe,he,ue,Ce)||kt(W,We,J,Fe,_e,Ce)||Ft(We,Ne,Fe,Ce)||We.resetFadeLogic()}})(this._inViewTiles,v,k,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),B?this._cleanUpRasterTiles(k):this._cleanUpVectorTiles(k)}_cleanUpRasterTiles(l){for(const f of this._inViewTiles.getAllIds())l[f]||this._removeTile(f)}_cleanUpVectorTiles(l){for(const f of this._inViewTiles.getAllIds()){const v=this._inViewTiles.getTileById(f);l[f]?v.clearSymbolFadeHold():v.hasSymbolBuckets?v.holdingForSymbolFade()?v.symbolFadeFinished()&&this._removeTile(f):v.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(f)}}_addTerrainIdealTiles(l){const f=[];for(const v of l)if(v.canonical.z>this._source.minzoom){const w=v.scaledTo(v.canonical.z-1);f.push(w);const I=v.scaledTo(Math.max(this._source.minzoom,Math.min(v.canonical.z,5)));f.push(I)}return l.concat(f)}releaseSymbolFadeTiles(){for(const l of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(l).holdingForSymbolFade()&&this._removeTile(l)}_updateRetainedTiles(l,f){var v;const w=new Set;for(const Z of l)this._addTile(Z).hasData()||w.add(Z);const I=l.reduce(((Z,J)=>(Z[J.key]=J,Z)),{}),k=this._retainLoadedChildren(I,w),B={},W=Math.max(f-Ii.maxUnderzooming,this._source.minzoom);for(const Z of k){let J=this._inViewTiles.getTileById(Z.key),he=J?.wasRequested();for(let ue=Z.overscaledZ-1;ue>=W;--ue){const _e=Z.scaledTo(ue);if(B[_e.key])break;if(B[_e.key]=!0,J=this.getTile(_e),!J&&he&&(J=this._addTile(_e)),J){const Ce=J.hasData();if((Ce||!(!((v=this.map)===null||v===void 0)&&v.cancelPendingTileRequestsWhileZooming)||he)&&(I[_e.key]=_e),he=J.wasRequested(),Ce)break}}}return I}_addTile(l){let f=this._inViewTiles.getTileById(l.key);if(f)return f;f=this._outOfViewCache.getAndRemove(l),f&&(f.resetFadeLogic(),this._setTileReloadTimer(l.key,f),f.tileID=l,this._state.initializeTileState(f,this.map?this.map.painter:null));const v=f;return f||(f=new Dt(l,this._source.tileSize*l.overscaleFactor()),this._loadTile(f,l.key,f.state)),f.uses++,this._inViewTiles.setTile(l.key,f),v||this._source.fire(new s.l("dataloading",{tile:f,coord:f.tileID,dataType:"source"})),f}_setTileReloadTimer(l,f){this._clearTileReloadTimer(l);const v=f.getExpiryTimeout();v&&(this._timers[l]=setTimeout((()=>{this._reloadTile(l,"expired"),delete this._timers[l]}),v))}_clearTileReloadTimer(l){const f=this._timers[l];f&&(clearTimeout(f),delete this._timers[l])}_resetTileReloadTimers(){for(const l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(const l of this._inViewTiles.getAllIds()){const f=this._inViewTiles.getTileById(l);this._setTileReloadTimer(l,f)}}refreshTiles(l){for(const f of this._inViewTiles.getAllIds()){const v=this._inViewTiles.getTileById(f);(this._inViewTiles.isIdRenderable(f)||v.state=="errored")&&l.some((w=>w.equals(v.tileID.canonical)))&&this._reloadTile(f,"expired")}}_removeTile(l){const f=this._inViewTiles.getTileById(l);f&&(f.uses--,this._inViewTiles.deleteTileById(l),this._clearTileReloadTimer(l),f.uses>0||(f.hasData()&&f.state!=="reloading"?this._outOfViewCache.add(f.tileID,f,f.getExpiryTimeout()):(f.aborted=!0,this._abortTile(f),this._unloadTile(f))))}_dataHandler(l){l.dataType==="source"&&(l.sourceDataType!=="metadata"?l.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(l.sourceDataChanged,l.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const l of this._inViewTiles.getAllIds())this._removeTile(l);this._outOfViewCache.reset()}tilesIn(l,f,v){const w=[],I=this.transform;if(!I)return w;const k=I.getCoveringTilesDetailsProvider().allowWorldCopies(),B=v?I.getCameraQueryGeometry(l):l,W=_e=>I.screenPointToMercatorCoordinate(_e,this.terrain),Z=this.transformBbox(l,W,!k),J=this.transformBbox(B,W,!k),he=this.getIds(),ue=s.aa.fromPoints(J);for(let _e=0;_e<he.length;_e++){const Ce=this._inViewTiles.getTileById(he[_e]);if(Ce.holdingForSymbolFade())continue;const Fe=k?[Ce.tileID]:[Ce.tileID.unwrapTo(-1),Ce.tileID.unwrapTo(0)],Ne=Math.pow(2,I.zoom-Ce.tileID.overscaledZ),ze=f*Ce.queryPadding*s.a5/Ce.tileSize/Ne;for(const We of Fe){const tt=ue.map((je=>We.getTilePoint(new s.a9(je.x,je.y))));if(tt.expandBy(ze),tt.intersects(En)){const je=Z.map((at=>We.getTilePoint(at))),Qe=J.map((at=>We.getTilePoint(at)));w.push({tile:Ce,tileID:k?We:We.unwrapTo(0),queryGeometry:je,cameraQueryGeometry:Qe,scale:Ne})}}}return w}transformBbox(l,f,v){let w=l.map(f);if(v){const I=s.aa.fromPoints(l);I.shrinkBy(.001*Math.min(I.width(),I.height()));const k=I.map(f);s.aa.fromPoints(w).covers(k)||(w=w.map((B=>B.x>.5?new s.a9(B.x-1,B.y,B.z):B)))}return w}getVisibleCoordinates(l){const f=this.getRenderableIds(l).map((v=>this._inViewTiles.getTileById(v).tileID));return this.transform&&this.transform.populateCache(f),f}hasTransition(){return!!this._source.hasTransition()||!(!dr(this._source.type)||!(function(l,f){if(f<=0)return!1;const v=P();for(const w of l.getAllTiles())if(w.fadeEndTime>=v)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(l){this._rasterFadeDuration=l}setFeatureState(l,f,v){this._state.updateState(l=l||s.ai,f,v)}removeFeatureState(l,f,v){this._state.removeFeatureState(l=l||s.ai,f,v)}getFeatureState(l,f){return this._state.getState(l=l||s.ai,f)}setDependencies(l,f,v){const w=this._inViewTiles.getTileById(l);w&&w.setDependencies(f,v)}reloadTilesForDependencies(l,f){for(const v of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(v).hasDependency(l,f)&&this._reloadTile(v,"reloading");this._outOfViewCache.filter((v=>!v.hasDependency(l,f)))}areTilesLoaded(){for(const l of this._inViewTiles.getAllTiles())if(l.state!=="loaded"&&l.state!=="errored")return!1;return!0}}Ii.maxUnderzooming=10,Ii.maxOverzooming=3;class Nt{constructor(l,f){this.reset(l,f)}reset(l,f){this.points=l||[],this._distances=[0];for(let v=1;v<this.points.length;v++)this._distances[v]=this._distances[v-1]+this.points[v].dist(this.points[v-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=s.an(l,0,1);let f=1,v=this._distances[f];const w=l*this.paddedLength+this.padding;for(;v<w&&f<this._distances.length;)v=this._distances[++f];const I=f-1,k=this._distances[I],B=v-k,W=B>0?(w-k)/B:0;return this.points[I].mult(1-W).add(this.points[f].mult(W))}}function ai(A,l){let f=!0;return A==="always"||A!=="never"&&l!=="never"||(f=!1),f}class pi{constructor(l,f,v){const w=this.boxCells=[],I=this.circleCells=[];this.xCellCount=Math.ceil(l/v),this.yCellCount=Math.ceil(f/v);for(let k=0;k<this.xCellCount*this.yCellCount;k++)w.push([]),I.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=f,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,f,v,w,I){this._forEachCell(f,v,w,I,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(f),this.bboxes.push(v),this.bboxes.push(w),this.bboxes.push(I)}insertCircle(l,f,v,w){this._forEachCell(f-w,v-w,f+w,v+w,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(f),this.circles.push(v),this.circles.push(w)}_insertBoxCell(l,f,v,w,I,k){this.boxCells[I].push(k)}_insertCircleCell(l,f,v,w,I,k){this.circleCells[I].push(k)}_query(l,f,v,w,I,k,B){if(v<0||l>this.width||w<0||f>this.height)return[];const W=[];if(l<=0&&f<=0&&this.width<=v&&this.height<=w){if(I)return[{key:null,x1:l,y1:f,x2:v,y2:w}];for(let Z=0;Z<this.boxKeys.length;Z++)W.push({key:this.boxKeys[Z],x1:this.bboxes[4*Z],y1:this.bboxes[4*Z+1],x2:this.bboxes[4*Z+2],y2:this.bboxes[4*Z+3]});for(let Z=0;Z<this.circleKeys.length;Z++){const J=this.circles[3*Z],he=this.circles[3*Z+1],ue=this.circles[3*Z+2];W.push({key:this.circleKeys[Z],x1:J-ue,y1:he-ue,x2:J+ue,y2:he+ue})}}else this._forEachCell(l,f,v,w,this._queryCell,W,{hitTest:I,overlapMode:k,seenUids:{box:{},circle:{}}},B);return W}query(l,f,v,w){return this._query(l,f,v,w,!1,null)}hitTest(l,f,v,w,I,k){return this._query(l,f,v,w,!0,I,k).length>0}hitTestCircle(l,f,v,w,I){const k=l-v,B=l+v,W=f-v,Z=f+v;if(B<0||k>this.width||Z<0||W>this.height)return!1;const J=[];return this._forEachCell(k,W,B,Z,this._queryCellCircle,J,{hitTest:!0,overlapMode:w,circle:{x:l,y:f,radius:v},seenUids:{box:{},circle:{}}},I),J.length>0}_queryCell(l,f,v,w,I,k,B,W){const{seenUids:Z,hitTest:J,overlapMode:he}=B,ue=this.boxCells[I];if(ue!==null){const Ce=this.bboxes;for(const Fe of ue)if(!Z.box[Fe]){Z.box[Fe]=!0;const Ne=4*Fe,ze=this.boxKeys[Fe];if(l<=Ce[Ne+2]&&f<=Ce[Ne+3]&&v>=Ce[Ne+0]&&w>=Ce[Ne+1]&&(!W||W(ze))&&(!J||!ai(he,ze.overlapMode))&&(k.push({key:ze,x1:Ce[Ne],y1:Ce[Ne+1],x2:Ce[Ne+2],y2:Ce[Ne+3]}),J))return!0}}const _e=this.circleCells[I];if(_e!==null){const Ce=this.circles;for(const Fe of _e)if(!Z.circle[Fe]){Z.circle[Fe]=!0;const Ne=3*Fe,ze=this.circleKeys[Fe];if(this._circleAndRectCollide(Ce[Ne],Ce[Ne+1],Ce[Ne+2],l,f,v,w)&&(!W||W(ze))&&(!J||!ai(he,ze.overlapMode))){const We=Ce[Ne],tt=Ce[Ne+1],je=Ce[Ne+2];if(k.push({key:ze,x1:We-je,y1:tt-je,x2:We+je,y2:tt+je}),J)return!0}}}return!1}_queryCellCircle(l,f,v,w,I,k,B,W){const{circle:Z,seenUids:J,overlapMode:he}=B,ue=this.boxCells[I];if(ue!==null){const Ce=this.bboxes;for(const Fe of ue)if(!J.box[Fe]){J.box[Fe]=!0;const Ne=4*Fe,ze=this.boxKeys[Fe];if(this._circleAndRectCollide(Z.x,Z.y,Z.radius,Ce[Ne+0],Ce[Ne+1],Ce[Ne+2],Ce[Ne+3])&&(!W||W(ze))&&!ai(he,ze.overlapMode))return k.push(!0),!0}}const _e=this.circleCells[I];if(_e!==null){const Ce=this.circles;for(const Fe of _e)if(!J.circle[Fe]){J.circle[Fe]=!0;const Ne=3*Fe,ze=this.circleKeys[Fe];if(this._circlesCollide(Ce[Ne],Ce[Ne+1],Ce[Ne+2],Z.x,Z.y,Z.radius)&&(!W||W(ze))&&!ai(he,ze.overlapMode))return k.push(!0),!0}}}_forEachCell(l,f,v,w,I,k,B,W){const Z=this._convertToXCellCoord(l),J=this._convertToYCellCoord(f),he=this._convertToXCellCoord(v),ue=this._convertToYCellCoord(w);for(let _e=Z;_e<=he;_e++)for(let Ce=J;Ce<=ue;Ce++)if(I.call(this,l,f,v,w,this.xCellCount*Ce+_e,k,B,W))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,f,v,w,I,k){const B=w-l,W=I-f,Z=v+k;return Z*Z>B*B+W*W}_circleAndRectCollide(l,f,v,w,I,k,B){const W=(k-w)/2,Z=Math.abs(l-(w+W));if(Z>W+v)return!1;const J=(B-I)/2,he=Math.abs(f-(I+J));if(he>J+v)return!1;if(Z<=W||he<=J)return!0;const ue=Z-W,_e=he-J;return ue*ue+_e*_e<=v*v}}function Wi(A,l,f){const v=s.N();if(!A){const{vecSouth:he,vecEast:ue}=Ri(l),_e=p();_e[0]=ue[0],_e[1]=ue[1],_e[2]=he[0],_e[3]=he[1],w=_e,(J=(k=(I=_e)[0])*(Z=I[3])-(W=I[2])*(B=I[1]))&&(w[0]=Z*(J=1/J),w[1]=-B*J,w[2]=-W*J,w[3]=k*J),v[0]=_e[0],v[1]=_e[1],v[4]=_e[2],v[5]=_e[3]}var w,I,k,B,W,Z,J;return s.Q(v,v,[1/f,1/f,1]),v}function wt(A,l,f,v){if(A){const w=s.N();if(!l){const{vecSouth:I,vecEast:k}=Ri(f);w[0]=k[0],w[1]=k[1],w[4]=I[0],w[5]=I[1]}return s.Q(w,w,[v,v,1]),w}return f.pixelsToClipSpaceMatrix}function Ri(A){const l=Math.cos(A.rollInRadians),f=Math.sin(A.rollInRadians),v=Math.cos(A.pitchInRadians),w=Math.cos(A.bearingInRadians),I=Math.sin(A.bearingInRadians),k=s.aC();k[0]=-w*v*f-I*l,k[1]=-I*v*f+w*l;const B=s.aD(k);B<1e-9?s.aE(k):s.aF(k,k,1/B);const W=s.aC();W[0]=w*v*l-I*f,W[1]=I*v*l+w*f;const Z=s.aD(W);return Z<1e-9?s.aE(W):s.aF(W,W,1/Z),{vecEast:W,vecSouth:k}}function bi(A,l,f,v){let w;v?(w=[A,l,v(A,l),1],s.aH(w,w,f)):(w=[A,l,0,1],Zl(w,w,f));const I=w[3];return{point:new s.P(w[0]/I,w[1]/I),signedDistanceFromCamera:I,isOccluded:!1}}function Ni(A,l){return .5+A/l*.5}function Kn(A,l){return A.x>=-l[0]&&A.x<=l[0]&&A.y>=-l[1]&&A.y<=l[1]}function Xi(A,l,f,v,w,I,k,B,W,Z,J,he,ue){const _e=f?A.textSizeData:A.iconSizeData,Ce=s.ay(_e,l.transform.zoom),Fe=[256/l.width*2+1,256/l.height*2+1],Ne=f?A.text.dynamicLayoutVertexArray:A.icon.dynamicLayoutVertexArray;Ne.clear();const ze=A.lineVertexArray,We=f?A.text.placedSymbolArray:A.icon.placedSymbolArray,tt=l.transform.width/l.transform.height;let je=!1;for(let Qe=0;Qe<We.length;Qe++){const at=We.get(Qe);if(at.hidden||at.writingMode===s.az.vertical&&!je){Hl(at.numGlyphs,Ne);continue}je=!1;const Ke=new s.P(at.anchorX,at.anchorY),mt={getElevation:ue,pitchedLabelPlaneMatrix:v,lineVertexArray:ze,pitchWithMap:I,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:l.transform,tileAnchorPoint:Ke,unwrappedTileID:W,width:Z,height:J,translation:he},Lt=ro(at.anchorX,at.anchorY,mt);if(!Kn(Lt.point,Fe)){Hl(at.numGlyphs,Ne);continue}const Et=Ni(l.transform.cameraToCenterDistance,Lt.signedDistanceFromCamera),At=s.aA(_e,Ce,at),Pt=I?At*l.transform.getPitchedTextCorrection(at.anchorX,at.anchorY,W)/Et:At*Et,Qt=zr({projectionContext:mt,pitchedLabelPlaneMatrixInverse:w,symbol:at,fontSize:Pt,flip:!1,keepUpright:k,glyphOffsetArray:A.glyphOffsetArray,dynamicLayoutVertexArray:Ne,aspectRatio:tt,rotateToLine:B});je=Qt.useVertical,(Qt.notEnoughRoom||je||Qt.needsFlipping&&zr({projectionContext:mt,pitchedLabelPlaneMatrixInverse:w,symbol:at,fontSize:Pt,flip:!0,keepUpright:k,glyphOffsetArray:A.glyphOffsetArray,dynamicLayoutVertexArray:Ne,aspectRatio:tt,rotateToLine:B}).notEnoughRoom)&&Hl(at.numGlyphs,Ne)}f?A.text.dynamicLayoutVertexBuffer.updateData(Ne):A.icon.dynamicLayoutVertexBuffer.updateData(Ne)}function jn(A,l,f,v,w,I,k,B){const W=I.glyphStartIndex+I.numGlyphs,Z=I.lineStartIndex,J=I.lineStartIndex+I.lineLength,he=l.getoffsetX(I.glyphStartIndex),ue=l.getoffsetX(W-1),_e=Ar(A*he,f,v,w,I.segment,Z,J,B,k);if(!_e)return null;const Ce=Ar(A*ue,f,v,w,I.segment,Z,J,B,k);return Ce?B.projectionCache.anyProjectionOccluded?null:{first:_e,last:Ce}:null}function an(A,l,f,v){return A===s.az.horizontal&&Math.abs(f.y-l.y)>Math.abs(f.x-l.x)*v?{useVertical:!0}:(A===s.az.vertical?l.y<f.y:l.x>f.x)?{needsFlipping:!0}:null}function zr(A){const{projectionContext:l,pitchedLabelPlaneMatrixInverse:f,symbol:v,fontSize:w,flip:I,keepUpright:k,glyphOffsetArray:B,dynamicLayoutVertexArray:W,aspectRatio:Z,rotateToLine:J}=A,he=w/24,ue=v.lineOffsetX*he,_e=v.lineOffsetY*he;let Ce;if(v.numGlyphs>1){const Fe=v.glyphStartIndex+v.numGlyphs,Ne=v.lineStartIndex,ze=v.lineStartIndex+v.lineLength,We=jn(he,B,ue,_e,I,v,J,l);if(!We)return{notEnoughRoom:!0};const tt=ns(We.first.point.x,We.first.point.y,l,f),je=ns(We.last.point.x,We.last.point.y,l,f);if(k&&!I){const Qe=an(v.writingMode,tt,je,Z);if(Qe)return Qe}Ce=[We.first];for(let Qe=v.glyphStartIndex+1;Qe<Fe-1;Qe++){const at=Ar(he*B.getoffsetX(Qe),ue,_e,I,v.segment,Ne,ze,l,J);if(!at)return{notEnoughRoom:!0};Ce.push(at)}Ce.push(We.last)}else{if(k&&!I){const Ne=tn(l.tileAnchorPoint.x,l.tileAnchorPoint.y,l).point,ze=v.lineStartIndex+v.segment+1,We=new s.P(l.lineVertexArray.getx(ze),l.lineVertexArray.gety(ze)),tt=tn(We.x,We.y,l),je=tt.signedDistanceFromCamera>0?tt.point:Gn(l.tileAnchorPoint,We,Ne,1,l),Qe=ns(Ne.x,Ne.y,l,f),at=ns(je.x,je.y,l,f),Ke=an(v.writingMode,Qe,at,Z);if(Ke)return Ke}const Fe=Ar(he*B.getoffsetX(v.glyphStartIndex),ue,_e,I,v.segment,v.lineStartIndex,v.lineStartIndex+v.lineLength,l,J);if(!Fe||l.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Ce=[Fe]}for(const Fe of Ce)s.aG(W,Fe.point,Fe.angle);return{}}function Gn(A,l,f,v,w){const I=A.add(A.sub(l)._unit()),k=tn(I.x,I.y,w).point,B=f.sub(k);return f.add(B._mult(v/B.mag()))}function ln(A,l,f){const v=l.projectionCache;if(v.projections[A])return v.projections[A];const w=new s.P(l.lineVertexArray.getx(A),l.lineVertexArray.gety(A)),I=tn(w.x,w.y,l);if(I.signedDistanceFromCamera>0)return v.projections[A]=I.point,v.anyProjectionOccluded=v.anyProjectionOccluded||I.isOccluded,I.point;const k=A-f.direction;return Gn(f.distanceFromAnchor===0?l.tileAnchorPoint:new s.P(l.lineVertexArray.getx(k),l.lineVertexArray.gety(k)),w,f.previousVertex,f.absOffsetX-f.distanceFromAnchor+1,l)}function tn(A,l,f){const v=A+f.translation[0],w=l+f.translation[1];let I;return f.pitchWithMap?(I=bi(v,w,f.pitchedLabelPlaneMatrix,f.getElevation),I.isOccluded=!1):(I=f.transform.projectTileCoordinates(v,w,f.unwrappedTileID,f.getElevation),I.point.x=(.5*I.point.x+.5)*f.width,I.point.y=(.5*-I.point.y+.5)*f.height),I}function ns(A,l,f,v){if(f.pitchWithMap){const w=[A,l,0,1];return s.aH(w,w,v),f.transform.projectTileCoordinates(w[0]/w[3],w[1]/w[3],f.unwrappedTileID,f.getElevation).point}return{x:A/f.width*2-1,y:1-l/f.height*2}}function ro(A,l,f){return f.transform.projectTileCoordinates(A,l,f.unwrappedTileID,f.getElevation)}function dl(A,l,f){return A._unit()._perp()._mult(l*f)}function xo(A,l,f,v,w,I,k,B,W){if(B.projectionCache.offsets[A])return B.projectionCache.offsets[A];const Z=f.add(l);if(A+W.direction<v||A+W.direction>=w)return B.projectionCache.offsets[A]=Z,Z;const J=ln(A+W.direction,B,W),he=dl(J.sub(f),k,W.direction),ue=f.add(he),_e=J.add(he);return B.projectionCache.offsets[A]=s.aI(I,Z,ue,_e)||Z,B.projectionCache.offsets[A]}function Ar(A,l,f,v,w,I,k,B,W){const Z=v?A-l:A+l;let J=Z>0?1:-1,he=0;v&&(J*=-1,he=Math.PI),J<0&&(he+=Math.PI);let ue,_e=J>0?I+w:I+w+1;B.projectionCache.cachedAnchorPoint?ue=B.projectionCache.cachedAnchorPoint:(ue=tn(B.tileAnchorPoint.x,B.tileAnchorPoint.y,B).point,B.projectionCache.cachedAnchorPoint=ue);let Ce,Fe,Ne=ue,ze=ue,We=0,tt=0;const je=Math.abs(Z),Qe=[];let at;for(;We+tt<=je;){if(_e+=J,_e<I||_e>=k)return null;We+=tt,ze=Ne,Fe=Ce;const Lt={absOffsetX:je,direction:J,distanceFromAnchor:We,previousVertex:ze};if(Ne=ln(_e,B,Lt),f===0)Qe.push(ze),at=Ne.sub(ze);else{let Et;const At=Ne.sub(ze);Et=At.mag()===0?dl(ln(_e+J,B,Lt).sub(Ne),f,J):dl(At,f,J),Fe||(Fe=ze.add(Et)),Ce=xo(_e,Et,Ne,I,k,Fe,f,B,Lt),Qe.push(Fe),at=Ce.sub(Fe)}tt=at.mag()}const Ke=at._mult((je-We)/tt)._add(Fe||ze),mt=he+Math.atan2(Ne.y-ze.y,Ne.x-ze.x);return Qe.push(Ke),{point:Ke,angle:W?mt:0,path:Qe}}const nr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Hl(A,l){for(let f=0;f<A;f++){const v=l.length;l.resize(v+4),l.float32.set(nr,3*v)}}function Zl(A,l,f){const v=l[0],w=l[1];return A[0]=f[0]*v+f[4]*w+f[12],A[1]=f[1]*v+f[5]*w+f[13],A[3]=f[3]*v+f[7]*w+f[15],A}const _r=100;class Pp{constructor(l,f=new pi(l.width+200,l.height+200,25),v=new pi(l.width+200,l.height+200,25)){this.transform=l,this.grid=f,this.ignoredGrid=v,this.pitchFactor=Math.cos(l.pitch*Math.PI/180)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+_r,this.screenBottomBoundary=l.height+_r,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(l,f,v,w,I,k,B,W,Z,J,he,ue){const _e=this.projectAndGetPerspectiveRatio(l.anchorPointX+W[0],l.anchorPointY+W[1],I,J,ue),Ce=v*_e.perspectiveRatio;let Fe;if(k||B)Fe=this._projectCollisionBox(l,Ce,w,I,k,B,W,_e,J,he,ue);else{const at=_e.x+(he?he.x*Ce:0),Ke=_e.y+(he?he.y*Ce:0);Fe={allPointsOccluded:!1,box:[at+l.x1*Ce,Ke+l.y1*Ce,at+l.x2*Ce,Ke+l.y2*Ce]}}const[Ne,ze,We,tt]=Fe.box,je=k?Fe.allPointsOccluded:_e.isOccluded;let Qe=je;return Qe||(Qe=_e.perspectiveRatio<this.perspectiveRatioCutoff),Qe||(Qe=!this.isInsideGrid(Ne,ze,We,tt)),Qe||f!=="always"&&this.grid.hitTest(Ne,ze,We,tt,f,Z)?{box:[Ne,ze,We,tt],placeable:!1,offscreen:!1,occluded:je}:{box:[Ne,ze,We,tt],placeable:!0,offscreen:this.isOffscreen(Ne,ze,We,tt),occluded:je}}placeCollisionCircles(l,f,v,w,I,k,B,W,Z,J,he,ue,_e,Ce){const Fe=[],Ne=new s.P(f.anchorX,f.anchorY),ze=this.getPerspectiveRatio(Ne.x,Ne.y,k,Ce),We=(Z?I*this.transform.getPitchedTextCorrection(f.anchorX,f.anchorY,k)/ze:I*ze)/s.aM,tt={getElevation:Ce,pitchedLabelPlaneMatrix:B,lineVertexArray:v,pitchWithMap:Z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:Ne,unwrappedTileID:k,width:this.transform.width,height:this.transform.height,translation:_e},je=jn(We,w,f.lineOffsetX*We,f.lineOffsetY*We,!1,f,!1,tt);let Qe=!1,at=!1,Ke=!0;if(je){const mt=.5*he*ze+ue,Lt=new s.P(-100,-100),Et=new s.P(this.screenRightBoundary,this.screenBottomBoundary),At=new Nt,Pt=je.first,Qt=je.last;let ti=[];for(let Yi=Pt.path.length-1;Yi>=1;Yi--)ti.push(Pt.path[Yi]);for(let Yi=1;Yi<Qt.path.length;Yi++)ti.push(Qt.path[Yi]);const Xt=2.5*mt;if(Z){const Yi=this.projectPathToScreenSpace(ti,tt);ti=Yi.some((kn=>kn.signedDistanceFromCamera<=0))?[]:Yi.map((kn=>kn.point))}let si=[];if(ti.length>0){const Yi=ti[0].clone(),kn=ti[0].clone();for(let pr=1;pr<ti.length;pr++)Yi.x=Math.min(Yi.x,ti[pr].x),Yi.y=Math.min(Yi.y,ti[pr].y),kn.x=Math.max(kn.x,ti[pr].x),kn.y=Math.max(kn.y,ti[pr].y);si=Yi.x>=Lt.x&&kn.x<=Et.x&&Yi.y>=Lt.y&&kn.y<=Et.y?[ti]:kn.x<Lt.x||Yi.x>Et.x||kn.y<Lt.y||Yi.y>Et.y?[]:s.aJ([ti],Lt.x,Lt.y,Et.x,Et.y)}for(const Yi of si){At.reset(Yi,.25*mt);let kn=0;kn=At.length<=.5*mt?1:Math.ceil(At.paddedLength/Xt)+1;for(let pr=0;pr<kn;pr++){const Jn=pr/Math.max(kn-1,1),br=At.lerp(Jn),Qn=br.x+_r,Br=br.y+_r;Fe.push(Qn,Br,mt,0);const xr=Qn-mt,Ps=Br-mt,rs=Qn+mt,Zr=Br+mt;if(Ke=Ke&&this.isOffscreen(xr,Ps,rs,Zr),at=at||this.isInsideGrid(xr,Ps,rs,Zr),l!=="always"&&this.grid.hitTestCircle(Qn,Br,mt,l,J)&&(Qe=!0,!W))return{circles:[],offscreen:!1,collisionDetected:Qe}}}}return{circles:!W&&Qe||!at||ze<this.perspectiveRatioCutoff?[]:Fe,offscreen:Ke,collisionDetected:Qe}}projectPathToScreenSpace(l,f){const v=(function(w,I){const k=s.N();return s.aB(k,I.pitchedLabelPlaneMatrix),w.map((B=>{const W=bi(B.x,B.y,k,I.getElevation),Z=I.transform.projectTileCoordinates(W.point.x,W.point.y,I.unwrappedTileID,I.getElevation);return Z.point.x=(.5*Z.point.x+.5)*I.width,Z.point.y=(.5*-Z.point.y+.5)*I.height,Z}))})(l,f);return(function(w){let I=0,k=0,B=0,W=0;for(let Z=0;Z<w.length;Z++)w[Z].isOccluded?(B=Z+1,W=0):(W++,W>k&&(k=W,I=B));return w.slice(I,I+k)})(v)}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[],v=new s.aa;for(const he of l){const ue=new s.P(he.x+_r,he.y+_r);v.extend(ue),f.push(ue)}const{minX:w,minY:I,maxX:k,maxY:B}=v,W=this.grid.query(w,I,k,B).concat(this.ignoredGrid.query(w,I,k,B)),Z={},J={};for(const he of W){const ue=he.key;if(Z[ue.bucketInstanceId]===void 0&&(Z[ue.bucketInstanceId]={}),Z[ue.bucketInstanceId][ue.featureIndex])continue;const _e=[new s.P(he.x1,he.y1),new s.P(he.x2,he.y1),new s.P(he.x2,he.y2),new s.P(he.x1,he.y2)];s.aK(f,_e)&&(Z[ue.bucketInstanceId][ue.featureIndex]=!0,J[ue.bucketInstanceId]===void 0&&(J[ue.bucketInstanceId]=[]),J[ue.bucketInstanceId].push(ue.featureIndex))}return J}insertCollisionBox(l,f,v,w,I,k){(v?this.ignoredGrid:this.grid).insert({bucketInstanceId:w,featureIndex:I,collisionGroupID:k,overlapMode:f},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,f,v,w,I,k){const B=v?this.ignoredGrid:this.grid,W={bucketInstanceId:w,featureIndex:I,collisionGroupID:k,overlapMode:f};for(let Z=0;Z<l.length;Z+=4)B.insertCircle(W,l[Z],l[Z+1],l[Z+2])}projectAndGetPerspectiveRatio(l,f,v,w,I){if(I){let k;w?(k=[l,f,w(l,f),1],s.aH(k,k,I)):(k=[l,f,0,1],Zl(k,k,I));const B=k[3];return{x:(k[0]/B+1)/2*this.transform.width+_r,y:(-k[1]/B+1)/2*this.transform.height+_r,perspectiveRatio:.5+this.transform.cameraToCenterDistance/B*.5,isOccluded:!1,signedDistanceFromCamera:B}}{const k=this.transform.projectTileCoordinates(l,f,v,w);return{x:(k.point.x+1)/2*this.transform.width+_r,y:(1-k.point.y)/2*this.transform.height+_r,perspectiveRatio:.5+this.transform.cameraToCenterDistance/k.signedDistanceFromCamera*.5,isOccluded:k.isOccluded,signedDistanceFromCamera:k.signedDistanceFromCamera}}}getPerspectiveRatio(l,f,v,w){const I=this.transform.projectTileCoordinates(l,f,v,w);return .5+this.transform.cameraToCenterDistance/I.signedDistanceFromCamera*.5}isOffscreen(l,f,v,w){return v<_r||l>=this.screenRightBoundary||w<_r||f>this.screenBottomBoundary}isInsideGrid(l,f,v,w){return v>=0&&l<this.gridRightBoundary&&w>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const l=s.ar([]);return s.O(l,l,[-100,-100,0]),l}_projectCollisionBox(l,f,v,w,I,k,B,W,Z,J,he){let ue=1,_e=0,Ce=0,Fe=1;const Ne=l.anchorPointX+B[0],ze=l.anchorPointY+B[1];if(k&&!I){const ti=this.projectAndGetPerspectiveRatio(Ne+1,ze,w,Z,he),Xt=ti.x-W.x,si=Math.atan((ti.y-W.y)/Xt)+(Xt<0?Math.PI:0),Yi=Math.sin(si),kn=Math.cos(si);ue=kn,_e=Yi,Ce=-Yi,Fe=kn}else if(!k&&I){const ti=Ri(this.transform);ue=ti.vecEast[0],_e=ti.vecEast[1],Ce=ti.vecSouth[0],Fe=ti.vecSouth[1]}let We=W.x,tt=W.y,je=f;I&&(We=Ne,tt=ze,je=Math.pow(2,-(this.transform.zoom-v.overscaledZ)),je*=this.transform.getPitchedTextCorrection(Ne,ze,w),J||(je*=s.an(.5+W.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),J&&(We+=ue*J.x*je+Ce*J.y*je,tt+=_e*J.x*je+Fe*J.y*je);const Qe=l.x1*je,at=l.x2*je,Ke=(Qe+at)/2,mt=l.y1*je,Lt=l.y2*je,Et=(mt+Lt)/2,At=[{offsetX:Qe,offsetY:mt},{offsetX:Ke,offsetY:mt},{offsetX:at,offsetY:mt},{offsetX:at,offsetY:Et},{offsetX:at,offsetY:Lt},{offsetX:Ke,offsetY:Lt},{offsetX:Qe,offsetY:Lt},{offsetX:Qe,offsetY:Et}];let Pt=[];for(const{offsetX:ti,offsetY:Xt}of At)Pt.push(new s.P(We+ue*ti+Ce*Xt,tt+_e*ti+Fe*Xt));let Qt=!1;if(I){const ti=Pt.map((Xt=>this.projectAndGetPerspectiveRatio(Xt.x,Xt.y,w,Z,he)));Qt=ti.some((Xt=>!Xt.isOccluded)),Pt=ti.map((Xt=>new s.P(Xt.x,Xt.y)))}else Qt=!0;return{box:s.aL(Pt),allPointsOccluded:!Qt}}}class Ip{constructor(l,f,v,w){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?f:-f))):w&&v?1:0,this.placed=v}isHidden(){return this.opacity===0&&!this.placed}}class Su{constructor(l,f,v,w,I){this.text=new Ip(l?l.text:null,f,v,I),this.icon=new Ip(l?l.icon:null,f,w,I)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Rp{constructor(l,f,v){this.text=l,this.icon=f,this.skipFade=v}}class Lp{constructor(l,f,v,w,I){this.bucketInstanceId=l,this.featureIndex=f,this.sourceLayerIndex=v,this.bucketIndex=w,this.tileID=I}}class kp{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const f=++this.maxGroupID;this.collisionGroups[l]={ID:f,predicate:v=>v.collisionGroupID===f}}return this.collisionGroups[l]}}function Fh(A,l,f,v,w){const{horizontalAlign:I,verticalAlign:k}=s.aS(A);return new s.P(-(I-.5)*l+v[0]*w,-(k-.5)*f+v[1]*w)}class so{constructor(l,f,v,w,I){this.transform=l.clone(),this.terrain=f,this.collisionIndex=new Pp(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=v,this.retainedQueryData={},this.collisionGroups=new kp(w),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=I,I&&(I.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(l){const f=this.terrain;return f?(v,w)=>f.getElevation(l,v,w):null}getBucketParts(l,f,v,w){const I=v.getBucket(f),k=v.latestFeatureIndex;if(!I||!k||f.id!==I.layerIds[0])return;const B=v.collisionBoxArray,W=I.layers[0].layout,Z=I.layers[0].paint,J=Math.pow(2,this.transform.zoom-v.tileID.overscaledZ),he=v.tileSize/s.a5,ue=v.tileID.toUnwrapped(),_e=W.get("text-rotation-alignment")==="map",Ce=s.aN(v,1,this.transform.zoom),Fe=s.aO(this.collisionIndex.transform,v,Z.get("text-translate"),Z.get("text-translate-anchor")),Ne=s.aO(this.collisionIndex.transform,v,Z.get("icon-translate"),Z.get("icon-translate-anchor")),ze=Wi(_e,this.transform,Ce);this.retainedQueryData[I.bucketInstanceId]=new Lp(I.bucketInstanceId,k,I.sourceLayerIndex,I.index,v.tileID);const We={bucket:I,layout:W,translationText:Fe,translationIcon:Ne,unwrappedTileID:ue,pitchedLabelPlaneMatrix:ze,scale:J,textPixelRatio:he,holdingForFade:v.holdingForSymbolFade(),collisionBoxArray:B,partiallyEvaluatedTextSize:s.ay(I.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(I.sourceID)};if(w)for(const tt of I.sortKeyRanges){const{sortKey:je,symbolInstanceStart:Qe,symbolInstanceEnd:at}=tt;l.push({sortKey:je,symbolInstanceStart:Qe,symbolInstanceEnd:at,parameters:We})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:I.symbolInstances.length,parameters:We})}attemptAnchorPlacement(l,f,v,w,I,k,B,W,Z,J,he,ue,_e,Ce,Fe,Ne,ze,We,tt,je){const Qe=s.aP[l.textAnchor],at=[l.textOffset0,l.textOffset1],Ke=Fh(Qe,v,w,at,I),mt=this.collisionIndex.placeCollisionBox(f,ue,W,Z,J,B,k,Ne,he.predicate,tt,Ke,je);if((!We||this.collisionIndex.placeCollisionBox(We,ue,W,Z,J,B,k,ze,he.predicate,tt,Ke,je).placeable)&&mt.placeable){let Lt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[_e.crossTileID]&&this.prevPlacement.placements[_e.crossTileID]&&this.prevPlacement.placements[_e.crossTileID].text&&(Lt=this.prevPlacement.variableOffsets[_e.crossTileID].anchor),_e.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[_e.crossTileID]={textOffset:at,width:v,height:w,anchor:Qe,textBoxScale:I,prevAnchor:Lt},this.markUsedJustification(Ce,Qe,_e,Fe),Ce.allowVerticalPlacement&&(this.markUsedOrientation(Ce,Fe,_e),this.placedOrientations[_e.crossTileID]=Fe),{shift:Ke,placedGlyphBoxes:mt}}}placeLayerBucketPart(l,f,v){const{bucket:w,layout:I,translationText:k,translationIcon:B,unwrappedTileID:W,pitchedLabelPlaneMatrix:Z,textPixelRatio:J,holdingForFade:he,collisionBoxArray:ue,partiallyEvaluatedTextSize:_e,collisionGroup:Ce}=l.parameters,Fe=I.get("text-optional"),Ne=I.get("icon-optional"),ze=s.aQ(I,"text-overlap","text-allow-overlap"),We=ze==="always",tt=s.aQ(I,"icon-overlap","icon-allow-overlap"),je=tt==="always",Qe=I.get("text-rotation-alignment")==="map",at=I.get("text-pitch-alignment")==="map",Ke=I.get("icon-text-fit")!=="none",mt=I.get("symbol-z-order")==="viewport-y",Lt=We&&(je||!w.hasIconData()||Ne),Et=je&&(We||!w.hasTextData()||Fe);!w.collisionArrays&&ue&&w.deserializeCollisionBoxes(ue);const At=this.retainedQueryData[w.bucketInstanceId].tileID,Pt=this._getTerrainElevationFunc(At),Qt=this.transform.getFastPathSimpleProjectionMatrix(At),ti=(Xt,si,Yi)=>{var kn,pr;if(f[Xt.crossTileID])return;if(he)return void(this.placements[Xt.crossTileID]=new Rp(!1,!1,!1));let Jn=!1,br=!1,Qn=!0,Br=null,xr={box:null,placeable:!1,offscreen:null,occluded:!1},Ps={placeable:!1},rs=null,Zr=null,Us=null,Wc=0,lc=0,xl=0;si.textFeatureIndex?Wc=si.textFeatureIndex:Xt.useRuntimeCollisionCircles&&(Wc=Xt.featureIndex),si.verticalTextFeatureIndex&&(lc=si.verticalTextFeatureIndex);const So=si.textBox;if(So){const da=sr=>{let er=s.az.horizontal;if(w.allowVerticalPlacement&&!sr&&this.prevPlacement){const gs=this.prevPlacement.placedOrientations[Xt.crossTileID];gs&&(this.placedOrientations[Xt.crossTileID]=gs,er=gs,this.markUsedOrientation(w,er,Xt))}return er},wl=(sr,er)=>{if(w.allowVerticalPlacement&&Xt.numVerticalGlyphVertices>0&&si.verticalTextBox){for(const gs of w.writingModes)if(gs===s.az.vertical?(xr=er(),Ps=xr):xr=sr(),xr&&xr.placeable)break}else xr=sr()},Na=Xt.textAnchorOffsetStartIndex,$a=Xt.textAnchorOffsetEndIndex;if($a===Na){const sr=(er,gs)=>{const _s=this.collisionIndex.placeCollisionBox(er,ze,J,At,W,at,Qe,k,Ce.predicate,Pt,void 0,Qt);return _s&&_s.placeable&&(this.markUsedOrientation(w,gs,Xt),this.placedOrientations[Xt.crossTileID]=gs),_s};wl((()=>sr(So,s.az.horizontal)),(()=>{const er=si.verticalTextBox;return w.allowVerticalPlacement&&Xt.numVerticalGlyphVertices>0&&er?sr(er,s.az.vertical):{box:null,offscreen:null}})),da(xr&&xr.placeable)}else{let sr=s.aP[(pr=(kn=this.prevPlacement)===null||kn===void 0?void 0:kn.variableOffsets[Xt.crossTileID])===null||pr===void 0?void 0:pr.anchor];const er=(_s,H0,Z0)=>{const Hu=_s.x2-_s.x1,z1=_s.y2-_s.y1,X0=Xt.textBoxScale,X_=Ke&&tt==="never"?H0:null;let Hc=null,Zc=ze==="never"?1:2,Xc="never";sr&&Zc++;for(let Y_=0;Y_<Zc;Y_++){for(let K_=Na;K_<$a;K_++){const _m=w.textAnchorOffsets.get(K_);if(sr&&_m.textAnchor!==sr)continue;const vm=this.attemptAnchorPlacement(_m,_s,Hu,z1,X0,Qe,at,J,At,W,Ce,Xc,Xt,w,Z0,k,B,X_,Pt);if(vm&&(Hc=vm.placedGlyphBoxes,Hc&&Hc.placeable))return Jn=!0,Br=vm.shift,Hc}sr?sr=null:Xc=ze}return v&&!Hc&&(Hc={box:this.collisionIndex.placeCollisionBox(So,"always",J,At,W,at,Qe,k,Ce.predicate,Pt,void 0,Qt).box,offscreen:!1,placeable:!1,occluded:!1}),Hc};wl((()=>er(So,si.iconBox,s.az.horizontal)),(()=>{const _s=si.verticalTextBox;return w.allowVerticalPlacement&&(!xr||!xr.placeable)&&Xt.numVerticalGlyphVertices>0&&_s?er(_s,si.verticalIconBox,s.az.vertical):{box:null,occluded:!0,offscreen:null}})),xr&&(Jn=xr.placeable,Qn=xr.offscreen);const gs=da(xr&&xr.placeable);if(!Jn&&this.prevPlacement){const _s=this.prevPlacement.variableOffsets[Xt.crossTileID];_s&&(this.variableOffsets[Xt.crossTileID]=_s,this.markUsedJustification(w,_s.anchor,Xt,gs))}}}if(rs=xr,Jn=rs&&rs.placeable,Qn=rs&&rs.offscreen,Xt.useRuntimeCollisionCircles&&Xt.centerJustifiedTextSymbolIndex>=0){const da=w.text.placedSymbolArray.get(Xt.centerJustifiedTextSymbolIndex),wl=s.aA(w.textSizeData,_e,da),Na=I.get("text-padding");Zr=this.collisionIndex.placeCollisionCircles(ze,da,w.lineVertexArray,w.glyphOffsetArray,wl,W,Z,v,at,Ce.predicate,Xt.collisionCircleDiameter,Na,k,Pt),Zr.circles.length&&Zr.collisionDetected&&!v&&s.w("Collisions detected, but collision boxes are not shown"),Jn=We||Zr.circles.length>0&&!Zr.collisionDetected,Qn=Qn&&Zr.offscreen}if(si.iconFeatureIndex&&(xl=si.iconFeatureIndex),si.iconBox){const da=wl=>this.collisionIndex.placeCollisionBox(wl,tt,J,At,W,at,Qe,B,Ce.predicate,Pt,Ke&&Br?Br:void 0,Qt);Ps&&Ps.placeable&&si.verticalIconBox?(Us=da(si.verticalIconBox),br=Us.placeable):(Us=da(si.iconBox),br=Us.placeable),Qn=Qn&&Us.offscreen}const qu=Fe||Xt.numHorizontalGlyphVertices===0&&Xt.numVerticalGlyphVertices===0,Rf=Ne||Xt.numIconVertices===0;qu||Rf?Rf?qu||(br=br&&Jn):Jn=br&&Jn:br=Jn=br&&Jn;const Wu=br&&Us.placeable;if(Jn&&rs.placeable&&this.collisionIndex.insertCollisionBox(rs.box,ze,I.get("text-ignore-placement"),w.bucketInstanceId,Ps&&Ps.placeable&&lc?lc:Wc,Ce.ID),Wu&&this.collisionIndex.insertCollisionBox(Us.box,tt,I.get("icon-ignore-placement"),w.bucketInstanceId,xl,Ce.ID),Zr&&Jn&&this.collisionIndex.insertCollisionCircles(Zr.circles,ze,I.get("text-ignore-placement"),w.bucketInstanceId,Wc,Ce.ID),v&&this.storeCollisionData(w.bucketInstanceId,Yi,si,rs,Us,Zr),Xt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(w.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Xt.crossTileID]=new Rp((Jn||Lt)&&!rs?.occluded,(br||Et)&&!Us?.occluded,Qn||w.justReloaded),f[Xt.crossTileID]=!0};if(mt){if(l.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Xt=w.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let si=Xt.length-1;si>=0;--si){const Yi=Xt[si];ti(w.symbolInstances.get(Yi),w.collisionArrays[Yi],Yi)}}else for(let Xt=l.symbolInstanceStart;Xt<l.symbolInstanceEnd;Xt++)ti(w.symbolInstances.get(Xt),w.collisionArrays[Xt],Xt);w.justReloaded=!1}storeCollisionData(l,f,v,w,I,k){if(v.textBox||v.iconBox){let B,W;this.collisionBoxArrays.has(l)?B=this.collisionBoxArrays.get(l):(B=new Map,this.collisionBoxArrays.set(l,B)),B.has(f)?W=B.get(f):(W={text:null,icon:null},B.set(f,W)),v.textBox&&(W.text=w.box),v.iconBox&&(W.icon=I.box)}if(k){let B=this.collisionCircleArrays[l];B===void 0&&(B=this.collisionCircleArrays[l]=[]);for(let W=0;W<k.circles.length;W+=4)B.push(k.circles[W+0]-_r),B.push(k.circles[W+1]-_r),B.push(k.circles[W+2]),B.push(k.collisionDetected?1:0)}}markUsedJustification(l,f,v,w){let I;I=w===s.az.vertical?v.verticalPlacedTextSymbolIndex:{left:v.leftJustifiedTextSymbolIndex,center:v.centerJustifiedTextSymbolIndex,right:v.rightJustifiedTextSymbolIndex}[s.aR(f)];const k=[v.leftJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.rightJustifiedTextSymbolIndex,v.verticalPlacedTextSymbolIndex];for(const B of k)B>=0&&(l.text.placedSymbolArray.get(B).crossTileID=I>=0&&B!==I?0:v.crossTileID)}markUsedOrientation(l,f,v){const w=f===s.az.horizontal||f===s.az.horizontalOnly?f:0,I=f===s.az.vertical?f:0,k=[v.leftJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.rightJustifiedTextSymbolIndex];for(const B of k)l.text.placedSymbolArray.get(B).placedOrientation=w;v.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(v.verticalPlacedTextSymbolIndex).placedOrientation=I)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let v=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const w=f?f.symbolFadeChange(l):1,I=f?f.opacities:{},k=f?f.variableOffsets:{},B=f?f.placedOrientations:{};for(const W in this.placements){const Z=this.placements[W],J=I[W];J?(this.opacities[W]=new Su(J,w,Z.text,Z.icon),v=v||Z.text!==J.text.placed||Z.icon!==J.icon.placed):(this.opacities[W]=new Su(null,w,Z.text,Z.icon,Z.skipFade),v=v||Z.text||Z.icon)}for(const W in I){const Z=I[W];if(!this.opacities[W]){const J=new Su(Z,w,!1,!1);J.isHidden()||(this.opacities[W]=J,v=v||Z.text.placed||Z.icon.placed)}}for(const W in k)this.variableOffsets[W]||!this.opacities[W]||this.opacities[W].isHidden()||(this.variableOffsets[W]=k[W]);for(const W in B)this.placedOrientations[W]||!this.opacities[W]||this.opacities[W].isHidden()||(this.placedOrientations[W]=B[W]);if(f&&f.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");v?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:l)}updateLayerOpacities(l,f){const v={};for(const w of f){const I=w.getBucket(l);I&&w.latestFeatureIndex&&l.id===I.layerIds[0]&&this.updateBucketOpacities(I,w.tileID,v,w.collisionBoxArray)}}updateBucketOpacities(l,f,v,w){l.hasTextData()&&(l.text.opacityVertexArray.clear(),l.text.hasVisibleVertices=!1),l.hasIconData()&&(l.icon.opacityVertexArray.clear(),l.icon.hasVisibleVertices=!1),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const I=l.layers[0],k=I.layout,B=new Su(null,0,!1,!1,!0),W=k.get("text-allow-overlap"),Z=k.get("icon-allow-overlap"),J=I._unevaluatedLayout.hasValue("text-variable-anchor")||I._unevaluatedLayout.hasValue("text-variable-anchor-offset"),he=k.get("text-rotation-alignment")==="map",ue=k.get("text-pitch-alignment")==="map",_e=k.get("icon-text-fit")!=="none",Ce=new Su(null,0,W&&(Z||!l.hasIconData()||k.get("icon-optional")),Z&&(W||!l.hasTextData()||k.get("text-optional")),!0);!l.collisionArrays&&w&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(w);const Fe=(ze,We,tt)=>{for(let je=0;je<We/4;je++)ze.opacityVertexArray.emplaceBack(tt);ze.hasVisibleVertices=ze.hasVisibleVertices||tt!==Rc},Ne=this.collisionBoxArrays.get(l.bucketInstanceId);for(let ze=0;ze<l.symbolInstances.length;ze++){const We=l.symbolInstances.get(ze),{numHorizontalGlyphVertices:tt,numVerticalGlyphVertices:je,crossTileID:Qe}=We;let at=this.opacities[Qe];v[Qe]?at=B:at||(at=Ce,this.opacities[Qe]=at),v[Qe]=!0;const Ke=We.numIconVertices>0,mt=this.placedOrientations[We.crossTileID],Lt=mt===s.az.vertical,Et=mt===s.az.horizontal||mt===s.az.horizontalOnly;if(tt>0||je>0){const Pt=Jd(at.text);Fe(l.text,tt,Lt?Rc:Pt),Fe(l.text,je,Et?Rc:Pt);const Qt=at.text.isHidden();[We.rightJustifiedTextSymbolIndex,We.centerJustifiedTextSymbolIndex,We.leftJustifiedTextSymbolIndex].forEach((si=>{si>=0&&(l.text.placedSymbolArray.get(si).hidden=Qt||Lt?1:0)})),We.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(We.verticalPlacedTextSymbolIndex).hidden=Qt||Et?1:0);const ti=this.variableOffsets[We.crossTileID];ti&&this.markUsedJustification(l,ti.anchor,We,mt);const Xt=this.placedOrientations[We.crossTileID];Xt&&(this.markUsedJustification(l,"left",We,Xt),this.markUsedOrientation(l,Xt,We))}if(Ke){const Pt=Jd(at.icon),Qt=!(_e&&We.verticalPlacedIconSymbolIndex&&Lt);We.placedIconSymbolIndex>=0&&(Fe(l.icon,We.numIconVertices,Qt?Pt:Rc),l.icon.placedSymbolArray.get(We.placedIconSymbolIndex).hidden=at.icon.isHidden()),We.verticalPlacedIconSymbolIndex>=0&&(Fe(l.icon,We.numVerticalIconVertices,Qt?Rc:Pt),l.icon.placedSymbolArray.get(We.verticalPlacedIconSymbolIndex).hidden=at.icon.isHidden())}const At=Ne&&Ne.has(ze)?Ne.get(ze):{text:null,icon:null};if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const Pt=l.collisionArrays[ze];if(Pt){let Qt=new s.P(0,0);if(Pt.textBox||Pt.verticalTextBox){let ti=!0;if(J){const Xt=this.variableOffsets[Qe];Xt?(Qt=Fh(Xt.anchor,Xt.width,Xt.height,Xt.textOffset,Xt.textBoxScale),he&&Qt._rotate(ue?-this.transform.bearingInRadians:this.transform.bearingInRadians)):ti=!1}if(Pt.textBox||Pt.verticalTextBox){let Xt;Pt.textBox&&(Xt=Lt),Pt.verticalTextBox&&(Xt=Et),Oh(l.textCollisionBox.collisionVertexArray,at.text.placed,!ti||Xt,At.text,Qt.x,Qt.y)}}if(Pt.iconBox||Pt.verticalIconBox){const ti=!!(!Et&&Pt.verticalIconBox);let Xt;Pt.iconBox&&(Xt=ti),Pt.verticalIconBox&&(Xt=!ti),Oh(l.iconCollisionBox.collisionVertexArray,at.icon.placed,Xt,At.icon,_e?Qt.x:0,_e?Qt.y:0)}}}}if(l.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.text.opacityVertexArray.length!==l.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${l.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${l.text.layoutVertexArray.length}) / 4`);if(l.icon.opacityVertexArray.length!==l.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${l.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${l.icon.layoutVertexArray.length}) / 4`);l.bucketInstanceId in this.collisionCircleArrays&&(l.collisionCircleArray=this.collisionCircleArrays[l.bucketInstanceId],delete this.collisionCircleArrays[l.bucketInstanceId])}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,f){const v=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*v>l}setStale(){this.stale=!0}}function Oh(A,l,f,v,w,I){v&&v.length!==0||(v=[0,0,0,0]);const k=v[0]-_r,B=v[1]-_r,W=v[2]-_r,Z=v[3]-_r;A.emplaceBack(l?1:0,f?1:0,w||0,I||0,k,B),A.emplaceBack(l?1:0,f?1:0,w||0,I||0,W,B),A.emplaceBack(l?1:0,f?1:0,w||0,I||0,W,Z),A.emplaceBack(l?1:0,f?1:0,w||0,I||0,k,Z)}const zh=Math.pow(2,25),Bh=Math.pow(2,24),v_=Math.pow(2,17),Tu=Math.pow(2,16),Mu=Math.pow(2,9),Cu=Math.pow(2,8),Ic=Math.pow(2,1);function Jd(A){if(A.opacity===0&&!A.placed)return 0;if(A.opacity===1&&A.placed)return 4294967295;const l=A.placed?1:0,f=Math.floor(127*A.opacity);return f*zh+l*Bh+f*v_+l*Tu+f*Mu+l*Cu+f*Ic+l}const Rc=0;class fl{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&!l.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(l,f,v,w,I){const k=this._bucketParts;for(;this._currentTileIndex<l.length;)if(f.getBucketParts(k,w,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,I())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,k.sort(((B,W)=>B.sortKey-W.sortKey)));this._currentPartIndex<k.length;)if(f.placeLayerBucketPart(k[this._currentPartIndex],this._seenCrossTileIDs,v),this._currentPartIndex++,I())return!0;return!1}}class Lc{constructor(l,f,v,w,I,k,B,W){this.placement=new so(l,f,k,B,W),this._currentPlacementIndex=v.length-1,this._forceFullPlacement=w,this._showCollisionBoxes=I,this._done=!1}isDone(){return this._done}continuePlacement(l,f,v){const w=P(),I=()=>!this._forceFullPlacement&&P()-w>2;for(;this._currentPlacementIndex>=0;){const k=f[l[this._currentPlacementIndex]],B=this.placement.collisionIndex.transform.zoom;if(k.type==="symbol"&&(!k.minzoom||k.minzoom<=B)&&(!k.maxzoom||k.maxzoom>B)){if(this._inProgressLayer||(this._inProgressLayer=new fl(k)),this._inProgressLayer.continuePlacement(v[k.source],this.placement,this._showCollisionBoxes,k,I))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const rn=512/s.a5/2;class Nh{constructor(l,f,v){this.tileID=l,this.bucketInstanceId=v,this._symbolsByKey={};const w=new Map;for(let I=0;I<f.length;I++){const k=f.get(I),B=k.key,W=w.get(B);W?W.push(k):w.set(B,[k])}for(const[I,k]of w){const B={positions:k.map((W=>({x:Math.floor(W.anchorX*rn),y:Math.floor(W.anchorY*rn)}))),crossTileIDs:k.map((W=>W.crossTileID))};if(B.positions.length>128){const W=new s.aT(B.positions.length,16,Uint16Array);for(const{x:Z,y:J}of B.positions)W.add(Z,J);W.finish(),delete B.positions,B.index=W}this._symbolsByKey[I]=B}}getScaledCoordinates(l,f){const{x:v,y:w,z:I}=this.tileID.canonical,{x:k,y:B,z:W}=f.canonical,Z=rn/Math.pow(2,W-I),J=(B*s.a5+l.anchorY)*Z,he=w*s.a5*rn;return{x:Math.floor((k*s.a5+l.anchorX)*Z-v*s.a5*rn),y:Math.floor(J-he)}}findMatches(l,f,v){const w=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z);for(let I=0;I<l.length;I++){const k=l.get(I);if(k.crossTileID)continue;const B=this._symbolsByKey[k.key];if(!B)continue;const W=this.getScaledCoordinates(k,f);if(B.index){const Z=B.index.range(W.x-w,W.y-w,W.x+w,W.y+w).sort();for(const J of Z){const he=B.crossTileIDs[J];if(!v[he]){v[he]=!0,k.crossTileID=he;break}}}else if(B.positions)for(let Z=0;Z<B.positions.length;Z++){const J=B.positions[Z],he=B.crossTileIDs[Z];if(Math.abs(J.x-W.x)<=w&&Math.abs(J.y-W.y)<=w&&!v[he]){v[he]=!0,k.crossTileID=he;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:l})=>l))}}class Dp{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class kc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const f=Math.round((l-this.lng)/360);if(f!==0)for(const v in this.indexes){const w=this.indexes[v],I={};for(const k in w){const B=w[k];B.tileID=B.tileID.unwrapTo(B.tileID.wrap+f),I[B.tileID.key]=B}this.indexes[v]=I}this.lng=l}addBucket(l,f,v){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let I=0;I<f.symbolInstances.length;I++)f.symbolInstances.get(I).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});const w=this.usedCrossTileIDs[l.overscaledZ];for(const I in this.indexes){const k=this.indexes[I];if(Number(I)>l.overscaledZ)for(const B in k){const W=k[B];W.tileID.isChildOf(l)&&W.findMatches(f.symbolInstances,l,w)}else{const B=k[l.scaledTo(Number(I)).key];B&&B.findMatches(f.symbolInstances,l,w)}}for(let I=0;I<f.symbolInstances.length;I++){const k=f.symbolInstances.get(I);k.crossTileID||(k.crossTileID=v.generate(),w[k.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Nh(l,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(l,f){for(const v of f.getCrossTileIDsLists())for(const w of v)delete this.usedCrossTileIDs[l][w]}removeStaleBuckets(l){let f=!1;for(const v in this.indexes){const w=this.indexes[v];for(const I in w)l[w[I].bucketInstanceId]||(this.removeBucketCrossTileIDs(v,w[I]),delete w[I],f=!0)}return f}}class Ns{constructor(){this.layerIndexes={},this.crossTileIDs=new Dp,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,f,v){let w=this.layerIndexes[l.id];w===void 0&&(w=this.layerIndexes[l.id]=new kc);let I=!1;const k={};w.handleWrapJump(v);for(const B of f){const W=B.getBucket(l);W&&l.id===W.layerIds[0]&&(W.bucketInstanceId||(W.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(B.tileID,W,this.crossTileIDs)&&(I=!0),k[W.bucketInstanceId]=!0)}return w.removeStaleBuckets(k)&&(I=!0),I}pruneUnusedLayers(l){const f={};l.forEach((v=>{f[v]=!0}));for(const v in this.layerIndexes)f[v]||delete this.layerIndexes[v]}}var fs="void main() {fragColor=vec4(1.0);}";const xn={prelude:Gi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Gi("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Gi("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Gi(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Gi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Gi(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Gi(fs,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Gi(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Gi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Gi("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Gi("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Gi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Gi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Gi(fs,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Gi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Gi(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Gi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Gi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Gi(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Gi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Gi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Gi(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Gi(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Gi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Gi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Gi(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:Gi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:Gi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Gi(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Gi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Gi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Gi("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Gi("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Gi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Gi("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Gi(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Gi("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Gi(A,l){const f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,v=l.match(/in ([\w]+) ([\w]+)/g),w=A.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),I=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),k=I?I.concat(w):w,B={};return{fragmentSource:A=A.replace(f,((W,Z,J,he,ue)=>(B[ue]=!0,Z==="define"?`
#ifndef HAS_UNIFORM_u_${ue}
in ${J} ${he} ${ue};
#else
uniform ${J} ${he} u_${ue};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ue}
    ${J} ${he} ${ue} = u_${ue};
#endif
`))),vertexSource:l=l.replace(f,((W,Z,J,he,ue)=>{const _e=he==="float"?"vec2":"vec4",Ce=ue.match(/color/)?"color":_e;return B[ue]?Z==="define"?`
#ifndef HAS_UNIFORM_u_${ue}
uniform lowp float u_${ue}_t;
in ${J} ${_e} a_${ue};
out ${J} ${he} ${ue};
#else
uniform ${J} ${he} u_${ue};
#endif
`:Ce==="vec4"?`
#ifndef HAS_UNIFORM_u_${ue}
    ${ue} = a_${ue};
#else
    ${J} ${he} ${ue} = u_${ue};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ue}
    ${ue} = unpack_mix_${Ce}(a_${ue}, u_${ue}_t);
#else
    ${J} ${he} ${ue} = u_${ue};
#endif
`:Z==="define"?`
#ifndef HAS_UNIFORM_u_${ue}
uniform lowp float u_${ue}_t;
in ${J} ${_e} a_${ue};
#else
uniform ${J} ${he} u_${ue};
#endif
`:Ce==="vec4"?`
#ifndef HAS_UNIFORM_u_${ue}
    ${J} ${he} ${ue} = a_${ue};
#else
    ${J} ${he} ${ue} = u_${ue};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ue}
    ${J} ${he} ${ue} = unpack_mix_${Ce}(a_${ue}, u_${ue}_t);
#else
    ${J} ${he} ${ue} = u_${ue};
#endif
`})),staticAttributes:v,staticUniforms:k}}class On{constructor(l,f,v){this.vertexBuffer=l,this.indexBuffer=f,this.segments=v}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Sa=s.aU([{name:"a_pos",type:"Int16",components:2}]);const Ms="#define PROJECTION_MERCATOR",oo="mercator";class $s{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return oo}get shaderDefine(){return Ms}get shaderPreludeCode(){return xn.projectionMercator}get vertexShaderPreludeCode(){return xn.projectionMercator.vertexSource}get subdivisionGranularity(){return s.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(l){}getMeshFromTileID(l,f,v,w,I){if(this._cachedMesh)return this._cachedMesh;const k=new s.aW;k.emplaceBack(0,0),k.emplaceBack(s.a5,0),k.emplaceBack(0,s.a5),k.emplaceBack(s.a5,s.a5);const B=l.createVertexBuffer(k,Sa.members),W=s.aX.simpleSegment(0,0,4,2),Z=new s.aY;Z.emplaceBack(1,0,2),Z.emplaceBack(1,2,3);const J=l.createIndexBuffer(Z);return this._cachedMesh=new On(B,J,W),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(l){}}class Dc{constructor(l=0,f=0,v=0,w=0){if(isNaN(l)||l<0||isNaN(f)||f<0||isNaN(v)||v<0||isNaN(w)||w<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=f,this.left=v,this.right=w}interpolate(l,f,v){return f.top!=null&&l.top!=null&&(this.top=s.G.number(l.top,f.top,v)),f.bottom!=null&&l.bottom!=null&&(this.bottom=s.G.number(l.bottom,f.bottom,v)),f.left!=null&&l.left!=null&&(this.left=s.G.number(l.left,f.left,v)),f.right!=null&&l.right!=null&&(this.right=s.G.number(l.right,f.right,v)),this}getCenter(l,f){const v=s.an((this.left+l-this.right)/2,0,l),w=s.an((this.top+f-this.bottom)/2,0,f);return new s.P(v,w)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new Dc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function pl(A,l){if(!A.renderWorldCopies||A.lngRange)return;const f=l.lng-A.center.lng;l.lng+=f>180?-360:f<-180?360:0}function Pr(A){return Math.max(0,Math.floor(A))}class Xl{constructor(l,f){var v;this.applyConstrain=(w,I)=>this._constrainOverride!==null?this._constrainOverride(w,I):this._callbacks.defaultConstrain(w,I),this._callbacks=l,this._tileSize=512,this._renderWorldCopies=f?.renderWorldCopies===void 0||!!f?.renderWorldCopies,this._minZoom=f?.minZoom||0,this._maxZoom=f?.maxZoom||22,this._minPitch=f?.minPitch==null?0:f?.minPitch,this._maxPitch=f?.maxPitch==null?60:f?.maxPitch,this._constrainOverride=(v=f?.constrainOverride)!==null&&v!==void 0?v:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new s.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Pr(this._zoom),this._scale=s.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Dc,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(l,f,v){this._constrainOverride=l.constrainOverride,this._latRange=l.latRange,this._lngRange=l.lngRange,this._width=l.width,this._height=l.height,this._center=l.center,this._elevation=l.elevation,this._minElevationForCurrentTile=l.minElevationForCurrentTile,this._zoom=l.zoom,this._tileZoom=Pr(this._zoom),this._scale=s.aq(this._zoom),this._bearingInRadians=l.bearingInRadians,this._fovInRadians=l.fovInRadians,this._pitchInRadians=l.pitchInRadians,this._rollInRadians=l.rollInRadians,this._unmodified=l.unmodified,this._edgeInsets=new Dc(l.padding.top,l.padding.bottom,l.padding.left,l.padding.right),this._minZoom=l.minZoom,this._maxZoom=l.maxZoom,this._minPitch=l.minPitch,this._maxPitch=l.maxPitch,this._renderWorldCopies=l.renderWorldCopies,this._cameraToCenterDistance=l.cameraToCenterDistance,this._nearZ=l.nearZ,this._farZ=l.farZ,this._autoCalculateNearFarZ=!v&&l.autoCalculateNearFarZ,f&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(l){this._minElevationForCurrentTile=l}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(l){this._minZoom!==l&&(this._minZoom=l,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(l){this._minPitch!==l&&(this._minPitch=l,this.setPitch(Math.max(this.pitch,l)))}get maxPitch(){return this._maxPitch}setMaxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.setPitch(Math.min(this.pitch,l)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get constrainOverride(){return this._constrainOverride}setConstrainOverride(l){l===void 0&&(l=null),this._constrainOverride!==l&&(this._constrainOverride=l,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(l){const f=s.W(l,-180,180)*Math.PI/180;var v,w,I,k,B,W,Z,J,he;this._bearingInRadians!==f&&(this._unmodified=!1,this._bearingInRadians=f,this._calcMatrices(),this._rotationMatrix=p(),v=this._rotationMatrix,I=-this._bearingInRadians,k=(w=this._rotationMatrix)[0],B=w[1],W=w[2],Z=w[3],J=Math.sin(I),he=Math.cos(I),v[0]=k*he+W*J,v[1]=B*he+Z*J,v[2]=k*-J+W*he,v[3]=B*-J+Z*he)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(l){const f=s.an(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==f&&(this._unmodified=!1,this._pitchInRadians=f,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(l){const f=l/180*Math.PI;this._rollInRadians!==f&&(this._unmodified=!1,this._rollInRadians=f,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return s.aZ(this._fovInRadians)}setFov(l){l=s.an(l,.1,150),this.fov!==l&&(this._unmodified=!1,this._fovInRadians=s.ap(l),this._calcMatrices())}get zoom(){return this._zoom}setZoom(l){const f=this.applyConstrain(this._center,l).zoom;this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this._tileZoom=Math.max(0,Math.floor(f)),this._scale=s.aq(f),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(l){l!==this._elevation&&(this._elevation=l,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(l,f){this._autoCalculateNearFarZ=!1,this._nearZ=l,this._farZ=f,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,f,v){this._unmodified=!1,this._edgeInsets.interpolate(l,f,v),this.constrainInternal(),this._calcMatrices()}resize(l,f,v=!0){this._width=l,this._height=f,v&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Ae([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(l){l?(this._lngRange=[l.getWest(),l.getEast()],this._latRange=[l.getSouth(),l.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-s.ao,s.ao])}getCameraQueryGeometry(l,f){if(f.length===1)return[f[0],l];{const{minX:v,minY:w,maxX:I,maxY:k}=s.aa.fromPoints(f).extend(l);return[new s.P(v,w),new s.P(I,w),new s.P(I,k),new s.P(v,k),new s.P(v,w)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const l=this._unmodified,{center:f,zoom:v}=this.applyConstrain(this.center,this.zoom);this.setCenter(f),this.setZoom(v),this._unmodified=l,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let l=s.ar(new Float64Array(16));s.Q(l,l,[this._width/2,-this._height/2,1]),s.O(l,l,[1,-1,0]),this._clipSpaceToPixelsMatrix=l,l=s.ar(new Float64Array(16)),s.Q(l,l,[1,-1,1]),s.O(l,l,[-1,-1,0]),s.Q(l,l,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=l,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(l,f,v,w){const I=v!==void 0?v:this.bearing,k=w=w!==void 0?w:this.pitch,{distanceToCenter:B,clampedElevation:W}=this._distanceToCenterFromAltElevationPitch(f,this.elevation,k),{x:Z,y:J}=gn(k,I),he=s.a9.fromLngLat(l,f);let ue,_e,Ce=s.a_(1,he.y),Fe=0;do{if(Fe+=1,Fe>10)break;_e=B/Ce,ue=new s.a9(he.x+Z*_e,he.y+J*_e),Ce=1/ue.meterInMercatorCoordinateUnits()}while(Math.abs(B-_e*Ce)>1e-12);return{center:ue.toLngLat(),elevation:W,zoom:s.at(this.height/2/Math.tan(this.fovInRadians/2)/_e/this.tileSize)}}recalculateZoomAndCenter(l){if(this.elevation-l==0)return;const f=1/this.worldSize,v=s.as(1,this.center.lat)*this.worldSize,w=s.a9.fromLngLat(this.center,this.elevation),I=w.x/f,k=w.y/f,B=w.z/f,W=this.pitch,Z=this.bearing,{x:J,y:he,z:ue}=gn(W,Z),_e=this.cameraToCenterDistance,Ce=I+_e*-J,Fe=k+_e*-he,Ne=B+_e*ue,{distanceToCenter:ze,clampedElevation:We}=this._distanceToCenterFromAltElevationPitch(Ne/v,l,W),tt=ze*v,je=new s.a9((Ce+J*tt)*f,(Fe+he*tt)*f,0).toLngLat(),Qe=s.as(1,je.lat),at=s.at(this.height/2/Math.tan(this.fovInRadians/2)/ze/Qe/this.tileSize);this._elevation=We,this._center=je,this.setZoom(at)}_distanceToCenterFromAltElevationPitch(l,f,v){const w=-Math.cos(s.ap(v)),I=l-f;let k,B=f;return w*I>=0||Math.abs(w)<.1?(k=1e4,B=l+k*w):k=-I/w,{distanceToCenter:k,clampedElevation:B}}getCameraPoint(){const l=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(l*Math.sin(this.rollInRadians),l*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const l=s.as(1,this.center.lat)*this.worldSize;return Tt(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/l).toLngLat()}getMercatorTileCoordinates(l){if(!l)return[0,0,1,1];const f=l.canonical.z>=0?1<<l.canonical.z:Math.pow(2,l.canonical.z);return[l.canonical.x/f,l.canonical.y/f,1/f/s.a5,1/f/s.a5]}}class No{constructor(l,f){this.min=l,this.max=f,this.center=s.a$([],s.b0([],this.min,this.max),.5)}quadrant(l){const f=[l%2==0,l<2],v=s.b1(this.min),w=s.b1(this.max);for(let I=0;I<f.length;I++)v[I]=f[I]?this.min[I]:this.center[I],w[I]=f[I]?this.center[I]:this.max[I];return w[2]=this.max[2],new No(v,w)}distanceX(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]}distanceY(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]}intersectsFrustum(l){let f=!0;for(let v=0;v<l.planes.length;v++){const w=this.intersectsPlane(l.planes[v]);if(w===0)return 0;w===1&&(f=!1)}return f?2:l.aabb.min[0]>this.max[0]||l.aabb.min[1]>this.max[1]||l.aabb.min[2]>this.max[2]||l.aabb.max[0]<this.min[0]||l.aabb.max[1]<this.min[1]||l.aabb.max[2]<this.min[2]?0:1}intersectsPlane(l){let f=l[3],v=l[3];for(let w=0;w<3;w++)l[w]>0?(f+=l[w]*this.min[w],v+=l[w]*this.max[w]):(v+=l[w]*this.min[w],f+=l[w]*this.max[w]);return f>=0?2:v<0?0:1}}class Eu{distanceToTile2d(l,f,v,w){const I=w.distanceX([l,f]),k=w.distanceY([l,f]);return Math.hypot(I,k)}getWrap(l,f,v){return v}getTileBoundingVolume(l,f,v,w){var I,k;let B=0,W=0;if(w?.terrain){const J=new s.a2(l.z,f,l.z,l.x,l.y),he=w.terrain.getMinMaxElevation(J);B=(I=he.minElevation)!==null&&I!==void 0?I:Math.min(0,v),W=(k=he.maxElevation)!==null&&k!==void 0?k:Math.max(0,v)}const Z=1<<l.z;return new No([f+l.x/Z,l.y/Z,B],[f+(l.x+1)/Z,(l.y+1)/Z,W])}allowVariableZoom(l,f){const v=l.fov*(Math.abs(Math.cos(l.rollInRadians))*l.height+Math.abs(Math.sin(l.rollInRadians))*l.width)/l.height,w=s.an(78.5-v/2,0,60);return!!f.terrain||l.pitch>w}allowWorldCopies(){return!0}prepareNextFrame(){}}class Cs{constructor(l,f,v){this.points=l,this.planes=f,this.aabb=v}static fromInvProjectionMatrix(l,f=1,v=0,w,I){const k=I?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],B=Math.pow(2,v),W=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((ue=>(function(_e,Ce,Fe,Ne){const ze=s.aH([],_e,Ce),We=1/ze[3]/Fe*Ne;return s.b6(ze,ze,[We,We,1/ze[3],We])})(ue,l,f,B)));w&&(function(ue,_e,Ce,Fe){const Ne=Fe?4:0,ze=Fe?0:4;let We=0;const tt=[],je=[];for(let Ke=0;Ke<4;Ke++){const mt=s.b2([],ue[Ke+ze],ue[Ke+Ne]),Lt=s.b7(mt);s.a$(mt,mt,1/Lt),tt.push(Lt),je.push(mt)}for(let Ke=0;Ke<4;Ke++){const mt=s.b8(ue[Ke+Ne],je[Ke],Ce);We=mt!==null&&mt>=0?Math.max(We,mt):Math.max(We,tt[Ke])}const Qe=(function(Ke,mt){const Lt=s.b2([],Ke[mt[0]],Ke[mt[1]]),Et=s.b2([],Ke[mt[2]],Ke[mt[1]]),At=[0,0,0,0];return s.b3(At,s.b4([],Lt,Et)),At[3]=-s.b5(At,Ke[mt[0]]),At})(ue,_e),at=(function(Ke,mt){const Lt=s.b9(Ke),Et=s.ba([],Ke,1/Lt),At=s.b2([],mt,s.a$([],Et,s.b5(mt,Et))),Pt=s.b9(At);if(Pt>0){const Qt=Math.sqrt(1-Et[3]*Et[3]),ti=s.a$([],Et,-Et[3]),Xt=s.b0([],ti,s.a$([],At,Qt/Pt));return s.bb(mt,Xt)}return null})(Ce,Qe);if(at!==null){const Ke=at/s.b5(je[0],Qe);We=Math.min(We,Ke)}for(let Ke=0;Ke<4;Ke++){const mt=Math.min(We,tt[Ke]);ue[Ke+ze]=[ue[Ke+Ne][0]+je[Ke][0]*mt,ue[Ke+Ne][1]+je[Ke][1]*mt,ue[Ke+Ne][2]+je[Ke][2]*mt,1]}})(W,k[0],w,I);const Z=k.map((ue=>{const _e=s.b2([],W[ue[0]],W[ue[1]]),Ce=s.b2([],W[ue[2]],W[ue[1]]),Fe=s.b3([],s.b4([],_e,Ce)),Ne=-s.b5(Fe,W[ue[1]]);return Fe.concat(Ne)})),J=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],he=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const ue of W)for(let _e=0;_e<3;_e++)J[_e]=Math.min(J[_e],ue[_e]),he[_e]=Math.max(he[_e],ue[_e]);return new Cs(W,Z,new No(J,he))}}class Yl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(l){this._helper.setMinZoom(l)}setMaxZoom(l){this._helper.setMaxZoom(l)}setMinPitch(l){this._helper.setMinPitch(l)}setMaxPitch(l){this._helper.setMaxPitch(l)}setRenderWorldCopies(l){this._helper.setRenderWorldCopies(l)}setBearing(l){this._helper.setBearing(l)}setPitch(l){this._helper.setPitch(l)}setRoll(l){this._helper.setRoll(l)}setFov(l){this._helper.setFov(l)}setZoom(l){this._helper.setZoom(l)}setCenter(l){this._helper.setCenter(l)}setElevation(l){this._helper.setElevation(l)}setMinElevationForCurrentTile(l){this._helper.setMinElevationForCurrentTile(l)}setPadding(l){this._helper.setPadding(l)}interpolatePadding(l,f,v){return this._helper.interpolatePadding(l,f,v)}isPaddingEqual(l){return this._helper.isPaddingEqual(l)}resize(l,f,v=!0){this._helper.resize(l,f,v)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(l){this._helper.setMaxBounds(l)}setConstrainOverride(l){this._helper.setConstrainOverride(l)}overrideNearFarZ(l,f){this._helper.overrideNearFarZ(l,f)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(l){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),l)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(l,f){}constructor(l){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(f,v)=>{v=s.an(+v,this.minZoom,this.maxZoom);const w={center:new s.V(f.lng,f.lat),zoom:v};let I=this._helper._lngRange;if(!this._helper._renderWorldCopies&&I===null){const je=179.9999999999;I=[-je,je]}const k=this.tileSize*s.aq(w.zoom);let B=0,W=k,Z=0,J=k,he=0,ue=0;const{x:_e,y:Ce}=this.size;if(this._helper._latRange){const je=this._helper._latRange;B=s.X(je[1])*k,W=s.X(je[0])*k,W-B<Ce&&(he=Ce/(W-B))}I&&(Z=s.W(s.Y(I[0])*k,0,k),J=s.W(s.Y(I[1])*k,0,k),J<Z&&(J+=k),J-Z<_e&&(ue=_e/(J-Z)));const{x:Fe,y:Ne}=vi(k,f);let ze,We;const tt=Math.max(ue||0,he||0);if(tt){const je=new s.P(ue?(J+Z)/2:Fe,he?(W+B)/2:Ne);return w.center=$i(k,je).wrap(),w.zoom+=s.at(tt),w}if(this._helper._latRange){const je=Ce/2;Ne-je<B&&(We=B+je),Ne+je>W&&(We=W-je)}if(I){const je=(Z+J)/2;let Qe=Fe;this._helper._renderWorldCopies&&(Qe=s.W(Fe,je-k/2,je+k/2));const at=_e/2;Qe-at<Z&&(ze=Z+at),Qe+at>J&&(ze=J-at)}if(ze!==void 0||We!==void 0){const je=new s.P(ze??Fe,We??Ne);w.center=$i(k,je).wrap()}return w},this.applyConstrain=(f,v)=>this._helper.applyConstrain(f,v),this._helper=new Xl({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(f,v)=>this.defaultConstrain(f,v)},l),this._coveringTilesDetailsProvider=new Eu}clone(){const l=new Yl;return l.apply(this),l}apply(l,f,v){this._helper.apply(l,f,v)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(l){const f=[new s.bc(0,l)];if(this._helper._renderWorldCopies){const v=this.screenPointToMercatorCoordinate(new s.P(0,0)),w=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,0)),I=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,this._helper._height)),k=this.screenPointToMercatorCoordinate(new s.P(0,this._helper._height)),B=Math.floor(Math.min(v.x,w.x,I.x,k.x)),W=Math.floor(Math.max(v.x,w.x,I.x,k.x)),Z=1;for(let J=B-Z;J<=W+Z;J++)J!==0&&f.push(new s.bc(J,l))}return f}getCameraFrustum(){return Cs.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(l){const f=this.screenPointToLocation(this.centerPoint,l),v=l?l.getElevationForLngLatZoom(f,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(v)}setLocationAtPoint(l,f){const v=s.as(this.elevation,this.center.lat),w=this.screenPointToMercatorCoordinateAtZ(f,v),I=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,v),k=s.a9.fromLngLat(l),B=new s.a9(k.x-(w.x-I.x),k.y-(w.y-I.y));this.setCenter(B?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(l,f){return f?this.coordinatePoint(s.a9.fromLngLat(l),f.getElevationForLngLat(l,this),this._pixelMatrix3D):this.coordinatePoint(s.a9.fromLngLat(l))}screenPointToLocation(l,f){var v;return(v=this.screenPointToMercatorCoordinate(l,f))===null||v===void 0?void 0:v.toLngLat()}screenPointToMercatorCoordinate(l,f){if(f){const v=f.pointCoordinate(l);if(v!=null)return v}return this.screenPointToMercatorCoordinateAtZ(l)}screenPointToMercatorCoordinateAtZ(l,f){const v=f||0,w=[l.x,l.y,0,1],I=[l.x,l.y,1,1];s.aH(w,w,this._pixelMatrixInverse),s.aH(I,I,this._pixelMatrixInverse);const k=w[3],B=I[3],W=w[1]/k,Z=I[1]/B,J=w[2]/k,he=I[2]/B,ue=J===he?0:(v-J)/(he-J);return new s.a9(s.G.number(w[0]/k,I[0]/B,ue)/this.worldSize,s.G.number(W,Z,ue)/this.worldSize,v)}coordinatePoint(l,f=0,v=this._pixelMatrix){const w=[l.x*this.worldSize,l.y*this.worldSize,f,1];return s.aH(w,w,v),new s.P(w[0]/w[3],w[1]/w[3])}getBounds(){const l=Math.max(0,this._helper._height/2-vn(this));return new Ae().extend(this.screenPointToLocation(new s.P(0,l))).extend(this.screenPointToLocation(new s.P(this._helper._width,l))).extend(this.screenPointToLocation(new s.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new s.P(0,this._helper._height)))}isPointOnMapSurface(l,f){return f?f.pointCoordinate(l)!=null:l.y>this.height/2-vn(this)}calculatePosMatrix(l,f=!1,v){var w;const I=(w=l.key)!==null&&w!==void 0?w:s.bd(l.wrap,l.canonical.z,l.canonical.z,l.canonical.x,l.canonical.y),k=f?this._alignedPosMatrixCache:this._posMatrixCache;if(k.has(I)){const Z=k.get(I);return v?Z.f32:Z.f64}const B=on(l,this.worldSize);s.S(B,f?this._alignedProjMatrix:this._viewProjMatrix,B);const W={f64:B,f32:new Float32Array(B)};return k.set(I,W),v?W.f32:W.f64}calculateFogMatrix(l){const f=l.key,v=this._fogMatrixCacheF32;if(v.has(f))return v.get(f);const w=on(l,this.worldSize);return s.S(w,this._fogMatrix,w),v.set(f,new Float32Array(w)),v.get(f)}calculateCenterFromCameraLngLatAlt(l,f,v,w){return this._helper.calculateCenterFromCameraLngLatAlt(l,f,v,w)}_calculateNearFarZIfNeeded(l,f,v){if(!this._helper.autoCalculateNearFarZ)return;const w=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),I=l-w*this._helper._pixelPerMeter/Math.cos(f),k=w<0?I:l,B=Math.PI/2+this.pitchInRadians,W=s.ap(this.fov)*(Math.abs(Math.cos(s.ap(this.roll)))*this.height+Math.abs(Math.sin(s.ap(this.roll)))*this.width)/this.height*(.5+v.y/this.height),Z=Math.sin(W)*k/Math.sin(s.an(Math.PI-B-W,.01,Math.PI-.01)),J=vn(this),he=Math.atan(J/this._helper.cameraToCenterDistance),ue=s.ap(.75),_e=he>ue?2*he*(.5+v.y/(2*J)):ue,Ce=Math.sin(_e)*k/Math.sin(s.an(Math.PI-B-_e,.01,Math.PI-.01)),Fe=Math.min(Z,Ce);this._helper._farZ=1.01*(Math.cos(Math.PI/2-f)*Fe+k),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const l=this.centerOffset,f=vi(this.worldSize,this.center),v=f.x,w=f.y;this._helper._pixelPerMeter=s.as(1,this.center.lat)*this.worldSize;const I=s.ap(Math.min(this.pitch,Jt)),k=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(I));let B;this._calculateNearFarZIfNeeded(k,I,l),B=new Float64Array(16),s.be(B,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),s.aB(this._invProjMatrix,B),B[8]=2*-l.x/this._helper._width,B[9]=2*l.y/this._helper._height,this._projectionMatrix=s.bf(B),s.Q(B,B,[1,-1,1]),s.O(B,B,[0,0,-this._helper.cameraToCenterDistance]),s.bg(B,B,-this.rollInRadians),s.bh(B,B,this.pitchInRadians),s.bg(B,B,-this.bearingInRadians),s.O(B,B,[-v,-w,0]),this._mercatorMatrix=s.Q([],B,[this.worldSize,this.worldSize,this.worldSize]),s.Q(B,B,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=s.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,B),s.O(B,B,[0,0,-this.elevation]),this._viewProjMatrix=B,this._invViewProjMatrix=s.aB([],B);const W=[0,0,-1,1];s.aH(W,W,this._invViewProjMatrix),this._cameraPosition=[W[0]/W[3],W[1]/W[3],W[2]/W[3]],this._fogMatrix=new Float64Array(16),s.be(this._fogMatrix,this.fovInRadians,this.width/this.height,k,this._helper._farZ),this._fogMatrix[8]=2*-l.x/this.width,this._fogMatrix[9]=2*l.y/this.height,s.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),s.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),s.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),s.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),s.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),s.O(this._fogMatrix,this._fogMatrix,[-v,-w,0]),s.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),s.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=s.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,B);const Z=this._helper._width%2/2,J=this._helper._height%2/2,he=Math.cos(this.bearingInRadians),ue=Math.sin(-this.bearingInRadians),_e=v-Math.round(v)+he*Z+ue*J,Ce=w-Math.round(w)+he*J+ue*Z,Fe=new Float64Array(B);if(s.O(Fe,Fe,[_e>.5?_e-1:_e,Ce>.5?Ce-1:Ce,0]),this._alignedProjMatrix=Fe,B=s.aB(new Float64Array(16),this._pixelMatrix),!B)throw new Error("failed to invert matrix");this._pixelMatrixInverse=B,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const l=this.screenPointToMercatorCoordinate(new s.P(0,0)),f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return s.aH(f,f,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const l=s.as(1,this.center.lat)*this.worldSize;return Tt(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/l).toLngLat()}lngLatToCameraDepth(l,f){const v=s.a9.fromLngLat(l),w=[v.x*this.worldSize,v.y*this.worldSize,f,1];return s.aH(w,w,this._viewProjMatrix),w[2]/w[3]}getProjectionData(l){const{overscaledTileID:f,aligned:v,applyTerrainMatrix:w}=l,I=this._helper.getMercatorTileCoordinates(f),k=f?this.calculatePosMatrix(f,v,!0):null;let B;return B=f&&f.terrainRttPosMatrix32f&&w?f.terrainRttPosMatrix32f:k||s.bi(),{mainMatrix:B,tileMercatorCoords:I,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:B}}isLocationOccluded(l){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(l,f,v){return 1}transformLightDirection(l){return s.b1(l)}getRayDirectionFromPixel(l){throw new Error("Not implemented.")}projectTileCoordinates(l,f,v,w){const I=this.calculatePosMatrix(v);let k;w?(k=[l,f,w(l,f),1],s.aH(k,k,I)):(k=[l,f,0,1],Zl(k,k,I));const B=k[3];return{point:new s.P(k[0]/B,k[1]/B),signedDistanceFromCamera:B,isOccluded:!1}}populateCache(l){for(const f of l)this.calculatePosMatrix(f)}getMatrixForModel(l,f){const v=s.a9.fromLngLat(l,f),w=v.meterInMercatorCoordinateUnits(),I=s.bj();return s.O(I,I,[v.x,v.y,v.z]),s.bg(I,I,Math.PI),s.bh(I,I,Math.PI/2),s.Q(I,I,[-w,w,w]),I}getProjectionDataForCustomLayer(l=!0){const f=new s.a2(0,0,0,0,0),v=this.getProjectionData({overscaledTileID:f,applyGlobeMatrix:l}),w=on(f,this.worldSize);s.S(w,this._viewProjMatrix,w),v.tileMercatorCoords=[0,0,1,1];const I=[s.a5,s.a5,this.worldSize/this._helper.pixelsPerMeter],k=s.bk();return s.Q(k,w,I),v.fallbackMatrix=k,v.mainMatrix=k,v}getFastPathSimpleProjectionMatrix(l){return this.calculatePosMatrix(l)}}function Ta(){s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function ml(A){if(A.useSlerp)if(A.k<1){const l=s.bl(A.startEulerAngles.roll,A.startEulerAngles.pitch,A.startEulerAngles.bearing),f=s.bl(A.endEulerAngles.roll,A.endEulerAngles.pitch,A.endEulerAngles.bearing),v=new Float64Array(4);s.bm(v,l,f,A.k);const w=s.bn(v);A.tr.setRoll(w.roll),A.tr.setPitch(w.pitch),A.tr.setBearing(w.bearing)}else A.tr.setRoll(A.endEulerAngles.roll),A.tr.setPitch(A.endEulerAngles.pitch),A.tr.setBearing(A.endEulerAngles.bearing);else A.tr.setRoll(s.G.number(A.startEulerAngles.roll,A.endEulerAngles.roll,A.k)),A.tr.setPitch(s.G.number(A.startEulerAngles.pitch,A.endEulerAngles.pitch,A.k)),A.tr.setBearing(s.G.number(A.startEulerAngles.bearing,A.endEulerAngles.bearing,A.k))}function $o(A,l,f,v,w){const I=w.padding,k=vi(w.worldSize,f.getNorthWest()),B=vi(w.worldSize,f.getNorthEast()),W=vi(w.worldSize,f.getSouthEast()),Z=vi(w.worldSize,f.getSouthWest()),J=s.ap(-v),he=k.rotate(J),ue=B.rotate(J),_e=W.rotate(J),Ce=Z.rotate(J),Fe=new s.P(Math.max(he.x,ue.x,Ce.x,_e.x),Math.max(he.y,ue.y,Ce.y,_e.y)),Ne=new s.P(Math.min(he.x,ue.x,Ce.x,_e.x),Math.min(he.y,ue.y,Ce.y,_e.y)),ze=Fe.sub(Ne),We=(w.width-(I.left+I.right+l.left+l.right))/ze.x,tt=(w.height-(I.top+I.bottom+l.top+l.bottom))/ze.y;if(tt<0||We<0)return void Ta();const je=Math.min(s.at(w.scale*Math.min(We,tt)),A.maxZoom),Qe=s.P.convert(A.offset),at=new s.P((l.left-l.right)/2,(l.top-l.bottom)/2).rotate(s.ap(v)),Ke=Qe.add(at).mult(w.scale/s.aq(je));return{center:$i(w.worldSize,k.add(W).div(2).sub(Ke)),zoom:je,bearing:v}}class gl{get useGlobeControls(){return!1}handlePanInertia(l,f){const v=l.mag(),w=Math.abs(vn(f));return{easingOffset:l.mult(Math.min(.75*w/v,1)),easingCenter:f.center}}handleMapControlsRollPitchBearingZoom(l,f){l.bearingDelta&&f.setBearing(f.bearing+l.bearingDelta),l.pitchDelta&&f.setPitch(f.pitch+l.pitchDelta),l.rollDelta&&f.setRoll(f.roll+l.rollDelta),l.zoomDelta&&f.setZoom(f.zoom+l.zoomDelta)}handleMapControlsPan(l,f,v){l.around.distSqr(f.centerPoint)<.01||f.setLocationAtPoint(v,l.around)}cameraForBoxAndBearing(l,f,v,w,I){return $o(l,f,v,w,I)}handleJumpToCenterZoom(l,f){l.zoom!==(f.zoom!==void 0?+f.zoom:l.zoom)&&l.setZoom(+f.zoom),f.center!==void 0&&l.setCenter(s.V.convert(f.center))}handleEaseTo(l,f){const v=l.zoom,w=l.padding,I={roll:l.roll,pitch:l.pitch,bearing:l.bearing},k={roll:f.roll===void 0?l.roll:f.roll,pitch:f.pitch===void 0?l.pitch:f.pitch,bearing:f.bearing===void 0?l.bearing:f.bearing},B=f.zoom!==void 0,W=!l.isPaddingEqual(f.padding);let Z=!1;const J=B?+f.zoom:l.zoom;let he=l.centerPoint.add(f.offsetAsPoint);const ue=l.screenPointToLocation(he),{center:_e,zoom:Ce}=l.applyConstrain(s.V.convert(f.center||ue),J??v);pl(l,_e);const Fe=vi(l.worldSize,ue),Ne=vi(l.worldSize,_e).sub(Fe),ze=s.aq(Ce-v);return Z=Ce!==v,{easeFunc:We=>{if(Z&&l.setZoom(s.G.number(v,Ce,We)),s.bo(I,k)||ml({startEulerAngles:I,endEulerAngles:k,tr:l,k:We,useSlerp:I.roll!=k.roll}),W&&(l.interpolatePadding(w,f.padding,We),he=l.centerPoint.add(f.offsetAsPoint)),f.around)l.setLocationAtPoint(f.around,f.aroundPoint);else{const tt=s.aq(l.zoom-v),je=Ce>v?Math.min(2,ze):Math.max(.5,ze),Qe=Math.pow(je,1-We),at=$i(l.worldSize,Fe.add(Ne.mult(We*Qe)).mult(tt));l.setLocationAtPoint(l.renderWorldCopies?at.wrap():at,he)}},isZooming:Z,elevationCenter:_e}}handleFlyTo(l,f){const v=f.zoom!==void 0,w=l.zoom,I=l.applyConstrain(s.V.convert(f.center||f.locationAtOffset),v?+f.zoom:w),k=I.center,B=I.zoom;pl(l,k);const W=vi(l.worldSize,f.locationAtOffset),Z=vi(l.worldSize,k).sub(W),J=Z.mag(),he=s.aq(B-w);let ue;if(f.minZoom!==void 0){const _e=Math.min(+f.minZoom,w,B),Ce=l.applyConstrain(k,_e).zoom;ue=s.aq(Ce-w)}return{easeFunc:(_e,Ce,Fe,Ne)=>{l.setZoom(_e===1?B:w+s.at(Ce));const ze=_e===1?k:$i(l.worldSize,W.add(Z.mult(Fe)).mult(Ce));l.setLocationAtPoint(l.renderWorldCopies?ze.wrap():ze,Ne)},scaleOfZoom:he,targetCenter:k,scaleOfMinZoom:ue,pixelPathLength:J}}}class zn{constructor(l,f,v){this.blendFunction=l,this.blendColor=f,this.mask=v}}zn.Replace=[1,0],zn.disabled=new zn(zn.Replace,s.bp.transparent,[!1,!1,!1,!1]),zn.unblended=new zn(zn.Replace,s.bp.transparent,[!0,!0,!0,!0]),zn.alphaBlended=new zn([1,771],s.bp.transparent,[!0,!0,!0,!0]);const Kl=2305;class pn{constructor(l,f,v){this.enable=l,this.mode=f,this.frontFace=v}}pn.disabled=new pn(!1,1029,Kl),pn.backCCW=new pn(!0,1029,Kl),pn.frontCCW=new pn(!0,1028,Kl);class Ki{constructor(l,f,v){this.func=l,this.mask=f,this.range=v}}Ki.ReadOnly=!1,Ki.ReadWrite=!0,Ki.disabled=new Ki(519,Ki.ReadOnly,[0,1]);const Jl=7680;class bn{constructor(l,f,v,w,I,k){this.test=l,this.ref=f,this.mask=v,this.fail=w,this.depthFail=I,this.pass=k}}bn.disabled=new bn({func:519,mask:0},0,0,Jl,Jl,Jl);const Au=new WeakMap;function wo(A){var l;if(Au.has(A))return Au.get(A);{const f=(l=A.getParameter(A.VERSION))===null||l===void 0?void 0:l.startsWith("WebGL 2.0");return Au.set(A,f),f}}class Ql{get awaitingQuery(){return!!this._readbackQueue}constructor(l){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=l;const f=l.context,v=f.gl;this._texFormat=v.RGBA,this._texType=v.UNSIGNED_BYTE;const w=new s.aW;w.emplaceBack(-1,-1),w.emplaceBack(2,-1),w.emplaceBack(-1,2);const I=new s.aY;I.emplaceBack(0,1,2),this._fullscreenTriangle=new On(f.createVertexBuffer(w,Sa.members),f.createIndexBuffer(I),s.aX.simpleSegment(0,0,w.length,I.length)),this._resultBuffer=new Uint8Array(4),f.activeTexture.set(v.TEXTURE1);const k=v.createTexture();v.bindTexture(v.TEXTURE_2D,k),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.NEAREST),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.NEAREST),v.texImage2D(v.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=f.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(k),wo(v)&&(this._pbo=v.createBuffer(),v.bindBuffer(v.PIXEL_PACK_BUFFER,this._pbo),v.bufferData(v.PIXEL_PACK_BUFFER,4,v.STREAM_READ),v.bindBuffer(v.PIXEL_PACK_BUFFER,null))}destroy(){const l=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),l.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(l,f){const v=this._updateCount;return this._readbackQueue?v>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():v>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(l,f),this._updateCount++,this._measuredError}_bindFramebuffer(){const l=this._cachedRenderContext.context,f=l.gl;l.activeTexture.set(f.TEXTURE1),f.bindTexture(f.TEXTURE_2D,this._fbo.colorAttachment.get()),l.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(l,f){const v=this._cachedRenderContext.context,w=v.gl;if(this._bindFramebuffer(),v.viewport.set([0,0,this._texWidth,this._texHeight]),v.clear({color:s.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(v,w.TRIANGLES,Ki.disabled,bn.disabled,zn.unblended,pn.disabled,((I,k)=>({u_input:I,u_output_expected:k}))(l,f),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&wo(w)){w.bindBuffer(w.PIXEL_PACK_BUFFER,this._pbo),w.readBuffer(w.COLOR_ATTACHMENT0),w.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),w.bindBuffer(w.PIXEL_PACK_BUFFER,null);const I=w.fenceSync(w.SYNC_GPU_COMMANDS_COMPLETE,0);w.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:I}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const l=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&wo(l)){const f=l.clientWaitSync(this._readbackQueue.sync,0,0);if(f===l.WAIT_FAILED)return s.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(f===l.TIMEOUT_EXPIRED)return;l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),l.bindBuffer(l.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),l.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Ql._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(l){let f=0;return f+=l[0]/256,f+=l[1]/65536,f+=l[2]/16777216,l[3]<127&&(f=-f),f/128}}const Ma=s.a5/128;function Fp(A,l){const f=A.granularity!==void 0?Math.max(A.granularity,1):1,v=f+(A.generateBorders?2:0),w=f+(A.extendToNorthPole||A.generateBorders?1:0)+(A.extendToSouthPole||A.generateBorders?1:0),I=v+1,k=w+1,B=A.generateBorders?-1:0,W=A.generateBorders||A.extendToNorthPole?-1:0,Z=f+(A.generateBorders?1:0),J=f+(A.generateBorders||A.extendToSouthPole?1:0),he=I*k,ue=v*w*6,_e=I*k>65536;if(_e&&l==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const Ce=_e||l==="32bit",Fe=new Int16Array(2*he);let Ne=0;for(let tt=W;tt<=J;tt++)for(let je=B;je<=Z;je++){let Qe=je/f*s.a5;je===-1&&(Qe=-Ma),je===f+1&&(Qe=s.a5+Ma);let at=tt/f*s.a5;tt===-1&&(at=A.extendToNorthPole?s.br:-Ma),tt===f+1&&(at=A.extendToSouthPole?s.bs:s.a5+Ma),Fe[Ne++]=Qe,Fe[Ne++]=at}const ze=Ce?new Uint32Array(ue):new Uint16Array(ue);let We=0;for(let tt=0;tt<w;tt++)for(let je=0;je<v;je++){const Qe=je+1+tt*I,at=je+(tt+1)*I,Ke=je+1+(tt+1)*I;ze[We++]=je+tt*I,ze[We++]=at,ze[We++]=Qe,ze[We++]=Qe,ze[We++]=at,ze[We++]=Ke}return{vertices:Fe.buffer.slice(0),indices:ze.buffer.slice(0),uses32bitIndices:Ce}}const Pu=new s.aV({fill:new s.bt(128,2),line:new s.bt(512,0),tile:new s.bt(128,32),stencil:new s.bt(128,1),circle:3});class Qd{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return xn.projectionGlobe}get vertexShaderPreludeCode(){return xn.projectionMercator.vertexSource}get subdivisionGranularity(){return Pu}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(l){this._errorMeasurement||(this._errorMeasurement=new Ql(l));const f=s.X(this._errorQueryLatitudeDegrees),v=2*Math.atan(Math.exp(Math.PI-f*Math.PI*2))-.5*Math.PI,w=this._errorMeasurement.updateErrorLoop(f,v),I=P();w!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=w,this._errorMeasurementLastChangeTime=I);const k=Math.min(Math.max((I-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=s.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,s.bv(k))}_getMeshKey(l){return`${l.granularity.toString(36)}_${l.generateBorders?"b":""}${l.extendToNorthPole?"n":""}${l.extendToSouthPole?"s":""}`}getMeshFromTileID(l,f,v,w,I){const k=(I==="stencil"?Pu.stencil:Pu.tile).getGranularityForZoomLevel(f.z);return this._getMesh(l,{granularity:k,generateBorders:v,extendToNorthPole:f.y===0&&w,extendToSouthPole:f.y===(1<<f.z)-1&&w})}_getMesh(l,f){const v=this._getMeshKey(f);if(v in this._tileMeshCache)return this._tileMeshCache[v];const w=(function(I,k){const B=Fp(k,"16bit"),W=s.aW.deserialize({arrayBuffer:B.vertices,length:B.vertices.byteLength/2/2}),Z=s.aY.deserialize({arrayBuffer:B.indices,length:B.indices.byteLength/2/3});return new On(I.createVertexBuffer(W,Sa.members),I.createIndexBuffer(Z),s.aX.simpleSegment(0,0,W.length,Z.length))})(l,f);return this._tileMeshCache[v]=w,w}recalculate(l){}hasTransition(){const l=P();let f=!1;return f=f||(l-this._errorMeasurementLastChangeTime)/1e3<.7,f=f||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,f}setErrorQueryLatitudeDegrees(l){this._errorQueryLatitudeDegrees=l}}const y_=new s.t({type:new s.D(s.u.projection.type)});class Op extends s.E{constructor(l){super(),this._transitionable=new s.x(y_,void 0),this.setProjection(l),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.H(0)),this._mercatorProjection=new $s,this._verticalPerspectiveProjection=new Qd}get transitionState(){const l=this.properties.get("type");if(typeof l=="string"&&l==="mercator")return 0;if(typeof l=="string"&&l==="vertical-perspective")return 1;if(l instanceof s.bw){if(l.from==="vertical-perspective"&&l.to==="mercator")return 1-l.transition;if(l.from==="mercator"&&l.to==="vertical-perspective")return l.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(l){this._mercatorProjection.updateGPUdependent(l),this._verticalPerspectiveProjection.updateGPUdependent(l)}getMeshFromTileID(l,f,v,w,I){return this.currentProjection.getMeshFromTileID(l,f,v,w,I)}setProjection(l){this._transitionable.setValue("type",l?.type||"mercator")}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}setErrorQueryLatitudeDegrees(l){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(l),this._mercatorProjection.setErrorQueryLatitudeDegrees(l)}}function vr(A){const l=ec(A.worldSize,A.center.lat);return 2*Math.PI*l}function Vo(A,l,f,v,w){const I=1/(1<<w),k=l/s.a5*I+v*I,B=s.by((A/s.a5*I+f*I)*Math.PI*2+Math.PI,2*Math.PI),W=2*Math.atan(Math.exp(Math.PI-k*Math.PI*2))-.5*Math.PI,Z=Math.cos(W),J=new Float64Array(3);return J[0]=Math.sin(B)*Z,J[1]=Math.sin(W),J[2]=Math.cos(B)*Z,J}function rr(A){return(function(l,f){const v=Math.cos(f),w=new Float64Array(3);return w[0]=Math.sin(l)*v,w[1]=Math.sin(f),w[2]=Math.cos(l)*v,w})(A.lng*Math.PI/180,A.lat*Math.PI/180)}function ec(A,l){return A/(2*Math.PI)/Math.cos(l*Math.PI/180)}function ef(A){const l=Math.asin(A[1])/Math.PI*180,f=Math.sqrt(A[0]*A[0]+A[2]*A[2]);if(f>1e-6){const v=A[0]/f,w=Math.acos(A[2]/f),I=(v>0?w:-w)/Math.PI*180;return new s.V(s.W(I,-180,180),l)}return new s.V(0,l)}function Iu(A){return Math.cos(A*Math.PI/180)}function yr(A,l){const f=Iu(A),v=Iu(l);return s.at(v/f)}function zp(A,l){const f=A.rotate(l.bearingInRadians),v=l.zoom+yr(l.center.lat,0),w=s.bu(1/Iu(l.center.lat),1/Iu(Math.min(Math.abs(l.center.lat),60)),s.bx(v,7,3,0,1)),I=360/vr({worldSize:l.worldSize,center:{lat:l.center.lat}});return new s.V(l.center.lng-f.x*I*w,s.an(l.center.lat+f.y*I,-s.ao,s.ao))}function tf(A){const l=.5*A,f=Math.sin(l),v=Math.cos(l);return Math.log(f+v)-Math.log(v-f)}function Bp(A,l,f,v){const w=A.lat+f*v;if(Math.abs(f)>1){const I=(Math.sign(A.lat+f)!==Math.sign(A.lat)?-Math.abs(A.lat):Math.abs(A.lat))*Math.PI/180,k=Math.abs(A.lat+f)*Math.PI/180,B=tf(I+v*(k-I)),W=tf(I),Z=tf(k);return new s.V(A.lng+l*((B-W)/(Z-W)),w)}return new s.V(A.lng+l*v,w)}class nf{constructor(l){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=l}swapBuffers(){if(!this._hadAnyChanges)return;const l=this._cachePrevious;this._cachePrevious=this._cache,this._cache=l,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(l,f,v,w){const I=`${l.z}_${l.x}_${l.y}_${w?.terrain?"t":""}`,k=this._cache.get(I);if(k)return k;const B=this._cachePrevious.get(I);if(B)return this._cache.set(I,B),B;const W=this._boundingVolumeFactory(l,f,v,w);return this._cache.set(I,W),this._hadAnyChanges=!0,W}}class Ca{constructor(l,f,v,w){this.min=v,this.max=w,this.points=l,this.planes=f}static fromAabb(l,f){const v=[];for(let w=0;w<8;w++)v.push([1&~w?l[0]:f[0],(w>>1&1)==1?f[1]:l[1],(w>>2&1)==1?f[2]:l[2]]);return new Ca(v,[[-1,0,0,f[0]],[1,0,0,-l[0]],[0,-1,0,f[1]],[0,1,0,-l[1]],[0,0,-1,f[2]],[0,0,1,-l[2]]],l,f)}static fromCenterSizeAngles(l,f,v){const w=s.bB([],v[0],v[1],v[2]),I=s.bC([],[f[0],0,0],w),k=s.bC([],[0,f[1],0],w),B=s.bC([],[0,0,f[2]],w),W=[...l],Z=[...l];for(let he=0;he<8;he++)for(let ue=0;ue<3;ue++){const _e=l[ue]+I[ue]*(1&~he?-1:1)+k[ue]*((he>>1&1)==1?1:-1)+B[ue]*((he>>2&1)==1?1:-1);W[ue]=Math.min(W[ue],_e),Z[ue]=Math.max(Z[ue],_e)}const J=[];for(let he=0;he<8;he++){const ue=[...l];s.b0(ue,ue,s.a$([],I,1&~he?-1:1)),s.b0(ue,ue,s.a$([],k,(he>>1&1)==1?1:-1)),s.b0(ue,ue,s.a$([],B,(he>>2&1)==1?1:-1)),J.push(ue)}return new Ca(J,[[...I,-s.b5(I,J[0])],[...k,-s.b5(k,J[0])],[...B,-s.b5(B,J[0])],[-I[0],-I[1],-I[2],-s.b5(I,J[7])],[-k[0],-k[1],-k[2],-s.b5(k,J[7])],[-B[0],-B[1],-B[2],-s.b5(B,J[7])]],W,Z)}intersectsFrustum(l){let f=!0;const v=this.points.length,w=this.planes.length,I=l.planes.length,k=l.points.length;for(let B=0;B<I;B++){const W=l.planes[B];let Z=0;for(let J=0;J<v;J++){const he=this.points[J];W[0]*he[0]+W[1]*he[1]+W[2]*he[2]+W[3]>=0&&Z++}if(Z===0)return 0;Z<v&&(f=!1)}if(f)return 2;for(let B=0;B<w;B++){const W=this.planes[B];let Z=0;for(let J=0;J<k;J++){const he=l.points[J];W[0]*he[0]+W[1]*he[1]+W[2]*he[2]+W[3]>=0&&Z++}if(Z===0)return 0}return 1}intersectsPlane(l){const f=this.points.length;let v=0;for(let w=0;w<f;w++){const I=this.points[w];l[0]*I[0]+l[1]*I[1]+l[2]*I[2]+l[3]>=0&&v++}return v===f?2:v===0?0:1}}function $h(A,l,f){const v=A-l;return v<0?-v:Math.max(0,v-f)}function tc(A,l,f,v,w){const I=A-f;let k;return k=I<0?Math.min(-I,1+I-w):I>1?Math.min(Math.max(I-w,0),1-I):0,Math.max(k,$h(l,v,w))}class Vh{constructor(){this._boundingVolumeCache=new nf(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(l,f,v,w){const I=1<<v.z,k=1/I,B=v.x/I,W=v.y/I;let Z=2;return Z=Math.min(Z,tc(l,f,B,W,k)),Z=Math.min(Z,tc(l,f,B+.5,-W-k,k)),Z=Math.min(Z,tc(l,f,B+.5,2-W-k,k)),Z}getWrap(l,f,v){const w=1<<f.z,I=1/w,k=f.x/w,B=$h(l.x,k,I),W=$h(l.x,k-1,I),Z=$h(l.x,k+1,I),J=Math.min(B,W,Z);return J===Z?1:J===W?-1:0}allowVariableZoom(l,f){return Cn(l,f)>4}allowWorldCopies(){return!1}getTileBoundingVolume(l,f,v,w){return this._boundingVolumeCache.getTileBoundingVolume(l,f,v,w)}_computeTileBoundingVolume(l,f,v,w){var I,k;let B=0,W=0;if(w?.terrain){const Z=new s.a2(l.z,f,l.z,l.x,l.y),J=w.terrain.getMinMaxElevation(Z);B=(I=J.minElevation)!==null&&I!==void 0?I:Math.min(0,v),W=(k=J.maxElevation)!==null&&k!==void 0?k:Math.max(0,v)}if(B/=s.bE,W/=s.bE,B+=1,W+=1,l.z<=0)return Ca.fromAabb([-W,-W,-W],[W,W,W]);if(l.z===1)return Ca.fromAabb([l.x===0?-W:0,l.y===0?0:-W,-W],[l.x===0?0:W,l.y===0?W:0,W]);{const Z=[Vo(0,0,l.x,l.y,l.z),Vo(s.a5,0,l.x,l.y,l.z),Vo(s.a5,s.a5,l.x,l.y,l.z),Vo(0,s.a5,l.x,l.y,l.z)],J=[];for(const At of Z)J.push(s.a$([],At,W));if(W!==B)for(const At of Z)J.push(s.a$([],At,B));l.y===0&&J.push([0,1,0]),l.y===(1<<l.z)-1&&J.push([0,-1,0]);const he=[1,1,1],ue=[-1,-1,-1];for(const At of J)for(let Pt=0;Pt<3;Pt++)he[Pt]=Math.min(he[Pt],At[Pt]),ue[Pt]=Math.max(ue[Pt],At[Pt]);const _e=Vo(s.a5/2,s.a5/2,l.x,l.y,l.z),Ce=s.b4([],[0,1,0],_e);s.b3(Ce,Ce);const Fe=s.b4([],_e,Ce);s.b3(Fe,Fe);const Ne=s.b4([],Z[2],Z[1]);s.b3(Ne,Ne);const ze=s.b4([],Z[0],Z[3]);s.b3(ze,ze),J.push(s.a$([],_e,W)),l.y>=(1<<l.z)/2&&J.push(s.a$([],Vo(s.a5/2,0,l.x,l.y,l.z),W)),l.y<(1<<l.z)/2&&J.push(s.a$([],Vo(s.a5/2,s.a5,l.x,l.y,l.z),W));const We=Ea(_e,J),tt=Ea(Fe,J),je=[-_e[0],-_e[1],-_e[2],We.max],Qe=[_e[0],_e[1],_e[2],-We.min],at=[-Fe[0],-Fe[1],-Fe[2],tt.max],Ke=[Fe[0],Fe[1],Fe[2],-tt.min],mt=[...Ne,0],Lt=[...ze,0],Et=[];return l.y===0?Et.push(s.bD(Lt,mt,je),s.bD(Lt,mt,Qe)):Et.push(s.bD(at,mt,je),s.bD(at,mt,Qe),s.bD(at,Lt,je),s.bD(at,Lt,Qe)),l.y===(1<<l.z)-1?Et.push(s.bD(Lt,mt,je),s.bD(Lt,mt,Qe)):Et.push(s.bD(Ke,mt,je),s.bD(Ke,mt,Qe),s.bD(Ke,Lt,je),s.bD(Ke,Lt,Qe)),new Ca(Et,[je,Qe,at,Ke,mt,Lt],he,ue)}}}function Ea(A,l){let f=1/0,v=-1/0;for(const w of l){const I=s.b5(A,w);f=Math.min(f,I),v=Math.max(v,I)}return{min:f,max:v}}class _l{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(l){this._helper.setMinZoom(l)}setMaxZoom(l){this._helper.setMaxZoom(l)}setMinPitch(l){this._helper.setMinPitch(l)}setMaxPitch(l){this._helper.setMaxPitch(l)}setRenderWorldCopies(l){this._helper.setRenderWorldCopies(l)}setBearing(l){this._helper.setBearing(l)}setPitch(l){this._helper.setPitch(l)}setRoll(l){this._helper.setRoll(l)}setFov(l){this._helper.setFov(l)}setZoom(l){this._helper.setZoom(l)}setCenter(l){this._helper.setCenter(l)}setElevation(l){this._helper.setElevation(l)}setMinElevationForCurrentTile(l){this._helper.setMinElevationForCurrentTile(l)}setPadding(l){this._helper.setPadding(l)}interpolatePadding(l,f,v){return this._helper.interpolatePadding(l,f,v)}isPaddingEqual(l){return this._helper.isPaddingEqual(l)}resize(l,f){this._helper.resize(l,f)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(l){this._helper.setMaxBounds(l)}setConstrainOverride(l){this._helper.setConstrainOverride(l)}overrideNearFarZ(l,f){this._helper.overrideNearFarZ(l,f)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(l){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),l)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(l){}constructor(l){this._cachedClippingPlane=s.bF(),this._projectionMatrix=s.bj(),this._globeViewProjMatrix32f=s.bi(),this._globeViewProjMatrixNoCorrection=s.bj(),this._globeViewProjMatrixNoCorrectionInverted=s.bj(),this._globeProjMatrixInverted=s.bj(),this._cameraPosition=s.bz(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(f,v)=>{const w=s.an(f.lat,-s.ao,s.ao),I=s.an(+v,this.minZoom+yr(0,w),this.maxZoom);return{center:new s.V(f.lng,w),zoom:I}},this.applyConstrain=(f,v)=>this._helper.applyConstrain(f,v),this._helper=new Xl({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(f,v)=>this.defaultConstrain(f,v)},l),this._coveringTilesDetailsProvider=new Vh}clone(){const l=new _l;return l.apply(this),l}apply(l,f){this._globeLatitudeErrorCorrectionRadians=f||0,this._helper.apply(l)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const l=s.bz();return l[0]=this._cameraPosition[0],l[1]=this._cameraPosition[1],l[2]=this._cameraPosition[2],l}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(l){const{overscaledTileID:f,applyGlobeMatrix:v}=l,w=this._helper.getMercatorTileCoordinates(f);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:w,clippingPlane:this._cachedClippingPlane,projectionTransition:v?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(l){const f=this.pitchInRadians,v=this.cameraToCenterDistance/l,w=Math.sin(f)*v,I=Math.cos(f)*v+1,k=1/Math.sqrt(w*w+I*I)*1;let B=-w,W=I;const Z=Math.sqrt(B*B+W*W);B/=Z,W/=Z;const J=[0,B,W];s.bG(J,J,[0,0,0],-this.bearingInRadians),s.bH(J,J,[0,0,0],-1*this.center.lat*Math.PI/180),s.bI(J,J,[0,0,0],this.center.lng*Math.PI/180);const he=1/s.b7(J);return s.a$(J,J,he),[...J,-k*he]}isLocationOccluded(l){return!this.isSurfacePointVisible(rr(l))}transformLightDirection(l){const f=this._helper._center.lng*Math.PI/180,v=this._helper._center.lat*Math.PI/180,w=Math.cos(v),I=[Math.sin(f)*w,Math.sin(v),Math.cos(f)*w],k=[I[2],0,-I[0]],B=[0,0,0];s.b4(B,k,I),s.b3(k,k),s.b3(B,B);const W=[0,0,0];return s.b3(W,[k[0]*l[0]+B[0]*l[1]+I[0]*l[2],k[1]*l[0]+B[1]*l[1]+I[1]*l[2],k[2]*l[0]+B[2]*l[1]+I[2]*l[2]]),W}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(l,f,v){const w=(function(B,W,Z){const J=1/(1<<Z.z);return new s.a9(B/s.a5*J+Z.x*J,W/s.a5*J+Z.y*J)})(l,f,v.canonical),I=(k=w.y,[s.by(w.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-k*Math.PI*2))-.5*Math.PI]);var k;return this.getCircleRadiusCorrection()/Math.cos(I[1])}projectTileCoordinates(l,f,v,w){const I=v.canonical,k=Vo(l,f,I.x,I.y,I.z),B=1+(w?w(l,f):0)/s.bE,W=[k[0]*B,k[1]*B,k[2]*B,1];s.aH(W,W,this._globeViewProjMatrixNoCorrection);const Z=this._cachedClippingPlane,J=Z[0]*k[0]+Z[1]*k[1]+Z[2]*k[2]+Z[3]<0;return{point:new s.P(W[0]/W[3],W[1]/W[3]),signedDistanceFromCamera:W[3],isOccluded:J}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const l=ec(this.worldSize,this.center.lat),f=s.bk(),v=s.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*l),s.be(f,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const w=this.centerOffset;f[8]=2*-w.x/this._helper._width,f[9]=2*w.y/this._helper._height,this._projectionMatrix=s.bf(f),this._globeProjMatrixInverted=s.bk(),s.aB(this._globeProjMatrixInverted,f),s.O(f,f,[0,0,-this.cameraToCenterDistance]),s.bg(f,f,this.rollInRadians),s.bh(f,f,-this.pitchInRadians),s.bg(f,f,this.bearingInRadians),s.O(f,f,[0,0,-l]);const I=s.bz();I[0]=l,I[1]=l,I[2]=l,s.bh(v,f,this.center.lat*Math.PI/180),s.bJ(v,v,-this.center.lng*Math.PI/180),s.Q(v,v,I),this._globeViewProjMatrixNoCorrection=v,s.bh(f,f,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),s.bJ(f,f,-this.center.lng*Math.PI/180),s.Q(f,f,I),this._globeViewProjMatrix32f=new Float32Array(f),this._globeViewProjMatrixNoCorrectionInverted=s.bk(),s.aB(this._globeViewProjMatrixNoCorrectionInverted,v);const k=s.bz();this._cameraPosition=s.bz(),this._cameraPosition[2]=this.cameraToCenterDistance/l,s.bG(this._cameraPosition,this._cameraPosition,k,-this.rollInRadians),s.bH(this._cameraPosition,this._cameraPosition,k,this.pitchInRadians),s.bG(this._cameraPosition,this._cameraPosition,k,-this.bearingInRadians),s.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),s.bH(this._cameraPosition,this._cameraPosition,k,-this.center.lat*Math.PI/180),s.bI(this._cameraPosition,this._cameraPosition,k,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(l);const B=s.bf(this._globeViewProjMatrixNoCorrectionInverted);s.Q(B,B,[1,1,-1]),this._cachedFrustum=Cs.fromInvProjectionMatrix(B,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(l){s.w("calculateFogMatrix is not supported on globe projection.");const f=s.bk();return s.ar(f),f}getVisibleUnwrappedCoordinates(l){return[new s.bc(0,l)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(l){l&&s.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(l,f){if(!this._globeViewProjMatrixNoCorrection)return 1;const v=rr(l);s.a$(v,v,1+f/s.bE);const w=s.bF();return s.aH(w,[v[0],v[1],v[2],1],this._globeViewProjMatrixNoCorrection),w[2]/w[3]}populateCache(l){}getBounds(){const l=.5*this.width,f=.5*this.height,v=[new s.P(0,0),new s.P(l,0),new s.P(this.width,0),new s.P(this.width,f),new s.P(this.width,this.height),new s.P(l,this.height),new s.P(0,this.height),new s.P(0,f)],w=[];for(const he of v)w.push(this.unprojectScreenPoint(he));let I=0,k=0,B=0,W=0;const Z=this.center;for(const he of w){const ue=s.bK(Z.lng,he.lng),_e=s.bK(Z.lat,he.lat);ue<k&&(k=ue),ue>I&&(I=ue),_e<W&&(W=_e),_e>B&&(B=_e)}const J=[Z.lng+k,Z.lat+W,Z.lng+I,Z.lat+B];return this.isSurfacePointOnScreen([0,1,0])&&(J[3]=90,J[0]=-180,J[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(J[1]=-90,J[0]=-180,J[2]=180),new Ae(J)}calculateCenterFromCameraLngLatAlt(l,f,v,w){return this._helper.calculateCenterFromCameraLngLatAlt(l,f,v,w)}setLocationAtPoint(l,f){const v=rr(this.unprojectScreenPoint(f)),w=rr(l),I=s.bz();s.bL(I);const k=s.bz();s.bI(k,v,I,-this.center.lng*Math.PI/180),s.bH(k,k,I,this.center.lat*Math.PI/180);const B=w[0]*w[0]+w[2]*w[2],W=k[0]*k[0];if(B<W)return;const Z=Math.sqrt(B-W),J=-Z,he=s.bM(w[0],w[2],k[0],Z),ue=s.bM(w[0],w[2],k[0],J),_e=s.bz();s.bI(_e,w,I,-he);const Ce=s.bM(_e[1],_e[2],k[1],k[2]),Fe=s.bz();s.bI(Fe,w,I,-ue);const Ne=s.bM(Fe[1],Fe[2],k[1],k[2]),ze=.5*Math.PI,We=Ce>=-ze&&Ce<=ze,tt=Ne>=-ze&&Ne<=ze;let je,Qe;if(We&&tt){const Lt=this.center.lng*Math.PI/180,Et=this.center.lat*Math.PI/180;s.bN(he,Lt)+s.bN(Ce,Et)<s.bN(ue,Lt)+s.bN(Ne,Et)?(je=he,Qe=Ce):(je=ue,Qe=Ne)}else if(We)je=he,Qe=Ce;else{if(!tt)return;je=ue,Qe=Ne}const at=je/Math.PI*180,Ke=Qe/Math.PI*180,mt=this.center.lat;this.setCenter(new s.V(at,s.an(Ke,-90,90))),this.setZoom(this.zoom+yr(mt,this.center.lat))}locationToScreenPoint(l,f){const v=rr(l);if(f){const w=f.getElevationForLngLatZoom(l,this._helper._tileZoom);s.a$(v,v,1+w/s.bE)}return this._projectSurfacePointToScreen(v)}_projectSurfacePointToScreen(l){const f=s.bF();return s.aH(f,[...l,1],this._globeViewProjMatrixNoCorrection),f[0]/=f[3],f[1]/=f[3],new s.P((.5*f[0]+.5)*this.width,(.5*-f[1]+.5)*this.height)}screenPointToMercatorCoordinate(l,f){if(f){const v=f.pointCoordinate(l);if(v)return v}return s.a9.fromLngLat(this.unprojectScreenPoint(l))}screenPointToLocation(l,f){var v;return(v=this.screenPointToMercatorCoordinate(l,f))===null||v===void 0?void 0:v.toLngLat()}isPointOnMapSurface(l,f){const v=this._cameraPosition,w=this.getRayDirectionFromPixel(l);return!!this.rayPlanetIntersection(v,w)}getRayDirectionFromPixel(l){const f=s.bF();f[0]=l.x/this.width*2-1,f[1]=-1*(l.y/this.height*2-1),f[2]=1,f[3]=1,s.aH(f,f,this._globeViewProjMatrixNoCorrectionInverted),f[0]/=f[3],f[1]/=f[3],f[2]/=f[3];const v=s.bz();v[0]=f[0]-this._cameraPosition[0],v[1]=f[1]-this._cameraPosition[1],v[2]=f[2]-this._cameraPosition[2];const w=s.bz();return s.b3(w,v),w}isSurfacePointVisible(l){const f=this._cachedClippingPlane;return f[0]*l[0]+f[1]*l[1]+f[2]*l[2]+f[3]>=0}isSurfacePointOnScreen(l){if(!this.isSurfacePointVisible(l))return!1;const f=s.bF();return s.aH(f,[...l,1],this._globeViewProjMatrixNoCorrection),f[0]/=f[3],f[1]/=f[3],f[2]/=f[3],f[0]>-1&&f[0]<1&&f[1]>-1&&f[1]<1&&f[2]>-1&&f[2]<1}rayPlanetIntersection(l,f){const v=s.b5(l,f),w=s.bz(),I=s.bz();s.a$(I,f,v),s.b2(w,l,I);const k=1-s.b5(w,w);if(k<0)return null;const B=s.b5(l,l)-1,W=-v+(v<0?1:-1)*Math.sqrt(k),Z=B/W,J=W;return{tMin:Math.min(Z,J),tMax:Math.max(Z,J)}}unprojectScreenPoint(l){const f=this._cameraPosition,v=this.getRayDirectionFromPixel(l),w=this.rayPlanetIntersection(f,v);if(w){const J=s.bz();s.b0(J,f,[v[0]*w.tMin,v[1]*w.tMin,v[2]*w.tMin]);const he=s.bz();return s.b3(he,J),ef(he)}const I=this._cachedClippingPlane,k=I[0]*v[0]+I[1]*v[1]+I[2]*v[2],B=-s.bb(I,f)/k,W=s.bz();if(B>0)s.b0(W,f,[v[0]*B,v[1]*B,v[2]*B]);else{const J=s.bz();s.b0(J,f,[2*v[0],2*v[1],2*v[2]]);const he=s.bb(this._cachedClippingPlane,J);s.b2(W,J,[this._cachedClippingPlane[0]*he,this._cachedClippingPlane[1]*he,this._cachedClippingPlane[2]*he])}const Z=(function(J){const he=s.bz();return he[0]=J[0]*-J[3],he[1]=J[1]*-J[3],he[2]=J[2]*-J[3],{center:he,radius:Math.sqrt(1-J[3]*J[3])}})(I);return ef((function(J,he,ue){const _e=s.bz();s.b2(_e,ue,J);const Ce=s.bz();return s.bA(Ce,J,_e,he/s.b9(_e)),Ce})(Z.center,Z.radius,W))}getMatrixForModel(l,f){const v=s.V.convert(l),w=1/s.bE,I=s.bj();return s.bJ(I,I,v.lng/180*Math.PI),s.bh(I,I,-v.lat/180*Math.PI),s.O(I,I,[0,0,1+f/s.bE]),s.bh(I,I,.5*Math.PI),s.Q(I,I,[w,w,w]),I}getProjectionDataForCustomLayer(l=!0){const f=this.getProjectionData({overscaledTileID:new s.a2(0,0,0,0,0),applyGlobeMatrix:l});return f.tileMercatorCoords=[0,0,1,1],f}getFastPathSimpleProjectionMatrix(l){}}class vl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(l){this._helper.setMinZoom(l)}setMaxZoom(l){this._helper.setMaxZoom(l)}setMinPitch(l){this._helper.setMinPitch(l)}setMaxPitch(l){this._helper.setMaxPitch(l)}setRenderWorldCopies(l){this._helper.setRenderWorldCopies(l)}setBearing(l){this._helper.setBearing(l)}setPitch(l){this._helper.setPitch(l)}setRoll(l){this._helper.setRoll(l)}setFov(l){this._helper.setFov(l)}setZoom(l){this._helper.setZoom(l)}setCenter(l){this._helper.setCenter(l)}setElevation(l){this._helper.setElevation(l)}setMinElevationForCurrentTile(l){this._helper.setMinElevationForCurrentTile(l)}setPadding(l){this._helper.setPadding(l)}interpolatePadding(l,f,v){return this._helper.interpolatePadding(l,f,v)}isPaddingEqual(l){return this._helper.isPaddingEqual(l)}resize(l,f,v=!0){this._helper.resize(l,f,v)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(l){this._helper.setMaxBounds(l)}setConstrainOverride(l){this._helper.setConstrainOverride(l)}overrideNearFarZ(l,f){this._helper.overrideNearFarZ(l,f)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(l){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),l)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(l,f){this._globeness=l,this._globeLatitudeErrorCorrectionRadians=f,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(l){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(f,v)=>this.currentTransform.defaultConstrain(f,v),this.applyConstrain=(f,v)=>this._helper.applyConstrain(f,v),this._helper=new Xl({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(f,v)=>this.defaultConstrain(f,v)},l),this._globeness=1,this._mercatorTransform=new Yl,this._verticalPerspectiveTransform=new _l}clone(){const l=new vl;return l._globeness=this._globeness,l._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,l.apply(this),l}apply(l){this._helper.apply(l),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(l){const f=this._mercatorTransform.getProjectionData(l),v=this._verticalPerspectiveTransform.getProjectionData(l);return{mainMatrix:this.isGlobeRendering?v.mainMatrix:f.mainMatrix,clippingPlane:v.clippingPlane,tileMercatorCoords:v.tileMercatorCoords,projectionTransition:l.applyGlobeMatrix?this._globeness:0,fallbackMatrix:f.fallbackMatrix}}isLocationOccluded(l){return this.currentTransform.isLocationOccluded(l)}transformLightDirection(l){return this.currentTransform.transformLightDirection(l)}getPixelScale(){return s.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return s.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(l,f,v){const w=this._mercatorTransform.getPitchedTextCorrection(l,f,v),I=this._verticalPerspectiveTransform.getPitchedTextCorrection(l,f,v);return s.bu(w,I,this._globeness)}projectTileCoordinates(l,f,v,w){return this.currentTransform.projectTileCoordinates(l,f,v,w)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(l){return this.currentTransform.calculateFogMatrix(l)}getVisibleUnwrappedCoordinates(l){return this.currentTransform.getVisibleUnwrappedCoordinates(l)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(l){this._mercatorTransform.recalculateZoomAndCenter(l),this._verticalPerspectiveTransform.recalculateZoomAndCenter(l)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(l,f){return this.currentTransform.lngLatToCameraDepth(l,f)}populateCache(l){this._mercatorTransform.populateCache(l),this._verticalPerspectiveTransform.populateCache(l)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(l,f,v,w){return this._helper.calculateCenterFromCameraLngLatAlt(l,f,v,w)}setLocationAtPoint(l,f){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(l,f),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(l,f),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(l,f){return this.currentTransform.locationToScreenPoint(l,f)}screenPointToMercatorCoordinate(l,f){return this.currentTransform.screenPointToMercatorCoordinate(l,f)}screenPointToLocation(l,f){return this.currentTransform.screenPointToLocation(l,f)}isPointOnMapSurface(l,f){return this.currentTransform.isPointOnMapSurface(l,f)}getRayDirectionFromPixel(l){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(l)}getMatrixForModel(l,f){return this.currentTransform.getMatrixForModel(l,f)}getProjectionDataForCustomLayer(l=!0){const f=this._mercatorTransform.getProjectionDataForCustomLayer(l);if(!this.isGlobeRendering)return f;const v=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(l);return v.fallbackMatrix=f.mainMatrix,v}getFastPathSimpleProjectionMatrix(l){return this.currentTransform.getFastPathSimpleProjectionMatrix(l)}}class qr{get useGlobeControls(){return!0}handlePanInertia(l,f){const v=zp(l,f);return Math.abs(v.lng-f.center.lng)>180&&(v.lng=f.center.lng+179.5*Math.sign(v.lng-f.center.lng)),{easingCenter:v,easingOffset:new s.P(0,0)}}handleMapControlsRollPitchBearingZoom(l,f){const v=l.around,w=f.screenPointToLocation(v);l.bearingDelta&&f.setBearing(f.bearing+l.bearingDelta),l.pitchDelta&&f.setPitch(f.pitch+l.pitchDelta),l.rollDelta&&f.setRoll(f.roll+l.rollDelta);const I=f.zoom;l.zoomDelta&&f.setZoom(f.zoom+l.zoomDelta);const k=f.zoom-I;if(k===0)return;const B=s.bK(f.center.lng,w.lng),W=B/(Math.abs(B/180)+1),Z=s.bK(f.center.lat,w.lat),J=f.getRayDirectionFromPixel(v),he=f.cameraPosition,ue=-1*s.b5(he,J),_e=s.bz();s.b0(_e,he,[J[0]*ue,J[1]*ue,J[2]*ue]);const Ce=s.b7(_e)-1,Fe=Math.exp(.5*-Math.max(Ce-.3,0)),Ne=ec(f.worldSize,f.center.lat)/Math.min(f.width,f.height),ze=s.bx(Ne,.9,.5,1,.25),We=(1-s.aq(-k))*Math.min(Fe,ze),tt=f.center.lat,je=f.zoom,Qe=new s.V(f.center.lng+W*We,s.an(f.center.lat+Z*We,-s.ao,s.ao));f.setLocationAtPoint(w,v);const at=f.center,Ke=s.bx(Math.abs(B),45,85,0,1),mt=s.bx(Ne,.75,.35,0,1),Lt=Math.pow(Math.max(Ke,mt),.25),Et=s.bK(at.lng,Qe.lng),At=s.bK(at.lat,Qe.lat);f.setCenter(new s.V(at.lng+Et*Lt,at.lat+At*Lt).wrap()),f.setZoom(je+yr(tt,f.center.lat))}handleMapControlsPan(l,f,v){if(!l.panDelta)return;const w=f.center.lat,I=f.zoom;f.setCenter(zp(l.panDelta,f).wrap()),f.setZoom(I+yr(w,f.center.lat))}cameraForBoxAndBearing(l,f,v,w,I){const k=$o(l,f,v,w,I),B=f.left/I.width*2-1,W=(I.width-f.right)/I.width*2-1,Z=f.top/I.height*-2+1,J=(I.height-f.bottom)/I.height*-2+1,he=s.bK(v.getWest(),v.getEast())<0,ue=he?v.getEast():v.getWest(),_e=he?v.getWest():v.getEast(),Ce=Math.max(v.getNorth(),v.getSouth()),Fe=Math.min(v.getNorth(),v.getSouth()),Ne=ue+.5*s.bK(ue,_e),ze=Ce+.5*s.bK(Ce,Fe),We=I.clone();We.setCenter(k.center),We.setBearing(k.bearing),We.setPitch(0),We.setRoll(0),We.setZoom(k.zoom);const tt=We.modelViewProjectionMatrix,je=[rr(v.getNorthWest()),rr(v.getNorthEast()),rr(v.getSouthWest()),rr(v.getSouthEast()),rr(new s.V(_e,ze)),rr(new s.V(ue,ze)),rr(new s.V(Ne,Ce)),rr(new s.V(Ne,Fe))],Qe=rr(k.center);let at=Number.POSITIVE_INFINITY;for(const Ke of je)B<0&&(at=qr.getLesserNonNegativeNonNull(at,qr.solveVectorScale(Ke,Qe,tt,"x",B))),W>0&&(at=qr.getLesserNonNegativeNonNull(at,qr.solveVectorScale(Ke,Qe,tt,"x",W))),Z>0&&(at=qr.getLesserNonNegativeNonNull(at,qr.solveVectorScale(Ke,Qe,tt,"y",Z))),J<0&&(at=qr.getLesserNonNegativeNonNull(at,qr.solveVectorScale(Ke,Qe,tt,"y",J)));if(Number.isFinite(at)&&at!==0)return k.zoom=We.zoom+s.at(at),k;Ta()}handleJumpToCenterZoom(l,f){const v=l.center.lat,w=l.applyConstrain(f.center?s.V.convert(f.center):l.center,l.zoom).center;l.setCenter(w.wrap());const I=f.zoom!==void 0?+f.zoom:l.zoom+yr(v,w.lat);l.zoom!==I&&l.setZoom(I)}handleEaseTo(l,f){const v=l.zoom,w=l.center,I=l.padding,k={roll:l.roll,pitch:l.pitch,bearing:l.bearing},B={roll:f.roll===void 0?l.roll:f.roll,pitch:f.pitch===void 0?l.pitch:f.pitch,bearing:f.bearing===void 0?l.bearing:f.bearing},W=f.zoom!==void 0,Z=!l.isPaddingEqual(f.padding);let J=!1;const he=f.center?s.V.convert(f.center):w,ue=l.applyConstrain(he,v).center;pl(l,ue);const _e=l.clone();_e.setCenter(ue),_e.setZoom(W?+f.zoom:v+yr(w.lat,he.lat)),_e.setBearing(f.bearing);const Ce=new s.P(s.an(l.centerPoint.x+f.offsetAsPoint.x,0,l.width),s.an(l.centerPoint.y+f.offsetAsPoint.y,0,l.height));_e.setLocationAtPoint(ue,Ce);const Fe=(f.offset&&f.offsetAsPoint.mag())>0?_e.center:ue,Ne=W?+f.zoom:v+yr(w.lat,Fe.lat),ze=v+yr(w.lat,0),We=Ne+yr(Fe.lat,0),tt=s.bK(w.lng,Fe.lng),je=s.bK(w.lat,Fe.lat),Qe=s.aq(We-ze);return J=Ne!==v,{easeFunc:at=>{if(s.bo(k,B)||ml({startEulerAngles:k,endEulerAngles:B,tr:l,k:at,useSlerp:k.roll!=B.roll}),Z&&l.interpolatePadding(I,f.padding,at),f.around)s.w("Easing around a point is not supported under globe projection."),l.setLocationAtPoint(f.around,f.aroundPoint);else{const Ke=We>ze?Math.min(2,Qe):Math.max(.5,Qe),mt=Math.pow(Ke,1-at),Lt=Bp(w,tt,je,at*mt);l.setCenter(Lt.wrap())}if(J){const Ke=s.G.number(ze,We,at)+yr(0,l.center.lat);l.setZoom(Ke)}},isZooming:J,elevationCenter:Fe}}handleFlyTo(l,f){const v=f.zoom!==void 0,w=l.center,I=l.zoom,k=l.padding,B=!l.isPaddingEqual(f.padding),W=l.applyConstrain(s.V.convert(f.center||f.locationAtOffset),I).center,Z=v?+f.zoom:l.zoom+yr(l.center.lat,W.lat),J=l.clone();J.setCenter(W),J.setZoom(Z),J.setBearing(f.bearing);const he=new s.P(s.an(l.centerPoint.x+f.offsetAsPoint.x,0,l.width),s.an(l.centerPoint.y+f.offsetAsPoint.y,0,l.height));J.setLocationAtPoint(W,he);const ue=J.center;pl(l,ue);const _e=(function(je,Qe,at){const Ke=rr(Qe),mt=rr(at),Lt=s.b5(Ke,mt),Et=Math.acos(Lt),At=vr(je);return Et/(2*Math.PI)*At})(l,w,ue),Ce=I+yr(w.lat,0),Fe=Z+yr(ue.lat,0),Ne=s.aq(Fe-Ce);let ze;if(typeof f.minZoom=="number"){const je=+f.minZoom+yr(ue.lat,0),Qe=Math.min(je,Ce,Fe)+yr(0,ue.lat),at=l.applyConstrain(ue,Qe).zoom+yr(ue.lat,0);ze=s.aq(at-Ce)}const We=s.bK(w.lng,ue.lng),tt=s.bK(w.lat,ue.lat);return{easeFunc:(je,Qe,at,Ke)=>{const mt=Bp(w,We,tt,at);B&&l.interpolatePadding(k,f.padding,je);const Lt=je===1?ue:mt;l.setCenter(Lt.wrap());const Et=Ce+s.at(Qe);l.setZoom(je===1?Z:Et+yr(0,Lt.lat))},scaleOfZoom:Ne,targetCenter:ue,scaleOfMinZoom:ze,pixelPathLength:_e}}static solveVectorScale(l,f,v,w,I){const k=w==="x"?[v[0],v[4],v[8],v[12]]:[v[1],v[5],v[9],v[13]],B=[v[3],v[7],v[11],v[15]],W=l[0]*k[0]+l[1]*k[1]+l[2]*k[2],Z=l[0]*B[0]+l[1]*B[1]+l[2]*B[2],J=f[0]*k[0]+f[1]*k[1]+f[2]*k[2],he=f[0]*B[0]+f[1]*B[1]+f[2]*B[2];return J+I*Z===W+I*he||B[3]*(W-J)+k[3]*(he-Z)+W*he==J*Z?null:(J+k[3]-I*he-I*B[3])/(J-W-I*he+I*Z)}static getLesserNonNegativeNonNull(l,f){return f!==null&&f>=0&&f<l?f:l}}class Np{constructor(l){this._globe=l,this._mercatorCameraHelper=new gl,this._verticalPerspectiveCameraHelper=new qr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(l,f){return this.currentHelper.handlePanInertia(l,f)}handleMapControlsRollPitchBearingZoom(l,f){return this.currentHelper.handleMapControlsRollPitchBearingZoom(l,f)}handleMapControlsPan(l,f,v){this.currentHelper.handleMapControlsPan(l,f,v)}cameraForBoxAndBearing(l,f,v,w,I){return this.currentHelper.cameraForBoxAndBearing(l,f,v,w,I)}handleJumpToCenterZoom(l,f){this.currentHelper.handleJumpToCenterZoom(l,f)}handleEaseTo(l,f){return this.currentHelper.handleEaseTo(l,f)}handleFlyTo(l,f){return this.currentHelper.handleFlyTo(l,f)}}const Fc=(A,l)=>s.B(A,l&&l.filter((f=>f.identifier!=="source.canvas"))),Uo=s.bO();class ic extends s.E{constructor(l,f={}){var v,w;super(),this._rtlPluginLoaded=()=>{for(const k in this.tileManagers){const B=this.tileManagers[k].getSource().type;B!=="vector"&&B!=="geojson"||this.tileManagers[k].reload()}},this.map=l,this.dispatcher=new xt(ct(),l._getMapId()),this.dispatcher.registerMessageHandler("GG",((k,B)=>this.getGlyphs(k,B))),this.dispatcher.registerMessageHandler("GI",((k,B)=>this.getImages(k,B))),this.dispatcher.registerMessageHandler("GDA",((k,B)=>this.getDashes(k,B))),this.imageManager=new Q,this.imageManager.setEventedParent(this);const I=((v=l._container)===null||v===void 0?void 0:v.lang)||typeof document<"u"&&((w=document.documentElement)===null||w===void 0?void 0:w.lang)||void 0;this.glyphManager=new ce(l._requestManager,f.localIdeographFontFamily,I),this.lineAtlas=new He(256,512),this.crossTileSymbolIndex=new Ns,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",s.bP()),pt().on(Le,this._rtlPluginLoaded),this.on("data",(k=>{if(k.dataType!=="source"||k.sourceDataType!=="metadata")return;const B=this.tileManagers[k.sourceId];if(!B)return;const W=B.getSource();if(W&&W.vectorLayerIds)for(const Z in this._layers){const J=this._layers[Z];J.source===W.id&&this._validateLayer(J)}}))}_setInitialValues(){var l;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new s.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((l=this.crossTileSymbolIndex)===null||l===void 0?void 0:l.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(l,f){var v,w,I;this._checkLoaded();const k=f===null?(I=(w=(v=this.stylesheet.state)===null||v===void 0?void 0:v[l])===null||w===void 0?void 0:w.default)!==null&&I!==void 0?I:null:f;if(s.bR(k,this._globalState[l]))return this;this._globalState[l]=k,this._applyGlobalStateChanges([l])}getGlobalState(){return this._globalState}setGlobalState(l){this._checkLoaded();const f=[];for(const v in l)!s.bR(this._globalState[v],l[v].default)&&(f.push(v),this._globalState[v]=l[v].default);this._applyGlobalStateChanges(f)}_applyGlobalStateChanges(l){if(l.length===0)return;const f=new Set,v={};for(const w of l){v[w]=this._globalState[w];for(const I in this._layers){const k=this._layers[I],B=k.getLayoutAffectingGlobalStateRefs(),W=k.getPaintAffectingGlobalStateRefs(),Z=k.getVisibilityAffectingGlobalStateRefs();if(B.has(w)&&f.add(k.source),W.has(w))for(const{name:J,value:he}of W.get(w))this._updatePaintProperty(k,J,he);Z?.has(w)&&(k.recalculateVisibility(),this._updateLayer(k))}}this.dispatcher.broadcast("UGS",v);for(const w in this.tileManagers)f.has(w)&&(this._reloadSource(w),this._changed=!0)}loadURL(l,f={},v){this.fire(new s.l("dataloading",{dataType:"style"})),f.validate=typeof f.validate!="boolean"||f.validate;const w=this.map._requestManager.transformRequest(l,"Style");this._loadStyleRequest=new AbortController;const I=this._loadStyleRequest;s.j(w,this._loadStyleRequest).then((k=>{this._loadStyleRequest=null,this._load(k.data,f,v)})).catch((k=>{this._loadStyleRequest=null,k&&!I.signal.aborted&&this.fire(new s.k(k))}))}loadJSON(l,f={},v){this.fire(new s.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,b.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,f.validate=f.validate!==!1,this._load(l,f,v)})).catch((()=>{}))}loadEmpty(){this.fire(new s.l("dataloading",{dataType:"style"})),this._load(Uo,{validate:!1})}_load(l,f,v){var w,I;let k=f.transformStyle?f.transformStyle(v,l):l;if(!f.validate||!Fc(this,s.C(k))){k=Object.assign({},k),this._loaded=!0,this.stylesheet=k;for(const B in k.sources)this.addSource(B,k.sources[B],{validate:!1});k.sprite?this._loadSprite(k.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(k.glyphs),this._createLayers(),this.light=new $e(this.stylesheet.light),this._setProjectionInternal(((w=this.stylesheet.projection)===null||w===void 0?void 0:w.type)||"mercator"),this.sky=new nt(this.stylesheet.sky),this.map.setTerrain((I=this.stylesheet.terrain)!==null&&I!==void 0?I:null),this.fire(new s.l("data",{dataType:"style"})),this.fire(new s.l("style.load"))}}_createLayers(){var l,f,v;const w=s.bS(this.stylesheet.layers);this.setGlobalState((l=this.stylesheet.state)!==null&&l!==void 0?l:null),this.dispatcher.broadcast("SL",w),this._order=w.map((I=>I.id)),this._layers={},this._serializedLayers=null;for(const I of w){const k=s.bT(I,this._globalState);if(k.setEventedParent(this,{layer:{id:I.id}}),this._layers[I.id]=k,s.bU(k)&&this.tileManagers[k.source]){const B=(v=(f=I.paint)===null||f===void 0?void 0:f["raster-fade-duration"])!==null&&v!==void 0?v:k.paint.get("raster-fade-duration");this.tileManagers[k.source].setRasterFadeDuration(B)}}}_loadSprite(l,f=!1,v=void 0){this.imageManager.setLoaded(!1);const w=new AbortController;let I;this._spriteRequest=w,(function(k,B,W,Z){return s._(this,void 0,void 0,(function*(){const J=V(k),he=W>1?"@2x":"",ue={},_e={};for(const{id:Ce,url:Fe}of J){const Ne=B.transformRequest(j(Fe,he,".json"),"SpriteJSON");ue[Ce]=s.j(Ne,Z);const ze=B.transformRequest(j(Fe,he,".png"),"SpriteImage");_e[Ce]=G.getImage(ze,Z)}return yield Promise.all([...Object.values(ue),...Object.values(_e)]),(function(Ce,Fe){return s._(this,void 0,void 0,(function*(){const Ne={};for(const ze in Ce){Ne[ze]={};const We=b.getImageCanvasContext((yield Fe[ze]).data),tt=(yield Ce[ze]).data;for(const je in tt){const{width:Qe,height:at,x:Ke,y:mt,sdf:Lt,pixelRatio:Et,stretchX:At,stretchY:Pt,content:Qt,textFitWidth:ti,textFitHeight:Xt}=tt[je];Ne[ze][je]={data:null,pixelRatio:Et,sdf:Lt,stretchX:At,stretchY:Pt,content:Qt,textFitWidth:ti,textFitHeight:Xt,spriteData:{width:Qe,height:at,x:Ke,y:mt,context:We}}}}return Ne}))})(ue,_e)}))})(l,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((k=>{if(this._spriteRequest=null,k)for(const B in k){this._spritesImagesIds[B]=[];const W=this._spritesImagesIds[B]?this._spritesImagesIds[B].filter((Z=>!(Z in k))):[];for(const Z of W)this.imageManager.removeImage(Z),this._changedImages[Z]=!0;for(const Z in k[B]){const J=B==="default"?Z:`${B}:${Z}`;this._spritesImagesIds[B].push(J),J in this.imageManager.images?this.imageManager.updateImage(J,k[B][Z],!1):this.imageManager.addImage(J,k[B][Z]),f&&(this._changedImages[J]=!0)}}})).catch((k=>{this._spriteRequest=null,I=k,w.signal.aborted||this.fire(new s.k(I))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),f&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"})),v&&v(I)}))}_unloadSprite(){for(const l of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(l),this._changedImages[l]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}_validateLayer(l){const f=this.tileManagers[l.source];if(!f)return;const v=l.sourceLayer;if(!v)return;const w=f.getSource();(w.type==="geojson"||w.vectorLayerIds&&w.vectorLayerIds.indexOf(v)===-1)&&this.fire(new s.k(new Error(`Source layer "${v}" does not exist on source "${w.id}" as specified by style layer "${l.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this.tileManagers)if(!this.tileManagers[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(l,f=!1){const v=this._serializedAllLayers();if(!l||l.length===0)return Object.values(f?s.bV(v):v);const w=[];for(const I of l)if(v[I]){const k=f?s.bV(v[I]):v[I];w.push(k)}return w}_serializedAllLayers(){let l=this._serializedLayers;if(l)return l;l=this._serializedLayers={};const f=Object.keys(this._layers);for(const v of f){const w=this._layers[v];w.type!=="custom"&&(l[v]=w.serialize())}return l}hasTransitions(){var l,f,v;if(!((l=this.light)===null||l===void 0)&&l.hasTransition()||!((f=this.sky)===null||f===void 0)&&f.hasTransition()||!((v=this.projection)===null||v===void 0)&&v.hasTransition())return!0;for(const w in this.tileManagers)if(this.tileManagers[w].hasTransition())return!0;for(const w in this._layers)if(this._layers[w].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(l){if(!this._loaded)return;const f=this._changed;if(f){const w=Object.keys(this._updatedLayers),I=Object.keys(this._removedLayers);(w.length||I.length)&&this._updateWorkerLayers(w,I);for(const k in this._updatedSources){const B=this._updatedSources[k];if(B==="reload")this._reloadSource(k);else{if(B!=="clear")throw new Error(`Invalid action ${B}`);this._clearSource(k)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const k in this._updatedPaintProps)this._layers[k].updateTransitions(l);this.light.updateTransitions(l),this.sky.updateTransitions(l),this._resetUpdates()}const v={};for(const w in this.tileManagers){const I=this.tileManagers[w];v[w]=I.used,I.used=!1}for(const w of this._order){const I=this._layers[w];I.recalculate(l,this._availableImages),!I.isHidden(l.zoom)&&I.source&&(this.tileManagers[I.source].used=!0)}for(const w in v){const I=this.tileManagers[w];!!v[w]!=!!I.used&&I.fire(new s.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:w}))}this.light.recalculate(l),this.sky.recalculate(l),this.projection.recalculate(l),this.z=l.zoom,f&&this.fire(new s.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const f in this.tileManagers)this.tileManagers[f].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const l in this.tileManagers)this.tileManagers[l].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(l,f){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(l,!1),removedIds:f})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(l,f={}){var v;this._checkLoaded();const w=this.serialize();if(l=f.transformStyle?f.transformStyle(w,l):l,((v=f.validate)===null||v===void 0||v)&&Fc(this,s.C(l)))return!1;(l=s.bV(l)).layers=s.bS(l.layers);const I=s.bW(w,l),k=this._getOperationsToPerform(I);if(k.unimplemented.length>0)throw new Error(`Unimplemented: ${k.unimplemented.join(", ")}.`);if(k.operations.length===0)return!1;for(const B of k.operations)B();return this.stylesheet=l,this._serializedLayers=null,!0}_getOperationsToPerform(l){const f=[],v=[];for(const w of l)switch(w.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":f.push((()=>this.addLayer.apply(this,w.args)));break;case"removeLayer":f.push((()=>this.removeLayer.apply(this,w.args)));break;case"setPaintProperty":f.push((()=>this.setPaintProperty.apply(this,w.args)));break;case"setLayoutProperty":f.push((()=>this.setLayoutProperty.apply(this,w.args)));break;case"setFilter":f.push((()=>this.setFilter.apply(this,w.args)));break;case"addSource":f.push((()=>this.addSource.apply(this,w.args)));break;case"removeSource":f.push((()=>this.removeSource.apply(this,w.args)));break;case"setLayerZoomRange":f.push((()=>this.setLayerZoomRange.apply(this,w.args)));break;case"setLight":f.push((()=>this.setLight.apply(this,w.args)));break;case"setGeoJSONSourceData":f.push((()=>this.setGeoJSONSourceData.apply(this,w.args)));break;case"setGlyphs":f.push((()=>this.setGlyphs.apply(this,w.args)));break;case"setSprite":f.push((()=>this.setSprite.apply(this,w.args)));break;case"setTerrain":f.push((()=>this.map.setTerrain.apply(this,w.args)));break;case"setSky":f.push((()=>this.setSky.apply(this,w.args)));break;case"setProjection":this.setProjection.apply(this,w.args);break;case"setGlobalState":f.push((()=>this.setGlobalState.apply(this,w.args)));break;case"setTransition":f.push((()=>{}));break;default:v.push(w.command)}return{operations:f,unimplemented:v}}addImage(l,f){if(this.getImage(l))return this.fire(new s.k(new Error(`An image named "${l}" already exists.`)));this.imageManager.addImage(l,f),this._afterImageUpdated(l)}updateImage(l,f){this.imageManager.updateImage(l,f)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){if(!this.getImage(l))return this.fire(new s.k(new Error(`An image named "${l}" does not exist.`)));this.imageManager.removeImage(l),this._afterImageUpdated(l)}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(l,f,v={}){if(this._checkLoaded(),this.tileManagers[l]!==void 0)throw new Error(`Source "${l}" already exists.`);if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(s.C.source,`sources.${l}`,f,null,v))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const w=this.tileManagers[l]=new Ii(l,f,this.dispatcher);w.style=this,w.setEventedParent(this,(()=>({isSourceLoaded:w.loaded(),source:w.serialize(),sourceId:l}))),w.onAdd(this.map),this._changed=!0}removeSource(l){if(this._checkLoaded(),this.tileManagers[l]===void 0)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===l)return this.fire(new s.k(new Error(`Source "${l}" cannot be removed while layer "${v}" is using it.`)));const f=this.tileManagers[l];delete this.tileManagers[l],delete this._updatedSources[l],f.fire(new s.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:l})),f.setEventedParent(null),f.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(l,f){if(this._checkLoaded(),this.tileManagers[l]===void 0)throw new Error(`There is no source with this ID=${l}`);const v=this.tileManagers[l].getSource();if(v.type!=="geojson")throw new Error(`geojsonSource.type is ${v.type}, which is !== 'geojson`);v.setData(f),this._changed=!0}getSource(l){return this.tileManagers[l]&&this.tileManagers[l].getSource()}addLayer(l,f,v={}){this._checkLoaded();const w=l.id;if(this.getLayer(w))return void this.fire(new s.k(new Error(`Layer "${w}" already exists on this map.`)));let I;if(l.type==="custom"){if(Fc(this,s.bX(l)))return;I=s.bT(l,this._globalState)}else{if("source"in l&&typeof l.source=="object"&&(this.addSource(w,l.source),l=s.bV(l),l=s.e(l,{source:w})),this._validate(s.C.layer,`layers.${w}`,l,{arrayIndex:-1},v))return;I=s.bT(l,this._globalState),this._validateLayer(I),I.setEventedParent(this,{layer:{id:w}})}const k=f?this._order.indexOf(f):this._order.length;if(f&&k===-1)this.fire(new s.k(new Error(`Cannot add layer "${w}" before non-existing layer "${f}".`)));else{if(this._order.splice(k,0,w),this._layerOrderChanged=!0,this._layers[w]=I,this._removedLayers[w]&&I.source&&I.type!=="custom"){const B=this._removedLayers[w];delete this._removedLayers[w],B.type!==I.type?this._updatedSources[I.source]="clear":(this._updatedSources[I.source]="reload",this.tileManagers[I.source].pause())}this._updateLayer(I),I.onAdd&&I.onAdd(this.map)}}moveLayer(l,f){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new s.k(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===f)return;const v=this._order.indexOf(l);this._order.splice(v,1);const w=f?this._order.indexOf(f):this._order.length;f&&w===-1?this.fire(new s.k(new Error(`Cannot move layer "${l}" before non-existing layer "${f}".`))):(this._order.splice(w,0,l),this._layerOrderChanged=!0)}removeLayer(l){this._checkLoaded();const f=this._layers[l];if(!f)return void this.fire(new s.k(new Error(`Cannot remove non-existing layer "${l}".`)));f.setEventedParent(null);const v=this._order.indexOf(l);this._order.splice(v,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=f,delete this._layers[l],this._serializedLayers&&delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],f.onRemove&&f.onRemove(this.map)}getLayer(l){return this._layers[l]}getLayersOrder(){return[...this._order]}hasLayer(l){return l in this._layers}setLayerZoomRange(l,f,v){this._checkLoaded();const w=this.getLayer(l);w?w.minzoom===f&&w.maxzoom===v||(f!=null&&(w.minzoom=f),v!=null&&(w.maxzoom=v),this._updateLayer(w)):this.fire(new s.k(new Error(`Cannot set the zoom range of non-existing layer "${l}".`)))}setFilter(l,f,v={}){this._checkLoaded();const w=this.getLayer(l);if(w){if(!s.bR(w.filter,f))return f==null?(w.setFilter(void 0),void this._updateLayer(w)):void(this._validate(s.C.filter,`layers.${w.id}.filter`,f,null,v)||(w.setFilter(s.bV(f)),this._updateLayer(w)))}else this.fire(new s.k(new Error(`Cannot filter non-existing layer "${l}".`)))}getFilter(l){return s.bV(this.getLayer(l).filter)}setLayoutProperty(l,f,v,w={}){this._checkLoaded();const I=this.getLayer(l);I?s.bR(I.getLayoutProperty(f),v)||(I.setLayoutProperty(f,v,w),this._updateLayer(I)):this.fire(new s.k(new Error(`Cannot style non-existing layer "${l}".`)))}getLayoutProperty(l,f){const v=this.getLayer(l);if(v)return v.getLayoutProperty(f);this.fire(new s.k(new Error(`Cannot get style of non-existing layer "${l}".`)))}setPaintProperty(l,f,v,w={}){this._checkLoaded();const I=this.getLayer(l);I?s.bR(I.getPaintProperty(f),v)||this._updatePaintProperty(I,f,v,w):this.fire(new s.k(new Error(`Cannot style non-existing layer "${l}".`)))}_updatePaintProperty(l,f,v,w={}){l.setPaintProperty(f,v,w)&&this._updateLayer(l),s.bU(l)&&f==="raster-fade-duration"&&this.tileManagers[l.source].setRasterFadeDuration(v),this._changed=!0,this._updatedPaintProps[l.id]=!0,this._serializedLayers=null}getPaintProperty(l,f){return this.getLayer(l).getPaintProperty(f)}setFeatureState(l,f){this._checkLoaded();const v=l.source,w=l.sourceLayer,I=this.tileManagers[v];if(I===void 0)return void this.fire(new s.k(new Error(`The source '${v}' does not exist in the map's style.`)));const k=I.getSource().type;k==="geojson"&&w?this.fire(new s.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):k!=="vector"||w?(l.id===void 0&&this.fire(new s.k(new Error("The feature id parameter must be provided."))),I.setFeatureState(w,l.id,f)):this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(l,f){this._checkLoaded();const v=l.source,w=this.tileManagers[v];if(w===void 0)return void this.fire(new s.k(new Error(`The source '${v}' does not exist in the map's style.`)));const I=w.getSource().type,k=I==="vector"?l.sourceLayer:void 0;I!=="vector"||k?f&&typeof l.id!="string"&&typeof l.id!="number"?this.fire(new s.k(new Error("A feature id is required to remove its specific state property."))):w.removeFeatureState(k,l.id,f):this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(l){this._checkLoaded();const f=l.source,v=l.sourceLayer,w=this.tileManagers[f];if(w!==void 0)return w.getSource().type!=="vector"||v?(l.id===void 0&&this.fire(new s.k(new Error("The feature id parameter must be provided."))),w.getFeatureState(v,l.id)):void this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.k(new Error(`The source '${f}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const l=s.bY(this.tileManagers,(I=>I.serialize())),f=this._serializeByIds(this._order,!0),v=this.map.getTerrain()||void 0,w=this.stylesheet;return s.bZ({version:w.version,name:w.name,metadata:w.metadata,light:w.light,sky:w.sky,center:w.center,zoom:w.zoom,bearing:w.bearing,pitch:w.pitch,sprite:w.sprite,glyphs:w.glyphs,transition:w.transition,projection:w.projection,sources:l,layers:f,terrain:v},(I=>I!==void 0))}_updateLayer(l){this._updatedLayers[l.id]=!0,l.source&&!this._updatedSources[l.source]&&this.tileManagers[l.source].getSource().type!=="raster"&&(this._updatedSources[l.source]="reload",this.tileManagers[l.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(l){const f=k=>this._layers[k].type==="fill-extrusion",v={},w=[];for(let k=this._order.length-1;k>=0;k--){const B=this._order[k];if(f(B)){v[B]=k;for(const W of l){const Z=W[B];if(Z)for(const J of Z)w.push(J)}}}w.sort(((k,B)=>B.intersectionZ-k.intersectionZ));const I=[];for(let k=this._order.length-1;k>=0;k--){const B=this._order[k];if(f(B))for(let W=w.length-1;W>=0;W--){const Z=w[W].feature;if(v[Z.layer.id]<k)break;I.push(Z),w.pop()}else for(const W of l){const Z=W[B];if(Z)for(const J of Z)I.push(J.feature)}}return I}queryRenderedFeatures(l,f,v){f&&f.filter&&this._validate(s.C.filter,"queryRenderedFeatures.filter",f.filter,null,f);const w={};if(f&&f.layers){if(!(Array.isArray(f.layers)||f.layers instanceof Set))return this.fire(new s.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const Z of f.layers){const J=this._layers[Z];if(!J)return this.fire(new s.k(new Error(`The layer '${Z}' does not exist in the map's style and cannot be queried for features.`))),[];w[J.source]=!0}}const I=[];f.availableImages=this._availableImages;const k=this._serializedAllLayers(),B=f.layers instanceof Set?f.layers:Array.isArray(f.layers)?new Set(f.layers):null,W=Object.assign(Object.assign({},f),{layers:B,globalState:this._globalState});for(const Z in this.tileManagers)f.layers&&!w[Z]||I.push(qe(this.tileManagers[Z],this._layers,k,l,W,v,this.map.terrain?(J,he,ue)=>this.map.terrain.getElevation(J,he,ue):void 0));return this.placement&&I.push((function(Z,J,he,ue,_e,Ce,Fe){const Ne={},ze=Ce.queryRenderedSymbols(ue),We=[];for(const tt of Object.keys(ze).map(Number))We.push(Fe[tt]);We.sort(st);for(const tt of We){const je=tt.featureIndex.lookupSymbolFeatures(ze[tt.bucketInstanceId],J,tt.bucketIndex,tt.sourceLayerIndex,{filterSpec:_e.filter,globalState:_e.globalState},_e.layers,_e.availableImages,Z);for(const Qe in je){const at=Ne[Qe]=Ne[Qe]||[],Ke=je[Qe];Ke.sort(((mt,Lt)=>{const Et=tt.featureSortOrder;if(Et){const At=Et.indexOf(mt.featureIndex);return Et.indexOf(Lt.featureIndex)-At}return Lt.featureIndex-mt.featureIndex}));for(const mt of Ke)at.push(mt)}}return(function(tt,je,Qe){for(const at in tt)for(const Ke of tt[at])Rt(Ke,Qe[je[at].source]);return tt})(Ne,Z,he)})(this._layers,k,this.tileManagers,l,W,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(I)}querySourceFeatures(l,f){f?.filter&&this._validate(s.C.filter,"querySourceFeatures.filter",f.filter,null,f);const v=this.tileManagers[l];return v?(function(w,I){const k=w.getRenderableIds().map((Z=>w.getTileByID(Z))),B=[],W={};for(let Z=0;Z<k.length;Z++){const J=k[Z],he=J.tileID.canonical.key;W[he]||(W[he]=!0,J.querySourceFeatures(B,I))}return B})(v,f?Object.assign(Object.assign({},f),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(l,f={}){this._checkLoaded();const v=this.light.getLight();let w=!1;for(const k in l)if(!s.bR(l[k],v[k])){w=!0;break}if(!w)return;const I={now:P(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(l,f),this.light.updateTransitions(I)}getProjection(){var l;return(l=this.stylesheet)===null||l===void 0?void 0:l.projection}setProjection(l){if(this._checkLoaded(),this.projection){if(this.projection.name===l.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=l,this._setProjectionInternal(l.type)}getSky(){var l;return(l=this.stylesheet)===null||l===void 0?void 0:l.sky}setSky(l,f={}){this._checkLoaded();const v=this.getSky();let w=!1;if(!l&&!v)return;if(l&&!v)w=!0;else if(!l&&v)w=!0;else for(const k in l)if(!s.bR(l[k],v[k])){w=!0;break}if(!w)return;const I={now:P(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=l,this.sky.setSky(l,f),this.sky.updateTransitions(I)}_setProjectionInternal(l){const f=(function(v,w){const I={constrainOverride:w};if(Array.isArray(v)){const k=new Op({type:v});return{projection:k,transform:new vl(I),cameraHelper:new Np(k)}}switch(v){case"mercator":return{projection:new $s,transform:new Yl(I),cameraHelper:new gl};case"globe":{const k=new Op({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:k,transform:new vl(I),cameraHelper:new Np(k)}}case"vertical-perspective":return{projection:new Qd,transform:new _l(I),cameraHelper:new qr};default:return s.w(`Unknown projection name: ${v}. Falling back to mercator projection.`),{projection:new $s,transform:new Yl(I),cameraHelper:new gl}}})(l,this.map.transformConstrain);this.projection=f.projection,this.map.migrateProjection(f.transform,f.cameraHelper);for(const v in this.tileManagers)this.tileManagers[v].reload()}_validate(l,f,v,w,I={}){return(!I||I.validate!==!1)&&Fc(this,l.call(s.C,s.e({key:f,style:this.serialize(),value:v,styleSpec:s.u},w)))}_remove(l=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),pt().off(Le,this._rtlPluginLoaded);for(const f in this._layers)this._layers[f].setEventedParent(null);for(const f in this.tileManagers){const v=this.tileManagers[f];v.setEventedParent(null),v.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),l&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(l)}_clearSource(l){this.tileManagers[l].clearTiles()}_reloadSource(l){this.tileManagers[l].resume(),this.tileManagers[l].reload()}_updateSources(l){for(const f in this.tileManagers)this.tileManagers[f].update(l,this.map.terrain)}_generateCollisionBoxes(){for(const l in this.tileManagers)this._reloadSource(l)}_updatePlacement(l,f,v,w,I=!1){let k=!1,B=!1;const W={};for(const Z of this._order){const J=this._layers[Z];if(J.type!=="symbol")continue;if(!W[J.source]){const ue=this.tileManagers[J.source];W[J.source]=ue.getRenderableIds(!0).map((_e=>ue.getTileByID(_e))).sort(((_e,Ce)=>Ce.tileID.overscaledZ-_e.tileID.overscaledZ||(_e.tileID.isLessThan(Ce.tileID)?-1:1)))}const he=this.crossTileSymbolIndex.addLayer(J,W[J.source],l.center.lng);k=k||he}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((I=I||this._layerOrderChanged||v===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(P(),l.zoom))&&(this.pauseablePlacement=new Lc(l,this.map.terrain,this._order,I,f,v,w,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,W),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(P()),B=!0),k&&this.pauseablePlacement.placement.setStale()),B||k)for(const Z of this._order){const J=this._layers[Z];J.type==="symbol"&&this.placement.updateLayerOpacities(J,W[J.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(P())}_releaseSymbolFadeTiles(){for(const l in this.tileManagers)this.tileManagers[l].releaseSymbolFadeTiles()}getImages(l,f){return s._(this,void 0,void 0,(function*(){const v=yield this.imageManager.getImages(f.icons);this._updateTilesForChangedImages();const w=this.tileManagers[f.source];return w&&w.setDependencies(f.tileID.key,f.type,f.icons),v}))}getGlyphs(l,f){return s._(this,void 0,void 0,(function*(){const v=yield this.glyphManager.getGlyphs(f.stacks),w=this.tileManagers[f.source];return w&&w.setDependencies(f.tileID.key,f.type,[""]),v}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(l,f={}){this._checkLoaded(),l&&this._validate(s.C.glyphs,"glyphs",l,null,f)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=l,this.glyphManager.entries={},this.glyphManager.setURL(l))}getDashes(l,f){return s._(this,void 0,void 0,(function*(){const v={};for(const[w,I]of Object.entries(f.dashes))v[w]=this.lineAtlas.getDash(I.dasharray,I.round);return v}))}addSprite(l,f,v={},w){this._checkLoaded();const I=[{id:l,url:f}],k=[...V(this.stylesheet.sprite),...I];this._validate(s.C.sprite,"sprite",k,null,v)||(this.stylesheet.sprite=k,this._loadSprite(I,!0,w))}removeSprite(l){this._checkLoaded();const f=V(this.stylesheet.sprite);if(f.find((v=>v.id===l))){if(this._spritesImagesIds[l])for(const v of this._spritesImagesIds[l])this.imageManager.removeImage(v),this._changedImages[v]=!0;f.splice(f.findIndex((v=>v.id===l)),1),this.stylesheet.sprite=f.length>0?f:void 0,delete this._spritesImagesIds[l],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}else this.fire(new s.k(new Error(`Sprite "${l}" doesn't exists on this map.`)))}getSprite(){return V(this.stylesheet.sprite)}setSprite(l,f={},v){this._checkLoaded(),l&&this._validate(s.C.sprite,"sprite",l,null,f)||(this.stylesheet.sprite=l,l?this._loadSprite(l,!0,v):(this._unloadSprite(),v&&v(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const l in this.tileManagers){const f=this.tileManagers[l];f.setEventedParent(null),f.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const l in this._layers){const f=this._layers[l];f.setEventedParent(null),f.onRemove&&f.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var b_=s.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Uh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(l,f,v,w,I,k,B,W,Z){this.context=l;let J=this.boundPaintVertexBuffers.length!==w.length;for(let he=0;!J&&he<w.length;he++)this.boundPaintVertexBuffers[he]!==w[he]&&(J=!0);!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==v||J||this.boundIndexBuffer!==I||this.boundVertexOffset!==k||this.boundDynamicVertexBuffer!==B||this.boundDynamicVertexBuffer2!==W||this.boundDynamicVertexBuffer3!==Z?this.freshBind(f,v,w,I,k,B,W,Z):(l.bindVertexArray.set(this.vao),B&&B.bind(),I&&I.dynamicDraw&&I.bind(),W&&W.bind(),Z&&Z.bind())}freshBind(l,f,v,w,I,k,B,W){const Z=l.numAttributes,J=this.context,he=J.gl;this.vao&&this.destroy(),this.vao=J.createVertexArray(),J.bindVertexArray.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=v,this.boundIndexBuffer=w,this.boundVertexOffset=I,this.boundDynamicVertexBuffer=k,this.boundDynamicVertexBuffer2=B,this.boundDynamicVertexBuffer3=W,f.enableAttributes(he,l);for(const ue of v)ue.enableAttributes(he,l);k&&k.enableAttributes(he,l),B&&B.enableAttributes(he,l),W&&W.enableAttributes(he,l),f.bind(),f.setVertexAttribPointers(he,l,I);for(const ue of v)ue.bind(),ue.setVertexAttribPointers(he,l,I);k&&(k.bind(),k.setVertexAttribPointers(he,l,I)),w&&w.bind(),B&&(B.bind(),B.setVertexAttribPointers(he,l,I)),W&&(W.bind(),W.setVertexAttribPointers(he,l,I)),J.currentNumAttributes=Z}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const x_=(A,l,f,v,w)=>({u_texture:0,u_ele_delta:A,u_fog_matrix:l,u_fog_color:f?f.properties.get("fog-color"):s.bp.white,u_fog_ground_blend:f?f.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:w?0:f?f.calculateFogBlendOpacity(v):0,u_horizon_color:f?f.properties.get("horizon-color"):s.bp.white,u_horizon_fog_blend:f?f.properties.get("horizon-fog-blend"):1,u_is_globe_mode:w?1:0}),Aa={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Oc(A){const l=[];for(let f=0;f<A.length;f++){if(A[f]===null)continue;const v=A[f].split(" ");l.push(v.pop())}return l}class $p{constructor(l,f,v,w,I,k,B,W,Z=[]){const J=l.gl;this.program=J.createProgram();const he=Oc(f.staticAttributes),ue=v?v.getBinderAttributes():[],_e=he.concat(ue),Ce=xn.prelude.staticUniforms?Oc(xn.prelude.staticUniforms):[],Fe=B.staticUniforms?Oc(B.staticUniforms):[],Ne=f.staticUniforms?Oc(f.staticUniforms):[],ze=v?v.getBinderUniforms():[],We=Ce.concat(Fe).concat(Ne).concat(ze),tt=[];for(const Et of We)tt.indexOf(Et)<0&&tt.push(Et);const je=v?v.defines():[];wo(J)&&je.unshift("#version 300 es"),I&&je.push("#define OVERDRAW_INSPECTOR;"),k&&je.push("#define TERRAIN3D;"),W&&je.push(W),Z&&je.push(...Z);let Qe=je.concat(xn.prelude.fragmentSource,B.fragmentSource,f.fragmentSource).join(`
`),at=je.concat(xn.prelude.vertexSource,B.vertexSource,f.vertexSource).join(`
`);wo(J)||(Qe=(function(Et){return Et.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(Qe),at=(function(Et){return Et.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(at));const Ke=J.createShader(J.FRAGMENT_SHADER);if(J.isContextLost())return void(this.failedToCreate=!0);if(J.shaderSource(Ke,Qe),J.compileShader(Ke),!J.getShaderParameter(Ke,J.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${J.getShaderInfoLog(Ke)}`);J.attachShader(this.program,Ke);const mt=J.createShader(J.VERTEX_SHADER);if(J.isContextLost())return void(this.failedToCreate=!0);if(J.shaderSource(mt,at),J.compileShader(mt),!J.getShaderParameter(mt,J.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${J.getShaderInfoLog(mt)}`);J.attachShader(this.program,mt),this.attributes={};const Lt={};this.numAttributes=_e.length;for(let Et=0;Et<this.numAttributes;Et++)_e[Et]&&(J.bindAttribLocation(this.program,Et,_e[Et]),this.attributes[_e[Et]]=Et);if(J.linkProgram(this.program),!J.getProgramParameter(this.program,J.LINK_STATUS))throw new Error(`Program failed to link: ${J.getProgramInfoLog(this.program)}`);J.deleteShader(mt),J.deleteShader(Ke);for(let Et=0;Et<tt.length;Et++){const At=tt[Et];if(At&&!Lt[At]){const Pt=J.getUniformLocation(this.program,At);Pt&&(Lt[At]=Pt)}}this.fixedUniforms=w(l,Lt),this.terrainUniforms=((Et,At)=>({u_depth:new s.b_(Et,At.u_depth),u_terrain:new s.b_(Et,At.u_terrain),u_terrain_dim:new s.bq(Et,At.u_terrain_dim),u_terrain_matrix:new s.c0(Et,At.u_terrain_matrix),u_terrain_unpack:new s.c1(Et,At.u_terrain_unpack),u_terrain_exaggeration:new s.bq(Et,At.u_terrain_exaggeration)}))(l,Lt),this.projectionUniforms=((Et,At)=>({u_projection_matrix:new s.c0(Et,At.u_projection_matrix),u_projection_tile_mercator_coords:new s.c1(Et,At.u_projection_tile_mercator_coords),u_projection_clipping_plane:new s.c1(Et,At.u_projection_clipping_plane),u_projection_transition:new s.bq(Et,At.u_projection_transition),u_projection_fallback_matrix:new s.c0(Et,At.u_projection_fallback_matrix)}))(l,Lt),this.binderUniforms=v?v.getUniforms(l,Lt):[]}draw(l,f,v,w,I,k,B,W,Z,J,he,ue,_e,Ce,Fe,Ne,ze,We,tt){const je=l.gl;if(this.failedToCreate)return;if(l.program.set(this.program),l.setDepthMode(v),l.setStencilMode(w),l.setColorMode(I),l.setCullFace(k),W){l.activeTexture.set(je.TEXTURE2),je.bindTexture(je.TEXTURE_2D,W.depthTexture),l.activeTexture.set(je.TEXTURE3),je.bindTexture(je.TEXTURE_2D,W.texture);for(const at in this.terrainUniforms)this.terrainUniforms[at].set(W[at])}if(Z)for(const at in Z)this.projectionUniforms[Aa[at]].set(Z[at]);if(B)for(const at in this.fixedUniforms)this.fixedUniforms[at].set(B[at]);Ne&&Ne.setUniforms(l,this.binderUniforms,Ce,{zoom:Fe});let Qe=0;switch(f){case je.LINES:Qe=2;break;case je.TRIANGLES:Qe=3;break;case je.LINE_STRIP:Qe=1}for(const at of _e.get()){const Ke=at.vaos||(at.vaos={});(Ke[J]||(Ke[J]=new Uh)).bind(l,this,he,Ne?Ne.getPaintVertexBuffers():[],ue,at.vertexOffset,ze,We,tt),je.drawElements(f,at.primitiveLength*Qe,je.UNSIGNED_SHORT,at.primitiveOffset*Qe*2)}}}function rf(A,l,f){const v=1/s.aN(f,1,l.transform.tileZoom),w=Math.pow(2,f.tileID.overscaledZ),I=f.tileSize*Math.pow(2,l.transform.tileZoom)/w,k=I*(f.tileID.canonical.x+f.tileID.wrap*w),B=I*f.tileID.canonical.y;return{u_image:0,u_texsize:f.imageAtlasTexture.size,u_scale:[v,A.fromScale,A.toScale],u_fade:A.t,u_pixel_coord_upper:[k>>16,B>>16],u_pixel_coord_lower:[65535&k,65535&B]}}const sf=(A,l,f,v)=>{const w=A.style.light,I=w.properties.get("position"),k=[I.x,I.y,I.z],B=s.c4();w.properties.get("anchor")==="viewport"&&s.c5(B,A.transform.bearingInRadians),s.c6(k,k,B);const W=A.transform.transformLightDirection(k),Z=w.properties.get("color");return{u_lightpos:k,u_lightpos_globe:W,u_lightintensity:w.properties.get("intensity"),u_lightcolor:[Z.r,Z.g,Z.b],u_vertical_gradient:+l,u_opacity:f,u_fill_translate:v}},yl=(A,l,f,v,w,I,k)=>s.e(sf(A,l,f,v),rf(I,A,k),{u_height_factor:-Math.pow(2,w.overscaledZ)/k.tileSize/8}),Ru=(A,l,f,v)=>s.e(rf(l,A,f),{u_fill_translate:v}),of=(A,l)=>({u_world:A,u_fill_translate:l}),Vp=(A,l,f,v,w)=>s.e(Ru(A,l,f,w),{u_world:v}),Up=(A,l,f,v,w)=>{const I=A.transform;let k,B,W=0;if(f.paint.get("circle-pitch-alignment")==="map"){const Z=s.aN(l,1,I.zoom);k=!0,B=[Z,Z],W=Z/(s.a5*Math.pow(2,l.tileID.overscaledZ))*2*Math.PI*w}else k=!1,B=I.pixelsToGLUnits;return{u_camera_to_center_distance:I.cameraToCenterDistance,u_scale_with_map:+(f.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+k,u_device_pixel_ratio:A.pixelRatio,u_extrude_scale:B,u_globe_extrude_scale:W,u_translate:v}},nc=A=>({u_pixel_extrude_scale:[1/A.width,1/A.height]}),zc=A=>({u_viewport_size:[A.width,A.height]}),Pa=(A,l=1)=>({u_color:A,u_overlay:0,u_overlay_scale:l}),Bc=(A,l,f,v)=>{const w=s.aN(A,1,l)/(s.a5*Math.pow(2,A.tileID.overscaledZ))*2*Math.PI*v;return{u_extrude_scale:s.aN(A,1,l),u_intensity:f,u_globe_extrude_scale:w}},jp=(A,l,f,v)=>{const w=s.N();s.c7(w,0,A.width,A.height,0,0,1);const I=A.context.gl;return{u_matrix:w,u_world:[I.drawingBufferWidth,I.drawingBufferHeight],u_image:f,u_color_ramp:v,u_opacity:l.paint.get("heatmap-opacity")}},jh=(A,l,f)=>{const v=f.paint.get("hillshade-accent-color");let w;switch(f.paint.get("hillshade-method")){case"basic":w=4;break;case"combined":w=1;break;case"igor":w=2;break;case"multidirectional":w=3;break;default:w=0}const I=f.getIlluminationProperties();for(let k=0;k<I.directionRadians.length;k++)f.paint.get("hillshade-illumination-anchor")==="viewport"&&(I.directionRadians[k]+=A.transform.bearingInRadians);return{u_image:0,u_latrange:S_(0,l.tileID),u_exaggeration:f.paint.get("hillshade-exaggeration"),u_altitudes:I.altitudeRadians,u_azimuths:I.directionRadians,u_accent:v,u_method:w,u_highlights:I.highlightColor,u_shadows:I.shadowColor}},w_=(A,l)=>{const f=l.stride,v=s.N();return s.c7(v,0,s.a5,-s.a5,0,0,1),s.O(v,v,[0,-s.a5,0]),{u_matrix:v,u_image:1,u_dimension:[f,f],u_zoom:A.overscaledZ,u_unpack:l.getUnpackVector()}};function S_(A,l){const f=Math.pow(2,l.canonical.z),v=l.canonical.y;return[new s.a9(0,v/f).toLngLat().lat,new s.a9(0,(v+1)/f).toLngLat().lat]}const Gp=(A,l,f=0)=>({u_image:0,u_unpack:l.getUnpackVector(),u_dimension:[l.stride,l.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:f,u_opacity:A.paint.get("color-relief-opacity")}),Lu=(A,l,f,v)=>{const w=A.transform;return{u_translation:Du(A,l,f),u_ratio:v/s.aN(l,1,w.zoom),u_device_pixel_ratio:A.pixelRatio,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]]}},qp=(A,l,f,v,w)=>s.e(Lu(A,l,f,v),{u_image:0,u_image_height:w}),Gh=(A,l,f,v,w)=>{const I=A.transform,k=ao(l,I);return{u_translation:Du(A,l,f),u_texsize:l.imageAtlasTexture.size,u_ratio:v/s.aN(l,1,I.zoom),u_device_pixel_ratio:A.pixelRatio,u_image:0,u_scale:[k,w.fromScale,w.toScale],u_fade:w.t,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]]}},Wp=(A,l,f,v,w)=>{const I=ao(l,A.transform);return s.e(Lu(A,l,f,v),{u_tileratio:I,u_crossfade_from:w.fromScale,u_crossfade_to:w.toScale,u_image:0,u_mix:w.t,u_lineatlas_width:A.lineAtlas.width,u_lineatlas_height:A.lineAtlas.height})},ku=(A,l,f,v,w,I)=>{const k=ao(l,A.transform);return s.e(Lu(A,l,f,v),{u_image:0,u_image_height:I,u_tileratio:k,u_crossfade_from:w.fromScale,u_crossfade_to:w.toScale,u_image_dash:1,u_mix:w.t,u_lineatlas_width:A.lineAtlas.width,u_lineatlas_height:A.lineAtlas.height})};function ao(A,l){return 1/s.aN(A,1,l.tileZoom)}function Du(A,l,f){return s.aO(A.transform,l,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}const Ia=(A,l,f,v,w)=>{return{u_tl_parent:A,u_scale_parent:l,u_buffer_scale:1,u_fade_t:f.mix,u_opacity:f.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(k=v.paint.get("raster-saturation"),k>0?1-1/(1.001-k):-k),u_contrast_factor:(I=v.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:qh(v.paint.get("raster-hue-rotate")),u_coords_top:[w[0].x,w[0].y,w[1].x,w[1].y],u_coords_bottom:[w[3].x,w[3].y,w[2].x,w[2].y]};var I,k};function qh(A){A*=Math.PI/180;const l=Math.sin(A),f=Math.cos(A);return[(2*f+1)/3,(-Math.sqrt(3)*l-f+1)/3,(Math.sqrt(3)*l-f+1)/3]}const Fu=(A,l,f,v,w,I,k,B,W,Z,J,he,ue)=>{const _e=k.transform;return{u_is_size_zoom_constant:+(A==="constant"||A==="source"),u_is_size_feature_constant:+(A==="constant"||A==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:_e.cameraToCenterDistance,u_pitch:_e.pitch/360*2*Math.PI,u_rotate_symbol:+f,u_aspect_ratio:_e.width/_e.height,u_fade_change:k.options.fadeDuration?k.symbolFadeChange:1,u_label_plane_matrix:B,u_coord_matrix:W,u_is_text:+J,u_pitch_with_map:+v,u_is_along_line:w,u_is_variable_anchor:I,u_texsize:he,u_texture:0,u_translation:Z,u_pitched_scale:ue}},Ou=(A,l,f,v,w,I,k,B,W,Z,J,he,ue,_e)=>{const Ce=k.transform;return s.e(Fu(A,l,f,v,w,I,k,B,W,Z,J,he,_e),{u_gamma_scale:v?Math.cos(Ce.pitch*Math.PI/180)*Ce.cameraToCenterDistance:1,u_device_pixel_ratio:k.pixelRatio,u_is_halo:1})},Ra=(A,l,f,v,w,I,k,B,W,Z,J,he,ue)=>s.e(Ou(A,l,f,v,w,I,k,B,W,Z,!0,J,0,ue),{u_texsize_icon:he,u_texture_icon:1}),Wh=(A,l)=>({u_opacity:A,u_color:l}),af=(A,l,f,v,w)=>s.e((function(I,k,B,W){const Z=B.imageManager.getPattern(I.from.toString()),J=B.imageManager.getPattern(I.to.toString()),{width:he,height:ue}=B.imageManager.getPixelSize(),_e=Math.pow(2,W.tileID.overscaledZ),Ce=W.tileSize*Math.pow(2,B.transform.tileZoom)/_e,Fe=Ce*(W.tileID.canonical.x+W.tileID.wrap*_e),Ne=Ce*W.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Z.tl,u_pattern_br_a:Z.br,u_pattern_tl_b:J.tl,u_pattern_br_b:J.br,u_texsize:[he,ue],u_mix:k.t,u_pattern_size_a:Z.displaySize,u_pattern_size_b:J.displaySize,u_scale_a:k.fromScale,u_scale_b:k.toScale,u_tile_units_to_pixels:1/s.aN(W,1,B.transform.tileZoom),u_pixel_coord_upper:[Fe>>16,Ne>>16],u_pixel_coord_lower:[65535&Fe,65535&Ne]}})(f,w,l,v),{u_opacity:A}),Hp=(A,l)=>{},rc={fillExtrusion:(A,l)=>({u_lightpos:new s.c2(A,l.u_lightpos),u_lightpos_globe:new s.c2(A,l.u_lightpos_globe),u_lightintensity:new s.bq(A,l.u_lightintensity),u_lightcolor:new s.c2(A,l.u_lightcolor),u_vertical_gradient:new s.bq(A,l.u_vertical_gradient),u_opacity:new s.bq(A,l.u_opacity),u_fill_translate:new s.c3(A,l.u_fill_translate)}),fillExtrusionPattern:(A,l)=>({u_lightpos:new s.c2(A,l.u_lightpos),u_lightpos_globe:new s.c2(A,l.u_lightpos_globe),u_lightintensity:new s.bq(A,l.u_lightintensity),u_lightcolor:new s.c2(A,l.u_lightcolor),u_vertical_gradient:new s.bq(A,l.u_vertical_gradient),u_height_factor:new s.bq(A,l.u_height_factor),u_opacity:new s.bq(A,l.u_opacity),u_fill_translate:new s.c3(A,l.u_fill_translate),u_image:new s.b_(A,l.u_image),u_texsize:new s.c3(A,l.u_texsize),u_pixel_coord_upper:new s.c3(A,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.c3(A,l.u_pixel_coord_lower),u_scale:new s.c2(A,l.u_scale),u_fade:new s.bq(A,l.u_fade)}),fill:(A,l)=>({u_fill_translate:new s.c3(A,l.u_fill_translate)}),fillPattern:(A,l)=>({u_image:new s.b_(A,l.u_image),u_texsize:new s.c3(A,l.u_texsize),u_pixel_coord_upper:new s.c3(A,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.c3(A,l.u_pixel_coord_lower),u_scale:new s.c2(A,l.u_scale),u_fade:new s.bq(A,l.u_fade),u_fill_translate:new s.c3(A,l.u_fill_translate)}),fillOutline:(A,l)=>({u_world:new s.c3(A,l.u_world),u_fill_translate:new s.c3(A,l.u_fill_translate)}),fillOutlinePattern:(A,l)=>({u_world:new s.c3(A,l.u_world),u_image:new s.b_(A,l.u_image),u_texsize:new s.c3(A,l.u_texsize),u_pixel_coord_upper:new s.c3(A,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.c3(A,l.u_pixel_coord_lower),u_scale:new s.c2(A,l.u_scale),u_fade:new s.bq(A,l.u_fade),u_fill_translate:new s.c3(A,l.u_fill_translate)}),circle:(A,l)=>({u_camera_to_center_distance:new s.bq(A,l.u_camera_to_center_distance),u_scale_with_map:new s.b_(A,l.u_scale_with_map),u_pitch_with_map:new s.b_(A,l.u_pitch_with_map),u_extrude_scale:new s.c3(A,l.u_extrude_scale),u_device_pixel_ratio:new s.bq(A,l.u_device_pixel_ratio),u_globe_extrude_scale:new s.bq(A,l.u_globe_extrude_scale),u_translate:new s.c3(A,l.u_translate)}),collisionBox:(A,l)=>({u_pixel_extrude_scale:new s.c3(A,l.u_pixel_extrude_scale)}),collisionCircle:(A,l)=>({u_viewport_size:new s.c3(A,l.u_viewport_size)}),debug:(A,l)=>({u_color:new s.b$(A,l.u_color),u_overlay:new s.b_(A,l.u_overlay),u_overlay_scale:new s.bq(A,l.u_overlay_scale)}),depth:Hp,clippingMask:Hp,heatmap:(A,l)=>({u_extrude_scale:new s.bq(A,l.u_extrude_scale),u_intensity:new s.bq(A,l.u_intensity),u_globe_extrude_scale:new s.bq(A,l.u_globe_extrude_scale)}),heatmapTexture:(A,l)=>({u_matrix:new s.c0(A,l.u_matrix),u_world:new s.c3(A,l.u_world),u_image:new s.b_(A,l.u_image),u_color_ramp:new s.b_(A,l.u_color_ramp),u_opacity:new s.bq(A,l.u_opacity)}),hillshade:(A,l)=>({u_image:new s.b_(A,l.u_image),u_latrange:new s.c3(A,l.u_latrange),u_exaggeration:new s.bq(A,l.u_exaggeration),u_altitudes:new s.c9(A,l.u_altitudes),u_azimuths:new s.c9(A,l.u_azimuths),u_accent:new s.b$(A,l.u_accent),u_method:new s.b_(A,l.u_method),u_shadows:new s.c8(A,l.u_shadows),u_highlights:new s.c8(A,l.u_highlights)}),hillshadePrepare:(A,l)=>({u_matrix:new s.c0(A,l.u_matrix),u_image:new s.b_(A,l.u_image),u_dimension:new s.c3(A,l.u_dimension),u_zoom:new s.bq(A,l.u_zoom),u_unpack:new s.c1(A,l.u_unpack)}),colorRelief:(A,l)=>({u_image:new s.b_(A,l.u_image),u_unpack:new s.c1(A,l.u_unpack),u_dimension:new s.c3(A,l.u_dimension),u_elevation_stops:new s.b_(A,l.u_elevation_stops),u_color_stops:new s.b_(A,l.u_color_stops),u_color_ramp_size:new s.b_(A,l.u_color_ramp_size),u_opacity:new s.bq(A,l.u_opacity)}),line:(A,l)=>({u_translation:new s.c3(A,l.u_translation),u_ratio:new s.bq(A,l.u_ratio),u_device_pixel_ratio:new s.bq(A,l.u_device_pixel_ratio),u_units_to_pixels:new s.c3(A,l.u_units_to_pixels)}),lineGradient:(A,l)=>({u_translation:new s.c3(A,l.u_translation),u_ratio:new s.bq(A,l.u_ratio),u_device_pixel_ratio:new s.bq(A,l.u_device_pixel_ratio),u_units_to_pixels:new s.c3(A,l.u_units_to_pixels),u_image:new s.b_(A,l.u_image),u_image_height:new s.bq(A,l.u_image_height)}),linePattern:(A,l)=>({u_translation:new s.c3(A,l.u_translation),u_texsize:new s.c3(A,l.u_texsize),u_ratio:new s.bq(A,l.u_ratio),u_device_pixel_ratio:new s.bq(A,l.u_device_pixel_ratio),u_image:new s.b_(A,l.u_image),u_units_to_pixels:new s.c3(A,l.u_units_to_pixels),u_scale:new s.c2(A,l.u_scale),u_fade:new s.bq(A,l.u_fade)}),lineSDF:(A,l)=>({u_translation:new s.c3(A,l.u_translation),u_ratio:new s.bq(A,l.u_ratio),u_device_pixel_ratio:new s.bq(A,l.u_device_pixel_ratio),u_units_to_pixels:new s.c3(A,l.u_units_to_pixels),u_image:new s.b_(A,l.u_image),u_mix:new s.bq(A,l.u_mix),u_tileratio:new s.bq(A,l.u_tileratio),u_crossfade_from:new s.bq(A,l.u_crossfade_from),u_crossfade_to:new s.bq(A,l.u_crossfade_to),u_lineatlas_width:new s.bq(A,l.u_lineatlas_width),u_lineatlas_height:new s.bq(A,l.u_lineatlas_height)}),lineGradientSDF:(A,l)=>({u_translation:new s.c3(A,l.u_translation),u_ratio:new s.bq(A,l.u_ratio),u_device_pixel_ratio:new s.bq(A,l.u_device_pixel_ratio),u_units_to_pixels:new s.c3(A,l.u_units_to_pixels),u_image:new s.b_(A,l.u_image),u_image_height:new s.bq(A,l.u_image_height),u_tileratio:new s.bq(A,l.u_tileratio),u_crossfade_from:new s.bq(A,l.u_crossfade_from),u_crossfade_to:new s.bq(A,l.u_crossfade_to),u_image_dash:new s.b_(A,l.u_image_dash),u_mix:new s.bq(A,l.u_mix),u_lineatlas_width:new s.bq(A,l.u_lineatlas_width),u_lineatlas_height:new s.bq(A,l.u_lineatlas_height)}),raster:(A,l)=>({u_tl_parent:new s.c3(A,l.u_tl_parent),u_scale_parent:new s.bq(A,l.u_scale_parent),u_buffer_scale:new s.bq(A,l.u_buffer_scale),u_fade_t:new s.bq(A,l.u_fade_t),u_opacity:new s.bq(A,l.u_opacity),u_image0:new s.b_(A,l.u_image0),u_image1:new s.b_(A,l.u_image1),u_brightness_low:new s.bq(A,l.u_brightness_low),u_brightness_high:new s.bq(A,l.u_brightness_high),u_saturation_factor:new s.bq(A,l.u_saturation_factor),u_contrast_factor:new s.bq(A,l.u_contrast_factor),u_spin_weights:new s.c2(A,l.u_spin_weights),u_coords_top:new s.c1(A,l.u_coords_top),u_coords_bottom:new s.c1(A,l.u_coords_bottom)}),symbolIcon:(A,l)=>({u_is_size_zoom_constant:new s.b_(A,l.u_is_size_zoom_constant),u_is_size_feature_constant:new s.b_(A,l.u_is_size_feature_constant),u_size_t:new s.bq(A,l.u_size_t),u_size:new s.bq(A,l.u_size),u_camera_to_center_distance:new s.bq(A,l.u_camera_to_center_distance),u_pitch:new s.bq(A,l.u_pitch),u_rotate_symbol:new s.b_(A,l.u_rotate_symbol),u_aspect_ratio:new s.bq(A,l.u_aspect_ratio),u_fade_change:new s.bq(A,l.u_fade_change),u_label_plane_matrix:new s.c0(A,l.u_label_plane_matrix),u_coord_matrix:new s.c0(A,l.u_coord_matrix),u_is_text:new s.b_(A,l.u_is_text),u_pitch_with_map:new s.b_(A,l.u_pitch_with_map),u_is_along_line:new s.b_(A,l.u_is_along_line),u_is_variable_anchor:new s.b_(A,l.u_is_variable_anchor),u_texsize:new s.c3(A,l.u_texsize),u_texture:new s.b_(A,l.u_texture),u_translation:new s.c3(A,l.u_translation),u_pitched_scale:new s.bq(A,l.u_pitched_scale)}),symbolSDF:(A,l)=>({u_is_size_zoom_constant:new s.b_(A,l.u_is_size_zoom_constant),u_is_size_feature_constant:new s.b_(A,l.u_is_size_feature_constant),u_size_t:new s.bq(A,l.u_size_t),u_size:new s.bq(A,l.u_size),u_camera_to_center_distance:new s.bq(A,l.u_camera_to_center_distance),u_pitch:new s.bq(A,l.u_pitch),u_rotate_symbol:new s.b_(A,l.u_rotate_symbol),u_aspect_ratio:new s.bq(A,l.u_aspect_ratio),u_fade_change:new s.bq(A,l.u_fade_change),u_label_plane_matrix:new s.c0(A,l.u_label_plane_matrix),u_coord_matrix:new s.c0(A,l.u_coord_matrix),u_is_text:new s.b_(A,l.u_is_text),u_pitch_with_map:new s.b_(A,l.u_pitch_with_map),u_is_along_line:new s.b_(A,l.u_is_along_line),u_is_variable_anchor:new s.b_(A,l.u_is_variable_anchor),u_texsize:new s.c3(A,l.u_texsize),u_texture:new s.b_(A,l.u_texture),u_gamma_scale:new s.bq(A,l.u_gamma_scale),u_device_pixel_ratio:new s.bq(A,l.u_device_pixel_ratio),u_is_halo:new s.b_(A,l.u_is_halo),u_translation:new s.c3(A,l.u_translation),u_pitched_scale:new s.bq(A,l.u_pitched_scale)}),symbolTextAndIcon:(A,l)=>({u_is_size_zoom_constant:new s.b_(A,l.u_is_size_zoom_constant),u_is_size_feature_constant:new s.b_(A,l.u_is_size_feature_constant),u_size_t:new s.bq(A,l.u_size_t),u_size:new s.bq(A,l.u_size),u_camera_to_center_distance:new s.bq(A,l.u_camera_to_center_distance),u_pitch:new s.bq(A,l.u_pitch),u_rotate_symbol:new s.b_(A,l.u_rotate_symbol),u_aspect_ratio:new s.bq(A,l.u_aspect_ratio),u_fade_change:new s.bq(A,l.u_fade_change),u_label_plane_matrix:new s.c0(A,l.u_label_plane_matrix),u_coord_matrix:new s.c0(A,l.u_coord_matrix),u_is_text:new s.b_(A,l.u_is_text),u_pitch_with_map:new s.b_(A,l.u_pitch_with_map),u_is_along_line:new s.b_(A,l.u_is_along_line),u_is_variable_anchor:new s.b_(A,l.u_is_variable_anchor),u_texsize:new s.c3(A,l.u_texsize),u_texsize_icon:new s.c3(A,l.u_texsize_icon),u_texture:new s.b_(A,l.u_texture),u_texture_icon:new s.b_(A,l.u_texture_icon),u_gamma_scale:new s.bq(A,l.u_gamma_scale),u_device_pixel_ratio:new s.bq(A,l.u_device_pixel_ratio),u_is_halo:new s.b_(A,l.u_is_halo),u_translation:new s.c3(A,l.u_translation),u_pitched_scale:new s.bq(A,l.u_pitched_scale)}),background:(A,l)=>({u_opacity:new s.bq(A,l.u_opacity),u_color:new s.b$(A,l.u_color)}),backgroundPattern:(A,l)=>({u_opacity:new s.bq(A,l.u_opacity),u_image:new s.b_(A,l.u_image),u_pattern_tl_a:new s.c3(A,l.u_pattern_tl_a),u_pattern_br_a:new s.c3(A,l.u_pattern_br_a),u_pattern_tl_b:new s.c3(A,l.u_pattern_tl_b),u_pattern_br_b:new s.c3(A,l.u_pattern_br_b),u_texsize:new s.c3(A,l.u_texsize),u_mix:new s.bq(A,l.u_mix),u_pattern_size_a:new s.c3(A,l.u_pattern_size_a),u_pattern_size_b:new s.c3(A,l.u_pattern_size_b),u_scale_a:new s.bq(A,l.u_scale_a),u_scale_b:new s.bq(A,l.u_scale_b),u_pixel_coord_upper:new s.c3(A,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.c3(A,l.u_pixel_coord_lower),u_tile_units_to_pixels:new s.bq(A,l.u_tile_units_to_pixels)}),terrain:(A,l)=>({u_texture:new s.b_(A,l.u_texture),u_ele_delta:new s.bq(A,l.u_ele_delta),u_fog_matrix:new s.c0(A,l.u_fog_matrix),u_fog_color:new s.b$(A,l.u_fog_color),u_fog_ground_blend:new s.bq(A,l.u_fog_ground_blend),u_fog_ground_blend_opacity:new s.bq(A,l.u_fog_ground_blend_opacity),u_horizon_color:new s.b$(A,l.u_horizon_color),u_horizon_fog_blend:new s.bq(A,l.u_horizon_fog_blend),u_is_globe_mode:new s.bq(A,l.u_is_globe_mode)}),terrainDepth:(A,l)=>({u_ele_delta:new s.bq(A,l.u_ele_delta)}),terrainCoords:(A,l)=>({u_texture:new s.b_(A,l.u_texture),u_terrain_coords_id:new s.bq(A,l.u_terrain_coords_id),u_ele_delta:new s.bq(A,l.u_ele_delta)}),projectionErrorMeasurement:(A,l)=>({u_input:new s.bq(A,l.u_input),u_output_expected:new s.bq(A,l.u_output_expected)}),atmosphere:(A,l)=>({u_sun_pos:new s.c2(A,l.u_sun_pos),u_atmosphere_blend:new s.bq(A,l.u_atmosphere_blend),u_globe_position:new s.c2(A,l.u_globe_position),u_globe_radius:new s.bq(A,l.u_globe_radius),u_inv_proj_matrix:new s.c0(A,l.u_inv_proj_matrix)}),sky:(A,l)=>({u_sky_color:new s.b$(A,l.u_sky_color),u_horizon_color:new s.b$(A,l.u_horizon_color),u_horizon:new s.c3(A,l.u_horizon),u_horizon_normal:new s.c3(A,l.u_horizon_normal),u_sky_horizon_blend:new s.bq(A,l.u_sky_horizon_blend),u_sky_blend:new s.bq(A,l.u_sky_blend)})};class bl{constructor(l,f,v){this.context=l;const w=l.gl;this.buffer=w.createBuffer(),this.dynamicDraw=!!v,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const f=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Zp={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class T_{constructor(l,f,v,w){this.length=f.length,this.attributes=v,this.itemSize=f.bytesPerElement,this.dynamicDraw=w,this.context=l;const I=l.gl;this.buffer=I.createBuffer(),l.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){if(l.length!==this.length)throw new Error(`Length of new data is ${l.length}, which doesn't match current length of ${this.length}`);const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,f){for(let v=0;v<this.attributes.length;v++){const w=f.attributes[this.attributes[v].name];w!==void 0&&l.enableVertexAttribArray(w)}}setVertexAttribPointers(l,f,v){for(let w=0;w<this.attributes.length;w++){const I=this.attributes[w],k=f.attributes[I.name];k!==void 0&&l.vertexAttribPointer(k,I.components,l[Zp[I.type]],!1,this.itemSize,I.offset+this.itemSize*(v||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Sn{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Hh extends Sn{getDefault(){return s.bp.transparent}set(l){const f=this.current;(l.r!==f.r||l.g!==f.g||l.b!==f.b||l.a!==f.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Zh extends Sn{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class Xh extends Sn{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class lf extends Sn{getDefault(){return[!0,!0,!0,!0]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||l[3]!==f[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class sc extends Sn{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class Nc extends Sn{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class La extends Sn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const f=this.current;(l.func!==f.func||l.ref!==f.ref||l.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class Vs extends Sn{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class Xp extends Sn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=l,this.dirty=!1}}class Yp extends Sn{getDefault(){return[0,1]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class oc extends Sn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=l,this.dirty=!1}}class ut extends Sn{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class Y extends Sn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.BLEND):f.disable(f.BLEND),this.current=l,this.dirty=!1}}class Te extends Sn{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class ht extends Sn{getDefault(){return s.bp.transparent}set(l){const f=this.current;(l.r!==f.r||l.g!==f.g||l.b!==f.b||l.a!==f.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Ht extends Sn{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class di extends Sn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=l,this.dirty=!1}}class Ti extends Sn{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class _n extends Sn{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}class fr extends Sn{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}}class Es extends Sn{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class ji extends Sn{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||l[3]!==f[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Ks extends Sn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class ka extends Sn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class ca extends Sn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class jo extends Sn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Go extends Sn{getDefault(){return null}set(l){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class zu extends Sn{getDefault(){return null}set(l){var f;if(l===this.current&&!this.dirty)return;const v=this.gl;wo(v)?v.bindVertexArray(l):(f=v.getExtension("OES_vertex_array_object"))===null||f===void 0||f.bindVertexArrayOES(l),this.current=l,this.dirty=!1}}class Bu extends Sn{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class M_ extends Sn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class Da extends Sn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class $c extends Sn{constructor(l,f){super(l),this.context=l,this.parent=f}getDefault(){return null}}class cf extends $c{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Kp extends $c{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class C_ extends $c{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}const E_="Framebuffer is not complete";class Jp{constructor(l,f,v,w,I){this.context=l,this.width=f,this.height=v;const k=l.gl,B=this.framebuffer=k.createFramebuffer();if(this.colorAttachment=new cf(l,B),w)this.depthAttachment=I?new C_(l,B):new Kp(l,B);else if(I)throw new Error("Stencil cannot be set without depth");if(k.checkFramebufferStatus(k.FRAMEBUFFER)!==k.FRAMEBUFFER_COMPLETE)throw new Error(E_)}destroy(){const l=this.context.gl,f=this.colorAttachment.get();if(f&&l.deleteTexture(f),this.depthAttachment){const v=this.depthAttachment.get();v&&l.deleteRenderbuffer(v)}l.deleteFramebuffer(this.framebuffer)}}class Qp{constructor(l){var f,v;if(this.gl=l,this.clearColor=new Hh(this),this.clearDepth=new Zh(this),this.clearStencil=new Xh(this),this.colorMask=new lf(this),this.depthMask=new sc(this),this.stencilMask=new Nc(this),this.stencilFunc=new La(this),this.stencilOp=new Vs(this),this.stencilTest=new Xp(this),this.depthRange=new Yp(this),this.depthTest=new oc(this),this.depthFunc=new ut(this),this.blend=new Y(this),this.blendFunc=new Te(this),this.blendColor=new ht(this),this.blendEquation=new Ht(this),this.cullFace=new di(this),this.cullFaceSide=new Ti(this),this.frontFace=new _n(this),this.program=new fr(this),this.activeTexture=new Es(this),this.viewport=new ji(this),this.bindFramebuffer=new Ks(this),this.bindRenderbuffer=new ka(this),this.bindTexture=new ca(this),this.bindVertexBuffer=new jo(this),this.bindElementBuffer=new Go(this),this.bindVertexArray=new zu(this),this.pixelStoreUnpack=new Bu(this),this.pixelStoreUnpackPremultiplyAlpha=new M_(this),this.pixelStoreUnpackFlipY=new Da(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),wo(l)){this.HALF_FLOAT=l.HALF_FLOAT;const w=l.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(f=l.RGBA16F)!==null&&f!==void 0?f:w?.RGBA16F_EXT,this.RGB16F=(v=l.RGB16F)!==null&&v!==void 0?v:w?.RGB16F_EXT,l.getExtension("EXT_color_buffer_float")}else{l.getExtension("EXT_color_buffer_half_float"),l.getExtension("OES_texture_half_float_linear");const w=l.getExtension("OES_texture_half_float");this.HALF_FLOAT=w?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,f){return new bl(this,l,f)}createVertexBuffer(l,f,v){return new T_(this,l,f,v)}createRenderbuffer(l,f,v){const w=this.gl,I=w.createRenderbuffer();return this.bindRenderbuffer.set(I),w.renderbufferStorage(w.RENDERBUFFER,l,f,v),this.bindRenderbuffer.set(null),I}createFramebuffer(l,f,v,w){return new Jp(this,l,f,v,w)}clear({color:l,depth:f,stencil:v}){const w=this.gl;let I=0;l&&(I|=w.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(I|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),v!==void 0&&(I|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(v),this.stencilMask.set(255)),w.clear(I)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){s.bR(l.blendFunction,zn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}createVertexArray(){var l;return wo(this.gl)?this.gl.createVertexArray():(l=this.gl.getExtension("OES_vertex_array_object"))===null||l===void 0?void 0:l.createVertexArrayOES()}deleteVertexArray(l){var f;return wo(this.gl)?this.gl.deleteVertexArray(l):(f=this.gl.getExtension("OES_vertex_array_object"))===null||f===void 0?void 0:f.deleteVertexArrayOES(l)}unbindVAO(){this.bindVertexArray.set(null)}}let Vc;function Nu(A,l,f,v,w){const I=A.context,k=A.transform,B=I.gl,W=A.useProgram("collisionBox"),Z=[];let J=0,he=0;for(let ze=0;ze<v.length;ze++){const We=v[ze],tt=l.getTile(We).getBucket(f);if(!tt)continue;const je=w?tt.textCollisionBox:tt.iconCollisionBox,Qe=tt.collisionCircleArray;Qe.length>0&&(Z.push({circleArray:Qe,circleOffset:he,coord:We}),J+=Qe.length/4,he=J),je&&W.draw(I,B.LINES,Ki.disabled,bn.disabled,A.colorModeForRenderPass(),pn.disabled,nc(A.transform),A.style.map.terrain&&A.style.map.terrain.getTerrainData(We),k.getProjectionData({overscaledTileID:We,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),f.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,null,A.transform.zoom,null,null,je.collisionVertexBuffer)}if(!w||!Z.length)return;const ue=A.useProgram("collisionCircle"),_e=new s.ca;_e.resize(4*J),_e._trim();let Ce=0;for(const ze of Z)for(let We=0;We<ze.circleArray.length/4;We++){const tt=4*We,je=ze.circleArray[tt+0],Qe=ze.circleArray[tt+1],at=ze.circleArray[tt+2],Ke=ze.circleArray[tt+3];_e.emplace(Ce++,je,Qe,at,Ke,0),_e.emplace(Ce++,je,Qe,at,Ke,1),_e.emplace(Ce++,je,Qe,at,Ke,2),_e.emplace(Ce++,je,Qe,at,Ke,3)}(!Vc||Vc.length<2*J)&&(Vc=(function(ze){const We=2*ze,tt=new s.cc;tt.resize(We),tt._trim();for(let je=0;je<We;je++){const Qe=6*je;tt.uint16[Qe+0]=4*je+0,tt.uint16[Qe+1]=4*je+1,tt.uint16[Qe+2]=4*je+2,tt.uint16[Qe+3]=4*je+2,tt.uint16[Qe+4]=4*je+3,tt.uint16[Qe+5]=4*je+0}return tt})(J));const Fe=I.createIndexBuffer(Vc,!0),Ne=I.createVertexBuffer(_e,s.cb.members,!0);for(const ze of Z){const We=zc(A.transform);ue.draw(I,B.TRIANGLES,Ki.disabled,bn.disabled,A.colorModeForRenderPass(),pn.disabled,We,A.style.map.terrain&&A.style.map.terrain.getTerrainData(ze.coord),null,f.id,Ne,Fe,s.aX.simpleSegment(0,2*ze.circleOffset,ze.circleArray.length,ze.circleArray.length/2),null,A.transform.zoom,null,null,null)}Ne.destroy(),Fe.destroy()}const A_=s.ar(new Float32Array(16));function A1(A,l,f,v,w,I){const{horizontalAlign:k,verticalAlign:B}=s.aS(A);return new s.P((-(k-.5)*l/w+v[0])*I,(-(B-.5)*f/w+v[1])*I)}function uf(A,l,f,v,w,I){const k=l.tileAnchorPoint.add(new s.P(l.translation[0],l.translation[1]));if(l.pitchWithMap){let B=v.mult(I);f||(B=B.rotate(-w));const W=k.add(B);return bi(W.x,W.y,l.pitchedLabelPlaneMatrix,l.getElevation).point}if(f){const B=tn(l.tileAnchorPoint.x+1,l.tileAnchorPoint.y,l).point.sub(A),W=Math.atan(B.y/B.x)+(B.x<0?Math.PI:0);return A.add(v.rotate(W))}return A.add(v)}function P1(A,l,f,v,w,I,k,B,W,Z,J,he){const ue=A.text.placedSymbolArray,_e=A.text.dynamicLayoutVertexArray,Ce=A.icon.dynamicLayoutVertexArray,Fe={};_e.clear();for(let Ne=0;Ne<ue.length;Ne++){const ze=ue.get(Ne),We=ze.hidden||!ze.crossTileID||A.allowVerticalPlacement&&!ze.placedOrientation?null:v[ze.crossTileID];if(We){const tt=new s.P(ze.anchorX,ze.anchorY),je={getElevation:he,width:w.width,height:w.height,pitchedLabelPlaneMatrix:I,pitchWithMap:f,transform:w,tileAnchorPoint:tt,translation:Z,unwrappedTileID:J},Qe=f?ro(tt.x,tt.y,je):tn(tt.x,tt.y,je),at=Ni(w.cameraToCenterDistance,Qe.signedDistanceFromCamera);let Ke=s.aA(A.textSizeData,B,ze)*at/s.aM;f&&(Ke*=A.tilePixelRatio/k);const{width:mt,height:Lt,anchor:Et,textOffset:At,textBoxScale:Pt}=We,Qt=A1(Et,mt,Lt,At,Pt,Ke),ti=w.getPitchedTextCorrection(tt.x+Z[0],tt.y+Z[1],J),Xt=uf(Qe.point,je,l,Qt,-w.bearingInRadians,ti),si=A.allowVerticalPlacement&&ze.placedOrientation===s.az.vertical?Math.PI/2:0;for(let Yi=0;Yi<ze.numGlyphs;Yi++)s.aG(_e,Xt,si);W&&ze.associatedIconIndex>=0&&(Fe[ze.associatedIconIndex]={shiftedAnchor:Xt,angle:si})}else Hl(ze.numGlyphs,_e)}if(W){Ce.clear();const Ne=A.icon.placedSymbolArray;for(let ze=0;ze<Ne.length;ze++){const We=Ne.get(ze);if(We.hidden)Hl(We.numGlyphs,Ce);else{const tt=Fe[ze];if(tt)for(let je=0;je<We.numGlyphs;je++)s.aG(Ce,tt.shiftedAnchor,tt.angle);else Hl(We.numGlyphs,Ce)}}A.icon.dynamicLayoutVertexBuffer.updateData(Ce)}A.text.dynamicLayoutVertexBuffer.updateData(_e)}function T0(A,l,f){return f.iconsInText&&l?"symbolTextAndIcon":A?"symbolSDF":"symbolIcon"}function hf(A,l,f,v,w,I,k,B,W,Z,J,he,ue){const _e=A.context,Ce=_e.gl,Fe=A.transform,Ne=B==="map",ze=W==="map",We=B!=="viewport"&&f.layout.get("symbol-placement")!=="point",tt=Ne&&!ze&&!We,je=!f.layout.get("symbol-sort-key").isConstant();let Qe=!1;const at=A.getDepthModeForSublayer(0,Ki.ReadOnly),Ke=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),mt=[],Lt=Fe.getCircleRadiusCorrection();for(const Et of v){const At=l.getTile(Et),Pt=At.getBucket(f);if(!Pt)continue;const Qt=w?Pt.text:Pt.icon;if(!Qt||!Qt.segments.get().length||!Qt.hasVisibleVertices)continue;const ti=Qt.programConfigurations.get(f.id),Xt=w||Pt.sdfIcons,si=w?Pt.textSizeData:Pt.iconSizeData,Yi=ze||Fe.pitch!==0,kn=A.useProgram(T0(Xt,w,Pt),ti),pr=s.ay(si,Fe.zoom),Jn=A.style.map.terrain&&A.style.map.terrain.getTerrainData(Et);let br,Qn,Br,xr,Ps=[0,0],rs=null;if(w)Qn=At.glyphAtlasTexture,Br=Ce.LINEAR,br=At.glyphAtlasTexture.size,Pt.iconsInText&&(Ps=At.imageAtlasTexture.size,rs=At.imageAtlasTexture,xr=Yi||A.options.rotating||A.options.zooming||si.kind==="composite"||si.kind==="camera"?Ce.LINEAR:Ce.NEAREST);else{const sr=f.layout.get("icon-size").constantOr(0)!==1||Pt.iconsNeedLinear;Qn=At.imageAtlasTexture,Br=Xt||A.options.rotating||A.options.zooming||sr||Yi?Ce.LINEAR:Ce.NEAREST,br=At.imageAtlasTexture.size}const Zr=s.aN(At,1,A.transform.zoom),Us=Wi(Ne,A.transform,Zr),Wc=s.N();s.aB(Wc,Us);const lc=wt(ze,Ne,A.transform,Zr),xl=s.aO(Fe,At,I,k),So=Fe.getProjectionData({overscaledTileID:Et,applyGlobeMatrix:!ue,applyTerrainMatrix:!0}),qu=Ke&&Pt.hasTextData(),Rf=f.layout.get("icon-text-fit")!=="none"&&qu&&Pt.hasIconData();if(We){const sr=A.style.map.terrain?(gs,_s)=>A.style.map.terrain.getElevation(Et,gs,_s):null,er=f.layout.get("text-rotation-alignment")==="map";Xi(Pt,A,w,Us,Wc,ze,Z,er,Et.toUnwrapped(),Fe.width,Fe.height,xl,sr)}const Wu=w&&Ke||Rf,da=We||Wu?A_:ze?Us:A.transform.clipSpaceToPixelsMatrix,wl=Xt&&f.paint.get(w?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Na;Na=Xt?Pt.iconsInText?Ra(si.kind,pr,tt,ze,We,Wu,A,da,lc,xl,br,Ps,Lt):Ou(si.kind,pr,tt,ze,We,Wu,A,da,lc,xl,w,br,0,Lt):Fu(si.kind,pr,tt,ze,We,Wu,A,da,lc,xl,w,br,Lt);const $a={program:kn,buffers:Qt,uniformValues:Na,projectionData:So,atlasTexture:Qn,atlasTextureIcon:rs,atlasInterpolation:Br,atlasInterpolationIcon:xr,isSDF:Xt,hasHalo:wl};if(je&&Pt.canOverlap){Qe=!0;const sr=Qt.segments.get();for(const er of sr)mt.push({segments:new s.aX([er]),sortKey:er.sortKey,state:$a,terrainData:Jn})}else mt.push({segments:Qt.segments,sortKey:0,state:$a,terrainData:Jn})}Qe&&mt.sort(((Et,At)=>Et.sortKey-At.sortKey));for(const Et of mt){const At=Et.state;if(_e.activeTexture.set(Ce.TEXTURE0),At.atlasTexture.bind(At.atlasInterpolation,Ce.CLAMP_TO_EDGE),At.atlasTextureIcon&&(_e.activeTexture.set(Ce.TEXTURE1),At.atlasTextureIcon&&At.atlasTextureIcon.bind(At.atlasInterpolationIcon,Ce.CLAMP_TO_EDGE)),At.isSDF){const Pt=At.uniformValues;At.hasHalo&&(Pt.u_is_halo=1,em(At.buffers,Et.segments,f,A,At.program,at,J,he,Pt,At.projectionData,Et.terrainData)),Pt.u_is_halo=0}em(At.buffers,Et.segments,f,A,At.program,at,J,he,At.uniformValues,At.projectionData,Et.terrainData)}}function em(A,l,f,v,w,I,k,B,W,Z,J){const he=v.context;w.draw(he,he.gl.TRIANGLES,I,k,B,pn.backCCW,W,J,Z,f.id,A.layoutVertexBuffer,A.indexBuffer,l,f.paint,v.transform.zoom,A.programConfigurations.get(f.id),A.dynamicLayoutVertexBuffer,A.opacityVertexBuffer)}function M0(A,l,f,v,w){const I=A.context,k=I.gl,B=bn.disabled,W=new zn([k.ONE,k.ONE],s.bp.transparent,[!0,!0,!0,!0]),Z=l.getBucket(f);if(!Z)return;const J=v.key;let he=f.heatmapFbos.get(J);he||(he=df(I,l.tileSize,l.tileSize),f.heatmapFbos.set(J,he)),I.bindFramebuffer.set(he.framebuffer),I.viewport.set([0,0,l.tileSize,l.tileSize]),I.clear({color:s.bp.transparent});const ue=Z.programConfigurations.get(f.id),_e=A.useProgram("heatmap",ue,!w),Ce=A.transform.getProjectionData({overscaledTileID:l.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Fe=A.style.map.terrain.getTerrainData(v);_e.draw(I,k.TRIANGLES,Ki.disabled,B,W,pn.disabled,Bc(l,A.transform.zoom,f.paint.get("heatmap-intensity"),1),Fe,Ce,f.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,f.paint,A.transform.zoom,ue)}function C0(A,l,f,v,w){const I=A.context,k=I.gl,B=A.transform;I.setColorMode(A.colorModeForRenderPass());const W=tm(I,l),Z=f.key,J=l.heatmapFbos.get(Z);if(!J)return;I.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,J.colorAttachment.get()),I.activeTexture.set(k.TEXTURE1),W.bind(k.LINEAR,k.CLAMP_TO_EDGE);const he=B.getProjectionData({overscaledTileID:f,applyTerrainMatrix:w,applyGlobeMatrix:!v});A.useProgram("heatmapTexture").draw(I,k.TRIANGLES,Ki.disabled,bn.disabled,A.colorModeForRenderPass(),pn.disabled,jp(A,l,0,1),null,he,l.id,A.rasterBoundsBuffer,A.quadTriangleIndexBuffer,A.rasterBoundsSegments,l.paint,B.zoom),J.destroy(),l.heatmapFbos.delete(Z)}function df(A,l,f){var v,w;const I=A.gl,k=I.createTexture();I.bindTexture(I.TEXTURE_2D,k),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_S,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_T,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MIN_FILTER,I.LINEAR),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MAG_FILTER,I.LINEAR);const B=(v=A.HALF_FLOAT)!==null&&v!==void 0?v:I.UNSIGNED_BYTE,W=(w=A.RGBA16F)!==null&&w!==void 0?w:I.RGBA;I.texImage2D(I.TEXTURE_2D,0,W,l,f,0,I.RGBA,B,null);const Z=A.createFramebuffer(l,f,!1,!1);return Z.colorAttachment.set(k),Z}function tm(A,l){return l.colorRampTexture||(l.colorRampTexture=new s.T(A,l.colorRamp,A.gl.RGBA)),l.colorRampTexture}function E0(A,l,f,v,w,I,k,B){let W=256;if(w.stepInterpolant){const Z=l.getSource().maxzoom,J=k.canonical.z===Z?Math.ceil(1<<A.transform.maxZoom-k.canonical.z):1;W=s.an(s.ce(I.maxLineLength/s.a5*1024*J),256,f.maxTextureSize)}return B.gradient=s.cf({expression:w.gradientExpression(),evaluationKey:"lineProgress",resolution:W,image:B.gradient||void 0,clips:I.lineClipsArray}),B.texture?B.texture.update(B.gradient):B.texture=new s.T(f,B.gradient,v.RGBA),B.version=w.gradientVersion,B.texture}function A0(A,l,f,v,w){A.activeTexture.set(l.TEXTURE0),f.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),v.updatePaintBuffers(w)}function Wr(A,l,f,v,w,I){(w||A.lineAtlas.dirty)&&(l.activeTexture.set(f.TEXTURE0),A.lineAtlas.bind(l)),v.updatePaintBuffers(I)}function $u(A,l,f,v,w,I,k){const B=I.gradients[w.id];let W=B.texture;w.gradientVersion!==B.version&&(W=E0(A,l,f,v,w,I,k,B)),f.activeTexture.set(v.TEXTURE0),W.bind(w.stepInterpolant?v.NEAREST:v.LINEAR,v.CLAMP_TO_EDGE)}function qo(A,l,f,v,w,I,k,B,W){const Z=I.gradients[w.id];let J=Z.texture;w.gradientVersion!==Z.version&&(J=E0(A,l,f,v,w,I,k,Z)),f.activeTexture.set(v.TEXTURE0),J.bind(w.stepInterpolant?v.NEAREST:v.LINEAR,v.CLAMP_TO_EDGE),f.activeTexture.set(v.TEXTURE1),A.lineAtlas.bind(f),B.updatePaintBuffers(W)}function im(A,l,f,v,w){if(!f||!v||!v.imageAtlas)return;const I=v.imageAtlas.patternPositions;let k=I[f.to.toString()],B=I[f.from.toString()];if(!k&&B&&(k=B),!B&&k&&(B=k),!k||!B){const W=w.getPaintProperty(l);k=I[W],B=I[W]}k&&B&&A.setConstantPatternPositions(k,B)}function ff(A,l,f,v,w,I,k,B){const W=A.context.gl,Z="fill-pattern",J=f.paint.get(Z),he=J&&J.constantOr(1),ue=f.getCrossfadeParameters();let _e,Ce,Fe,Ne,ze;const We=A.transform,tt=f.paint.get("fill-translate"),je=f.paint.get("fill-translate-anchor");k?(Ce=he&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",_e=W.LINES):(Ce=he?"fillPattern":"fill",_e=W.TRIANGLES);const Qe=J.constantOr(null);for(const at of v){const Ke=l.getTile(at);if(he&&!Ke.patternsLoaded())continue;const mt=Ke.getBucket(f);if(!mt)continue;const Lt=mt.programConfigurations.get(f.id),Et=A.useProgram(Ce,Lt),At=A.style.map.terrain&&A.style.map.terrain.getTerrainData(at);he&&(A.context.activeTexture.set(W.TEXTURE0),Ke.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),Lt.updatePaintBuffers(ue)),im(Lt,Z,Qe,Ke,f);const Pt=We.getProjectionData({overscaledTileID:at,applyGlobeMatrix:!B,applyTerrainMatrix:!0}),Qt=s.aO(We,Ke,tt,je);if(k){Ne=mt.indexBuffer2,ze=mt.segments2;const Xt=[W.drawingBufferWidth,W.drawingBufferHeight];Fe=Ce==="fillOutlinePattern"&&he?Vp(A,ue,Ke,Xt,Qt):of(Xt,Qt)}else Ne=mt.indexBuffer,ze=mt.segments,Fe=he?Ru(A,ue,Ke,Qt):{u_fill_translate:Qt};const ti=A.stencilModeForClipping(at);Et.draw(A.context,_e,w,ti,I,pn.backCCW,Fe,At,Pt,f.id,mt.layoutVertexBuffer,Ne,ze,f.paint,A.transform.zoom,Lt)}}function nm(A,l,f,v,w,I,k,B){const W=A.context,Z=W.gl,J="fill-extrusion-pattern",he=f.paint.get(J),ue=he.constantOr(1),_e=f.getCrossfadeParameters(),Ce=f.paint.get("fill-extrusion-opacity"),Fe=he.constantOr(null),Ne=A.transform;for(const ze of v){const We=l.getTile(ze),tt=We.getBucket(f);if(!tt)continue;const je=A.style.map.terrain&&A.style.map.terrain.getTerrainData(ze),Qe=tt.programConfigurations.get(f.id),at=A.useProgram(ue?"fillExtrusionPattern":"fillExtrusion",Qe);ue&&(A.context.activeTexture.set(Z.TEXTURE0),We.imageAtlasTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),Qe.updatePaintBuffers(_e));const Ke=Ne.getProjectionData({overscaledTileID:ze,applyGlobeMatrix:!B,applyTerrainMatrix:!0});im(Qe,J,Fe,We,f);const mt=s.aO(Ne,We,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),Lt=f.paint.get("fill-extrusion-vertical-gradient"),Et=ue?yl(A,Lt,Ce,mt,ze,_e,We):sf(A,Lt,Ce,mt);at.draw(W,W.gl.TRIANGLES,w,I,k,pn.backCCW,Et,je,Ke,f.id,tt.layoutVertexBuffer,tt.indexBuffer,tt.segments,f.paint,A.transform.zoom,Qe,A.style.map.terrain&&tt.centroidVertexBuffer)}}function Uc(A,l,f,v,w,I,k,B,W){var Z;const J=A.style.projection,he=A.context,ue=A.transform,_e=he.gl,Ce=[`#define NUM_ILLUMINATION_SOURCES ${f.paint.get("hillshade-highlight-color").values.length}`],Fe=A.useProgram("hillshade",null,!1,Ce),Ne=!A.options.moving;for(const ze of v){const We=l.getTile(ze),tt=We.fbo;if(!tt)continue;const je=J.getMeshFromTileID(he,ze.canonical,B,!0,"raster"),Qe=(Z=A.style.map.terrain)===null||Z===void 0?void 0:Z.getTerrainData(ze);he.activeTexture.set(_e.TEXTURE0),_e.bindTexture(_e.TEXTURE_2D,tt.colorAttachment.get());const at=ue.getProjectionData({overscaledTileID:ze,aligned:Ne,applyGlobeMatrix:!W,applyTerrainMatrix:!0});Fe.draw(he,_e.TRIANGLES,I,w[ze.overscaledZ],k,pn.backCCW,jh(A,We,f),Qe,at,f.id,je.vertexBuffer,je.indexBuffer,je.segments)}}function pf(A,l,f,v,w,I,k,B,W){var Z;const J=A.style.projection,he=A.context,ue=A.transform,_e=he.gl,Ce=A.useProgram("colorRelief"),Fe=!A.options.moving;let Ne=!0,ze=0;for(const We of v){const tt=l.getTile(We),je=tt.dem;if(Ne){const Et=_e.getParameter(_e.MAX_TEXTURE_SIZE),{elevationTexture:At,colorTexture:Pt}=f.getColorRampTextures(he,Et,je.getUnpackVector());he.activeTexture.set(_e.TEXTURE1),At.bind(_e.NEAREST,_e.CLAMP_TO_EDGE),he.activeTexture.set(_e.TEXTURE4),Pt.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),Ne=!1,ze=At.size[0]}if(!je||!je.data)continue;const Qe=je.stride,at=je.getPixels();if(he.activeTexture.set(_e.TEXTURE0),he.pixelStoreUnpackPremultiplyAlpha.set(!1),tt.demTexture=tt.demTexture||A.getTileTexture(Qe),tt.demTexture){const Et=tt.demTexture;Et.update(at,{premultiply:!1}),Et.bind(_e.LINEAR,_e.CLAMP_TO_EDGE)}else tt.demTexture=new s.T(he,at,_e.RGBA,{premultiply:!1}),tt.demTexture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE);const Ke=J.getMeshFromTileID(he,We.canonical,B,!0,"raster"),mt=(Z=A.style.map.terrain)===null||Z===void 0?void 0:Z.getTerrainData(We),Lt=ue.getProjectionData({overscaledTileID:We,aligned:Fe,applyGlobeMatrix:!W,applyTerrainMatrix:!0});Ce.draw(he,_e.TRIANGLES,I,w[We.overscaledZ],k,pn.backCCW,Gp(f,tt.dem,ze),mt,Lt,f.id,Ke.vertexBuffer,Ke.indexBuffer,Ke.segments)}}const Vu=[new s.P(0,0),new s.P(s.a5,0),new s.P(s.a5,s.a5),new s.P(0,s.a5)];function Yh(A,l,f,v,w,I,k,B,W=!1,Z=!1){const J=v[v.length-1].overscaledZ,he=A.context,ue=he.gl,_e=A.useProgram("raster"),Ce=A.transform,Fe=A.style.projection,Ne=A.colorModeForRenderPass(),ze=!A.options.moving,We=f.paint.get("raster-opacity"),tt=f.paint.get("raster-resampling"),je=f.paint.get("raster-fade-duration"),Qe=!!A.style.map.terrain;for(const at of v){const Ke=A.getDepthModeForSublayer(at.overscaledZ-J,We===1?Ki.ReadWrite:Ki.ReadOnly,ue.LESS),mt=l.getTile(at),Lt=tt==="nearest"?ue.NEAREST:ue.LINEAR;he.activeTexture.set(ue.TEXTURE0),mt.texture.bind(Lt,ue.CLAMP_TO_EDGE,ue.LINEAR_MIPMAP_NEAREST),he.activeTexture.set(ue.TEXTURE1);const{parentTile:Et,parentScaleBy:At,parentTopLeft:Pt,fadeValues:Qt}=P0(mt,l,je,Qe);mt.fadeOpacity=Qt.tileOpacity,Et?(Et.fadeOpacity=Qt.parentTileOpacity,Et.texture.bind(Lt,ue.CLAMP_TO_EDGE,ue.LINEAR_MIPMAP_NEAREST)):mt.texture.bind(Lt,ue.CLAMP_TO_EDGE,ue.LINEAR_MIPMAP_NEAREST),mt.texture.useMipmap&&he.extTextureFilterAnisotropic&&A.transform.pitch>20&&ue.texParameterf(ue.TEXTURE_2D,he.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,he.extTextureFilterAnisotropicMax);const ti=A.style.map.terrain&&A.style.map.terrain.getTerrainData(at),Xt=Ce.getProjectionData({overscaledTileID:at,aligned:ze,applyGlobeMatrix:!Z,applyTerrainMatrix:!0}),si=Ia(Pt,At,Qt.fadeMix,f,B),Yi=Fe.getMeshFromTileID(he,at.canonical,I,k,"raster");_e.draw(he,ue.TRIANGLES,Ke,w?w[at.overscaledZ]:bn.disabled,Ne,W?pn.frontCCW:pn.backCCW,si,ti,Xt,f.id,Yi.vertexBuffer,Yi.indexBuffer,Yi.segments)}}function P0(A,l,f,v){const w={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(f===0||v)return w;if(A.fadingParentID){const I=l.getLoadedTile(A.fadingParentID);if(!I)return w;const k=Math.pow(2,I.tileID.overscaledZ-A.tileID.overscaledZ),B=[A.tileID.canonical.x*k%1,A.tileID.canonical.y*k%1],W=(function(Z,J,he){const ue=P(),_e=(ue-J.timeAdded)/he,Ce=Z.fadingDirection===St.Incoming,Fe=s.an((ue-Z.timeAdded)/he,0,1),Ne=s.an(1-_e,0,1),ze=Ce?Fe:Ne;return{tileOpacity:ze,parentTileOpacity:Ce?Ne:Fe,fadeMix:{opacity:1,mix:1-ze}}})(A,I,f);return{parentTile:I,parentScaleBy:k,parentTopLeft:B,fadeValues:W}}if(A.selfFading){const I=(function(k,B){const W=(P()-k.timeAdded)/B,Z=s.an(W,0,1);return{tileOpacity:Z,fadeMix:{opacity:Z,mix:0}}})(A,f);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:I}}return w}const I0=new s.bp(1,0,0,1),R0=new s.bp(0,1,0,1),L0=new s.bp(0,0,1,1),k0=new s.bp(1,0,1,1),jc=new s.bp(0,1,1,1);function P_(A,l,f,v){mf(A,0,l+f/2,A.transform.width,f,v)}function I_(A,l,f,v){mf(A,l-f/2,0,f,A.transform.height,v)}function mf(A,l,f,v,w,I){const k=A.context,B=k.gl;B.enable(B.SCISSOR_TEST),B.scissor(l*A.pixelRatio,f*A.pixelRatio,v*A.pixelRatio,w*A.pixelRatio),k.clear({color:I}),B.disable(B.SCISSOR_TEST)}function D0(A,l,f){const v=A.context,w=v.gl,I=A.useProgram("debug"),k=Ki.disabled,B=bn.disabled,W=A.colorModeForRenderPass(),Z="$debug",J=A.style.map.terrain&&A.style.map.terrain.getTerrainData(f);v.activeTexture.set(w.TEXTURE0);const he=l.getTileByID(f.key).latestRawTileData,ue=Math.floor((he&&he.byteLength||0)/1024),_e=l.getTile(f).tileSize,Ce=512/Math.min(_e,512)*(f.overscaledZ/A.transform.zoom)*.5;let Fe=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(Fe+=` => ${f.overscaledZ}`),(function(ze,We){ze.initDebugOverlayCanvas();const tt=ze.debugOverlayCanvas,je=ze.context.gl,Qe=ze.debugOverlayCanvas.getContext("2d");Qe.clearRect(0,0,tt.width,tt.height),Qe.shadowColor="white",Qe.shadowBlur=2,Qe.lineWidth=1.5,Qe.strokeStyle="white",Qe.textBaseline="top",Qe.font="bold 36px Open Sans, sans-serif",Qe.fillText(We,5,5),Qe.strokeText(We,5,5),ze.debugOverlayTexture.update(tt),ze.debugOverlayTexture.bind(je.LINEAR,je.CLAMP_TO_EDGE)})(A,`${Fe} ${ue}kB`);const Ne=A.transform.getProjectionData({overscaledTileID:f,applyGlobeMatrix:!0,applyTerrainMatrix:!0});I.draw(v,w.TRIANGLES,k,B,zn.alphaBlended,pn.disabled,Pa(s.bp.transparent,Ce),null,Ne,Z,A.debugBuffer,A.quadTriangleIndexBuffer,A.debugSegments),I.draw(v,w.LINE_STRIP,k,B,W,pn.disabled,Pa(s.bp.red),J,Ne,Z,A.debugBuffer,A.tileBorderIndexBuffer,A.debugSegments)}function R_(A,l,f,v){const{isRenderingGlobe:w}=v,I=A.context,k=I.gl,B=A.transform,W=A.colorModeForRenderPass(),Z=A.getDepthModeFor3D(),J=A.useProgram("terrain");I.bindFramebuffer.set(null),I.viewport.set([0,0,A.width,A.height]);for(const he of f){const ue=l.getTerrainMesh(he.tileID),_e=A.renderToTexture.getTexture(he),Ce=l.getTerrainData(he.tileID);I.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,_e.texture);const Fe=l.getMeshFrameDelta(B.zoom),Ne=B.calculateFogMatrix(he.tileID.toUnwrapped()),ze=x_(Fe,Ne,A.style.sky,B.pitch,w),We=B.getProjectionData({overscaledTileID:he.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});J.draw(I,k.TRIANGLES,Z,bn.disabled,W,pn.backCCW,ze,Ce,We,"terrain",ue.vertexBuffer,ue.indexBuffer,ue.segments)}}function L_(A,l){if(!l.mesh){const f=new s.aW;f.emplaceBack(-1,-1),f.emplaceBack(1,-1),f.emplaceBack(1,1),f.emplaceBack(-1,1);const v=new s.aY;v.emplaceBack(0,1,2),v.emplaceBack(0,2,3),l.mesh=new On(A.createVertexBuffer(f,Sa.members),A.createIndexBuffer(v),s.aX.simpleSegment(0,0,f.length,v.length))}return l.mesh}class F0{constructor(l,f){this.context=new Qp(l),this.transform=f,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ii.maxOverzooming+Ii.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ns}resize(l,f,v){if(this.width=Math.floor(l*v),this.height=Math.floor(f*v),this.pixelRatio=v,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const w of this.style._order)this.style._layers[w].resize()}setup(){const l=this.context,f=new s.aW;f.emplaceBack(0,0),f.emplaceBack(s.a5,0),f.emplaceBack(0,s.a5),f.emplaceBack(s.a5,s.a5),this.tileExtentBuffer=l.createVertexBuffer(f,Sa.members),this.tileExtentSegments=s.aX.simpleSegment(0,0,4,2);const v=new s.aW;v.emplaceBack(0,0),v.emplaceBack(s.a5,0),v.emplaceBack(0,s.a5),v.emplaceBack(s.a5,s.a5),this.debugBuffer=l.createVertexBuffer(v,Sa.members),this.debugSegments=s.aX.simpleSegment(0,0,4,5);const w=new s.ch;w.emplaceBack(0,0,0,0),w.emplaceBack(s.a5,0,s.a5,0),w.emplaceBack(0,s.a5,0,s.a5),w.emplaceBack(s.a5,s.a5,s.a5,s.a5),this.rasterBoundsBuffer=l.createVertexBuffer(w,b_.members),this.rasterBoundsSegments=s.aX.simpleSegment(0,0,4,2);const I=new s.aW;I.emplaceBack(0,0),I.emplaceBack(s.a5,0),I.emplaceBack(0,s.a5),I.emplaceBack(s.a5,s.a5),this.rasterBoundsBufferPosOnly=l.createVertexBuffer(I,Sa.members),this.rasterBoundsSegmentsPosOnly=s.aX.simpleSegment(0,0,4,5);const k=new s.aW;k.emplaceBack(0,0),k.emplaceBack(1,0),k.emplaceBack(0,1),k.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(k,Sa.members),this.viewportSegments=s.aX.simpleSegment(0,0,4,2);const B=new s.ci;B.emplaceBack(0),B.emplaceBack(1),B.emplaceBack(3),B.emplaceBack(2),B.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(B);const W=new s.aY;W.emplaceBack(1,0,2),W.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(W);const Z=this.context.gl;this.stencilClearMode=new bn({func:Z.ALWAYS,mask:0},0,255,Z.ZERO,Z.ZERO,Z.ZERO),this.tileExtentMesh=new On(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const l=this.context,f=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const v=s.N();s.c7(v,0,this.width,this.height,0,0,1),s.Q(v,v,[f.drawingBufferWidth,f.drawingBufferHeight,0]);const w={mainMatrix:v,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:v};this.useProgram("clippingMask",null,!0).draw(l,f.TRIANGLES,Ki.disabled,this.stencilClearMode,zn.disabled,pn.disabled,null,null,w,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(l,f,v){if(this.currentStencilSource===l.source||!l.isTileClipped()||!f||!f.length)return;this.currentStencilSource=l.source,this.nextStencilID+f.length>256&&this.clearStencil();const w=this.context;w.setColorMode(zn.disabled),w.setDepthMode(Ki.disabled);const I={};for(const k of f)I[k.key]=this.nextStencilID++;this._renderTileMasks(I,f,v,!0),this._renderTileMasks(I,f,v,!1),this._tileClippingMaskIDs=I}_renderTileMasks(l,f,v,w){const I=this.context,k=I.gl,B=this.style.projection,W=this.transform,Z=this.useProgram("clippingMask");for(const J of f){const he=l[J.key],ue=this.style.map.terrain&&this.style.map.terrain.getTerrainData(J),_e=B.getMeshFromTileID(this.context,J.canonical,w,!0,"stencil"),Ce=W.getProjectionData({overscaledTileID:J,applyGlobeMatrix:!v,applyTerrainMatrix:!0});Z.draw(I,k.TRIANGLES,Ki.disabled,new bn({func:k.ALWAYS,mask:0},he,255,k.KEEP,k.KEEP,k.REPLACE),zn.disabled,v?pn.disabled:pn.backCCW,null,ue,Ce,"$clipping",_e.vertexBuffer,_e.indexBuffer,_e.segments)}}_renderTilesDepthBuffer(){const l=this.context,f=l.gl,v=this.style.projection,w=this.transform,I=this.useProgram("depth"),k=this.getDepthModeFor3D(),B=Un(w,{tileSize:w.tileSize});for(const W of B){const Z=this.style.map.terrain&&this.style.map.terrain.getTerrainData(W),J=v.getMeshFromTileID(this.context,W.canonical,!0,!0,"raster"),he=w.getProjectionData({overscaledTileID:W,applyGlobeMatrix:!0,applyTerrainMatrix:!0});I.draw(l,f.TRIANGLES,k,bn.disabled,zn.disabled,pn.backCCW,null,Z,he,"$clipping",J.vertexBuffer,J.indexBuffer,J.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,f=this.context.gl;return new bn({func:f.NOTEQUAL,mask:255},l,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(l){const f=this.context.gl;return new bn({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,f.KEEP,f.KEEP,f.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(l){const f=this.context.gl,v=l.sort(((k,B)=>B.overscaledZ-k.overscaledZ)),w=v[v.length-1].overscaledZ,I=v[0].overscaledZ-w+1;if(I>1){this.currentStencilSource=void 0,this.nextStencilID+I>256&&this.clearStencil();const k={};for(let B=0;B<I;B++)k[B+w]=new bn({func:f.GEQUAL,mask:255},B+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=I,[k,v]}return[{[w]:bn.disabled},v]}stencilConfigForOverlapTwoPass(l){const f=this.context.gl,v=l.sort(((k,B)=>B.overscaledZ-k.overscaledZ)),w=v[v.length-1].overscaledZ,I=v[0].overscaledZ-w+1;if(this.clearStencil(),I>1){const k={},B={};for(let W=0;W<I;W++)k[W+w]=new bn({func:f.GREATER,mask:255},I+1+W,255,f.KEEP,f.KEEP,f.REPLACE),B[W+w]=new bn({func:f.GREATER,mask:255},1+W,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID=2*I+1,[k,B,v]}return this.nextStencilID=3,[{[w]:new bn({func:f.GREATER,mask:255},2,255,f.KEEP,f.KEEP,f.REPLACE)},{[w]:new bn({func:f.GREATER,mask:255},1,255,f.KEEP,f.KEEP,f.REPLACE)},v]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new zn([l.CONSTANT_COLOR,l.ONE],new s.bp(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?zn.unblended:zn.alphaBlended}getDepthModeForSublayer(l,f,v){if(!this.opaquePassEnabledForLayer())return Ki.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new Ki(v||this.context.gl.LEQUAL,f,[w,w])}getDepthModeFor3D(){return new Ki(this.context.gl.LEQUAL,Ki.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,f){var v,w;this.style=l,this.options=f,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(P()),this.imageManager.beginFrame();const I=this.style._order,k=this.style.tileManagers,B={},W={},Z={},J={isRenderingToTexture:!1,isRenderingGlobe:((v=l.projection)===null||v===void 0?void 0:v.transitionState)>0};for(const ue in k){const _e=k[ue];_e.used&&_e.prepare(this.context),B[ue]=_e.getVisibleCoordinates(!1),W[ue]=B[ue].slice().reverse(),Z[ue]=_e.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let ue=0;ue<I.length;ue++)if(this.style._layers[I[ue]].is3D()){this.opaquePassCutoff=ue;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const ue of I){const _e=this.style._layers[ue];if(!_e.hasOffscreenPass()||_e.isHidden(this.transform.zoom))continue;const Ce=W[_e.source];(_e.type==="custom"||Ce.length)&&this.renderLayer(this,k[_e.source],_e,Ce,J)}if((w=this.style.projection)===null||w===void 0||w.updateGPUdependent({context:this.context,useProgram:ue=>this.useProgram(ue)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?s.bp.black:s.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(ue,_e){const Ce=ue.context,Fe=Ce.gl,Ne=((at,Ke,mt)=>{const Lt=Math.cos(Ke.rollInRadians),Et=Math.sin(Ke.rollInRadians),At=vn(Ke),Pt=Ke.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:at.properties.get("sky-color"),u_horizon_color:at.properties.get("horizon-color"),u_horizon:[(Ke.width/2-At*Et)*mt,(Ke.height/2+At*Lt)*mt],u_horizon_normal:[-Et,Lt],u_sky_horizon_blend:at.properties.get("sky-horizon-blend")*Ke.height/2*mt,u_sky_blend:Pt}})(_e,ue.style.map.transform,ue.pixelRatio),ze=new Ki(Fe.LEQUAL,Ki.ReadWrite,[0,1]),We=bn.disabled,tt=ue.colorModeForRenderPass(),je=ue.useProgram("sky"),Qe=L_(Ce,_e);je.draw(Ce,Fe.TRIANGLES,ze,We,tt,pn.disabled,Ne,null,void 0,"sky",Qe.vertexBuffer,Qe.indexBuffer,Qe.segments)})(this,this.style.sky),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=I.length-1;this.currentLayer>=0;this.currentLayer--){const ue=this.style._layers[I[this.currentLayer]],_e=k[ue.source],Ce=B[ue.source];this._renderTileClippingMasks(ue,Ce,!1),this.renderLayer(this,_e,ue,Ce,J)}this.renderPass="translucent";let he=!1;for(this.currentLayer=0;this.currentLayer<I.length;this.currentLayer++){const ue=this.style._layers[I[this.currentLayer]],_e=k[ue.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(ue,J))continue;this.opaquePassEnabledForLayer()||he||(he=!0,J.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const Ce=(ue.type==="symbol"?Z:W)[ue.source];this._renderTileClippingMasks(ue,B[ue.source],!!this.renderToTexture),this.renderLayer(this,_e,ue,Ce,J)}if(J.isRenderingGlobe&&(function(ue,_e,Ce){const Fe=ue.context,Ne=Fe.gl,ze=ue.useProgram("atmosphere"),We=new Ki(Ne.LEQUAL,Ki.ReadOnly,[0,1]),tt=ue.transform,je=(function(Pt,Qt){const ti=Pt.properties.get("position"),Xt=[-ti.x,-ti.y,-ti.z],si=s.ar(new Float64Array(16));return Pt.properties.get("anchor")==="map"&&(s.bg(si,si,Qt.rollInRadians),s.bh(si,si,-Qt.pitchInRadians),s.bg(si,si,Qt.bearingInRadians),s.bh(si,si,Qt.center.lat*Math.PI/180),s.bJ(si,si,-Qt.center.lng*Math.PI/180)),s.cg(Xt,Xt,si),Xt})(Ce,ue.transform),Qe=tt.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),at=_e.properties.get("atmosphere-blend")*Qe.projectionTransition;if(at===0)return;const Ke=ec(tt.worldSize,tt.center.lat),mt=tt.inverseProjectionMatrix,Lt=new Float64Array(4);Lt[3]=1,s.aH(Lt,Lt,tt.modelViewProjectionMatrix),Lt[0]/=Lt[3],Lt[1]/=Lt[3],Lt[2]/=Lt[3],Lt[3]=1,s.aH(Lt,Lt,mt),Lt[0]/=Lt[3],Lt[1]/=Lt[3],Lt[2]/=Lt[3],Lt[3]=1;const Et=((Pt,Qt,ti,Xt,si)=>({u_sun_pos:Pt,u_atmosphere_blend:Qt,u_globe_position:ti,u_globe_radius:Xt,u_inv_proj_matrix:si}))(je,at,[Lt[0],Lt[1],Lt[2]],Ke,mt),At=L_(Fe,_e);ze.draw(Fe,Ne.TRIANGLES,We,bn.disabled,zn.alphaBlended,pn.disabled,Et,null,null,"atmosphere",At.vertexBuffer,At.indexBuffer,At.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const ue=(function(_e,Ce){let Fe=null;const Ne=Object.values(_e._layers).flatMap((je=>je.source&&!je.isHidden(Ce)?[_e.tileManagers[je.source]]:[])),ze=Ne.filter((je=>je.getSource().type==="vector")),We=Ne.filter((je=>je.getSource().type!=="vector")),tt=je=>{(!Fe||Fe.getSource().maxzoom<je.getSource().maxzoom)&&(Fe=je)};return ze.forEach((je=>tt(je))),Fe||We.forEach((je=>tt(je))),Fe})(this.style,this.transform.zoom);ue&&(function(_e,Ce,Fe){for(let Ne=0;Ne<Fe.length;Ne++)D0(_e,Ce,Fe[Ne])})(this,ue,ue.getVisibleCoordinates())}this.options.showPadding&&(function(ue){const _e=ue.transform.padding;P_(ue,ue.transform.height-(_e.top||0),3,I0),P_(ue,_e.bottom||0,3,R0),I_(ue,_e.left||0,3,L0),I_(ue,ue.transform.width-(_e.right||0),3,k0);const Ce=ue.transform.centerPoint;(function(Fe,Ne,ze,We){mf(Fe,Ne-1,ze-10,2,20,We),mf(Fe,Ne-10,ze-1,20,2,We)})(ue,Ce.x,ue.transform.height-Ce.y,jc)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(l){if(!this.style||!this.style.map||!this.style.map.terrain)return;const f=this.terrainFacilitator.matrix,v=this.transform.modelViewProjectionMatrix;let w=this.terrainFacilitator.dirty;w||(w=l?!s.cj(f,v):!s.ck(f,v)),w||(w=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),w&&(s.cl(f,v),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(I,k){const B=I.context,W=B.gl,Z=I.transform,J=zn.unblended,he=new Ki(W.LEQUAL,Ki.ReadWrite,[0,1]),ue=k.tileManager.getRenderableTiles(),_e=I.useProgram("terrainDepth");B.bindFramebuffer.set(k.getFramebuffer("depth").framebuffer),B.viewport.set([0,0,I.width/devicePixelRatio,I.height/devicePixelRatio]),B.clear({color:s.bp.transparent,depth:1});for(const Ce of ue){const Fe=k.getTerrainMesh(Ce.tileID),Ne=k.getTerrainData(Ce.tileID),ze=Z.getProjectionData({overscaledTileID:Ce.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),We={u_ele_delta:k.getMeshFrameDelta(Z.zoom)};_e.draw(B,W.TRIANGLES,he,bn.disabled,J,pn.backCCW,We,Ne,ze,"terrain",Fe.vertexBuffer,Fe.indexBuffer,Fe.segments)}B.bindFramebuffer.set(null),B.viewport.set([0,0,I.width,I.height])})(this,this.style.map.terrain),(function(I,k){const B=I.context,W=B.gl,Z=I.transform,J=zn.unblended,he=new Ki(W.LEQUAL,Ki.ReadWrite,[0,1]),ue=k.getCoordsTexture(),_e=k.tileManager.getRenderableTiles(),Ce=I.useProgram("terrainCoords");B.bindFramebuffer.set(k.getFramebuffer("coords").framebuffer),B.viewport.set([0,0,I.width/devicePixelRatio,I.height/devicePixelRatio]),B.clear({color:s.bp.transparent,depth:1}),k.coordsIndex=[];for(const Fe of _e){const Ne=k.getTerrainMesh(Fe.tileID),ze=k.getTerrainData(Fe.tileID);B.activeTexture.set(W.TEXTURE0),W.bindTexture(W.TEXTURE_2D,ue.texture);const We={u_terrain_coords_id:(255-k.coordsIndex.length)/255,u_texture:0,u_ele_delta:k.getMeshFrameDelta(Z.zoom)},tt=Z.getProjectionData({overscaledTileID:Fe.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});Ce.draw(B,W.TRIANGLES,he,bn.disabled,J,pn.backCCW,We,ze,tt,"terrain",Ne.vertexBuffer,Ne.indexBuffer,Ne.segments),k.coordsIndex.push(Fe.tileID.key)}B.bindFramebuffer.set(null),B.viewport.set([0,0,I.width,I.height])})(this,this.style.map.terrain))}renderLayer(l,f,v,w,I){v.isHidden(this.transform.zoom)||(v.type==="background"||v.type==="custom"||(w||[]).length)&&(this.id=v.id,s.cm(v)?(function(k,B,W,Z,J,he){if(k.renderPass!=="translucent")return;const{isRenderingToTexture:ue}=he,_e=bn.disabled,Ce=k.colorModeForRenderPass();(W._unevaluatedLayout.hasValue("text-variable-anchor")||W._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(Fe,Ne,ze,We,tt,je,Qe,at,Ke){const mt=Ne.transform,Lt=Ne.style.map.terrain,Et=tt==="map",At=je==="map";for(const Pt of Fe){const Qt=We.getTile(Pt),ti=Qt.getBucket(ze);if(!ti||!ti.text||!ti.text.segments.get().length)continue;const Xt=s.ay(ti.textSizeData,mt.zoom),si=s.aN(Qt,1,Ne.transform.zoom),Yi=Wi(Et,Ne.transform,si),kn=ze.layout.get("icon-text-fit")!=="none"&&ti.hasIconData();if(Xt){const pr=Math.pow(2,mt.zoom-Qt.tileID.overscaledZ),Jn=Lt?(br,Qn)=>Lt.getElevation(Pt,br,Qn):null;P1(ti,Et,At,Ke,mt,Yi,pr,Xt,kn,s.aO(mt,Qt,Qe,at),Pt.toUnwrapped(),Jn)}}})(Z,k,W,B,W.layout.get("text-rotation-alignment"),W.layout.get("text-pitch-alignment"),W.paint.get("text-translate"),W.paint.get("text-translate-anchor"),J),W.paint.get("icon-opacity").constantOr(1)!==0&&hf(k,B,W,Z,!1,W.paint.get("icon-translate"),W.paint.get("icon-translate-anchor"),W.layout.get("icon-rotation-alignment"),W.layout.get("icon-pitch-alignment"),W.layout.get("icon-keep-upright"),_e,Ce,ue),W.paint.get("text-opacity").constantOr(1)!==0&&hf(k,B,W,Z,!0,W.paint.get("text-translate"),W.paint.get("text-translate-anchor"),W.layout.get("text-rotation-alignment"),W.layout.get("text-pitch-alignment"),W.layout.get("text-keep-upright"),_e,Ce,ue),B.map.showCollisionBoxes&&(Nu(k,B,W,Z,!0),Nu(k,B,W,Z,!1))})(l,f,v,w,this.style.placement.variableOffsets,I):s.cn(v)?(function(k,B,W,Z,J){if(k.renderPass!=="translucent")return;const{isRenderingToTexture:he}=J,ue=W.paint.get("circle-opacity"),_e=W.paint.get("circle-stroke-width"),Ce=W.paint.get("circle-stroke-opacity"),Fe=!W.layout.get("circle-sort-key").isConstant();if(ue.constantOr(1)===0&&(_e.constantOr(1)===0||Ce.constantOr(1)===0))return;const Ne=k.context,ze=Ne.gl,We=k.transform,tt=k.getDepthModeForSublayer(0,Ki.ReadOnly),je=bn.disabled,Qe=k.colorModeForRenderPass(),at=[],Ke=We.getCircleRadiusCorrection();for(let mt=0;mt<Z.length;mt++){const Lt=Z[mt],Et=B.getTile(Lt),At=Et.getBucket(W);if(!At)continue;const Pt=W.paint.get("circle-translate"),Qt=W.paint.get("circle-translate-anchor"),ti=s.aO(We,Et,Pt,Qt),Xt=At.programConfigurations.get(W.id),si=k.useProgram("circle",Xt),Yi=At.layoutVertexBuffer,kn=At.indexBuffer,pr=k.style.map.terrain&&k.style.map.terrain.getTerrainData(Lt),Jn={programConfiguration:Xt,program:si,layoutVertexBuffer:Yi,indexBuffer:kn,uniformValues:Up(k,Et,W,ti,Ke),terrainData:pr,projectionData:We.getProjectionData({overscaledTileID:Lt,applyGlobeMatrix:!he,applyTerrainMatrix:!0})};if(Fe){const br=At.segments.get();for(const Qn of br)at.push({segments:new s.aX([Qn]),sortKey:Qn.sortKey,state:Jn})}else at.push({segments:At.segments,sortKey:0,state:Jn})}Fe&&at.sort(((mt,Lt)=>mt.sortKey-Lt.sortKey));for(const mt of at){const{programConfiguration:Lt,program:Et,layoutVertexBuffer:At,indexBuffer:Pt,uniformValues:Qt,terrainData:ti,projectionData:Xt}=mt.state;Et.draw(Ne,ze.TRIANGLES,tt,je,Qe,pn.backCCW,Qt,ti,Xt,W.id,At,Pt,mt.segments,W.paint,k.transform.zoom,Lt)}})(l,f,v,w,I):s.co(v)?(function(k,B,W,Z,J){if(W.paint.get("heatmap-opacity")===0)return;const he=k.context,{isRenderingToTexture:ue,isRenderingGlobe:_e}=J;if(k.style.map.terrain){for(const Ce of Z){const Fe=B.getTile(Ce);B.hasRenderableParent(Ce)||(k.renderPass==="offscreen"?M0(k,Fe,W,Ce,_e):k.renderPass==="translucent"&&C0(k,W,Ce,ue,_e))}he.viewport.set([0,0,k.width,k.height])}else k.renderPass==="offscreen"?(function(Ce,Fe,Ne,ze){const We=Ce.context,tt=We.gl,je=Ce.transform,Qe=bn.disabled,at=new zn([tt.ONE,tt.ONE],s.bp.transparent,[!0,!0,!0,!0]);(function(Ke,mt,Lt){const Et=Ke.gl;Ke.activeTexture.set(Et.TEXTURE1),Ke.viewport.set([0,0,mt.width/4,mt.height/4]);let At=Lt.heatmapFbos.get(s.cd);At?(Et.bindTexture(Et.TEXTURE_2D,At.colorAttachment.get()),Ke.bindFramebuffer.set(At.framebuffer)):(At=df(Ke,mt.width/4,mt.height/4),Lt.heatmapFbos.set(s.cd,At))})(We,Ce,Ne),We.clear({color:s.bp.transparent});for(let Ke=0;Ke<ze.length;Ke++){const mt=ze[Ke];if(Fe.hasRenderableParent(mt))continue;const Lt=Fe.getTile(mt),Et=Lt.getBucket(Ne);if(!Et)continue;const At=Et.programConfigurations.get(Ne.id),Pt=Ce.useProgram("heatmap",At),Qt=je.getProjectionData({overscaledTileID:mt,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),ti=je.getCircleRadiusCorrection();Pt.draw(We,tt.TRIANGLES,Ki.disabled,Qe,at,pn.backCCW,Bc(Lt,je.zoom,Ne.paint.get("heatmap-intensity"),ti),null,Qt,Ne.id,Et.layoutVertexBuffer,Et.indexBuffer,Et.segments,Ne.paint,je.zoom,At)}We.viewport.set([0,0,Ce.width,Ce.height])})(k,B,W,Z):k.renderPass==="translucent"&&(function(Ce,Fe){const Ne=Ce.context,ze=Ne.gl;Ne.setColorMode(Ce.colorModeForRenderPass());const We=Fe.heatmapFbos.get(s.cd);We&&(Ne.activeTexture.set(ze.TEXTURE0),ze.bindTexture(ze.TEXTURE_2D,We.colorAttachment.get()),Ne.activeTexture.set(ze.TEXTURE1),tm(Ne,Fe).bind(ze.LINEAR,ze.CLAMP_TO_EDGE),Ce.useProgram("heatmapTexture").draw(Ne,ze.TRIANGLES,Ki.disabled,bn.disabled,Ce.colorModeForRenderPass(),pn.disabled,jp(Ce,Fe,0,1),null,null,Fe.id,Ce.viewportBuffer,Ce.quadTriangleIndexBuffer,Ce.viewportSegments,Fe.paint,Ce.transform.zoom))})(k,W)})(l,f,v,w,I):s.cp(v)?(function(k,B,W,Z,J){if(k.renderPass!=="translucent")return;const{isRenderingToTexture:he}=J,ue=W.paint.get("line-opacity"),_e=W.paint.get("line-width");if(ue.constantOr(1)===0||_e.constantOr(1)===0)return;const Ce=k.getDepthModeForSublayer(0,Ki.ReadOnly),Fe=k.colorModeForRenderPass(),Ne=W.paint.get("line-dasharray"),ze=Ne.constantOr(1),We=W.paint.get("line-pattern"),tt=We.constantOr(1),je=W.paint.get("line-gradient"),Qe=W.getCrossfadeParameters();let at;at=tt?"linePattern":ze&&je?"lineGradientSDF":ze?"lineSDF":je?"lineGradient":"line";const Ke=k.context,mt=Ke.gl,Lt=k.transform;let Et=!0;for(const At of Z){const Pt=B.getTile(At);if(tt&&!Pt.patternsLoaded())continue;const Qt=Pt.getBucket(W);if(!Qt)continue;const ti=Qt.programConfigurations.get(W.id),Xt=k.context.program.get(),si=k.useProgram(at,ti),Yi=Et||si.program!==Xt,kn=k.style.map.terrain&&k.style.map.terrain.getTerrainData(At),pr=We.constantOr(null),Jn=Ne&&Ne.constantOr(null);if(pr&&Pt.imageAtlas){const Ps=Pt.imageAtlas,rs=Ps.patternPositions[pr.to.toString()],Zr=Ps.patternPositions[pr.from.toString()];rs&&Zr&&ti.setConstantPatternPositions(rs,Zr)}else if(Jn){const Ps=W.layout.get("line-cap")==="round",rs=k.lineAtlas.getDash(Jn.to,Ps),Zr=k.lineAtlas.getDash(Jn.from,Ps);ti.setConstantDashPositions(rs,Zr)}const br=Lt.getProjectionData({overscaledTileID:At,applyGlobeMatrix:!he,applyTerrainMatrix:!0}),Qn=Lt.getPixelScale();let Br;tt?(Br=Gh(k,Pt,W,Qn,Qe),A0(Ke,mt,Pt,ti,Qe)):ze&&je?(Br=ku(k,Pt,W,Qn,Qe,Qt.lineClipsArray.length),qo(k,B,Ke,mt,W,Qt,At,ti,Qe)):ze?(Br=Wp(k,Pt,W,Qn,Qe),Wr(k,Ke,mt,ti,Yi,Qe)):je?(Br=qp(k,Pt,W,Qn,Qt.lineClipsArray.length),$u(k,B,Ke,mt,W,Qt,At)):Br=Lu(k,Pt,W,Qn);const xr=k.stencilModeForClipping(At);si.draw(Ke,mt.TRIANGLES,Ce,xr,Fe,pn.disabled,Br,kn,br,W.id,Qt.layoutVertexBuffer,Qt.indexBuffer,Qt.segments,W.paint,k.transform.zoom,ti,Qt.layoutVertexBuffer2),Et=!1}})(l,f,v,w,I):s.cq(v)?(function(k,B,W,Z,J){const he=W.paint.get("fill-color"),ue=W.paint.get("fill-opacity");if(ue.constantOr(1)===0)return;const{isRenderingToTexture:_e}=J,Ce=k.colorModeForRenderPass(),Fe=W.paint.get("fill-pattern"),Ne=k.opaquePassEnabledForLayer()&&!Fe.constantOr(1)&&he.constantOr(s.bp.transparent).a===1&&ue.constantOr(0)===1?"opaque":"translucent";if(k.renderPass===Ne){const ze=k.getDepthModeForSublayer(1,k.renderPass==="opaque"?Ki.ReadWrite:Ki.ReadOnly);ff(k,B,W,Z,ze,Ce,!1,_e)}if(k.renderPass==="translucent"&&W.paint.get("fill-antialias")){const ze=k.getDepthModeForSublayer(W.getPaintProperty("fill-outline-color")?2:0,Ki.ReadOnly);ff(k,B,W,Z,ze,Ce,!0,_e)}})(l,f,v,w,I):s.cr(v)?(function(k,B,W,Z,J){const he=W.paint.get("fill-extrusion-opacity");if(he===0)return;const{isRenderingToTexture:ue}=J;if(k.renderPass==="translucent"){const _e=new Ki(k.context.gl.LEQUAL,Ki.ReadWrite,k.depthRangeFor3D);if(he!==1||W.paint.get("fill-extrusion-pattern").constantOr(1))nm(k,B,W,Z,_e,bn.disabled,zn.disabled,ue),nm(k,B,W,Z,_e,k.stencilModeFor3D(),k.colorModeForRenderPass(),ue);else{const Ce=k.colorModeForRenderPass();nm(k,B,W,Z,_e,bn.disabled,Ce,ue)}}})(l,f,v,w,I):s.cs(v)?(function(k,B,W,Z,J){if(k.renderPass!=="offscreen"&&k.renderPass!=="translucent")return;const{isRenderingToTexture:he}=J,ue=k.context,_e=k.style.projection.useSubdivision,Ce=k.getDepthModeForSublayer(0,Ki.ReadOnly),Fe=k.colorModeForRenderPass();if(k.renderPass==="offscreen")(function(Ne,ze,We,tt,je,Qe,at){const Ke=Ne.context,mt=Ke.gl;for(const Lt of We){const Et=ze.getTile(Lt),At=Et.dem;if(!At||!At.data||!Et.needsHillshadePrepare)continue;const Pt=At.dim,Qt=At.stride,ti=At.getPixels();if(Ke.activeTexture.set(mt.TEXTURE1),Ke.pixelStoreUnpackPremultiplyAlpha.set(!1),Et.demTexture=Et.demTexture||Ne.getTileTexture(Qt),Et.demTexture){const si=Et.demTexture;si.update(ti,{premultiply:!1}),si.bind(mt.NEAREST,mt.CLAMP_TO_EDGE)}else Et.demTexture=new s.T(Ke,ti,mt.RGBA,{premultiply:!1}),Et.demTexture.bind(mt.NEAREST,mt.CLAMP_TO_EDGE);Ke.activeTexture.set(mt.TEXTURE0);let Xt=Et.fbo;if(!Xt){const si=new s.T(Ke,{width:Pt,height:Pt,data:null},mt.RGBA);si.bind(mt.LINEAR,mt.CLAMP_TO_EDGE),Xt=Et.fbo=Ke.createFramebuffer(Pt,Pt,!0,!1),Xt.colorAttachment.set(si.texture)}Ke.bindFramebuffer.set(Xt.framebuffer),Ke.viewport.set([0,0,Pt,Pt]),Ne.useProgram("hillshadePrepare").draw(Ke,mt.TRIANGLES,je,Qe,at,pn.disabled,w_(Et.tileID,At),null,null,tt.id,Ne.rasterBoundsBuffer,Ne.quadTriangleIndexBuffer,Ne.rasterBoundsSegments),Et.needsHillshadePrepare=!1}})(k,B,Z,W,Ce,bn.disabled,Fe),ue.viewport.set([0,0,k.width,k.height]);else if(k.renderPass==="translucent")if(_e){const[Ne,ze,We]=k.stencilConfigForOverlapTwoPass(Z);Uc(k,B,W,We,Ne,Ce,Fe,!1,he),Uc(k,B,W,We,ze,Ce,Fe,!0,he)}else{const[Ne,ze]=k.getStencilConfigForOverlapAndUpdateStencilID(Z);Uc(k,B,W,ze,Ne,Ce,Fe,!1,he)}})(l,f,v,w,I):s.ct(v)?(function(k,B,W,Z,J){if(k.renderPass!=="translucent"||!Z.length)return;const{isRenderingToTexture:he}=J,ue=k.style.projection.useSubdivision,_e=k.getDepthModeForSublayer(0,Ki.ReadOnly),Ce=k.colorModeForRenderPass();if(ue){const[Fe,Ne,ze]=k.stencilConfigForOverlapTwoPass(Z);pf(k,B,W,ze,Fe,_e,Ce,!1,he),pf(k,B,W,ze,Ne,_e,Ce,!0,he)}else{const[Fe,Ne]=k.getStencilConfigForOverlapAndUpdateStencilID(Z);pf(k,B,W,Ne,Fe,_e,Ce,!1,he)}})(l,f,v,w,I):s.bU(v)?(function(k,B,W,Z,J){if(k.renderPass!=="translucent"||W.paint.get("raster-opacity")===0||!Z.length)return;const{isRenderingToTexture:he}=J,ue=B.getSource(),_e=k.style.projection.useSubdivision;if(ue instanceof yt)Yh(k,B,W,Z,null,!1,!1,ue.tileCoords,ue.flippedWindingOrder,he);else if(_e){const[Ce,Fe,Ne]=k.stencilConfigForOverlapTwoPass(Z);Yh(k,B,W,Ne,Ce,!1,!0,Vu,!1,he),Yh(k,B,W,Ne,Fe,!0,!0,Vu,!1,he)}else{const[Ce,Fe]=k.getStencilConfigForOverlapAndUpdateStencilID(Z);Yh(k,B,W,Fe,Ce,!1,!0,Vu,!1,he)}})(l,f,v,w,I):s.cu(v)?(function(k,B,W,Z,J){const he=W.paint.get("background-color"),ue=W.paint.get("background-opacity");if(ue===0)return;const{isRenderingToTexture:_e}=J,Ce=k.context,Fe=Ce.gl,Ne=k.style.projection,ze=k.transform,We=ze.tileSize,tt=W.paint.get("background-pattern");if(k.isPatternMissing(tt))return;const je=!tt&&he.a===1&&ue===1&&k.opaquePassEnabledForLayer()?"opaque":"translucent";if(k.renderPass!==je)return;const Qe=bn.disabled,at=k.getDepthModeForSublayer(0,je==="opaque"?Ki.ReadWrite:Ki.ReadOnly),Ke=k.colorModeForRenderPass(),mt=k.useProgram(tt?"backgroundPattern":"background"),Lt=Z||Un(ze,{tileSize:We,terrain:k.style.map.terrain});tt&&(Ce.activeTexture.set(Fe.TEXTURE0),k.imageManager.bind(k.context));const Et=W.getCrossfadeParameters();for(const At of Lt){const Pt=ze.getProjectionData({overscaledTileID:At,applyGlobeMatrix:!_e,applyTerrainMatrix:!0}),Qt=tt?af(ue,k,tt,{tileID:At,tileSize:We},Et):Wh(ue,he),ti=k.style.map.terrain&&k.style.map.terrain.getTerrainData(At),Xt=Ne.getMeshFromTileID(Ce,At.canonical,!1,!0,"raster");mt.draw(Ce,Fe.TRIANGLES,at,Qe,Ke,pn.backCCW,Qt,ti,Pt,W.id,Xt.vertexBuffer,Xt.indexBuffer,Xt.segments)}})(l,0,v,w,I):s.cv(v)&&(function(k,B,W,Z){const{isRenderingGlobe:J}=Z,he=k.context,ue=W.implementation,_e=k.style.projection,Ce=k.transform,Fe=Ce.getProjectionDataForCustomLayer(J),Ne={farZ:Ce.farZ,nearZ:Ce.nearZ,fov:Ce.fov*Math.PI/180,modelViewProjectionMatrix:Ce.modelViewProjectionMatrix,projectionMatrix:Ce.projectionMatrix,shaderData:{variantName:_e.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${_e.shaderPreludeCode.vertexSource}`,define:_e.shaderDefine},defaultProjectionData:Fe},ze=ue.renderingMode?ue.renderingMode:"2d";if(k.renderPass==="offscreen"){const We=ue.prerender;We&&(k.setCustomLayerDefaults(),he.setColorMode(k.colorModeForRenderPass()),We.call(ue,he.gl,Ne),he.setDirty(),k.setBaseState())}else if(k.renderPass==="translucent"){k.setCustomLayerDefaults(),he.setColorMode(k.colorModeForRenderPass()),he.setStencilMode(bn.disabled);const We=ze==="3d"?k.getDepthModeFor3D():k.getDepthModeForSublayer(0,Ki.ReadOnly);he.setDepthMode(We),ue.render(he.gl,Ne),he.setDirty(),k.setBaseState(),he.bindFramebuffer.set(null)}})(l,0,v,I))}saveTileTexture(l){const f=this._tileTextures[l.size[0]];f?f.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const f=this._tileTextures[l];return f&&f.length>0?f.pop():null}isPatternMissing(l){if(!l)return!1;if(!l.from||!l.to)return!0;const f=this.imageManager.getPattern(l.from.toString()),v=this.imageManager.getPattern(l.to.toString());return!f||!v}useProgram(l,f,v=!1,w=[]){this.cache=this.cache||{};const I=!!this.style.map.terrain,k=this.style.projection,B=v?xn.projectionMercator:k.shaderPreludeCode,W=v?Ms:k.shaderDefine,Z=l+(f?f.cacheKey:"")+`/${v?oo:k.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(I?"/terrain":"")+(w?`/${w.join("/")}`:"");return this.cache[Z]||(this.cache[Z]=new $p(this.context,xn[l],f,rc[l],this._showOverdrawInspector,I,B,W,w)),this.cache[Z]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var l,f;if(this._tileTextures){for(const v in this._tileTextures){const w=this._tileTextures[v];if(w)for(const I of w)I.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((l=this.tileExtentMesh.vertexBuffer)===null||l===void 0||l.destroy()),this.tileExtentMesh&&((f=this.tileExtentMesh.indexBuffer)===null||f===void 0||f.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const v in this.cache){const w=this.cache[v];w&&w.program&&this.context.gl.deleteProgram(w.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:l,drawingBufferHeight:f}=this.context.gl;return this.width!==l||this.height!==f}}function k_(A,l){let f,v=!1,w=null,I=null;const k=()=>{w=null,v&&(A.apply(I,f),w=setTimeout(k,l),v=!1)};return(...B)=>(v=!0,I=this,f=B,w||k(),w)}class D_{constructor(l){this._getCurrentHash=()=>{const f=window.location.hash.replace("#","");if(this._hashName){let v;return f.split("&").map((w=>w.split("="))).forEach((w=>{w[0]===this._hashName&&(v=w)})),(v&&v[1]||"").split("/")}return f.split("/")},this._onHashChange=()=>{const f=this._getCurrentHash();if(!this._isValidHash(f))return!1;const v=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(f[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:v,pitch:+(f[4]||0)}),!0},this._updateHashUnthrottled=()=>{const f=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,f)},this._removeHash=()=>{const f=this._getCurrentHash();if(f.length===0)return;const v=f.join("/");let w=v;w.split("&").length>0&&(w=w.split("&")[0]),this._hashName&&(w=`${this._hashName}=${v}`);let I=window.location.hash.replace(w,"");I.startsWith("#&")?I=I.slice(0,1)+I.slice(2):I==="#"&&(I="");let k=window.location.href.replace(/(#.+)?$/,I);k=k.replace("&&","&"),window.history.replaceState(window.history.state,null,k)},this._updateHash=k_(this._updateHashUnthrottled,300),this._hashName=l&&encodeURIComponent(l)}addTo(l){return this._map=l,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(l){const f=this._map.getCenter(),v=Math.round(100*this._map.getZoom())/100,w=Math.ceil((v*Math.LN2+Math.log(512/360/.5))/Math.LN10),I=Math.pow(10,w),k=Math.round(f.lng*I)/I,B=Math.round(f.lat*I)/I,W=this._map.getBearing(),Z=this._map.getPitch();let J="";if(J+=l?`/${k}/${B}/${v}`:`${v}/${B}/${k}`,(W||Z)&&(J+="/"+Math.round(10*W)/10),Z&&(J+=`/${Math.round(Z)}`),this._hashName){const he=this._hashName;let ue=!1;const _e=window.location.hash.slice(1).split("&").map((Ce=>{const Fe=Ce.split("=")[0];return Fe===he?(ue=!0,`${Fe}=${J}`):Ce})).filter((Ce=>Ce));return ue||_e.push(`${he}=${J}`),`#${_e.join("&")}`}return`#${J}`}_isValidHash(l){if(l.length<3||l.some(isNaN))return!1;try{new s.V(+l[2],+l[1])}catch{return!1}const f=+l[0],v=+(l[3]||0),w=+(l[4]||0);return f>=this._map.getMinZoom()&&f<=this._map.getMaxZoom()&&v>=-180&&v<=180&&w>=this._map.getMinPitch()&&w<=this._map.getMaxPitch()}}const Gc={linearity:.3,easing:s.cw(0,0,.3,1)},O0=s.e({deceleration:2500,maxSpeed:1400},Gc),ua=s.e({deceleration:20,maxSpeed:1400},Gc),Fa=s.e({deceleration:1e3,maxSpeed:360},Gc),z0=s.e({deceleration:1e3,maxSpeed:90},Gc),Oa=s.e({deceleration:1e3,maxSpeed:360},Gc);class I1{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:P(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,f=P();for(;l.length>0&&f-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const f={zoom:0,bearing:0,pitch:0,roll:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:I}of this._inertiaBuffer)f.zoom+=I.zoomDelta||0,f.bearing+=I.bearingDelta||0,f.pitch+=I.pitchDelta||0,f.roll+=I.rollDelta||0,I.panDelta&&f.pan._add(I.panDelta),I.around&&(f.around=I.around),I.pinchAround&&(f.pinchAround=I.pinchAround);const v=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,w={};if(f.pan.mag()){const I=_f(f.pan.mag(),v,s.e({},O0,l||{})),k=f.pan.mult(I.amount/f.pan.mag()),B=this._map.cameraHelper.handlePanInertia(k,this._map.transform);w.center=B.easingCenter,w.offset=B.easingOffset,gf(w,I)}if(f.zoom){const I=_f(f.zoom,v,ua);w.zoom=this._map.transform.zoom+I.amount,gf(w,I)}if(f.bearing){const I=_f(f.bearing,v,Fa);w.bearing=this._map.transform.bearing+s.an(I.amount,-179,179),gf(w,I)}if(f.pitch){const I=_f(f.pitch,v,z0);w.pitch=this._map.transform.pitch+I.amount,gf(w,I)}if(f.roll){const I=_f(f.roll,v,Oa);w.roll=this._map.transform.roll+s.an(I.amount,-179,179),gf(w,I)}if(w.zoom||w.bearing){const I=f.pinchAround===void 0?f.around:f.pinchAround;w.around=I?this._map.unproject(I):this._map.getCenter()}return this.clear(),s.e(w,{noMoveStart:!0})}}function gf(A,l){(!A.duration||A.duration<l.duration)&&(A.duration=l.duration,A.easing=l.easing)}function _f(A,l,f){const{maxSpeed:v,linearity:w,deceleration:I}=f,k=s.an(A*w/(l/1e3),-v,v),B=Math.abs(k)/(I*w);return{easing:f.easing,duration:1e3*B,amount:k*(B/2)}}class As extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,v,w={}){v=v instanceof MouseEvent?v:new MouseEvent(l,v);const I=L.mousePos(f.getCanvas(),v),k=f.unproject(I);super(l,s.e({point:I,lngLat:k,originalEvent:v},w)),this._defaultPrevented=!1,this.target=f}}class vf extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,v){const w=l==="touchend"?v.changedTouches:v.touches,I=L.touchPos(f.getCanvasContainer(),w),k=I.map((W=>f.unproject(W))),B=I.reduce(((W,Z,J,he)=>W.add(Z.div(he.length))),new s.P(0,0));super(l,{points:I,point:B,lngLats:k,lngLat:f.unproject(B),originalEvent:v}),this._defaultPrevented=!1}}class B0 extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,v){super(l,{originalEvent:v}),this._defaultPrevented=!1}}class R1{constructor(l,f){this._map=l,this._clickTolerance=f.clickTolerance}reset(){delete this._mousedownPos}wheel(l){return this._firePreventable(new B0(l.type,this._map,l))}mousedown(l,f){return this._mousedownPos=f,this._firePreventable(new As(l.type,this._map,l))}mouseup(l){this._map.fire(new As(l.type,this._map,l))}click(l,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new As(l.type,this._map,l))}dblclick(l){return this._firePreventable(new As(l.type,this._map,l))}mouseover(l){this._map.fire(new As(l.type,this._map,l))}mouseout(l){this._map.fire(new As(l.type,this._map,l))}touchstart(l){return this._firePreventable(new vf(l.type,this._map,l))}touchmove(l){this._map.fire(new vf(l.type,this._map,l))}touchend(l){this._map.fire(new vf(l.type,this._map,l))}touchcancel(l){this._map.fire(new vf(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class L1{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(l){this._map.fire(new As(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new As("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._ignoreContextMenu||this._map.fire(new As(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Kh{constructor(l){this._map=l}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(l){return this.transform.screenPointToLocation(s.P.convert(l),this._map.terrain)}}class Jh{constructor(l,f){this._map=l,this._tr=new Kh(l),this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,f){this.isEnabled()&&l.shiftKey&&l.button===0&&(L.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(l,f){if(!this._active)return;const v=f;if(this._lastPos.equals(v)||!this._box&&v.dist(this._startPos)<this._clickTolerance)return;const w=this._startPos;this._lastPos=v,this._box||(this._box=L.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",l));const I=Math.min(w.x,v.x),k=Math.max(w.x,v.x),B=Math.min(w.y,v.y),W=Math.max(w.y,v.y);L.setTransform(this._box,`translate(${I}px,${B}px)`),this._box.style.width=k-I+"px",this._box.style.height=W-B+"px"}mouseupWindow(l,f){if(!this._active||l.button!==0)return;const v=this._startPos,w=f;if(this.reset(),L.suppressClick(),v.x!==w.x||v.y!==w.y)return this._map.fire(new s.l("boxzoomend",{originalEvent:l})),{cameraAnimation:I=>I.fitScreenCoordinates(v,w,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",l)}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(L.remove(this._box),this._box=null),L.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(l,f){return this._map.fire(new s.l(l,{originalEvent:f}))}}function za(A,l){if(A.length!==l.length)throw new Error(`The number of touches and points are not equal - touches ${A.length}, points ${l.length}`);const f={};for(let v=0;v<A.length;v++)f[A[v].identifier]=l[v];return f}class mi{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(l,f,v){(this.centroid||v.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),v.length===this.numTouches&&(this.centroid=(function(w){const I=new s.P(0,0);for(const k of w)I._add(k);return I.div(w.length)})(f),this.touches=za(v,f)))}touchmove(l,f,v){if(this.aborted||!this.centroid)return;const w=za(v,f);for(const I in this.touches){const k=w[I];(!k||k.dist(this.touches[I])>30)&&(this.aborted=!0)}}touchend(l,f,v){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),v.length===0){const w=!this.aborted&&this.centroid;if(this.reset(),w)return w}}}class rm{constructor(l){this.singleTap=new mi(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(l,f,v){this.singleTap.touchstart(l,f,v)}touchmove(l,f,v){this.singleTap.touchmove(l,f,v)}touchend(l,f,v){const w=this.singleTap.touchend(l,f,v);if(w){const I=l.timeStamp-this.lastTime<500,k=!this.lastTap||this.lastTap.dist(w)<30;if(I&&k||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=w,this.count===this.numTaps)return this.reset(),w}}}class F_{constructor(l){this._tr=new Kh(l),this._zoomIn=new rm({numTouches:1,numTaps:2}),this._zoomOut=new rm({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,f,v){this._zoomIn.touchstart(l,f,v),this._zoomOut.touchstart(l,f,v)}touchmove(l,f,v){this._zoomIn.touchmove(l,f,v),this._zoomOut.touchmove(l,f,v)}touchend(l,f,v){const w=this._zoomIn.touchend(l,f,v),I=this._zoomOut.touchend(l,f,v),k=this._tr;return w?(this._active=!0,l.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:B=>B.easeTo({duration:300,zoom:k.zoom+1,around:k.unproject(w)},{originalEvent:l})}):I?(this._active=!0,l.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:B=>B.easeTo({duration:300,zoom:k.zoom-1,around:k.unproject(I)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qh{constructor(l){this._enabled=!!l.enable,this._moveStateManager=l.moveStateManager,this._clickTolerance=l.clickTolerance||1,this._moveFunction=l.move,this._activateOnStart=!!l.activateOnStart,l.assignEvents(this),this.reset()}reset(l){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(l)}_move(...l){const f=this._moveFunction(...l);if(f.bearingDelta||f.pitchDelta||f.rollDelta||f.around||f.panDelta)return this._active=!0,f}dragStart(l,f){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(l)&&(this._moveStateManager.startMove(l),this._lastPoint=Array.isArray(f)?f[0]:f,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(l,f){if(!this.isEnabled())return;const v=this._lastPoint;if(!v)return;if(l.preventDefault(),!this._moveStateManager.isValidMoveEvent(l))return void this.reset(l);const w=Array.isArray(f)?f[0]:f;return!this._moved&&w.dist(v)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=w,this._move(v,w))}dragEnd(l){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(l)&&(this._moved&&L.suppressClick(),this.reset(l))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const yf=0,bf=2,O_={[yf]:1,[bf]:2};class xf{constructor(l){this._correctEvent=l.checkCorrectEvent}startMove(l){const f=L.mouseButton(l);this._eventButton=f}endMove(l){delete this._eventButton}isValidStartEvent(l){return this._correctEvent(l)}isValidMoveEvent(l){return!(function(f,v){const w=O_[v];return f.buttons===void 0||(f.buttons&w)!==w})(l,this._eventButton)}isValidEndEvent(l){return L.mouseButton(l)===this._eventButton}}class z_{constructor(){this._firstTouch=void 0}_isOneFingerTouch(l){return l.targetTouches.length===1}_isSameTouchEvent(l){return l.targetTouches[0].identifier===this._firstTouch}startMove(l){this._firstTouch=l.targetTouches[0].identifier}endMove(l){delete this._firstTouch}isValidStartEvent(l){return this._isOneFingerTouch(l)}isValidMoveEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}isValidEndEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}}class N0{constructor(l=new xf({checkCorrectEvent:()=>!0}),f=new z_){this.mouseMoveStateManager=l,this.oneFingerTouchMoveStateManager=f}_executeRelevantHandler(l,f,v){return l instanceof MouseEvent?f(l):typeof TouchEvent<"u"&&l instanceof TouchEvent?v(l):void 0}startMove(l){this._executeRelevantHandler(l,(f=>this.mouseMoveStateManager.startMove(f)),(f=>this.oneFingerTouchMoveStateManager.startMove(f)))}endMove(l){this._executeRelevantHandler(l,(f=>this.mouseMoveStateManager.endMove(f)),(f=>this.oneFingerTouchMoveStateManager.endMove(f)))}isValidStartEvent(l){return this._executeRelevantHandler(l,(f=>this.mouseMoveStateManager.isValidStartEvent(f)),(f=>this.oneFingerTouchMoveStateManager.isValidStartEvent(f)))}isValidMoveEvent(l){return this._executeRelevantHandler(l,(f=>this.mouseMoveStateManager.isValidMoveEvent(f)),(f=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(f)))}isValidEndEvent(l){return this._executeRelevantHandler(l,(f=>this.mouseMoveStateManager.isValidEndEvent(f)),(f=>this.oneFingerTouchMoveStateManager.isValidEndEvent(f)))}}const ed=A=>{A.mousedown=A.dragStart,A.mousemoveWindow=A.dragMove,A.mouseup=A.dragEnd,A.contextmenu=l=>{l.preventDefault()}};class k1{constructor(l,f){this._clickTolerance=l.clickTolerance||1,this._map=f,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}_shouldBePrevented(l){return l<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(l,f,v){return this._calculateTransform(l,f,v)}touchmove(l,f,v){if(this._active){if(!this._shouldBePrevented(v.length))return l.preventDefault(),this._calculateTransform(l,f,v);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",l)}}touchend(l,f,v){this._calculateTransform(l,f,v),this._active&&this._shouldBePrevented(v.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,f,v){v.length>0&&(this._active=!0);const w=za(v,f),I=new s.P(0,0),k=new s.P(0,0);let B=0;for(const Z in w){const J=w[Z],he=this._touches[Z];he&&(I._add(J),k._add(J.sub(he)),B++,w[Z]=J)}if(this._touches=w,this._shouldBePrevented(B)||!k.mag())return;const W=k.div(B);return this._sum._add(W),this._sum.mag()<this._clickTolerance?void 0:{around:I.div(B),panDelta:W}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sm{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(l,f,v){this._firstTwoTouches||v.length<2||(this._firstTwoTouches=[v[0].identifier,v[1].identifier],this._start([f[0],f[1]]))}touchmove(l,f,v){if(!this._firstTwoTouches)return;l.preventDefault();const[w,I]=this._firstTwoTouches,k=om(v,f,w),B=om(v,f,I);if(!k||!B)return;const W=this._aroundCenter?null:k.add(B).div(2);return this._move([k,B],W,l)}touchend(l,f,v){if(!this._firstTwoTouches)return;const[w,I]=this._firstTwoTouches,k=om(v,f,w),B=om(v,f,I);k&&B||(this._active&&L.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function om(A,l,f){for(let v=0;v<A.length;v++)if(A[v].identifier===f)return l[v]}function $0(A,l){return Math.log(A/l)/Math.LN2}class B_ extends sm{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,f){const v=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs($0(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:$0(this._distance,v),pinchAround:f}}}function V0(A,l){return 180*A.angleWith(l)/Math.PI}class N_ extends sm{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,f,v){const w=this._vector;if(this._vector=l[0].sub(l[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:V0(this._vector,w),pinchAround:f}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const f=25/(Math.PI*this._minDiameter)*360,v=V0(l,this._startVector);return Math.abs(v)<f}}function $_(A){return Math.abs(A.y)>Math.abs(A.x)}class U0 extends sm{constructor(l){super(),this._currentTouchCount=0,this._map=l}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(l,f,v){super.touchstart(l,f,v),this._currentTouchCount=v.length}_start(l){this._lastPoints=l,$_(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,f,v){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const w=l[0].sub(this._lastPoints[0]),I=l[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(w,I,v.timeStamp),this._valid?(this._lastPoints=l,this._active=!0,{pitchDelta:(w.y+I.y)/2*-.5}):void 0}gestureBeginsVertically(l,f,v){if(this._valid!==void 0)return this._valid;const w=l.mag()>=2,I=f.mag()>=2;if(!w&&!I)return;if(!w||!I)return this._firstMove===void 0&&(this._firstMove=v),v-this._firstMove<100&&void 0;const k=l.y>0==f.y>0;return $_(l)&&$_(f)&&k}}const qc={panStep:100,bearingStep:15,pitchStep:10};class qn{constructor(l){this._tr=new Kh(l);const f=qc;this._panStep=f.panStep,this._bearingStep=f.bearingStep,this._pitchStep=f.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let f=0,v=0,w=0,I=0,k=0;switch(l.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:l.shiftKey?v=-1:(l.preventDefault(),I=-1);break;case 39:l.shiftKey?v=1:(l.preventDefault(),I=1);break;case 38:l.shiftKey?w=1:(l.preventDefault(),k=-1);break;case 40:l.shiftKey?w=-1:(l.preventDefault(),k=1);break;default:return}return this._rotationDisabled&&(v=0,w=0),{cameraAnimation:B=>{const W=this._tr;B.easeTo({duration:300,easeId:"keyboardHandler",easing:D1,zoom:f?Math.round(W.zoom)+f*(l.shiftKey?2:1):W.zoom,bearing:W.bearing+v*this._bearingStep,pitch:W.pitch+w*this._pitchStep,offset:[-I*this._panStep,-k*this._panStep],center:W.center},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function D1(A){return A*(2-A)}const wf=4.000244140625,am=1/450;class lm{constructor(l,f){this._onTimeout=v=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(v)},this._map=l,this._tr=new Kh(l),this._triggerRenderFrame=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=am}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(l){return!!this._map.cooperativeGestures.isEnabled()&&!(l.ctrlKey||this._map.cooperativeGestures.isBypassed(l))}wheel(l){if(!this.isEnabled())return;if(this._shouldBePrevented(l))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",l);let f=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const v=P(),w=v-(this._lastWheelEventTime||0);this._lastWheelEventTime=v,f!==0&&f%wf==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":w>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(w*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),l.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=l,this._delta-=f,this._active||this._start(l)),l.preventDefault()}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=L.mousePos(this._map.getCanvas(),l),v=this._tr;this._aroundPoint=this._aroundCenter?v.transform.locationToScreenPoint(s.V.convert(v.center)):f,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const B=l.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=B),typeof this._targetZoom=="number"&&(this._targetZoom+=B)}if(this._delta!==0){const B=this._type==="wheel"&&Math.abs(this._delta)>wf?this._wheelZoomRate:this._defaultZoomRate;let W=2/(1+Math.exp(-Math.abs(this._delta*B)));this._delta<0&&W!==0&&(W=1/W);const Z=typeof this._targetZoom!="number"?l.scale:s.aq(this._targetZoom);this._targetZoom=l.applyConstrain(l.getCameraLngLat(),s.at(Z*W)).zoom,this._type==="wheel"&&(this._startZoom=l.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const f=typeof this._targetZoom!="number"?l.zoom:this._targetZoom,v=this._startZoom,w=this._easing;let I,k=!1;if(this._type==="wheel"&&v&&w){const B=P()-this._lastWheelEventTime,W=Math.min((B+5)/200,1),Z=w(W);I=s.G.number(v,f,Z),W<1?this._frameId||(this._frameId=!0):k=!0}else I=f,k=!0;return this._active=!0,k&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=I,{noInertia:!0,needsRenderFrame:!k,zoomDelta:I-l.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let f=s.cy;if(this._prevEase){const v=this._prevEase,w=(P()-v.start)/v.duration,I=v.easing(w+.01)-v.easing(w),k=.27/Math.sqrt(I*I+1e-4)*.01,B=Math.sqrt(.0729-k*k);f=s.cw(k,B,.25,1)}return this._prevEase={start:P(),duration:l,easing:f},f}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class V_{constructor(l,f){this._clickZoom=l,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class j0{constructor(l){this._tr=new Kh(l),this.reset()}reset(){this._active=!1}dblclick(l,f){return l.preventDefault(),{cameraAnimation:v=>{v.easeTo({duration:300,zoom:this._tr.zoom+(l.shiftKey?-1:1),around:this._tr.unproject(f)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class G0{constructor(){this._tap=new rm({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(l,f,v){if(!this._swipePoint)if(this._tapTime){const w=f[0],I=l.timeStamp-this._tapTime<500,k=this._tapPoint.dist(w)<30;I&&k?v.length>0&&(this._swipePoint=w,this._swipeTouch=v[0].identifier):this.reset()}else this._tap.touchstart(l,f,v)}touchmove(l,f,v){if(this._tapTime){if(this._swipePoint){if(v[0].identifier!==this._swipeTouch)return;const w=f[0],I=w.y-this._swipePoint.y;return this._swipePoint=w,l.preventDefault(),this._active=!0,{zoomDelta:I/128}}}else this._tap.touchmove(l,f,v)}touchend(l,f,v){if(this._tapTime)this._swipePoint&&v.length===0&&this.reset();else{const w=this._tap.touchend(l,f,v);w&&(this._tapTime=l.timeStamp,this._tapPoint=w)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class q0{constructor(l,f,v){this._el=l,this._mousePan=f,this._touchPan=v}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ba{constructor(l,f,v,w){this._pitchWithRotate=l.pitchWithRotate,this._rollEnabled=l.rollEnabled,this._mouseRotate=f,this._mousePitch=v,this._mouseRoll=w}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Sf{constructor(l,f,v,w){this._el=l,this._touchZoom=f,this._touchRotate=v,this._tapDragZoom=w,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Mi{constructor(l,f){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=l,this._options=f,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const l=this._map.getCanvasContainer();l.classList.add("maplibregl-cooperative-gestures"),this._container=L.create("div","maplibregl-cooperative-gesture-screen",l);let f=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(f=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const v=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),w=document.createElement("div");w.className="maplibregl-desktop-message",w.textContent=f,this._container.appendChild(w);const I=document.createElement("div");I.className="maplibregl-mobile-message",I.textContent=v,this._container.appendChild(I),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(L.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(l){return l[this._bypassKey]}notifyGestureBlocked(l,f){this._enabled&&(this._map.fire(new s.l("cooperativegestureprevented",{gestureType:l,originalEvent:f})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const Fi=A=>A.zoom||A.drag||A.roll||A.pitch||A.rotate;class Tf extends s.l{}function cm(A){return A.panDelta&&A.panDelta.mag()||A.zoomDelta||A.bearingDelta||A.pitchDelta||A.rollDelta}class um{constructor(l,f){this.handleWindowEvent=w=>{this.handleEvent(w,`${w.type}Window`)},this.handleEvent=(w,I)=>{if(w.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const k=w.type==="renderFrame"?void 0:w,B={needsRenderFrame:!1},W={},Z={};for(const{handlerName:ue,handler:_e,allowed:Ce}of this._handlers){if(!_e.isEnabled())continue;let Fe;if(this._blockedByActive(Z,Ce,ue))_e.reset();else if(_e[I||w.type]){if(s.cz(w,I||w.type)){const Ne=L.mousePos(this._map.getCanvas(),w);Fe=_e[I||w.type](w,Ne)}else if(s.cA(w,I||w.type)){const Ne=this._getMapTouches(w.touches),ze=L.touchPos(this._map.getCanvas(),Ne);Fe=_e[I||w.type](w,ze,Ne)}else s.cB(I||w.type)||(Fe=_e[I||w.type](w));this.mergeHandlerResult(B,W,Fe,ue,k),Fe&&Fe.needsRenderFrame&&this._triggerRenderFrame()}(Fe||_e.isActive())&&(Z[ue]=_e)}const J={};for(const ue in this._previousActiveHandlers)Z[ue]||(J[ue]=k);this._previousActiveHandlers=Z,(Object.keys(J).length||cm(B))&&(this._changes.push([B,W,J]),this._triggerRenderFrame()),(Object.keys(Z).length||cm(B))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:he}=B;he&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],he(this._map))},this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new I1(l),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f);const v=this._el;this._listeners=[[v,"touchstart",{passive:!0}],[v,"touchmove",{passive:!1}],[v,"touchend",void 0],[v,"touchcancel",void 0],[v,"mousedown",void 0],[v,"mousemove",void 0],[v,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[v,"mouseover",void 0],[v,"mouseout",void 0],[v,"dblclick",void 0],[v,"click",void 0],[v,"keydown",{capture:!1}],[v,"keyup",void 0],[v,"wheel",{passive:!1}],[v,"contextmenu",void 0],[window,"blur",void 0]];for(const[w,I,k]of this._listeners)L.addEventListener(w,I,w===document?this.handleWindowEvent:this.handleEvent,k)}destroy(){for(const[l,f,v]of this._listeners)L.removeEventListener(l,f,l===document?this.handleWindowEvent:this.handleEvent,v)}_addDefaultHandlers(l){const f=this._map,v=f.getCanvasContainer();this._add("mapEvent",new R1(f,l));const w=f.boxZoom=new Jh(f,l);this._add("boxZoom",w),l.interactive&&l.boxZoom&&w.enable();const I=f.cooperativeGestures=new Mi(f,l.cooperativeGestures);this._add("cooperativeGestures",I),l.cooperativeGestures&&I.enable();const k=new F_(f),B=new j0(f);f.doubleClickZoom=new V_(B,k),this._add("tapZoom",k),this._add("clickZoom",B),l.interactive&&l.doubleClickZoom&&f.doubleClickZoom.enable();const W=new G0;this._add("tapDragZoom",W);const Z=f.touchPitch=new U0(f);this._add("touchPitch",Z),l.interactive&&l.touchPitch&&f.touchPitch.enable(l.touchPitch);const J=()=>f.project(f.getCenter()),he=(function({enable:je,clickTolerance:Qe,aroundCenter:at=!0,minPixelCenterThreshold:Ke=100,rotateDegreesPerPixelMoved:mt=.8},Lt){const Et=new xf({checkCorrectEvent:At=>L.mouseButton(At)===0&&At.ctrlKey||L.mouseButton(At)===2&&!At.ctrlKey});return new Qh({clickTolerance:Qe,move:(At,Pt)=>{const Qt=Lt();if(at&&Math.abs(Qt.y-At.y)>Ke)return{bearingDelta:s.cx(new s.P(At.x,Pt.y),Pt,Qt)};let ti=(Pt.x-At.x)*mt;return at&&Pt.y<Qt.y&&(ti=-ti),{bearingDelta:ti}},moveStateManager:Et,enable:je,assignEvents:ed})})(l,J),ue=(function({enable:je,clickTolerance:Qe,pitchDegreesPerPixelMoved:at=-.5}){const Ke=new xf({checkCorrectEvent:mt=>L.mouseButton(mt)===0&&mt.ctrlKey||L.mouseButton(mt)===2});return new Qh({clickTolerance:Qe,move:(mt,Lt)=>({pitchDelta:(Lt.y-mt.y)*at}),moveStateManager:Ke,enable:je,assignEvents:ed})})(l),_e=(function({enable:je,clickTolerance:Qe,rollDegreesPerPixelMoved:at=.3},Ke){const mt=new xf({checkCorrectEvent:Lt=>L.mouseButton(Lt)===2&&Lt.ctrlKey});return new Qh({clickTolerance:Qe,move:(Lt,Et)=>{const At=Ke();let Pt=(Et.x-Lt.x)*at;return Et.y<At.y&&(Pt=-Pt),{rollDelta:Pt}},moveStateManager:mt,enable:je,assignEvents:ed})})(l,J);f.dragRotate=new Ba(l,he,ue,_e),this._add("mouseRotate",he,["mousePitch"]),this._add("mousePitch",ue,["mouseRotate","mouseRoll"]),this._add("mouseRoll",_e,["mousePitch"]),l.interactive&&l.dragRotate&&f.dragRotate.enable();const Ce=(function({enable:je,clickTolerance:Qe}){const at=new xf({checkCorrectEvent:Ke=>L.mouseButton(Ke)===0&&!Ke.ctrlKey});return new Qh({clickTolerance:Qe,move:(Ke,mt)=>({around:mt,panDelta:mt.sub(Ke)}),activateOnStart:!0,moveStateManager:at,enable:je,assignEvents:ed})})(l),Fe=new k1(l,f);f.dragPan=new q0(v,Ce,Fe),this._add("mousePan",Ce),this._add("touchPan",Fe,["touchZoom","touchRotate"]),l.interactive&&l.dragPan&&f.dragPan.enable(l.dragPan);const Ne=new N_,ze=new B_;f.touchZoomRotate=new Sf(v,ze,Ne,W),this._add("touchRotate",Ne,["touchPan","touchZoom"]),this._add("touchZoom",ze,["touchPan","touchRotate"]),l.interactive&&l.touchZoomRotate&&f.touchZoomRotate.enable(l.touchZoomRotate),this._add("blockableMapEvent",new L1(f));const We=f.scrollZoom=new lm(f,(()=>this._triggerRenderFrame()));this._add("scrollZoom",We,["mousePan"]),l.interactive&&l.scrollZoom&&f.scrollZoom.enable(l.scrollZoom);const tt=f.keyboard=new qn(f);this._add("keyboard",tt),l.interactive&&l.keyboard&&f.keyboard.enable()}_add(l,f,v){this._handlers.push({handlerName:l,handler:f,allowed:v}),this._handlersById[l]=f}stop(l){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Fi(this._eventsInProgress)||this.isZooming()}_blockedByActive(l,f,v){for(const w in l)if(w!==v&&(!f||f.indexOf(w)<0))return!0;return!1}_getMapTouches(l){const f=[];for(const v of l)this._el.contains(v.target)&&f.push(v);return f}mergeHandlerResult(l,f,v,w,I){if(!v)return;s.e(l,v);const k={handlerName:w,originalEvent:v.originalEvent||I};v.zoomDelta!==void 0&&(f.zoom=k),v.panDelta!==void 0&&(f.drag=k),v.rollDelta!==void 0&&(f.roll=k),v.pitchDelta!==void 0&&(f.pitch=k),v.bearingDelta!==void 0&&(f.rotate=k)}_applyChanges(){const l={},f={},v={};for(const[w,I,k]of this._changes)w.panDelta&&(l.panDelta=(l.panDelta||new s.P(0,0))._add(w.panDelta)),w.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+w.zoomDelta),w.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+w.bearingDelta),w.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+w.pitchDelta),w.rollDelta&&(l.rollDelta=(l.rollDelta||0)+w.rollDelta),w.around!==void 0&&(l.around=w.around),w.pinchAround!==void 0&&(l.pinchAround=w.pinchAround),w.noInertia&&(l.noInertia=w.noInertia),s.e(f,I),s.e(v,k);this._updateMapTransform(l,f,v),this._changes=[]}_updateMapTransform(l,f,v){const w=this._map,I=w._getTransformForUpdate(),k=w.terrain;if(!(cm(l)||k&&this._terrainMovement))return this._fireEvents(f,v,!0);w._stop(!0);let{panDelta:B,zoomDelta:W,bearingDelta:Z,pitchDelta:J,rollDelta:he,around:ue,pinchAround:_e}=l;_e!==void 0&&(ue=_e),ue=ue||w.transform.centerPoint,k&&!I.isPointOnMapSurface(ue)&&(ue=I.centerPoint);const Ce={panDelta:B,zoomDelta:W,rollDelta:he,pitchDelta:J,bearingDelta:Z,around:ue};this._map.cameraHelper.useGlobeControls&&!I.isPointOnMapSurface(ue)&&(ue=I.centerPoint);const Fe=ue.distSqr(I.centerPoint)<.01?I.center:I.screenPointToLocation(B?ue.sub(B):ue);this._handleMapControls({terrain:k,tr:I,deltasForHelper:Ce,preZoomAroundLoc:Fe,combinedEventsInProgress:f,panDelta:B}),w._applyUpdatedTransform(I),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(f,v,!0)}_handleMapControls({terrain:l,tr:f,deltasForHelper:v,preZoomAroundLoc:w,combinedEventsInProgress:I,panDelta:k}){const B=this._map.cameraHelper;if(B.handleMapControlsRollPitchBearingZoom(v,f),l)return B.useGlobeControls?(this._terrainMovement||!I.drag&&!I.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void B.handleMapControlsPan(v,f,w)):this._terrainMovement||!I.drag&&!I.zoom?void(I.drag&&this._terrainMovement&&k?f.setCenter(f.screenPointToLocation(f.centerPoint.sub(k))):B.handleMapControlsPan(v,f,w)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void B.handleMapControlsPan(v,f,w));B.handleMapControlsPan(v,f,w)}_fireEvents(l,f,v){const w=Fi(this._eventsInProgress),I=Fi(l),k={};for(const he in l){const{originalEvent:ue}=l[he];this._eventsInProgress[he]||(k[`${he}start`]=ue),this._eventsInProgress[he]=l[he]}!w&&I&&this._fireEvent("movestart",I.originalEvent);for(const he in k)this._fireEvent(he,k[he]);I&&this._fireEvent("move",I.originalEvent);for(const he in l){const{originalEvent:ue}=l[he];this._fireEvent(he,ue)}const B={};let W;for(const he in this._eventsInProgress){const{handlerName:ue,originalEvent:_e}=this._eventsInProgress[he];this._handlersById[ue].isActive()||(delete this._eventsInProgress[he],W=f[ue]||_e,B[`${he}end`]=W)}for(const he in B)this._fireEvent(he,B[he]);const Z=Fi(this._eventsInProgress),J=(w||I)&&!Z;if(J&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const he=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&he.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(he)}if(v&&J){this._updatingCamera=!0;const he=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ue=_e=>_e!==0&&-this._bearingSnap<_e&&_e<this._bearingSnap;!he||!he.essential&&b.prefersReducedMotion?(this._map.fire(new s.l("moveend",{originalEvent:W})),ue(this._map.getBearing())&&this._map.resetNorth()):(ue(he.bearing||this._map.getBearing())&&(he.bearing=0),he.freezeElevation=!0,this._map.easeTo(he,{originalEvent:W})),this._updatingCamera=!1}}_fireEvent(l,f){this._map.fire(new s.l(l,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((l=>{delete this._frameId,this.handleEvent(new Tf("renderFrame",{timeStamp:l})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class lo extends s.E{constructor(l,f,v){super(),this._renderFrameCallback=()=>{const w=Math.min((P()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(w)),w<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=v.bearingSnap,this.cameraHelper=f,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(l,f){l.apply(this.transform),this.transform=l,this.cameraHelper=f}getCenter(){return new s.V(this.transform.center.lng,this.transform.center.lat)}setCenter(l,f){return this.jumpTo({center:l},f)}getCenterElevation(){return this.transform.elevation}setCenterElevation(l,f){return this.jumpTo({elevation:l},f),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(l){this._centerClampedToGround=l}panBy(l,f,v){return l=s.P.convert(l).mult(-1),this.panTo(this.transform.center,s.e({offset:l},f),v)}panTo(l,f,v){return this.easeTo(s.e({center:l},f),v)}getZoom(){return this.transform.zoom}setZoom(l,f){return this.jumpTo({zoom:l},f),this}zoomTo(l,f,v){return this.easeTo(s.e({zoom:l},f),v)}zoomIn(l,f){return this.zoomTo(this.getZoom()+1,l,f),this}zoomOut(l,f){return this.zoomTo(this.getZoom()-1,l,f),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(l,f){return l!=this.transform.fov&&(this.transform.setFov(l),this.fire(new s.l("movestart",f)).fire(new s.l("move",f)).fire(new s.l("moveend",f))),this}getBearing(){return this.transform.bearing}setBearing(l,f){return this.jumpTo({bearing:l},f),this}getPadding(){return this.transform.padding}setPadding(l,f){return this.jumpTo({padding:l},f),this}rotateTo(l,f,v){return this.easeTo(s.e({bearing:l},f),v)}resetNorth(l,f){return this.rotateTo(0,s.e({duration:1e3},l),f),this}resetNorthPitch(l,f){return this.easeTo(s.e({bearing:0,pitch:0,roll:0,duration:1e3},l),f),this}snapToNorth(l,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,f):this}getPitch(){return this.transform.pitch}setPitch(l,f){return this.jumpTo({pitch:l},f),this}getRoll(){return this.transform.roll}setRoll(l,f){return this.jumpTo({roll:l},f),this}cameraForBounds(l,f){l=Ae.convert(l).adjustAntiMeridian();const v=f&&f.bearing||0;return this._cameraForBoxAndBearing(l.getNorthWest(),l.getSouthEast(),v,f)}_cameraForBoxAndBearing(l,f,v,w){const I={top:0,bottom:0,right:0,left:0};if(typeof(w=s.e({padding:I,offset:[0,0],maxZoom:this.transform.maxZoom},w)).padding=="number"){const Z=w.padding;w.padding={top:Z,bottom:Z,right:Z,left:Z}}const k=s.e(I,w.padding);w.padding=k;const B=this.transform,W=new Ae(l,f);return this.cameraHelper.cameraForBoxAndBearing(w,k,W,v,B)}fitBounds(l,f,v){return this._fitInternal(this.cameraForBounds(l,f),f,v)}fitScreenCoordinates(l,f,v,w,I){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(s.P.convert(l)),this.transform.screenPointToLocation(s.P.convert(f)),v,w),w,I)}_fitInternal(l,f,v){return l?(delete(f=s.e(l,f)).padding,f.linear?this.easeTo(f,v):this.flyTo(f,v)):this}jumpTo(l,f){this.stop();const v=this._getTransformForUpdate();let w=!1,I=!1,k=!1;const B=v.zoom;this.cameraHelper.handleJumpToCenterZoom(v,l);const W=v.zoom!==B;return"elevation"in l&&v.elevation!==+l.elevation&&v.setElevation(+l.elevation),"bearing"in l&&v.bearing!==+l.bearing&&(w=!0,v.setBearing(+l.bearing)),"pitch"in l&&v.pitch!==+l.pitch&&(I=!0,v.setPitch(+l.pitch)),"roll"in l&&v.roll!==+l.roll&&(k=!0,v.setRoll(+l.roll)),l.padding==null||v.isPaddingEqual(l.padding)||v.setPadding(l.padding),this._applyUpdatedTransform(v),this.fire(new s.l("movestart",f)).fire(new s.l("move",f)),W&&this.fire(new s.l("zoomstart",f)).fire(new s.l("zoom",f)).fire(new s.l("zoomend",f)),w&&this.fire(new s.l("rotatestart",f)).fire(new s.l("rotate",f)).fire(new s.l("rotateend",f)),I&&this.fire(new s.l("pitchstart",f)).fire(new s.l("pitch",f)).fire(new s.l("pitchend",f)),k&&this.fire(new s.l("rollstart",f)).fire(new s.l("roll",f)).fire(new s.l("rollend",f)),this.fire(new s.l("moveend",f))}calculateCameraOptionsFromTo(l,f,v,w=0){const I=s.a9.fromLngLat(l,f),k=s.a9.fromLngLat(v,w),B=k.x-I.x,W=k.y-I.y,Z=k.z-I.z,J=Math.hypot(B,W,Z);if(J===0)throw new Error("Can't calculate camera options with same From and To");const he=Math.hypot(B,W),ue=s.at(this.transform.cameraToCenterDistance/J/this.transform.tileSize),_e=180*Math.atan2(B,-W)/Math.PI;let Ce=180*Math.acos(he/J)/Math.PI;return Ce=Z<0?90-Ce:90+Ce,{center:k.toLngLat(),elevation:w,zoom:ue,pitch:Ce,bearing:_e}}calculateCameraOptionsFromCameraLngLatAltRotation(l,f,v,w,I){const k=this.transform.calculateCenterFromCameraLngLatAlt(l,f,v,w);return{center:k.center,elevation:k.elevation,zoom:k.zoom,bearing:v,pitch:w,roll:I}}easeTo(l,f){this._stop(!1,l.easeId),((l=s.e({offset:[0,0],duration:500,easing:s.cy},l)).animate===!1||!l.essential&&b.prefersReducedMotion)&&(l.duration=0);const v=this._getTransformForUpdate(),w=this.getBearing(),I=v.pitch,k=v.roll,B="bearing"in l?this._normalizeBearing(l.bearing,w):w,W="pitch"in l?+l.pitch:I,Z="roll"in l?this._normalizeBearing(l.roll,k):k,J="padding"in l?l.padding:v.padding,he=s.P.convert(l.offset);let ue,_e;l.around&&(ue=s.V.convert(l.around),_e=v.locationToScreenPoint(ue));const Ce={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},Fe=this.cameraHelper.handleEaseTo(v,{bearing:B,pitch:W,roll:Z,padding:J,around:ue,aroundPoint:_e,offsetAsPoint:he,offset:l.offset,zoom:l.zoom,center:l.center});return this._rotating=this._rotating||w!==B,this._pitching=this._pitching||W!==I,this._rolling=this._rolling||Z!==k,this._padding=!v.isPaddingEqual(J),this._zooming=this._zooming||Fe.isZooming,this._easeId=l.easeId,this._prepareEase(f,l.noMoveStart,Ce),this.terrain&&this._prepareElevation(Fe.elevationCenter),this._ease((Ne=>{Fe.easeFunc(Ne),this.terrain&&!l.freezeElevation&&this._updateElevation(Ne),this._applyUpdatedTransform(v),this._fireMoveEvents(f)}),(Ne=>{this.terrain&&l.freezeElevation&&this._finalizeElevation(),this._afterEase(f,Ne)}),l),this}_prepareEase(l,f,v={}){this._moving=!0,f||v.moving||this.fire(new s.l("movestart",l)),this._zooming&&!v.zooming&&this.fire(new s.l("zoomstart",l)),this._rotating&&!v.rotating&&this.fire(new s.l("rotatestart",l)),this._pitching&&!v.pitching&&this.fire(new s.l("pitchstart",l)),this._rolling&&!v.rolling&&this.fire(new s.l("rollstart",l))}_prepareElevation(l){this._elevationCenter=l,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(l,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(l){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const f=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(l<1&&f!==this._elevationTarget){const v=this._elevationTarget-this._elevationStart;this._elevationStart+=l*(v-(f-(v*l+this._elevationStart))/(1-l)),this._elevationTarget=f}this.transform.setElevation(s.G.number(this._elevationStart,this._elevationTarget,l))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(l){if(!this.terrain&&l.elevation>=0&&l.pitch<=90)return{};const f=l.getCameraLngLat(),v=l.getCameraAltitude(),w=this.terrain?this.terrain.getElevationForLngLatZoom(f,l.zoom):0;if(v<w){const I=this.calculateCameraOptionsFromTo(f,w,l.center,l.elevation);return{pitch:I.pitch,zoom:I.zoom}}return{}}_applyUpdatedTransform(l){const f=[];if(f.push((w=>this._elevateCameraIfInsideTerrain(w))),this.transformCameraUpdate&&f.push((w=>this.transformCameraUpdate(w))),!f.length)return;const v=l.clone();for(const w of f){const I=v.clone(),{center:k,zoom:B,roll:W,pitch:Z,bearing:J,elevation:he}=w(I);k&&I.setCenter(k),he!==void 0&&I.setElevation(he),B!==void 0&&I.setZoom(B),W!==void 0&&I.setRoll(W),Z!==void 0&&I.setPitch(Z),J!==void 0&&I.setBearing(J),v.apply(I)}this.transform.apply(v)}_fireMoveEvents(l){this.fire(new s.l("move",l)),this._zooming&&this.fire(new s.l("zoom",l)),this._rotating&&this.fire(new s.l("rotate",l)),this._pitching&&this.fire(new s.l("pitch",l)),this._rolling&&this.fire(new s.l("roll",l))}_afterEase(l,f){if(this._easeId&&f&&this._easeId===f)return;delete this._easeId;const v=this._zooming,w=this._rotating,I=this._pitching,k=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,v&&this.fire(new s.l("zoomend",l)),w&&this.fire(new s.l("rotateend",l)),I&&this.fire(new s.l("pitchend",l)),k&&this.fire(new s.l("rollend",l)),this.fire(new s.l("moveend",l))}flyTo(l,f){if(!l.essential&&b.prefersReducedMotion){const Pt=s.U(l,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Pt,f)}this.stop(),l=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.cy},l);const v=this._getTransformForUpdate(),w=v.bearing,I=v.pitch,k=v.roll,B=v.padding,W="bearing"in l?this._normalizeBearing(l.bearing,w):w,Z="pitch"in l?+l.pitch:I,J="roll"in l?this._normalizeBearing(l.roll,k):k,he="padding"in l?l.padding:v.padding,ue=s.P.convert(l.offset);let _e=v.centerPoint.add(ue);const Ce=v.screenPointToLocation(_e),Fe=this.cameraHelper.handleFlyTo(v,{bearing:W,pitch:Z,roll:J,padding:he,locationAtOffset:Ce,offsetAsPoint:ue,center:l.center,minZoom:l.minZoom,zoom:l.zoom});let Ne=l.curve;const ze=Math.max(v.width,v.height),We=ze/Fe.scaleOfZoom,tt=Fe.pixelPathLength;typeof Fe.scaleOfMinZoom=="number"&&(Ne=Math.sqrt(ze/Fe.scaleOfMinZoom/tt*2));const je=Ne*Ne;function Qe(Pt){const Qt=(We*We-ze*ze+(Pt?-1:1)*je*je*tt*tt)/(2*(Pt?We:ze)*je*tt);return Math.log(Math.sqrt(Qt*Qt+1)-Qt)}function at(Pt){return(Math.exp(Pt)-Math.exp(-Pt))/2}function Ke(Pt){return(Math.exp(Pt)+Math.exp(-Pt))/2}const mt=Qe(!1);let Lt=function(Pt){return Ke(mt)/Ke(mt+Ne*Pt)},Et=function(Pt){return ze*((Ke(mt)*(at(Qt=mt+Ne*Pt)/Ke(Qt))-at(mt))/je)/tt;var Qt},At=(Qe(!0)-mt)/Ne;if(Math.abs(tt)<2e-6||!isFinite(At)){if(Math.abs(ze-We)<1e-6)return this.easeTo(l,f);const Pt=We<ze?-1:1;At=Math.abs(Math.log(We/ze))/Ne,Et=()=>0,Lt=Qt=>Math.exp(Pt*Ne*Qt)}return l.duration="duration"in l?+l.duration:1e3*At/("screenSpeed"in l?+l.screenSpeed/Ne:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0),this._zooming=!0,this._rotating=w!==W,this._pitching=Z!==I,this._rolling=J!==k,this._padding=!v.isPaddingEqual(he),this._prepareEase(f,!1),this.terrain&&this._prepareElevation(Fe.targetCenter),this._ease((Pt=>{const Qt=Pt*At,ti=1/Lt(Qt),Xt=Et(Qt);this._rotating&&v.setBearing(s.G.number(w,W,Pt)),this._pitching&&v.setPitch(s.G.number(I,Z,Pt)),this._rolling&&v.setRoll(s.G.number(k,J,Pt)),this._padding&&(v.interpolatePadding(B,he,Pt),_e=v.centerPoint.add(ue)),Fe.easeFunc(Pt,ti,Xt,_e),this.terrain&&!l.freezeElevation&&this._updateElevation(Pt),this._applyUpdatedTransform(v),this._fireMoveEvents(f)}),(()=>{this.terrain&&l.freezeElevation&&this._finalizeElevation(),this._afterEase(f)}),l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,f){var v;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const w=this._onEaseEnd;delete this._onEaseEnd,w.call(this,f)}return l||(v=this.handlers)===null||v===void 0||v.stop(!1),this}_ease(l,f,v){v.animate===!1||v.duration===0?(l(1),f()):(this._easeStart=P(),this._easeOptions=v,this._onEaseFrame=l,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(l,f){l=s.W(l,-180,180);const v=Math.abs(l-f);return Math.abs(l-360-f)<v&&(l-=360),Math.abs(l+360-f)<v&&(l+=360),l}queryTerrainElevation(l){return this.terrain?this.terrain.getElevationForLngLat(s.V.convert(l),this.transform):null}}const ha={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class U_{constructor(l=ha){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=f=>{!f||f.sourceDataType!=="metadata"&&f.sourceDataType!=="visibility"&&f.dataType!=="style"&&f.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=l}getDefaultPosition(){return"bottom-right"}onAdd(l){return this._map=l,this._compact=this.options.compact,this._container=L.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=L.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=L.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){L.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(l,f){const v=this._map._getUIString(`AttributionControl.${f}`);l.title=v,l.setAttribute("aria-label",v)}_updateAttributions(){if(!this._map.style)return;let l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map((w=>typeof w!="string"?"":w))):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){const w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}const f=this._map.style.tileManagers;for(const w in f){const I=f[w];if(I.used||I.usedForTerrain){const k=I.getSource();k.attribution&&l.indexOf(k.attribution)<0&&l.push(k.attribution)}}l=l.filter((w=>String(w).trim())),l.sort(((w,I)=>w.length-I.length)),l=l.filter(((w,I)=>{for(let k=I+1;k<l.length;k++)if(l[k].indexOf(w)>=0)return!1;return!0}));const v=l.join(" | ");v!==this._attribHTML&&(this._attribHTML=v,l.length?(this._innerContainer.innerHTML=L.sanitize(v),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class W0{constructor(l={}){this._updateCompact=()=>{const f=this._container.children;if(f.length){const v=f[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&v.classList.add("maplibregl-compact"):v.classList.remove("maplibregl-compact")}},this.options=l}getDefaultPosition(){return"bottom-left"}onAdd(l){this._map=l,this._compact=this.options&&this.options.compact,this._container=L.create("div","maplibregl-ctrl");const f=L.create("a","maplibregl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://maplibre.org/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){L.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class F1{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const f=++this._id;return this._queue.push({callback:l,id:f,cancelled:!1}),f}remove(l){const f=this._currentlyRunning,v=f?this._queue.concat(f):this._queue;for(const w of v)if(w.id===l)return void(w.cancelled=!0)}run(l=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const f=this._currentlyRunning=this._queue;this._queue=[];for(const v of f)if(!v.cancelled&&(v.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var O1=s.aU([{name:"a_pos3d",type:"Int16",components:3}]);class Mf extends s.E{constructor(l){super(),this._lastTilesetChange=P(),this.tileManager=l,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=l._source.tileSize*2**this.deltaZoom,l.usedForTerrain=!0,l.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(l,f){this.tileManager.update(l,f),this._renderableTilesKeys=[];const v={};for(const w of Un(l,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:f,calculateTileZoom:this.tileManager._source.calculateTileZoom}))v[w.key]=!0,this._renderableTilesKeys.push(w.key),this._tiles[w.key]||(w.terrainRttPosMatrix32f=new Float64Array(16),s.c7(w.terrainRttPosMatrix32f,0,s.a5,s.a5,0,0,1),this._tiles[w.key]=new Dt(w,this.tileSize),this._lastTilesetChange=P());for(const w in this._tiles)v[w]||delete this._tiles[w]}freeRtt(l){for(const f in this._tiles){const v=this._tiles[f];(!l||v.tileID.equals(l)||v.tileID.isChildOf(l)||l.isChildOf(v.tileID))&&(v.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((l=>this.getTileByID(l)))}getTileByID(l){return this._tiles[l]}getTerrainCoords(l,f){return f?this._getTerrainCoordsForTileRanges(l,f):this._getTerrainCoordsForRegularTile(l)}_getTerrainCoordsForRegularTile(l){const f={};for(const v of this._renderableTilesKeys){const w=this._tiles[v].tileID,I=l.clone(),k=s.bk();if(w.canonical.equals(l.canonical))s.c7(k,0,s.a5,s.a5,0,0,1);else if(w.canonical.isChildOf(l.canonical)){const B=w.canonical.z-l.canonical.z,W=w.canonical.x-(w.canonical.x>>B<<B),Z=w.canonical.y-(w.canonical.y>>B<<B),J=s.a5>>B;s.c7(k,0,J,J,0,0,1),s.O(k,k,[-W*J,-Z*J,0])}else{if(!l.canonical.isChildOf(w.canonical))continue;{const B=l.canonical.z-w.canonical.z,W=l.canonical.x-(l.canonical.x>>B<<B),Z=l.canonical.y-(l.canonical.y>>B<<B),J=s.a5>>B;s.c7(k,0,s.a5,s.a5,0,0,1),s.O(k,k,[W*J,Z*J,0]),s.Q(k,k,[1/2**B,1/2**B,0])}}I.terrainRttPosMatrix32f=new Float32Array(k),f[v]=I}return f}_getTerrainCoordsForTileRanges(l,f){const v={};for(const w of this._renderableTilesKeys){const I=this._tiles[w].tileID;if(!this._isWithinTileRanges(I,f))continue;const k=l.clone(),B=s.bk();if(I.canonical.z===l.canonical.z){const W=l.canonical.x-I.canonical.x,Z=l.canonical.y-I.canonical.y;s.c7(B,0,s.a5,s.a5,0,0,1),s.O(B,B,[W*s.a5,Z*s.a5,0])}else if(I.canonical.z>l.canonical.z){const W=I.canonical.z-l.canonical.z,Z=I.canonical.x-(I.canonical.x>>W<<W),J=I.canonical.y-(I.canonical.y>>W<<W),he=l.canonical.x-(I.canonical.x>>W),ue=l.canonical.y-(I.canonical.y>>W),_e=s.a5>>W;s.c7(B,0,_e,_e,0,0,1),s.O(B,B,[-Z*_e+he*s.a5,-J*_e+ue*s.a5,0])}else{const W=l.canonical.z-I.canonical.z,Z=l.canonical.x-(l.canonical.x>>W<<W),J=l.canonical.y-(l.canonical.y>>W<<W),he=(l.canonical.x>>W)-I.canonical.x,ue=(l.canonical.y>>W)-I.canonical.y,_e=s.a5<<W;s.c7(B,0,_e,_e,0,0,1),s.O(B,B,[Z*s.a5+he*_e,J*s.a5+ue*_e,0])}k.terrainRttPosMatrix32f=new Float32Array(B),v[w]=k}return v}getSourceTile(l,f){const v=this.tileManager._source;let w=l.overscaledZ-this.deltaZoom;if(w>v.maxzoom&&(w=v.maxzoom),w<v.minzoom)return;this._sourceTileCache[l.key]||(this._sourceTileCache[l.key]=l.scaledTo(w).key);let I=this.findTileInCaches(this._sourceTileCache[l.key]);if(!I?.dem&&f)for(;w>=v.minzoom&&!I?.dem;)I=this.findTileInCaches(l.scaledTo(w--).key);return I}findTileInCaches(l){let f=this.tileManager.getTileByID(l);return f||(f=this.tileManager._outOfViewCache.getByKey(l),f)}anyTilesAfterTime(l=Date.now()){return this._lastTilesetChange>=l}_isWithinTileRanges(l,f){return f[l.canonical.z]&&l.canonical.x>=f[l.canonical.z].minTileX&&l.canonical.x<=f[l.canonical.z].maxTileX&&l.canonical.y>=f[l.canonical.z].minTileY&&l.canonical.y<=f[l.canonical.z].maxTileY}}class Ir{constructor(l,f,v){this._meshCache={},this.painter=l,this.tileManager=new Mf(f),this.options=v,this.exaggeration=typeof v.exaggeration=="number"?v.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(l,f,v,w=s.a5){var I;if(!(f>=0&&f<w&&v>=0&&v<w))return 0;const k=this.getTerrainData(l),B=(I=k.tile)===null||I===void 0?void 0:I.dem;if(!B)return 0;const W=s.cC([],[f/w*s.a5,v/w*s.a5],k.u_terrain_matrix),Z=[W[0]*B.dim,W[1]*B.dim],J=Math.floor(Z[0]),he=Math.floor(Z[1]),ue=Z[0]-J,_e=Z[1]-he;return B.get(J,he)*(1-ue)*(1-_e)+B.get(J+1,he)*ue*(1-_e)+B.get(J,he+1)*(1-ue)*_e+B.get(J+1,he+1)*ue*_e}getElevationForLngLatZoom(l,f){if(!s.cD(f,l.wrap()))return 0;const{tileID:v,mercatorX:w,mercatorY:I}=this._getOverscaledTileIDFromLngLatZoom(l,f);return this.getElevation(v,w%s.a5,I%s.a5,s.a5)}getElevationForLngLat(l,f){const v=Un(f,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this});let w=0;for(const I of v)I.canonical.z>w&&(w=Math.min(I.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(l,w)}getElevation(l,f,v,w=s.a5){return this.getDEMElevation(l,f,v,w)*this.exaggeration}getTerrainData(l){if(!this._emptyDemTexture){const w=this.painter.context,I=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new s.T(w,I,w.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new s.T(w,new s.R({width:1,height:1}),w.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(w.gl.NEAREST,w.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.ar([])}const f=this.tileManager.getSourceTile(l,!0);if(f&&f.dem&&(!f.demTexture||f.needsTerrainPrepare)){const w=this.painter.context;f.demTexture=this.painter.getTileTexture(f.dem.stride),f.demTexture?f.demTexture.update(f.dem.getPixels(),{premultiply:!1}):f.demTexture=new s.T(w,f.dem.getPixels(),w.gl.RGBA,{premultiply:!1}),f.demTexture.bind(w.gl.NEAREST,w.gl.CLAMP_TO_EDGE),f.needsTerrainPrepare=!1}const v=f&&f.toString()+f.tileID.key+l.key;if(v&&!this._demMatrixCache[v]){const w=this.tileManager.getSource().maxzoom;let I=l.canonical.z-f.tileID.canonical.z;l.overscaledZ>l.canonical.z&&(l.canonical.z>=w?I=l.canonical.z-w:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const k=l.canonical.x-(l.canonical.x>>I<<I),B=l.canonical.y-(l.canonical.y>>I<<I),W=s.cE(new Float64Array(16),[1/(s.a5<<I),1/(s.a5<<I),0]);s.O(W,W,[k*s.a5,B*s.a5,0]),this._demMatrixCache[l.key]={matrix:W,coord:l}}return{u_depth:2,u_terrain:3,u_terrain_dim:f&&f.dem&&f.dem.dim||1,u_terrain_matrix:v?this._demMatrixCache[l.key].matrix:this._emptyDemMatrix,u_terrain_unpack:f&&f.dem&&f.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(f&&f.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:f}}getFramebuffer(l){const f=this.painter,v=f.width/devicePixelRatio,w=f.height/devicePixelRatio;return!this._fbo||this._fbo.width===v&&this._fbo.height===w||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new s.T(f.context,{width:v,height:w,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new s.T(f.context,{width:v,height:w,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=f.context.createFramebuffer(v,w,!0,!1),this._fbo.depthAttachment.set(f.context.createRenderbuffer(f.context.gl.DEPTH_COMPONENT16,v,w))),this._fbo.colorAttachment.set(l==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const l=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const f=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let I=0,k=0;I<this._coordsTextureSize;I++)for(let B=0;B<this._coordsTextureSize;B++,k+=4)f[k+0]=255&B,f[k+1]=255&I,f[k+2]=B>>8<<4|I>>8,f[k+3]=0;const v=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(f.buffer)),w=new s.T(l,v,l.gl.RGBA,{premultiply:!1});return w.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),this._coordsTexture=w,w}pointCoordinate(l){this.painter.maybeDrawDepthAndCoords(!0);const f=new Uint8Array(4),v=this.painter.context,w=v.gl,I=Math.round(l.x*this.painter.pixelRatio/devicePixelRatio),k=Math.round(l.y*this.painter.pixelRatio/devicePixelRatio),B=Math.round(this.painter.height/devicePixelRatio);v.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),w.readPixels(I,B-k-1,1,1,w.RGBA,w.UNSIGNED_BYTE,f),v.bindFramebuffer.set(null);const W=f[0]+(f[2]>>4<<8),Z=f[1]+((15&f[2])<<8),J=this.coordsIndex[255-f[3]],he=J&&this.tileManager.getTileByID(J);if(!he)return null;const ue=this._coordsTextureSize,_e=(1<<he.tileID.canonical.z)*ue;return new s.a9((he.tileID.canonical.x*ue+W)/_e+he.tileID.wrap,(he.tileID.canonical.y*ue+Z)/_e,this.getElevation(he.tileID,W,Z,ue))}depthAtPoint(l){const f=new Uint8Array(4),v=this.painter.context,w=v.gl;return v.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),w.readPixels(l.x,this.painter.height/devicePixelRatio-l.y-1,1,1,w.RGBA,w.UNSIGNED_BYTE,f),v.bindFramebuffer.set(null),(f[0]/16777216+f[1]/65536+f[2]/256+f[3])/256}getTerrainMesh(l){var f;const v=((f=this.painter.style.projection)===null||f===void 0?void 0:f.transitionState)>0,w=v&&l.canonical.y===0,I=v&&l.canonical.y===(1<<l.canonical.z)-1,k=`m_${w?"n":""}_${I?"s":""}`;if(this._meshCache[k])return this._meshCache[k];const B=this.painter.context,W=new s.cF,Z=new s.aY,J=this.meshSize,he=s.a5/J,ue=J*J;for(let Ke=0;Ke<=J;Ke++)for(let mt=0;mt<=J;mt++)W.emplaceBack(mt*he,Ke*he,0);for(let Ke=0;Ke<ue;Ke+=J+1)for(let mt=0;mt<J;mt++)Z.emplaceBack(mt+Ke,J+mt+Ke+1,J+mt+Ke+2),Z.emplaceBack(mt+Ke,J+mt+Ke+2,mt+Ke+1);const _e=W.length,Ce=_e+(J+1),Fe=(J+1)*J,Ne=w?s.br:0,ze=w?0:1,We=I?s.bs:s.a5,tt=I?0:1;for(let Ke=0;Ke<=J;Ke++)W.emplaceBack(Ke*he,Ne,ze);for(let Ke=0;Ke<=J;Ke++)W.emplaceBack(Ke*he,We,tt);for(let Ke=0;Ke<J;Ke++)Z.emplaceBack(Fe+Ke,Ce+Ke,Ce+Ke+1),Z.emplaceBack(Fe+Ke,Ce+Ke+1,Fe+Ke+1),Z.emplaceBack(0+Ke,_e+Ke+1,_e+Ke),Z.emplaceBack(0+Ke,0+Ke+1,_e+Ke+1);const je=W.length,Qe=je+2*(J+1);for(const Ke of[0,1])for(let mt=0;mt<=J;mt++)for(const Lt of[0,1])W.emplaceBack(Ke*s.a5,mt*he,Lt);for(let Ke=0;Ke<2*J;Ke+=2)Z.emplaceBack(je+Ke,je+Ke+1,je+Ke+3),Z.emplaceBack(je+Ke,je+Ke+3,je+Ke+2),Z.emplaceBack(Qe+Ke,Qe+Ke+3,Qe+Ke+1),Z.emplaceBack(Qe+Ke,Qe+Ke+2,Qe+Ke+3);const at=new On(B.createVertexBuffer(W,O1.members),B.createIndexBuffer(Z),s.aX.simpleSegment(0,0,W.length,Z.length));return this._meshCache[k]=at,at}getMeshFrameDelta(l){return 2*Math.PI*s.bE/Math.pow(2,Math.max(l,0))/5}getMinTileElevationForLngLatZoom(l,f){var v;if(!s.cD(f,l.wrap()))return 0;const{tileID:w}=this._getOverscaledTileIDFromLngLatZoom(l,f);return(v=this.getMinMaxElevation(w).minElevation)!==null&&v!==void 0?v:0}getMinMaxElevation(l){const f=this.getTerrainData(l).tile,v={minElevation:null,maxElevation:null};return f&&f.dem&&(v.minElevation=f.dem.min*this.exaggeration,v.maxElevation=f.dem.max*this.exaggeration),v}_getOverscaledTileIDFromLngLatZoom(l,f){const v=s.a9.fromLngLat(l.wrap()),w=(1<<f)*s.a5,I=v.x*w,k=v.y*w,B=Math.floor(I/s.a5),W=Math.floor(k/s.a5);return{tileID:new s.a2(f,0,f,B,W),mercatorX:I,mercatorY:k}}}class Hr{constructor(l,f,v){this._context=l,this._size=f,this._tileSize=v,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const l of this._objects)l.texture.destroy(),l.fbo.destroy()}_createObject(l){const f=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),v=new s.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return v.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),f.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),f.colorAttachment.set(v.texture),{id:l,fbo:f,texture:v,stamp:-1,inUse:!1}}getObjectForId(l){return this._objects[l]}useObject(l){l.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((f=>l.id!==f)),this._recentlyUsed.push(l.id)}stampObject(l){l.stamp=++this._stamp}getOrCreateFreeObject(){for(const f of this._recentlyUsed)if(!this._objects[f].inUse)return this._objects[f];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const l=this._createObject(this._objects.length);return this._objects.push(l),l}freeObject(l){l.inUse=!1}freeAllObjects(){for(const l of this._objects)this.freeObject(l)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((l=>!l.inUse))===!1}}const Uu={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Cf{constructor(l,f){this.painter=l,this.terrain=f,this.pool=new Hr(l.context,30,f.tileManager.tileSize*f.qualityFactor)}destruct(){this.pool.destruct()}getTexture(l){return this.pool.getObjectForId(l.rtt[this._stacks.length-1].id).texture}prepareForRender(l,f){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=l._order.filter((v=>!l._layers[v].isHidden(f))),this._coordsAscending={};for(const v in l.tileManagers){this._coordsAscending[v]={};const w=l.tileManagers[v].getVisibleCoordinates(),I=l.tileManagers[v].getSource(),k=I instanceof yt?I.terrainTileRanges:null;for(const B of w){const W=this.terrain.tileManager.getTerrainCoords(B,k);for(const Z in W)this._coordsAscending[v][Z]||(this._coordsAscending[v][Z]=[]),this._coordsAscending[v][Z].push(W[Z])}}this._coordsAscendingStr={};for(const v of l._order){const w=l._layers[v],I=w.source;if(Uu[w.type]&&!this._coordsAscendingStr[I]){this._coordsAscendingStr[I]={};for(const k in this._coordsAscending[I])this._coordsAscendingStr[I][k]=this._coordsAscending[I][k].map((B=>B.key)).sort().join()}}for(const v of this._renderableTiles)for(const w in this._coordsAscendingStr){const I=this._coordsAscendingStr[w][v.tileID.key];I&&I!==v.rttCoords[w]&&(v.rtt=[])}}renderLayer(l,f){if(l.isHidden(this.painter.transform.zoom))return!1;const v=Object.assign(Object.assign({},f),{isRenderingToTexture:!0}),w=l.type,I=this.painter,k=this._renderableLayerIds[this._renderableLayerIds.length-1]===l.id;if(Uu[w]&&(this._prevType&&Uu[this._prevType]||this._stacks.push([]),this._prevType=w,this._stacks[this._stacks.length-1].push(l.id),!k))return!0;if(Uu[this._prevType]||Uu[w]&&k){this._prevType=w;const B=this._stacks.length-1,W=this._stacks[B]||[];for(const Z of this._renderableTiles){if(this.pool.isFull()&&(R_(this.painter,this.terrain,this._rttTiles,v),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(Z),Z.rtt[B]){const he=this.pool.getObjectForId(Z.rtt[B].id);if(he.stamp===Z.rtt[B].stamp){this.pool.useObject(he);continue}}const J=this.pool.getOrCreateFreeObject();this.pool.useObject(J),this.pool.stampObject(J),Z.rtt[B]={id:J.id,stamp:J.stamp},I.context.bindFramebuffer.set(J.fbo.framebuffer),I.context.clear({color:s.bp.transparent,stencil:0}),I.currentStencilSource=void 0;for(let he=0;he<W.length;he++){const ue=I.style._layers[W[he]],_e=ue.source?this._coordsAscending[ue.source][Z.tileID.key]:[Z.tileID];I.context.viewport.set([0,0,J.fbo.width,J.fbo.height]),I._renderTileClippingMasks(ue,_e,!0),I.renderLayer(I,I.style.tileManagers[ue.source],ue,_e,v),ue.source&&(Z.rttCoords[ue.source]=this._coordsAscendingStr[ue.source][Z.tileID.key])}}return R_(this.painter,this.terrain,this._rttTiles,v),this._rttTiles=[],this.pool.freeAllObjects(),Uu[w]}return!1}}const hm={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use â + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},j_=d,dm={hash:!1,interactive:!0,bearingSnap:7,attributionControl:ha,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},G_={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Ef{constructor(l,f,v=!1){this.mousedown=I=>{this.startMove(I,L.mousePos(this.element,I)),L.addEventListener(window,"mousemove",this.mousemove),L.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=I=>{this.move(I,L.mousePos(this.element,I))},this.mouseup=I=>{this._rotatePitchHandler.dragEnd(I),this.offTemp()},this.touchstart=I=>{I.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=L.touchPos(this.element,I.targetTouches)[0],this.startMove(I,this._startPos),L.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.addEventListener(window,"touchend",this.touchend))},this.touchmove=I=>{I.targetTouches.length!==1?this.reset():(this._lastPos=L.touchPos(this.element,I.targetTouches)[0],this.move(I,this._lastPos))},this.touchend=I=>{I.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=f;const w=new N0;this._rotatePitchHandler=new Qh({clickTolerance:3,move:(I,k)=>{const B=f.getBoundingClientRect(),W=new s.P((B.bottom-B.top)/2,(B.right-B.left)/2);return{bearingDelta:s.cx(new s.P(I.x,k.y),k,W),pitchDelta:v?-.5*(k.y-I.y):void 0}},moveStateManager:w,enable:!0,assignEvents:()=>{}}),this.map=l,L.addEventListener(f,"mousedown",this.mousedown),L.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),L.addEventListener(f,"touchcancel",this.reset)}startMove(l,f){this._rotatePitchHandler.dragStart(l,f),L.disableDrag()}move(l,f){const v=this.map,{bearingDelta:w,pitchDelta:I}=this._rotatePitchHandler.dragMove(l,f)||{};w&&v.setBearing(v.getBearing()+w),I&&v.setPitch(v.getPitch()+I)}off(){const l=this.element;L.removeEventListener(l,"mousedown",this.mousedown),L.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),L.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.removeEventListener(window,"touchend",this.touchend),L.removeEventListener(l,"touchcancel",this.reset),this.offTemp()}offTemp(){L.enableDrag(),L.removeEventListener(window,"mousemove",this.mousemove),L.removeEventListener(window,"mouseup",this.mouseup),L.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.removeEventListener(window,"touchend",this.touchend)}}let ac;function fm(A,l,f,v=!1){if(v||!f.getCoveringTilesDetailsProvider().allowWorldCopies())return A?.wrap();const w=new s.V(A.lng,A.lat);if(A=new s.V(A.lng,A.lat),l){const I=new s.V(A.lng-360,A.lat),k=new s.V(A.lng+360,A.lat),B=f.locationToScreenPoint(A).distSqr(l);f.locationToScreenPoint(I).distSqr(l)<B?A=I:f.locationToScreenPoint(k).distSqr(l)<B&&(A=k)}for(;Math.abs(A.lng-f.center.lng)>180;){const I=f.locationToScreenPoint(A);if(I.x>=0&&I.y>=0&&I.x<=f.width&&I.y<=f.height)break;A.lng>f.center.lng?A.lng-=360:A.lng+=360}return A.lng!==w.lng&&f.isPointOnMapSurface(f.locationToScreenPoint(A))?A:w}const Af={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function pm(A,l,f){const v=A.classList;for(const w in Af)v.remove(`maplibregl-${f}-anchor-${w}`);v.add(`maplibregl-${f}-anchor-${l}`)}class Pf extends s.E{constructor(l){if(super(),this._onKeyPress=f=>{const v=f.code,w=f.charCode||f.keyCode;v!=="Space"&&v!=="Enter"&&w!==32&&w!==13||this.togglePopup()},this._onMapClick=f=>{const v=f.originalEvent.target,w=this._element;this._popup&&(v===w||w.contains(v))&&this.togglePopup()},this._update=f=>{if(!this._map)return;const v=this._map.loaded()&&!this._map.isMoving();(f?.type==="terrain"||f?.type==="render"&&!v)&&this._map.once("render",this._update),this._lngLat=fm(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let w="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?w=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(w=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let I="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?I="rotateX(0deg)":this._pitchAlignment==="map"&&(I=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||f&&f.type!=="moveend"||(this._pos=this._pos.round()),L.setTransform(this._element,`${Af[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${I} ${w}`),b.frameAsync(new AbortController).then((()=>{this._updateOpacity(f&&f.type==="moveend")})).catch((()=>{}))},this._onMove=f=>{if(!this._isDragging){const v=this._clickTolerance||this._map._clickTolerance;this._isDragging=f.point.dist(this._pointerdownPos)>=v}this._isDragging&&(this._pos=f.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.l("dragstart"))),this.fire(new s.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.l("dragend")),this._state="inactive"},this._addDragHandler=f=>{this._element.contains(f.originalEvent.target)&&(f.preventDefault(),this._positionDelta=f.point.sub(this._pos).add(this._offset),this._pointerdownPos=f.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._subpixelPositioning=l&&l.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment!=="auto"?l.pitchAlignment:this._rotationAlignment,this.setOpacity(l?.opacity,l?.opacityWhenCovered),l&&l.element)this._element=l.element,this._offset=s.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=L.create("div");const f=L.createNS("http://www.w3.org/2000/svg","svg"),v=41,w=27;f.setAttributeNS(null,"display","block"),f.setAttributeNS(null,"height",`${v}px`),f.setAttributeNS(null,"width",`${w}px`),f.setAttributeNS(null,"viewBox",`0 0 ${w} ${v}`);const I=L.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"stroke","none"),I.setAttributeNS(null,"stroke-width","1"),I.setAttributeNS(null,"fill","none"),I.setAttributeNS(null,"fill-rule","evenodd");const k=L.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"fill-rule","nonzero");const B=L.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"transform","translate(3.0, 29.0)"),B.setAttributeNS(null,"fill","#000000");const W=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ze of W){const We=L.createNS("http://www.w3.org/2000/svg","ellipse");We.setAttributeNS(null,"opacity","0.04"),We.setAttributeNS(null,"cx","10.5"),We.setAttributeNS(null,"cy","5.80029008"),We.setAttributeNS(null,"rx",ze.rx),We.setAttributeNS(null,"ry",ze.ry),B.appendChild(We)}const Z=L.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"fill",this._color);const J=L.createNS("http://www.w3.org/2000/svg","path");J.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Z.appendChild(J);const he=L.createNS("http://www.w3.org/2000/svg","g");he.setAttributeNS(null,"opacity","0.25"),he.setAttributeNS(null,"fill","#000000");const ue=L.createNS("http://www.w3.org/2000/svg","path");ue.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),he.appendChild(ue);const _e=L.createNS("http://www.w3.org/2000/svg","g");_e.setAttributeNS(null,"transform","translate(6.0, 7.0)"),_e.setAttributeNS(null,"fill","#FFFFFF");const Ce=L.createNS("http://www.w3.org/2000/svg","g");Ce.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Fe=L.createNS("http://www.w3.org/2000/svg","circle");Fe.setAttributeNS(null,"fill","#000000"),Fe.setAttributeNS(null,"opacity","0.25"),Fe.setAttributeNS(null,"cx","5.5"),Fe.setAttributeNS(null,"cy","5.5"),Fe.setAttributeNS(null,"r","5.4999962");const Ne=L.createNS("http://www.w3.org/2000/svg","circle");Ne.setAttributeNS(null,"fill","#FFFFFF"),Ne.setAttributeNS(null,"cx","5.5"),Ne.setAttributeNS(null,"cy","5.5"),Ne.setAttributeNS(null,"r","5.4999962"),Ce.appendChild(Fe),Ce.appendChild(Ne),k.appendChild(B),k.appendChild(Z),k.appendChild(he),k.appendChild(_e),k.appendChild(Ce),f.appendChild(k),f.setAttributeNS(null,"height",v*this._scale+"px"),f.setAttributeNS(null,"width",w*this._scale+"px"),this._element.appendChild(f),this._offset=s.P.convert(l&&l.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(f=>{f.preventDefault()})),this._element.addEventListener("mousedown",(f=>{f.preventDefault()})),pm(this._element,this._anchor,"marker"),l&&l.className)for(const f of l.className.split(" "))this._element.classList.add(f);this._popup=null}addTo(l){return this.remove(),this._map=l,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",l._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),l.getCanvasContainer().appendChild(this._element),l.on("move",this._update),l.on("moveend",this._update),l.on("terrain",this._update),l.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),L.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=s.V.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const w=Math.abs(13.5)/Math.SQRT2;l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[w,-1*(38.1-13.5+w)],"bottom-right":[-w,-1*(38.1-13.5+w)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(l){return this._subpixelPositioning=l,this}getPopup(){return this._popup}togglePopup(){const l=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:l?(l.isOpen()?l.remove():(l.setLngLat(this._lngLat),l.addTo(this._map)),this):this}_updateOpacity(l=!1){var f,v;const w=(f=this._map)===null||f===void 0?void 0:f.terrain,I=this._map.transform.isLocationOccluded(this._lngLat);if(!w||I){const _e=I?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==_e&&(this._element.style.opacity=_e))}if(l)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const k=this._map,B=k.terrain.depthAtPoint(this._pos),W=k.terrain.getElevationForLngLat(this._lngLat,k.transform);if(k.transform.lngLatToCameraDepth(this._lngLat,W)-B<.006)return void(this._element.style.opacity=this._opacity);const Z=-this._offset.y/k.transform.pixelsPerMeter,J=Math.sin(k.getPitch()*Math.PI/180)*Z,he=k.terrain.depthAtPoint(new s.P(this._pos.x,this._pos.y-this._offset.y)),ue=k.transform.lngLatToCameraDepth(this._lngLat,W+J)-he>.006;!((v=this._popup)===null||v===void 0)&&v.isOpen()&&ue&&this._popup.remove(),this._element.style.opacity=ue?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(l){return this._offset=s.P.convert(l),this._update(),this}addClassName(l){this._element.classList.add(l)}removeClassName(l){this._element.classList.remove(l)}toggleClassName(l){return this._element.classList.toggle(l)}setDraggable(l){return this._draggable=!!l,this._map&&(l?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l&&l!=="auto"?l:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(l,f){return(this._opacity===void 0||l===void 0&&f===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),l!==void 0&&(this._opacity=l),f!==void 0&&(this._opacityWhenCovered=f),this._map&&this._updateOpacity(!0),this}}const q_={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let td=0,ju=!1;const W_={maxWidth:100,unit:"metric"};function If(A,l,f){const v=f&&f.maxWidth||100,w=A._container.clientHeight/2,I=A._container.clientWidth/2,k=A.unproject([I-v/2,w]),B=A.unproject([I+v/2,w]),W=Math.round(A.project(B).x-A.project(k).x),Z=Math.min(v,W,A._container.clientWidth),J=k.distanceTo(B);if(f&&f.unit==="imperial"){const he=3.2808*J;he>5280?Gu(l,Z,he/5280,A._getUIString("ScaleControl.Miles")):Gu(l,Z,he,A._getUIString("ScaleControl.Feet"))}else f&&f.unit==="nautical"?Gu(l,Z,J/1852,A._getUIString("ScaleControl.NauticalMiles")):J>=1e3?Gu(l,Z,J/1e3,A._getUIString("ScaleControl.Kilometers")):Gu(l,Z,J,A._getUIString("ScaleControl.Meters"))}function Gu(A,l,f,v){const w=(function(I){const k=Math.pow(10,`${Math.floor(I)}`.length-1);let B=I/k;return B=B>=10?10:B>=5?5:B>=3?3:B>=2?2:B>=1?1:(function(W){const Z=Math.pow(10,Math.ceil(-Math.log(W)/Math.LN10));return Math.round(W*Z)/Z})(B),k*B})(f);A.style.width=l*(w/f)+"px",A.innerHTML=`${w}&nbsp;${v}`}const H_={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},mm=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function gm(A){if(A){if(typeof A=="number"){const l=Math.round(Math.abs(A)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,A),"top-left":new s.P(l,l),"top-right":new s.P(-l,l),bottom:new s.P(0,-A),"bottom-left":new s.P(l,-l),"bottom-right":new s.P(-l,-l),left:new s.P(A,0),right:new s.P(-A,0)}}if(A instanceof s.P||Array.isArray(A)){const l=s.P.convert(A);return{center:l,top:l,"top-left":l,"top-right":l,bottom:l,"bottom-left":l,"bottom-right":l,left:l,right:l}}return{center:s.P.convert(A.center||[0,0]),top:s.P.convert(A.top||[0,0]),"top-left":s.P.convert(A["top-left"]||[0,0]),"top-right":s.P.convert(A["top-right"]||[0,0]),bottom:s.P.convert(A.bottom||[0,0]),"bottom-left":s.P.convert(A["bottom-left"]||[0,0]),"bottom-right":s.P.convert(A["bottom-right"]||[0,0]),left:s.P.convert(A.left||[0,0]),right:s.P.convert(A.right||[0,0])}}return gm(new s.P(0,0))}const Z_=d;c.AJAXError=s.cI,c.Event=s.l,c.Evented=s.E,c.LngLat=s.V,c.MercatorCoordinate=s.a9,c.Point=s.P,c.addProtocol=s.cJ,c.config=s.c,c.removeProtocol=s.cK,c.AttributionControl=U_,c.BoxZoomHandler=Jh,c.CanvasSource=ee,c.CooperativeGesturesHandler=Mi,c.DoubleClickZoomHandler=V_,c.DragPanHandler=q0,c.DragRotateHandler=Ba,c.EdgeInsets=Dc,c.FullscreenControl=class extends s.E{constructor(A={}){super(),this._onFullscreenChange=()=>{var l;let f=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((l=f?.shadowRoot)===null||l===void 0)&&l.fullscreenElement;)f=f.shadowRoot.fullscreenElement;f===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,A&&A.container&&(A.container instanceof HTMLElement?this._container=A.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(A){return this._map=A,this._container||(this._container=this._map.getContainer()),this._controlContainer=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){L.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const A=this._fullscreenButton=L.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);L.create("span","maplibregl-ctrl-icon",A).setAttribute("aria-hidden","true"),A.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const A=this._getTitle();this._fullscreenButton.setAttribute("aria-label",A),this._fullscreenButton.title=A}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new s.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},c.GeoJSONSource=Ze,c.GeolocateControl=class extends s.E{constructor(A){super(),this._onSuccess=l=>{if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new s.l("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.l("geolocate",l)),this._finish()}},this._updateCamera=l=>{const f=new s.V(l.coords.longitude,l.coords.latitude),v=l.coords.accuracy,w=this._map.getBearing(),I=s.e({bearing:w},this.options.fitBoundsOptions),k=Ae.fromLngLat(f,v);this._map.fitBounds(k,I,{geolocateSource:!0})},this._updateMarker=l=>{if(l){const f=new s.V(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(f).addTo(this._map),this._userLocationDotMarker.setLngLat(f).addTo(this._map),this._accuracy=l.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=l=>{if(this._map){if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&ju)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.l("error",l)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(l=>l.preventDefault())),this._geolocateButton=L.create("button","maplibregl-ctrl-geolocate",this._container),L.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=l=>{if(this._map){if(l===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}else{const f=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=L.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Pf({element:this._dotElement}),this._circleElement=L.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Pf({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(f=>{const v=f?.[0]instanceof ResizeObserverEntry;f.geolocateSource||this._watchState!=="ACTIVE_LOCK"||v||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.l("trackuserlocationend")),this.fire(new s.l("userlocationlostfocus")))}))}},this.options=s.e({},q_,A)}onAdd(A){return this._map=A,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return s._(this,arguments,void 0,(function*(l=!1){if(ac!==void 0&&!l)return ac;if(window.navigator.permissions===void 0)return ac=!!window.navigator.geolocation,ac;try{ac=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ac=!!window.navigator.geolocation}return ac}))})().then((l=>this._finishSetupUI(l))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),L.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,td=0,ju=!1}_isOutOfMapMaxBounds(A){const l=this._map.getMaxBounds(),f=A.coords;return l&&(f.longitude<l.getWest()||f.longitude>l.getEast()||f.latitude<l.getSouth()||f.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const A=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&A))return;const l=this._map.project(A),f=this._map.unproject([l.x+100,l.y]),v=A.distanceTo(f)/100,w=2*this._accuracy/v;this._circleElement.style.width=`${w.toFixed(2)}px`,this._circleElement.style.height=`${w.toFixed(2)}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":td--,ju=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.l("trackuserlocationstart")),this.fire(new s.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let A;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),td++,td>1?(A={maximumAge:6e5,timeout:0},ju=!0):(A=this.options.positionOptions,ju=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,A)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},c.GlobeControl=class{constructor(){this._toggleProjection=()=>{var A;const l=(A=this._map.getProjection())===null||A===void 0?void 0:A.type;this._map.setProjection(l!=="mercator"&&l?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var A;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((A=this._map.getProjection())===null||A===void 0?void 0:A.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(A){return this._map=A,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=L.create("button","maplibregl-ctrl-globe",this._container),L.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){L.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},c.Hash=D_,c.ImageSource=yt,c.KeyboardHandler=qn,c.LngLatBounds=Ae,c.LogoControl=W0,c.Map=class extends lo{constructor(A){var l,f;s.cG.mark(s.cH.create);const v=Object.assign(Object.assign(Object.assign({},dm),A),{canvasContextAttributes:Object.assign(Object.assign({},dm.canvasContextAttributes),A.canvasContextAttributes)});if(v.minZoom!=null&&v.maxZoom!=null&&v.minZoom>v.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(v.minPitch!=null&&v.maxPitch!=null&&v.minPitch>v.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(v.minPitch!=null&&v.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(v.maxPitch!=null&&v.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const w=new Yl,I=new gl;if(v.minZoom!==void 0&&w.setMinZoom(v.minZoom),v.maxZoom!==void 0&&w.setMaxZoom(v.maxZoom),v.minPitch!==void 0&&w.setMinPitch(v.minPitch),v.maxPitch!==void 0&&w.setMaxPitch(v.maxPitch),v.renderWorldCopies!==void 0&&w.setRenderWorldCopies(v.renderWorldCopies),v.transformConstrain!==null&&w.setConstrainOverride(v.transformConstrain),super(w,I,{bearingSnap:v.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new F1,this._controls=[],this._mapId=s.af(),this._lostContextStyle={style:null,images:null},this._contextLost=B=>{B.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const W of Object.values(this.style._layers))if(W.type==="custom"&&console.warn(`Custom layer with id '${W.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),W._listeners)for(const[Z]of Object.entries(W._listeners))console.warn(`Custom layer with id '${W.id}' had event listeners for event '${Z}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new s.l("webglcontextlost",{originalEvent:B}))},this._contextRestored=B=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new s.l("webglcontextrestored",{originalEvent:B}))},this._onMapScroll=B=>{if(B.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=v.interactive,this._maxTileCacheSize=v.maxTileCacheSize,this._maxTileCacheZoomLevels=v.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},v.canvasContextAttributes),this._trackResize=v.trackResize===!0,this._bearingSnap=v.bearingSnap,this._centerClampedToGround=v.centerClampedToGround,this._refreshExpiredTiles=v.refreshExpiredTiles===!0,this._fadeDuration=v.fadeDuration,this._crossSourceCollisions=v.crossSourceCollisions===!0,this._collectResourceTiming=v.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},hm),v.locale),this._clickTolerance=v.clickTolerance,this._overridePixelRatio=v.pixelRatio,this._maxCanvasSize=v.maxCanvasSize,this._zoomLevelsToOverscale=v.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=v.transformCameraUpdate,this.transformConstrain=v.transformConstrain,this.cancelPendingTileRequestsWhileZooming=v.cancelPendingTileRequestsWhileZooming===!0,v.reduceMotion!==void 0&&(b.prefersReducedMotion=v.reduceMotion),this._imageQueueHandle=G.addThrottleControl((()=>this.isMoving())),this._requestManager=new N(v.transformRequest),typeof v.container=="string"){if(this._container=document.getElementById(v.container),!this._container)throw new Error(`Container '${v.container}' not found.`)}else{if(!(v.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=v.container}if(v.maxBounds&&this.setMaxBounds(v.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let B=!1;const W=k_((Z=>{this._trackResize&&!this._removed&&(this.resize(Z),this.redraw())}),50);this._resizeObserver=new ResizeObserver((Z=>{B?W(Z):B=!0})),this._resizeObserver.observe(this._container)}this.handlers=new um(this,v),this._hash=v.hash&&new D_(typeof v.hash=="string"&&v.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:v.center,elevation:v.elevation,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch,roll:v.roll}),v.bounds&&(this.resize(),this.fitBounds(v.bounds,s.e({},v.fitBoundsOptions,{duration:0}))));const k=typeof v.style=="string"||((f=(l=v.style)===null||l===void 0?void 0:l.projection)===null||f===void 0?void 0:f.type)!=="globe";this.resize(null,k),this._localIdeographFontFamily=v.localIdeographFontFamily,this._validateStyle=v.validateStyle,v.style&&this.setStyle(v.style,{localIdeographFontFamily:v.localIdeographFontFamily}),v.attributionControl&&this.addControl(new U_(typeof v.attributionControl=="boolean"?void 0:v.attributionControl)),v.maplibreLogo&&this.addControl(new W0,v.logoPosition),this.on("style.load",(()=>{if(k||this._resizeTransform(),this.transform.unmodified){const B=s.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(B)}})),this.on("data",(B=>{this._update(B.dataType==="style"),this.fire(new s.l(`${B.dataType}data`,B))})),this.on("dataloading",(B=>{this.fire(new s.l(`${B.dataType}dataloading`,B))})),this.on("dataabort",(B=>{this.fire(new s.l("sourcedataabort",B))}))}_getMapId(){return this._mapId}setGlobalStateProperty(A,l){return this.style.setGlobalStateProperty(A,l),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(A,l){if(l===void 0&&(l=A.getDefaultPosition?A.getDefaultPosition():"top-right"),!A||!A.onAdd)return this.fire(new s.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=A.onAdd(this);this._controls.push(A);const v=this._controlPositions[l];return l.indexOf("bottom")!==-1?v.insertBefore(f,v.firstChild):v.appendChild(f),this}removeControl(A){if(!A||!A.onRemove)return this.fire(new s.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(A);return l>-1&&this._controls.splice(l,1),A.onRemove(this),this}hasControl(A){return this._controls.indexOf(A)>-1}coveringTiles(A){return Un(this.transform,A)}calculateCameraOptionsFromTo(A,l,f,v){return v==null&&this.terrain&&(v=this.terrain.getElevationForLngLat(f,this.transform)),super.calculateCameraOptionsFromTo(A,l,f,v)}resize(A,l=!0){const[f,v]=this._containerDimensions(),w=this._getClampedPixelRatio(f,v);if(this._resizeCanvas(f,v,w),this.painter.resize(f,v,w),this.painter.overLimit()){const k=this.painter.context.gl;this._maxCanvasSize=[k.drawingBufferWidth,k.drawingBufferHeight];const B=this._getClampedPixelRatio(f,v);this._resizeCanvas(f,v,B),this.painter.resize(f,v,B)}this._resizeTransform(l);const I=!this._moving;return I&&(this.stop(),this.fire(new s.l("movestart",A)).fire(new s.l("move",A))),this.fire(new s.l("resize",A)),I&&this.fire(new s.l("moveend",A)),this}_resizeTransform(A=!0){var l;const[f,v]=this._containerDimensions();this.transform.resize(f,v,A),(l=this._requestedCameraState)===null||l===void 0||l.resize(f,v,A)}_getClampedPixelRatio(A,l){const{0:f,1:v}=this._maxCanvasSize,w=this.getPixelRatio(),I=A*w,k=l*w;return Math.min(I>f?f/I:1,k>v?v/k:1)*w}getPixelRatio(){var A;return(A=this._overridePixelRatio)!==null&&A!==void 0?A:devicePixelRatio}setPixelRatio(A){this._overridePixelRatio=A,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(A){return this.transform.setMaxBounds(Ae.convert(A)),this._update()}setMinZoom(A){if((A=A??-2)>=-2&&A<=this.transform.maxZoom){const l=this._getTransformForUpdate();return l.setMinZoom(A),this._applyUpdatedTransform(l),this._update(),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(A){if((A=A??22)>=this.transform.minZoom){const l=this._getTransformForUpdate();return l.setMaxZoom(A),this._applyUpdatedTransform(l),this._update(),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(A){if((A=A??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(A>=0&&A<=this.transform.maxPitch)return this.transform.setMinPitch(A),this._update(),this.getPitch()<A&&this.setPitch(A),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(A){if((A=A??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(A>=this.transform.minPitch)return this.transform.setMaxPitch(A),this._update(),this.getPitch()>A&&this.setPitch(A),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(A){return this.transform.setRenderWorldCopies(A),this._update()}setTransformConstrain(A){return this.transform.setConstrainOverride(A),this._update()}project(A){return this.transform.locationToScreenPoint(s.V.convert(A),this.style&&this.terrain)}unproject(A){return this.transform.screenPointToLocation(s.P.convert(A),this.terrain)}isMoving(){var A;return this._moving||((A=this.handlers)===null||A===void 0?void 0:A.isMoving())}isZooming(){var A;return this._zooming||((A=this.handlers)===null||A===void 0?void 0:A.isZooming())}isRotating(){var A;return this._rotating||((A=this.handlers)===null||A===void 0?void 0:A.isRotating())}_createDelegatedListener(A,l,f){if(A==="mouseenter"||A==="mouseover"){let v=!1;return{layers:l,listener:f,delegates:{mousemove:I=>{const k=l.filter((W=>this.getLayer(W))),B=k.length!==0?this.queryRenderedFeatures(I.point,{layers:k}):[];B.length?v||(v=!0,f.call(this,new As(A,this,I.originalEvent,{features:B}))):v=!1},mouseout:()=>{v=!1}}}}if(A==="mouseleave"||A==="mouseout"){let v=!1;return{layers:l,listener:f,delegates:{mousemove:k=>{const B=l.filter((W=>this.getLayer(W)));(B.length!==0?this.queryRenderedFeatures(k.point,{layers:B}):[]).length?v=!0:v&&(v=!1,f.call(this,new As(A,this,k.originalEvent)))},mouseout:k=>{v&&(v=!1,f.call(this,new As(A,this,k.originalEvent)))}}}}{const v=w=>{const I=l.filter((B=>this.getLayer(B))),k=I.length!==0?this.queryRenderedFeatures(w.point,{layers:I}):[];k.length&&(w.features=k,f.call(this,w),delete w.features)};return{layers:l,listener:f,delegates:{[A]:v}}}}_saveDelegatedListener(A,l){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[A]=this._delegatedListeners[A]||[],this._delegatedListeners[A].push(l)}_removeDelegatedListener(A,l,f){if(!this._delegatedListeners||!this._delegatedListeners[A])return;const v=this._delegatedListeners[A];for(let w=0;w<v.length;w++){const I=v[w];if(I.listener===f&&I.layers.length===l.length&&I.layers.every((k=>l.includes(k)))){for(const k in I.delegates)this.off(k,I.delegates[k]);return void v.splice(w,1)}}}on(A,l,f){if(f===void 0)return super.on(A,l);const v=typeof l=="string"?[l]:l,w=this._createDelegatedListener(A,v,f);this._saveDelegatedListener(A,w);for(const I in w.delegates)this.on(I,w.delegates[I]);return{unsubscribe:()=>{this._removeDelegatedListener(A,v,f)}}}once(A,l,f){if(f===void 0)return super.once(A,l);const v=typeof l=="string"?[l]:l,w=this._createDelegatedListener(A,v,f);for(const I in w.delegates){const k=w.delegates[I];w.delegates[I]=(...B)=>{this._removeDelegatedListener(A,v,f),k(...B)}}this._saveDelegatedListener(A,w);for(const I in w.delegates)this.once(I,w.delegates[I]);return this}off(A,l,f){return f===void 0?super.off(A,l):(this._removeDelegatedListener(A,typeof l=="string"?[l]:l,f),this)}queryRenderedFeatures(A,l){if(!this.style)return[];let f;const v=A instanceof s.P||Array.isArray(A),w=v?A:[[0,0],[this.transform.width,this.transform.height]];if(l=l||(v?{}:A)||{},w instanceof s.P||typeof w[0]=="number")f=[s.P.convert(w)];else{const I=s.P.convert(w[0]),k=s.P.convert(w[1]);f=[I,new s.P(k.x,I.y),k,new s.P(I.x,k.y),I]}return this.style.queryRenderedFeatures(f,l,this.transform)}querySourceFeatures(A,l){return this.style.querySourceFeatures(A,l)}setStyle(A,l){return(l=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},l)).diff!==!1&&l.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&A?(this._diffStyle(A,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._updateStyle(A,l))}setTransformRequest(A){return this._requestManager.setTransformRequest(A),this}_getUIString(A){const l=this._locale[A];if(l==null)throw new Error(`Missing UI string '${A}'`);return l}_updateStyle(A,l){var f,v;if(l.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(A,l)));const w=this.style&&l.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!A)),A?(this.style=new ic(this,l||{}),this.style.setEventedParent(this,{style:this.style}),typeof A=="string"?this.style.loadURL(A,l,w):this.style.loadJSON(A,l,w),this):((v=(f=this.style)===null||f===void 0?void 0:f.projection)===null||v===void 0||v.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ic(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(A,l){if(typeof A=="string"){const f=this._requestManager.transformRequest(A,"Style");s.j(f,new AbortController).then((v=>{this._updateDiff(v.data,l)})).catch((v=>{v&&this.fire(new s.k(v))}))}else typeof A=="object"&&this._updateDiff(A,l)}_updateDiff(A,l){try{this.style.setState(A,l)&&this._update(!0)}catch(f){s.w(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(A,l)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(A,l){return this._lazyInitEmptyStyle(),this.style.addSource(A,l),this._update(!0)}isSourceLoaded(A){const l=this.style&&this.style.tileManagers[A];if(l!==void 0)return l.loaded();this.fire(new s.k(new Error(`There is no tile manager with ID '${A}'`)))}setTerrain(A){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),A){const l=this.style.tileManagers[A.source];if(!l)throw new Error(`cannot load terrain, because there exists no source with ID: ${A.source}`);this.terrain===null&&l.reload();for(const f in this.style._layers){const v=this.style._layers[f];v.type==="hillshade"&&v.source===A.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),v.type==="color-relief"&&v.source===A.source&&s.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ir(this.painter,l,A),this.painter.renderToTexture=new Cf(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=f=>{var v;f.dataType==="style"?this.terrain.tileManager.freeRtt():f.dataType==="source"&&f.tile&&(f.sourceId!==A.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((v=f.source)===null||v===void 0?void 0:v.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(f.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new s.l("terrain",{terrain:A})),this}getTerrain(){var A,l;return(l=(A=this.terrain)===null||A===void 0?void 0:A.options)!==null&&l!==void 0?l:null}areTilesLoaded(){const A=this.style&&this.style.tileManagers;for(const l of Object.values(A))if(!l.areTilesLoaded())return!1;return!0}removeSource(A){return this.style.removeSource(A),this._update(!0)}getSource(A){return this.style.getSource(A)}setSourceTileLodParams(A,l,f){if(f){const v=this.getSource(f);if(!v)throw new Error(`There is no source with ID "${f}", cannot set LOD parameters`);v.calculateTileZoom=yn(Math.max(1,A),Math.max(1,l))}else for(const v in this.style.tileManagers)this.style.tileManagers[v].getSource().calculateTileZoom=yn(Math.max(1,A),Math.max(1,l));return this._update(!0),this}refreshTiles(A,l){const f=this.style.tileManagers[A];if(!f)throw new Error(`There is no tile manager with ID "${A}", cannot refresh tile`);l===void 0?f.reload(!0):f.refreshTiles(l.map((v=>new s.ac(v.z,v.x,v.y))))}addImage(A,l,f={}){const{pixelRatio:v=1,sdf:w=!1,stretchX:I,stretchY:k,content:B,textFitWidth:W,textFitHeight:Z}=f;if(this._lazyInitEmptyStyle(),!(l instanceof HTMLImageElement||s.b(l))){if(l.width===void 0||l.height===void 0)return this.fire(new s.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:J,height:he,data:ue}=l,_e=l;return this.style.addImage(A,{data:new s.R({width:J,height:he},new Uint8Array(ue)),pixelRatio:v,stretchX:I,stretchY:k,content:B,textFitWidth:W,textFitHeight:Z,sdf:w,version:0,userImage:_e}),_e.onAdd&&_e.onAdd(this,A),this}}{const{width:J,height:he,data:ue}=b.getImageData(l);this.style.addImage(A,{data:new s.R({width:J,height:he},ue),pixelRatio:v,stretchX:I,stretchY:k,content:B,textFitWidth:W,textFitHeight:Z,sdf:w,version:0})}}updateImage(A,l){const f=this.style.getImage(A);if(!f)return this.fire(new s.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=l instanceof HTMLImageElement||s.b(l)?b.getImageData(l):l,{width:w,height:I,data:k}=v;if(w===void 0||I===void 0)return this.fire(new s.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(w!==f.data.width||I!==f.data.height)return this.fire(new s.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const B=!(l instanceof HTMLImageElement||s.b(l));return f.data.replace(k,B),this.style.updateImage(A,f),this}getImage(A){return this.style.getImage(A)}hasImage(A){return A?!!this.style.getImage(A):(this.fire(new s.k(new Error("Missing required image id"))),!1)}removeImage(A){this.style.removeImage(A)}loadImage(A){return G.getImage(this._requestManager.transformRequest(A,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(A,l){return this._lazyInitEmptyStyle(),this.style.addLayer(A,l),this._update(!0)}moveLayer(A,l){return this.style.moveLayer(A,l),this._update(!0)}removeLayer(A){return this.style.removeLayer(A),this._update(!0)}getLayer(A){return this.style.getLayer(A)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(A,l,f){return this.style.setLayerZoomRange(A,l,f),this._update(!0)}setFilter(A,l,f={}){return this.style.setFilter(A,l,f),this._update(!0)}getFilter(A){return this.style.getFilter(A)}setPaintProperty(A,l,f,v={}){return this.style.setPaintProperty(A,l,f,v),this._update(!0)}getPaintProperty(A,l){return this.style.getPaintProperty(A,l)}setLayoutProperty(A,l,f,v={}){return this.style.setLayoutProperty(A,l,f,v),this._update(!0)}getLayoutProperty(A,l){return this.style.getLayoutProperty(A,l)}setGlyphs(A,l={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(A,l),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(A,l,f={}){return this._lazyInitEmptyStyle(),this.style.addSprite(A,l,f,(v=>{v||this._update(!0)})),this}removeSprite(A){return this._lazyInitEmptyStyle(),this.style.removeSprite(A),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(A,l={}){return this._lazyInitEmptyStyle(),this.style.setSprite(A,l,(f=>{f||this._update(!0)})),this}setLight(A,l={}){return this._lazyInitEmptyStyle(),this.style.setLight(A,l),this._update(!0)}getLight(){return this.style.getLight()}setSky(A,l={}){return this._lazyInitEmptyStyle(),this.style.setSky(A,l),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(A,l){return this.style.setFeatureState(A,l),this._update()}removeFeatureState(A,l){return this.style.removeFeatureState(A,l),this._update()}getFeatureState(A){return this.style.getFeatureState(A)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let A=0,l=0;return this._container&&(A=this._container.clientWidth||400,l=this._container.clientHeight||300),[A,l]}_setupContainer(){const A=this._container;A.classList.add("maplibregl-map");const l=this._canvasContainer=L.create("div","maplibregl-canvas-container",A);this._interactive&&l.classList.add("maplibregl-interactive"),this._canvas=L.create("canvas","maplibregl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const f=this._containerDimensions(),v=this._getClampedPixelRatio(f[0],f[1]);this._resizeCanvas(f[0],f[1],v);const w=this._controlContainer=L.create("div","maplibregl-control-container",A),I=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((k=>{I[k]=L.create("div",`maplibregl-ctrl-${k} `,w)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(A,l,f){this._canvas.width=Math.floor(f*A),this._canvas.height=Math.floor(f*l),this._canvas.style.width=`${A}px`,this._canvas.style.height=`${l}px`}_setupPainter(){const A=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let l=null;this._canvas.addEventListener("webglcontextcreationerror",(v=>{l={requestedAttributes:A},v&&(l.statusMessage=v.statusMessage,l.type=v.type)}),{once:!0});let f=null;if(f=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,A):this._canvas.getContext("webgl2",A)||this._canvas.getContext("webgl",A),!f){const v="Failed to initialize WebGL";throw l?(l.message=v,new Error(JSON.stringify(l))):new Error(v)}this.painter=new F0(f,this.transform),E.testSupport(f)}migrateProjection(A,l){super.migrateProjection(A,l),this.painter.transform=A,this.fire(new s.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(A){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||A,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(A){return this._update(),this._renderTaskQueue.add(A)}_cancelRenderFrame(A){this._renderTaskQueue.remove(A)}_render(A){var l,f,v,w,I;const k=this._idleTriggered?this._fadeDuration:0,B=((l=this.style.projection)===null||l===void 0?void 0:l.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(A),this._removed)return;let W=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const he=this.transform.zoom,ue=P();this.style.zoomHistory.update(he,ue);const _e=new s.H(he,{now:ue,fadeDuration:k,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Ce=_e.crossFadingFactor();Ce===1&&Ce===this._crossFadingFactor||(W=!0,this._crossFadingFactor=Ce),this.style.update(_e)}const Z=((f=this.style.projection)===null||f===void 0?void 0:f.transitionState)>0!==B;(v=this.style.projection)===null||v===void 0||v.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((w=this.style.projection)===null||w===void 0?void 0:w.transitionState,(I=this.style.projection)===null||I===void 0?void 0:I.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||Z)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,k,this._crossSourceCollisions,Z),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:k,showPadding:this.showPadding}),this.fire(new s.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.cG.mark(s.cH.load),this.fire(new s.l("load"))),this.style&&(this.style.hasTransitions()||W)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const J=this._sourcesDirty||this._styleDirty||this._placementDirty;return J||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.l("idle")),!this._loaded||this._fullyLoaded||J||(this._fullyLoaded=!0,s.cG.mark(s.cH.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var A;this._hash&&this._hash.remove();for(const f of this._controls)f.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),G.removeThrottleControl(this._imageQueueHandle),(A=this._resizeObserver)===null||A===void 0||A.disconnect();const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l?.loseContext&&l.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),L.remove(this._canvasContainer),L.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),s.cG.clearMetrics(),this._removed=!0,this.fire(new s.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,b.frame(this._frameRequest,(A=>{s.cG.frame(A),this._frameRequest=null;try{this._render(A)}catch(l){if(!s.Z(l)&&!(function(f){return f.message===E_})(l))throw l}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(A){this._showTileBoundaries!==A&&(this._showTileBoundaries=A,this._update())}get showPadding(){return!!this._showPadding}set showPadding(A){this._showPadding!==A&&(this._showPadding=A,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(A){this._showCollisionBoxes!==A&&(this._showCollisionBoxes=A,A?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(A){this._showOverdrawInspector!==A&&(this._showOverdrawInspector=A,this._update())}get repaint(){return!!this._repaint}set repaint(A){this._repaint!==A&&(this._repaint=A,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(A){this._vertices=A,this._update()}get version(){return j_}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(A){return this._lazyInitEmptyStyle(),this.style.setProjection(A),this._update(!0)}},c.MapMouseEvent=As,c.MapTouchEvent=vf,c.MapWheelEvent=B0,c.Marker=Pf,c.NavigationControl=class{constructor(A){this._updateZoomButtons=()=>{const l=this._map.getZoom(),f=l===this._map.getMaxZoom(),v=l===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=v,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",v.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(l,f)=>{const v=this._map._getUIString(`NavigationControl.${f}`);l.title=v,l.setAttribute("aria-label",v)},this.options=s.e({},G_,A),this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(l=>l.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(l=>this._map.zoomIn({},{originalEvent:l}))),L.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(l=>this._map.zoomOut({},{originalEvent:l}))),L.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(l=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:l}):this._map.resetNorth({},{originalEvent:l})})),this._compassIcon=L.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(A){return this._map=A,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ef(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){L.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(A,l){const f=L.create("button",A,this._container);return f.type="button",f.addEventListener("click",l),f}},c.Popup=class extends s.E{constructor(A){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&L.remove(this._content),this._container&&(L.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new s.l("close"))),this),this._onMouseUp=l=>{this._update(l.point)},this._onMouseMove=l=>{this._update(l.point)},this._onDrag=l=>{this._update(l.point)},this._update=l=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=L.create("div","maplibregl-popup",this._map.getContainer()),this._tip=L.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const k of this.options.className.split(" "))this._container.classList.add(k);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=fm(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!l)return;const f=this._flatPos=this._pos=this._trackPointer&&l?l:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&l?l:this._map.transform.locationToScreenPoint(this._lngLat));let v=this.options.anchor;const w=gm(this.options.offset);if(!v){const k=this._container.offsetWidth,B=this._container.offsetHeight;let W;W=f.y+w.bottom.y<B?["top"]:f.y>this._map.transform.height-B?["bottom"]:[],f.x<k/2?W.push("left"):f.x>this._map.transform.width-k/2&&W.push("right"),v=W.length===0?"bottom":W.join("-")}let I=f.add(w[v]);this.options.subpixelPositioning||(I=I.round()),L.setTransform(this._container,`${Af[v]} translate(${I.x}px,${I.y}px)`),pm(this._container,v,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(H_),A)}addTo(A){return this._map&&this.remove(),this._map=A,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(A){return this._lngLat=s.V.convert(A),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(A){return this.setDOMContent(document.createTextNode(A))}setHTML(A){const l=document.createDocumentFragment(),f=document.createElement("body");let v;for(f.innerHTML=A;v=f.firstChild,v;)l.appendChild(v);return this.setDOMContent(l)}getMaxWidth(){var A;return(A=this._container)===null||A===void 0?void 0:A.style.maxWidth}setMaxWidth(A){return this.options.maxWidth=A,this._update(),this}setDOMContent(A){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=L.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(A),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(A){return this._container&&this._container.classList.add(A),this}removeClassName(A){return this._container&&this._container.classList.remove(A),this}setOffset(A){return this.options.offset=A,this._update(),this}toggleClassName(A){if(this._container)return this._container.classList.toggle(A)}setSubpixelPositioning(A){this.options.subpixelPositioning=A}_createCloseButton(){this.options.closeButton&&(this._closeButton=L.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const A=this._container.querySelector(mm);A&&A.focus()}},c.RasterDEMTileSource=ie,c.RasterTileSource=ye,c.ScaleControl=class{constructor(A){this._onMove=()=>{If(this._map,this._container,this.options)},this.setUnit=l=>{this.options.unit=l,If(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},W_),A)}getDefaultPosition(){return"bottom-left"}onAdd(A){return this._map=A,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-scale",A.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){L.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},c.ScrollZoomHandler=lm,c.Style=ic,c.TerrainControl=class{constructor(A){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=A}onAdd(A){return this._map=A,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=L.create("button","maplibregl-ctrl-terrain",this._container),L.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){L.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},c.TwoFingersTouchPitchHandler=U0,c.TwoFingersTouchRotateHandler=N_,c.TwoFingersTouchZoomHandler=B_,c.TwoFingersTouchZoomRotateHandler=Sf,c.VectorTileSource=vt,c.VideoSource=Me,c.addSourceType=(A,l)=>s._(void 0,void 0,void 0,(function*(){if(pe(A))throw new Error(`A source type called "${A}" already exists.`);((f,v)=>{de[f]=v})(A,l)})),c.clearPrewarmedResources=function(){const A=Be;A&&(A.isPreloaded()&&A.numActive()===1?(A.release(De),Be=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},c.createTileMesh=Fp,c.getMaxParallelImageRequests=function(){return s.c.MAX_PARALLEL_IMAGE_REQUESTS},c.getRTLTextPluginStatus=function(){return pt().getRTLTextPluginStatus()},c.getVersion=function(){return Z_},c.getWorkerCount=function(){return ot.workerCount},c.getWorkerUrl=function(){return s.c.WORKER_URL},c.importScriptInWorkers=function(A){return Se().broadcast("IS",A)},c.isTimeFrozen=function(){return S.isFrozen()},c.now=P,c.prewarm=function(){ct().acquire(De)},c.restoreNow=function(){S.restoreNow()},c.setMaxParallelImageRequests=function(A){s.c.MAX_PARALLEL_IMAGE_REQUESTS=A},c.setNow=function(A){S.setNow(A)},c.setRTLTextPlugin=function(A,l){return pt().setRTLTextPlugin(A,l)},c.setWorkerCount=function(A){ot.workerCount=A},c.setWorkerUrl=function(A){s.c.WORKER_URL=A}}));var o=t;return o}))})(zx)),zx.exports}var rC=x8();const Io=wD(rC),w8=a5({__proto__:null,default:Io},[rC]);function Cy(n){return Object.fromEntries(Object.entries(n).filter(([e,t])=>t!=null))}function oI(n){let e;return t=>{if(t)for(let i in t){let r=e?.[i],o=t[i];r!==o&&n(i,o,r)}else if(e)for(let i in e)n(i,void 0,e[i]);e=t}}function S8(n,...e){let t=[n];for(let i of e)if(i)Array.isArray(i)&&i[0]===n?t.push(...i.slice(1)):t.push(i);else continue;if(t.length!==1)return t.length===2?t[1]:t}function T8(n){return n===!0?["has","point_count"]:n===!1?["!",["has","point_count"]]:void 0}function jg(n,e){return["case",["boolean",["feature-state","hover"],!1],e,n]}function Qw(n,e){Qi(e,!0);let t=ft(e,"id",19,()=>wp("layer")),i=ft(e,"source",3,void 0),r=ft(e,"sourceLayer",3,void 0),o=ft(e,"beforeId",3,void 0),c=ft(e,"beforeLayerType",3,void 0),s=ft(e,"paint",3,void 0),d=ft(e,"layout",3,void 0),p=ft(e,"filter",3,void 0),g=ft(e,"applyToClusters",3,void 0),_=ft(e,"requireSource",3,!0),x=ft(e,"minzoom",3,void 0),b=ft(e,"maxzoom",3,void 0),S=ft(e,"manageHoverState",3,!1),P=ft(e,"hovered",15),L=ft(e,"interactive",3,!0),E=ft(e,"hoverCursor",3,void 0),C=ft(e,"eventsIfTopMost",3,!1),D=ft(e,"children",3,void 0),O=ft(e,"onclick",3,void 0),U=ft(e,"ondblclick",3,void 0),q=ft(e,"oncontextmenu",3,void 0),G=ft(e,"onmouseenter",3,void 0),N=ft(e,"onmousemove",3,void 0),V=ft(e,"onmouseleave",3,void 0);const j=l8(),z=Kt(Ec),Q=Kt(()=>te(z).loaded),{layer:X}=_8(),re=Kt(Ec),se=Kt(()=>te(re).map),le=Kt(()=>te(re).eventTopMost),ce=Kt(()=>te(re).layerInfo),be=Kt(()=>te(re).minzoom),Ee=Kt(()=>te(re).maxzoom);wa(()=>{X.value&&te(se)&&(te(ce).delete(X.value),te(se).removeLayer(X.value))});let $e;function Ve(Ae){if(!L()||!X.value||!te(se)||C()&&te(le)(Ae)!==X.value)return;let we=Ae.features??[],vt=we[0]?.properties?.cluster_id,ye={event:Ae,map:te(se),clusterId:vt,layer:X.value,source:te(Se),features:we};switch(Ae.type){case"click":O()?.(ye);break;case"dblclick":U()?.(ye);break;case"contextmenu":q()?.(ye);break}}function nt(Ae){if(!L()||!X.value||!te(se)||C()&&te(le)(Ae)!==X.value)return;E()&&(te(se).getCanvas().style.cursor=E());let we=Ae.features??[];P(we[0]??void 0);let vt=we[0]?.properties?.cluster_id,ye={event:Ae,map:te(se),clusterId:vt,layer:X.value,source:te(Se),features:we};G()?.(ye)}function He(Ae){if(!L()||!te(se))return;if(C()&&te(le)(Ae)!==X.value){P(void 0),S()&&$e!==void 0&&(te(se).setFeatureState({source:te(Se),sourceLayer:r(),id:$e},{hover:!1}),$e=void 0);return}E()&&(te(se).getCanvas().style.cursor=E());let we=Ae.features??[],vt=we[0]?.properties?.cluster_id,ye=we[0]?.id;ye!==$e&&(S()&&($e!==void 0&&te(se).setFeatureState({source:te(Se),id:$e,sourceLayer:r()},{hover:!1}),te(se).setFeatureState({source:te(Se),id:ye,sourceLayer:r()},{hover:!0})),$e=ye,P(we[0]??void 0)),N()?.({event:Ae,map:te(se),clusterId:vt,layer:X.value,source:te(Se),features:we})}function De(Ae){if(!(!L()||!X.value||!te(se))){if(E()&&(te(se).getCanvas().style.cursor=""),P(void 0),S()&&$e!==void 0){const we={source:te(Se),id:$e,sourceLayer:r()};te(se).setFeatureState(we,{hover:!1}),$e=void 0}V()?.({map:te(se),layer:X.value,source:te(Se)})}}let ot=ii(!0);function xe(Ae){te(se)&&(te(se).off("click",Ae,Ve),te(se).off("dblclick",Ae,Ve),te(se).off("contextmenu",Ae,Ve),te(se).off("mouseenter",Ae,nt),te(se).off("mousemove",Ae,He),te(se).off("mouseleave",Ae,De))}wa(()=>{X.value&&xe(X.value)});let Be=Kt(()=>T8(g())),Je=Kt(()=>S8("all",te(Be),p())),ct=Kt(()=>x()??te(be)),xt=Kt(()=>b()??te(Ee)),Se=Kt(()=>i()||j?.value);cn(()=>{if(te(se)&&X.value!==t()&&te(Q)&&(te(Se)||!_())){X.value&&(xe(X.value),te(ce).delete(X.value));let Ae=o();if(!o()&&c()){let we=te(se).getStyle().layers,vt=typeof c()=="function"?c():ie=>ie.type===c(),ye=we?.find(vt);ye&&(Ae=ye.id)}X.value=t(),te(se).addLayer(Cy({id:X.value,type:e.type,source:te(Se),"source-layer":r(),filter:te(Je),paint:s(),layout:d(),minzoom:te(ct),maxzoom:te(xt)}),Ae),Ct(ot,!0),te(se).on("click",X.value,Ve),te(se).on("dblclick",X.value,Ve),te(se).on("contextmenu",X.value,Ve),te(se).on("mouseenter",X.value,nt),te(se).on("mousemove",X.value,He),te(se).on("mouseleave",X.value,De)}}),cn(()=>{X.value&&te(ce).set(X.value,{interactive:L()})});let me=Kt(()=>X.value?oI((Ae,we)=>{te(se)&&(te(se).style._loaded?te(se).setPaintProperty(X.value,Ae,we):te(se).once("styledata",()=>te(se).setPaintProperty(X.value,Ae,we)))}):void 0),qe=Kt(()=>X.value?oI((Ae,we)=>{te(se)&&(te(se).style._loaded?te(se).setLayoutProperty(X.value,Ae,we):te(se).once("styledata",()=>te(se).setLayoutProperty(X.value,Ae,we)))}):void 0);cn(()=>{te(me)?.(s())}),cn(()=>{te(qe)?.(d())}),cn(()=>{X.value&&te(se)&&te(se).setLayerZoomRange(X.value,te(ct),te(xt))}),cn(()=>{X.value&&te(se)&&(te(ot)?Ct(ot,!1):te(se).setFilter(X.value,te(Je)))});var st=tr(),Rt=ci(st);{var gt=Ae=>{var we=tr(),vt=ci(we);s0(vt,()=>X.value,ye=>{var ie=tr(),ae=ci(ie);hs(ae,()=>D()??ts),bt(ye,ie)}),bt(Ae,we)};Ji(Rt,Ae=>{X.value&&Ae(gt)})}bt(n,st),en()}function au(n,e){Qi(e,!0);let t=ft(e,"id",19,()=>wp("circle")),i=ft(e,"source",3,void 0),r=ft(e,"sourceLayer",3,void 0),o=ft(e,"beforeId",3,void 0),c=ft(e,"beforeLayerType",3,void 0),s=ft(e,"layout",3,void 0),d=ft(e,"filter",3,void 0),p=ft(e,"applyToClusters",3,void 0),g=ft(e,"minzoom",3,void 0),_=ft(e,"maxzoom",3,void 0),x=ft(e,"hoverCursor",3,void 0),b=ft(e,"manageHoverState",3,!1),S=ft(e,"hovered",15),P=ft(e,"eventsIfTopMost",3,!1),L=ft(e,"interactive",3,!0),E=ft(e,"children",3,void 0),C=ft(e,"onclick",3,void 0),D=ft(e,"ondblclick",3,void 0),O=ft(e,"oncontextmenu",3,void 0),U=ft(e,"onmouseenter",3,void 0),q=ft(e,"onmousemove",3,void 0),G=ft(e,"onmouseleave",3,void 0);Qw(n,{get id(){return t()},type:"circle",get source(){return i()},get sourceLayer(){return r()},get beforeId(){return o()},get beforeLayerType(){return c()},get paint(){return e.paint},get layout(){return s()},get filter(){return d()},get applyToClusters(){return p()},get minzoom(){return g()},get maxzoom(){return _()},get hoverCursor(){return x()},get manageHoverState(){return b()},get eventsIfTopMost(){return P()},get interactive(){return L()},get onclick(){return C()},get ondblclick(){return D()},get oncontextmenu(){return O()},get onmouseenter(){return U()},get onmousemove(){return q()},get onmouseleave(){return G()},get hovered(){return S()},set hovered(N){S(N)},children:(N,V)=>{var j=tr(),z=ci(j);hs(z,()=>E()??ts),bt(N,j)},$$slots:{default:!0}}),en()}var M8=qt("<div><!></div>");function aF(n,e){Qi(e,!0);let t=ft(e,"defaultStyling",3,!0),i=ft(e,"position",3,"top-right"),r=ft(e,"class",3,void 0);const o=Kt(Ec),c=Kt(()=>te(o).map);let s=ii(void 0),d={onAdd(){return te(s)},onRemove(){te(s)?.parentNode?.removeChild(te(s))}};cn(()=>{te(c)?.addControl(d,i())}),wa(()=>{te(c)?.removeControl(d)});var p=M8();let g;var _=zt(p);hs(_,()=>e.children??ts),wc(p,x=>Ct(s,x),()=>te(s)),Zi(()=>g=fp(p,1,gD(r()),null,g,{"maplibregl-ctrl":t()})),bt(n,p),en()}ds(["click"]);function sC(n,e){Qi(e,!0);let t=ft(e,"id",19,()=>wp("fill")),i=ft(e,"source",3,void 0),r=ft(e,"sourceLayer",3,void 0),o=ft(e,"beforeId",3,void 0),c=ft(e,"beforeLayerType",3,void 0),s=ft(e,"layout",3,void 0),d=ft(e,"filter",3,void 0),p=ft(e,"minzoom",3,void 0),g=ft(e,"maxzoom",3,void 0),_=ft(e,"hoverCursor",3,void 0),x=ft(e,"manageHoverState",3,!1),b=ft(e,"hovered",15),S=ft(e,"eventsIfTopMost",3,!1),P=ft(e,"interactive",3,!0),L=ft(e,"onclick",3,void 0),E=ft(e,"ondblclick",3,void 0),C=ft(e,"oncontextmenu",3,void 0),D=ft(e,"onmouseenter",3,void 0),O=ft(e,"onmousemove",3,void 0),U=ft(e,"onmouseleave",3,void 0);Qw(n,{get id(){return t()},type:"fill",get source(){return i()},get sourceLayer(){return r()},get beforeId(){return o()},get beforeLayerType(){return c()},get paint(){return e.paint},get layout(){return s()},get filter(){return d()},get minzoom(){return p()},get maxzoom(){return g()},get hoverCursor(){return _()},get manageHoverState(){return x()},get eventsIfTopMost(){return S()},get interactive(){return P()},get onclick(){return L()},get ondblclick(){return E()},get oncontextmenu(){return C()},get onmouseenter(){return D()},get onmousemove(){return O()},get onmouseleave(){return U()},get hovered(){return b()},set hovered(q){b(q)},children:(q,G)=>{var N=tr(),V=ci(N);hs(V,()=>e.children??ts),bt(q,N)},$$slots:{default:!0}}),en()}function C8(n,e){Qi(e,!0);const t=Kt(Ec),i=Kt(()=>te(t).map),r=Kt(()=>te(t).loaded);let o=ft(e,"position",3,"top-left"),c=ft(e,"container",3,void 0),s=ii(void 0),d=Kt(()=>typeof c()=="string"?document.querySelector(c())??void 0:c());cn(()=>{te(i)&&!te(s)&&(te(d)?Ct(s,new Io.FullscreenControl({container:te(d)}),!0):Ct(s,new Io.FullscreenControl,!0),te(i).addControl(te(s),o()))}),wa(()=>{te(r)&&te(s)&&te(i)?.removeControl(te(s))}),en()}function lF(n,e,t,i,r){let o=!1;n.getSource(e)&&(o=!0,n.removeSource(e));const c=()=>{i(e)&&(n.addSource(e,t),r())};if(o){const s=()=>{e&&(n.getSource(e)?setTimeout(s,1):c())};s()}else c()}function cF(n,e,t){hD().then(()=>{if(!n.loaded())return;n.getSource(e)===t&&n.removeSource(e)})}function Hs(n,e){Qi(e,!0);let t=ft(e,"id",19,()=>wp("geojson")),i=ft(e,"generateId",3,!1),r=ft(e,"promoteId",3,void 0),o=ft(e,"filter",3,void 0),c=ft(e,"lineMetrics",3,void 0),s=ft(e,"cluster",3,void 0),d=ft(e,"maxzoom",3,void 0),p=ft(e,"attribution",3,void 0),g=ft(e,"buffer",3,void 0),_=ft(e,"tolerance",3,void 0);const x=Kt(Ec),b=Kt(()=>te(x).map),S=Kt(()=>te(x).loaded),{source:P}=sF();let L=ii(void 0),E=ii(!0);cn(()=>{te(b)&&te(S)&&P.value!==t()&&(P.value=t(),lF(te(b),P.value,Cy({type:"geojson",data:e.data,filter:o(),lineMetrics:c(),generateId:i(),promoteId:r(),cluster:!!s(),clusterMinPoints:s()?.minPoints,clusterMaxZoom:s()?.maxZoom,clusterRadius:s()?.radius,clusterProperties:s()?.properties,maxzoom:d(),attribution:p(),buffer:g(),tolerance:_()}),q=>te(b)&&q===P.value,()=>{P.value&&(Ct(L,te(b).getSource(P.value),!0),Ct(E,!0))}),te(L))}),cn(()=>{te(L)&&(te(E)?Ct(E,!1):te(L).setData(e.data))});function C(){te(b)&&Ct(L,te(b).getSource(t()),!0)}cn(()=>{te(b)?.on("style.load",C)}),cn(()=>{te(L)?.setClusterOptions(Cy({cluster:!!s(),clusterMaxZoom:s()?.maxZoom,clusterRadius:s()?.radius}))}),wa(()=>{P.value&&te(L)&&te(b)&&(cF(te(b),P.value,te(L)),P.value=void 0,Ct(L,void 0))});var D=tr(),O=ci(D);{var U=q=>{var G=tr(),N=ci(G);s0(N,()=>P.value,V=>{var j=tr(),z=ci(j);hs(z,()=>e.children??ts),bt(V,j)}),bt(q,G)};Ji(O,q=>{P.value&&q(U)})}bt(n,D),en()}function E8(n,e){Qi(e,!0);const t=Kt(Ec),i=Kt(()=>te(t).map),r=Kt(()=>te(t).loaded);let o=ft(e,"position",3,"top-left"),c=ft(e,"positionOptions",3,void 0),s=ft(e,"fitBoundsOptions",3,void 0),d=ft(e,"trackUserLocation",3,!1),p=ft(e,"showAccuracyCircle",3,!0),g=ft(e,"showUserLocation",3,!0),_=ft(e,"control",15);cn(()=>{te(i)&&!_()&&(_(new Io.GeolocateControl({positionOptions:c(),fitBoundsOptions:s(),trackUserLocation:d(),showAccuracyCircle:p(),showUserLocation:g()})),te(i).addControl(_(),o()))}),wa(()=>{te(r)&&_()&&te(i)?.removeControl(_())}),en()}function zl(n,e){Qi(e,!0);let t=ft(e,"id",19,()=>wp("line")),i=ft(e,"source",3,void 0),r=ft(e,"sourceLayer",3,void 0),o=ft(e,"beforeId",3,void 0),c=ft(e,"beforeLayerType",3,void 0),s=ft(e,"layout",3,void 0),d=ft(e,"filter",3,void 0),p=ft(e,"minzoom",3,void 0),g=ft(e,"maxzoom",3,void 0),_=ft(e,"hoverCursor",3,void 0),x=ft(e,"manageHoverState",3,!1),b=ft(e,"hovered",15),S=ft(e,"eventsIfTopMost",3,!1),P=ft(e,"interactive",3,!0),L=ft(e,"children",3,void 0),E=ft(e,"onclick",3,void 0),C=ft(e,"ondblclick",3,void 0),D=ft(e,"oncontextmenu",3,void 0),O=ft(e,"onmouseenter",3,void 0),U=ft(e,"onmousemove",3,void 0),q=ft(e,"onmouseleave",3,void 0);Qw(n,{get id(){return t()},type:"line",get source(){return i()},get sourceLayer(){return r()},get beforeId(){return o()},get beforeLayerType(){return c()},get paint(){return e.paint},get layout(){return s()},get filter(){return d()},get minzoom(){return p()},get maxzoom(){return g()},get hoverCursor(){return _()},get manageHoverState(){return x()},get eventsIfTopMost(){return S()},get interactive(){return P()},get onclick(){return E()},get ondblclick(){return C()},get oncontextmenu(){return D()},get onmouseenter(){return O()},get onmousemove(){return U()},get onmouseleave(){return q()},get hovered(){return b()},set hovered(G){b(G)},children:(G,N)=>{var V=tr(),j=ci(V);hs(j,()=>L()??ts),bt(G,V)},$$slots:{default:!0}}),en()}function uF(n,e){Qi(e,!0);let t=ft(e,"layer",3,void 0),i=z6(e,["$$slots","$$events","$$legacy","layer"]);const r=Kt(Ec),o=Kt(()=>te(r).map);function c(g){return i["on"+g]}function s(g){c(g.type)?.(g)}const d=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],p=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend","pitch","rotate","wheel","data","styledata","idle"];cn(()=>{if(te(o))if(t())for(const g of d)c(g)&&te(o).on(g,t(),s);else for(const g of p)c(g)&&te(o).on(g,s)}),wa(()=>{if(te(o))if(t())for(const g of d)c(g)&&te(o).off(g,t(),s);else for(const g of p)c(g)&&te(o).off(g,s)}),en()}function A8(n){let e=n.getCenter(),t=Math.round(n.getZoom()*100)/100,i=Math.ceil((t*Math.LN2+Math.log(512/360/.5))/Math.LN10),r=Math.pow(10,i),o=Math.round(e.lat*r)/r,c=Math.round(e.lng*r)/r,s=`${t}/${o}/${c}`,d=n.getBearing(),p=n.getPitch();return(d||p)&&(s+=`/${Math.round(d*10)/10}`),p&&(s+=`/${Math.round(p)}`),`#${s}`}function P8(n){const e=n.replace("#","").split("/").map(parseFloat);return e.some(isNaN)?[]:e}var _v=oC;function oC(n,e){return n===e||n!==n&&e!==e?!0:typeof n!=typeof e||{}.toString.call(n)!={}.toString.call(e)||n!==Object(n)||!n?!1:Array.isArray(n)?aI(n,e):{}.toString.call(n)=="[object Set]"?aI(Array.from(n),Array.from(e)):{}.toString.call(n)=="[object Object]"?R8(n,e):I8(n,e)}function I8(n,e){return n.toString()===e.toString()}function aI(n,e){var t=n.length;if(t!=e.length)return!1;for(var i=0;i<t;i++)if(!oC(n[i],e[i]))return!1;return!0}function R8(n,e){var t=Object.keys(n),i=t.length;if(i!=Object.keys(e).length)return!1;for(var r=0;r<i;r++){var o=t[r];if(!(e.hasOwnProperty(o)&&oC(n[o],e[o])))return!1}return!0}const{LngLatBounds:L8,LngLat:k8}=Io;function Mb(n,e){return Math.abs(n-e)<1e-6}function D8(n,e){let t=L8.convert(n);if(!e)return{equal:!1,bounds:t};let i=t.getNorthEast(),r=e.getNorthEast();if(!Mb(i.lat,r.lat)||!Mb(i.wrap().lng,r.wrap().lng))return{equal:!1,bounds:t};let o=t.getSouthWest(),c=e.getSouthWest();return!Mb(o.lat,c.lat)||!Mb(o.wrap().lng,c.wrap().lng)?{equal:!1,bounds:t}:{equal:!0,bounds:t}}function F8(n,e){const t=n.getSouthWest(),i=n.getNorthEast();if(Array.isArray(e)){if(e.length===4)return[t.lng,t.lat,i.lng,i.lat];if(e.length===2)return e[0]instanceof k8?[t,i]:[[t.lng,t.lat],[i.lng,i.lat]]}return n}function hF(n,e){Qi(e,!0);const t=Kt(Ec),i=Kt(()=>te(t).map),r=Kt(()=>te(t).loaded);let o=ft(e,"position",3,"top-left"),c=ft(e,"showCompass",3,!0),s=ft(e,"showZoom",3,!0),d=ft(e,"visualizePitch",3,!1),p=ii(void 0);$2(()=>{te(i)&&!te(p)&&(Ct(p,new Io.NavigationControl({showCompass:c(),showZoom:s(),visualizePitch:d()}),!0),te(i).addControl(te(p),o()))}),wa(()=>{te(r)&&te(p)&&te(i)?.removeControl(te(p))}),en()}function dF(n,e){Qi(e,!0);const t=Kt(Ec),i=Kt(()=>te(t).map),r=Kt(()=>te(t).loaded);let o=ft(e,"position",3,"bottom-left"),c=ft(e,"maxWidth",3,void 0),s=ft(e,"unit",3,"metric"),d=ii(void 0);cn(()=>{te(i)&&!te(d)&&(Ct(d,new Io.ScaleControl({maxWidth:c(),unit:s()}),!0),te(i).addControl(te(d),o()))}),wa(()=>{te(r)&&te(d)&&te(i)?.removeControl(te(d))}),en()}var O8=qt("<!> <!> <!> <!>",1),z8=qt("<!> <!>",1),B8=qt('<div data-testid="map-container"><!></div>');function N8(n,e){Qi(e,!0);let t=ft(e,"map",15,void 0),i=ft(e,"mapContainer",15,void 0),r=ft(e,"class",3,void 0),o=ft(e,"diffStyleUpdates",3,!1),c=ft(e,"center",15,void 0),s=ft(e,"zoom",15,void 0),d=ft(e,"pitch",15,0),p=ft(e,"bearing",15,0),g=ft(e,"bearingSnap",3,7),_=ft(e,"bounds",15,void 0),x=ft(e,"fitBoundsOptions",19,()=>({})),b=ft(e,"hash",3,!1),S=ft(e,"projection",3,void 0),P=ft(e,"updateHash",3,we=>{window.history.replaceState(window.history.state,"",we)}),L=ft(e,"loaded",15,!1),E=ft(e,"minZoom",3,0),C=ft(e,"maxZoom",3,22),D=ft(e,"minPitch",3,0),O=ft(e,"maxPitch",3,60),U=ft(e,"renderWorldCopies",3,void 0),q=ft(e,"dragPan",3,void 0),G=ft(e,"dragRotate",3,void 0),N=ft(e,"pitchWithRotate",3,void 0),V=ft(e,"antialias",3,void 0),j=ft(e,"zoomOnDoubleClick",3,!0),z=ft(e,"locale",3,void 0),Q=ft(e,"interactive",3,!0),X=ft(e,"attributionControl",3,void 0),re=ft(e,"cooperativeGestures",3,!1),se=ft(e,"preserveDrawingBuffer",3,!1),le=ft(e,"maxBounds",3,void 0),ce=ft(e,"images",19,()=>[]),be=ft(e,"standardControls",3,!1),Ee=ft(e,"filterLayers",3,void 0),$e=ft(e,"transformRequest",3,void 0),Ve=Kt(()=>typeof be()=="boolean"?void 0:be());const nt=g8();QD(new My(void 0));let He=ii(Ss(new Set));async function De(we,vt=!1){if(t()&&!(!t()?.loaded()&&!vt))if("url"in we){te(He).add(we.id);try{let ye=await t().loadImage(we.url);t().addImage(we.id,ye.data,we.options),nt.loadedImages.add(we.id)}catch(ye){e.onerror?e.onerror({error:ye}):console.error(ye)}finally{te(He).delete(we.id)}}else t().addImage(we.id,we.data,we.options),nt.loadedImages.add(we.id)}cn(()=>{if(L()&&t()?.loaded())for(let we of ce())!nt.loadedImages.has(we.id)&&!te(He).has(we.id)&&!t().hasImage(we.id)&&De(we)});let ot=Kt(()=>ce().every(we=>nt.loadedImages.has(we.id))),xe=ii(void 0),Be=ii(void 0),Je=ii(void 0),ct=ii(void 0);function xt(we){e.onerror?e.onerror(we):we.error.name!=="AbortError"&&console.error(we.error)}function Se(we){return qe(),t(nt.map=new Io.Map(Cy({container:we,style:e.style,locale:z(),center:c(),zoom:s(),pitch:d(),bearing:p(),bearingSnap:g(),minZoom:E(),maxZoom:C(),minPitch:D(),maxPitch:O(),renderWorldCopies:U(),dragPan:q(),dragRotate:G(),pitchWithRotate:N(),antialias:V(),interactive:Q(),preserveDrawingBuffer:se(),maxBounds:le(),bounds:_(),attributionControl:X(),transformRequest:$e(),cooperativeGestures:re()}))),t().on("load",vt=>{vt.target.getContainer().setAttribute("data-testid","map"),vt.target.getCanvas().setAttribute("data-testid","map-canvas"),e.onload&&e.onload(t()),nt.loaded=!0,L(!0)}),t().on("error",xt),e.onmovestart&&t().on("movestart",e.onmovestart),t().on("moveend",vt=>{if(c(vt.target.getCenter()),s(vt.target.getZoom()),d(vt.target.getPitch()),p(vt.target.getBearing()),_(F8(vt.target.getBounds(),_())),e.onmoveend?.(vt),b()){let ye=new URL(window.location.href.replace(/(#.+)?$/,A8(vt.target)));P()(ye)}}),e.onclick&&t().on("click",e.onclick),e.ondblclick&&t().on("dblclick",e.ondblclick),e.oncontextmenu&&t().on("contextmenu",e.oncontextmenu),e.onmousemove&&t().on("mousemove",e.onmousemove),e.onzoomstart&&t().on("zoomstart",e.onzoomstart),e.onzoom&&t().on("zoom",e.onzoom),e.onzoomend&&t().on("zoomend",e.onzoomend),e.onpitch&&t().on("pitch",e.onpitch),e.onrotate&&t().on("rotate",e.onrotate),e.onwheel&&t().on("wheel",e.onwheel),e.ondata&&t().on("data",e.ondata),e.onidle&&t().on("idle",e.onidle),t().on("style.load",vt=>{if(t()){S()&&t().setProjection(S()),nt.loaded=!0,L(!0);const ye=t().getStyle();if(Ct(xe,ye.layers.map(ie=>ie.id),!0),Ct(Be,Object.keys(ye.sources),!0),te(ct))for(const[ie,ae]of Object.entries(te(ct)))t().addSource(ie,ae);if(te(Je))for(const ie of te(Je))t().addLayer(ie);for(const ie of ce())De(ie,!0);e.onstyleload?.(vt)}}),t().on("styledata",vt=>{if(t()&&Ee()){const ye=t().getStyle().layers;if(ye)for(let ie of ye)Ee()(ie)||t().setLayoutProperty(ie.id,"visibility","none")}e.onstyledata?.(vt)}),{destroy(){L(!1),nt.loaded=!1,t()?.remove()}}}let me=ii(Ss(e.style));cn(()=>{if(t()&&!_v(e.style,te(me))){const we=t().getStyle();if(te(xe)&&Ct(Je,we.layers.filter(vt=>!te(xe).includes(vt.id)),!0),te(Be)){const vt=Object.keys(we.sources).filter(ye=>!te(Be).includes(ye));Ct(ct,{},!0);for(const ye of vt)te(ct)[ye]=we.sources[ye]}Ct(me,e.style,!0),t().setStyle(e.style,{diff:o()}),nt.loadedImages.clear(),Ct(He,new Set,!0)}}),cn(()=>{if(t()){let we={};c()!=null&&!_v(c(),t().getCenter())&&(we.center=c()),s()!=null&&!_v(s(),t().getZoom())&&(we.zoom=s()),p()!=null&&!_v(p(),t().getBearing())&&(we.bearing=p()),d()!=null&&!_v(d(),t().getPitch())&&(we.pitch=d()),Object.keys(we).length&&t().easeTo(we)}}),cn(()=>{S()&&L()&&t()?.setProjection(S())}),cn(()=>{if(_()){const{equal:we,bounds:vt}=D8(_(),t()?.getBounds());we||t()?.fitBounds(vt,x())}}),cn(()=>{j()?t()?.doubleClickZoom.enable():t()?.doubleClickZoom.disable()});function qe(){if(b()){let we=P8(window.location.hash);we.length>=3&&(s(we[0]),c([we[2],we[1]])),we.length==5&&(p(we[3]),d(we[4]))}}var st=B8();Zw("hashchange",xy,qe);let Rt;var gt=zt(st);{var Ae=we=>{var vt=z8(),ye=ci(vt);{var ie=ke=>{var Ze=O8(),yt=ci(Ze);hF(yt,{get position(){return te(Ve)}});var Me=_t(yt,2);{let pe=Kt(()=>({...x(),maxZoom:12}));E8(Me,{get position(){return te(Ve)},get fitBoundsOptions(){return te(pe)}})}var ee=_t(Me,2);C8(ee,{get position(){return te(Ve)}});var de=_t(ee,2);dF(de,{get position(){return te(Ve)}}),bt(ke,Ze)};Ji(ye,ke=>{be()&&ke(ie)})}var ae=_t(ye,2);hs(ae,()=>e.children??ts,()=>({map:t(),loaded:L(),loadedImages:nt.loadedImages,allImagesLoaded:te(ot)})),bt(we,vt)};Ji(gt,we=>{t()&&we(Ae)})}wc(st,we=>i(we),()=>i()),S6(st,we=>Se?.(we)),Zi(()=>Rt=fp(st,1,gD(r()),"svelte-xbukvd",Rt,{"expand-map":!r()})),bt(n,st),en()}ds(["click","dblclick","contextmenu","mousemove","keydown"]);var $8=qt('<div class="sv-popup"><!></div>');function aC(n,e){Qi(e,!0);let t=ft(e,"closeButton",3,void 0),i=ft(e,"closeOnClickOutside",3,!0),r=ft(e,"closeOnClickInside",3,!1),o=ft(e,"closeOnMove",3,!1),c=ft(e,"openOn",3,"click"),s=ft(e,"openIfTopMost",3,!0),d=ft(e,"focusAfterOpen",3,!0),p=ft(e,"anchor",3,void 0),g=ft(e,"offset",3,void 0),_=ft(e,"popupClass",3,void 0),x=ft(e,"maxWidth",3,void 0),b=ft(e,"lngLat",15,void 0),S=ft(e,"html",3,void 0),P=ft(e,"open",15,!1),L=ft(e,"onopen",3,void 0),E=ft(e,"onclose",3,void 0),C=ft(e,"onhover",3,void 0),D=f8();const O=Kt(Ec),U=Kt(()=>te(O).map),q=Kt(()=>te(O).eventTopMost),G=Kt(()=>te(O).markerClickManager),N=Kt(()=>te(O).loaded),V=o8(),j=d8(),z=u8(),Q=["click","dblclick","contextmenu"];let X=ii(void 0),re=ii(!1),se=ii(void 0);function le(){if(!te(X))return;let gt=te(X).getElement();!gt||gt===te(se)||(Ct(se,gt,!0),c()==="hover"&&(te(se).style.pointerEvents="none"),te(se).addEventListener("mouseenter",()=>{Ct(re,!0)},{passive:!0}),te(se).addEventListener("mouseleave",()=>{Ct(re,!1)},{passive:!0}),te(se).addEventListener("click",()=>{r()&&P(!1)},{passive:!0}))}$2(()=>{te(U)&&(te(U).on("click",Je),te(U).on("contextmenu",Je),te(G).add(ct),typeof z?.value=="string"&&(te(U).on("click",z.value,nt),te(U).on("dblclick",z.value,nt),te(U).on("contextmenu",z.value,nt),te(U).on("mousemove",z.value,Be),te(U).on("mouseleave",z.value,xe),te(U).on("touchstart",z.value,De),te(U).on("touchend",z.value,ot)))}),wa(()=>{te(N)&&te(U)&&(te(X)?.remove(),te(U).off("click",Je),te(U).off("contextmenu",Je),te(G).remove(ct),z?.value instanceof Io.Marker?z.value.getPopup()===te(X)&&z.value.setPopup(void 0):typeof z?.value=="string"&&(te(U).off("click",z.value,nt),te(U).off("dblclick",z.value,nt),te(U).off("contextmenu",z.value,nt),te(U).off("mousemove",z.value,Be),te(U).off("mouseleave",z.value,xe),te(U).off("touchstart",z.value,De),te(U).off("touchend",z.value,ot)))});function ce(){if(e.canOpen&&!e.canOpen(te(Ee))){P(!1);return}P(!0)}function be(gt){return s()?!("marker"in gt)&&!v8(gt)&&te(q)(gt)!==V?.value:!1}let Ee=ii(void 0),$e=ii("normal");function Ve(gt){"layerType"in gt&&gt.layerType==="deckgl"?(b(gt.coordinate),Ct(Ee,gt.object?[gt.object]:void 0,!0)):(b(gt.lngLat),Ct(Ee,gt.features??[],!0))}function nt(gt){gt.type!==c()||be(gt)||(Ve(gt),setTimeout(ce))}let He;function De(gt){He=gt.point}function ot(gt){if(!He||c()!=="hover")return;let Ae=He.dist(gt.point);He=void 0,Ae<3&&(b(gt.lngLat),Ct(Ee,gt.features??[],!0),te(X)?.isOpen()?Ct($e,"justOpened"):(Ct($e,"opening"),ce()))}function xe(gt){c()!=="hover"||He||te($e)!=="normal"||(P(!1),Ct(Ee,void 0))}function Be(gt){if(!(c()!=="hover"||He||te($e)!=="normal")){if(be(gt)){P(!1),Ct(Ee,void 0);return}Ct(Ee,gt.features??[],!0),b(gt.lngLat),ce()}}function Je(gt){if(te($e)==="justOpened"){Ct($e,"normal");return}if(!i())return;let Ae=[te(se),z?.value instanceof Io.Marker?z.value?.getElement():void 0];P()&&te(X)?.isOpen()&&!Ae.some(we=>we?.contains(gt.originalEvent.target))&&(gt.type==="contextmenu"&&c()==="contextmenu"||gt.type!=="contextmenu")&&P(!1)}function ct(gt){i()&&P()&&te(X)?.isOpen()&&gt.marker!==z?.value&&P(!1)}wa(()=>{te(N)&&te(X)?.isOpen()&&te(X).remove()});let xt=ii(void 0),Se=Kt(()=>t()??(!i()&&!r()));cn(()=>{if(!te(X)){let gt=_()?`${_()} sv-maplibregl-popup`:"sv-maplibregl-popup";Ct(X,new Io.Popup({closeButton:te(Se),closeOnClick:!1,closeOnMove:o(),focusAfterOpen:d(),maxWidth:x(),className:gt,anchor:p(),offset:g()}),!0),Ct(se,te(X).getElement(),!0),te(X).on("open",()=>{ce(),P()&&(le(),L()?.(te(X)))}),te(X).on("close",()=>{P(!1),E()?.(te(X))}),C()&&te(X).on("hover",()=>{C()?.(te(X))})}}),cn(()=>{te(X)&&z?.value instanceof Io.Marker&&(c()==="click"?z.value.setPopup(te(X)):z.value.getPopup()===te(X)&&z.value.setPopup(void 0))}),cn(()=>{Q.includes(c())&&j.value?.type===c()&&(nt(j.value),j.value=void 0)});let me=Kt(()=>c()==="hover"&&(j.value?.type==="mousemove"||j.value?.type==="mouseenter"));cn(()=>{c()==="hover"&&j&&(te(me)&&j.value&&Ve(j.value),te(me)||te(re)?ce():P(!1))}),cn(()=>{te(xt)?te(X)?.setDOMContent(te(xt)):S()&&te(X)?.setHTML(S())}),cn(()=>{let gt=b()??D?.value??void 0;gt&&te(X)?.setLngLat(gt)}),cn(()=>{if(te(U)&&te(X)){let gt=te(X).isOpen();P()&&!gt?(te(X).addTo(te(U)),te($e)==="opening"&&Ct($e,"justOpened")):!P()&&gt&&te(X).remove()}});var qe=tr(),st=ci(qe);{var Rt=gt=>{var Ae=$8(),we=zt(Ae);{var vt=ye=>{var ie=tr(),ae=ci(ie);hs(ae,()=>e.children??ts,()=>({features:te(Ee),data:te(Ee)?.[0]??void 0,map:te(U),close:()=>P(!1),isOpen:P()})),bt(ye,ie)};Ji(we,ye=>{(te(Ee)?.length||z?.value instanceof Io.Marker||!z&&P())&&ye(vt)})}wc(Ae,ye=>Ct(xt,ye),()=>te(xt)),bt(gt,Ae)};Ji(st,gt=>{e.children&&gt(Rt)})}bt(n,qe),en()}var Mg=Math.pow,po=(n,e,t)=>new Promise((i,r)=>{var o=d=>{try{s(t.next(d))}catch(p){r(p)}},c=d=>{try{s(t.throw(d))}catch(p){r(p)}},s=d=>d.done?i(d.value):Promise.resolve(d.value).then(o,c);s((t=t.apply(n,e)).next())}),Qa=Uint8Array,ay=Uint16Array,V8=Int32Array,fF=new Qa([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),pF=new Qa([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),U8=new Qa([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),mF=function(n,e){for(var t=new ay(31),i=0;i<31;++i)t[i]=e+=1<<n[i-1];for(var r=new V8(t[30]),i=1;i<30;++i)for(var o=t[i];o<t[i+1];++o)r[o]=o-t[i]<<5|i;return{b:t,r}},gF=mF(fF,2),_F=gF.b,j8=gF.r;_F[28]=258,j8[258]=28;var G8=mF(pF,0),q8=G8.b,vF=new ay(32768);for(Hn=0;Hn<32768;++Hn)Ju=(Hn&43690)>>1|(Hn&21845)<<1,Ju=(Ju&52428)>>2|(Ju&13107)<<2,Ju=(Ju&61680)>>4|(Ju&3855)<<4,vF[Hn]=((Ju&65280)>>8|(Ju&255)<<8)>>1;var Ju,Hn,ly=function(n,e,t){for(var i=n.length,r=0,o=new ay(e);r<i;++r)n[r]&&++o[n[r]-1];var c=new ay(e);for(r=1;r<e;++r)c[r]=c[r-1]+o[r-1]<<1;var s;{s=new ay(1<<e);var d=15-e;for(r=0;r<i;++r)if(n[r])for(var p=r<<4|n[r],g=e-n[r],_=c[n[r]-1]++<<g,x=_|(1<<g)-1;_<=x;++_)s[vF[_]>>d]=p}return s},a0=new Qa(288);for(Hn=0;Hn<144;++Hn)a0[Hn]=8;var Hn;for(Hn=144;Hn<256;++Hn)a0[Hn]=9;var Hn;for(Hn=256;Hn<280;++Hn)a0[Hn]=7;var Hn;for(Hn=280;Hn<288;++Hn)a0[Hn]=8;var Hn,yF=new Qa(32);for(Hn=0;Hn<32;++Hn)yF[Hn]=5;var Hn,W8=ly(a0,9),H8=ly(yF,5),GS=function(n){for(var e=n[0],t=1;t<n.length;++t)n[t]>e&&(e=n[t]);return e},pc=function(n,e,t){var i=e/8|0;return(n[i]|n[i+1]<<8)>>(e&7)&t},qS=function(n,e){var t=e/8|0;return(n[t]|n[t+1]<<8|n[t+2]<<16)>>(e&7)},Z8=function(n){return(n+7)/8|0},X8=function(n,e,t){(t==null||t>n.length)&&(t=n.length);var i=new Qa(t-e);return i.set(n.subarray(e,t)),i},Y8=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Xa=function(n,e,t){var i=new Error(e||Y8[n]);if(i.code=n,Error.captureStackTrace&&Error.captureStackTrace(i,Xa),!t)throw i;return i},lC=function(n,e,t,i){var r=n.length,o=0;if(!r||e.f&&!e.l)return t||new Qa(0);var c=!t||e.i!=2,s=e.i;t||(t=new Qa(r*3));var d=function(xt){var Se=t.length;if(xt>Se){var me=new Qa(Math.max(Se*2,xt));me.set(t),t=me}},p=e.f||0,g=e.p||0,_=e.b||0,x=e.l,b=e.d,S=e.m,P=e.n,L=r*8;do{if(!x){p=pc(n,g,1);var E=pc(n,g+1,3);if(g+=3,E)if(E==1)x=W8,b=H8,S=9,P=5;else if(E==2){var U=pc(n,g,31)+257,q=pc(n,g+10,15)+4,G=U+pc(n,g+5,31)+1;g+=14;for(var N=new Qa(G),V=new Qa(19),j=0;j<q;++j)V[U8[j]]=pc(n,g+j*3,7);g+=q*3;for(var z=GS(V),Q=(1<<z)-1,X=ly(V,z),j=0;j<G;){var re=X[pc(n,g,Q)];g+=re&15;var C=re>>4;if(C<16)N[j++]=C;else{var se=0,le=0;for(C==16?(le=3+pc(n,g,3),g+=2,se=N[j-1]):C==17?(le=3+pc(n,g,7),g+=3):C==18&&(le=11+pc(n,g,127),g+=7);le--;)N[j++]=se}}var ce=N.subarray(0,U),be=N.subarray(U);S=GS(ce),P=GS(be),x=ly(ce,S),b=ly(be,P)}else Xa(1);else{var C=Z8(g)+4,D=n[C-4]|n[C-3]<<8,O=C+D;if(O>r){s&&Xa(0);break}c&&d(_+D),t.set(n.subarray(C,O),_),e.b=_+=D,e.p=g=O*8,e.f=p;continue}if(g>L){s&&Xa(0);break}}c&&d(_+131072);for(var Ee=(1<<S)-1,$e=(1<<P)-1,Ve=g;;Ve=g){var se=x[qS(n,g)&Ee],nt=se>>4;if(g+=se&15,g>L){s&&Xa(0);break}if(se||Xa(2),nt<256)t[_++]=nt;else if(nt==256){Ve=g,x=null;break}else{var He=nt-254;if(nt>264){var j=nt-257,De=fF[j];He=pc(n,g,(1<<De)-1)+_F[j],g+=De}var ot=b[qS(n,g)&$e],xe=ot>>4;ot||Xa(3),g+=ot&15;var be=q8[xe];if(xe>3){var De=pF[xe];be+=qS(n,g)&(1<<De)-1,g+=De}if(g>L){s&&Xa(0);break}c&&d(_+131072);var Be=_+He;if(_<be){var Je=o-be,ct=Math.min(be,Be);for(Je+_<0&&Xa(3);_<ct;++_)t[_]=i[Je+_]}for(;_<Be;_+=4)t[_]=t[_-be],t[_+1]=t[_+1-be],t[_+2]=t[_+2-be],t[_+3]=t[_+3-be];_=Be}}e.l=x,e.p=Ve,e.b=_,e.f=p,x&&(p=1,e.m=S,e.d=b,e.n=P)}while(!p);return _==t.length?t:X8(t,0,_)},K8=new Qa(0),J8=function(n){(n[0]!=31||n[1]!=139||n[2]!=8)&&Xa(6,"invalid gzip data");var e=n[3],t=10;e&4&&(t+=(n[10]|n[11]<<8)+2);for(var i=(e>>3&1)+(e>>4&1);i>0;i-=!n[t++]);return t+(e&2)},Q8=function(n){var e=n.length;return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0},eU=function(n,e){return((n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31)&&Xa(6,"invalid zlib data"),(n[1]>>5&1)==1&&Xa(6,"invalid zlib data: "+(n[1]&32?"need":"unexpected")+" dictionary"),(n[1]>>3&4)+2};function tU(n,e){return lC(n,{i:2},e,e)}function iU(n,e){var t=J8(n);return t+8>n.length&&Xa(6,"invalid gzip data"),lC(n.subarray(t,-8),{i:2},new Qa(Q8(n)),e)}function nU(n,e){return lC(n.subarray(eU(n),-4),{i:2},e,e)}function zM(n,e){return n[0]==31&&n[1]==139&&n[2]==8?iU(n,e):(n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31?tU(n,e):nU(n,e)}var rU=typeof TextDecoder<"u"&&new TextDecoder,sU=0;try{rU.decode(K8,{stream:!0}),sU=1}catch{}var bF=(n,e)=>n*Mg(2,e),vv=(n,e)=>Math.floor(n/Mg(2,e)),sw=(n,e)=>bF(n.getUint16(e+1,!0),8)+n.getUint8(e),xF=(n,e)=>bF(n.getUint32(e+2,!0),16)+n.getUint16(e,!0),oU=(n,e,t,i,r)=>{if(n!==i.getUint8(r))return n-i.getUint8(r);const o=sw(i,r+1);if(e!==o)return e-o;const c=sw(i,r+4);return t!==c?t-c:0},aU=(n,e,t,i)=>{const r=wF(n,e|128,t,i);return r?{z:e,x:t,y:i,offset:r[0],length:r[1],isDir:!0}:null},lI=(n,e,t,i)=>{const r=wF(n,e,t,i);return r?{z:e,x:t,y:i,offset:r[0],length:r[1],isDir:!1}:null},wF=(n,e,t,i)=>{let r=0,o=n.byteLength/17-1;for(;r<=o;){const c=o+r>>1,s=oU(e,t,i,n,c*17);if(s>0)r=c+1;else if(s<0)o=c-1;else return[xF(n,c*17+7),n.getUint32(c*17+13,!0)]}return null},lU=(n,e)=>n.isDir&&!e.isDir?1:!n.isDir&&e.isDir?-1:n.z!==e.z?n.z-e.z:n.x!==e.x?n.x-e.x:n.y-e.y,SF=(n,e)=>{const t=n.getUint8(e*17);return{z:t&127,x:sw(n,e*17+1),y:sw(n,e*17+4),offset:xF(n,e*17+7),length:n.getUint32(e*17+13,!0),isDir:t>>7===1}},cI=n=>{const e=[],t=new DataView(n);for(let i=0;i<t.byteLength/17;i++)e.push(SF(t,i));return cU(e)},cU=n=>{n.sort(lU);const e=new ArrayBuffer(17*n.length),t=new Uint8Array(e);for(let i=0;i<n.length;i++){const r=n[i];let o=r.z;r.isDir&&(o=o|128),t[i*17]=o,t[i*17+1]=r.x&255,t[i*17+2]=r.x>>8&255,t[i*17+3]=r.x>>16&255,t[i*17+4]=r.y&255,t[i*17+5]=r.y>>8&255,t[i*17+6]=r.y>>16&255,t[i*17+7]=r.offset&255,t[i*17+8]=vv(r.offset,8)&255,t[i*17+9]=vv(r.offset,16)&255,t[i*17+10]=vv(r.offset,24)&255,t[i*17+11]=vv(r.offset,32)&255,t[i*17+12]=vv(r.offset,48)&255,t[i*17+13]=r.length&255,t[i*17+14]=r.length>>8&255,t[i*17+15]=r.length>>16&255,t[i*17+16]=r.length>>24&255}return e},uU=(n,e)=>{if(n.byteLength<17)return null;const t=n.byteLength/17,i=SF(n,t-1);if(i.isDir){const r=i.z,o=e.z-r,c=Math.trunc(e.x/(1<<o)),s=Math.trunc(e.y/(1<<o));return{z:r,x:c,y:s}}return null};function hU(n){return po(this,null,function*(){const e=yield n.getBytes(0,512e3),t=new DataView(e.data),i=t.getUint32(4,!0),r=t.getUint16(8,!0),o=new TextDecoder("utf-8"),c=JSON.parse(o.decode(new DataView(e.data,10,i)));let s=0;c.compression==="gzip"&&(s=2);let d=0;"minzoom"in c&&(d=+c.minzoom);let p=0;"maxzoom"in c&&(p=+c.maxzoom);let g=0,_=0,x=0,b=-180,S=-85,P=180,L=85;if(c.bounds){const C=c.bounds.split(",");b=+C[0],S=+C[1],P=+C[2],L=+C[3]}if(c.center){const C=c.center.split(",");g=+C[0],_=+C[1],x=+C[2]}return{specVersion:t.getUint16(2,!0),rootDirectoryOffset:10+i,rootDirectoryLength:r*17,jsonMetadataOffset:10,jsonMetadataLength:i,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:s,tileType:1,minZoom:d,maxZoom:p,minLon:b,minLat:S,maxLon:P,maxLat:L,centerZoom:x,centerLon:g,centerLat:_,etag:e.etag}})}function dU(n,e,t,i,r,o,c){return po(this,null,function*(){let s=yield t.getArrayBuffer(e,n.rootDirectoryOffset,n.rootDirectoryLength,n);n.specVersion===1&&(s=cI(s));const d=lI(new DataView(s),i,r,o);if(d){let _=(yield e.getBytes(d.offset,d.length,c)).data;const x=new DataView(_);return x.getUint8(0)===31&&x.getUint8(1)===139&&(_=zM(new Uint8Array(_))),{data:_}}const p=uU(new DataView(s),{z:i,x:r,y:o});if(p){const g=aU(new DataView(s),p.z,p.x,p.y);if(g){let _=yield t.getArrayBuffer(e,g.offset,g.length,n);n.specVersion===1&&(_=cI(_));const x=lI(new DataView(_),i,r,o);if(x){let S=(yield e.getBytes(x.offset,x.length,c)).data;const P=new DataView(S);return P.getUint8(0)===31&&P.getUint8(1)===139&&(S=zM(new Uint8Array(S))),{data:S}}}}})}var TF={getHeader:hU,getZxy:dU},fU=n=>(e,t)=>{if(t instanceof AbortController)return n(e,t);const i=new AbortController;return n(e,i).then(r=>t(void 0,r.data,r.cacheControl||"",r.expires||""),r=>t(r)).catch(r=>t(r)),{cancel:()=>i.abort()}},pU=class{constructor(n){this.tilev4=(e,t)=>po(this,null,function*(){if(e.type==="json"){const x=e.url.substr(10);let b=this.tiles.get(x);if(b||(b=new uI(x),this.tiles.set(x,b)),this.metadata)return{data:yield b.getTileJson(e.url)};const S=yield b.getHeader();return{data:{tiles:[`${e.url}/{z}/{x}/{y}`],minzoom:S.minZoom,maxzoom:S.maxZoom,bounds:[S.minLon,S.minLat,S.maxLon,S.maxLat]}}}const i=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),r=e.url.match(i);if(!r)throw new Error("Invalid PMTiles protocol URL");const o=r[1];let c=this.tiles.get(o);c||(c=new uI(o),this.tiles.set(o,c));const s=r[2],d=r[3],p=r[4],g=yield c.getHeader(),_=yield c?.getZxy(+s,+d,+p,t.signal);return _?{data:new Uint8Array(_.data),cacheControl:_.cacheControl,expires:_.expires}:g.tileType===1?{data:new Uint8Array}:{data:null}}),this.tile=fU(this.tilev4),this.tiles=new Map,this.metadata=n?.metadata||!1}add(n){this.tiles.set(n.source.getKey(),n)}get(n){return this.tiles.get(n)}};function Bm(n,e){return(e>>>0)*4294967296+(n>>>0)}function mU(n,e){const t=e.buf;let i=t[e.pos++],r=(i&112)>>4;if(i<128||(i=t[e.pos++],r|=(i&127)<<3,i<128)||(i=t[e.pos++],r|=(i&127)<<10,i<128)||(i=t[e.pos++],r|=(i&127)<<17,i<128)||(i=t[e.pos++],r|=(i&127)<<24,i<128)||(i=t[e.pos++],r|=(i&1)<<31,i<128))return Bm(n,r);throw new Error("Expected varint not more than 10 bytes")}function yv(n){const e=n.buf;let t=e[n.pos++],i=t&127;return t<128||(t=e[n.pos++],i|=(t&127)<<7,t<128)||(t=e[n.pos++],i|=(t&127)<<14,t<128)||(t=e[n.pos++],i|=(t&127)<<21,t<128)?i:(t=e[n.pos],i|=(t&15)<<28,mU(i,n))}function gU(n,e,t,i){if(i===0){t===1&&(e[0]=n-1-e[0],e[1]=n-1-e[1]);const r=e[0];e[0]=e[1],e[1]=r}}var _U=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function vU(n,e,t){if(n>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Mg(2,n)-1||t>Mg(2,n)-1)throw Error("tile x/y outside zoom level bounds");const i=_U[n],r=Mg(2,n);let o=0,c=0,s=0;const d=[e,t];let p=r/2;for(;p>0;)o=(d[0]&p)>0?1:0,c=(d[1]&p)>0?1:0,s+=p*p*(3*o^c),gU(p,d,o,c),p=p/2;return i+s}function MF(n,e){return po(this,null,function*(){if(e===1||e===0)return n;if(e===2){if(typeof globalThis.DecompressionStream>"u")return zM(new Uint8Array(n));const t=new Response(n).body;if(!t)throw Error("Failed to read response stream");const i=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(i).arrayBuffer()}throw Error("Compression method not supported")})}function yU(n){return n===1?".mvt":n===2?".png":n===3?".jpg":n===4?".webp":n===5?".avif":""}var bU=127;function xU(n,e){let t=0,i=n.length-1;for(;t<=i;){const r=i+t>>1,o=e-n[r].tileId;if(o>0)t=r+1;else if(o<0)i=r-1;else return n[r]}return i>=0&&(n[i].runLength===0||e-n[i].tileId<n[i].runLength)?n[i]:null}var wU=class{constructor(n,e=new Headers){this.url=n,this.customHeaders=e,this.mustReload=!1;let t="";"navigator"in globalThis&&(t=globalThis.navigator.userAgent||"");const i=t.indexOf("Windows")>-1,r=/Chrome|Chromium|Edg|OPR|Brave/.test(t);this.chromeWindowsNoCache=!1,i&&r&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(n){this.customHeaders=n}getBytes(n,e,t,i){return po(this,null,function*(){let r,o;t?o=t:(r=new AbortController,o=r.signal);const c=new Headers(this.customHeaders);c.set("range",`bytes=${n}-${n+e-1}`);let s;this.mustReload?s="reload":this.chromeWindowsNoCache&&(s="no-store");let d=yield fetch(this.url,{signal:o,cache:s,headers:c});if(n===0&&d.status===416){const x=d.headers.get("Content-Range");if(!x||!x.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const b=+x.substr(8);d=yield fetch(this.url,{signal:o,cache:"reload",headers:{range:`bytes=0-${b-1}`}})}let p=d.headers.get("Etag");if(p?.startsWith("W/")&&(p=null),d.status===416||i&&p&&p!==i)throw this.mustReload=!0,new BM(`Server returned non-matching ETag ${i} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(d.status>=300)throw Error(`Bad response code: ${d.status}`);const g=d.headers.get("Content-Length");if(d.status===200&&(!g||+g>e))throw r&&r.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield d.arrayBuffer(),etag:p||void 0,cacheControl:d.headers.get("Cache-Control")||void 0,expires:d.headers.get("Expires")||void 0}})}};function mc(n,e){const t=n.getUint32(e+4,!0),i=n.getUint32(e+0,!0);return t*Mg(2,32)+i}function SU(n,e){const t=new DataView(n),i=t.getUint8(7);if(i>3)throw Error(`Archive is spec version ${i} but this library supports up to spec version 3`);return{specVersion:i,rootDirectoryOffset:mc(t,8),rootDirectoryLength:mc(t,16),jsonMetadataOffset:mc(t,24),jsonMetadataLength:mc(t,32),leafDirectoryOffset:mc(t,40),leafDirectoryLength:mc(t,48),tileDataOffset:mc(t,56),tileDataLength:mc(t,64),numAddressedTiles:mc(t,72),numTileEntries:mc(t,80),numTileContents:mc(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}function CF(n){const e={buf:new Uint8Array(n),pos:0},t=yv(e),i=[];let r=0;for(let o=0;o<t;o++){const c=yv(e);i.push({tileId:r+c,offset:0,length:0,runLength:1}),r+=c}for(let o=0;o<t;o++)i[o].runLength=yv(e);for(let o=0;o<t;o++)i[o].length=yv(e);for(let o=0;o<t;o++){const c=yv(e);c===0&&o>0?i[o].offset=i[o-1].offset+i[o-1].length:i[o].offset=c-1}return i}function TU(n){const e=new DataView(n);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var BM=class extends Error{};function MU(n,e){return po(this,null,function*(){const t=yield n.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(TU(t.data)<3)return[yield TF.getHeader(n)];const r=t.data.slice(0,bU),o=SU(r,t.etag),c=t.data.slice(o.rootDirectoryOffset,o.rootDirectoryOffset+o.rootDirectoryLength),s=`${n.getKey()}|${o.etag||""}|${o.rootDirectoryOffset}|${o.rootDirectoryLength}`,d=CF(yield e(c,o.internalCompression));return[o,[s,d.length,d]]})}function CU(n,e,t,i,r){return po(this,null,function*(){const o=yield n.getBytes(t,i,void 0,r.etag),c=yield e(o.data,r.internalCompression),s=CF(c);if(s.length===0)throw new Error("Empty directory is invalid");return s})}var EU=class{constructor(n=100,e=!0,t=MF){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=n,this.counter=1,this.decompress=t}getHeader(n){return po(this,null,function*(){const e=n.getKey(),t=this.cache.get(e);if(t)return t.lastUsed=this.counter++,yield t.data;const i=new Promise((r,o)=>{MU(n,this.decompress).then(c=>{c[1]&&this.cache.set(c[1][0],{lastUsed:this.counter++,data:Promise.resolve(c[1][2])}),r(c[0]),this.prune()}).catch(c=>{o(c)})});return this.cache.set(e,{lastUsed:this.counter++,data:i}),i})}getDirectory(n,e,t,i){return po(this,null,function*(){const r=`${n.getKey()}|${i.etag||""}|${e}|${t}`,o=this.cache.get(r);if(o)return o.lastUsed=this.counter++,yield o.data;const c=new Promise((s,d)=>{CU(n,this.decompress,e,t,i).then(p=>{s(p),this.prune()}).catch(p=>{d(p)})});return this.cache.set(r,{lastUsed:this.counter++,data:c}),c})}getArrayBuffer(n,e,t,i){return po(this,null,function*(){const r=`${n.getKey()}|${i.etag||""}|${e}|${t}`,o=this.cache.get(r);if(o)return o.lastUsed=this.counter++,yield o.data;const c=new Promise((s,d)=>{n.getBytes(e,t,void 0,i.etag).then(p=>{s(p.data),this.cache.has(r),this.prune()}).catch(p=>{d(p)})});return this.cache.set(r,{lastUsed:this.counter++,data:c}),c})}prune(){if(this.cache.size>=this.maxCacheEntries){let n=1/0,e;this.cache.forEach((t,i)=>{t.lastUsed<n&&(n=t.lastUsed,e=i)}),e&&this.cache.delete(e)}}invalidate(n){return po(this,null,function*(){const e=n.getKey();if(this.invalidations.get(e))return yield this.invalidations.get(e);this.cache.delete(n.getKey());const t=new Promise((i,r)=>{this.getHeader(n).then(o=>{i(),this.invalidations.delete(e)}).catch(o=>{r(o)})});this.invalidations.set(e,t)})}},uI=class{constructor(n,e,t){typeof n=="string"?this.source=new wU(n):this.source=n,t?this.decompress=t:this.decompress=MF,e?this.cache=e:this.cache=new EU}getHeader(){return po(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(n,e,t,i){return po(this,null,function*(){const r=vU(n,e,t),o=yield this.cache.getHeader(this.source);if(o.specVersion<3)return TF.getZxy(o,this.source,this.cache,n,e,t,i);if(n<o.minZoom||n>o.maxZoom)return;let c=o.rootDirectoryOffset,s=o.rootDirectoryLength;for(let d=0;d<=3;d++){const p=yield this.cache.getDirectory(this.source,c,s,o),g=xU(p,r);if(g){if(g.runLength>0){const _=yield this.source.getBytes(o.tileDataOffset+g.offset,g.length,i,o.etag);return{data:yield this.decompress(_.data,o.tileCompression),cacheControl:_.cacheControl,expires:_.expires}}c=o.leafDirectoryOffset+g.offset,s=g.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(n,e,t,i){return po(this,null,function*(){try{return yield this.getZxyAttempt(n,e,t,i)}catch(r){if(r instanceof BM)return this.cache.invalidate(this.source),yield this.getZxyAttempt(n,e,t,i);throw r}})}getMetadataAttempt(){return po(this,null,function*(){const n=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(n.jsonMetadataOffset,n.jsonMetadataLength,void 0,n.etag),t=yield this.decompress(e.data,n.internalCompression),i=new TextDecoder("utf-8");return JSON.parse(i.decode(t))})}getMetadata(){return po(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(n){if(n instanceof BM)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw n}})}getTileJson(n){return po(this,null,function*(){const e=yield this.getHeader(),t=yield this.getMetadata(),i=yU(e.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${n}/{z}/{x}/{y}${i}`],vector_layers:t.vector_layers,attribution:t.attribution,description:t.description,name:t.name,version:t.version,bounds:[e.minLon,e.minLat,e.maxLon,e.maxLat],center:[e.centerLon,e.centerLat,e.centerZoom],minzoom:e.minZoom,maxzoom:e.maxZoom}})}};function Vv(n,e){Qi(e,!0);let t=ft(e,"id",19,()=>wp("symbol")),i=ft(e,"source",3,void 0),r=ft(e,"sourceLayer",3,void 0),o=ft(e,"beforeId",3,void 0),c=ft(e,"beforeLayerType",3,void 0),s=ft(e,"paint",3,void 0),d=ft(e,"layout",3,void 0),p=ft(e,"filter",3,void 0),g=ft(e,"applyToClusters",3,void 0),_=ft(e,"minzoom",3,void 0),x=ft(e,"maxzoom",3,void 0),b=ft(e,"hoverCursor",3,void 0),S=ft(e,"manageHoverState",3,!1),P=ft(e,"hovered",15),L=ft(e,"eventsIfTopMost",3,!1),E=ft(e,"interactive",3,!0),C=ft(e,"children",3,void 0),D=ft(e,"onclick",3,void 0),O=ft(e,"ondblclick",3,void 0),U=ft(e,"oncontextmenu",3,void 0),q=ft(e,"onmouseenter",3,void 0),G=ft(e,"onmousemove",3,void 0),N=ft(e,"onmouseleave",3,void 0);Qw(n,{get id(){return t()},type:"symbol",get source(){return i()},get sourceLayer(){return r()},get beforeId(){return o()},get beforeLayerType(){return c()},get paint(){return s()},get layout(){return d()},get filter(){return p()},get applyToClusters(){return g()},get minzoom(){return _()},get maxzoom(){return x()},get hoverCursor(){return b()},get manageHoverState(){return S()},get eventsIfTopMost(){return L()},get interactive(){return E()},get onclick(){return D()},get ondblclick(){return O()},get oncontextmenu(){return U()},get onmouseenter(){return q()},get onmousemove(){return G()},get onmouseleave(){return N()},get hovered(){return P()},set hovered(V){P(V)},children:(V,j)=>{var z=tr(),Q=ci(z);hs(Q,()=>C()??ts),bt(V,z)},$$slots:{default:!0}}),en()}function AU(n,e){Qi(e,!0);let t=ft(e,"id",19,()=>wp("vector")),i=ft(e,"url",3,void 0),r=ft(e,"tiles",3,void 0),o=ft(e,"promoteId",3,void 0),c=ft(e,"bounds",3,void 0),s=ft(e,"scheme",3,void 0),d=ft(e,"attribution",3,void 0),p=ft(e,"minzoom",3,void 0),g=ft(e,"maxzoom",3,void 0),_=ft(e,"volatile",3,void 0);if(i()&&i().includes("pmtiles://")&&!Object.hasOwn(Io.config.REGISTERED_PROTOCOLS,"pmtiles")){let U=new pU;Io.addProtocol("pmtiles",U.tile)}const x=Kt(Ec),b=Kt(()=>te(x).map),S=Kt(()=>te(x).loaded),{source:P}=sF();let L=ii(void 0);cn(()=>{te(b)&&te(S)&&P.value!==t()&&(P.value=t(),lF(te(b),P.value,Cy({type:"vector",url:i(),tiles:r(),promoteId:o(),bounds:c(),scheme:s(),attribution:d(),minzoom:p(),maxzoom:g(),volatile:_()}),U=>te(b)&&U===P.value,()=>{P.value&&Ct(L,te(b).getSource(P.value),!0)}))});function E(){te(b)&&Ct(L,te(b).getSource(t()),!0)}cn(()=>{te(b)&&te(b).on("style.load",E)}),wa(()=>{te(b)?.off("style.load",E),P.value&&te(b)&&(cF(te(b),P.value,te(L)),P.value=void 0,Ct(L,void 0))});var C=tr(),D=ci(C);{var O=U=>{var q=tr(),G=ci(q);s0(G,()=>P.value,N=>{var V=tr(),j=ci(V);hs(j,()=>e.children??ts),bt(N,V)}),bt(U,q)};Ji(D,U=>{P.value&&U(O)})}bt(n,C),en()}var PU=qt("<!> <!> <!>",1);function IU(n){const e=()=>nn(KD,"$polygonToolGj",t),[t,i]=is();Hs(n,{get data(){return e()},children:(r,o)=>{var c=PU(),s=ci(c);sC(s,{id:"edit-polygon-fill",get filter(){return HV},paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}});var d=_t(s,2);zl(d,{id:"edit-polygon-lines",get filter(){return ZV},paint:{"line-color":"black","line-width":8,"line-opacity":.5}});var p=_t(d,2);au(p,{id:"edit-polygon-vertices",get filter(){return XV},paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}),bt(r,c)},$$slots:{default:!0}}),i()}var RU=qt('<div class="flex-container svelte-eqsjzd"><div class="top svelte-eqsjzd"><!></div> <div class="content svelte-eqsjzd"><div class="left svelte-eqsjzd"><!></div> <div class="main svelte-eqsjzd"><!></div></div></div>');function LU(n,e){Qi(e,!0),cn(()=>{WS.value&&ow.value&&(WS.value.innerHTML="",WS.value.appendChild(ow.value))}),cn(()=>{cy.value&&aw.value&&(cy.value.innerHTML="",cy.value.appendChild(aw.value))}),cn(()=>{HS.value&&lw.value&&(HS.value.innerHTML="",HS.value.appendChild(lw.value))});var t=RU(),i=zt(t),r=zt(i);hs(r,()=>e.top??ts);var o=_t(i,2),c=zt(o),s=zt(c);hs(s,()=>e.left??ts);var d=_t(c,2),p=zt(d);hs(p,()=>e.main??ts),bt(n,t),en()}var kU=qt("<div><!></div> <div><!></div> <div><!></div>",1);function l0(n,e){Qi(e,!0);var t=kU(),i=ci(t),r=zt(i);hs(r,()=>e.top??ts),wc(i,p=>ow.value=p,()=>ow?.value);var o=_t(i,2),c=zt(o);hs(c,()=>e.left??ts),wc(o,p=>aw.value=p,()=>aw?.value);var s=_t(o,2),d=zt(s);hs(d,()=>e.main??ts),wc(s,p=>lw.value=p,()=>lw?.value),bt(n,t),en()}let ow=Ss({value:void 0}),aw=Ss({value:void 0}),lw=Ss({value:void 0}),WS=Ss({value:void 0}),cy=Ss({value:void 0}),HS=Ss({value:void 0});function DU(n,e={}){if(n.bbox!=null&&e.recompute!==!0)return n.bbox;const t=[1/0,1/0,-1/0,-1/0];return ZD(n,i=>{t[0]>i[0]&&(t[0]=i[0]),t[1]>i[1]&&(t[1]=i[1]),t[2]<i[0]&&(t[2]=i[0]),t[3]<i[1]&&(t[3]=i[1])}),t}var FU=DU,OU=Object.defineProperty,EF=n=>{throw TypeError(n)},zU=(n,e,t)=>e in n?OU(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Ei=(n,e,t)=>zU(n,typeof e!="symbol"?e+"":e,t),AF=(n,e,t)=>e.has(n)||EF("Cannot "+t),vs=(n,e,t)=>(AF(n,e,"read from private field"),e.get(n)),ZS=(n,e,t)=>e.has(n)?EF("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),Cb=(n,e,t,i)=>(AF(n,e,"write to private field"),e.set(n,t),t);function jr(){}function BU(n,e){for(const t in e)n[t]=e[t];return n}function PF(n){return n()}function hI(){return Object.create(null)}function kh(n){n.forEach(PF)}function IF(n){return typeof n=="function"}function Hd(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}let Eb;function Do(n,e){return n===e?!0:(Eb||(Eb=document.createElement("a")),Eb.href=e,n===Eb.href)}function NU(n){return Object.keys(n).length===0}function $U(n,e,t,i){if(n){const r=RF(n,e,t,i);return n[0](r)}}function RF(n,e,t,i){return n[1]&&i?BU(t.ctx.slice(),n[1](i(e))):t.ctx}function VU(n,e,t,i){return n[2],e.dirty}function UU(n,e,t,i,r,o){if(r){const c=RF(e,t,i,o);n.p(c,r)}}function jU(n){if(n.ctx.length>32){const e=[],t=n.ctx.length/32;for(let i=0;i<t;i++)e[i]=-1;return e}return-1}function cw(n){return n??""}function Rn(n,e){n.appendChild(e)}function Or(n,e,t){n.insertBefore(e,t||null)}function Cr(n){n.parentNode&&n.parentNode.removeChild(n)}function ur(n){return document.createElement(n)}function Sc(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function Fd(n){return document.createTextNode(n)}function Ya(){return Fd(" ")}function GU(){return Fd("")}function Ws(n,e,t,i){return n.addEventListener(e,t,i),()=>n.removeEventListener(e,t,i)}function qU(n){return function(e){return e.preventDefault(),n.call(this,e)}}function jt(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}function WU(n){return Array.from(n.childNodes)}function Ey(n,e){e=""+e,n.data!==e&&(n.data=e)}function dI(n,e){n.value=e??""}function lu(n,e,t){n.classList.toggle(e,!!t)}function HU(n,e,{bubbles:t=!1,cancelable:i=!1}={}){return new CustomEvent(n,{detail:e,bubbles:t,cancelable:i})}let Ay;function uy(n){Ay=n}function LF(){if(!Ay)throw new Error("Function called outside component initialization");return Ay}function ZU(n){LF().$$.on_destroy.push(n)}function kF(){const n=LF();return(e,t,{cancelable:i=!1}={})=>{const r=n.$$.callbacks[e];if(r){const o=HU(e,t,{cancelable:i});return r.slice().forEach(c=>{c.call(n,o)}),!o.defaultPrevented}return!0}}function XU(n,e){const t=n.$$.callbacks[e.type];t&&t.slice().forEach(i=>i.call(this,e))}const hg=[],NM=[];let Cg=[];const fI=[],YU=Promise.resolve();let $M=!1;function KU(){$M||($M=!0,YU.then(DF))}function VM(n){Cg.push(n)}const XS=new Set;let Nm=0;function DF(){if(Nm!==0)return;const n=Ay;do{try{for(;Nm<hg.length;){const e=hg[Nm];Nm++,uy(e),JU(e.$$)}}catch(e){throw hg.length=0,Nm=0,e}for(uy(null),hg.length=0,Nm=0;NM.length;)NM.pop()();for(let e=0;e<Cg.length;e+=1){const t=Cg[e];XS.has(t)||(XS.add(t),t())}Cg.length=0}while(hg.length);for(;fI.length;)fI.pop()();$M=!1,XS.clear(),uy(n)}function JU(n){if(n.fragment!==null){n.update(),kh(n.before_update);const e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(VM)}}function QU(n){const e=[],t=[];Cg.forEach(i=>n.indexOf(i)===-1?e.push(i):t.push(i)),t.forEach(i=>i()),Cg=e}const Bx=new Set;let Kf;function Uv(){Kf={r:0,c:[],p:Kf}}function jv(){Kf.r||kh(Kf.c),Kf=Kf.p}function Jr(n,e){n&&n.i&&(Bx.delete(n),n.i(e))}function Fs(n,e,t,i){if(n&&n.o){if(Bx.has(n))return;Bx.add(n),Kf.c.push(()=>{Bx.delete(n),i&&(t&&n.d(1),i())}),n.o(e)}else i&&i()}function pI(n){return n?.length!==void 0?n:Array.from(n)}function ej(n,e){Fs(n,1,1,()=>{e.delete(n.key)})}function tj(n,e,t,i,r,o,c,s,d,p,g,_){let x=n.length,b=o.length,S=x;const P={};for(;S--;)P[n[S].key]=S;const L=[],E=new Map,C=new Map,D=[];for(S=b;S--;){const G=_(r,o,S),N=t(G);let V=c.get(N);V?D.push(()=>V.p(G,e)):(V=p(N,G),V.c()),E.set(N,L[S]=V),N in P&&C.set(N,Math.abs(S-P[N]))}const O=new Set,U=new Set;function q(G){Jr(G,1),G.m(s,g),c.set(G.key,G),g=G.first,b--}for(;x&&b;){const G=L[b-1],N=n[x-1],V=G.key,j=N.key;G===N?(g=G.first,x--,b--):E.has(j)?!c.has(V)||O.has(V)?q(G):U.has(j)?x--:C.get(V)>C.get(j)?(U.add(V),q(G)):(O.add(j),x--):(d(N,c),x--)}for(;x--;){const G=n[x];E.has(G.key)||d(G,c)}for(;b;)q(L[b-1]);return kh(D),L}function Od(n){n&&n.c()}function Th(n,e,t){const{fragment:i,after_update:r}=n.$$;i&&i.m(e,t),VM(()=>{const o=n.$$.on_mount.map(PF).filter(IF);n.$$.on_destroy?n.$$.on_destroy.push(...o):kh(o),n.$$.on_mount=[]}),r.forEach(VM)}function Mh(n,e){const t=n.$$;t.fragment!==null&&(QU(t.after_update),kh(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function ij(n,e){n.$$.dirty[0]===-1&&(hg.push(n),KU(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function Zd(n,e,t,i,r,o,c=null,s=[-1]){const d=Ay;uy(n);const p=n.$$={fragment:null,ctx:[],props:o,update:jr,not_equal:r,bound:hI(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(d?d.$$.context:[])),callbacks:hI(),dirty:s,skip_bound:!1,root:e.target||d.$$.root};c&&c(p.root);let g=!1;if(p.ctx=t?t(n,e.props||{},(_,x,...b)=>{const S=b.length?b[0]:x;return p.ctx&&r(p.ctx[_],p.ctx[_]=S)&&(!p.skip_bound&&p.bound[_]&&p.bound[_](S),g&&ij(n,_)),x}):[],p.update(),g=!0,kh(p.before_update),p.fragment=i?i(p.ctx):!1,e.target){if(e.hydrate){const _=WU(e.target);p.fragment&&p.fragment.l(_),_.forEach(Cr)}else p.fragment&&p.fragment.c();e.intro&&Jr(n.$$.fragment),Th(n,e.target,e.anchor),DF()}uy(d)}class Xd{constructor(){Ei(this,"$$"),Ei(this,"$$set")}$destroy(){Mh(this,1),this.$destroy=jr}$on(e,t){if(!IF(t))return jr;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(t),()=>{const r=i.indexOf(t);r!==-1&&i.splice(r,1)}}$set(e){this.$$set&&!NU(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const nj="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(nj);function rj(n){let e,t;return{c(){e=Sc("svg"),t=Sc("path"),jt(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),jt(e,"viewBox","0 0 14 14"),jt(e,"width","13"),jt(e,"height","13"),jt(e,"class","svelte-en2qvf")},m(i,r){Or(i,e,r),Rn(e,t)},p:jr,i:jr,o:jr,d(i){i&&Cr(e)}}}class FF extends Xd{constructor(e){super(),Zd(this,e,null,rj,Hd,{})}}function sj(n){let e,t;return{c(){e=Sc("svg"),t=Sc("path"),jt(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),jt(e,"viewBox","0 0 30 30"),jt(e,"fill","none"),jt(e,"xmlns","http://www.w3.org/2000/svg"),jt(e,"class","svelte-d2loi5")},m(i,r){Or(i,e,r),Rn(e,t)},p:jr,i:jr,o:jr,d(i){i&&Cr(e)}}}class OF extends Xd{constructor(e){super(),Zd(this,e,null,sj,Hd,{})}}function oj(n){let e,t;return{c(){e=ur("img"),Do(e.src,t=n[3]+"area.svg")||jt(e,"src",t),jt(e,"alt",n[7]),jt(e,"title",n[7]),jt(e,"class","svelte-w9y5n9")},m(i,r){Or(i,e,r)},p(i,r){r&8&&!Do(e.src,t=i[3]+"area.svg")&&jt(e,"src",t),r&128&&jt(e,"alt",i[7]),r&128&&jt(e,"title",i[7])},d(i){i&&Cr(e)}}}function aj(n){let e,t;return{c(){e=ur("img"),Do(e.src,t=n[3]+"reverse.svg")||jt(e,"src",t),jt(e,"alt",n[7]),jt(e,"title",n[7]),jt(e,"class","svelte-w9y5n9")},m(i,r){Or(i,e,r)},p(i,r){r&8&&!Do(e.src,t=i[3]+"reverse.svg")&&jt(e,"src",t),r&128&&jt(e,"alt",i[7]),r&128&&jt(e,"title",i[7])},d(i){i&&Cr(e)}}}function lj(n){let e,t;return{c(){e=ur("img"),Do(e.src,t=n[3]+"poi.svg")||jt(e,"src",t),jt(e,"alt",n[7]),jt(e,"title",n[7]),jt(e,"class","svelte-w9y5n9")},m(i,r){Or(i,e,r)},p(i,r){r&8&&!Do(e.src,t=i[3]+"poi.svg")&&jt(e,"src",t),r&128&&jt(e,"alt",i[7]),r&128&&jt(e,"title",i[7])},d(i){i&&Cr(e)}}}function cj(n){let e,t;return{c(){e=ur("img"),Do(e.src,t=n[3]+"postal_code.svg")||jt(e,"src",t),jt(e,"alt",n[7]),jt(e,"title",n[7]),jt(e,"class","svelte-w9y5n9")},m(i,r){Or(i,e,r)},p(i,r){r&8&&!Do(e.src,t=i[3]+"postal_code.svg")&&jt(e,"src",t),r&128&&jt(e,"alt",i[7]),r&128&&jt(e,"title",i[7])},d(i){i&&Cr(e)}}}function uj(n){let e,t;return{c(){e=ur("img"),Do(e.src,t=n[3]+"street.svg")||jt(e,"src",t),jt(e,"alt",n[7]),jt(e,"title",n[7]),jt(e,"class","svelte-w9y5n9")},m(i,r){Or(i,e,r)},p(i,r){r&8&&!Do(e.src,t=i[3]+"street.svg")&&jt(e,"src",t),r&128&&jt(e,"alt",i[7]),r&128&&jt(e,"title",i[7])},d(i){i&&Cr(e)}}}function hj(n){let e,t;return{c(){e=ur("img"),Do(e.src,t=n[3]+"road.svg")||jt(e,"src",t),jt(e,"alt",n[7]),jt(e,"title",n[7]),jt(e,"class","svelte-w9y5n9")},m(i,r){Or(i,e,r)},p(i,r){r&8&&!Do(e.src,t=i[3]+"road.svg")&&jt(e,"src",t),r&128&&jt(e,"alt",i[7]),r&128&&jt(e,"title",i[7])},d(i){i&&Cr(e)}}}function dj(n){let e,t;return{c(){e=ur("img"),Do(e.src,t=n[3]+"housenumber.svg")||jt(e,"src",t),jt(e,"alt",n[7]),jt(e,"title",n[7]),jt(e,"class","svelte-w9y5n9")},m(i,r){Or(i,e,r)},p(i,r){r&8&&!Do(e.src,t=i[3]+"housenumber.svg")&&jt(e,"src",t),r&128&&jt(e,"alt",i[7]),r&128&&jt(e,"title",i[7])},d(i){i&&Cr(e)}}}function fj(n){let e,t,i,r;return{c(){e=ur("img"),Do(e.src,t=n[5])||jt(e,"src",t),jt(e,"alt",n[4]),jt(e,"title",n[7]),jt(e,"class","svelte-w9y5n9")},m(o,c){Or(o,e,c),i||(r=Ws(e,"error",n[14]),i=!0)},p(o,c){c&32&&!Do(e.src,t=o[5])&&jt(e,"src",t),c&16&&jt(e,"alt",o[4]),c&128&&jt(e,"title",o[7])},d(o){o&&Cr(e),i=!1,r()}}}function pj(n){let e,t;return{c(){e=ur("div"),jt(e,"class","sprite-icon svelte-w9y5n9"),jt(e,"style",t=`
        width: ${n[6].width/Tl}px;
        height: ${n[6].height/Tl}px;
        background-image: url(${n[3]}sprite${UM}.png);
        background-position: -${n[6].x/Tl}px -${n[6].y/Tl}px;
        background-size: ${nu.width/Tl}px ${nu.height/Tl}px;
      `),jt(e,"title",n[7])},m(i,r){Or(i,e,r)},p(i,r){r&72&&t!==(t=`
        width: ${i[6].width/Tl}px;
        height: ${i[6].height/Tl}px;
        background-image: url(${i[3]}sprite${UM}.png);
        background-position: -${i[6].x/Tl}px -${i[6].y/Tl}px;
        background-size: ${nu.width/Tl}px ${nu.height/Tl}px;
      `)&&jt(e,"style",t),r&128&&jt(e,"title",i[7])},d(i){i&&Cr(e)}}}function mI(n){let e,t;return{c(){e=ur("span"),t=Fd(n[7]),jt(e,"class","secondary svelte-w9y5n9")},m(i,r){Or(i,e,r),Rn(e,t)},p(i,r){r&128&&Ey(t,i[7])},d(i){i&&Cr(e)}}}function mj(n){let e,t,i,r,o,c,s,d,p,g=(n[8]?n[0].place_name:n[0].place_name.replace(/,.*/,""))+"",_,x,b=n[2]==="always"||n[2]!=="never"&&!n[0].address&&!n[0].id.startsWith("road.")&&!n[0].id.startsWith("address.")&&!n[0].id.startsWith("postal_code.")&&(!n[0].id.startsWith("poi.")||!n[5])&&!n[8],S,P,L=(n[8]?"":n[0].place_name.replace(/[^,]*,?\s*/,""))+"",E,C,D,O,U,q;function G(z,Q){return Q&1&&(t=null),Q&1&&(i=null),Q&1&&(r=null),Q&1&&(o=null),nu&&z[6]?pj:z[5]?fj:z[0].address?dj:(t==null&&(t=!!z[0].id.startsWith("road.")),t?hj:(i==null&&(i=!!z[0].id.startsWith("address.")),i?uj:(r==null&&(r=!!z[0].id.startsWith("postal_code.")),r?cj:(o==null&&(o=!!z[0].id.startsWith("poi.")),o?lj:z[8]?aj:oj))))}let N=G(n,-1),V=N(n),j=b&&mI(n);return{c(){e=ur("li"),V.c(),c=Ya(),s=ur("span"),d=ur("span"),p=ur("span"),_=Fd(g),x=Ya(),j&&j.c(),S=Ya(),P=ur("span"),E=Fd(L),jt(p,"class","primary svelte-w9y5n9"),jt(d,"class","svelte-w9y5n9"),jt(P,"class","line2 svelte-w9y5n9"),jt(s,"class","texts svelte-w9y5n9"),jt(e,"tabindex","-1"),jt(e,"role","option"),jt(e,"aria-selected",C=n[1]==="selected"),jt(e,"aria-checked",D=n[1]==="picked"),jt(e,"class",O=cw(n[1])+" svelte-w9y5n9")},m(z,Q){Or(z,e,Q),V.m(e,null),Rn(e,c),Rn(e,s),Rn(s,d),Rn(d,p),Rn(p,_),Rn(d,x),j&&j.m(d,null),Rn(s,S),Rn(s,P),Rn(P,E),U||(q=[Ws(e,"mouseenter",n[13]),Ws(e,"focus",n[15]),Ws(e,"click",n[16])],U=!0)},p(z,[Q]){N===(N=G(z,Q))&&V?V.p(z,Q):(V.d(1),V=N(z),V&&(V.c(),V.m(e,c))),Q&257&&g!==(g=(z[8]?z[0].place_name:z[0].place_name.replace(/,.*/,""))+"")&&Ey(_,g),Q&293&&(b=z[2]==="always"||z[2]!=="never"&&!z[0].address&&!z[0].id.startsWith("road.")&&!z[0].id.startsWith("address.")&&!z[0].id.startsWith("postal_code.")&&(!z[0].id.startsWith("poi.")||!z[5])&&!z[8]),b?j?j.p(z,Q):(j=mI(z),j.c(),j.m(d,null)):j&&(j.d(1),j=null),Q&257&&L!==(L=(z[8]?"":z[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&Ey(E,L),Q&2&&C!==(C=z[1]==="selected")&&jt(e,"aria-selected",C),Q&2&&D!==(D=z[1]==="picked")&&jt(e,"aria-checked",D),Q&2&&O!==(O=cw(z[1])+" svelte-w9y5n9")&&jt(e,"class",O)},i:jr,o:jr,d(z){z&&Cr(e),V.d(),j&&j.d(),U=!1,kh(q)}}}const zF=typeof devicePixelRatio>"u"?1:devicePixelRatio>1.25,UM=zF?"@2x":"",Tl=zF?2:1;let nu,Ab;function gj(n,e,t){let i,r,o,{feature:c}=e,{style:s="default"}=e,{showPlaceType:d}=e,{missingIconsCache:p}=e,{iconsBaseUrl:g}=e;const _=kF();let x,b,S,P;function L(){Ab??(Ab=fetch(`${g}sprite${UM}.json`).then(N=>N.json()).then(N=>{nu=N}).catch(()=>{nu=null}))}function E(){b&&p.add(b),C()}function C(){nu!==void 0?D():(L(),Ab?.then(D))}function D(){do{if(P--,t(4,x=i?.[P]),t(6,S=x?nu?.icons[x]:void 0),S)break;t(5,b=x?g+x.replace(/ /g,"_")+".svg":void 0)}while(P>-1&&(!b||p.has(b)))}function O(N){XU.call(this,n,N)}const U=()=>E(),q=()=>_("select",void 0),G=N=>{document.activeElement!==N.target&&_("select",void 0)};return n.$$set=N=>{"feature"in N&&t(0,c=N.feature),"style"in N&&t(1,s=N.style),"showPlaceType"in N&&t(2,d=N.showPlaceType),"missingIconsCache"in N&&t(11,p=N.missingIconsCache),"iconsBaseUrl"in N&&t(3,g=N.iconsBaseUrl)},n.$$.update=()=>{var N,V,j,z,Q;n.$$.dirty&1&&t(12,i=(N=c.properties)==null?void 0:N.categories),n.$$.dirty&1&&t(8,r=c.place_type[0]==="reverse"),n.$$.dirty&1&&t(7,o=((j=(V=c.properties)==null?void 0:V.categories)==null?void 0:j.join(", "))??((Q=(z=c.properties)==null?void 0:z.place_type_name)==null?void 0:Q[0])??c.place_type[0]),n.$$.dirty&4096&&(P=i?.length??0,C())},[c,s,d,g,x,b,S,o,r,_,E,p,i,O,U,q,G]}class _j extends Xd{constructor(e){super(),Zd(this,e,gj,mj,Hd,{feature:0,style:1,showPlaceType:2,missingIconsCache:11,iconsBaseUrl:3})}}function vj(n){let e;return{c(){e=ur("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="loading-icon svelte-1ocfouu"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',jt(e,"class","svelte-1ocfouu")},m(t,i){Or(t,e,i)},p:jr,i:jr,o:jr,d(t){t&&Cr(e)}}}class yj extends Xd{constructor(e){super(),Zd(this,e,null,vj,Hd,{})}}function bj(n){let e,t,i;return{c(){e=Sc("svg"),t=Sc("path"),jt(t,"stroke-width","4"),jt(t,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),jt(t,"class","svelte-gzo3ar"),jt(e,"width",i=n[0]==="list"?20:void 0),jt(e,"viewBox","0 0 70 85"),jt(e,"fill","none"),jt(e,"class","svelte-gzo3ar"),lu(e,"in-map",n[0]!=="list"),lu(e,"list-icon",n[0]==="list")},m(r,o){Or(r,e,o),Rn(e,t)},p(r,[o]){o&1&&i!==(i=r[0]==="list"?20:void 0)&&jt(e,"width",i),o&1&&lu(e,"in-map",r[0]!=="list"),o&1&&lu(e,"list-icon",r[0]==="list")},i:jr,o:jr,d(r){r&&Cr(e)}}}function xj(n,e,t){let{displayIn:i}=e;return n.$$set=r=>{"displayIn"in r&&t(0,i=r.displayIn)},[i]}class wj extends Xd{constructor(e){super(),Zd(this,e,xj,bj,Hd,{displayIn:0})}}function Sj(n){let e,t;return{c(){e=Sc("svg"),t=Sc("path"),jt(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),jt(e,"viewBox","0 0 60.006 21.412"),jt(e,"width","14"),jt(e,"height","20"),jt(e,"class","svelte-en2qvf")},m(i,r){Or(i,e,r),Rn(e,t)},p:jr,i:jr,o:jr,d(i){i&&Cr(e)}}}class Tj extends Xd{constructor(e){super(),Zd(this,e,null,Sj,Hd,{})}}function Mj(n){let e,t,i;return{c(){e=Sc("svg"),t=Sc("circle"),i=Sc("path"),jt(t,"cx","4.789"),jt(t,"cy","4.787"),jt(t,"r","3.85"),jt(t,"class","svelte-1aq105l"),jt(i,"d","M12.063 12.063 7.635 7.635"),jt(i,"class","svelte-1aq105l"),jt(e,"xmlns","http://www.w3.org/2000/svg"),jt(e,"width","13"),jt(e,"height","13"),jt(e,"viewBox","0 0 13 13"),jt(e,"class","svelte-1aq105l")},m(r,o){Or(r,e,o),Rn(e,t),Rn(e,i)},p:jr,i:jr,o:jr,d(r){r&&Cr(e)}}}class Cj extends Xd{constructor(e){super(),Zd(this,e,null,Mj,Hd,{})}}function Ej(n,e,t){const i=e[1],r=e[0],o=i-r;return n===i&&t?n:((n-r)%o+o)%o+r}function uw(n){const e=[...n];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let bv;async function Aj(n,e,t){const i=n?.getCenterAndZoom();for(const r of e??[])if(!(i&&(r.minZoom!=null&&r.minZoom>i[0]||r.maxZoom!=null&&r.maxZoom<i[0]))){if(r.type==="fixed")return r.coordinates.join(",");e:if(r.type==="client-geolocation"){if(bv&&r.cachedLocationExpiry&&bv.time+r.cachedLocationExpiry>Date.now()){if(!bv.coords)break e;return bv.coords}let o;try{return o=await new Promise((c,s)=>{t.signal.addEventListener("abort",()=>{s(Error("aborted"))}),navigator.geolocation.getCurrentPosition(d=>{c([d.coords.longitude,d.coords.latitude].map(p=>p.toFixed(6)).join(","))},d=>{s(d)},r)}),o}catch{}finally{r.cachedLocationExpiry&&(bv={time:Date.now(),coords:o})}if(t.signal.aborted)return}if(r.type==="server-geolocation")return"ip";if(i&&r.type==="map-center")return i[1].toFixed(6)+","+i[2].toFixed(6)}}const Pj=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([â¢ÂºÂ°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['â²Â´â\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([â¢ÂºÂ°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['â²Â´â\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,gI=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,_I=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([â¢ÂºÂ°]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([â¢ÂºÂ°]?)[\s]*(EAST|WEST|[EW])?$/i,vI=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,yI=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,bI=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([â¢ÂºÂ°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['â²Â´â\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|â²â²|ââ|Â´Â´|["â³â\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([â¢ÂºÂ°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['â²Â´â\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|â²â²|Â´Â´|ââ|["â³â\.])?\s*(EAST|WEST|[EW])?$/i;function Ij(n){if(!["DMS","DM","DD"].includes(n))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(b=>Number(b.trim())),t=Number(e[0]),i=Number(e[1]),r=Math.abs(t),o=Math.abs(i),c=t>0?"N":"S",s=i>0?"E":"W";let d;n=="DD"&&(d=`${r}Â° ${c}, ${o}Â° ${s}`);const p=Math.floor(r),g=Math.floor(o),_=(r-p)*60,x=(o-g)*60;if(n=="DM"){let b=xI(_,3).toFixed(3).padStart(6,"0"),S=xI(x,3).toFixed(3).padStart(6,"0");b.endsWith(".000")&&S.endsWith(".000")&&(b=b.replace(/\.000$/,""),S=S.replace(/\.000$/,"")),d=`${p}Â° ${b}' ${c}, ${g}Â° ${S}' ${s}`}if(n=="DMS"){const b=Math.floor(_),S=Math.floor(x);let P=((_-b)*60).toFixed(1).padStart(4,"0"),L=((x-S)*60).toFixed(1).padStart(4,"0");const E=b.toString().padStart(2,"0"),C=S.toString().padStart(2,"0");P.endsWith(".0")&&L.endsWith(".0")&&(P=P.replace(/\.0$/,""),L=L.replace(/\.0$/,"")),d=`${p}Â° ${E}' ${P}" ${c}, ${g}Â° ${C}' ${L}" ${s}`}return d}else throw new Error("no decimal coordinates to convert")}function xI(n,e){const t=Math.pow(10,e);return Math.round((n+Number.EPSILON)*t)/t}function cC(n,e){e||(e=5),n=n.replace(/\s+/g," ").trim();let t=null,i=null,r="",o="",c=null,s=[],d=!1;if(Pj.test(n))throw new Error("invalid coordinate value");if(gI.test(n))if(s=gI.exec(n),d=xv(s),d)t=Math.abs(s[1])+s[2]/60,Number(s[1])<0&&(t*=-1),i=Math.abs(s[3])+s[4]/60,Number(s[3])<0&&(i*=-1),c="DM";else throw new Error("invalid coordinate format");else if(_I.test(n))if(s=_I.exec(n),d=xv(s),d){if(t=s[2],i=s[6],t.includes(",")&&(t=t.replace(",",".")),i.includes(",")&&(i=i.replace(",",".")),c="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(i))==Number(i))throw new Error("integer only coordinate provided");s[1]?(r=s[1],o=s[5]):s[4]&&(r=s[4],o=s[8])}else throw new Error("invalid decimal coordinate format");else if(vI.test(n))if(s=vI.exec(n),d=xv(s),d)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4]/60,c="DM"),s[6]&&(t+=s[6].replace(",",".")/3600,c="DMS"),parseInt(s[2])<0&&(t=-1*t),i=Math.abs(parseInt(s[9])),s[11]&&(i+=s[11]/60),s[13]&&(i+=s[13].replace(",",".")/3600),parseInt(s[9])<0&&(i=-1*i),s[1]?(r=s[1],o=s[8]):s[7]&&(r=s[7],o=s[14]);else throw new Error("invalid DMS coordinates format");else if(yI.test(n))if(s=yI.exec(n),d=xv(s),d)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4]/60,c="DM"),s[6]&&(t+=s[6]/3600,c="DMS"),parseInt(s[2])<0&&(t=-1*t),i=Math.abs(parseInt(s[10])),s[12]&&(i+=s[12]/60),s[14]&&(i+=s[14]/3600),parseInt(s[10])<0&&(i=-1*i),s[1]?(r=s[1],o=s[9]):s[8]&&(r=s[8],o=s[16]);else throw new Error("invalid DMS coordinates format");else if(bI.test(n)){if(s=bI.exec(n),d=xv(s),s.filter(p=>p).length<=5)throw new Error("invalid coordinates format");if(d)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4].replace(",",".")/60,c="DM"),s[6]&&(t+=s[6].replace(",",".")/3600,c="DMS"),parseInt(s[2])<0&&(t=-1*t),i=Math.abs(parseInt(s[10])),s[12]&&(i+=s[12].replace(",",".")/60),s[14]&&(i+=s[14].replace(",",".")/3600),parseInt(s[10])<0&&(i=-1*i),s[1]?(r=s[1],o=s[9]):s[8]&&(r=s[8],o=s[16]);else throw new Error("invalid coordinates format")}if(d){if(Math.abs(i)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(r&&!o||!r&&o)throw new Error("invalid coordinates value");if(r&&r==o)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),i.toString().includes(",")&&(i=i.replace(",","."));let p=/S|SOUTH/i;p.test(r)&&t>0&&(t=-1*t),p=/W|WEST/i,p.test(o)&&i>0&&(i=-1*i);const g=s[0].trim();let _,x;const b=/[,/;\u0020]/g,S=g.match(b);if(S==null){const E=Math.floor(n.length/2);_=g.substring(0,E).trim(),x=g.substring(E).trim()}else{let E;S.length%2==1?E=Math.floor(S.length/2):E=S.length/2-1;let C=0;if(E==0)C=g.indexOf(S[0]),_=g.substring(0,C).trim(),x=g.substring(C+1).trim();else{let D=0,O=0;for(;D<=E;)C=g.indexOf(S[D],O),O=C+1,D++;_=g.substring(0,C).trim(),x=g.substring(C+1).trim()}}const P=_.split(".");if(P.length==2&&P[1]==0&&P[1].length!=2)throw new Error("invalid coordinates format");const L=x.split(".");if(L.length==2&&L[1]==0&&L[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(_)||/^\d+$/.test(x))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),i=Number(Number(i).toFixed(e)),Object.freeze({verbatimCoordinates:g,verbatimLatitude:_,verbatimLongitude:x,decimalLatitude:t,decimalLongitude:i,decimalCoordinates:`${t},${i}`,originalFormat:c,closeEnough:Rj,toCoordinateFormat:Ij})}else throw new Error("coordinates pattern match failed")}function xv(n){if(!isNaN(n[0]))return!1;const e=[...n];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,i=/[eastsouthnorthwest]+/i,r=e.length/2;for(let o=0;o<r;o++){const c=e[o],s=e[o+r],d=t.test(c)&&t.test(s),p=i.test(c)&&i.test(s),g=c==s;if(!(c==null&&s==null)){if(c==null||s==null)return!1;if(d||p||g)continue;return!1}}return!0}function wI(n,e){const t=Math.abs(n-e);return Number(t.toFixed(6))<=1e-5}function Rj(n){if(!n)throw new Error("coords must be provided");if(n.includes(",")){const e=n.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return wI(this.decimalLatitude,Number(e[0]))&&wI(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const Lj=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});cC.to=Lj;const kj=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123Â° N 74.123Â° W",verbatimLatitude:"40.123Â° N",verbatimLongitude:"74.123Â° W"},{verbatimCoordinates:"40.123Â° N 74.123Â° W",verbatimLatitude:"40.123Â° N",verbatimLongitude:"74.123Â° W"},{verbatimCoordinates:'40Â° 7Â´ 22.8" N 74Â° 7Â´ 22.8" W',verbatimLatitude:'40Â° 7Â´ 22.8" N',verbatimLongitude:'74Â° 7Â´ 22.8" W'},{verbatimCoordinates:"40Â° 7.38â , -74Â° 7.38â",verbatimLatitude:"40Â° 7.38â",verbatimLongitude:"-74Â° 7.38â"},{verbatimCoordinates:"N40Â°7â22.8ââ, W74Â°7â22.8ââ",verbatimLatitude:"N40Â°7â22.8ââ",verbatimLongitude:"W74Â°7â22.8ââ"},{verbatimCoordinates:'40Â°7â22.8"N, 74Â°7â22.8"W',verbatimLatitude:'40Â°7â22.8"N',verbatimLongitude:'74Â°7â22.8"W'},{verbatimCoordinates:`40Â°7'22.8"N, 74Â°7'22.8"W`,verbatimLatitude:`40Â°7'22.8"N`,verbatimLongitude:`74Â°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123Â°,-74.123Â°",verbatimLatitude:"40.123Â°",verbatimLongitude:"-74.123Â°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40Â°7â22.8"N, 74Â°7â22.8"W',verbatimLatitude:'40Â°7â22.8"N',verbatimLongitude:'74Â°7â22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40Â°7â23"N 74Â°7â23"W',verbatimLatitude:'40Â°7â23"N',verbatimLongitude:'74Â°7â23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40Â°7â23"S 74Â°7â23"E',verbatimLatitude:'40Â°7â23"S',verbatimLongitude:'74Â°7â23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40Â°7â23" -74Â°7â23"',verbatimLatitude:'40Â°7â23"',verbatimLongitude:'-74Â°7â23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7â 23" N 74d 7â 23" W',verbatimLatitude:'40d 7â 23" N',verbatimLongitude:'74d 7â 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40Â° 7.38, -74Â° 7.38",verbatimLatitude:"40Â° 7.38",verbatimLongitude:"-74Â° 7.38"},{verbatimCoordinates:"40Â° 7.38, -74Â° 7.38",verbatimLatitude:"40Â° 7.38",verbatimLongitude:"-74Â° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],Dj={decimalLatitude:40.123,decimalLongitude:-74.123},Fj=[{verbatimCoordinates:`50Â°4'17.698"south, 14Â°24'2.826"east`,verbatimLatitude:`50Â°4'17.698"south`,verbatimLongitude:`14Â°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40Â°26â²47â³N 79Â°58â²36â³W",verbatimLatitude:"40Â°26â²47â³N",verbatimLongitude:"79Â°58â²36â³W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26â² 47â³ N 79d 58â² 36â³ W",verbatimLatitude:"40d 26â² 47â³ N",verbatimLongitude:"79d 58â² 36â³ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195Â° 79,948862Â°",verbatimLatitude:"40,446195Â°",verbatimLongitude:"79,948862Â°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40Â° 26.7717, -79Â° 56.93172",verbatimLatitude:"40Â° 26.7717",verbatimLongitude:"-79Â° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18Â°24S 22Â°45E",verbatimLatitude:"18Â°24S",verbatimLongitude:"22Â°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],Oj=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245Â° S / 28.2344Â° E",verbatimLatitude:"-23.3245Â° S",verbatimLongitude:"28.2344Â° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40Â° 26.7717 -79Â° 56.93172",verbatimLatitude:"40Â° 26.7717",verbatimLongitude:"-79Â° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 Â°  E22.45634 Â°",verbatimLatitude:"S23.43563 Â°",verbatimLongitude:"E22.45634 Â°",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372Â° S 23,07771Â° E",verbatimLatitude:"27,71372Â° S",verbatimLongitude:"23,07771Â° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48Â° 30,6410', E 18Â° 57,4583'",verbatimLatitude:"N 48Â° 30,6410'",verbatimLongitude:"E 18Â° 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function zj(){const n=[];return kj.forEach(e=>{e.decimalLatitude?n.push(e):n.push({...e,...Dj})}),[...n,...Fj,...Oj]}const Bj=zj();cC.formats=Bj.map(n=>n.verbatimCoordinates);const Nj=cC;function SI(n,e,t){const i=n.slice();return i[97]=e[t],i[99]=t,i}function TI(n){let e,t,i,r,o;return t=new FF({}),{c(){e=ur("button"),Od(t.$$.fragment),jt(e,"type","button"),jt(e,"title",n[3]),jt(e,"class","svelte-bz0zu3")},m(c,s){Or(c,e,s),Th(t,e,null),i=!0,r||(o=Ws(e,"click",n[78]),r=!0)},p(c,s){(!i||s[0]&8)&&jt(e,"title",c[3])},i(c){i||(Jr(t.$$.fragment,c),i=!0)},o(c){Fs(t.$$.fragment,c),i=!1},d(c){c&&Cr(e),Mh(t),r=!1,o()}}}function MI(n){let e,t;return e=new yj({}),{c(){Od(e.$$.fragment)},m(i,r){Th(e,i,r),t=!0},i(i){t||(Jr(e.$$.fragment,i),t=!0)},o(i){Fs(e.$$.fragment,i),t=!1},d(i){Mh(e,i)}}}function CI(n){let e,t,i,r,o;return t=new Tj({}),{c(){e=ur("button"),Od(t.$$.fragment),jt(e,"type","button"),jt(e,"title",n[10]),jt(e,"class","svelte-bz0zu3"),lu(e,"active",n[0])},m(c,s){Or(c,e,s),Th(t,e,null),i=!0,r||(o=Ws(e,"click",n[79]),r=!0)},p(c,s){(!i||s[0]&1024)&&jt(e,"title",c[10]),(!i||s[0]&1)&&lu(e,"active",c[0])},i(c){i||(Jr(t.$$.fragment,c),i=!0)},o(c){Fs(t.$$.fragment,c),i=!1},d(c){c&&Cr(e),Mh(t),r=!1,o()}}}function $j(n){let e,t=[],i=new Map,r,o,c,s=pI(n[13]);const d=p=>p[97].id+(p[97].address?","+p[97].address:"");for(let p=0;p<s.length;p+=1){let g=SI(n,s,p),_=d(g);i.set(_,t[p]=EI(_,g))}return{c(){e=ur("ul");for(let p=0;p<t.length;p+=1)t[p].c();jt(e,"class","options svelte-bz0zu3"),jt(e,"role","listbox")},m(p,g){Or(p,e,g);for(let _=0;_<t.length;_+=1)t[_]&&t[_].m(e,null);r=!0,o||(c=[Ws(e,"mouseleave",n[27]),Ws(e,"blur",n[83]),Ws(e,"keydown",n[23])],o=!0)},p(p,g){g[0]&102823936&&(s=pI(p[13]),Uv(),t=tj(t,g,d,1,p,s,i,e,ej,EI,null,SI),jv())},i(p){if(!r){for(let g=0;g<s.length;g+=1)Jr(t[g]);r=!0}},o(p){for(let g=0;g<t.length;g+=1)Fs(t[g]);r=!1},d(p){p&&Cr(e);for(let g=0;g<t.length;g+=1)t[g].d();o=!1,kh(c)}}}function Vj(n){let e,t,i,r,o,c;return t=new OF({}),{c(){e=ur("div"),Od(t.$$.fragment),i=Ya(),r=ur("div"),o=Fd(n[8]),jt(r,"class","svelte-bz0zu3"),jt(e,"class","no-results svelte-bz0zu3")},m(s,d){Or(s,e,d),Th(t,e,null),Rn(e,i),Rn(e,r),Rn(r,o),c=!0},p(s,d){(!c||d[0]&256)&&Ey(o,s[8])},i(s){c||(Jr(t.$$.fragment,s),c=!0)},o(s){Fs(t.$$.fragment,s),c=!1},d(s){s&&Cr(e),Mh(t)}}}function Uj(n){let e="",t;return{c(){t=Fd(e)},m(i,r){Or(i,t,r)},p:jr,i:jr,o:jr,d(i){i&&Cr(t)}}}function jj(n){let e,t,i,r,o,c,s,d,p,g,_;return t=new OF({}),d=new FF({}),{c(){e=ur("div"),Od(t.$$.fragment),i=Ya(),r=ur("div"),o=Fd(n[7]),c=Ya(),s=ur("button"),Od(d.$$.fragment),jt(r,"class","svelte-bz0zu3"),jt(s,"class","svelte-bz0zu3"),jt(e,"class","error svelte-bz0zu3")},m(x,b){Or(x,e,b),Th(t,e,null),Rn(e,i),Rn(e,r),Rn(r,o),Rn(e,c),Rn(e,s),Th(d,s,null),p=!0,g||(_=Ws(s,"click",n[80]),g=!0)},p(x,b){(!p||b[0]&128)&&Ey(o,x[7])},i(x){p||(Jr(t.$$.fragment,x),Jr(d.$$.fragment,x),p=!0)},o(x){Fs(t.$$.fragment,x),Fs(d.$$.fragment,x),p=!1},d(x){x&&Cr(e),Mh(t),Mh(d),g=!1,_()}}}function EI(n,e){var t;let i,r,o;function c(){return e[81](e[99])}function s(){return e[82](e[97])}return r=new _j({props:{feature:e[97],showPlaceType:e[11],style:e[15]===e[99]?"selected":((t=e[14])==null?void 0:t.id)===e[97].id?"picked":"default",missingIconsCache:e[21],iconsBaseUrl:e[12]}}),r.$on("mouseenter",c),r.$on("select",s),{key:n,first:null,c(){i=GU(),Od(r.$$.fragment),this.first=i},m(d,p){Or(d,i,p),Th(r,d,p),o=!0},p(d,p){var g;e=d;const _={};p[0]&8192&&(_.feature=e[97]),p[0]&2048&&(_.showPlaceType=e[11]),p[0]&57344&&(_.style=e[15]===e[99]?"selected":((g=e[14])==null?void 0:g.id)===e[97].id?"picked":"default"),p[0]&4096&&(_.iconsBaseUrl=e[12]),r.$set(_)},i(d){o||(Jr(r.$$.fragment,d),o=!0)},o(d){Fs(r.$$.fragment,d),o=!1},d(d){d&&Cr(i),Mh(r,d)}}}function Gj(n){let e,t,i,r,o,c,s,d,p,g,_,x,b,S,P,L,E,C,D,O=!1;o=new Cj({});let U=!n[20]&&TI(n),q=n[20]&&MI(),G=n[6]==="button"&&CI(n);const N=n[70].default,V=$U(N,n,n[69],null),j=[jj,Uj,Vj,$j],z=[];function Q(X,re){var se,le;return X[19]?0:!X[16]&&!X[4]?1:((se=X[13])==null?void 0:se.length)===0?2:(le=X[13])!=null&&le.length&&(X[16]||X[4])?3:-1}return~(S=Q(n))&&(P=z[S]=j[S](n)),{c(){e=Ya(),t=ur("form"),i=ur("div"),r=ur("button"),Od(o.$$.fragment),c=Ya(),s=ur("input"),d=Ya(),p=ur("div"),U&&U.c(),g=Ya(),q&&q.c(),_=Ya(),G&&G.c(),x=Ya(),V&&V.c(),b=Ya(),P&&P.c(),jt(r,"class","search-button svelte-bz0zu3"),jt(r,"type","button"),jt(s,"placeholder",n[9]),jt(s,"aria-label",n[9]),jt(s,"class","svelte-bz0zu3"),jt(p,"class","clear-button-container svelte-bz0zu3"),lu(p,"displayable",n[1]!==""),jt(i,"class","input-group svelte-bz0zu3"),jt(t,"class",L=cw(n[2])+" svelte-bz0zu3"),lu(t,"can-collapse",n[5]&&n[1]==="")},m(X,re){Or(X,e,re),Or(X,t,re),Rn(t,i),Rn(i,r),Th(o,r,null),Rn(i,c),Rn(i,s),n[72](s),dI(s,n[1]),Rn(i,d),Rn(i,p),U&&U.m(p,null),Rn(p,g),q&&q.m(p,null),Rn(i,_),G&&G.m(i,null),Rn(i,x),V&&V.m(i,null),Rn(t,b),~S&&z[S].m(t,null),E=!0,C||(D=[Ws(r,"click",n[71]),Ws(s,"input",n[73]),Ws(s,"focus",n[74]),Ws(s,"blur",n[75]),Ws(s,"click",n[76]),Ws(s,"keydown",n[23]),Ws(s,"input",n[24]),Ws(s,"change",n[77]),Ws(t,"submit",qU(n[22]))],C=!0)},p(X,re){(!E||re[0]&512)&&jt(s,"placeholder",X[9]),(!E||re[0]&512)&&jt(s,"aria-label",X[9]),re[0]&2&&s.value!==X[1]&&dI(s,X[1]),X[20]?U&&(Uv(),Fs(U,1,1,()=>{U=null}),jv()):U?(U.p(X,re),re[0]&1048576&&Jr(U,1)):(U=TI(X),U.c(),Jr(U,1),U.m(p,g)),X[20]?q?re[0]&1048576&&Jr(q,1):(q=MI(),q.c(),Jr(q,1),q.m(p,null)):q&&(Uv(),Fs(q,1,1,()=>{q=null}),jv()),(!E||re[0]&2)&&lu(p,"displayable",X[1]!==""),X[6]==="button"?G?(G.p(X,re),re[0]&64&&Jr(G,1)):(G=CI(X),G.c(),Jr(G,1),G.m(i,x)):G&&(Uv(),Fs(G,1,1,()=>{G=null}),jv()),V&&V.p&&(!E||re[2]&128)&&UU(V,N,X,X[69],E?VU(N,X[69]):jU(X[69]),null);let se=S;S=Q(X),S===se?~S&&z[S].p(X,re):(P&&(Uv(),Fs(z[se],1,1,()=>{z[se]=null}),jv()),~S?(P=z[S],P?P.p(X,re):(P=z[S]=j[S](X),P.c()),Jr(P,1),P.m(t,null)):P=null),(!E||re[0]&4&&L!==(L=cw(X[2])+" svelte-bz0zu3"))&&jt(t,"class",L),(!E||re[0]&38)&&lu(t,"can-collapse",X[5]&&X[1]==="")},i(X){E||(Jr(O),Jr(o.$$.fragment,X),Jr(U),Jr(q),Jr(G),Jr(V,X),Jr(P),E=!0)},o(X){Fs(O),Fs(o.$$.fragment,X),Fs(U),Fs(q),Fs(G),Fs(V,X),Fs(P),E=!1},d(X){X&&(Cr(e),Cr(t)),Mh(o),n[72](null),U&&U.d(),q&&q.d(),G&&G.d(),V&&V.d(X),~S&&z[S].d(),C=!1,kh(D)}}}function qj(n,e,t){let i,r,o,{$$slots:c={},$$scope:s}=e;const d={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:p=void 0}=e,{apiKey:g=void 0}=e,{bbox:_=void 0}=e,{clearButtonTitle:x="clear"}=e,{clearOnBlur:b=!1}=e,{clearListOnPick:S=!1}=e,{keepListOpen:P=!1}=e,{collapsed:L=!1}=e,{country:E=void 0}=e,{debounceSearch:C=200}=e,{enableReverse:D="never"}=e,{errorMessage:O="Something went wrongâ¦"}=e,{filter:U=()=>!0}=e,{flyTo:q=!0}=e,{fuzzyMatch:G=!0}=e,{language:N=void 0}=e,{limit:V=void 0}=e;const j=41415112612;let{reverseGeocodingLimit:z=j}=e,{mapController:Q=void 0}=e,{minLength:X=2}=e,{noResultsMessage:re="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:se="Search"}=e,{proximity:le=[{type:"server-geolocation"}]}=e,{reverseActive:ce=D==="always"}=e,{reverseButtonTitle:be="toggle reverse geocoding"}=e,{searchValue:Ee=""}=e,{pickedResultStyle:$e="full-geometry"}=e,{showPlaceType:Ve="if-needed"}=e,{showResultsWhileTyping:nt=!0}=e,{selectFirst:He=!0}=e,{flyToSelected:De=!1}=e,{markerOnSelected:ot=!0}=e,{types:xe=void 0}=e;const Be=[];let{reverseGeocodingTypes:Je=Be}=e,{exhaustiveReverseGeocoding:ct=!1}=e,{excludeTypes:xt=!1}=e;const Se=void 0;let{reverseGeocodingExcludeTypes:me=Se}=e,{zoom:qe=d}=e,{apiUrl:st="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Rt={}}=e,{iconsBaseUrl:gt="https://cdn.maptiler.com/maptiler-geocoding-control/v2.1.7/icons/"}=e,{adjustUrlQuery:Ae=()=>{}}=e,{adjustUrl:we=()=>{}}=e;function vt(wt){de.focus(wt)}function ye(){de.blur()}function ie(wt,Ri=!0,bi=!1){t(1,Ee=wt),Ri?(t(15,pe=-1),vi()):(yn(void 0,!bi,bi),setTimeout(()=>{de.focus(),de.select()}))}function ae(){t(13,Ze=void 0),t(14,Me=void 0),t(15,pe=-1)}function ke(){t(64,yt=[]),t(14,Me=void 0)}let Ze,yt,Me,ee="",de,pe=-1,Le,Oe=[],dt,pt,rt,St,Dt=!1;const Bt=new Set,Jt=kF();ZU(()=>{Q&&(Q.setEventHandler(void 0),Q.indicateReverse(!1),Q.setSelectedMarker(-1),Q.setFeatures(void 0,void 0,!1))});function vi(wt){if(t(17,Dt=!1),pt&&(clearTimeout(pt),pt=void 0),pe>-1&&Ze)t(14,Me=Ze[pe]),t(1,Ee=Me.place_type[0]==="reverse"?Me.place_name:Me.place_name.replace(/,.*/,"")),t(19,Le=void 0),t(64,yt=void 0),t(15,pe=-1);else if(Ee){const Ri=wt||!$i(Ee);vn(Ee,{exact:!0}).then(()=>{t(64,yt=Ze),t(14,Me=void 0),Ri&&on()}).catch(bi=>t(19,Le=bi))}}function $i(wt){try{return Nj(wt,6)}catch{return!1}}async function vn(wt,{byId:Ri=!1,exact:bi=!1}={}){var Ni,Kn,Xi;t(19,Le=void 0),dt?.abort();const jn=new AbortController;t(20,dt=jn);try{const an=$i(wt),zr=new URL(st+"/"+encodeURIComponent(an?an.decimalLongitude+","+an.decimalLatitude:wt)+".json"),Gn=zr.searchParams;N!==void 0&&Gn.set("language",Array.isArray(N)?N.join(","):N??"");const[ln]=Q?.getCenterAndZoom()??[];let tn=(Ni=!an||Je===Be?xe:Je)==null?void 0:Ni.map(nr=>typeof nr=="string"?nr:ln===void 0||(nr[0]??0)<=ln&&ln<(nr[1]??1/0)?nr[2]:void 0).filter(nr=>nr!==void 0);tn&&(tn=[...new Set(tn)],Gn.set("types",tn.join(",")));const ns=!an||me===Se?xt:me;if(ns&&Gn.set("excludeTypes",String(ns)),_&&Gn.set("bbox",_.map(nr=>nr.toFixed(6)).join(",")),E&&Gn.set("country",Array.isArray(E)?E.join(","):E),!Ri&&!an){const nr=await Aj(Q,le,jn);nr&&Gn.set("proximity",nr),(bi||!nt)&&Gn.set("autocomplete","false"),Gn.set("fuzzyMatch",String(G))}const ro=z===j?V:z;ro!==void 0&&ro>1&&tn?.length!==1&&console.warn("For reverse geocoding when limit > 1 then types must contain single value."),an?(ro===1||ro!==void 0&&(ct||tn?.length===1))&&Gn.set("limit",String(ro)):V!==void 0&&Gn.set("limit",String(V)),g&&Gn.set("key",g),Ae(Gn),we(zr);const dl=zr.searchParams.get("types")===""&&zr.searchParams.get("excludeTypes")!=="true",xo=zr.toString();if(xo===ee){Ri?(S&&t(13,Ze=void 0),t(14,Me=Oe[0])):(t(13,Ze=Oe),((Kn=Ze[pe])==null?void 0:Kn.id)!==r?.id&&t(15,pe=-1));return}ee=xo;let Ar;if(dl)Ar={type:"FeatureCollection",features:[]};else{const nr=await fetch(xo,{signal:jn.signal,...Rt});if(!nr.ok)throw new Error(await nr.text());Ar=await nr.json()}Jt("response",{url:xo,featureCollection:Ar}),Ri?(S&&t(13,Ze=void 0),t(14,Me=Ar.features[0]),Oe=[Me]):(t(13,Ze=Ar.features.filter(U)),an&&Ze.unshift({type:"Feature",properties:{},id:"reverse_"+an.decimalLongitude+"_"+an.decimalLatitude,text:an.decimalLatitude+", "+an.decimalLongitude,place_name:an.decimalLatitude+", "+an.decimalLongitude,place_type:["reverse"],center:[an.decimalLongitude,an.decimalLatitude],bbox:[an.decimalLongitude,an.decimalLatitude,an.decimalLongitude,an.decimalLatitude],geometry:{type:"Point",coordinates:[an.decimalLongitude,an.decimalLatitude]}}),Oe=Ze,((Xi=Ze[pe])==null?void 0:Xi.id)!==r?.id&&t(15,pe=-1),an&&de.focus())}catch(an){if(an&&typeof an=="object"&&"name"in an&&an.name==="AbortError")return;throw an}finally{jn===dt&&t(20,dt=void 0)}}function on(){var wt;if(!(yt!=null&&yt.length)||!q)return;const Ri=[180,90,-180,-90],bi=!yt.some(Kn=>!Kn.matching_text);let Ni;for(const Kn of yt){const Xi=gn(Kn);if(Ni=Ni===void 0?Xi:Xi===void 0?Ni:Math.max(Ni,Xi),bi||!Kn.matching_text)for(const jn of[0,1,2,3])Ri[jn]=Math[jn<2?"min":"max"](Ri[jn],((wt=Kn.bbox)==null?void 0:wt[jn])??Kn.center[jn%2])}Q&&yt.length>0&&(Me&&Ri[0]===Ri[2]&&Ri[1]===Ri[3]?Q.flyTo(Me.center,gn(Me)):Q.fitBounds(uw(Ri),50,Ni))}function Tt(){!Me||!Q||(!Me.bbox||Me.bbox[0]===Me.bbox[2]&&Me.bbox[1]===Me.bbox[3]?Q.flyTo(Me.center,gn(Me)):Q.fitBounds(uw(Me.bbox),50,gn(Me)))}function gn(wt){var Ri;if(!wt.bbox||wt.bbox[0]!==wt.bbox[2]&&wt.bbox[1]!==wt.bbox[3])return;const bi=wt.id.replace(/\..*/,"");return(Array.isArray((Ri=wt.properties)==null?void 0:Ri.categories)?wt.properties.categories.reduce((Ni,Kn)=>{const Xi=qe[bi+"."+Kn];return Ni===void 0?Xi:Xi===void 0?Ni:Math.max(Ni,Xi)},void 0):void 0)??qe[bi]}function Er(wt){t(0,ce=D==="always"),t(13,Ze=void 0),t(14,Me=void 0),t(15,pe=-1),ie(wt[1].toFixed(6)+", "+Ej(wt[0],[-180,180],!0).toFixed(6),!1,!0)}function Di(wt){if(!Ze)return;let Ri=wt.key==="ArrowDown"?1:wt.key==="ArrowUp"?-1:0;Ri&&(de.focus(),t(17,Dt=!0),wt.preventDefault(),Me&&pe===-1&&t(15,pe=Ze.findIndex(bi=>bi.id===Me?.id)),pe===(Me||He?0:-1)&&Ri===-1&&t(15,pe=Ze.length),t(15,pe+=Ri),pe>=Ze.length&&t(15,pe=-1),pe<0&&(Me||He)&&t(15,pe=0))}function yn(wt,Ri=!0,bi=!1){if(t(19,Le=void 0),t(14,Me=void 0),t(17,Dt=!0),nt||bi){if(pt&&clearTimeout(pt),Ee.length<X)return;const Ni=Ee;pt=window.setTimeout(()=>{vn(Ni).catch(Kn=>t(19,Le=Kn))},Ri?C:0)}else t(13,Ze=void 0),t(19,Le=void 0)}function Yn(wt){Me&&Me?.id===wt?.id?Tt():(t(14,Me=wt),t(1,Ee=wt.place_name))}function Cn(wt){t(15,pe=wt)}function Un(){(!He||Me)&&t(15,pe=-1),De&&Tt()}const En=()=>de.focus();function dr(wt){NM[wt?"unshift":"push"](()=>{de=wt,t(18,de)})}function Xe(){Ee=this.value,t(1,Ee),t(17,Dt),t(31,b),t(16,rt)}const kt=()=>t(17,Dt=!0),lt=()=>t(17,Dt=!1),Ft=()=>t(17,Dt=!0),Wt=()=>t(14,Me=void 0),qi=()=>{t(1,Ee=""),t(14,Me=void 0),de.focus()},Ii=()=>t(0,ce=!ce),Nt=()=>t(19,Le=void 0),ai=wt=>Cn(wt),pi=wt=>Yn(wt),Wi=()=>{};return n.$$set=wt=>{"class"in wt&&t(2,p=wt.class),"apiKey"in wt&&t(29,g=wt.apiKey),"bbox"in wt&&t(30,_=wt.bbox),"clearButtonTitle"in wt&&t(3,x=wt.clearButtonTitle),"clearOnBlur"in wt&&t(31,b=wt.clearOnBlur),"clearListOnPick"in wt&&t(32,S=wt.clearListOnPick),"keepListOpen"in wt&&t(4,P=wt.keepListOpen),"collapsed"in wt&&t(5,L=wt.collapsed),"country"in wt&&t(33,E=wt.country),"debounceSearch"in wt&&t(34,C=wt.debounceSearch),"enableReverse"in wt&&t(6,D=wt.enableReverse),"errorMessage"in wt&&t(7,O=wt.errorMessage),"filter"in wt&&t(35,U=wt.filter),"flyTo"in wt&&t(36,q=wt.flyTo),"fuzzyMatch"in wt&&t(37,G=wt.fuzzyMatch),"language"in wt&&t(38,N=wt.language),"limit"in wt&&t(39,V=wt.limit),"reverseGeocodingLimit"in wt&&t(40,z=wt.reverseGeocodingLimit),"mapController"in wt&&t(41,Q=wt.mapController),"minLength"in wt&&t(42,X=wt.minLength),"noResultsMessage"in wt&&t(8,re=wt.noResultsMessage),"placeholder"in wt&&t(9,se=wt.placeholder),"proximity"in wt&&t(43,le=wt.proximity),"reverseActive"in wt&&t(0,ce=wt.reverseActive),"reverseButtonTitle"in wt&&t(10,be=wt.reverseButtonTitle),"searchValue"in wt&&t(1,Ee=wt.searchValue),"pickedResultStyle"in wt&&t(44,$e=wt.pickedResultStyle),"showPlaceType"in wt&&t(11,Ve=wt.showPlaceType),"showResultsWhileTyping"in wt&&t(45,nt=wt.showResultsWhileTyping),"selectFirst"in wt&&t(46,He=wt.selectFirst),"flyToSelected"in wt&&t(47,De=wt.flyToSelected),"markerOnSelected"in wt&&t(48,ot=wt.markerOnSelected),"types"in wt&&t(49,xe=wt.types),"reverseGeocodingTypes"in wt&&t(50,Je=wt.reverseGeocodingTypes),"exhaustiveReverseGeocoding"in wt&&t(51,ct=wt.exhaustiveReverseGeocoding),"excludeTypes"in wt&&t(52,xt=wt.excludeTypes),"reverseGeocodingExcludeTypes"in wt&&t(53,me=wt.reverseGeocodingExcludeTypes),"zoom"in wt&&t(54,qe=wt.zoom),"apiUrl"in wt&&t(55,st=wt.apiUrl),"fetchParameters"in wt&&t(56,Rt=wt.fetchParameters),"iconsBaseUrl"in wt&&t(12,gt=wt.iconsBaseUrl),"adjustUrlQuery"in wt&&t(57,Ae=wt.adjustUrlQuery),"adjustUrl"in wt&&t(58,we=wt.adjustUrl),"$$scope"in wt&&t(69,s=wt.$$scope)},n.$$.update=()=>{if(n.$$.dirty[0]&64&&t(0,ce=D==="always"),n.$$.dirty[0]&16384|n.$$.dirty[1]&8192&&$e!=="marker-only"&&Me&&!Me.address&&Me.geometry.type==="Point"&&Me.place_type[0]!=="reverse"&&vn(Me.id,{byId:!0}).catch(wt=>t(19,Le=wt)),n.$$.dirty[0]&16384|n.$$.dirty[1]&1058|n.$$.dirty[2]&8&&(Q&&Me&&Me.id!==St&&q&&(Tt(),S&&t(13,Ze=void 0),t(64,yt=void 0),t(15,pe=-1)),t(65,St=Me?.id)),n.$$.dirty[0]&196608|n.$$.dirty[1]&1&&setTimeout(()=>{t(16,rt=Dt),b&&!rt&&t(1,Ee="")}),n.$$.dirty[0]&8194|n.$$.dirty[1]&2048&&Ee.length<X&&(t(13,Ze=void 0),t(19,Le=void 0),t(64,yt=Ze)),n.$$.dirty[0]&57344|n.$$.dirty[1]&32768&&He&&Ze!=null&&Ze.length&&pe==-1&&!Me&&t(15,pe=0),n.$$.dirty[0]&8192|n.$$.dirty[2]&4&&yt!==Ze&&t(64,yt=void 0),n.$$.dirty[0]&73729|n.$$.dirty[1]&1024|n.$$.dirty[2]&4&&Q&&Q.setEventHandler(wt=>{switch(wt.type){case"mapClick":ce&&Er(wt.coordinates);break;case"markerClick":{const Ri=Ze?.find(bi=>bi.id===wt.id);Ri&&Yn(Ri)}break;case"markerMouseEnter":yt&&t(15,pe=rt?Ze?.findIndex(Ri=>Ri.id===wt.id)??-1:-1);break;case"markerMouseLeave":yt&&t(15,pe=-1);break}}),n.$$.dirty[0]&40960&&t(66,r=Ze?.[pe]),n.$$.dirty[1]&66592|n.$$.dirty[2]&16&&Q&&r&&q&&De&&Q.flyTo(r.center,gn(r)),n.$$.dirty[1]&8192&&t(68,i=$e==="full-geometry-including-polygon-center-marker"),n.$$.dirty[1]&132096|n.$$.dirty[2]&64&&(ot||Q==null||Q.setFeatures(void 0,void 0,i)),n.$$.dirty[0]&16384|n.$$.dirty[1]&132096|n.$$.dirty[2]&84&&Q&&ot&&!yt&&(Q.setFeatures(r?[r]:void 0,Me,i),Q.setSelectedMarker(r?0:-1)),n.$$.dirty[0]&16384|n.$$.dirty[1]&1024|n.$$.dirty[2]&68&&Q&&Q.setFeatures(yt,Me,i),n.$$.dirty[0]&32768|n.$$.dirty[1]&1024|n.$$.dirty[2]&4&&yt&&Q&&Q.setSelectedMarker(pe),n.$$.dirty[0]&2|n.$$.dirty[1]&1024&&Q){const wt=$i(Ee);Q.setReverseMarker(wt?[wt.decimalLongitude,wt.decimalLatitude]:void 0)}n.$$.dirty[2]&16&&Jt("select",{feature:r}),n.$$.dirty[0]&16384&&Jt("pick",{feature:Me}),n.$$.dirty[0]&73744&&t(67,o=!!(Ze!=null&&Ze.length)&&(rt||P)),n.$$.dirty[2]&32&&Jt("optionsvisibilitychange",{optionsVisible:o}),n.$$.dirty[0]&8192&&Jt("featureslisted",{features:Ze}),n.$$.dirty[2]&4&&Jt("featuresmarked",{features:yt}),n.$$.dirty[0]&1&&Jt("reversetoggle",{reverse:ce}),n.$$.dirty[0]&2&&Jt("querychange",{query:Ee}),n.$$.dirty[0]&1|n.$$.dirty[1]&1024&&Q&&Q.indicateReverse(ce)},[ce,Ee,p,x,P,L,D,O,re,se,be,Ve,gt,Ze,Me,pe,rt,Dt,de,Le,dt,Bt,vi,Di,yn,Yn,Cn,Un,d,g,_,b,S,E,C,U,q,G,N,V,z,Q,X,le,$e,nt,He,De,ot,xe,Je,ct,xt,me,qe,st,Rt,Ae,we,vt,ye,ie,ae,ke,yt,St,r,o,i,s,c,En,dr,Xe,kt,lt,Ft,Wt,qi,Ii,Nt,ai,pi,Wi]}let Wj=class extends Xd{constructor(n){super(),Zd(this,n,qj,Gj,Hd,{ZOOM_DEFAULTS:28,class:2,apiKey:29,bbox:30,clearButtonTitle:3,clearOnBlur:31,clearListOnPick:32,keepListOpen:4,collapsed:5,country:33,debounceSearch:34,enableReverse:6,errorMessage:7,filter:35,flyTo:36,fuzzyMatch:37,language:38,limit:39,reverseGeocodingLimit:40,mapController:41,minLength:42,noResultsMessage:8,placeholder:9,proximity:43,reverseActive:0,reverseButtonTitle:10,searchValue:1,pickedResultStyle:44,showPlaceType:11,showResultsWhileTyping:45,selectFirst:46,flyToSelected:47,markerOnSelected:48,types:49,reverseGeocodingTypes:50,exhaustiveReverseGeocoding:51,excludeTypes:52,reverseGeocodingExcludeTypes:53,zoom:54,apiUrl:55,fetchParameters:56,iconsBaseUrl:12,adjustUrlQuery:57,adjustUrl:58,focus:59,blur:60,setQuery:61,clearList:62,clearMap:63},null,[-1,-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[28]}get focus(){return this.$$.ctx[59]}get blur(){return this.$$.ctx[60]}get setQuery(){return this.$$.ctx[61]}get clearList(){return this.$$.ctx[62]}get clearMap(){return this.$$.ctx[63]}};function Py(n,e,t={}){const i={type:"Feature"};return(t.id===0||t.id)&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.properties=e||{},i.geometry=n,i}function uC(n,e,t={}){for(const i of n){if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(i[i.length-1].length!==i[0].length)throw new Error("First and last Position are not equivalent.");for(let r=0;r<i[i.length-1].length;r++)if(i[i.length-1][r]!==i[0][r])throw new Error("First and last Position are not equivalent.")}return Py({type:"Polygon",coordinates:n},e,t)}function Iy(n,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=n,t}function BF(n,e,t={}){return Py({type:"MultiPolygon",coordinates:n},e,t)}var Hj=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,YS=Math.ceil,El=Math.floor,pa="[BigNumber Error] ",AI=pa+"Number primitive has more than 15 significant digits: ",gc=1e14,hn=14,PI=9007199254740991,KS=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],cd=1e7,qa=1e9;function NF(n){var e,t,i,r=C.prototype={constructor:C,toString:null,valueOf:null},o=new C(1),c=20,s=4,d=-7,p=21,g=-1e7,_=1e7,x=!1,b=1,S=0,P={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"Â ",suffix:""},L="0123456789abcdefghijklmnopqrstuvwxyz",E=!0;function C(N,V){var j,z,Q,X,re,se,le,ce,be=this;if(!(be instanceof C))return new C(N,V);if(V==null){if(N&&N._isBigNumber===!0){be.s=N.s,!N.c||N.e>_?be.c=be.e=null:N.e<g?be.c=[be.e=0]:(be.e=N.e,be.c=N.c.slice());return}if((se=typeof N=="number")&&N*0==0){if(be.s=1/N<0?(N=-N,-1):1,N===~~N){for(X=0,re=N;re>=10;re/=10,X++);X>_?be.c=be.e=null:(be.e=X,be.c=[N]);return}ce=String(N)}else{if(!Hj.test(ce=String(N)))return i(be,ce,se);be.s=ce.charCodeAt(0)==45?(ce=ce.slice(1),-1):1}(X=ce.indexOf("."))>-1&&(ce=ce.replace(".","")),(re=ce.search(/e/i))>0?(X<0&&(X=re),X+=+ce.slice(re+1),ce=ce.substring(0,re)):X<0&&(X=ce.length)}else{if(os(V,2,L.length,"Base"),V==10&&E)return be=new C(N),q(be,c+be.e+1,s);if(ce=String(N),se=typeof N=="number"){if(N*0!=0)return i(be,ce,se,V);if(be.s=1/N<0?(ce=ce.slice(1),-1):1,C.DEBUG&&ce.replace(/^0\.0*|\./,"").length>15)throw Error(AI+N)}else be.s=ce.charCodeAt(0)===45?(ce=ce.slice(1),-1):1;for(j=L.slice(0,V),X=re=0,le=ce.length;re<le;re++)if(j.indexOf(z=ce.charAt(re))<0){if(z=="."){if(re>X){X=le;continue}}else if(!Q&&(ce==ce.toUpperCase()&&(ce=ce.toLowerCase())||ce==ce.toLowerCase()&&(ce=ce.toUpperCase()))){Q=!0,re=-1,X=0;continue}return i(be,String(N),se,V)}se=!1,ce=t(ce,V,10,be.s),(X=ce.indexOf("."))>-1?ce=ce.replace(".",""):X=ce.length}for(re=0;ce.charCodeAt(re)===48;re++);for(le=ce.length;ce.charCodeAt(--le)===48;);if(ce=ce.slice(re,++le)){if(le-=re,se&&C.DEBUG&&le>15&&(N>PI||N!==El(N)))throw Error(AI+be.s*N);if((X=X-re-1)>_)be.c=be.e=null;else if(X<g)be.c=[be.e=0];else{if(be.e=X,be.c=[],re=(X+1)%hn,X<0&&(re+=hn),re<le){for(re&&be.c.push(+ce.slice(0,re)),le-=hn;re<le;)be.c.push(+ce.slice(re,re+=hn));re=hn-(ce=ce.slice(re)).length}else re-=le;for(;re--;ce+="0");be.c.push(+ce)}}else be.c=[be.e=0]}C.clone=NF,C.ROUND_UP=0,C.ROUND_DOWN=1,C.ROUND_CEIL=2,C.ROUND_FLOOR=3,C.ROUND_HALF_UP=4,C.ROUND_HALF_DOWN=5,C.ROUND_HALF_EVEN=6,C.ROUND_HALF_CEIL=7,C.ROUND_HALF_FLOOR=8,C.EUCLID=9,C.config=C.set=function(N){var V,j;if(N!=null)if(typeof N=="object"){if(N.hasOwnProperty(V="DECIMAL_PLACES")&&(j=N[V],os(j,0,qa,V),c=j),N.hasOwnProperty(V="ROUNDING_MODE")&&(j=N[V],os(j,0,8,V),s=j),N.hasOwnProperty(V="EXPONENTIAL_AT")&&(j=N[V],j&&j.pop?(os(j[0],-1e9,0,V),os(j[1],0,qa,V),d=j[0],p=j[1]):(os(j,-1e9,qa,V),d=-(p=j<0?-j:j))),N.hasOwnProperty(V="RANGE"))if(j=N[V],j&&j.pop)os(j[0],-1e9,-1,V),os(j[1],1,qa,V),g=j[0],_=j[1];else if(os(j,-1e9,qa,V),j)g=-(_=j<0?-j:j);else throw Error(pa+V+" cannot be zero: "+j);if(N.hasOwnProperty(V="CRYPTO"))if(j=N[V],j===!!j)if(j)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))x=j;else throw x=!j,Error(pa+"crypto unavailable");else x=j;else throw Error(pa+V+" not true or false: "+j);if(N.hasOwnProperty(V="MODULO_MODE")&&(j=N[V],os(j,0,9,V),b=j),N.hasOwnProperty(V="POW_PRECISION")&&(j=N[V],os(j,0,qa,V),S=j),N.hasOwnProperty(V="FORMAT"))if(j=N[V],typeof j=="object")P=j;else throw Error(pa+V+" not an object: "+j);if(N.hasOwnProperty(V="ALPHABET"))if(j=N[V],typeof j=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(j))E=j.slice(0,10)=="0123456789",L=j;else throw Error(pa+V+" invalid: "+j)}else throw Error(pa+"Object expected: "+N);return{DECIMAL_PLACES:c,ROUNDING_MODE:s,EXPONENTIAL_AT:[d,p],RANGE:[g,_],CRYPTO:x,MODULO_MODE:b,POW_PRECISION:S,FORMAT:P,ALPHABET:L}},C.isBigNumber=function(N){if(!N||N._isBigNumber!==!0)return!1;if(!C.DEBUG)return!0;var V,j,z=N.c,Q=N.e,X=N.s;e:if({}.toString.call(z)=="[object Array]"){if((X===1||X===-1)&&Q>=-1e9&&Q<=qa&&Q===El(Q)){if(z[0]===0){if(Q===0&&z.length===1)return!0;break e}if(V=(Q+1)%hn,V<1&&(V+=hn),String(z[0]).length==V){for(V=0;V<z.length;V++)if(j=z[V],j<0||j>=gc||j!==El(j))break e;if(j!==0)return!0}}}else if(z===null&&Q===null&&(X===null||X===1||X===-1))return!0;throw Error(pa+"Invalid BigNumber: "+N)},C.maximum=C.max=function(){return O(arguments,-1)},C.minimum=C.min=function(){return O(arguments,1)},C.random=(function(){var N=9007199254740992,V=Math.random()*N&2097151?function(){return El(Math.random()*N)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(j){var z,Q,X,re,se,le=0,ce=[],be=new C(o);if(j==null?j=c:os(j,0,qa),re=YS(j/hn),x)if(crypto.getRandomValues){for(z=crypto.getRandomValues(new Uint32Array(re*=2));le<re;)se=z[le]*131072+(z[le+1]>>>11),se>=9e15?(Q=crypto.getRandomValues(new Uint32Array(2)),z[le]=Q[0],z[le+1]=Q[1]):(ce.push(se%1e14),le+=2);le=re/2}else if(crypto.randomBytes){for(z=crypto.randomBytes(re*=7);le<re;)se=(z[le]&31)*281474976710656+z[le+1]*1099511627776+z[le+2]*4294967296+z[le+3]*16777216+(z[le+4]<<16)+(z[le+5]<<8)+z[le+6],se>=9e15?crypto.randomBytes(7).copy(z,le):(ce.push(se%1e14),le+=7);le=re/7}else throw x=!1,Error(pa+"crypto unavailable");if(!x)for(;le<re;)se=V(),se<9e15&&(ce[le++]=se%1e14);for(re=ce[--le],j%=hn,re&&j&&(se=KS[hn-j],ce[le]=El(re/se)*se);ce[le]===0;ce.pop(),le--);if(le<0)ce=[X=0];else{for(X=-1;ce[0]===0;ce.splice(0,1),X-=hn);for(le=1,se=ce[0];se>=10;se/=10,le++);le<hn&&(X-=hn-le)}return be.e=X,be.c=ce,be}})(),C.sum=function(){for(var N=1,V=arguments,j=new C(V[0]);N<V.length;)j=j.plus(V[N++]);return j},t=(function(){var N="0123456789";function V(j,z,Q,X){for(var re,se=[0],le,ce=0,be=j.length;ce<be;){for(le=se.length;le--;se[le]*=z);for(se[0]+=X.indexOf(j.charAt(ce++)),re=0;re<se.length;re++)se[re]>Q-1&&(se[re+1]==null&&(se[re+1]=0),se[re+1]+=se[re]/Q|0,se[re]%=Q)}return se.reverse()}return function(j,z,Q,X,re){var se,le,ce,be,Ee,$e,Ve,nt,He=j.indexOf("."),De=c,ot=s;for(He>=0&&(be=S,S=0,j=j.replace(".",""),nt=new C(z),$e=nt.pow(j.length-He),S=be,nt.c=V(Qu(Ml($e.c),$e.e,"0"),10,Q,N),nt.e=nt.c.length),Ve=V(j,z,Q,re?(se=L,N):(se=N,L)),ce=be=Ve.length;Ve[--be]==0;Ve.pop());if(!Ve[0])return se.charAt(0);if(He<0?--ce:($e.c=Ve,$e.e=ce,$e.s=X,$e=e($e,nt,De,ot,Q),Ve=$e.c,Ee=$e.r,ce=$e.e),le=ce+De+1,He=Ve[le],be=Q/2,Ee=Ee||le<0||Ve[le+1]!=null,Ee=ot<4?(He!=null||Ee)&&(ot==0||ot==($e.s<0?3:2)):He>be||He==be&&(ot==4||Ee||ot==6&&Ve[le-1]&1||ot==($e.s<0?8:7)),le<1||!Ve[0])j=Ee?Qu(se.charAt(1),-De,se.charAt(0)):se.charAt(0);else{if(Ve.length=le,Ee)for(--Q;++Ve[--le]>Q;)Ve[le]=0,le||(++ce,Ve=[1].concat(Ve));for(be=Ve.length;!Ve[--be];);for(He=0,j="";He<=be;j+=se.charAt(Ve[He++]));j=Qu(j,ce,se.charAt(0))}return j}})(),e=(function(){function N(z,Q,X){var re,se,le,ce,be=0,Ee=z.length,$e=Q%cd,Ve=Q/cd|0;for(z=z.slice();Ee--;)le=z[Ee]%cd,ce=z[Ee]/cd|0,re=Ve*le+ce*$e,se=$e*le+re%cd*cd+be,be=(se/X|0)+(re/cd|0)+Ve*ce,z[Ee]=se%X;return be&&(z=[be].concat(z)),z}function V(z,Q,X,re){var se,le;if(X!=re)le=X>re?1:-1;else for(se=le=0;se<X;se++)if(z[se]!=Q[se]){le=z[se]>Q[se]?1:-1;break}return le}function j(z,Q,X,re){for(var se=0;X--;)z[X]-=se,se=z[X]<Q[X]?1:0,z[X]=se*re+z[X]-Q[X];for(;!z[0]&&z.length>1;z.splice(0,1));}return function(z,Q,X,re,se){var le,ce,be,Ee,$e,Ve,nt,He,De,ot,xe,Be,Je,ct,xt,Se,me,qe=z.s==Q.s?1:-1,st=z.c,Rt=Q.c;if(!st||!st[0]||!Rt||!Rt[0])return new C(!z.s||!Q.s||(st?Rt&&st[0]==Rt[0]:!Rt)?NaN:st&&st[0]==0||!Rt?qe*0:qe/0);for(He=new C(qe),De=He.c=[],ce=z.e-Q.e,qe=X+ce+1,se||(se=gc,ce=Al(z.e/hn)-Al(Q.e/hn),qe=qe/hn|0),be=0;Rt[be]==(st[be]||0);be++);if(Rt[be]>(st[be]||0)&&ce--,qe<0)De.push(1),Ee=!0;else{for(ct=st.length,Se=Rt.length,be=0,qe+=2,$e=El(se/(Rt[0]+1)),$e>1&&(Rt=N(Rt,$e,se),st=N(st,$e,se),Se=Rt.length,ct=st.length),Je=Se,ot=st.slice(0,Se),xe=ot.length;xe<Se;ot[xe++]=0);me=Rt.slice(),me=[0].concat(me),xt=Rt[0],Rt[1]>=se/2&&xt++;do{if($e=0,le=V(Rt,ot,Se,xe),le<0){if(Be=ot[0],Se!=xe&&(Be=Be*se+(ot[1]||0)),$e=El(Be/xt),$e>1)for($e>=se&&($e=se-1),Ve=N(Rt,$e,se),nt=Ve.length,xe=ot.length;V(Ve,ot,nt,xe)==1;)$e--,j(Ve,Se<nt?me:Rt,nt,se),nt=Ve.length,le=1;else $e==0&&(le=$e=1),Ve=Rt.slice(),nt=Ve.length;if(nt<xe&&(Ve=[0].concat(Ve)),j(ot,Ve,xe,se),xe=ot.length,le==-1)for(;V(Rt,ot,Se,xe)<1;)$e++,j(ot,Se<xe?me:Rt,xe,se),xe=ot.length}else le===0&&($e++,ot=[0]);De[be++]=$e,ot[0]?ot[xe++]=st[Je]||0:(ot=[st[Je]],xe=1)}while((Je++<ct||ot[0]!=null)&&qe--);Ee=ot[0]!=null,De[0]||De.splice(0,1)}if(se==gc){for(be=1,qe=De[0];qe>=10;qe/=10,be++);q(He,X+(He.e=be+ce*hn-1)+1,re,Ee)}else He.e=ce,He.r=+Ee;return He}})();function D(N,V,j,z){var Q,X,re,se,le;if(j==null?j=s:os(j,0,8),!N.c)return N.toString();if(Q=N.c[0],re=N.e,V==null)le=Ml(N.c),le=z==1||z==2&&(re<=d||re>=p)?Ib(le,re):Qu(le,re,"0");else if(N=q(new C(N),V,j),X=N.e,le=Ml(N.c),se=le.length,z==1||z==2&&(V<=X||X<=d)){for(;se<V;le+="0",se++);le=Ib(le,X)}else if(V-=re,le=Qu(le,X,"0"),X+1>se){if(--V>0)for(le+=".";V--;le+="0");}else if(V+=X-se,V>0)for(X+1==se&&(le+=".");V--;le+="0");return N.s<0&&Q?"-"+le:le}function O(N,V){for(var j,z,Q=1,X=new C(N[0]);Q<N.length;Q++)z=new C(N[Q]),(!z.s||(j=Vf(X,z))===V||j===0&&X.s===V)&&(X=z);return X}function U(N,V,j){for(var z=1,Q=V.length;!V[--Q];V.pop());for(Q=V[0];Q>=10;Q/=10,z++);return(j=z+j*hn-1)>_?N.c=N.e=null:j<g?N.c=[N.e=0]:(N.e=j,N.c=V),N}i=(function(){var N=/^(-?)0([xbo])(?=\w[\w.]*$)/i,V=/^([^.]+)\.$/,j=/^\.([^.]+)$/,z=/^-?(Infinity|NaN)$/,Q=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(X,re,se,le){var ce,be=se?re:re.replace(Q,"");if(z.test(be))X.s=isNaN(be)?null:be<0?-1:1;else{if(!se&&(be=be.replace(N,function(Ee,$e,Ve){return ce=(Ve=Ve.toLowerCase())=="x"?16:Ve=="b"?2:8,!le||le==ce?$e:Ee}),le&&(ce=le,be=be.replace(V,"$1").replace(j,"0.$1")),re!=be))return new C(be,ce);if(C.DEBUG)throw Error(pa+"Not a"+(le?" base "+le:"")+" number: "+re);X.s=null}X.c=X.e=null}})();function q(N,V,j,z){var Q,X,re,se,le,ce,be,Ee=N.c,$e=KS;if(Ee){e:{for(Q=1,se=Ee[0];se>=10;se/=10,Q++);if(X=V-Q,X<0)X+=hn,re=V,le=Ee[ce=0],be=El(le/$e[Q-re-1]%10);else if(ce=YS((X+1)/hn),ce>=Ee.length)if(z){for(;Ee.length<=ce;Ee.push(0));le=be=0,Q=1,X%=hn,re=X-hn+1}else break e;else{for(le=se=Ee[ce],Q=1;se>=10;se/=10,Q++);X%=hn,re=X-hn+Q,be=re<0?0:El(le/$e[Q-re-1]%10)}if(z=z||V<0||Ee[ce+1]!=null||(re<0?le:le%$e[Q-re-1]),z=j<4?(be||z)&&(j==0||j==(N.s<0?3:2)):be>5||be==5&&(j==4||z||j==6&&(X>0?re>0?le/$e[Q-re]:0:Ee[ce-1])%10&1||j==(N.s<0?8:7)),V<1||!Ee[0])return Ee.length=0,z?(V-=N.e+1,Ee[0]=$e[(hn-V%hn)%hn],N.e=-V||0):Ee[0]=N.e=0,N;if(X==0?(Ee.length=ce,se=1,ce--):(Ee.length=ce+1,se=$e[hn-X],Ee[ce]=re>0?El(le/$e[Q-re]%$e[re])*se:0),z)for(;;)if(ce==0){for(X=1,re=Ee[0];re>=10;re/=10,X++);for(re=Ee[0]+=se,se=1;re>=10;re/=10,se++);X!=se&&(N.e++,Ee[0]==gc&&(Ee[0]=1));break}else{if(Ee[ce]+=se,Ee[ce]!=gc)break;Ee[ce--]=0,se=1}for(X=Ee.length;Ee[--X]===0;Ee.pop());}N.e>_?N.c=N.e=null:N.e<g&&(N.c=[N.e=0])}return N}function G(N){var V,j=N.e;return j===null?N.toString():(V=Ml(N.c),V=j<=d||j>=p?Ib(V,j):Qu(V,j,"0"),N.s<0?"-"+V:V)}return r.absoluteValue=r.abs=function(){var N=new C(this);return N.s<0&&(N.s=1),N},r.comparedTo=function(N,V){return Vf(this,new C(N,V))},r.decimalPlaces=r.dp=function(N,V){var j,z,Q,X=this;if(N!=null)return os(N,0,qa),V==null?V=s:os(V,0,8),q(new C(X),N+X.e+1,V);if(!(j=X.c))return null;if(z=((Q=j.length-1)-Al(this.e/hn))*hn,Q=j[Q])for(;Q%10==0;Q/=10,z--);return z<0&&(z=0),z},r.dividedBy=r.div=function(N,V){return e(this,new C(N,V),c,s)},r.dividedToIntegerBy=r.idiv=function(N,V){return e(this,new C(N,V),0,1)},r.exponentiatedBy=r.pow=function(N,V){var j,z,Q,X,re,se,le,ce,be,Ee=this;if(N=new C(N),N.c&&!N.isInteger())throw Error(pa+"Exponent not an integer: "+G(N));if(V!=null&&(V=new C(V)),se=N.e>14,!Ee.c||!Ee.c[0]||Ee.c[0]==1&&!Ee.e&&Ee.c.length==1||!N.c||!N.c[0])return be=new C(Math.pow(+G(Ee),se?N.s*(2-Pb(N)):+G(N))),V?be.mod(V):be;if(le=N.s<0,V){if(V.c?!V.c[0]:!V.s)return new C(NaN);z=!le&&Ee.isInteger()&&V.isInteger(),z&&(Ee=Ee.mod(V))}else{if(N.e>9&&(Ee.e>0||Ee.e<-1||(Ee.e==0?Ee.c[0]>1||se&&Ee.c[1]>=24e7:Ee.c[0]<8e13||se&&Ee.c[0]<=9999975e7)))return X=Ee.s<0&&Pb(N)?-0:0,Ee.e>-1&&(X=1/X),new C(le?1/X:X);S&&(X=YS(S/hn+2))}for(se?(j=new C(.5),le&&(N.s=1),ce=Pb(N)):(Q=Math.abs(+G(N)),ce=Q%2),be=new C(o);;){if(ce){if(be=be.times(Ee),!be.c)break;X?be.c.length>X&&(be.c.length=X):z&&(be=be.mod(V))}if(Q){if(Q=El(Q/2),Q===0)break;ce=Q%2}else if(N=N.times(j),q(N,N.e+1,1),N.e>14)ce=Pb(N);else{if(Q=+G(N),Q===0)break;ce=Q%2}Ee=Ee.times(Ee),X?Ee.c&&Ee.c.length>X&&(Ee.c.length=X):z&&(Ee=Ee.mod(V))}return z?be:(le&&(be=o.div(be)),V?be.mod(V):X?q(be,S,s,re):be)},r.integerValue=function(N){var V=new C(this);return N==null?N=s:os(N,0,8),q(V,V.e+1,N)},r.isEqualTo=r.eq=function(N,V){return Vf(this,new C(N,V))===0},r.isFinite=function(){return!!this.c},r.isGreaterThan=r.gt=function(N,V){return Vf(this,new C(N,V))>0},r.isGreaterThanOrEqualTo=r.gte=function(N,V){return(V=Vf(this,new C(N,V)))===1||V===0},r.isInteger=function(){return!!this.c&&Al(this.e/hn)>this.c.length-2},r.isLessThan=r.lt=function(N,V){return Vf(this,new C(N,V))<0},r.isLessThanOrEqualTo=r.lte=function(N,V){return(V=Vf(this,new C(N,V)))===-1||V===0},r.isNaN=function(){return!this.s},r.isNegative=function(){return this.s<0},r.isPositive=function(){return this.s>0},r.isZero=function(){return!!this.c&&this.c[0]==0},r.minus=function(N,V){var j,z,Q,X,re=this,se=re.s;if(N=new C(N,V),V=N.s,!se||!V)return new C(NaN);if(se!=V)return N.s=-V,re.plus(N);var le=re.e/hn,ce=N.e/hn,be=re.c,Ee=N.c;if(!le||!ce){if(!be||!Ee)return be?(N.s=-V,N):new C(Ee?re:NaN);if(!be[0]||!Ee[0])return Ee[0]?(N.s=-V,N):new C(be[0]?re:s==3?-0:0)}if(le=Al(le),ce=Al(ce),be=be.slice(),se=le-ce){for((X=se<0)?(se=-se,Q=be):(ce=le,Q=Ee),Q.reverse(),V=se;V--;Q.push(0));Q.reverse()}else for(z=(X=(se=be.length)<(V=Ee.length))?se:V,se=V=0;V<z;V++)if(be[V]!=Ee[V]){X=be[V]<Ee[V];break}if(X&&(Q=be,be=Ee,Ee=Q,N.s=-N.s),V=(z=Ee.length)-(j=be.length),V>0)for(;V--;be[j++]=0);for(V=gc-1;z>se;){if(be[--z]<Ee[z]){for(j=z;j&&!be[--j];be[j]=V);--be[j],be[z]+=gc}be[z]-=Ee[z]}for(;be[0]==0;be.splice(0,1),--ce);return be[0]?U(N,be,ce):(N.s=s==3?-1:1,N.c=[N.e=0],N)},r.modulo=r.mod=function(N,V){var j,z,Q=this;return N=new C(N,V),!Q.c||!N.s||N.c&&!N.c[0]?new C(NaN):!N.c||Q.c&&!Q.c[0]?new C(Q):(b==9?(z=N.s,N.s=1,j=e(Q,N,0,3),N.s=z,j.s*=z):j=e(Q,N,0,b),N=Q.minus(j.times(N)),!N.c[0]&&b==1&&(N.s=Q.s),N)},r.multipliedBy=r.times=function(N,V){var j,z,Q,X,re,se,le,ce,be,Ee,$e,Ve,nt,He,De,ot=this,xe=ot.c,Be=(N=new C(N,V)).c;if(!xe||!Be||!xe[0]||!Be[0])return!ot.s||!N.s||xe&&!xe[0]&&!Be||Be&&!Be[0]&&!xe?N.c=N.e=N.s=null:(N.s*=ot.s,!xe||!Be?N.c=N.e=null:(N.c=[0],N.e=0)),N;for(z=Al(ot.e/hn)+Al(N.e/hn),N.s*=ot.s,le=xe.length,Ee=Be.length,le<Ee&&(nt=xe,xe=Be,Be=nt,Q=le,le=Ee,Ee=Q),Q=le+Ee,nt=[];Q--;nt.push(0));for(He=gc,De=cd,Q=Ee;--Q>=0;){for(j=0,$e=Be[Q]%De,Ve=Be[Q]/De|0,re=le,X=Q+re;X>Q;)ce=xe[--re]%De,be=xe[re]/De|0,se=Ve*ce+be*$e,ce=$e*ce+se%De*De+nt[X]+j,j=(ce/He|0)+(se/De|0)+Ve*be,nt[X--]=ce%He;nt[X]=j}return j?++z:nt.splice(0,1),U(N,nt,z)},r.negated=function(){var N=new C(this);return N.s=-N.s||null,N},r.plus=function(N,V){var j,z=this,Q=z.s;if(N=new C(N,V),V=N.s,!Q||!V)return new C(NaN);if(Q!=V)return N.s=-V,z.minus(N);var X=z.e/hn,re=N.e/hn,se=z.c,le=N.c;if(!X||!re){if(!se||!le)return new C(Q/0);if(!se[0]||!le[0])return le[0]?N:new C(se[0]?z:Q*0)}if(X=Al(X),re=Al(re),se=se.slice(),Q=X-re){for(Q>0?(re=X,j=le):(Q=-Q,j=se),j.reverse();Q--;j.push(0));j.reverse()}for(Q=se.length,V=le.length,Q-V<0&&(j=le,le=se,se=j,V=Q),Q=0;V;)Q=(se[--V]=se[V]+le[V]+Q)/gc|0,se[V]=gc===se[V]?0:se[V]%gc;return Q&&(se=[Q].concat(se),++re),U(N,se,re)},r.precision=r.sd=function(N,V){var j,z,Q,X=this;if(N!=null&&N!==!!N)return os(N,1,qa),V==null?V=s:os(V,0,8),q(new C(X),N,V);if(!(j=X.c))return null;if(Q=j.length-1,z=Q*hn+1,Q=j[Q]){for(;Q%10==0;Q/=10,z--);for(Q=j[0];Q>=10;Q/=10,z++);}return N&&X.e+1>z&&(z=X.e+1),z},r.shiftedBy=function(N){return os(N,-9007199254740991,PI),this.times("1e"+N)},r.squareRoot=r.sqrt=function(){var N,V,j,z,Q,X=this,re=X.c,se=X.s,le=X.e,ce=c+4,be=new C("0.5");if(se!==1||!re||!re[0])return new C(!se||se<0&&(!re||re[0])?NaN:re?X:1/0);if(se=Math.sqrt(+G(X)),se==0||se==1/0?(V=Ml(re),(V.length+le)%2==0&&(V+="0"),se=Math.sqrt(+V),le=Al((le+1)/2)-(le<0||le%2),se==1/0?V="5e"+le:(V=se.toExponential(),V=V.slice(0,V.indexOf("e")+1)+le),j=new C(V)):j=new C(se+""),j.c[0]){for(le=j.e,se=le+ce,se<3&&(se=0);;)if(Q=j,j=be.times(Q.plus(e(X,Q,ce,1))),Ml(Q.c).slice(0,se)===(V=Ml(j.c)).slice(0,se))if(j.e<le&&--se,V=V.slice(se-3,se+1),V=="9999"||!z&&V=="4999"){if(!z&&(q(Q,Q.e+c+2,0),Q.times(Q).eq(X))){j=Q;break}ce+=4,se+=4,z=1}else{(!+V||!+V.slice(1)&&V.charAt(0)=="5")&&(q(j,j.e+c+2,1),N=!j.times(j).eq(X));break}}return q(j,j.e+c+1,s,N)},r.toExponential=function(N,V){return N!=null&&(os(N,0,qa),N++),D(this,N,V,1)},r.toFixed=function(N,V){return N!=null&&(os(N,0,qa),N=N+this.e+1),D(this,N,V)},r.toFormat=function(N,V,j){var z,Q=this;if(j==null)N!=null&&V&&typeof V=="object"?(j=V,V=null):N&&typeof N=="object"?(j=N,N=V=null):j=P;else if(typeof j!="object")throw Error(pa+"Argument not an object: "+j);if(z=Q.toFixed(N,V),Q.c){var X,re=z.split("."),se=+j.groupSize,le=+j.secondaryGroupSize,ce=j.groupSeparator||"",be=re[0],Ee=re[1],$e=Q.s<0,Ve=$e?be.slice(1):be,nt=Ve.length;if(le&&(X=se,se=le,le=X,nt-=X),se>0&&nt>0){for(X=nt%se||se,be=Ve.substr(0,X);X<nt;X+=se)be+=ce+Ve.substr(X,se);le>0&&(be+=ce+Ve.slice(X)),$e&&(be="-"+be)}z=Ee?be+(j.decimalSeparator||"")+((le=+j.fractionGroupSize)?Ee.replace(new RegExp("\\d{"+le+"}\\B","g"),"$&"+(j.fractionGroupSeparator||"")):Ee):be}return(j.prefix||"")+z+(j.suffix||"")},r.toFraction=function(N){var V,j,z,Q,X,re,se,le,ce,be,Ee,$e,Ve=this,nt=Ve.c;if(N!=null&&(se=new C(N),!se.isInteger()&&(se.c||se.s!==1)||se.lt(o)))throw Error(pa+"Argument "+(se.isInteger()?"out of range: ":"not an integer: ")+G(se));if(!nt)return new C(Ve);for(V=new C(o),ce=j=new C(o),z=le=new C(o),$e=Ml(nt),X=V.e=$e.length-Ve.e-1,V.c[0]=KS[(re=X%hn)<0?hn+re:re],N=!N||se.comparedTo(V)>0?X>0?V:ce:se,re=_,_=1/0,se=new C($e),le.c[0]=0;be=e(se,V,0,1),Q=j.plus(be.times(z)),Q.comparedTo(N)!=1;)j=z,z=Q,ce=le.plus(be.times(Q=ce)),le=Q,V=se.minus(be.times(Q=V)),se=Q;return Q=e(N.minus(j),z,0,1),le=le.plus(Q.times(ce)),j=j.plus(Q.times(z)),le.s=ce.s=Ve.s,X=X*2,Ee=e(ce,z,X,s).minus(Ve).abs().comparedTo(e(le,j,X,s).minus(Ve).abs())<1?[ce,z]:[le,j],_=re,Ee},r.toNumber=function(){return+G(this)},r.toPrecision=function(N,V){return N!=null&&os(N,1,qa),D(this,N,V,2)},r.toString=function(N){var V,j=this,z=j.s,Q=j.e;return Q===null?z?(V="Infinity",z<0&&(V="-"+V)):V="NaN":(N==null?V=Q<=d||Q>=p?Ib(Ml(j.c),Q):Qu(Ml(j.c),Q,"0"):N===10&&E?(j=q(new C(j),c+Q+1,s),V=Qu(Ml(j.c),j.e,"0")):(os(N,2,L.length,"Base"),V=t(Qu(Ml(j.c),Q,"0"),10,N,z,!0)),z<0&&j.c[0]&&(V="-"+V)),V},r.valueOf=r.toJSON=function(){return G(this)},r._isBigNumber=!0,r[Symbol.toStringTag]="BigNumber",r[Symbol.for("nodejs.util.inspect.custom")]=r.valueOf,n!=null&&C.set(n),C}function Al(n){var e=n|0;return n>0||n===e?e:e-1}function Ml(n){for(var e,t,i=1,r=n.length,o=n[0]+"";i<r;){for(e=n[i++]+"",t=hn-e.length;t--;e="0"+e);o+=e}for(r=o.length;o.charCodeAt(--r)===48;);return o.slice(0,r+1||1)}function Vf(n,e){var t,i,r=n.c,o=e.c,c=n.s,s=e.s,d=n.e,p=e.e;if(!c||!s)return null;if(t=r&&!r[0],i=o&&!o[0],t||i)return t?i?0:-s:c;if(c!=s)return c;if(t=c<0,i=d==p,!r||!o)return i?0:!r^t?1:-1;if(!i)return d>p^t?1:-1;for(s=(d=r.length)<(p=o.length)?d:p,c=0;c<s;c++)if(r[c]!=o[c])return r[c]>o[c]^t?1:-1;return d==p?0:d>p^t?1:-1}function os(n,e,t,i){if(n<e||n>t||n!==El(n))throw Error(pa+(i||"Argument")+(typeof n=="number"?n<e||n>t?" out of range: ":" not an integer: ":" not a primitive number: ")+String(n))}function Pb(n){var e=n.c.length-1;return Al(n.e/hn)==e&&n.c[e]%2!=0}function Ib(n,e){return(n.length>1?n.charAt(0)+"."+n.slice(1):n)+(e<0?"e":"e+")+e}function Qu(n,e,t){var i,r;if(e<0){for(r=t+".";++e;r+=t);n=r+n}else if(i=n.length,++e>i){for(r=t,e-=i;--e;r+=t);n+=r}else e<i&&(n=n.slice(0,e)+"."+n.slice(e));return n}var cu=NF(),Zj=class{constructor(n){Ei(this,"key"),Ei(this,"left",null),Ei(this,"right",null),this.key=n}},wv=class extends Zj{constructor(n){super(n)}},Xj=class{constructor(){Ei(this,"size",0),Ei(this,"modificationCount",0),Ei(this,"splayCount",0)}splay(n){const e=this.root;if(e==null)return this.compare(n,n),-1;let t=null,i=null,r=null,o=null,c=e;const s=this.compare;let d;for(;;)if(d=s(c.key,n),d>0){let p=c.left;if(p==null||(d=s(p.key,n),d>0&&(c.left=p.right,p.right=c,c=p,p=c.left,p==null)))break;t==null?i=c:t.left=c,t=c,c=p}else if(d<0){let p=c.right;if(p==null||(d=s(p.key,n),d<0&&(c.right=p.left,p.left=c,c=p,p=c.right,p==null)))break;r==null?o=c:r.right=c,r=c,c=p}else break;return r!=null&&(r.right=c.left,c.left=o),t!=null&&(t.left=c.right,c.right=i),this.root!==c&&(this.root=c,this.splayCount++),d}splayMin(n){let e=n,t=e.left;for(;t!=null;){const i=t;e.left=i.right,i.right=e,e=i,t=e.left}return e}splayMax(n){let e=n,t=e.right;for(;t!=null;){const i=t;e.right=i.left,i.left=e,e=i,t=e.right}return e}_delete(n){if(this.root==null||this.splay(n)!=0)return null;let e=this.root;const t=e,i=e.left;if(this.size--,i==null)this.root=e.right;else{const r=e.right;e=this.splayMax(i),e.right=r,this.root=e}return this.modificationCount++,t}addNewRoot(n,e){this.size++,this.modificationCount++;const t=this.root;if(t==null){this.root=n;return}e<0?(n.left=t,n.right=t.right,t.right=null):(n.right=t,n.left=t.left,t.left=null),this.root=n}_first(){const n=this.root;return n==null?null:(this.root=this.splayMin(n),this.root)}_last(){const n=this.root;return n==null?null:(this.root=this.splayMax(n),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(n){return this.validKey(n)&&this.splay(n)==0}defaultCompare(){return(n,e)=>n<e?-1:n>e?1:0}wrap(){return{getRoot:()=>this.root,setRoot:n=>{this.root=n},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:n=>{this.splayCount=n},splay:n=>this.splay(n),has:n=>this.has(n)}}},II,RI,hw=class Gv extends Xj{constructor(e,t){super(),Ei(this,"root",null),Ei(this,"compare"),Ei(this,"validKey"),Ei(this,II,"[object Set]"),this.compare=e??this.defaultCompare(),this.validKey=t??(i=>i!=null&&i!=null)}delete(e){return this.validKey(e)?this._delete(e)!=null:!1}deleteAll(e){for(const t of e)this.delete(t)}forEach(e){const t=this[Symbol.iterator]();let i;for(;i=t.next(),!i.done;)e(i.value,i.value,this)}add(e){const t=this.splay(e);return t!=0&&this.addNewRoot(new wv(e),t),this}addAndReturn(e){const t=this.splay(e);return t!=0&&this.addNewRoot(new wv(e),t),this.root.key}addAll(e){for(const t of e)this.add(t)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)<0)return this.root.key;let t=this.root.left;if(t==null)return null;let i=t.right;for(;i!=null;)t=i,i=t.right;return t.key}firstAfter(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)>0)return this.root.key;let t=this.root.right;if(t==null)return null;let i=t.left;for(;i!=null;)t=i,i=t.left;return t.key}retainAll(e){const t=new Gv(this.compare,this.validKey),i=this.modificationCount;for(const r of e){if(i!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(r)&&this.splay(r)==0&&t.add(this.root.key)}t.size!=this.size&&(this.root=t.root,this.size=t.size,this.modificationCount++)}lookup(e){return!this.validKey(e)||this.splay(e)!=0?null:this.root.key}intersection(e){const t=new Gv(this.compare,this.validKey);for(const i of this)e.has(i)&&t.add(i);return t}difference(e){const t=new Gv(this.compare,this.validKey);for(const i of this)e.has(i)||t.add(i);return t}union(e){const t=this.clone();return t.addAll(e),t}clone(){const e=new Gv(this.compare,this.validKey);return e.size=this.size,e.root=this.copyNode(this.root),e}copyNode(e){if(e==null)return null;function t(r,o){let c,s;do{if(c=r.left,s=r.right,c!=null){const d=new wv(c.key);o.left=d,t(c,d)}if(s!=null){const d=new wv(s.key);o.right=d,r=s,o=d}}while(s!=null)}const i=new wv(e.key);return t(e,i),i}toSet(){return this.clone()}entries(){return new Kj(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[(RI=Symbol.iterator,II=Symbol.toStringTag,RI)](){return new Yj(this.wrap())}},$F=class{constructor(n){Ei(this,"tree"),Ei(this,"path",new Array),Ei(this,"modificationCount",null),Ei(this,"splayCount"),this.tree=n,this.splayCount=n.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const n=this.path[this.path.length-1];return this.getValue(n)}rebuildPath(n){this.path.splice(0,this.path.length),this.tree.splay(n),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(n){for(;n!=null;)this.path.push(n),n=n.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let t=this.tree.getRoot();for(;t!=null;)this.path.push(t),t=t.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let n=this.path[this.path.length-1],e=n.right;if(e!=null){for(;e!=null;)this.path.push(e),e=e.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===n;)n=this.path.pop();return this.path.length>0}},Yj=class extends $F{getValue(n){return n.key}},Kj=class extends $F{getValue(n){return[n.key,n.key]}},VF=n=>()=>n,jM=n=>{const e=n?(t,i)=>i.minus(t).abs().isLessThanOrEqualTo(n):VF(!1);return(t,i)=>e(t,i)?0:t.comparedTo(i)};function Jj(n){const e=n?(t,i,r,o,c)=>t.exponentiatedBy(2).isLessThanOrEqualTo(o.minus(i).exponentiatedBy(2).plus(c.minus(r).exponentiatedBy(2)).times(n)):VF(!1);return(t,i,r)=>{const o=t.x,c=t.y,s=r.x,d=r.y,p=c.minus(d).times(i.x.minus(s)).minus(o.minus(s).times(i.y.minus(d)));return e(p,o,c,s,d)?0:p.comparedTo(0)}}var Qj=n=>n,eG=n=>{if(n){const e=new hw(jM(n)),t=new hw(jM(n)),i=(o,c)=>c.addAndReturn(o),r=o=>({x:i(o.x,e),y:i(o.y,t)});return r({x:new cu(0),y:new cu(0)}),r}return Qj},GM=n=>({set:e=>{Ch=GM(e)},reset:()=>GM(n),compare:jM(n),snap:eG(n),orient:Jj(n)}),Ch=GM(),Sv=(n,e)=>n.ll.x.isLessThanOrEqualTo(e.x)&&e.x.isLessThanOrEqualTo(n.ur.x)&&n.ll.y.isLessThanOrEqualTo(e.y)&&e.y.isLessThanOrEqualTo(n.ur.y),qM=(n,e)=>{if(e.ur.x.isLessThan(n.ll.x)||n.ur.x.isLessThan(e.ll.x)||e.ur.y.isLessThan(n.ll.y)||n.ur.y.isLessThan(e.ll.y))return null;const t=n.ll.x.isLessThan(e.ll.x)?e.ll.x:n.ll.x,i=n.ur.x.isLessThan(e.ur.x)?n.ur.x:e.ur.x,r=n.ll.y.isLessThan(e.ll.y)?e.ll.y:n.ll.y,o=n.ur.y.isLessThan(e.ur.y)?n.ur.y:e.ur.y;return{ll:{x:t,y:r},ur:{x:i,y:o}}},Nx=(n,e)=>n.x.times(e.y).minus(n.y.times(e.x)),UF=(n,e)=>n.x.times(e.x).plus(n.y.times(e.y)),dw=n=>UF(n,n).sqrt(),tG=(n,e,t)=>{const i={x:e.x.minus(n.x),y:e.y.minus(n.y)},r={x:t.x.minus(n.x),y:t.y.minus(n.y)};return Nx(r,i).div(dw(r)).div(dw(i))},iG=(n,e,t)=>{const i={x:e.x.minus(n.x),y:e.y.minus(n.y)},r={x:t.x.minus(n.x),y:t.y.minus(n.y)};return UF(r,i).div(dw(r)).div(dw(i))},LI=(n,e,t)=>e.y.isZero()?null:{x:n.x.plus(e.x.div(e.y).times(t.minus(n.y))),y:t},kI=(n,e,t)=>e.x.isZero()?null:{x:t,y:n.y.plus(e.y.div(e.x).times(t.minus(n.x)))},nG=(n,e,t,i)=>{if(e.x.isZero())return kI(t,i,n.x);if(i.x.isZero())return kI(n,e,t.x);if(e.y.isZero())return LI(t,i,n.y);if(i.y.isZero())return LI(n,e,t.y);const r=Nx(e,i);if(r.isZero())return null;const o={x:t.x.minus(n.x),y:t.y.minus(n.y)},c=Nx(o,e).div(r),s=Nx(o,i).div(r),d=n.x.plus(s.times(e.x)),p=t.x.plus(c.times(i.x)),g=n.y.plus(s.times(e.y)),_=t.y.plus(c.times(i.y)),x=d.plus(p).div(2),b=g.plus(_).div(2);return{x,y:b}},tu=class jF{constructor(e,t){Ei(this,"point"),Ei(this,"isLeft"),Ei(this,"segment"),Ei(this,"otherSE"),Ei(this,"consumedBy"),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}static compare(e,t){const i=jF.comparePoints(e.point,t.point);return i!==0?i:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:pw.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x.isLessThan(t.x)?-1:e.x.isGreaterThan(t.x)?1:e.y.isLessThan(t.y)?-1:e.y.isGreaterThan(t.y)?1:0}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let i=0,r=t.length;i<r;i++){const o=t[i];this.point.events.push(o),o.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const i=this.point.events[t];if(i.segment.consumedBy===void 0)for(let r=t+1;r<e;r++){const o=this.point.events[r];o.consumedBy===void 0&&i.otherSE.point.events===o.otherSE.point.events&&i.segment.consume(o.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,i=this.point.events.length;t<i;t++){const r=this.point.events[t];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&e.push(r)}return e}getLeftmostComparator(e){const t=new Map,i=r=>{const o=r.otherSE;t.set(r,{sine:tG(this.point,e.point,o.point),cosine:iG(this.point,e.point,o.point)})};return(r,o)=>{t.has(r)||i(r),t.has(o)||i(o);const{sine:c,cosine:s}=t.get(r),{sine:d,cosine:p}=t.get(o);return c.isGreaterThanOrEqualTo(0)&&d.isGreaterThanOrEqualTo(0)?s.isLessThan(p)?1:s.isGreaterThan(p)?-1:0:c.isLessThan(0)&&d.isLessThan(0)?s.isLessThan(p)?-1:s.isGreaterThan(p)?1:0:d.isLessThan(c)?-1:d.isGreaterThan(c)?1:0}}},rG=class WM{constructor(e){Ei(this,"events"),Ei(this,"poly"),Ei(this,"_isExteriorRing"),Ei(this,"_enclosingRing"),this.events=e;for(let t=0,i=e.length;t<i;t++)e[t].segment.ringOut=this;this.poly=null}static factory(e){const t=[];for(let i=0,r=e.length;i<r;i++){const o=e[i];if(!o.isInResult()||o.ringOut)continue;let c=null,s=o.leftSE,d=o.rightSE;const p=[s],g=s.point,_=[];for(;c=s,s=d,p.push(s),s.point!==g;)for(;;){const x=s.getAvailableLinkedEvents();if(x.length===0){const P=p[0].point,L=p[p.length-1].point;throw new Error(`Unable to complete output ring starting at [${P.x}, ${P.y}]. Last matching segment found ends at [${L.x}, ${L.y}].`)}if(x.length===1){d=x[0].otherSE;break}let b=null;for(let P=0,L=_.length;P<L;P++)if(_[P].point===s.point){b=P;break}if(b!==null){const P=_.splice(b)[0],L=p.splice(P.index);L.unshift(L[0].otherSE),t.push(new WM(L.reverse()));continue}_.push({index:p.length,point:s.point});const S=s.getLeftmostComparator(c);d=x.sort(S)[0].otherSE;break}t.push(new WM(p))}return t}getGeom(){let e=this.events[0].point;const t=[e];for(let p=1,g=this.events.length-1;p<g;p++){const _=this.events[p].point,x=this.events[p+1].point;Ch.orient(_,e,x)!==0&&(t.push(_),e=_)}if(t.length===1)return null;const i=t[0],r=t[1];Ch.orient(i,e,r)===0&&t.shift(),t.push(t[0]);const o=this.isExteriorRing()?1:-1,c=this.isExteriorRing()?0:t.length-1,s=this.isExteriorRing()?t.length:-1,d=[];for(let p=c;p!=s;p+=o)d.push([t[p].x.toNumber(),t[p].y.toNumber()]);return d}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){var e,t;let i=this.events[0];for(let c=1,s=this.events.length;c<s;c++){const d=this.events[c];tu.compare(i,d)>0&&(i=d)}let r=i.segment.prevInResult(),o=r?r.prevInResult():null;for(;;){if(!r)return null;if(!o)return r.ringOut;if(o.ringOut!==r.ringOut)return((e=o.ringOut)==null?void 0:e.enclosingRing())!==r.ringOut?r.ringOut:(t=r.ringOut)==null?void 0:t.enclosingRing();r=o.prevInResult(),o=r?r.prevInResult():null}}},DI=class{constructor(n){Ei(this,"exteriorRing"),Ei(this,"interiorRings"),this.exteriorRing=n,n.poly=this,this.interiorRings=[]}addInterior(n){this.interiorRings.push(n),n.poly=this}getGeom(){const n=this.exteriorRing.getGeom();if(n===null)return null;const e=[n];for(let t=0,i=this.interiorRings.length;t<i;t++){const r=this.interiorRings[t].getGeom();r!==null&&e.push(r)}return e}},sG=class{constructor(n){Ei(this,"rings"),Ei(this,"polys"),this.rings=n,this.polys=this._composePolys(n)}getGeom(){const n=[];for(let e=0,t=this.polys.length;e<t;e++){const i=this.polys[e].getGeom();i!==null&&n.push(i)}return n}_composePolys(n){var e;const t=[];for(let i=0,r=n.length;i<r;i++){const o=n[i];if(!o.poly)if(o.isExteriorRing())t.push(new DI(o));else{const c=o.enclosingRing();c!=null&&c.poly||t.push(new DI(c)),(e=c?.poly)==null||e.addInterior(o)}}return t}},oG=class{constructor(n,e=pw.compare){Ei(this,"queue"),Ei(this,"tree"),Ei(this,"segments"),this.queue=n,this.tree=new hw(e),this.segments=[]}process(n){const e=n.segment,t=[];if(n.consumedBy)return n.isLeft?this.queue.delete(n.otherSE):this.tree.delete(e),t;n.isLeft&&this.tree.add(e);let i=e,r=e;do i=this.tree.lastBefore(i);while(i!=null&&i.consumedBy!=null);do r=this.tree.firstAfter(r);while(r!=null&&r.consumedBy!=null);if(n.isLeft){let o=null;if(i){const s=i.getIntersection(e);if(s!==null&&(e.isAnEndpoint(s)||(o=s),!i.isAnEndpoint(s))){const d=this._splitSafely(i,s);for(let p=0,g=d.length;p<g;p++)t.push(d[p])}}let c=null;if(r){const s=r.getIntersection(e);if(s!==null&&(e.isAnEndpoint(s)||(c=s),!r.isAnEndpoint(s))){const d=this._splitSafely(r,s);for(let p=0,g=d.length;p<g;p++)t.push(d[p])}}if(o!==null||c!==null){let s=null;o===null?s=c:c===null?s=o:s=tu.comparePoints(o,c)<=0?o:c,this.queue.delete(e.rightSE),t.push(e.rightSE);const d=e.split(s);for(let p=0,g=d.length;p<g;p++)t.push(d[p])}t.length>0?(this.tree.delete(e),t.push(n)):(this.segments.push(e),e.prev=i)}else{if(i&&r){const o=i.getIntersection(r);if(o!==null){if(!i.isAnEndpoint(o)){const c=this._splitSafely(i,o);for(let s=0,d=c.length;s<d;s++)t.push(c[s])}if(!r.isAnEndpoint(o)){const c=this._splitSafely(r,o);for(let s=0,d=c.length;s<d;s++)t.push(c[s])}}}this.tree.delete(e)}return t}_splitSafely(n,e){this.tree.delete(n);const t=n.rightSE;this.queue.delete(t);const i=n.split(e);return i.push(t),n.consumedBy===void 0&&this.tree.add(n),i}},aG=class{constructor(){Ei(this,"type"),Ei(this,"numMultiPolys")}run(n,e,t){qv.type=n;const i=[new OI(e,!0)];for(let d=0,p=t.length;d<p;d++)i.push(new OI(t[d],!1));if(qv.numMultiPolys=i.length,qv.type==="difference"){const d=i[0];let p=1;for(;p<i.length;)qM(i[p].bbox,d.bbox)!==null?p++:i.splice(p,1)}if(qv.type==="intersection")for(let d=0,p=i.length;d<p;d++){const g=i[d];for(let _=d+1,x=i.length;_<x;_++)if(qM(g.bbox,i[_].bbox)===null)return[]}const r=new hw(tu.compare);for(let d=0,p=i.length;d<p;d++){const g=i[d].getSweepEvents();for(let _=0,x=g.length;_<x;_++)r.add(g[_])}const o=new oG(r);let c=null;for(r.size!=0&&(c=r.first(),r.delete(c));c;){const d=o.process(c);for(let p=0,g=d.length;p<g;p++){const _=d[p];_.consumedBy===void 0&&r.add(_)}r.size!=0?(c=r.first(),r.delete(c)):c=null}Ch.reset();const s=rG.factory(o.segments);return new sG(s).getGeom()}},qv=new aG,fw=qv,lG=0,pw=class $x{constructor(e,t,i,r){Ei(this,"id"),Ei(this,"leftSE"),Ei(this,"rightSE"),Ei(this,"rings"),Ei(this,"windings"),Ei(this,"ringOut"),Ei(this,"consumedBy"),Ei(this,"prev"),Ei(this,"_prevInResult"),Ei(this,"_beforeState"),Ei(this,"_afterState"),Ei(this,"_isInResult"),this.id=++lG,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=i,this.windings=r}static compare(e,t){const i=e.leftSE.point.x,r=t.leftSE.point.x,o=e.rightSE.point.x,c=t.rightSE.point.x;if(c.isLessThan(i))return 1;if(o.isLessThan(r))return-1;const s=e.leftSE.point.y,d=t.leftSE.point.y,p=e.rightSE.point.y,g=t.rightSE.point.y;if(i.isLessThan(r)){if(d.isLessThan(s)&&d.isLessThan(p))return 1;if(d.isGreaterThan(s)&&d.isGreaterThan(p))return-1;const _=e.comparePoint(t.leftSE.point);if(_<0)return 1;if(_>0)return-1;const x=t.comparePoint(e.rightSE.point);return x!==0?x:-1}if(i.isGreaterThan(r)){if(s.isLessThan(d)&&s.isLessThan(g))return-1;if(s.isGreaterThan(d)&&s.isGreaterThan(g))return 1;const _=t.comparePoint(e.leftSE.point);if(_!==0)return _;const x=e.comparePoint(t.rightSE.point);return x<0?1:x>0?-1:1}if(s.isLessThan(d))return-1;if(s.isGreaterThan(d))return 1;if(o.isLessThan(c)){const _=t.comparePoint(e.rightSE.point);if(_!==0)return _}if(o.isGreaterThan(c)){const _=e.comparePoint(t.rightSE.point);if(_<0)return 1;if(_>0)return-1}if(!o.eq(c)){const _=p.minus(s),x=o.minus(i),b=g.minus(d),S=c.minus(r);if(_.isGreaterThan(x)&&b.isLessThan(S))return 1;if(_.isLessThan(x)&&b.isGreaterThan(S))return-1}return o.isGreaterThan(c)?1:o.isLessThan(c)||p.isLessThan(g)?-1:p.isGreaterThan(g)?1:e.id<t.id?-1:e.id>t.id?1:0}static fromRing(e,t,i){let r,o,c;const s=tu.comparePoints(e,t);if(s<0)r=e,o=t,c=1;else if(s>0)r=t,o=e,c=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const d=new tu(r,!0),p=new tu(o,!1);return new $x(d,p,[i],[c])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e.isLessThan(t)?e:t},ur:{x:this.rightSE.point.x,y:e.isGreaterThan(t)?e:t}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(e){return e.x.eq(this.leftSE.point.x)&&e.y.eq(this.leftSE.point.y)||e.x.eq(this.rightSE.point.x)&&e.y.eq(this.rightSE.point.y)}comparePoint(e){return Ch.orient(this.leftSE.point,e,this.rightSE.point)}getIntersection(e){const t=this.bbox(),i=e.bbox(),r=qM(t,i);if(r===null)return null;const o=this.leftSE.point,c=this.rightSE.point,s=e.leftSE.point,d=e.rightSE.point,p=Sv(t,s)&&this.comparePoint(s)===0,g=Sv(i,o)&&e.comparePoint(o)===0,_=Sv(t,d)&&this.comparePoint(d)===0,x=Sv(i,c)&&e.comparePoint(c)===0;if(g&&p)return x&&!_?c:!x&&_?d:null;if(g)return _&&o.x.eq(d.x)&&o.y.eq(d.y)?null:o;if(p)return x&&c.x.eq(s.x)&&c.y.eq(s.y)?null:s;if(x&&_)return null;if(x)return c;if(_)return d;const b=nG(o,this.vector(),s,e.vector());return b===null||!Sv(r,b)?null:Ch.snap(b)}split(e){const t=[],i=e.events!==void 0,r=new tu(e,!0),o=new tu(e,!1),c=this.rightSE;this.replaceRightSE(o),t.push(o),t.push(r);const s=new $x(r,c,this.rings.slice(),this.windings.slice());return tu.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),tu.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(r.checkForConsuming(),o.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,i=this.windings.length;t<i;t++)this.windings[t]*=-1}consume(e){let t=this,i=e;for(;t.consumedBy;)t=t.consumedBy;for(;i.consumedBy;)i=i.consumedBy;const r=$x.compare(t,i);if(r!==0){if(r>0){const o=t;t=i,i=o}if(t.prev===i){const o=t;t=i,i=o}for(let o=0,c=i.rings.length;o<c;o++){const s=i.rings[o],d=i.windings[o],p=t.rings.indexOf(s);p===-1?(t.rings.push(s),t.windings.push(d)):t.windings[p]+=d}i.rings=null,i.windings=null,i.consumedBy=t,i.leftSE.consumedBy=t.leftSE,i.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,i=this._afterState.windings,r=this._afterState.multiPolys;for(let s=0,d=this.rings.length;s<d;s++){const p=this.rings[s],g=this.windings[s],_=t.indexOf(p);_===-1?(t.push(p),i.push(g)):i[_]+=g}const o=[],c=[];for(let s=0,d=t.length;s<d;s++){if(i[s]===0)continue;const p=t[s],g=p.poly;if(c.indexOf(g)===-1)if(p.isExterior)o.push(g);else{c.indexOf(g)===-1&&c.push(g);const _=o.indexOf(p.poly);_!==-1&&o.splice(_,1)}}for(let s=0,d=o.length;s<d;s++){const p=o[s].multiPoly;r.indexOf(p)===-1&&r.push(p)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(fw.type){case"union":{const i=e.length===0,r=t.length===0;this._isInResult=i!==r;break}case"intersection":{let i,r;e.length<t.length?(i=e.length,r=t.length):(i=t.length,r=e.length),this._isInResult=r===fw.numMultiPolys&&i<r;break}case"xor":{const i=Math.abs(e.length-t.length);this._isInResult=i%2===1;break}case"difference":{const i=r=>r.length===1&&r[0].isSubject;this._isInResult=i(e)!==i(t);break}}return this._isInResult}},FI=class{constructor(n,e,t){if(Ei(this,"poly"),Ei(this,"isExterior"),Ei(this,"segments"),Ei(this,"bbox"),!Array.isArray(n)||n.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=t,this.segments=[],typeof n[0][0]!="number"||typeof n[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const i=Ch.snap({x:new cu(n[0][0]),y:new cu(n[0][1])});this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};let r=i;for(let o=1,c=n.length;o<c;o++){if(typeof n[o][0]!="number"||typeof n[o][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const s=Ch.snap({x:new cu(n[o][0]),y:new cu(n[o][1])});s.x.eq(r.x)&&s.y.eq(r.y)||(this.segments.push(pw.fromRing(r,s,this)),s.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=s.x),s.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=s.y),s.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=s.x),s.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=s.y),r=s)}(!i.x.eq(r.x)||!i.y.eq(r.y))&&this.segments.push(pw.fromRing(r,i,this))}getSweepEvents(){const n=[];for(let e=0,t=this.segments.length;e<t;e++){const i=this.segments[e];n.push(i.leftSE),n.push(i.rightSE)}return n}},cG=class{constructor(n,e){if(Ei(this,"multiPoly"),Ei(this,"exteriorRing"),Ei(this,"interiorRings"),Ei(this,"bbox"),!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new FI(n[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let t=1,i=n.length;t<i;t++){const r=new FI(n[t],this,!1);r.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=r.bbox.ll.x),r.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=r.bbox.ll.y),r.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=r.bbox.ur.x),r.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=r.bbox.ur.y),this.interiorRings.push(r)}this.multiPoly=e}getSweepEvents(){const n=this.exteriorRing.getSweepEvents();for(let e=0,t=this.interiorRings.length;e<t;e++){const i=this.interiorRings[e].getSweepEvents();for(let r=0,o=i.length;r<o;r++)n.push(i[r])}return n}},OI=class{constructor(n,e){if(Ei(this,"isSubject"),Ei(this,"polys"),Ei(this,"bbox"),!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof n[0][0][0]=="number"&&(n=[n])}catch{}this.polys=[],this.bbox={ll:{x:new cu(Number.POSITIVE_INFINITY),y:new cu(Number.POSITIVE_INFINITY)},ur:{x:new cu(Number.NEGATIVE_INFINITY),y:new cu(Number.NEGATIVE_INFINITY)}};for(let t=0,i=n.length;t<i;t++){const r=new cG(n[t],this);r.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=r.bbox.ll.x),r.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=r.bbox.ll.y),r.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=r.bbox.ur.x),r.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=r.bbox.ur.y),this.polys.push(r)}this.isSubject=e}getSweepEvents(){const n=[];for(let e=0,t=this.polys.length;e<t;e++){const i=this.polys[e].getSweepEvents();for(let r=0,o=i.length;r<o;r++)n.push(i[r])}return n}},uG=(n,...e)=>fw.run("union",n,e),hG=(n,...e)=>fw.run("difference",n,e);Ch.set;function GF(n,e,t){if(n!==null)for(var i,r,o,c,s,d,p,g=0,_=0,x,b=n.type,S=b==="FeatureCollection",P=b==="Feature",L=S?n.features.length:1,E=0;E<L;E++){p=S?n.features[E].geometry:P?n.geometry:n,x=p?p.type==="GeometryCollection":!1,s=x?p.geometries.length:1;for(var C=0;C<s;C++){var D=0,O=0;if(c=x?p.geometries[C]:p,c!==null){d=c.coordinates;var U=c.type;switch(g=0,U){case null:break;case"Point":if(e(d,_,E,D,O)===!1)return!1;_++,D++;break;case"LineString":case"MultiPoint":for(i=0;i<d.length;i++){if(e(d[i],_,E,D,O)===!1)return!1;_++,U==="MultiPoint"&&D++}U==="LineString"&&D++;break;case"Polygon":case"MultiLineString":for(i=0;i<d.length;i++){for(r=0;r<d[i].length-g;r++){if(e(d[i][r],_,E,D,O)===!1)return!1;_++}U==="MultiLineString"&&D++,U==="Polygon"&&O++}U==="Polygon"&&D++;break;case"MultiPolygon":for(i=0;i<d.length;i++){for(O=0,r=0;r<d[i].length;r++){for(o=0;o<d[i][r].length-g;o++){if(e(d[i][r][o],_,E,D,O)===!1)return!1;_++}O++}D++}break;case"GeometryCollection":for(i=0;i<c.geometries.length;i++)if(GF(c.geometries[i],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function hC(n,e){var t,i,r,o,c,s,d,p,g,_,x=0,b=n.type==="FeatureCollection",S=n.type==="Feature",P=b?n.features.length:1;for(t=0;t<P;t++){for(s=b?n.features[t].geometry:S?n.geometry:n,p=b?n.features[t].properties:S?n.properties:{},g=b?n.features[t].bbox:S?n.bbox:void 0,_=b?n.features[t].id:S?n.id:void 0,d=s?s.type==="GeometryCollection":!1,c=d?s.geometries.length:1,r=0;r<c;r++){if(o=d?s.geometries[r]:s,o===null){if(e(null,x,p,g,_)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,x,p,g,_)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<o.geometries.length;i++)if(e(o.geometries[i],x,p,g,_)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}x++}}function dG(n,e){hC(n,function(t,i,r,o,c){var s=t===null?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(Py(t,r,{bbox:o,id:c}),i,0)===!1?!1:void 0}var d;switch(s){case"MultiPoint":d="Point";break;case"MultiLineString":d="LineString";break;case"MultiPolygon":d="Polygon";break}for(var p=0;p<t.coordinates.length;p++){var g=t.coordinates[p],_={type:d,coordinates:g};if(e(Py(_,r),i,p)===!1)return!1}})}function fG(n,e={}){const t=[];if(hC(n,r=>{t.push(r.coordinates)}),t.length<2)throw new Error("Must have at least 2 geometries");const i=uG(t[0],...t.slice(1));return i.length===0?null:i.length===1?uC(i[0],e.properties):BF(i,e.properties)}var qF=fG;function pG(n,e={}){if(n.bbox!=null&&e.recompute!==!0)return n.bbox;const t=[1/0,1/0,-1/0,-1/0];return GF(n,i=>{t[0]>i[0]&&(t[0]=i[0]),t[1]>i[1]&&(t[1]=i[1]),t[2]<i[0]&&(t[2]=i[0]),t[3]<i[1]&&(t[3]=i[1])}),t}var zI=pG;function mG(n){const e=[];if(hC(n,r=>{e.push(r.coordinates)}),e.length<2)throw new Error("Must have at least two features");const t=n.features[0].properties||{},i=hG(e[0],...e.slice(1));return i.length===0?null:i.length===1?uC(i[0],t):BF(i,t)}var gG=mG;function _G(n){if(!n)throw new Error("geojson is required");var e=[];return dG(n,function(t){e.push(t)}),Iy(e)}var vG=_G;function BI(n,e){const t=gG(Iy([uC([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),n]));if(!t)return;t.properties={isMask:!0};const i=uw(zI(n)),r=(i[2]-i[0])/360/1e3,o=i[0]<-180,c=i[2]>180,s=vG(n);if(s.features.length>1&&(o||c))for(const d of s.features){const p=uw(zI(d));if(c&&p[0]<-180+r)for(const g of d.geometry.coordinates)for(const _ of g)_[0]+=360-r;if(o&&p[2]>180-r)for(const g of d.geometry.coordinates)for(const _ of g)_[0]-=360-r}e(Iy([s.features.length<2?n:qF(s)??n,t]))}const NI={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},Rb="mtlr-gc-full-geom",$I="mtlr-gc-full-geom-fill",VI="mtlr-gc-full-geom-line";function yG(n,e,t=!0,i=!0,r={},o={},c=NI){let s;const d=[];let p,g,_;function x(){if(!n.loaded){n.once("load",x);return}const L=c?c===!0?NI:c:void 0;if(!(L!=null&&L.fill)&&!(L!=null&&L.line))return;const E=n.getSource(Rb);if(E)E.setData(_??Iy([]));else if(_)n.addSource(Rb,{type:"geojson",data:_});else return;!n.getLayer($I)&&L!=null&&L.fill&&n.addLayer({...L?.fill,id:$I,type:"fill",source:Rb}),!n.getLayer(VI)&&L!=null&&L.line&&n.addLayer({...L?.line,id:VI,type:"line",source:Rb})}function b(L){_=L,x()}n.on("styledata",()=>{setTimeout(()=>{_&&x()})});const S=L=>{s?.({type:"mapClick",coordinates:[L.lngLat.lng,L.lngLat.lat]})};function P(L=!1){if(!e)throw new Error;const E=document.createElement("div");return L&&E.classList.add("marker-interactive"),new wj({props:{displayIn:"maplibre"},target:E}),new e.Marker({element:E,offset:[1,-13]})}return{setEventHandler(L){L?(s=L,n.on("click",S)):(s=void 0,n.off("click",S))},flyTo(L,E){n.flyTo({center:L,...E?{zoom:E}:{},...r})},fitBounds(L,E,C){n.fitBounds([[L[0],L[1]],[L[2],L[3]]],{padding:E,...C?{maxZoom:C}:{},...o})},indicateReverse(L){n.getCanvasContainer().style.cursor=L?"crosshair":""},setReverseMarker(L){!e||!t||(g?L?g.setLngLat(L):(g.remove(),g=void 0):L&&(t instanceof Function?g=t(n)??void 0:(g=(typeof t=="object"?new e.Marker(t):P()).setLngLat(L).addTo(n),g.getElement().classList.add("marker-reverse"))))},setFeatures(L,E,C){for(const D of d)D.remove();if(d.length=0,b(void 0),!!e){e:if(E){let D=!1;if(E.geometry.type==="GeometryCollection"){const O=E.geometry.geometries.filter(U=>U.type==="Polygon"||U.type==="MultiPolygon");t:if(O.length>0){const U=qF(Iy(O.map(q=>Py(q))));if(!U)break t;BI({...E,geometry:U.geometry},b),D=!0}else{const U=E.geometry.geometries.filter(q=>q.type==="LineString"||q.type==="MultiLineString");U.length>0&&(b({...E,geometry:{type:"GeometryCollection",geometries:U}}),D=!0)}}if(!D){if(E.geometry.type==="Polygon"||E.geometry.type==="MultiPolygon")BI(E,b);else if(E.geometry.type==="LineString"||E.geometry.type==="MultiLineString"){b(E);break e}}if(!C&&!E.geometry.type.endsWith("Point"))break e;if(t instanceof Function){const O=t(n,E);O&&d.push(O)}else t&&d.push(typeof t=="object"?new e.Marker(t):P().setLngLat(E.center).addTo(n))}if(i)for(const D of L??[]){if(D===E)continue;let O;if(i instanceof Function){if(O=i(n,D),!O)continue}else O=(typeof i=="object"?new e.Marker(i):P(!0)).setLngLat(D.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(D.place_type[0]==="reverse"?D.place_name:D.place_name.replace(/,.*/,""))).addTo(n);const U=O.getElement();U.addEventListener("click",q=>{q.stopPropagation(),s?.({type:"markerClick",id:D.id})}),U.addEventListener("mouseenter",()=>{s?.({type:"markerMouseEnter",id:D.id}),O.togglePopup()}),U.addEventListener("mouseleave",()=>{s?.({type:"markerMouseLeave",id:D.id}),O.togglePopup()}),d.push(O)}}},setSelectedMarker(L){p&&p.getElement().classList.toggle("marker-selected",!1),p=L>-1?d[L]:void 0,p?.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const L=n.getCenter();return[n.getZoom(),L.lng,L.lat]}}}function bG(n,e,t){var i,r,o;class c{constructor(E,C){Ei(this,"type"),Ei(this,"target"),this.type=C,this.target=E}}class s extends c{constructor(E,C){super(E,"select"),Ei(this,"feature"),Object.assign(this,C)}}class d extends c{constructor(E,C){super(E,"featureslisted"),Ei(this,"features"),this.features=C}}class p extends c{constructor(E,C){super(E,"featuresmarked"),Ei(this,"features"),this.features=C}}class g extends c{constructor(E,C){super(E,"optionsvisibilitychange"),Ei(this,"optionsVisible"),this.optionsVisible=C}}class _ extends c{constructor(E,C){super(E,"pick"),Ei(this,"feature"),this.feature=C}}class x extends c{constructor(E,C){super(E,"querychange"),Ei(this,"query"),this.query=C}}class b extends c{constructor(E,C,D){super(E,"response"),Ei(this,"url"),Ei(this,"featureCollection"),this.url=C,this.featureCollection=D}}class S extends c{constructor(E,C){super(E,"reversetoggle"),Ei(this,"reverse"),this.reverse=C}}class P extends n{constructor(E={}){super(),ZS(this,i),ZS(this,r),ZS(this,o),Cb(this,r,E)}onAddInt(E){const C=document.createElement("div");C.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";const{marker:D,showResultMarkers:O,flyTo:U,fullGeometryStyle:q,...G}=vs(this,r),N=typeof U=="boolean"?{}:U,V={mapController:yG(E,e,D,O,N,N,q),flyTo:U===void 0?!0:!!U,apiKey:"",...G};return V.apiKey||console.warn("No MapTiler Cloud API key was provided, some or all geocoding requests may fail"),Cb(this,i,new Wj({target:C,props:V})),vs(this,i).$on("select",j=>{this.fire(new s(this,j.detail))}),vs(this,i).$on("pick",j=>{this.fire(new _(this,j.detail.feature))}),vs(this,i).$on("featureslisted",j=>{this.fire(new d(this,j.detail.features))}),vs(this,i).$on("featuresmarked",j=>{this.fire(new p(this,j.detail.features))}),vs(this,i).$on("response",j=>{this.fire(new b(this,j.detail.url,j.detail.featureCollection))}),vs(this,i).$on("optionsvisibilitychange",j=>{this.fire(new g(this,j.detail.optionsVisible))}),vs(this,i).$on("reversetoggle",j=>{this.fire(new S(this,j.detail.reverse))}),vs(this,i).$on("querychange",j=>{this.fire(new x(this,j.detail.query))}),Cb(this,o,C),C}on(E,C){return super.on(E,C)}once(E,C){return super.once(E,C)}off(E,C){return super.off(E,C)}listens(E){return super.listens(E)}setOptions(E){var C;Object.assign(vs(this,r),E);const{marker:D,showResultMarkers:O,flyTo:U,fullGeometryStyle:q,...G}=vs(this,r);(C=vs(this,i))==null||C.$set(G)}setQuery(E,C=!0){var D;(D=vs(this,i))==null||D.setQuery(E,C)}clearMap(){var E;(E=vs(this,i))==null||E.clearMap()}clearList(){var E;(E=vs(this,i))==null||E.clearList()}setReverseMode(E){var C;(C=vs(this,i))==null||C.$set({reverseActive:E})}focus(E){var C;(C=vs(this,i))==null||C.focus(E)}blur(){var E;(E=vs(this,i))==null||E.blur()}onRemove(){var E,C,D;(E=vs(this,i))==null||E.$destroy(),Cb(this,i,void 0),(D=(C=vs(this,o))==null?void 0:C.parentNode)==null||D.removeChild(vs(this,o))}}return i=new WeakMap,r=new WeakMap,o=new WeakMap,{MapLibreBasedGeocodingControl:P,events:{SelectEvent:s,FeaturesListedEvent:d,FeaturesMarkedEvent:p,OptionsVisibilityChangeEvent:g,PickEvent:_,QueryChangeEvent:x,ResponseEvent:b,ReverseToggleEvent:S}}}const{MapLibreBasedGeocodingControl:xG}=bG(rC.Evented,w8);class wG extends xG{onAdd(e){return super.onAddInt(e)}}function SG(n,e){Qi(e,!0);let t=ii(void 0),i=["continental_marine","country","major_landform","region","subregion","county","joint_municipality","joint_submunicipality","municipality","municipal_district","locality","neighbourhood","place","postal_code","address","road","poi"];wa(()=>{te(t)&&(e.map?.removeControl(te(t)),Ct(t,void 0))}),cn(()=>{e.map&&e.loaded&&!te(t)&&(Ct(t,new wG({apiKey:bd,maplibregl:Io,proximity:[{type:"map-center"}],types:i,country:e.country,marker:!0,showResultMarkers:!0,flyToOptions:{duration:1e3},fitBoundsOptions:{duration:1e3}}),!0),e.map.addControl(te(t),"top-left"))}),en()}ds(["click"]);var TG=qt("<!> <!>",1);function MG(n,e){Qi(e,!0),cn(()=>{e.map&&(e.map.keyboard.disableRotation(),e.map.dragRotate.disable(),e.map.touchZoomRotate.disableRotation())});var t=TG(),i=ci(t);hF(i,{showCompass:!1});var r=_t(i,2);dF(r,{}),bt(n,t),en()}const HM=["==",["geometry-type"],"LineString"],WF=["==",["geometry-type"],"Point"];function Ry(n,e,t){let i=["match",n];for(let[r,o]of Object.entries(e))i.push(r),i.push(o);return i.push(t),i}function no(){return{type:"FeatureCollection",features:[]}}function HF(n){return FU(n)}let bd="MZEJTanw3WpxRvt7qDfo",UI=`https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=${bd}`,rp=new i8([["Blank",{version:8,sources:{},layers:[],glyphs:UI}],["Maptiler Streets",`https://api.maptiler.com/maps/streets-v2/style.json?key=${bd}`],["Maptiler Dataviz",`https://api.maptiler.com/maps/dataviz/style.json?key=${bd}`],["Maptiler Dark",`https://api.maptiler.com/maps/dataviz-dark/style.json?key=${bd}`],["Maptiler Hybrid",`https://api.maptiler.com/maps/hybrid/style.json?key=${bd}`],["Maptiler OpenStreetMap",`https://api.maptiler.com/maps/openstreetmap/style.json?key=${bd}`],["Maptiler OS Open Zoomstack",`https://api.maptiler.com/maps/uk-openzoomstack-light/style.json?key=${bd}`],["ESRI World Imagery",{version:8,sources:{"raster-tiles":{type:"raster",tiles:["https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"],tileSize:256,attribution:"ESRI &copy; <a href='https://www.esri.com' target='_blank'>ESRI</a>",minzoom:0,maxzoom:18}},layers:[{id:"raster-basemap",type:"raster",source:"raster-tiles"}],glyphs:UI}]]);var CG=qt('<div class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox"/> <!></label></div>');function ls(n,e){Qi(e,!0);let t=ft(e,"checked",15);var i=CG(),r=zt(i),o=zt(r),c=_t(o,2);hs(c,()=>e.children??ts),k6(o,t),bt(n,i),en()}var EG=qt("<div><progress></progress></div>"),AG=qt('<div class="cover svelte-ca01h2"> <!></div>');function Yd(n,e){let t=ft(e,"progress",3,null);var i=tr(),r=ci(i);{var o=c=>{var s=AG(),d=zt(s),p=_t(d);{var g=_=>{var x=EG(),b=zt(x);_h(b,"",{},{width:"100%"}),Zi(()=>R6(b,t())),bt(_,x)};Ji(p,_=>{t()!=null&&_(g)})}Zi(()=>sn(d,`${e.loading??""} `)),bt(c,s)};Ji(r,c=>{e.loading&&c(o)})}bt(n,i)}var PG=qt('<dialog closedby="none" class="svelte-1f8bzsb"><div class="svelte-1f8bzsb"><!></div></dialog>');function gp(n,e){Qi(e,!0);let t=ft(e,"show",15,!1),i=ft(e,"closeable",3,!0),r=ii(void 0);cn(()=>{te(r)&&(t()?te(r).showModal():te(r).close())});function o(g){g.target==te(r)&&(g.stopPropagation(),i()&&t(!1))}function c(g){(g.key=="Escape"||g.key=="Enter")&&(g.stopPropagation(),i()&&t(!1))}var s=PG();s.__click=o,s.__keydown=c;var d=zt(s),p=zt(d);hs(p,()=>e.children),wc(s,g=>Ct(r,g),()=>te(r)),bt(n,s),en()}ds(["click","keydown"]);var IG=qt('<div style="display: flex; align-items: center; gap: 6px;"><span></span> </div>'),RG=qt("<div></div>");function dC(n,e){let t=ft(e,"swatchClass",3,"rectangle"),i=ft(e,"itemsPerRow",3,2),r=Kt(()=>`${100/i()}%`);var o=RG();ws(o,21,()=>Object.entries(e.labelColors),xs,(c,s)=>{var d=Kt(()=>tl(te(s),2));let p=()=>te(d)[0],g=()=>te(d)[1];var _=IG(),x=zt(_);let b;var S=_t(x);Zi(()=>{fp(x,1,`color-swatch ${t()??""}`,"svelte-kgsne0"),b=_h(x,"",b,{background:g()}),sn(S,` ${p()??""}`)}),bt(c,_)}),Zi(()=>_h(o,`display: grid; grid-template-columns: repeat(auto-fill, calc(${te(r)??""} - 10px)); gap: 10px;`)),bt(n,o)}function e1(n,e){let t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",n),document.body.appendChild(t),t.click(),document.body.removeChild(t)}var LG=qt('<button class="btn btn-primary" type="button">Import current view</button> <p class="fst-italic my-3">or...</p> <button class="btn btn-primary" type="button">Draw an area to import on the map</button> <!>',1),kG=qt('<div><label class="form-label">Load an osm.pbf or osm.xml file <input class="form-control" type="file"/></label></div> <p class="fst-italic my-3">or...</p> <!> <hr class="my-3"/> <!> <!>',1);function DG(n,e){Qi(e,!0);let t=ii(null),i=ii(!1),r=ii(void 0);async function o(O){try{e.onloading?.("Loading from file");let U=await te(r).files[0].arrayBuffer();e.onload(new Uint8Array(U),null)}catch(U){e.onerror?.(`Bad input file: ${U}`)}}async function c(O){try{e.onloading?.("Loading from Overpass");let U=await t1(fC(O));if(!U.ok)throw new Error(`Overpass response is not OK: ${U.status}. The API is often overloaded; try again in a few seconds.`);let q=await U.bytes();if(te(i)){let G=new TextDecoder().decode(q);e1("osm.xml",G)}e.onload(new Uint8Array(q),O)}catch(U){e.onerror?.(U.toString())}}function s(O){return[O.lng,O.lat]}function d(){let O=e.map.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[s(O.getSouthWest()),s(O.getNorthWest()),s(O.getNorthEast()),s(O.getSouthEast()),s(O.getSouthWest())]],type:"Polygon"}}}async function p(){if(e.map){if(e.map.getZoom()<13){e.onerror?.("Zoom in more to import");return}await c(d())}}function g(){e.map&&(Ct(t,new KV(e.map),!0),te(t).startNew(),te(t).addEventListenerSuccess(async O=>{Ct(t,null),await c(O)}),te(t).addEventListenerFailure(()=>{Ct(t,null)}))}var _=kG(),x=ci(_),b=zt(x),S=_t(zt(b));S.__change=o,wc(S,O=>Ct(r,O),()=>te(r));var P=_t(x,4);{var L=O=>{QV(O,{get polygonTool(){return te(t)}})},E=O=>{var U=LG(),q=ci(U);q.__click=p;var G=_t(q,4);G.__click=g;var N=_t(G,2);hs(N,()=>e.children??ts),bt(O,U)};Ji(P,O=>{te(t)?O(L):O(E,!1)})}var C=_t(P,4);ls(C,{get checked(){return te(i)},set checked(O){Ct(i,O,!0)},children:(O,U)=>{var q=Nn("Save a copy of the osm.xml after importing");bt(O,q)},$$slots:{default:!0}});var D=_t(C,2);ZF(D),bt(n,_),en()}ds(["change","click"]);var FG=qt('<div class="form-check"><input class="form-check-input" type="radio" name="overpass-server"/> <label class="form-check-label"> </label></div>'),OG=qt('<details class="mt-3"><summary>Change Overpass server</summary> <div class="mt-2"></div></details>');function ZF(n){const e=()=>nn(mw,"$overpassServer",t),[t,i]=is(),r=[];var o=OG(),c=_t(zt(o),2);ws(c,5,()=>BG,xs,(s,d)=>{var p=FG(),g=zt(p),_,x=_t(g,2),b=zt(x);Zi(()=>{Bl(g,"id",`server-${te(d)??""}`),_!==(_=te(d))&&(g.value=(g.__value=te(d))??""),Bl(x,"for",`server-${te(d)??""}`),sn(b,te(d))}),Dx(r,[],g,()=>(te(d),e()),S=>ia(mw,S)),bt(s,p)}),bt(n,o),i()}function fC(n){let e='poly:"';if(n.geometry.type=="Polygon")for(let[t,i]of n.geometry.coordinates[0])e+=`${i} ${t} `;else if(n.geometry.type=="MultiPolygon")for(let[t,i]of n.geometry.coordinates[0][0])e+=`${i} ${t} `;else throw new Error("overpassQueryForPolygon needs a Polygon or MultiPolygon");return e=e.slice(0,-1)+'"',`(nwr(${e}); node(w)->.x; <;); out meta;`}const XF="overpass-server",zG="https://overpass-api.de/api/",BG=["https://overpass-api.de/api/","https://maps.mail.ru/osm/tools/overpass/api/","https://overpass.openstreetmap.ru/api/","https://overpass.kumi.systems/api/"],mw=ql(window?.localStorage.getItem(XF)||zG);mw.subscribe(n=>{window?.localStorage.setItem(XF,n)});async function t1(n){let e=await fetch(`${bD(mw)}interpreter`,{method:"POST",body:n,headers:{"Content-Type":"text/plain"}});if(!e.ok)throw e.status===504?new Error("Overpass API timed out. The query might be too large. Try again later or switch to a different Overpass server."):new Error(`Overpass failed: ${e.status}. Try again or switch to a different Overpass server.`);return e}let Vi,Wv=null;function Eg(){return(Wv===null||Wv.byteLength===0)&&(Wv=new Uint8Array(Vi.memory.buffer)),Wv}let Vx=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Vx.decode();const NG=2146435072;let JS=0;function $G(n,e){return JS+=e,JS>=NG&&(Vx=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),Vx.decode(),JS=e),Vx.decode(Eg().subarray(n,n+e))}function Po(n,e){return n=n>>>0,$G(n,e)}function xd(n){return n==null}let qf=null;function Kc(){return(qf===null||qf.buffer.detached===!0||qf.buffer.detached===void 0&&qf.buffer!==Vi.memory.buffer)&&(qf=new DataView(Vi.memory.buffer)),qf}function ZM(n){const e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){const r=n.description;return r==null?"Symbol":`Symbol(${r})`}if(e=="function"){const r=n.name;return typeof r=="string"&&r.length>0?`Function(${r})`:"Function"}if(Array.isArray(n)){const r=n.length;let o="[";r>0&&(o+=ZM(n[0]));for(let c=1;c<r;c++)o+=", "+ZM(n[c]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(n));let i;if(t&&t.length>1)i=t[1];else return toString.call(n);if(i=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:i}let sp=0;const hy=new TextEncoder;"encodeInto"in hy||(hy.encodeInto=function(n,e){const t=hy.encode(n);return e.set(t),{read:n.length,written:t.length}});function QS(n,e,t){if(t===void 0){const s=hy.encode(n),d=e(s.length,1)>>>0;return Eg().subarray(d,d+s.length).set(s),sp=s.length,d}let i=n.length,r=e(i,1)>>>0;const o=Eg();let c=0;for(;c<i;c++){const s=n.charCodeAt(c);if(s>127)break;o[r+c]=s}if(c!==i){c!==0&&(n=n.slice(c)),r=t(r,i,i=c+n.length*3,1)>>>0;const s=Eg().subarray(r+c,r+i),d=hy.encodeInto(n,s);c+=d.written,r=t(r,i,c,1)>>>0}return sp=c,r}function VG(n){const e=Vi.__externref_table_alloc();return Vi.__wbindgen_externrefs.set(e,n),e}function eT(n,e){try{return n.apply(this,e)}catch(t){const i=VG(t);Vi.__wbindgen_exn_store(i)}}function UG(n,e){return n=n>>>0,Eg().subarray(n/1,n/1+e)}function Gs(n){const e=Vi.__wbindgen_externrefs.get(n);return Vi.__externref_table_dealloc(n),e}function jG(n,e){const t=e(n.length*1,1)>>>0;return Eg().set(n,t/1),sp=n.length,t}const jI=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>Vi.__wbg_speedwalk_free(n>>>0,1));class Ly{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,jI.unregister(this),e}free(){const e=this.__destroy_into_raw();Vi.__wbg_speedwalk_free(e,0)}get timestamp(){const e=Vi.__wbg_get_speedwalk_timestamp(this.__wbg_ptr);return e[0]===0?void 0:e[1]}set timestamp(e){Vi.__wbg_set_speedwalk_timestamp(this.__wbg_ptr,!xd(e),xd(e)?BigInt(0):e)}editClear(){Vi.speedwalk_editClear(this.__wbg_ptr)}getMetrics(){let e,t;try{const o=Vi.speedwalk_getMetrics(this.__wbg_ptr);var i=o[0],r=o[1];if(o[3])throw i=0,r=0,Gs(o[2]);return e=i,t=r,Po(i,r)}finally{Vi.__wbindgen_free(e,t,1)}}getBoundary(){let e,t;try{const o=Vi.speedwalk_getBoundary(this.__wbg_ptr);var i=o[0],r=o[1];if(o[3])throw i=0,r=0,Gs(o[2]);return e=i,t=r,Po(i,r)}finally{Vi.__wbindgen_free(e,t,1)}}editSetTags(e,t){const i=Vi.speedwalk_editSetTags(this.__wbg_ptr,e,t);if(i[1])throw Gs(i[0])}getRoadSides(){let e,t;try{const o=Vi.speedwalk_getRoadSides(this.__wbg_ptr);var i=o[0],r=o[1];if(o[3])throw i=0,r=0,Gs(o[2]);return e=i,t=r,Po(i,r)}finally{Vi.__wbindgen_free(e,t,1)}}editAssumeTags(e){const t=Vi.speedwalk_editAssumeTags(this.__wbg_ptr,e);if(t[1])throw Gs(t[0])}getOsmTimestamp(){const e=Vi.speedwalk_getOsmTimestamp(this.__wbg_ptr);return e[0]===0?void 0:e[1]}toOsmChangeJson(){let e,t;try{const o=Vi.speedwalk_toOsmChangeJson(this.__wbg_ptr);var i=o[0],r=o[1];if(o[3])throw i=0,r=0,Gs(o[2]);return e=i,t=r,Po(i,r)}finally{Vi.__wbindgen_free(e,t,1)}}getSideLocations(e){let t,i;try{const c=Vi.speedwalk_getSideLocations(this.__wbg_ptr,e);var r=c[0],o=c[1];if(c[3])throw r=0,o=0,Gs(c[2]);return t=r,i=o,Po(r,o)}finally{Vi.__wbindgen_free(t,i,1)}}exportNetwork(e){let t,i;try{const c=Vi.speedwalk_exportNetwork(this.__wbg_ptr,e);var r=c[0],o=c[1];if(c[3])throw r=0,o=0,Gs(c[2]);return t=r,i=o,Po(r,o)}finally{Vi.__wbindgen_free(t,i,1)}}auditCrossings(e){let t,i;try{const c=Vi.speedwalk_auditCrossings(this.__wbg_ptr,e);var r=c[0],o=c[1];if(c[3])throw r=0,o=0,Gs(c[2]);return t=r,i=o,Po(r,o)}finally{Vi.__wbindgen_free(t,i,1)}}editAddNewCrossing(e,t){const i=Vi.speedwalk_editAddNewCrossing(this.__wbg_ptr,e,t);if(i[1])throw Gs(i[0])}editMakeAllSidewalks(e){const t=Vi.speedwalk_editMakeAllSidewalks(this.__wbg_ptr,e);if(t[1])throw Gs(t[0])}editConnectAllCrossings(e){const t=Vi.speedwalk_editConnectAllCrossings(this.__wbg_ptr,e);if(t[1])throw Gs(t[0])}findConnectedComponents(e){let t,i;try{const c=Vi.speedwalk_findConnectedComponents(this.__wbg_ptr,e);var r=c[0],o=c[1];if(c[3])throw r=0,o=0,Gs(c[2]);return t=r,i=o,Po(r,o)}finally{Vi.__wbindgen_free(t,i,1)}}editGenerateMissingCrossings(e){const t=Vi.speedwalk_editGenerateMissingCrossings(this.__wbg_ptr,e);if(t[1])throw Gs(t[0])}constructor(e,t){const i=jG(e,Vi.__wbindgen_malloc),r=sp,o=Vi.speedwalk_new(i,r,t);if(o[2])throw Gs(o[1]);return this.__wbg_ptr=o[0]>>>0,jI.register(this,this.__wbg_ptr,this),this}toOsc(){let e,t;try{const i=Vi.speedwalk_toOsc(this.__wbg_ptr);return e=i[0],t=i[1],Po(i[0],i[1])}finally{Vi.__wbindgen_free(e,t,1)}}getWays(){let e,t;try{const o=Vi.speedwalk_getWays(this.__wbg_ptr);var i=o[0],r=o[1];if(o[3])throw i=0,r=0,Gs(o[2]);return e=i,t=r,Po(i,r)}finally{Vi.__wbindgen_free(e,t,1)}}editUndo(){const e=Vi.speedwalk_editUndo(this.__wbg_ptr);if(e[1])throw Gs(e[0])}getEdits(){let e,t;try{const o=Vi.speedwalk_getEdits(this.__wbg_ptr);var i=o[0],r=o[1];if(o[3])throw i=0,r=0,Gs(o[2]);return e=i,t=r,Po(i,r)}finally{Vi.__wbindgen_free(e,t,1)}}getNodes(){let e,t;try{const o=Vi.speedwalk_getNodes(this.__wbg_ptr);var i=o[0],r=o[1];if(o[3])throw i=0,r=0,Gs(o[2]);return e=i,t=r,Po(i,r)}finally{Vi.__wbindgen_free(e,t,1)}}}Symbol.dispose&&(Ly.prototype[Symbol.dispose]=Ly.prototype.free);const GG=new Set(["basic","cors","default"]);async function qG(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(i){if(n.ok&&GG.has(n.type)&&n.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}const t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}function WG(){const n={};return n.wbg={},n.wbg.__wbg_Error_e83987f665cf5504=function(e,t){return Error(Po(e,t))},n.wbg.__wbg___wbindgen_bigint_get_as_i64_f3ebc5a755000afd=function(e,t){const i=t,r=typeof i=="bigint"?i:void 0;Kc().setBigInt64(e+8,xd(r)?BigInt(0):r,!0),Kc().setInt32(e+0,!xd(r),!0)},n.wbg.__wbg___wbindgen_boolean_get_6d5a1ee65bab5f68=function(e){const t=e,i=typeof t=="boolean"?t:void 0;return xd(i)?16777215:i?1:0},n.wbg.__wbg___wbindgen_debug_string_df47ffb5e35e6763=function(e,t){const i=ZM(t),r=QS(i,Vi.__wbindgen_malloc,Vi.__wbindgen_realloc),o=sp;Kc().setInt32(e+4,o,!0),Kc().setInt32(e+0,r,!0)},n.wbg.__wbg___wbindgen_in_bb933bd9e1b3bc0f=function(e,t){return e in t},n.wbg.__wbg___wbindgen_is_bigint_cb320707dcd35f0b=function(e){return typeof e=="bigint"},n.wbg.__wbg___wbindgen_is_function_ee8a6c5833c90377=function(e){return typeof e=="function"},n.wbg.__wbg___wbindgen_is_object_c818261d21f283a4=function(e){const t=e;return typeof t=="object"&&t!==null},n.wbg.__wbg___wbindgen_is_string_fbb76cb2940daafd=function(e){return typeof e=="string"},n.wbg.__wbg___wbindgen_is_undefined_2d472862bd29a478=function(e){return e===void 0},n.wbg.__wbg___wbindgen_jsval_eq_6b13ab83478b1c50=function(e,t){return e===t},n.wbg.__wbg___wbindgen_jsval_loose_eq_b664b38a2f582147=function(e,t){return e==t},n.wbg.__wbg___wbindgen_number_get_a20bf9b85341449d=function(e,t){const i=t,r=typeof i=="number"?i:void 0;Kc().setFloat64(e+8,xd(r)?0:r,!0),Kc().setInt32(e+0,!xd(r),!0)},n.wbg.__wbg___wbindgen_string_get_e4f06c90489ad01b=function(e,t){const i=t,r=typeof i=="string"?i:void 0;var o=xd(r)?0:QS(r,Vi.__wbindgen_malloc,Vi.__wbindgen_realloc),c=sp;Kc().setInt32(e+4,c,!0),Kc().setInt32(e+0,o,!0)},n.wbg.__wbg___wbindgen_throw_b855445ff6a94295=function(e,t){throw new Error(Po(e,t))},n.wbg.__wbg_call_e762c39fa8ea36bf=function(){return eT(function(e,t){return e.call(t)},arguments)},n.wbg.__wbg_debug_f4b0c59db649db48=function(e){console.debug(e)},n.wbg.__wbg_done_2042aa2670fb1db1=function(e){return e.done},n.wbg.__wbg_entries_e171b586f8f6bdbf=function(e){return Object.entries(e)},n.wbg.__wbg_error_7534b8e9a36f1ab4=function(e,t){let i,r;try{i=e,r=t,console.error(Po(e,t))}finally{Vi.__wbindgen_free(i,r,1)}},n.wbg.__wbg_error_a7f8fbb0523dae15=function(e){console.error(e)},n.wbg.__wbg_get_7bed016f185add81=function(e,t){return e[t>>>0]},n.wbg.__wbg_get_efcb449f58ec27c2=function(){return eT(function(e,t){return Reflect.get(e,t)},arguments)},n.wbg.__wbg_get_with_ref_key_1dc361bd10053bfe=function(e,t){return e[t]},n.wbg.__wbg_info_e674a11f4f50cc0c=function(e){console.info(e)},n.wbg.__wbg_instanceof_ArrayBuffer_70beb1189ca63b38=function(e){let t;try{t=e instanceof ArrayBuffer}catch{t=!1}return t},n.wbg.__wbg_instanceof_Map_8579b5e2ab5437c7=function(e){let t;try{t=e instanceof Map}catch{t=!1}return t},n.wbg.__wbg_instanceof_Uint8Array_20c8e73002f7af98=function(e){let t;try{t=e instanceof Uint8Array}catch{t=!1}return t},n.wbg.__wbg_isArray_96e0af9891d0945d=function(e){return Array.isArray(e)},n.wbg.__wbg_isSafeInteger_d216eda7911dde36=function(e){return Number.isSafeInteger(e)},n.wbg.__wbg_iterator_e5822695327a3c39=function(){return Symbol.iterator},n.wbg.__wbg_length_69bca3cb64fc8748=function(e){return e.length},n.wbg.__wbg_length_cdd215e10d9dd507=function(e){return e.length},n.wbg.__wbg_log_8cec76766b8c0e33=function(e){console.log(e)},n.wbg.__wbg_new_5a79be3ab53b8aa5=function(e){return new Uint8Array(e)},n.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},n.wbg.__wbg_next_020810e0ae8ebcb0=function(){return eT(function(e){return e.next()},arguments)},n.wbg.__wbg_next_2c826fe5dfec6b6a=function(e){return e.next},n.wbg.__wbg_prototypesetcall_2a6620b6922694b2=function(e,t,i){Uint8Array.prototype.set.call(UG(e,t),i)},n.wbg.__wbg_stack_0ed75d68575b0f3c=function(e,t){const i=t.stack,r=QS(i,Vi.__wbindgen_malloc,Vi.__wbindgen_realloc),o=sp;Kc().setInt32(e+4,o,!0),Kc().setInt32(e+0,r,!0)},n.wbg.__wbg_value_692627309814bb8c=function(e){return e.value},n.wbg.__wbg_warn_1d74dddbe2fd1dbb=function(e){console.warn(e)},n.wbg.__wbindgen_cast_2241b6af4c4b2941=function(e,t){return Po(e,t)},n.wbg.__wbindgen_cast_4625c577ab2ec9ee=function(e){return BigInt.asUintN(64,e)},n.wbg.__wbindgen_cast_9ae0607507abb057=function(e){return e},n.wbg.__wbindgen_init_externref_table=function(){const e=Vi.__wbindgen_externrefs,t=e.grow(4);e.set(0,void 0),e.set(t+0,void 0),e.set(t+1,null),e.set(t+2,!0),e.set(t+3,!1)},n}function HG(n,e){return Vi=n.exports,YF.__wbindgen_wasm_module=e,qf=null,Wv=null,Vi.__wbindgen_start(),Vi}async function YF(n){if(Vi!==void 0)return Vi;typeof n<"u"&&(Object.getPrototypeOf(n)===Object.prototype?{module_or_path:n}=n:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof n>"u"&&(n=new URL("/speedwalk/assets/backend_bg-8Tn1PLv5.wasm",import.meta.url));const e=WG();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:t,module:i}=await qG(await n,e);return HG(t,i)}function KF(n,e){const t=`speedwalk_${n}`;let i=e;try{const o=localStorage.getItem(t);o!==null&&(i=JSON.parse(o))}catch(o){console.warn(`Failed to read ${t} from localStorage:`,o)}const r=ql(i);return r.subscribe(o=>{try{localStorage.setItem(t,JSON.stringify(o))}catch(c){c instanceof DOMException&&c.name==="QuotaExceededError"?console.warn(`localStorage quota exceeded for ${t}`):console.warn(`Failed to write ${t} to localStorage:`,c)}}),r}let Dh=ql(null),zs=ql(null),na=ql(0),gw=ql(!1),dy=ql(),XM=ql({kind:"sidewalks"}),_w=KF("enabledBulkOps",!1),vw=ql(!1),Hf=ql({include:"OnlyExplicitFootways",ignore_deadends:!0});function ZG(n){return n.reduce((e,t)=>e+t,0)}function yw(n){return n<1e3?Math.round(n)+" m":(n/1e3).toFixed(1)+" km"}async function sl(){await new Promise(n=>{requestAnimationFrame(()=>{requestAnimationFrame(n)})})}let GI=new Set(rp.keys());function XG(n,e,t={}){const i={type:"Feature"};return(t.id===0||t.id)&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.properties={},i.geometry=n,i}function YG(n,e,t={}){for(const r of n){if(r.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(r[r.length-1].length!==r[0].length)throw new Error("First and last Position are not equivalent.");for(let o=0;o<r[r.length-1].length;o++)if(r[r.length-1][o]!==r[0][o])throw new Error("First and last Position are not equivalent.")}return XG({type:"Polygon",coordinates:n},e,t)}function JF(n,e,t){if(n!==null)for(var i,r,o,c,s,d,p,g=0,_=0,x,b=n.type,S=b==="FeatureCollection",P=b==="Feature",L=S?n.features.length:1,E=0;E<L;E++){p=S?n.features[E].geometry:P?n.geometry:n,x=p?p.type==="GeometryCollection":!1,s=x?p.geometries.length:1;for(var C=0;C<s;C++){var D=0,O=0;if(c=x?p.geometries[C]:p,c!==null){d=c.coordinates;var U=c.type;switch(g=0,U){case null:break;case"Point":if(e(d,_,E,D,O)===!1)return!1;_++,D++;break;case"LineString":case"MultiPoint":for(i=0;i<d.length;i++){if(e(d[i],_,E,D,O)===!1)return!1;_++,U==="MultiPoint"&&D++}U==="LineString"&&D++;break;case"Polygon":case"MultiLineString":for(i=0;i<d.length;i++){for(r=0;r<d[i].length-g;r++){if(e(d[i][r],_,E,D,O)===!1)return!1;_++}U==="MultiLineString"&&D++,U==="Polygon"&&O++}U==="Polygon"&&D++;break;case"MultiPolygon":for(i=0;i<d.length;i++){for(O=0,r=0;r<d[i].length;r++){for(o=0;o<d[i][r].length-g;o++){if(e(d[i][r][o],_,E,D,O)===!1)return!1;_++}O++}D++}break;case"GeometryCollection":for(i=0;i<c.geometries.length;i++)if(JF(c.geometries[i],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}var Lb={exports:{}},Ux={exports:{}},KG=Ux.exports,qI;function JG(){return qI||(qI=1,(function(n,e){(function(t,i){n.exports=i()})(KG,function(){function t(C,D,O,U,q){(function G(N,V,j,z,Q){for(;z>j;){if(z-j>600){var X=z-j+1,re=V-j+1,se=Math.log(X),le=.5*Math.exp(2*se/3),ce=.5*Math.sqrt(se*le*(X-le)/X)*(re-X/2<0?-1:1),be=Math.max(j,Math.floor(V-re*le/X+ce)),Ee=Math.min(z,Math.floor(V+(X-re)*le/X+ce));G(N,V,be,Ee,Q)}var $e=N[V],Ve=j,nt=z;for(i(N,j,V),Q(N[z],$e)>0&&i(N,j,z);Ve<nt;){for(i(N,Ve,nt),Ve++,nt--;Q(N[Ve],$e)<0;)Ve++;for(;Q(N[nt],$e)>0;)nt--}Q(N[j],$e)===0?i(N,j,nt):i(N,++nt,z),nt<=V&&(j=nt+1),V<=nt&&(z=nt-1)}})(C,D,O||0,U||C.length-1,q||r)}function i(C,D,O){var U=C[D];C[D]=C[O],C[O]=U}function r(C,D){return C<D?-1:C>D?1:0}var o=function(C){C===void 0&&(C=9),this._maxEntries=Math.max(4,C),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function c(C,D,O){if(!O)return D.indexOf(C);for(var U=0;U<D.length;U++)if(O(C,D[U]))return U;return-1}function s(C,D){d(C,0,C.children.length,D,C)}function d(C,D,O,U,q){q||(q=L(null)),q.minX=1/0,q.minY=1/0,q.maxX=-1/0,q.maxY=-1/0;for(var G=D;G<O;G++){var N=C.children[G];p(q,C.leaf?U(N):N)}return q}function p(C,D){return C.minX=Math.min(C.minX,D.minX),C.minY=Math.min(C.minY,D.minY),C.maxX=Math.max(C.maxX,D.maxX),C.maxY=Math.max(C.maxY,D.maxY),C}function g(C,D){return C.minX-D.minX}function _(C,D){return C.minY-D.minY}function x(C){return(C.maxX-C.minX)*(C.maxY-C.minY)}function b(C){return C.maxX-C.minX+(C.maxY-C.minY)}function S(C,D){return C.minX<=D.minX&&C.minY<=D.minY&&D.maxX<=C.maxX&&D.maxY<=C.maxY}function P(C,D){return D.minX<=C.maxX&&D.minY<=C.maxY&&D.maxX>=C.minX&&D.maxY>=C.minY}function L(C){return{children:C,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function E(C,D,O,U,q){for(var G=[D,O];G.length;)if(!((O=G.pop())-(D=G.pop())<=U)){var N=D+Math.ceil((O-D)/U/2)*U;t(C,N,D,O,q),G.push(D,N,N,O)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(C){var D=this.data,O=[];if(!P(C,D))return O;for(var U=this.toBBox,q=[];D;){for(var G=0;G<D.children.length;G++){var N=D.children[G],V=D.leaf?U(N):N;P(C,V)&&(D.leaf?O.push(N):S(C,V)?this._all(N,O):q.push(N))}D=q.pop()}return O},o.prototype.collides=function(C){var D=this.data;if(!P(C,D))return!1;for(var O=[];D;){for(var U=0;U<D.children.length;U++){var q=D.children[U],G=D.leaf?this.toBBox(q):q;if(P(C,G)){if(D.leaf||S(C,G))return!0;O.push(q)}}D=O.pop()}return!1},o.prototype.load=function(C){if(!C||!C.length)return this;if(C.length<this._minEntries){for(var D=0;D<C.length;D++)this.insert(C[D]);return this}var O=this._build(C.slice(),0,C.length-1,0);if(this.data.children.length)if(this.data.height===O.height)this._splitRoot(this.data,O);else{if(this.data.height<O.height){var U=this.data;this.data=O,O=U}this._insert(O,this.data.height-O.height-1,!0)}else this.data=O;return this},o.prototype.insert=function(C){return C&&this._insert(C,this.data.height-1),this},o.prototype.clear=function(){return this.data=L([]),this},o.prototype.remove=function(C,D){if(!C)return this;for(var O,U,q,G=this.data,N=this.toBBox(C),V=[],j=[];G||V.length;){if(G||(G=V.pop(),U=V[V.length-1],O=j.pop(),q=!0),G.leaf){var z=c(C,G.children,D);if(z!==-1)return G.children.splice(z,1),V.push(G),this._condense(V),this}q||G.leaf||!S(G,N)?U?(O++,G=U.children[O],q=!1):G=null:(V.push(G),j.push(O),O=0,U=G,G=G.children[0])}return this},o.prototype.toBBox=function(C){return C},o.prototype.compareMinX=function(C,D){return C.minX-D.minX},o.prototype.compareMinY=function(C,D){return C.minY-D.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(C){return this.data=C,this},o.prototype._all=function(C,D){for(var O=[];C;)C.leaf?D.push.apply(D,C.children):O.push.apply(O,C.children),C=O.pop();return D},o.prototype._build=function(C,D,O,U){var q,G=O-D+1,N=this._maxEntries;if(G<=N)return s(q=L(C.slice(D,O+1)),this.toBBox),q;U||(U=Math.ceil(Math.log(G)/Math.log(N)),N=Math.ceil(G/Math.pow(N,U-1))),(q=L([])).leaf=!1,q.height=U;var V=Math.ceil(G/N),j=V*Math.ceil(Math.sqrt(N));E(C,D,O,j,this.compareMinX);for(var z=D;z<=O;z+=j){var Q=Math.min(z+j-1,O);E(C,z,Q,V,this.compareMinY);for(var X=z;X<=Q;X+=V){var re=Math.min(X+V-1,Q);q.children.push(this._build(C,X,re,U-1))}}return s(q,this.toBBox),q},o.prototype._chooseSubtree=function(C,D,O,U){for(;U.push(D),!D.leaf&&U.length-1!==O;){for(var q=1/0,G=1/0,N=void 0,V=0;V<D.children.length;V++){var j=D.children[V],z=x(j),Q=(X=C,re=j,(Math.max(re.maxX,X.maxX)-Math.min(re.minX,X.minX))*(Math.max(re.maxY,X.maxY)-Math.min(re.minY,X.minY))-z);Q<G?(G=Q,q=z<q?z:q,N=j):Q===G&&z<q&&(q=z,N=j)}D=N||D.children[0]}var X,re;return D},o.prototype._insert=function(C,D,O){var U=O?C:this.toBBox(C),q=[],G=this._chooseSubtree(U,this.data,D,q);for(G.children.push(C),p(G,U);D>=0&&q[D].children.length>this._maxEntries;)this._split(q,D),D--;this._adjustParentBBoxes(U,q,D)},o.prototype._split=function(C,D){var O=C[D],U=O.children.length,q=this._minEntries;this._chooseSplitAxis(O,q,U);var G=this._chooseSplitIndex(O,q,U),N=L(O.children.splice(G,O.children.length-G));N.height=O.height,N.leaf=O.leaf,s(O,this.toBBox),s(N,this.toBBox),D?C[D-1].children.push(N):this._splitRoot(O,N)},o.prototype._splitRoot=function(C,D){this.data=L([C,D]),this.data.height=C.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(C,D,O){for(var U,q,G,N,V,j,z,Q=1/0,X=1/0,re=D;re<=O-D;re++){var se=d(C,0,re,this.toBBox),le=d(C,re,O,this.toBBox),ce=(q=se,G=le,N=void 0,V=void 0,j=void 0,z=void 0,N=Math.max(q.minX,G.minX),V=Math.max(q.minY,G.minY),j=Math.min(q.maxX,G.maxX),z=Math.min(q.maxY,G.maxY),Math.max(0,j-N)*Math.max(0,z-V)),be=x(se)+x(le);ce<Q?(Q=ce,U=re,X=be<X?be:X):ce===Q&&be<X&&(X=be,U=re)}return U||O-D},o.prototype._chooseSplitAxis=function(C,D,O){var U=C.leaf?this.compareMinX:g,q=C.leaf?this.compareMinY:_;this._allDistMargin(C,D,O,U)<this._allDistMargin(C,D,O,q)&&C.children.sort(U)},o.prototype._allDistMargin=function(C,D,O,U){C.children.sort(U);for(var q=this.toBBox,G=d(C,0,D,q),N=d(C,O-D,O,q),V=b(G)+b(N),j=D;j<O-D;j++){var z=C.children[j];p(G,C.leaf?q(z):z),V+=b(G)}for(var Q=O-D-1;Q>=D;Q--){var X=C.children[Q];p(N,C.leaf?q(X):X),V+=b(N)}return V},o.prototype._adjustParentBBoxes=function(C,D,O){for(var U=O;U>=0;U--)p(D[U],C)},o.prototype._condense=function(C){for(var D=C.length-1,O=void 0;D>=0;D--)C[D].children.length===0?D>0?(O=C[D-1].children).splice(O.indexOf(C[D]),1):this.clear():s(C[D],this.toBBox)},o})})(Ux)),Ux.exports}let QG=class{constructor(e=[],t=eq){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:i}=this,r=t[e];for(;e>0;){const o=e-1>>1,c=t[o];if(i(r,c)>=0)break;t[e]=c,e=o}t[e]=r}_down(e){const{data:t,compare:i}=this,r=this.length>>1,o=t[e];for(;e<r;){let c=(e<<1)+1,s=t[c];const d=c+1;if(d<this.length&&i(t[d],s)<0&&(c=d,s=t[d]),i(s,o)>=0)break;t[e]=s,e=c}t[e]=o}};function eq(n,e){return n<e?-1:n>e?1:0}const tq=Object.freeze(Object.defineProperty({__proto__:null,default:QG},Symbol.toStringTag,{value:"Module"})),iq=q2(tq);var Tv={exports:{}},tT,WI;function nq(){return WI||(WI=1,tT=function(e,t,i,r){var o=e[0],c=e[1],s=!1;i===void 0&&(i=0),r===void 0&&(r=t.length);for(var d=(r-i)/2,p=0,g=d-1;p<d;g=p++){var _=t[i+p*2+0],x=t[i+p*2+1],b=t[i+g*2+0],S=t[i+g*2+1],P=x>c!=S>c&&o<(b-_)*(c-x)/(S-x)+_;P&&(s=!s)}return s}),tT}var iT,HI;function rq(){return HI||(HI=1,iT=function(e,t,i,r){var o=e[0],c=e[1],s=!1;i===void 0&&(i=0),r===void 0&&(r=t.length);for(var d=r-i,p=0,g=d-1;p<d;g=p++){var _=t[p+i][0],x=t[p+i][1],b=t[g+i][0],S=t[g+i][1],P=x>c!=S>c&&o<(b-_)*(c-x)/(S-x)+_;P&&(s=!s)}return s}),iT}var ZI;function sq(){if(ZI)return Tv.exports;ZI=1;var n=nq(),e=rq();return Tv.exports=function(i,r,o,c){return r.length>0&&Array.isArray(r[0])?e(i,r,o,c):n(i,r,o,c)},Tv.exports.nested=e,Tv.exports.flat=n,Tv.exports}var Hv={exports:{}},oq=Hv.exports,XI;function aq(){return XI||(XI=1,(function(n,e){(function(t,i){i(e)})(oq,function(t){const r=33306690738754706e-32;function o(P,L,E,C,D){let O,U,q,G,N=L[0],V=C[0],j=0,z=0;V>N==V>-N?(O=N,N=L[++j]):(O=V,V=C[++z]);let Q=0;if(j<P&&z<E)for(V>N==V>-N?(q=O-((U=N+O)-N),N=L[++j]):(q=O-((U=V+O)-V),V=C[++z]),O=U,q!==0&&(D[Q++]=q);j<P&&z<E;)V>N==V>-N?(q=O-((U=O+N)-(G=U-O))+(N-G),N=L[++j]):(q=O-((U=O+V)-(G=U-O))+(V-G),V=C[++z]),O=U,q!==0&&(D[Q++]=q);for(;j<P;)q=O-((U=O+N)-(G=U-O))+(N-G),N=L[++j],O=U,q!==0&&(D[Q++]=q);for(;z<E;)q=O-((U=O+V)-(G=U-O))+(V-G),V=C[++z],O=U,q!==0&&(D[Q++]=q);return O===0&&Q!==0||(D[Q++]=O),Q}function c(P){return new Float64Array(P)}const s=33306690738754716e-32,d=22204460492503146e-32,p=11093356479670487e-47,g=c(4),_=c(8),x=c(12),b=c(16),S=c(4);t.orient2d=function(P,L,E,C,D,O){const U=(L-O)*(E-D),q=(P-D)*(C-O),G=U-q;if(U===0||q===0||U>0!=q>0)return G;const N=Math.abs(U+q);return Math.abs(G)>=s*N?G:-(function(V,j,z,Q,X,re,se){let le,ce,be,Ee,$e,Ve,nt,He,De,ot,xe,Be,Je,ct,xt,Se,me,qe;const st=V-X,Rt=z-X,gt=j-re,Ae=Q-re;$e=(xt=(He=st-(nt=(Ve=134217729*st)-(Ve-st)))*(ot=Ae-(De=(Ve=134217729*Ae)-(Ve-Ae)))-((ct=st*Ae)-nt*De-He*De-nt*ot))-(xe=xt-(me=(He=gt-(nt=(Ve=134217729*gt)-(Ve-gt)))*(ot=Rt-(De=(Ve=134217729*Rt)-(Ve-Rt)))-((Se=gt*Rt)-nt*De-He*De-nt*ot))),g[0]=xt-(xe+$e)+($e-me),$e=(Je=ct-((Be=ct+xe)-($e=Be-ct))+(xe-$e))-(xe=Je-Se),g[1]=Je-(xe+$e)+($e-Se),$e=(qe=Be+xe)-Be,g[2]=Be-(qe-$e)+(xe-$e),g[3]=qe;let we=(function(ke,Ze){let yt=Ze[0];for(let Me=1;Me<ke;Me++)yt+=Ze[Me];return yt})(4,g),vt=d*se;if(we>=vt||-we>=vt||(le=V-(st+($e=V-st))+($e-X),be=z-(Rt+($e=z-Rt))+($e-X),ce=j-(gt+($e=j-gt))+($e-re),Ee=Q-(Ae+($e=Q-Ae))+($e-re),le===0&&ce===0&&be===0&&Ee===0)||(vt=p*se+r*Math.abs(we),(we+=st*Ee+Ae*le-(gt*be+Rt*ce))>=vt||-we>=vt))return we;$e=(xt=(He=le-(nt=(Ve=134217729*le)-(Ve-le)))*(ot=Ae-(De=(Ve=134217729*Ae)-(Ve-Ae)))-((ct=le*Ae)-nt*De-He*De-nt*ot))-(xe=xt-(me=(He=ce-(nt=(Ve=134217729*ce)-(Ve-ce)))*(ot=Rt-(De=(Ve=134217729*Rt)-(Ve-Rt)))-((Se=ce*Rt)-nt*De-He*De-nt*ot))),S[0]=xt-(xe+$e)+($e-me),$e=(Je=ct-((Be=ct+xe)-($e=Be-ct))+(xe-$e))-(xe=Je-Se),S[1]=Je-(xe+$e)+($e-Se),$e=(qe=Be+xe)-Be,S[2]=Be-(qe-$e)+(xe-$e),S[3]=qe;const ye=o(4,g,4,S,_);$e=(xt=(He=st-(nt=(Ve=134217729*st)-(Ve-st)))*(ot=Ee-(De=(Ve=134217729*Ee)-(Ve-Ee)))-((ct=st*Ee)-nt*De-He*De-nt*ot))-(xe=xt-(me=(He=gt-(nt=(Ve=134217729*gt)-(Ve-gt)))*(ot=be-(De=(Ve=134217729*be)-(Ve-be)))-((Se=gt*be)-nt*De-He*De-nt*ot))),S[0]=xt-(xe+$e)+($e-me),$e=(Je=ct-((Be=ct+xe)-($e=Be-ct))+(xe-$e))-(xe=Je-Se),S[1]=Je-(xe+$e)+($e-Se),$e=(qe=Be+xe)-Be,S[2]=Be-(qe-$e)+(xe-$e),S[3]=qe;const ie=o(ye,_,4,S,x);$e=(xt=(He=le-(nt=(Ve=134217729*le)-(Ve-le)))*(ot=Ee-(De=(Ve=134217729*Ee)-(Ve-Ee)))-((ct=le*Ee)-nt*De-He*De-nt*ot))-(xe=xt-(me=(He=ce-(nt=(Ve=134217729*ce)-(Ve-ce)))*(ot=be-(De=(Ve=134217729*be)-(Ve-be)))-((Se=ce*be)-nt*De-He*De-nt*ot))),S[0]=xt-(xe+$e)+($e-me),$e=(Je=ct-((Be=ct+xe)-($e=Be-ct))+(xe-$e))-(xe=Je-Se),S[1]=Je-(xe+$e)+($e-Se),$e=(qe=Be+xe)-Be,S[2]=Be-(qe-$e)+(xe-$e),S[3]=qe;const ae=o(ie,x,4,S,b);return b[ae-1]})(P,L,E,C,D,O,N)},t.orient2dfast=function(P,L,E,C,D,O){return(L-O)*(E-D)-(P-D)*(C-O)},Object.defineProperty(t,"__esModule",{value:!0})})})(Hv,Hv.exports)),Hv.exports}var YI;function lq(){if(YI)return Lb.exports;YI=1;var n=JG(),e=iq,t=sq(),i=aq().orient2d;e.default&&(e=e.default),Lb.exports=r,Lb.exports.default=r;function r(O,U,q){U=Math.max(0,U===void 0?2:U),q=q||0;var G=b(O),N=new n(16);N.toBBox=function(nt){return{minX:nt[0],minY:nt[1],maxX:nt[0],maxY:nt[1]}},N.compareMinX=function(nt,He){return nt[0]-He[0]},N.compareMinY=function(nt,He){return nt[1]-He[1]},N.load(O);for(var V=[],j=0,z;j<G.length;j++){var Q=G[j];N.remove(Q),z=S(Q,z),V.push(z)}var X=new n(16);for(j=0;j<V.length;j++)X.insert(x(V[j]));for(var re=U*U,se=q*q;V.length;){var le=V.shift(),ce=le.p,be=le.next.p,Ee=P(ce,be);if(!(Ee<se)){var $e=Ee/re;Q=o(N,le.prev.p,ce,be,le.next.next.p,$e,X),Q&&Math.min(P(Q,ce),P(Q,be))<=$e&&(V.push(le),V.push(S(Q,le)),N.remove(Q),X.remove(le),X.insert(x(le)),X.insert(x(le.next)))}}le=z;var Ve=[];do Ve.push(le.p),le=le.next;while(le!==z);return Ve.push(le.p),Ve}function o(O,U,q,G,N,V,j){for(var z=new e([],c),Q=O.data;Q;){for(var X=0;X<Q.children.length;X++){var re=Q.children[X],se=Q.leaf?L(re,q,G):s(q,G,re);se>V||z.push({node:re,dist:se})}for(;z.length&&!z.peek().node.children;){var le=z.pop(),ce=le.node,be=L(ce,U,q),Ee=L(ce,G,N);if(le.dist<be&&le.dist<Ee&&p(q,ce,j)&&p(G,ce,j))return ce}Q=z.pop(),Q&&(Q=Q.node)}return null}function c(O,U){return O.dist-U.dist}function s(O,U,q){if(d(O,q)||d(U,q))return 0;var G=E(O[0],O[1],U[0],U[1],q.minX,q.minY,q.maxX,q.minY);if(G===0)return 0;var N=E(O[0],O[1],U[0],U[1],q.minX,q.minY,q.minX,q.maxY);if(N===0)return 0;var V=E(O[0],O[1],U[0],U[1],q.maxX,q.minY,q.maxX,q.maxY);if(V===0)return 0;var j=E(O[0],O[1],U[0],U[1],q.minX,q.maxY,q.maxX,q.maxY);return j===0?0:Math.min(G,N,V,j)}function d(O,U){return O[0]>=U.minX&&O[0]<=U.maxX&&O[1]>=U.minY&&O[1]<=U.maxY}function p(O,U,q){for(var G=Math.min(O[0],U[0]),N=Math.min(O[1],U[1]),V=Math.max(O[0],U[0]),j=Math.max(O[1],U[1]),z=q.search({minX:G,minY:N,maxX:V,maxY:j}),Q=0;Q<z.length;Q++)if(_(z[Q].p,z[Q].next.p,O,U))return!1;return!0}function g(O,U,q){return i(O[0],O[1],U[0],U[1],q[0],q[1])}function _(O,U,q,G){return O!==G&&U!==q&&g(O,U,q)>0!=g(O,U,G)>0&&g(q,G,O)>0!=g(q,G,U)>0}function x(O){var U=O.p,q=O.next.p;return O.minX=Math.min(U[0],q[0]),O.minY=Math.min(U[1],q[1]),O.maxX=Math.max(U[0],q[0]),O.maxY=Math.max(U[1],q[1]),O}function b(O){for(var U=O[0],q=O[0],G=O[0],N=O[0],V=0;V<O.length;V++){var j=O[V];j[0]<U[0]&&(U=j),j[0]>G[0]&&(G=j),j[1]<q[1]&&(q=j),j[1]>N[1]&&(N=j)}var z=[U,q,G,N],Q=z.slice();for(V=0;V<O.length;V++)t(O[V],z)||Q.push(O[V]);return D(Q)}function S(O,U){var q={p:O,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return U?(q.next=U.next,q.prev=U,U.next.prev=q,U.next=q):(q.prev=q,q.next=q),q}function P(O,U){var q=O[0]-U[0],G=O[1]-U[1];return q*q+G*G}function L(O,U,q){var G=U[0],N=U[1],V=q[0]-G,j=q[1]-N;if(V!==0||j!==0){var z=((O[0]-G)*V+(O[1]-N)*j)/(V*V+j*j);z>1?(G=q[0],N=q[1]):z>0&&(G+=V*z,N+=j*z)}return V=O[0]-G,j=O[1]-N,V*V+j*j}function E(O,U,q,G,N,V,j,z){var Q=q-O,X=G-U,re=j-N,se=z-V,le=O-N,ce=U-V,be=Q*Q+X*X,Ee=Q*re+X*se,$e=re*re+se*se,Ve=Q*le+X*ce,nt=re*le+se*ce,He=be*$e-Ee*Ee,De,ot,xe,Be,Je=He,ct=He;He===0?(ot=0,Je=1,Be=nt,ct=$e):(ot=Ee*nt-$e*Ve,Be=be*nt-Ee*Ve,ot<0?(ot=0,Be=nt,ct=$e):ot>Je&&(ot=Je,Be=nt+Ee,ct=$e)),Be<0?(Be=0,-Ve<0?ot=0:-Ve>be?ot=Je:(ot=-Ve,Je=be)):Be>ct&&(Be=ct,-Ve+Ee<0?ot=0:-Ve+Ee>be?ot=Je:(ot=-Ve+Ee,Je=be)),De=ot===0?0:ot/Je,xe=Be===0?0:Be/ct;var xt=(1-De)*O+De*q,Se=(1-De)*U+De*G,me=(1-xe)*N+xe*j,qe=(1-xe)*V+xe*z,st=me-xt,Rt=qe-Se;return st*st+Rt*Rt}function C(O,U){return O[0]===U[0]?O[1]-U[1]:O[0]-U[0]}function D(O){O.sort(C);for(var U=[],q=0;q<O.length;q++){for(;U.length>=2&&g(U[U.length-2],U[U.length-1],O[q])<=0;)U.pop();U.push(O[q])}for(var G=[],N=O.length-1;N>=0;N--){for(;G.length>=2&&g(G[G.length-2],G[G.length-1],O[N])<=0;)G.pop();G.push(O[N])}return G.pop(),U.pop(),U.concat(G)}return Lb.exports}var cq=lq();const uq=wD(cq);function hq(n,e={}){e.concavity=e.concavity||1/0;const t=[];if(JF(n,r=>{t.push([r[0],r[1]])}),!t.length)return null;const i=uq(t,e.concavity);return i.length>3?YG([i]):null}class dq extends Map{constructor(){super(),this.binders=[]}add(e,t){this.set(e,t)}addBinder(e){this.binders.push(e)}bindAll(){this.binders.forEach(e=>e.bind())}}function Jf(n,e){if(n){const t=Object.assign({},n);if(e)for(const i of e)delete t[i];return t}return{}}function Zf(n){return n[0]}function dg(n){return n[n.length-1]}function Pl(n){return n.join(",")}function KI(n,e,t){const i=n[e];i?i.push(t):n[e]=[t]}function kb(n,e,t){const i=n[e];let r=-1;i&&(r=i.indexOf(t)),r>=0&&i.splice(r,1)}function JI(n,e){const t=n[e];return t&&t.length>0?t[0]:null}function QF(n){return n.length>3&&Pl(Zf(n))===Pl(dg(n))}function eO(n,e,t){e=e||0,t=t||1;const i=n.reduce((b,S,P)=>n[b][e||0]>S[e||0]?b:P,0),r=i<=0?n.length-2:i-1,o=i>=n.length-1?1:i+1,c=n[r][e],s=n[i][e],d=n[o][e],p=n[r][t],g=n[i][t],_=n[o][t];return(s-c)*(_-p)-(d-c)*(g-p)<0?"clockwise":"counterclockwise"}function fq(n,e,t,i){t=t||0,i=i||1;let r=!1;for(let o=0,c=e.length-1;o<e.length;c=o++)(e[o][t]<=n[t]&&n[t]<e[c][t]||e[c][t]<=n[t]&&n[t]<e[o][t])&&n[i]<(e[c][i]-e[o][i])*(n[t]-e[o][t])/(e[c][t]-e[o][t])+e[o][i]&&(r=!r);return r}function tO(n){return n.map(i1)}function i1(n){return n.map(parseFloat)}class n1{constructor(e,t,i){this.type=e,this.id=t,this.refElems=i,this.tags={},this.meta={},this.refCount=0,this.hasTag=!1,i&&i.add(this.getCompositeId(),this)}addTags(e){this.tags=Object.assign(this.tags,e),this.hasTag=!0}addTag(e,t){this.tags[e]=t,this.hasTag=!0}addMeta(e,t){this.meta[e]=t}addMetas(e){this.meta=Object.assign(this.meta,e)}getCompositeId(){return`${this.type}/${this.id}`}getProps(){return{"@id":this.id,"@type":this.type,...Object.fromEntries(Object.entries(this.meta).map(([e,t])=>["@"+e,t])),...Object.fromEntries(Object.entries(this.tags).map(([e,t])=>[e.startsWith("@")?"@"+e:e,t]))}}}let pC=class extends n1{constructor(e,t){super("node",e,t)}setLatLng(e){this.latLng=e}toFeature(){if(this.latLng)return{type:"Feature",id:this.getCompositeId(),properties:this.getProps(),geometry:{type:"Point",coordinates:i1([this.latLng.lon,this.latLng.lat])}}}getLatLng(){return this.latLng}};class iO extends n1{constructor(e,t,i){super(e,t,i)}setGeometry(e){this.geometry=e}toFeature(){if(this.geometry)return{type:"Feature",id:this.getCompositeId(),properties:this.getProps(),geometry:this.geometry}}}class jx{constructor(e,t,i,r){this.container=e,this.valueFunc=t,this.ctx=i,this.args=r}bind(){const e=this.valueFunc.apply(this.ctx,this.args),t=this.container.indexOf(this);if(t<0)return;const i=[t,1];e&&i.push(e),this.container.splice(...i)}}const pq={ignore:["no"]},mq={include:["services","rest_area","escape","elevator"]},gq={exclude:["coastline","cliff","ridge","arete","tree_row"]},_q={},vq={include:["riverbank","dock","boatyard","dam"]},yq={},bq={},xq={include:["city_wall","ditch","hedge","retaining_wall","wall","spikes"]},wq={include:["station","turntable","roundhouse","platform"]},Sq={},Tq={exclude:["cutline","embankment","pipeline"]},Mq={include:["plant","substation","generator","transformer"]},Cq={},Eq={},Aq={exclude:["taxiway"]},Pq={},Iq={},Rq={},Lq={},kq={},Dq={},Fq={},Oq={},zq={ignore:["yes","no"]},Bq={exclude:["no"]},Nq={building:pq,highway:mq,natural:gq,landuse:_q,waterway:vq,amenity:yq,leisure:bq,barrier:xq,railway:wq,boundary:Sq,man_made:Tq,power:Mq,"piste:type":{include:["downhill"]},place:Cq,shop:Eq,aeroway:Aq,tourism:Pq,historic:Iq,public_transport:Rq,office:Lq,"building:part":{ignore:["no"]},military:kq,ruins:Dq,"area:highway":{},craft:Fq,golf:Oq,indoor:zq,area:Bq};class bw extends n1{constructor(e,t){super("way",e,t),this.tainted=!1,this.latLngArray=[],this.center=null}addLatLng(e){this.latLngArray.push(e)}setCenter(e){this.center=e}setLatLngArray(e){this.latLngArray=e}addNodeRef(e){const t=new jx(this.latLngArray,i=>{const r=this.refElems.get(`node/${i}`);if(r)return r.refCount++,r.getLatLng();this.tainted=!0},this,[e]);this.latLngArray.push(t),this.refElems.addBinder(t)}addTags(e){super.addTags(e)}addTag(e,t){super.addTag(e,t)}toCoordsArray(){return this.latLngArray.map(e=>[e.lon,e.lat])}toFeature(){let e=this.toCoordsArray();if(e.length>1){const t=tO(e),i={type:"Feature",id:this.getCompositeId(),properties:this.getProps(),geometry:{type:"LineString",coordinates:t}};return this.tainted&&(i.properties["@tainted"]=this.tainted),this.isPolygon&&QF(t)&&(eO(t)!=="counterclockwise"&&t.reverse(),i.geometry={type:"Polygon",coordinates:[t]},this.tainted&&(i.properties["@tainted"]=this.tainted)),i}else if(this.center!==null){const t={type:"Feature",id:this.getCompositeId(),properties:this.getProps(),geometry:{type:"Point",coordinates:i1([this.center.lon,this.center.lat])}};return this.tainted&&(t.properties["@tainted"]=this.tainted),t}}get isPolygon(){var e;let t=!1;for(const[i,r]of Object.entries(Nq)){const o=this.tags[i];if(o&&r){if(!((e=r.ignore)===null||e===void 0)&&e.includes(o))continue;t=!0,r.include?t=r.include.includes(o):r.exclude&&(t=!r.exclude.includes(o))}}return t}}class nT extends Array{constructor(){super(),this.firstMap={},this.lastMap={}}addWay(e){const t=e.toCoordsArray();t.length>0&&(this.push(t),KI(this.firstMap,Pl(Zf(t)),t),KI(this.lastMap,Pl(dg(t)),t))}mergeWays(){const e=[];let t=this.shift();for(;t;){kb(this.firstMap,Pl(Zf(t)),t),kb(this.lastMap,Pl(dg(t)),t);let i=t,r;do{let o=this.getNextWay(i);r=o.next;let c=o.mergeType;if(r)switch(this.splice(this.indexOf(r),1),kb(this.firstMap,Pl(Zf(r)),r),kb(this.lastMap,Pl(dg(r)),r),c){case 0:i=i.concat(r.slice(1));break;case 1:r.reverse(),i=i.concat(r.slice(1));break;case 2:i.reverse(),i=i.concat(r.slice(1));break;case 3:i=r.concat(i.slice(1));break}}while(r);e.push(tO(i)),t=this.shift()}return e}getNextWay(e){const t=Pl(dg(e)),i=Pl(Zf(e));let r=this.length>0?this[0]:null;if(r){const o=Pl(Zf(r)),c=Pl(dg(r));if(t===o)return{next:r,mergeType:0};if(t===c)return{next:r,mergeType:1};if(i===o)return{next:r,mergeType:2};if(i===c)return{next:r,mergeType:3}}return r=JI(this.firstMap,t),r?{next:r,mergeType:0}:(r=JI(this.lastMap,t),{next:r,mergeType:1})}toRings(e){const t=this.mergeWays(),i=[];let r=t.shift();for(;r;)QF(r)&&(eO(r)!==e&&r.reverse(),i.push(r)),r=t.shift();return i}}class nO extends n1{constructor(e,t){super("relation",e,t),this.relations=[],this.nodes=[],this.bounds=void 0,this.center=null,this.ways=[],this.members=[]}setBounds(e){this.bounds=e}setCenter(e){this.center=e}addMember(e){switch(this.members.push(e),e.type){case"relation":let t=new jx(this.relations,r=>{const o=this.refElems.get(`relation/${r}`);if(o)return o.refCount++,o},this,[e.ref]);this.relations.push(t),this.refElems.addBinder(t);break;case"way":if(e.geometry){const r=new bw(e.ref,void 0);r.setLatLngArray(e.geometry),r.refCount++,this.ways.push(r)}else if(e.nodes){const r=new bw(e.ref,this.refElems);for(const o of e.nodes)r.addNodeRef(o);r.refCount++,this.ways.push(r)}else{let r=new jx(this.ways,o=>{const c=this.refElems.get(`way/${o}`);if(c)return c.refCount++,c},this,[e.ref]);this.ways.push(r),this.refElems.addBinder(r)}break;case"node":let i=null;if(e.lat&&e.lon){i=new pC(e.ref,void 0),i.setLatLng({lon:e.lon,lat:e.lat}),e.tags&&i.addTags(e.tags);for(const[r,o]of Object.entries(e))["id","type","lat","lon"].indexOf(r)<0&&i.addMeta(r,o);i.refCount++,this.nodes.push(i)}else{let r=new jx(this.nodes,o=>{const c=this.refElems.get(`node/${o}`);if(c)return c.refCount++,c},this,[e.ref]);this.nodes.push(r),this.refElems.addBinder(r)}break}}constructStringGeometry(e){const t=e?e.mergeWays():[];return t.length===0?null:{type:"MultiLineString",coordinates:t}}constructPolygonGeometry(e,t){const i=e?e.toRings("counterclockwise"):[],r=t?t.toRings("clockwise"):[];if(i.length>0){const o=[];let c;for(c of i)o.push([c]);for(c=r.shift();c;){for(const s in i)if(fq(Zf(c),i[s])){o[s].push(c);break}c=r.shift()}return o.length===1?{type:"Polygon",coordinates:o[0]}:{type:"MultiPolygon",coordinates:o}}return null}toFeature(){const e=[];let t=!1;const i=[],r={type:"Feature",id:this.getCompositeId(),bbox:this.bounds,properties:this.getProps(),geometry:null};if(this.bounds||delete r.bbox,this.members.some(({role:o})=>o==="outer")){const o=new nT,c=new nT;for(const{type:d,ref:p,role:g}of this.members)if(d==="way"&&["inner","outer"].includes(g)){const _=`way/${p}`;i.push(_);const x=this.ways.find(b=>b.getCompositeId()===_);x?g==="outer"?o.addWay(x):g==="inner"&&c.addWay(x):t=!0}let s=this.constructPolygonGeometry(o,c);s&&e.push(s)}else if(["multilinestring","route","waterway"].includes(this.tags.type)){const o=new nT;for(const{type:s,ref:d,role:p}of this.members)if(s==="way"){const g=`way/${d}`;i.push(g);const _=this.ways.find(x=>x.getCompositeId()===g);_?o.addWay(_):t=!0}let c=this.constructStringGeometry(o);c&&e.push(c)}for(const{type:o,ref:c,role:s}of this.members){const d=`${o}/${c}`;if(i.includes(d))continue;let p;switch(o){case"node":p=this.nodes.find(g=>g.getCompositeId()===d);break;case"way":p=this.ways.find(g=>g.getCompositeId()===d);break;case"relation":p=this.relations.find(g=>g.getCompositeId()===d);break}if(p){const g=p.toFeature();g?.geometry&&e.push(g.geometry)}else t=!0}return this.center!==null&&e.push({type:"Point",coordinates:i1([this.center.lon,this.center.lat])}),t&&(r.properties["@tainted"]=t),e.length===1?r.geometry=e[0]:r.geometry={type:"GeometryCollection",geometries:e},r}}function $q(n,e){var t;for(const i of n.elements){if(!((t=i.geometry)===null||t===void 0)&&t.type){const r=new iO(i.type,i.id,e);i.tags&&r.addTags(i.tags),r.addMetas(Jf(i,["id","type","tags","geometry"])),r.setGeometry(i.geometry);continue}switch(i.type){case"node":const r=new pC(i.id,e);i.tags&&r.addTags(i.tags),r.addMetas(Jf(i,["id","type","tags","lat","lon"])),r.setLatLng(i);break;case"way":const o=new bw(i.id,e);if(i.tags&&o.addTags(i.tags),o.addMetas(Jf(i,["id","type","tags","nodes","geometry"])),i.geometry)o.setLatLngArray(i.geometry);else if(i.center)o.setCenter(i.center);else if(i.nodes)for(const s of i.nodes)o.addNodeRef(s);break;case"relation":const c=new nO(i.id,e);if(i.bounds&&c.setBounds([parseFloat(i.bounds.minlon),parseFloat(i.bounds.minlat),parseFloat(i.bounds.maxlon),parseFloat(i.bounds.maxlat)]),i.tags&&c.addTags(i.tags),i.center&&c.setCenter(i.center),c.addMetas(Jf(i,["id","type","tags","bounds","members"])),i.members)for(const s of i.members)c.addMember(s);break}}}function Vq(n,e){"txml";e=e||{};var t=e.pos||0,i=!!e.keepComments,r=!!e.keepWhitespace,o="<",c=60,s=">",d=62,p=45,g=47,_=33,x=39,b=34,S=91,P=93;function L(V){for(var j=[];n[t];)if(n.charCodeAt(t)==c){if(n.charCodeAt(t+1)===g){var z=t+2;t=n.indexOf(s,t);var Q=n.substring(z,t);if(Q.indexOf(V)==-1){var X=n.substring(0,t).split(`
`);throw new Error(`Unexpected close tag
Line: `+(X.length-1)+`
Column: `+(X[X.length-1].length+1)+`
Char: `+n[t])}return t+1&&(t+=1),j}else if(n.charCodeAt(t+1)===_){if(n.charCodeAt(t+2)==p){const Ee=t;for(;t!==-1&&!(n.charCodeAt(t)===d&&n.charCodeAt(t-1)==p&&n.charCodeAt(t-2)==p&&t!=-1);)t=n.indexOf(s,t+1);t===-1&&(t=n.length),i&&j.push(n.substring(Ee,t+1))}else if(n.charCodeAt(t+2)===S&&n.charCodeAt(t+8)===S&&n.substr(t+3,5).toLowerCase()==="cdata"){var re=n.indexOf("]]>",t);re==-1?(j.push(n.substr(t+9)),t=n.length):(j.push(n.substring(t+9,re)),t=re+3);continue}else{const Ee=t+1;t+=2;for(var se=!1;(n.charCodeAt(t)!==d||se===!0)&&n[t];)n.charCodeAt(t)===S?se=!0:se===!0&&n.charCodeAt(t)===P&&(se=!1),t++;j.push(n.substring(Ee,t))}t++;continue}var le=U();j.push(le),le.tagName[0]==="?"&&(j.push(...le.children),le.children=[])}else{var ce=E();if(r)ce.length>0&&j.push(ce);else{var be=ce.trim();be.length>0&&j.push(be)}t++}return j}function E(){var V=t;return t=n.indexOf(o,t)-1,t===-2&&(t=n.length),n.slice(V,t+1)}var C=`\r
	>/= `;function D(){for(var V=t;C.indexOf(n[t])===-1&&n[t];)t++;return n.slice(V,t)}var O=e.noChildNodes||["img","br","input","meta","link","hr"];function U(){t++;const V=D(),j={};let z=[];for(;n.charCodeAt(t)!==d&&n[t];){var Q=n.charCodeAt(t);if(Q>64&&Q<91||Q>96&&Q<123){for(var X=D(),re=n.charCodeAt(t);re&&re!==x&&re!==b&&!(re>64&&re<91||re>96&&re<123)&&re!==d;)t++,re=n.charCodeAt(t);if(re===x||re===b){var se=q();if(t===-1)return{tagName:V,attributes:j,children:z}}else se=null,t--;j[X]=se}t++}if(n.charCodeAt(t-1)!==g)if(V=="script"){var le=t+1;t=n.indexOf("<\/script>",t),z=[n.slice(le,t)],t+=9}else if(V=="style"){var le=t+1;t=n.indexOf("</style>",t),z=[n.slice(le,t)],t+=8}else O.indexOf(V)===-1?(t++,z=L(V)):t++;else t++;return{tagName:V,attributes:j,children:z}}function q(){var V=n[t],j=t+1;return t=n.indexOf(V,j),n.slice(j,t)}function G(){var V=new RegExp("\\s"+e.attrName+`\\s*=['"]`+e.attrValue+`['"]`).exec(n);return V?V.index:-1}var N=null;if(e.attrValue!==void 0){e.attrName=e.attrName||"id";for(var N=[];(t=G())!==-1;)t=n.lastIndexOf("<",t),t!==-1&&N.push(U()),n=n.substr(t),t=0}else e.parseNode?N=U():N=L("");return e.filter&&(N=sO(N,e.filter)),e.simplify?rO(Array.isArray(N)?N:[N]):(e.setPos&&(N.pos=t),N)}function rO(n){var e={};if(!n.length)return"";if(n.length===1&&typeof n[0]=="string")return n[0];n.forEach(function(i){if(typeof i=="object"){e[i.tagName]||(e[i.tagName]=[]);var r=rO(i.children);e[i.tagName].push(r),Object.keys(i.attributes).length&&typeof r!="string"&&(r._attributes=i.attributes)}});for(var t in e)e[t].length==1&&(e[t]=e[t][0]);return e}function sO(n,e,t=0,i=""){var r=[];return n.forEach(function(o,c){if(typeof o=="object"&&e(o,c,t,i)&&r.push(o),o.children){var s=sO(o.children,e,t+1,(i?i+".":"")+c+"."+o.tagName);r=r.concat(s)}}),r}var Mv={exports:{}},Db={exports:{}};const Uq={},jq=Object.freeze(Object.defineProperty({__proto__:null,default:Uq},Symbol.toStringTag,{value:"Module"})),Ad=q2(jq);var rT,QI;function oO(){return QI||(QI=1,rT=Ad.EventEmitter),rT}var sT,eR;function Gq(){if(eR)return sT;eR=1;function n(S,P){var L=Object.keys(S);if(Object.getOwnPropertySymbols){var E=Object.getOwnPropertySymbols(S);P&&(E=E.filter(function(C){return Object.getOwnPropertyDescriptor(S,C).enumerable})),L.push.apply(L,E)}return L}function e(S){for(var P=1;P<arguments.length;P++){var L=arguments[P]!=null?arguments[P]:{};P%2?n(Object(L),!0).forEach(function(E){t(S,E,L[E])}):Object.getOwnPropertyDescriptors?Object.defineProperties(S,Object.getOwnPropertyDescriptors(L)):n(Object(L)).forEach(function(E){Object.defineProperty(S,E,Object.getOwnPropertyDescriptor(L,E))})}return S}function t(S,P,L){return P=c(P),P in S?Object.defineProperty(S,P,{value:L,enumerable:!0,configurable:!0,writable:!0}):S[P]=L,S}function i(S,P){if(!(S instanceof P))throw new TypeError("Cannot call a class as a function")}function r(S,P){for(var L=0;L<P.length;L++){var E=P[L];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(S,c(E.key),E)}}function o(S,P,L){return P&&r(S.prototype,P),Object.defineProperty(S,"prototype",{writable:!1}),S}function c(S){var P=s(S,"string");return typeof P=="symbol"?P:String(P)}function s(S,P){if(typeof S!="object"||S===null)return S;var L=S[Symbol.toPrimitive];if(L!==void 0){var E=L.call(S,P);if(typeof E!="object")return E;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(S)}var d=Ad,p=d.Buffer,g=Ad,_=g.inspect,x=_&&_.custom||"inspect";function b(S,P,L){p.prototype.copy.call(S,P,L)}return sT=(function(){function S(){i(this,S),this.head=null,this.tail=null,this.length=0}return o(S,[{key:"push",value:function(L){var E={data:L,next:null};this.length>0?this.tail.next=E:this.head=E,this.tail=E,++this.length}},{key:"unshift",value:function(L){var E={data:L,next:this.head};this.length===0&&(this.tail=E),this.head=E,++this.length}},{key:"shift",value:function(){if(this.length!==0){var L=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,L}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(L){if(this.length===0)return"";for(var E=this.head,C=""+E.data;E=E.next;)C+=L+E.data;return C}},{key:"concat",value:function(L){if(this.length===0)return p.alloc(0);for(var E=p.allocUnsafe(L>>>0),C=this.head,D=0;C;)b(C.data,E,D),D+=C.data.length,C=C.next;return E}},{key:"consume",value:function(L,E){var C;return L<this.head.data.length?(C=this.head.data.slice(0,L),this.head.data=this.head.data.slice(L)):L===this.head.data.length?C=this.shift():C=E?this._getString(L):this._getBuffer(L),C}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(L){var E=this.head,C=1,D=E.data;for(L-=D.length;E=E.next;){var O=E.data,U=L>O.length?O.length:L;if(U===O.length?D+=O:D+=O.slice(0,L),L-=U,L===0){U===O.length?(++C,E.next?this.head=E.next:this.head=this.tail=null):(this.head=E,E.data=O.slice(U));break}++C}return this.length-=C,D}},{key:"_getBuffer",value:function(L){var E=p.allocUnsafe(L),C=this.head,D=1;for(C.data.copy(E),L-=C.data.length;C=C.next;){var O=C.data,U=L>O.length?O.length:L;if(O.copy(E,E.length-L,0,U),L-=U,L===0){U===O.length?(++D,C.next?this.head=C.next:this.head=this.tail=null):(this.head=C,C.data=O.slice(U));break}++D}return this.length-=D,E}},{key:x,value:function(L,E){return _(this,e(e({},E),{},{depth:0,customInspect:!1}))}}]),S})(),sT}var oT,tR;function aO(){if(tR)return oT;tR=1;function n(c,s){var d=this,p=this._readableState&&this._readableState.destroyed,g=this._writableState&&this._writableState.destroyed;return p||g?(s?s(c):c&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process.nextTick(r,this,c)):process.nextTick(r,this,c)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(c||null,function(_){!s&&_?d._writableState?d._writableState.errorEmitted?process.nextTick(t,d):(d._writableState.errorEmitted=!0,process.nextTick(e,d,_)):process.nextTick(e,d,_):s?(process.nextTick(t,d),s(_)):process.nextTick(t,d)}),this)}function e(c,s){r(c,s),t(c)}function t(c){c._writableState&&!c._writableState.emitClose||c._readableState&&!c._readableState.emitClose||c.emit("close")}function i(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function r(c,s){c.emit("error",s)}function o(c,s){var d=c._readableState,p=c._writableState;d&&d.autoDestroy||p&&p.autoDestroy?c.destroy(s):c.emit("error",s)}return oT={destroy:n,undestroy:i,errorOrDestroy:o},oT}var aT={},iR;function l_(){if(iR)return aT;iR=1;function n(s,d){s.prototype=Object.create(d.prototype),s.prototype.constructor=s,s.__proto__=d}var e={};function t(s,d,p){p||(p=Error);function g(x,b,S){return typeof d=="string"?d:d(x,b,S)}var _=(function(x){n(b,x);function b(S,P,L){return x.call(this,g(S,P,L))||this}return b})(p);_.prototype.name=p.name,_.prototype.code=s,e[s]=_}function i(s,d){if(Array.isArray(s)){var p=s.length;return s=s.map(function(g){return String(g)}),p>2?"one of ".concat(d," ").concat(s.slice(0,p-1).join(", "),", or ")+s[p-1]:p===2?"one of ".concat(d," ").concat(s[0]," or ").concat(s[1]):"of ".concat(d," ").concat(s[0])}else return"of ".concat(d," ").concat(String(s))}function r(s,d,p){return s.substr(0,d.length)===d}function o(s,d,p){return(p===void 0||p>s.length)&&(p=s.length),s.substring(p-d.length,p)===d}function c(s,d,p){return typeof p!="number"&&(p=0),p+d.length>s.length?!1:s.indexOf(d,p)!==-1}return t("ERR_INVALID_OPT_VALUE",function(s,d){return'The value "'+d+'" is invalid for option "'+s+'"'},TypeError),t("ERR_INVALID_ARG_TYPE",function(s,d,p){var g;typeof d=="string"&&r(d,"not ")?(g="must not be",d=d.replace(/^not /,"")):g="must be";var _;if(o(s," argument"))_="The ".concat(s," ").concat(g," ").concat(i(d,"type"));else{var x=c(s,".")?"property":"argument";_='The "'.concat(s,'" ').concat(x," ").concat(g," ").concat(i(d,"type"))}return _+=". Received type ".concat(typeof p),_},TypeError),t("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),t("ERR_METHOD_NOT_IMPLEMENTED",function(s){return"The "+s+" method is not implemented"}),t("ERR_STREAM_PREMATURE_CLOSE","Premature close"),t("ERR_STREAM_DESTROYED",function(s){return"Cannot call "+s+" after a stream was destroyed"}),t("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),t("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),t("ERR_STREAM_WRITE_AFTER_END","write after end"),t("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),t("ERR_UNKNOWN_ENCODING",function(s){return"Unknown encoding: "+s},TypeError),t("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),aT.codes=e,aT}var lT,nR;function lO(){if(nR)return lT;nR=1;var n=l_().codes.ERR_INVALID_OPT_VALUE;function e(i,r,o){return i.highWaterMark!=null?i.highWaterMark:r?i[o]:null}function t(i,r,o,c){var s=e(r,c,o);if(s!=null){if(!(isFinite(s)&&Math.floor(s)===s)||s<0){var d=c?o:"highWaterMark";throw new n(d,s)}return Math.floor(s)}return i.objectMode?16:16*1024}return lT={getHighWaterMark:t},lT}var Fb={exports:{}},rR;function c_(){return rR||(rR=1,typeof Object.create=="function"?Fb.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:Fb.exports=function(e,t){if(t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}}),Fb.exports}var cT,sR;function qq(){if(sR)return cT;sR=1,cT=n;function n(t,i){if(e("noDeprecation"))return t;var r=!1;function o(){if(!r){if(e("throwDeprecation"))throw new Error(i);e("traceDeprecation")?console.trace(i):console.warn(i),r=!0}return t.apply(this,arguments)}return o}function e(t){try{if(!Og.localStorage)return!1}catch{return!1}var i=Og.localStorage[t];return i==null?!1:String(i).toLowerCase()==="true"}return cT}var uT,oR;function cO(){if(oR)return uT;oR=1,uT=N;function n(xe){var Be=this;this.next=null,this.entry=null,this.finish=function(){ot(Be,xe)}}var e;N.WritableState=q;var t={deprecate:qq()},i=oO(),r=Ad.Buffer,o=(typeof Og<"u"?Og:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function c(xe){return r.from(xe)}function s(xe){return r.isBuffer(xe)||xe instanceof o}var d=aO(),p=lO(),g=p.getHighWaterMark,_=l_().codes,x=_.ERR_INVALID_ARG_TYPE,b=_.ERR_METHOD_NOT_IMPLEMENTED,S=_.ERR_MULTIPLE_CALLBACK,P=_.ERR_STREAM_CANNOT_PIPE,L=_.ERR_STREAM_DESTROYED,E=_.ERR_STREAM_NULL_VALUES,C=_.ERR_STREAM_WRITE_AFTER_END,D=_.ERR_UNKNOWN_ENCODING,O=d.errorOrDestroy;c_()(N,i);function U(){}function q(xe,Be,Je){e=e||Gg(),xe=xe||{},typeof Je!="boolean"&&(Je=Be instanceof e),this.objectMode=!!xe.objectMode,Je&&(this.objectMode=this.objectMode||!!xe.writableObjectMode),this.highWaterMark=g(this,xe,"writableHighWaterMark",Je),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var ct=xe.decodeStrings===!1;this.decodeStrings=!ct,this.defaultEncoding=xe.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(xt){le(Be,xt)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=xe.emitClose!==!1,this.autoDestroy=!!xe.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new n(this)}q.prototype.getBuffer=function(){for(var Be=this.bufferedRequest,Je=[];Be;)Je.push(Be),Be=Be.next;return Je},(function(){try{Object.defineProperty(q.prototype,"buffer",{get:t.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}})();var G;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(G=Function.prototype[Symbol.hasInstance],Object.defineProperty(N,Symbol.hasInstance,{value:function(Be){return G.call(this,Be)?!0:this!==N?!1:Be&&Be._writableState instanceof q}})):G=function(Be){return Be instanceof this};function N(xe){e=e||Gg();var Be=this instanceof e;if(!Be&&!G.call(N,this))return new N(xe);this._writableState=new q(xe,this,Be),this.writable=!0,xe&&(typeof xe.write=="function"&&(this._write=xe.write),typeof xe.writev=="function"&&(this._writev=xe.writev),typeof xe.destroy=="function"&&(this._destroy=xe.destroy),typeof xe.final=="function"&&(this._final=xe.final)),i.call(this)}N.prototype.pipe=function(){O(this,new P)};function V(xe,Be){var Je=new C;O(xe,Je),process.nextTick(Be,Je)}function j(xe,Be,Je,ct){var xt;return Je===null?xt=new E:typeof Je!="string"&&!Be.objectMode&&(xt=new x("chunk",["string","Buffer"],Je)),xt?(O(xe,xt),process.nextTick(ct,xt),!1):!0}N.prototype.write=function(xe,Be,Je){var ct=this._writableState,xt=!1,Se=!ct.objectMode&&s(xe);return Se&&!r.isBuffer(xe)&&(xe=c(xe)),typeof Be=="function"&&(Je=Be,Be=null),Se?Be="buffer":Be||(Be=ct.defaultEncoding),typeof Je!="function"&&(Je=U),ct.ending?V(this,Je):(Se||j(this,ct,xe,Je))&&(ct.pendingcb++,xt=Q(this,ct,Se,xe,Be,Je)),xt},N.prototype.cork=function(){this._writableState.corked++},N.prototype.uncork=function(){var xe=this._writableState;xe.corked&&(xe.corked--,!xe.writing&&!xe.corked&&!xe.bufferProcessing&&xe.bufferedRequest&&Ee(this,xe))},N.prototype.setDefaultEncoding=function(Be){if(typeof Be=="string"&&(Be=Be.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((Be+"").toLowerCase())>-1))throw new D(Be);return this._writableState.defaultEncoding=Be,this},Object.defineProperty(N.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function z(xe,Be,Je){return!xe.objectMode&&xe.decodeStrings!==!1&&typeof Be=="string"&&(Be=r.from(Be,Je)),Be}Object.defineProperty(N.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function Q(xe,Be,Je,ct,xt,Se){if(!Je){var me=z(Be,ct,xt);ct!==me&&(Je=!0,xt="buffer",ct=me)}var qe=Be.objectMode?1:ct.length;Be.length+=qe;var st=Be.length<Be.highWaterMark;if(st||(Be.needDrain=!0),Be.writing||Be.corked){var Rt=Be.lastBufferedRequest;Be.lastBufferedRequest={chunk:ct,encoding:xt,isBuf:Je,callback:Se,next:null},Rt?Rt.next=Be.lastBufferedRequest:Be.bufferedRequest=Be.lastBufferedRequest,Be.bufferedRequestCount+=1}else X(xe,Be,!1,qe,ct,xt,Se);return st}function X(xe,Be,Je,ct,xt,Se,me){Be.writelen=ct,Be.writecb=me,Be.writing=!0,Be.sync=!0,Be.destroyed?Be.onwrite(new L("write")):Je?xe._writev(xt,Be.onwrite):xe._write(xt,Se,Be.onwrite),Be.sync=!1}function re(xe,Be,Je,ct,xt){--Be.pendingcb,Je?(process.nextTick(xt,ct),process.nextTick(He,xe,Be),xe._writableState.errorEmitted=!0,O(xe,ct)):(xt(ct),xe._writableState.errorEmitted=!0,O(xe,ct),He(xe,Be))}function se(xe){xe.writing=!1,xe.writecb=null,xe.length-=xe.writelen,xe.writelen=0}function le(xe,Be){var Je=xe._writableState,ct=Je.sync,xt=Je.writecb;if(typeof xt!="function")throw new S;if(se(Je),Be)re(xe,Je,ct,Be,xt);else{var Se=$e(Je)||xe.destroyed;!Se&&!Je.corked&&!Je.bufferProcessing&&Je.bufferedRequest&&Ee(xe,Je),ct?process.nextTick(ce,xe,Je,Se,xt):ce(xe,Je,Se,xt)}}function ce(xe,Be,Je,ct){Je||be(xe,Be),Be.pendingcb--,ct(),He(xe,Be)}function be(xe,Be){Be.length===0&&Be.needDrain&&(Be.needDrain=!1,xe.emit("drain"))}function Ee(xe,Be){Be.bufferProcessing=!0;var Je=Be.bufferedRequest;if(xe._writev&&Je&&Je.next){var ct=Be.bufferedRequestCount,xt=new Array(ct),Se=Be.corkedRequestsFree;Se.entry=Je;for(var me=0,qe=!0;Je;)xt[me]=Je,Je.isBuf||(qe=!1),Je=Je.next,me+=1;xt.allBuffers=qe,X(xe,Be,!0,Be.length,xt,"",Se.finish),Be.pendingcb++,Be.lastBufferedRequest=null,Se.next?(Be.corkedRequestsFree=Se.next,Se.next=null):Be.corkedRequestsFree=new n(Be),Be.bufferedRequestCount=0}else{for(;Je;){var st=Je.chunk,Rt=Je.encoding,gt=Je.callback,Ae=Be.objectMode?1:st.length;if(X(xe,Be,!1,Ae,st,Rt,gt),Je=Je.next,Be.bufferedRequestCount--,Be.writing)break}Je===null&&(Be.lastBufferedRequest=null)}Be.bufferedRequest=Je,Be.bufferProcessing=!1}N.prototype._write=function(xe,Be,Je){Je(new b("_write()"))},N.prototype._writev=null,N.prototype.end=function(xe,Be,Je){var ct=this._writableState;return typeof xe=="function"?(Je=xe,xe=null,Be=null):typeof Be=="function"&&(Je=Be,Be=null),xe!=null&&this.write(xe,Be),ct.corked&&(ct.corked=1,this.uncork()),ct.ending||De(this,ct,Je),this},Object.defineProperty(N.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function $e(xe){return xe.ending&&xe.length===0&&xe.bufferedRequest===null&&!xe.finished&&!xe.writing}function Ve(xe,Be){xe._final(function(Je){Be.pendingcb--,Je&&O(xe,Je),Be.prefinished=!0,xe.emit("prefinish"),He(xe,Be)})}function nt(xe,Be){!Be.prefinished&&!Be.finalCalled&&(typeof xe._final=="function"&&!Be.destroyed?(Be.pendingcb++,Be.finalCalled=!0,process.nextTick(Ve,xe,Be)):(Be.prefinished=!0,xe.emit("prefinish")))}function He(xe,Be){var Je=$e(Be);if(Je&&(nt(xe,Be),Be.pendingcb===0&&(Be.finished=!0,xe.emit("finish"),Be.autoDestroy))){var ct=xe._readableState;(!ct||ct.autoDestroy&&ct.endEmitted)&&xe.destroy()}return Je}function De(xe,Be,Je){Be.ending=!0,He(xe,Be),Je&&(Be.finished?process.nextTick(Je):xe.once("finish",Je)),Be.ended=!0,xe.writable=!1}function ot(xe,Be,Je){var ct=xe.entry;for(xe.entry=null;ct;){var xt=ct.callback;Be.pendingcb--,xt(Je),ct=ct.next}Be.corkedRequestsFree.next=xe}return Object.defineProperty(N.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(Be){this._writableState&&(this._writableState.destroyed=Be)}}),N.prototype.destroy=d.destroy,N.prototype._undestroy=d.undestroy,N.prototype._destroy=function(xe,Be){Be(xe)},uT}var hT,aR;function Gg(){if(aR)return hT;aR=1;var n=Object.keys||function(p){var g=[];for(var _ in p)g.push(_);return g};hT=c;var e=uO(),t=cO();c_()(c,e);for(var i=n(t.prototype),r=0;r<i.length;r++){var o=i[r];c.prototype[o]||(c.prototype[o]=t.prototype[o])}function c(p){if(!(this instanceof c))return new c(p);e.call(this,p),t.call(this,p),this.allowHalfOpen=!0,p&&(p.readable===!1&&(this.readable=!1),p.writable===!1&&(this.writable=!1),p.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",s)))}Object.defineProperty(c.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(c.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(c.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function s(){this._writableState.ended||process.nextTick(d,this)}function d(p){p.end()}return Object.defineProperty(c.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(g){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=g,this._writableState.destroyed=g)}}),hT}var dT={},Ob={exports:{}};var lR;function Wq(){return lR||(lR=1,(function(n,e){var t=Ad,i=t.Buffer;function r(c,s){for(var d in c)s[d]=c[d]}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?n.exports=t:(r(t,e),e.Buffer=o);function o(c,s,d){return i(c,s,d)}o.prototype=Object.create(i.prototype),r(i,o),o.from=function(c,s,d){if(typeof c=="number")throw new TypeError("Argument must not be a number");return i(c,s,d)},o.alloc=function(c,s,d){if(typeof c!="number")throw new TypeError("Argument must be a number");var p=i(c);return s!==void 0?typeof d=="string"?p.fill(s,d):p.fill(s):p.fill(0),p},o.allocUnsafe=function(c){if(typeof c!="number")throw new TypeError("Argument must be a number");return i(c)},o.allocUnsafeSlow=function(c){if(typeof c!="number")throw new TypeError("Argument must be a number");return t.SlowBuffer(c)}})(Ob,Ob.exports)),Ob.exports}var cR;function uR(){if(cR)return dT;cR=1;var n=Wq().Buffer,e=n.isEncoding||function(E){switch(E=""+E,E&&E.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function t(E){if(!E)return"utf8";for(var C;;)switch(E){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return E;default:if(C)return;E=(""+E).toLowerCase(),C=!0}}function i(E){var C=t(E);if(typeof C!="string"&&(n.isEncoding===e||!e(E)))throw new Error("Unknown encoding: "+E);return C||E}dT.StringDecoder=r;function r(E){this.encoding=i(E);var C;switch(this.encoding){case"utf16le":this.text=_,this.end=x,C=4;break;case"utf8":this.fillLast=d,C=4;break;case"base64":this.text=b,this.end=S,C=3;break;default:this.write=P,this.end=L;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(C)}r.prototype.write=function(E){if(E.length===0)return"";var C,D;if(this.lastNeed){if(C=this.fillLast(E),C===void 0)return"";D=this.lastNeed,this.lastNeed=0}else D=0;return D<E.length?C?C+this.text(E,D):this.text(E,D):C||""},r.prototype.end=g,r.prototype.text=p,r.prototype.fillLast=function(E){if(this.lastNeed<=E.length)return E.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);E.copy(this.lastChar,this.lastTotal-this.lastNeed,0,E.length),this.lastNeed-=E.length};function o(E){return E<=127?0:E>>5===6?2:E>>4===14?3:E>>3===30?4:E>>6===2?-1:-2}function c(E,C,D){var O=C.length-1;if(O<D)return 0;var U=o(C[O]);return U>=0?(U>0&&(E.lastNeed=U-1),U):--O<D||U===-2?0:(U=o(C[O]),U>=0?(U>0&&(E.lastNeed=U-2),U):--O<D||U===-2?0:(U=o(C[O]),U>=0?(U>0&&(U===2?U=0:E.lastNeed=U-3),U):0))}function s(E,C,D){if((C[0]&192)!==128)return E.lastNeed=0,"ï¿½";if(E.lastNeed>1&&C.length>1){if((C[1]&192)!==128)return E.lastNeed=1,"ï¿½";if(E.lastNeed>2&&C.length>2&&(C[2]&192)!==128)return E.lastNeed=2,"ï¿½"}}function d(E){var C=this.lastTotal-this.lastNeed,D=s(this,E);if(D!==void 0)return D;if(this.lastNeed<=E.length)return E.copy(this.lastChar,C,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);E.copy(this.lastChar,C,0,E.length),this.lastNeed-=E.length}function p(E,C){var D=c(this,E,C);if(!this.lastNeed)return E.toString("utf8",C);this.lastTotal=D;var O=E.length-(D-this.lastNeed);return E.copy(this.lastChar,0,O),E.toString("utf8",C,O)}function g(E){var C=E&&E.length?this.write(E):"";return this.lastNeed?C+"ï¿½":C}function _(E,C){if((E.length-C)%2===0){var D=E.toString("utf16le",C);if(D){var O=D.charCodeAt(D.length-1);if(O>=55296&&O<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=E[E.length-2],this.lastChar[1]=E[E.length-1],D.slice(0,-1)}return D}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=E[E.length-1],E.toString("utf16le",C,E.length-1)}function x(E){var C=E&&E.length?this.write(E):"";if(this.lastNeed){var D=this.lastTotal-this.lastNeed;return C+this.lastChar.toString("utf16le",0,D)}return C}function b(E,C){var D=(E.length-C)%3;return D===0?E.toString("base64",C):(this.lastNeed=3-D,this.lastTotal=3,D===1?this.lastChar[0]=E[E.length-1]:(this.lastChar[0]=E[E.length-2],this.lastChar[1]=E[E.length-1]),E.toString("base64",C,E.length-D))}function S(E){var C=E&&E.length?this.write(E):"";return this.lastNeed?C+this.lastChar.toString("base64",0,3-this.lastNeed):C}function P(E){return E.toString(this.encoding)}function L(E){return E&&E.length?this.write(E):""}return dT}var fT,hR;function mC(){if(hR)return fT;hR=1;var n=l_().codes.ERR_STREAM_PREMATURE_CLOSE;function e(o){var c=!1;return function(){if(!c){c=!0;for(var s=arguments.length,d=new Array(s),p=0;p<s;p++)d[p]=arguments[p];o.apply(this,d)}}}function t(){}function i(o){return o.setHeader&&typeof o.abort=="function"}function r(o,c,s){if(typeof c=="function")return r(o,null,c);c||(c={}),s=e(s||t);var d=c.readable||c.readable!==!1&&o.readable,p=c.writable||c.writable!==!1&&o.writable,g=function(){o.writable||x()},_=o._writableState&&o._writableState.finished,x=function(){p=!1,_=!0,d||s.call(o)},b=o._readableState&&o._readableState.endEmitted,S=function(){d=!1,b=!0,p||s.call(o)},P=function(D){s.call(o,D)},L=function(){var D;if(d&&!b)return(!o._readableState||!o._readableState.ended)&&(D=new n),s.call(o,D);if(p&&!_)return(!o._writableState||!o._writableState.ended)&&(D=new n),s.call(o,D)},E=function(){o.req.on("finish",x)};return i(o)?(o.on("complete",x),o.on("abort",L),o.req?E():o.on("request",E)):p&&!o._writableState&&(o.on("end",g),o.on("close",g)),o.on("end",S),o.on("finish",x),c.error!==!1&&o.on("error",P),o.on("close",L),function(){o.removeListener("complete",x),o.removeListener("abort",L),o.removeListener("request",E),o.req&&o.req.removeListener("finish",x),o.removeListener("end",g),o.removeListener("close",g),o.removeListener("finish",x),o.removeListener("end",S),o.removeListener("error",P),o.removeListener("close",L)}}return fT=r,fT}var pT,dR;function Hq(){if(dR)return pT;dR=1;var n;function e(D,O,U){return O=t(O),O in D?Object.defineProperty(D,O,{value:U,enumerable:!0,configurable:!0,writable:!0}):D[O]=U,D}function t(D){var O=i(D,"string");return typeof O=="symbol"?O:String(O)}function i(D,O){if(typeof D!="object"||D===null)return D;var U=D[Symbol.toPrimitive];if(U!==void 0){var q=U.call(D,O);if(typeof q!="object")return q;throw new TypeError("@@toPrimitive must return a primitive value.")}return(O==="string"?String:Number)(D)}var r=mC(),o=Symbol("lastResolve"),c=Symbol("lastReject"),s=Symbol("error"),d=Symbol("ended"),p=Symbol("lastPromise"),g=Symbol("handlePromise"),_=Symbol("stream");function x(D,O){return{value:D,done:O}}function b(D){var O=D[o];if(O!==null){var U=D[_].read();U!==null&&(D[p]=null,D[o]=null,D[c]=null,O(x(U,!1)))}}function S(D){process.nextTick(b,D)}function P(D,O){return function(U,q){D.then(function(){if(O[d]){U(x(void 0,!0));return}O[g](U,q)},q)}}var L=Object.getPrototypeOf(function(){}),E=Object.setPrototypeOf((n={get stream(){return this[_]},next:function(){var O=this,U=this[s];if(U!==null)return Promise.reject(U);if(this[d])return Promise.resolve(x(void 0,!0));if(this[_].destroyed)return new Promise(function(V,j){process.nextTick(function(){O[s]?j(O[s]):V(x(void 0,!0))})});var q=this[p],G;if(q)G=new Promise(P(q,this));else{var N=this[_].read();if(N!==null)return Promise.resolve(x(N,!1));G=new Promise(this[g])}return this[p]=G,G}},e(n,Symbol.asyncIterator,function(){return this}),e(n,"return",function(){var O=this;return new Promise(function(U,q){O[_].destroy(null,function(G){if(G){q(G);return}U(x(void 0,!0))})})}),n),L),C=function(O){var U,q=Object.create(E,(U={},e(U,_,{value:O,writable:!0}),e(U,o,{value:null,writable:!0}),e(U,c,{value:null,writable:!0}),e(U,s,{value:null,writable:!0}),e(U,d,{value:O._readableState.endEmitted,writable:!0}),e(U,g,{value:function(N,V){var j=q[_].read();j?(q[p]=null,q[o]=null,q[c]=null,N(x(j,!1))):(q[o]=N,q[c]=V)},writable:!0}),U));return q[p]=null,r(O,function(G){if(G&&G.code!=="ERR_STREAM_PREMATURE_CLOSE"){var N=q[c];N!==null&&(q[p]=null,q[o]=null,q[c]=null,N(G)),q[s]=G;return}var V=q[o];V!==null&&(q[p]=null,q[o]=null,q[c]=null,V(x(void 0,!0))),q[d]=!0}),O.on("readable",S.bind(null,q)),q};return pT=C,pT}var mT,fR;function Zq(){return fR||(fR=1,mT=function(){throw new Error("Readable.from is not available in the browser")}),mT}var gT,pR;function uO(){if(pR)return gT;pR=1,gT=V;var n;V.ReadableState=N,Ad.EventEmitter;var e=function(me,qe){return me.listeners(qe).length},t=oO(),i=Ad.Buffer,r=(typeof Og<"u"?Og:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function o(Se){return i.from(Se)}function c(Se){return i.isBuffer(Se)||Se instanceof r}var s=Ad,d;s&&s.debuglog?d=s.debuglog("stream"):d=function(){};var p=Gq(),g=aO(),_=lO(),x=_.getHighWaterMark,b=l_().codes,S=b.ERR_INVALID_ARG_TYPE,P=b.ERR_STREAM_PUSH_AFTER_EOF,L=b.ERR_METHOD_NOT_IMPLEMENTED,E=b.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,C,D,O;c_()(V,t);var U=g.errorOrDestroy,q=["error","close","destroy","pause","resume"];function G(Se,me,qe){if(typeof Se.prependListener=="function")return Se.prependListener(me,qe);!Se._events||!Se._events[me]?Se.on(me,qe):Array.isArray(Se._events[me])?Se._events[me].unshift(qe):Se._events[me]=[qe,Se._events[me]]}function N(Se,me,qe){n=n||Gg(),Se=Se||{},typeof qe!="boolean"&&(qe=me instanceof n),this.objectMode=!!Se.objectMode,qe&&(this.objectMode=this.objectMode||!!Se.readableObjectMode),this.highWaterMark=x(this,Se,"readableHighWaterMark",qe),this.buffer=new p,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=Se.emitClose!==!1,this.autoDestroy=!!Se.autoDestroy,this.destroyed=!1,this.defaultEncoding=Se.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,Se.encoding&&(C||(C=uR().StringDecoder),this.decoder=new C(Se.encoding),this.encoding=Se.encoding)}function V(Se){if(n=n||Gg(),!(this instanceof V))return new V(Se);var me=this instanceof n;this._readableState=new N(Se,this,me),this.readable=!0,Se&&(typeof Se.read=="function"&&(this._read=Se.read),typeof Se.destroy=="function"&&(this._destroy=Se.destroy)),t.call(this)}Object.defineProperty(V.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(me){this._readableState&&(this._readableState.destroyed=me)}}),V.prototype.destroy=g.destroy,V.prototype._undestroy=g.undestroy,V.prototype._destroy=function(Se,me){me(Se)},V.prototype.push=function(Se,me){var qe=this._readableState,st;return qe.objectMode?st=!0:typeof Se=="string"&&(me=me||qe.defaultEncoding,me!==qe.encoding&&(Se=i.from(Se,me),me=""),st=!0),j(this,Se,me,!1,st)},V.prototype.unshift=function(Se){return j(this,Se,null,!0,!1)};function j(Se,me,qe,st,Rt){d("readableAddChunk",me);var gt=Se._readableState;if(me===null)gt.reading=!1,le(Se,gt);else{var Ae;if(Rt||(Ae=Q(gt,me)),Ae)U(Se,Ae);else if(gt.objectMode||me&&me.length>0)if(typeof me!="string"&&!gt.objectMode&&Object.getPrototypeOf(me)!==i.prototype&&(me=o(me)),st)gt.endEmitted?U(Se,new E):z(Se,gt,me,!0);else if(gt.ended)U(Se,new P);else{if(gt.destroyed)return!1;gt.reading=!1,gt.decoder&&!qe?(me=gt.decoder.write(me),gt.objectMode||me.length!==0?z(Se,gt,me,!1):Ee(Se,gt)):z(Se,gt,me,!1)}else st||(gt.reading=!1,Ee(Se,gt))}return!gt.ended&&(gt.length<gt.highWaterMark||gt.length===0)}function z(Se,me,qe,st){me.flowing&&me.length===0&&!me.sync?(me.awaitDrain=0,Se.emit("data",qe)):(me.length+=me.objectMode?1:qe.length,st?me.buffer.unshift(qe):me.buffer.push(qe),me.needReadable&&ce(Se)),Ee(Se,me)}function Q(Se,me){var qe;return!c(me)&&typeof me!="string"&&me!==void 0&&!Se.objectMode&&(qe=new S("chunk",["string","Buffer","Uint8Array"],me)),qe}V.prototype.isPaused=function(){return this._readableState.flowing===!1},V.prototype.setEncoding=function(Se){C||(C=uR().StringDecoder);var me=new C(Se);this._readableState.decoder=me,this._readableState.encoding=this._readableState.decoder.encoding;for(var qe=this._readableState.buffer.head,st="";qe!==null;)st+=me.write(qe.data),qe=qe.next;return this._readableState.buffer.clear(),st!==""&&this._readableState.buffer.push(st),this._readableState.length=st.length,this};var X=1073741824;function re(Se){return Se>=X?Se=X:(Se--,Se|=Se>>>1,Se|=Se>>>2,Se|=Se>>>4,Se|=Se>>>8,Se|=Se>>>16,Se++),Se}function se(Se,me){return Se<=0||me.length===0&&me.ended?0:me.objectMode?1:Se!==Se?me.flowing&&me.length?me.buffer.head.data.length:me.length:(Se>me.highWaterMark&&(me.highWaterMark=re(Se)),Se<=me.length?Se:me.ended?me.length:(me.needReadable=!0,0))}V.prototype.read=function(Se){d("read",Se),Se=parseInt(Se,10);var me=this._readableState,qe=Se;if(Se!==0&&(me.emittedReadable=!1),Se===0&&me.needReadable&&((me.highWaterMark!==0?me.length>=me.highWaterMark:me.length>0)||me.ended))return d("read: emitReadable",me.length,me.ended),me.length===0&&me.ended?Je(this):ce(this),null;if(Se=se(Se,me),Se===0&&me.ended)return me.length===0&&Je(this),null;var st=me.needReadable;d("need readable",st),(me.length===0||me.length-Se<me.highWaterMark)&&(st=!0,d("length less than watermark",st)),me.ended||me.reading?(st=!1,d("reading or ended",st)):st&&(d("do read"),me.reading=!0,me.sync=!0,me.length===0&&(me.needReadable=!0),this._read(me.highWaterMark),me.sync=!1,me.reading||(Se=se(qe,me)));var Rt;return Se>0?Rt=Be(Se,me):Rt=null,Rt===null?(me.needReadable=me.length<=me.highWaterMark,Se=0):(me.length-=Se,me.awaitDrain=0),me.length===0&&(me.ended||(me.needReadable=!0),qe!==Se&&me.ended&&Je(this)),Rt!==null&&this.emit("data",Rt),Rt};function le(Se,me){if(d("onEofChunk"),!me.ended){if(me.decoder){var qe=me.decoder.end();qe&&qe.length&&(me.buffer.push(qe),me.length+=me.objectMode?1:qe.length)}me.ended=!0,me.sync?ce(Se):(me.needReadable=!1,me.emittedReadable||(me.emittedReadable=!0,be(Se)))}}function ce(Se){var me=Se._readableState;d("emitReadable",me.needReadable,me.emittedReadable),me.needReadable=!1,me.emittedReadable||(d("emitReadable",me.flowing),me.emittedReadable=!0,process.nextTick(be,Se))}function be(Se){var me=Se._readableState;d("emitReadable_",me.destroyed,me.length,me.ended),!me.destroyed&&(me.length||me.ended)&&(Se.emit("readable"),me.emittedReadable=!1),me.needReadable=!me.flowing&&!me.ended&&me.length<=me.highWaterMark,xe(Se)}function Ee(Se,me){me.readingMore||(me.readingMore=!0,process.nextTick($e,Se,me))}function $e(Se,me){for(;!me.reading&&!me.ended&&(me.length<me.highWaterMark||me.flowing&&me.length===0);){var qe=me.length;if(d("maybeReadMore read 0"),Se.read(0),qe===me.length)break}me.readingMore=!1}V.prototype._read=function(Se){U(this,new L("_read()"))},V.prototype.pipe=function(Se,me){var qe=this,st=this._readableState;switch(st.pipesCount){case 0:st.pipes=Se;break;case 1:st.pipes=[st.pipes,Se];break;default:st.pipes.push(Se);break}st.pipesCount+=1,d("pipe count=%d opts=%j",st.pipesCount,me);var Rt=(!me||me.end!==!1)&&Se!==process.stdout&&Se!==process.stderr,gt=Rt?we:Me;st.endEmitted?process.nextTick(gt):qe.once("end",gt),Se.on("unpipe",Ae);function Ae(ee,de){d("onunpipe"),ee===qe&&de&&de.hasUnpiped===!1&&(de.hasUnpiped=!0,ie())}function we(){d("onend"),Se.end()}var vt=Ve(qe);Se.on("drain",vt);var ye=!1;function ie(){d("cleanup"),Se.removeListener("close",Ze),Se.removeListener("finish",yt),Se.removeListener("drain",vt),Se.removeListener("error",ke),Se.removeListener("unpipe",Ae),qe.removeListener("end",we),qe.removeListener("end",Me),qe.removeListener("data",ae),ye=!0,st.awaitDrain&&(!Se._writableState||Se._writableState.needDrain)&&vt()}qe.on("data",ae);function ae(ee){d("ondata");var de=Se.write(ee);d("dest.write",de),de===!1&&((st.pipesCount===1&&st.pipes===Se||st.pipesCount>1&&xt(st.pipes,Se)!==-1)&&!ye&&(d("false write response, pause",st.awaitDrain),st.awaitDrain++),qe.pause())}function ke(ee){d("onerror",ee),Me(),Se.removeListener("error",ke),e(Se,"error")===0&&U(Se,ee)}G(Se,"error",ke);function Ze(){Se.removeListener("finish",yt),Me()}Se.once("close",Ze);function yt(){d("onfinish"),Se.removeListener("close",Ze),Me()}Se.once("finish",yt);function Me(){d("unpipe"),qe.unpipe(Se)}return Se.emit("pipe",qe),st.flowing||(d("pipe resume"),qe.resume()),Se};function Ve(Se){return function(){var qe=Se._readableState;d("pipeOnDrain",qe.awaitDrain),qe.awaitDrain&&qe.awaitDrain--,qe.awaitDrain===0&&e(Se,"data")&&(qe.flowing=!0,xe(Se))}}V.prototype.unpipe=function(Se){var me=this._readableState,qe={hasUnpiped:!1};if(me.pipesCount===0)return this;if(me.pipesCount===1)return Se&&Se!==me.pipes?this:(Se||(Se=me.pipes),me.pipes=null,me.pipesCount=0,me.flowing=!1,Se&&Se.emit("unpipe",this,qe),this);if(!Se){var st=me.pipes,Rt=me.pipesCount;me.pipes=null,me.pipesCount=0,me.flowing=!1;for(var gt=0;gt<Rt;gt++)st[gt].emit("unpipe",this,{hasUnpiped:!1});return this}var Ae=xt(me.pipes,Se);return Ae===-1?this:(me.pipes.splice(Ae,1),me.pipesCount-=1,me.pipesCount===1&&(me.pipes=me.pipes[0]),Se.emit("unpipe",this,qe),this)},V.prototype.on=function(Se,me){var qe=t.prototype.on.call(this,Se,me),st=this._readableState;return Se==="data"?(st.readableListening=this.listenerCount("readable")>0,st.flowing!==!1&&this.resume()):Se==="readable"&&!st.endEmitted&&!st.readableListening&&(st.readableListening=st.needReadable=!0,st.flowing=!1,st.emittedReadable=!1,d("on readable",st.length,st.reading),st.length?ce(this):st.reading||process.nextTick(He,this)),qe},V.prototype.addListener=V.prototype.on,V.prototype.removeListener=function(Se,me){var qe=t.prototype.removeListener.call(this,Se,me);return Se==="readable"&&process.nextTick(nt,this),qe},V.prototype.removeAllListeners=function(Se){var me=t.prototype.removeAllListeners.apply(this,arguments);return(Se==="readable"||Se===void 0)&&process.nextTick(nt,this),me};function nt(Se){var me=Se._readableState;me.readableListening=Se.listenerCount("readable")>0,me.resumeScheduled&&!me.paused?me.flowing=!0:Se.listenerCount("data")>0&&Se.resume()}function He(Se){d("readable nexttick read 0"),Se.read(0)}V.prototype.resume=function(){var Se=this._readableState;return Se.flowing||(d("resume"),Se.flowing=!Se.readableListening,De(this,Se)),Se.paused=!1,this};function De(Se,me){me.resumeScheduled||(me.resumeScheduled=!0,process.nextTick(ot,Se,me))}function ot(Se,me){d("resume",me.reading),me.reading||Se.read(0),me.resumeScheduled=!1,Se.emit("resume"),xe(Se),me.flowing&&!me.reading&&Se.read(0)}V.prototype.pause=function(){return d("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(d("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function xe(Se){var me=Se._readableState;for(d("flow",me.flowing);me.flowing&&Se.read()!==null;);}V.prototype.wrap=function(Se){var me=this,qe=this._readableState,st=!1;Se.on("end",function(){if(d("wrapped end"),qe.decoder&&!qe.ended){var Ae=qe.decoder.end();Ae&&Ae.length&&me.push(Ae)}me.push(null)}),Se.on("data",function(Ae){if(d("wrapped data"),qe.decoder&&(Ae=qe.decoder.write(Ae)),!(qe.objectMode&&Ae==null)&&!(!qe.objectMode&&(!Ae||!Ae.length))){var we=me.push(Ae);we||(st=!0,Se.pause())}});for(var Rt in Se)this[Rt]===void 0&&typeof Se[Rt]=="function"&&(this[Rt]=(function(we){return function(){return Se[we].apply(Se,arguments)}})(Rt));for(var gt=0;gt<q.length;gt++)Se.on(q[gt],this.emit.bind(this,q[gt]));return this._read=function(Ae){d("wrapped _read",Ae),st&&(st=!1,Se.resume())},this},typeof Symbol=="function"&&(V.prototype[Symbol.asyncIterator]=function(){return D===void 0&&(D=Hq()),D(this)}),Object.defineProperty(V.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(V.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(V.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(me){this._readableState&&(this._readableState.flowing=me)}}),V._fromList=Be,Object.defineProperty(V.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function Be(Se,me){if(me.length===0)return null;var qe;return me.objectMode?qe=me.buffer.shift():!Se||Se>=me.length?(me.decoder?qe=me.buffer.join(""):me.buffer.length===1?qe=me.buffer.first():qe=me.buffer.concat(me.length),me.buffer.clear()):qe=me.buffer.consume(Se,me.decoder),qe}function Je(Se){var me=Se._readableState;d("endReadable",me.endEmitted),me.endEmitted||(me.ended=!0,process.nextTick(ct,me,Se))}function ct(Se,me){if(d("endReadableNT",Se.endEmitted,Se.length),!Se.endEmitted&&Se.length===0&&(Se.endEmitted=!0,me.readable=!1,me.emit("end"),Se.autoDestroy)){var qe=me._writableState;(!qe||qe.autoDestroy&&qe.finished)&&me.destroy()}}typeof Symbol=="function"&&(V.from=function(Se,me){return O===void 0&&(O=Zq()),O(V,Se,me)});function xt(Se,me){for(var qe=0,st=Se.length;qe<st;qe++)if(Se[qe]===me)return qe;return-1}return gT}var _T,mR;function hO(){if(mR)return _T;mR=1,_T=s;var n=l_().codes,e=n.ERR_METHOD_NOT_IMPLEMENTED,t=n.ERR_MULTIPLE_CALLBACK,i=n.ERR_TRANSFORM_ALREADY_TRANSFORMING,r=n.ERR_TRANSFORM_WITH_LENGTH_0,o=Gg();c_()(s,o);function c(g,_){var x=this._transformState;x.transforming=!1;var b=x.writecb;if(b===null)return this.emit("error",new t);x.writechunk=null,x.writecb=null,_!=null&&this.push(_),b(g);var S=this._readableState;S.reading=!1,(S.needReadable||S.length<S.highWaterMark)&&this._read(S.highWaterMark)}function s(g){if(!(this instanceof s))return new s(g);o.call(this,g),this._transformState={afterTransform:c.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,g&&(typeof g.transform=="function"&&(this._transform=g.transform),typeof g.flush=="function"&&(this._flush=g.flush)),this.on("prefinish",d)}function d(){var g=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(_,x){p(g,_,x)}):p(this,null,null)}s.prototype.push=function(g,_){return this._transformState.needTransform=!1,o.prototype.push.call(this,g,_)},s.prototype._transform=function(g,_,x){x(new e("_transform()"))},s.prototype._write=function(g,_,x){var b=this._transformState;if(b.writecb=x,b.writechunk=g,b.writeencoding=_,!b.transforming){var S=this._readableState;(b.needTransform||S.needReadable||S.length<S.highWaterMark)&&this._read(S.highWaterMark)}},s.prototype._read=function(g){var _=this._transformState;_.writechunk!==null&&!_.transforming?(_.transforming=!0,this._transform(_.writechunk,_.writeencoding,_.afterTransform)):_.needTransform=!0},s.prototype._destroy=function(g,_){o.prototype._destroy.call(this,g,function(x){_(x)})};function p(g,_,x){if(_)return g.emit("error",_);if(x!=null&&g.push(x),g._writableState.length)throw new r;if(g._transformState.transforming)throw new i;return g.push(null)}return _T}var vT,gR;function Xq(){if(gR)return vT;gR=1,vT=e;var n=hO();c_()(e,n);function e(t){if(!(this instanceof e))return new e(t);n.call(this,t)}return e.prototype._transform=function(t,i,r){r(null,t)},vT}var yT,_R;function Yq(){if(_R)return yT;_R=1;var n;function e(x){var b=!1;return function(){b||(b=!0,x.apply(void 0,arguments))}}var t=l_().codes,i=t.ERR_MISSING_ARGS,r=t.ERR_STREAM_DESTROYED;function o(x){if(x)throw x}function c(x){return x.setHeader&&typeof x.abort=="function"}function s(x,b,S,P){P=e(P);var L=!1;x.on("close",function(){L=!0}),n===void 0&&(n=mC()),n(x,{readable:b,writable:S},function(C){if(C)return P(C);L=!0,P()});var E=!1;return function(C){if(!L&&!E){if(E=!0,c(x))return x.abort();if(typeof x.destroy=="function")return x.destroy();P(C||new r("pipe"))}}}function d(x){x()}function p(x,b){return x.pipe(b)}function g(x){return!x.length||typeof x[x.length-1]!="function"?o:x.pop()}function _(){for(var x=arguments.length,b=new Array(x),S=0;S<x;S++)b[S]=arguments[S];var P=g(b);if(Array.isArray(b[0])&&(b=b[0]),b.length<2)throw new i("streams");var L,E=b.map(function(C,D){var O=D<b.length-1,U=D>0;return s(C,O,U,function(q){L||(L=q),q&&E.forEach(d),!O&&(E.forEach(d),P(L))})});return b.reduce(p)}return yT=_,yT}var vR;function Kq(){return vR||(vR=1,(function(n,e){e=n.exports=uO(),e.Stream=e,e.Readable=e,e.Writable=cO(),e.Duplex=Gg(),e.Transform=hO(),e.PassThrough=Xq(),e.finished=mC(),e.pipeline=Yq()})(Db,Db.exports)),Db.exports}var yR;function Jq(){if(yR)return Mv.exports;yR=1;var n=Kq().Transform,e=c_();function t(o){n.call(this,o),this._destroyed=!1}e(t,n),t.prototype.destroy=function(o){if(!this._destroyed){this._destroyed=!0;var c=this;process.nextTick(function(){o&&c.emit("error",o),c.emit("close")})}};function i(o,c,s){s(null,o)}function r(o){return function(c,s,d){return typeof c=="function"&&(d=s,s=c,c={}),typeof s!="function"&&(s=i),typeof d!="function"&&(d=null),o(c,s,d)}}return Mv.exports=r(function(o,c,s){var d=new t(o);return d._transform=c,s&&(d._flush=s),d}),Mv.exports.ctor=r(function(o,c,s){function d(p){if(!(this instanceof d))return new d(p);this.options=Object.assign({},o,p),t.call(this,this.options)}return e(d,t),d.prototype._transform=c,s&&(d.prototype._flush=s),d}),Mv.exports.obj=r(function(o,c,s){var d=new t(Object.assign({objectMode:!0,highWaterMark:16},o));return d._transform=c,s&&(d._flush=s),d}),Mv.exports}Jq();function zb(n,e){for(const t of n.children)t.tagName==="tag"&&e.addTag(t.attributes.k,t.attributes.v)}function Qq(n,e){const t=Vq(n,{noChildNodes:[]});for(const i of t)if(i.tagName==="osm")for(const r of i.children){if(r.children.find(o=>["point","vertex","linestring","group"].includes(o.tagName))){const o=new iO(r.tagName,r.attributes.id,e);o.addMetas(Jf(r.attributes,["id","type","tags","geometry"])),zb(r,o);const c=[],s=[];for(const d of r.children)switch(d.tagName){case"point":o.setGeometry({type:"Point",coordinates:[parseFloat(d.attributes.lon),parseFloat(d.attributes.lat)]});break;case"vertex":c.push([parseFloat(d.attributes.lon),parseFloat(d.attributes.lat)]);break;case"linestring":const p=[];for(const _ of d.children)p.push([parseFloat(_.attributes.lon),parseFloat(_.attributes.lat)]);o.setGeometry({type:"Polygon",coordinates:[p]});break;case"group":const g=[];for(const _ of d.children)switch(_.tagName){case"point":s.push({type:"Point",coordinates:[parseFloat(_.attributes.lon),parseFloat(_.attributes.lat)]});break;case"vertex":g.push([parseFloat(_.attributes.lon),parseFloat(_.attributes.lat)]);break}g.length>0&&s.push({type:"LineString",coordinates:g});break}c.length>0?o.setGeometry({type:"LineString",coordinates:c}):s.length>0&&o.setGeometry({type:"GeometryCollection",geometries:s});continue}switch(r.tagName){case"node":const o=new pC(r.attributes.id,e);zb(r,o),o.addMetas(Jf(r.attributes,["id","lon","lat"])),o.setLatLng(r.attributes);break;case"way":const c=new bw(r.attributes.id,e);zb(r,c),c.addMetas(Jf(r.attributes,["id","type"]));for(const d of r.children)switch(d.tagName){case"center":c.setCenter(d.attributes);break;case"nd":d.attributes.lon&&d.attributes.lat?c.addLatLng(d.attributes):c.addNodeRef(d.attributes.ref);break}break;case"relation":const s=new nO(r.attributes.id,e);zb(r,s);for(const d of r.children)switch(d.tagName){case"center":s.setCenter(d.attributes);break;case"member":const p={type:d.attributes.type,role:d.attributes.role||"",ref:d.attributes.ref};if(d.attributes.type==="node"&&d.attributes.lon&&d.attributes.lat)p.lon=d.attributes.lon,p.lat=d.attributes.lat;else{const g=[],_=[];for(const x of d.children)x.attributes.lon&&x.attributes.lat?g.push(x.attributes):x.attributes.ref&&_.push(x.attributes.ref);g.length>0?p.geometry=g:_.length>0&&(p.nodes=_)}s.addMember(p);break;case"bounds":s.setBounds([parseFloat(d.attributes.minlon),parseFloat(d.attributes.minlat),parseFloat(d.attributes.maxlon),parseFloat(d.attributes.maxlat)]);break}break}}}function e7(n){return n?{elementId:n.elementId}:{elementId:void 0}}function t7(n){return n.elements?"json":n.indexOf("<osm")>=0?"xml":n.trim().startsWith("{")?"json-raw":"invalid"}function i7(n,e){var t;let{elementId:i}=e7(e),r=t7(n);const o=new dq;if(r==="json-raw"&&(n=JSON.parse(n),n.elements?r="json":r="invalid"),r==="json"?$q(n,o):r==="xml"&&Qq(n,o),o.bindAll(),i)return(t=o.get(i))===null||t===void 0?void 0:t.toFeature();let c=[];for(const s of o.values()){if(s.refCount>0&&!s.hasTag)continue;const d=s.toFeature();d&&c.push(d)}return{type:"FeatureCollection",features:c}}async function n7(n){const e=`[out:json]; relation(${n}); out geom;`,i=await(await t1(e)).json();if(!i.elements||i.elements.length===0)throw new Error(`Relation ${n} not found`);if(i.elements[0].type!=="relation")throw new Error(`Object ${n} is not a relation`);const o=i7(i,{elementId:`relation/${n}`});return!o||!("geometry"in o)?null:o.geometry}function r7(n){const e=Ug(n),t=hq(e);if(!t||t.geometry.type!=="Polygon")throw new Error("Failed to create convex hull");return t}async function s7(n){const e=await n7(n);if(!e)throw new Error("Relation has no geometry");await sl();const t=r7(e);await sl();const r=await(await t1(fC(t))).bytes();await sl(),zs.set(new Ly(new Uint8Array(r),t))}var o7=qt('<!> <div class="mt-3"><p class="fst-italic my-3">orâ¦</p> <div class="mb-2"><label for="relation-id" class="form-label">Load from relation ID</label> <div class="input-group"><input id="relation-id" type="text" inputmode="numeric" pattern="[0-9]*" class="form-control" placeholder="e.g., 1310102"/> <button class="btn btn-primary" type="button">Load</button></div></div></div>',1);function a7(n,e){Qi(e,!0);let t=ii(""),i=ii(""),r=Kt(()=>{const b=te(t).trim(),S=parseInt(b);return b!==""&&!isNaN(S)&&S>0});async function o(){const b=parseInt(te(t).trim());if(!b||b<=0){window.alert("Please enter a valid relation ID");return}try{Ct(i,"Loading relation..."),await s7(b),e.onSuccess?.()}catch(S){window.alert(`Failed to load relation: ${S}`)}finally{Ct(i,"")}}var c=o7(),s=ci(c);Yd(s,{get loading(){return te(i)}});var d=_t(s,2),p=_t(zt(d),2),g=_t(zt(p),2),_=zt(g);_.__keydown=b=>{b.key==="Enter"&&te(r)&&o()};var x=_t(_,2);x.__click=o,Zi(()=>x.disabled=!te(r)),Zw("paste",_,b=>{setTimeout(()=>{Ct(t,te(t).trim(),!0)},0)}),Sg(_,()=>te(t),b=>Ct(t,b)),bt(n,c),en()}ds(["keydown","click"]);var l7=qt("<!> <!>",1);function c7(n,e){Qi(e,!0);const t=()=>nn(zs,"$backend",r),i=()=>nn(Dh,"$map",r),[r,o]=is();let c=ii("");async function s(x,b){try{Ct(c,"Importing OSM data"),await sl(),ia(zs,new Ly(x,b)),d()}catch(S){window.alert(`Bad OSM input: ${S}`)}finally{Ct(c,"")}}function d(){i().fitBounds(HF(JSON.parse(t().getNodes())),{animate:!1,padding:10})}var p=l7(),g=ci(p);Yd(g,{get loading(){return te(c)}});var _=_t(g,2);l0(_,{left:S=>{DG(S,{get map(){return i()},onloading:P=>Ct(c,P,!0),onload:s,onerror:P=>{window.alert(P),Ct(c,"")},children:(P,L)=>{a7(P,{onSuccess:d})},$$slots:{default:!0}})},main:S=>{IU(S)},$$slots:{left:!0,main:!0}}),bt(n,p),en(),o()}const u7="/speedwalk/assets/favicon-DMAVMD4u.ico",h7="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAApElEQVRIS+XUQQqAIBAFUOcgnaEIul/tO1kQdYau0AHsC64y4n9BIWozG/lPx0lzhT8rnO9+BnjvZ7T0NLOJbS3dIoQ3CD1i8MgiNBCCgbQou4JIQEQ61I1FZCAiPerKIFmAgmQDERlQl7eTJAAu0rMj+LAuma76gLJ7HFZvEQsgnJqkrEtmw8NmZQDh5X40NVw6Qa3HrtxzzU7XfZ18ySr0feACKA1QGcdX8MgAAAAASUVORK5CYII=",d7="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAu0lEQVRIS2NkoDFgpLH5DKMWEAxhUoOoHmpiI0GToQpIsQBkeANUH4gmyhJiLUA2HOZ4oiwhxgJkw42gpp8j1ieELEA23ABo6EWowfpA+gIxluCzANlwPaBhl9EiVhfIv0TIEnwWlAM1dwCxJhDfgBqEnoq0gOJXgbgCiDuxpSxCQSQA1PQByXBsqQhZDYYdhCyAaRhNRVgz/oCkInSXUDUVYfUmUJAqqQiX4QTFiU2mBA3CpWDUAoJBBwDGtiwZhFZ9ZQAAAABJRU5ErkJggg==";var f7=qt('<div><button class="btn btn-danger mb-3"> </button></div>'),p7=qt(`<h1>Customize basemaps</h1> <!> <div class="card"><div class="card-header">Add a basemap</div> <div class="card-body"><p>You can add custom basemaps if you know a tile URL and that the imagery
        has a license allowing it to be used for editing OSM.</p> <ul><li><a href="https://github.com/osmlab/editor-layer-index" target="_blank">editor-layer-index</a> is a great reference, or you could check in iD or JOSM and figure out which
          one you like to use for your area.</li> <li>If you copy a URL from there, you may need to manually substitute some
          parts of the URL to make it work.</li> <li><b>&lbrace;zoom&rbrace;</b> &rarr; <b>&lbrace;z&rbrace;</b></li> <li><b>&lbrace;proj&rbrace;</b> &rarr; <b>&lbrace;EPSG:3857&rbrace;</b></li> <li><b>&lbrace;width&rbrace;</b> &rarr; <b>256</b></li> <li><b>&lbrace;height&rbrace;</b> &rarr; <b>256</b></li> <li><b>&lbrace;bbox&rbrace;</b> &rarr; <b>&lbrace;bbox-epsg-3857&rbrace;</b></li> <li>Some sources have CORS restrictions and won't work</li></ul> <div><label class="form-label">Name: <input class="form-control" type="text"/></label></div> <div><label class="form-label">Tile URL: <textarea class="form-control" rows="3" cols="80"></textarea></label></div> <div><label class="form-label">Attribution: <input class="form-control" type="text"/></label></div> <button class="btn btn-primary">Add basemap</button></div></div> <div class="mt-5"><button class="btn btn-primary">Done</button></div>`,1);function m7(n,e){Qi(e,!0);let t=ft(e,"show",15),i="speedwalk-custom-basemaps",r=ii(Ss(JSON.parse(window.localStorage.getItem(i)||"[]")));for(let _ of te(r))rp.set(_.name,d(_.tileURL,_.attribution));let o=ii(""),c=ii(""),s=ii("");function d(_,x){return{version:8,sources:{"raster-tiles":{type:"raster",tiles:[_],tileSize:256,attribution:x}},layers:[{id:"raster-basemap",type:"raster",source:"raster-tiles"},{id:"Road labels",type:"background",layout:{visibility:"none"}}],glyphs:"https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=MZEJTanw3WpxRvt7qDfo"}}function p(){te(r).push({name:te(o),tileURL:te(c),attribution:te(s)}),window.localStorage.setItem(i,JSON.stringify(te(r))),rp.set(te(o),d(te(c),te(s))),Ct(o,""),Ct(c,""),Ct(s,"")}function g(_){Ct(r,te(r).filter(x=>x.name!=_),!0),window.localStorage.setItem(i,JSON.stringify(te(r))),rp.delete(_)}gp(n,{get show(){return t()},set show(_){t(_)},children:(_,x)=>{var b=p7(),S=_t(ci(b),2);ws(S,17,()=>te(r),xs,(X,re)=>{var se=f7(),le=zt(se);le.__click=()=>g(te(re).name);var ce=zt(le);Zi(()=>sn(ce,`Remove ${te(re).name??""}`)),bt(X,se)});var P=_t(S,2),L=_t(zt(P),2),E=_t(zt(L),4),C=zt(E),D=_t(zt(C)),O=_t(E,2),U=zt(O),q=_t(zt(U)),G=_t(O,2),N=zt(G),V=_t(zt(N)),j=_t(G,2);j.__click=p;var z=_t(P,2),Q=zt(z);Q.__click=()=>t(!1),Zi(()=>j.disabled=!te(o)||!te(c)||!te(s)),Sg(D,()=>te(o),X=>Ct(o,X)),Sg(q,()=>te(c),X=>Ct(c,X)),Sg(V,()=>te(s),X=>Ct(s,X)),bt(_,b)},$$slots:{default:!0}}),en()}ds(["click"]);var g7=qt('<li><button type="button"> </button></li>'),_7=qt('<li><button type="button"> </button></li>'),v7=qt('<li><hr class="dropdown-divider"/></li> <!>',1),y7=qt('<div class="basemap-selector svelte-1589rj1"><div class="btn-group"><button class="btn btn-outline-secondary dropdown-toggle basemap-button svelte-1589rj1" type="button" data-bs-toggle="dropdown" aria-expanded="false"> </button> <ul class="dropdown-menu"><!> <!> <li><hr class="dropdown-divider"/></li> <li><button class="dropdown-item" type="button"><i class="fa-solid fa-square-plus me-2"></i> Add custom basemap</button></li></ul></div></div> <!>',1);function b7(n,e){Qi(e,!0);let t=ft(e,"basemap",15),i=ii(!1),r=Kt(()=>[...rp.keys().filter(E=>!GI.has(E))]);var o=y7(),c=ci(o),s=zt(c),d=zt(s),p=zt(d),g=_t(d,2),_=zt(g);ws(_,17,()=>GI,xs,(E,C)=>{var D=g7(),O=zt(D);let U;O.__click=()=>t(te(C));var q=zt(O);Zi(()=>{U=fp(O,1,"dropdown-item",null,U,{active:t()===te(C)}),sn(q,te(C))}),bt(E,D)});var x=_t(_,2);{var b=E=>{var C=v7(),D=_t(ci(C),2);ws(D,17,()=>te(r),xs,(O,U)=>{var q=_7(),G=zt(q);let N;G.__click=()=>t(te(U));var V=zt(G);Zi(()=>{N=fp(G,1,"dropdown-item",null,N,{active:t()===te(U)}),sn(V,te(U))}),bt(O,q)}),bt(E,C)};Ji(x,E=>{te(r).length>0&&E(b)})}var S=_t(x,4),P=zt(S);P.__click=()=>Ct(i,!0);var L=_t(c,2);m7(L,{get show(){return te(i)},set show(E){Ct(i,E,!0)}}),Zi(()=>sn(p,t())),bt(n,o),en()}ds(["click"]);function dO(n){if(!n)return null;const e=n.getCenter();return{lat:e.lat,lng:e.lng,zoom:n.getZoom()}}function x7(n,e,t){const i=new URLSearchParams;return i.append("map",`${Math.round(n)}/${e.toFixed(6)}/${t.toFixed(6)}`),`https://www.openstreetmap.org/#${i.toString()}`}function fO(n,e,t){const i=new URLSearchParams;return i.append("map",`${Math.round(n)}/${e.toFixed(6)}/${t.toFixed(6)}`),`https://www.openstreetmap.org/edit?editor=id#${i.toString()}`}function w7(n,e,t){const i=new URLSearchParams;return i.append("map",`${Math.round(n)}/${e.toFixed(6)}/${t.toFixed(6)}`),i.append("disable_features","boundaries"),i.append("hashtags","Speedwalk"),`https://kyle.kiwi/iD/#${i.toString()}`}function S7(n,e,t){const i=new URLSearchParams;return i.append("map",`${Math.round(n)}/${e.toFixed(6)}/${t.toFixed(6)}`),i.append("disable_features","boundaries"),i.append("hashtags","Speedwalk"),`https://rapideditor.org/edit#${i.toString()}`}function T7(n,e,t,i){return`http://127.0.0.1:8111/load_and_zoom?left=${n.toFixed(6)}&right=${e.toFixed(6)}&top=${t.toFixed(6)}&bottom=${i.toFixed(6)}`}function M7(n){const e=n.getBounds();return T7(e.getWest(),e.getEast(),e.getNorth(),e.getSouth())}function C7(n,e,t){const i=new URL("https://www.mapillary.com/app/");return i.searchParams.set("lat",String(e)),i.searchParams.set("lng",String(t)),i.searchParams.set("z",String(Math.round(n))),i.toString()}var E7=qt('<li><a class="dropdown-item" href="#"> </a></li>'),A7=qt('<div class="btn-group"><button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" title="Open in OSM editors"><i class="fa-solid fa-pen"></i></button> <ul class="dropdown-menu"></ul></div>');function P7(n,e){Qi(e,!1);const t=()=>nn(Dh,"$map",i),[i,r]=is(),o=["OSM","iD","Kiwid","Rapid","JOSM","Mapillary"];function c(p){const g=dO(t());if(!(!t()||!g))return{OSM:x7(g.zoom,g.lat,g.lng),iD:fO(g.zoom,g.lat,g.lng),Kiwid:w7(g.zoom,g.lat,g.lng),Rapid:S7(g.zoom,g.lat,g.lng),JOSM:M7(t()),Mapillary:C7(g.zoom,g.lat,g.lng)}[p]}Xw();var s=A7(),d=_t(zt(s),2);ws(d,5,()=>o,xs,(p,g)=>{var _=E7(),x=zt(_);x.__click=S=>{S.preventDefault(),window.open(c(te(g)),"_blank","noopener,noreferrer")};var b=zt(x);Zi(()=>sn(b,te(g))),bt(p,_)}),bt(n,s),en(),r()}ds(["click"]);var I7=qt('<h2>Report a problem</h2> <p>Done, thank you for submitting. <!></p> <button class="btn btn-primary">OK</button>',1),R7=qt('<img alt="Screenshot" class="svelte-10dd0dj"/>'),L7=qt("<p>Loading screenshot... (sometimes you have to cancel and try again)</p>"),k7=qt('<div class="img-container mb-3 svelte-10dd0dj"><!></div>'),D7=qt('<button class="btn btn-primary me-3" disabled><div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div> Submit report</button>'),F7=qt('<button class="btn btn-primary me-3">Submit report</button>'),O7=qt(`<div class="d-flex justify-content-between"><h2>Report a problem</h2> <button class="btn-close" aria-label="Close"></button></div> <p>You can report a problem with Speedwalk.</p> <fieldset class="mb-3"><legend>Please describe the problem <br/> (if it's not obvious from the screenshot below)</legend> <textarea class="form-control" rows="4" placeholder="Details"></textarea></fieldset> <!> <!> <!> <div class="d-flex"><!> <button class="btn btn-secondary">Cancel</button></div>`,1),z7=qt("<!> <!>",1);function B7(n,e){Qi(e,!0);const t=()=>nn(Dh,"$map",r),i=()=>nn(dy,"$loggedInUser",r),[r,o]=is();let c=ii(!1),s=ii(!1),d=ii(!1);function p(){t()&&E()}let g=ii(""),_=ii(Ss({})),x=ii(!1),b=ii(!0),S=ii(void 0),P=ii(void 0),L=Kt(()=>te(g)||te(P));async function E(){Ct(c,!0),Ct(_,{url:window.location.toString(),viewport:q(t())},!0),Ct(S,await O(t()),!0),Ct(P,URL.createObjectURL(te(S)),!0)}async function C(){let Q=null;te(x)&&i()&&(Q=i().name);let X=null;te(b)&&te(S)&&(X=await U(te(S)));let re={...te(_),details:te(g),screenshot:X,username:Q};try{Ct(s,!0);let se=await fetch("https://walknet.abstreet.uk/problems/speedwalk_problems",{method:"POST",body:JSON.stringify(re),headers:{"Content-Type":"application/json"}});if(!se.ok)throw new Error(`Bad response: ${se.status}`)}catch(se){window.alert(`Failed to report a problem: ${se}`),Ct(s,!1);return}Ct(s,!1),D(),Ct(d,!0)}function D(){Ct(c,!1),Ct(g,""),Ct(_,{},!0),Ct(S,void 0),te(P)&&(URL.revokeObjectURL(te(P)),Ct(P,void 0))}function O(Q){return new Promise((X,re)=>{Q.redraw(),Q.once("idle",()=>{Q.getCanvas().toBlob(se=>{se?X(se):re("no blob")})})})}function U(Q){return new Promise((X,re)=>{let se=new FileReader;se.readAsDataURL(Q),se.onloadend=function(){se.result?X(se.result):re("base64 failed")}})}function q(Q){let X=Q.getCenter(),re=Math.round(Q.getZoom()*100)/100,se=Math.ceil((re*Math.LN2+Math.log(512/360/.5))/Math.LN10),le=Math.pow(10,se),ce=Math.round(X.lat*le)/le,be=Math.round(X.lng*le)/le,Ee=`${re}/${ce}/${be}`,$e=Q.getBearing(),Ve=Q.getPitch();return($e||Ve)&&(Ee+=`/${Math.round($e*10)/10}`),Ve&&(Ee+=`/${Math.round(Ve)}`),`#${Ee}`}var G={triggerStart:p},N=z7(),V=ci(N);gp(V,{get show(){return te(d)},set show(Q){Ct(d,Q,!0)},children:(Q,X)=>{var re=I7(),se=_t(ci(re),2),le=_t(zt(se));{var ce=Ee=>{var $e=Nn("You may be contacted later when this problem has been fixed.");bt(Ee,$e)};Ji(le,Ee=>{te(x)&&i()&&Ee(ce)})}var be=_t(se,2);be.__click=()=>Ct(d,!1),bt(Q,re)},$$slots:{default:!0}});var j=_t(V,2);gp(j,{closeable:!1,get show(){return te(c)},set show(Q){Ct(c,Q,!0)},children:(Q,X)=>{var re=O7(),se=ci(re),le=_t(zt(se),2);le.__click=D;var ce=_t(se,4),be=_t(zt(ce),2),Ee=_t(ce,2);ls(Ee,{get checked(){return te(b)},set checked(ct){Ct(b,ct,!0)},children:(ct,xt)=>{var Se=Nn("Include screenshot");bt(ct,Se)},$$slots:{default:!0}});var $e=_t(Ee,2);{var Ve=ct=>{ls(ct,{get checked(){return te(x)},set checked(xt){Ct(x,xt,!0)},children:(xt,Se)=>{var me=Nn();Zi(()=>sn(me,`Include your OSM username (${i().name??""}) in the report and be
      contacted when the problem is fixed`)),bt(xt,me)},$$slots:{default:!0}})};Ji($e,ct=>{i()&&ct(Ve)})}var nt=_t($e,2);{var He=ct=>{var xt=k7(),Se=zt(xt);{var me=st=>{var Rt=R7();Zi(()=>Bl(Rt,"src",te(P))),bt(st,Rt)},qe=st=>{var Rt=L7();bt(st,Rt)};Ji(Se,st=>{te(P)?st(me):st(qe,!1)})}bt(ct,xt)};Ji(nt,ct=>{te(b)&&ct(He)})}var De=_t(nt,2),ot=zt(De);{var xe=ct=>{var xt=D7();bt(ct,xt)},Be=ct=>{var xt=F7();xt.__click=C,Zi(()=>xt.disabled=!te(L)),bt(ct,xt)};Ji(ot,ct=>{te(s)?ct(xe):ct(Be,!1)})}var Je=_t(ot,2);Je.__click=D,Sg(be,()=>te(g),ct=>Ct(g,ct)),bt(Q,re)},$$slots:{default:!0}}),bt(n,N);var z=en(G);return o(),z}ds(["click"]);var N7=qt('<div class="report-problem-wrapper svelte-1f4xae4"><button class="btn btn-secondary report-problem-btn svelte-1f4xae4"><i class="fa-solid fa-triangle-exclamation"></i> <span class="report-problem-text svelte-1f4xae4">Report problem</span></button></div>'),$7=qt("<!> <!>",1);function V7(n){const e=()=>nn(Dh,"$map",t),[t,i]=is();let r=ii(null);var o=$7(),c=ci(o);{var s=p=>{var g=N7(),_=zt(g);_.__click=()=>{te(r)?.triggerStart()},bt(p,g)};Ji(c,p=>{e()&&p(s)})}var d=_t(c,2);wc(B7(d,{}),p=>Ct(r,p,!0),()=>te(r)),bt(n,o),i()}ds(["click"]);var YM=function(n,e){return YM=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])},YM(n,e)};function Pc(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");YM(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function U7(n,e,t,i){function r(o){return o instanceof t?o:new t(function(c){c(o)})}return new(t||(t=Promise))(function(o,c){function s(g){try{p(i.next(g))}catch(_){c(_)}}function d(g){try{p(i.throw(g))}catch(_){c(_)}}function p(g){g.done?o(g.value):r(g.value).then(s,d)}p((i=i.apply(n,[])).next())})}function pO(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,r,o,c;return c={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function s(p){return function(g){return d([p,g])}}function d(p){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,r&&(o=p[0]&2?r.return:p[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,p[1])).done)return o;switch(r=0,o&&(p=[p[0]&2,o.value]),p[0]){case 0:case 1:o=p;break;case 4:return t.label++,{value:p[1],done:!1};case 5:t.label++,r=p[1],p=[0];continue;case 7:p=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(p[0]===6||p[0]===2)){t=0;continue}if(p[0]===3&&(!o||p[1]>o[0]&&p[1]<o[3])){t.label=p[1];break}if(p[0]===6&&t.label<o[1]){t.label=o[1],o=p;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(p);break}o[2]&&t.ops.pop(),t.trys.pop();continue}p=e.call(n,t)}catch(g){p=[6,g],r=0}finally{i=o=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}}function du(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ac(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var i=t.call(n),r,o=[],c;try{for(;(e===void 0||e-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(s){c={error:s}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(c)throw c.error}}return o}function gu(n,e){for(var t=0,i=e.length,r=n.length;t<i;t++,r++)n[r]=e[t];return n}function Ag(n){return this instanceof Ag?(this.v=n,this):new Ag(n)}function j7(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(n,e||[]),r,o=[];return r={},c("next"),c("throw"),c("return"),r[Symbol.asyncIterator]=function(){return this},r;function c(x){i[x]&&(r[x]=function(b){return new Promise(function(S,P){o.push([x,b,S,P])>1||s(x,b)})})}function s(x,b){try{d(i[x](b))}catch(S){_(o[0][3],S)}}function d(x){x.value instanceof Ag?Promise.resolve(x.value.v).then(p,g):_(o[0][2],x)}function p(x){s("next",x)}function g(x){s("throw",x)}function _(x,b){x(b),o.shift(),o.length&&s(o[0][0],o[0][1])}}function G7(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof du=="function"?du(n):n[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(o){t[o]=n[o]&&function(c){return new Promise(function(s,d){c=n[o](c),r(s,d,c.done,c.value)})}}function r(o,c,s,d){Promise.resolve(d).then(function(p){o({value:p,done:s})},c)}}function Fn(n){return typeof n=="function"}function r1(n){var e=function(i){Error.call(i),i.stack=new Error().stack},t=n(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var bT=r1(function(n){return function(t){n(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(i,r){return r+1+") "+i.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function ky(n,e){if(n){var t=n.indexOf(e);0<=t&&n.splice(t,1)}}var Eh=(function(){function n(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._teardowns=null}return n.prototype.unsubscribe=function(){var e,t,i,r,o;if(!this.closed){this.closed=!0;var c=this._parentage;if(c)if(this._parentage=null,Array.isArray(c))try{for(var s=du(c),d=s.next();!d.done;d=s.next()){var p=d.value;p.remove(this)}}catch(P){e={error:P}}finally{try{d&&!d.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}else c.remove(this);var g=this.initialTeardown;if(Fn(g))try{g()}catch(P){o=P instanceof bT?P.errors:[P]}var _=this._teardowns;if(_){this._teardowns=null;try{for(var x=du(_),b=x.next();!b.done;b=x.next()){var S=b.value;try{bR(S)}catch(P){o=o??[],P instanceof bT?o=gu(gu([],Ac(o)),Ac(P.errors)):o.push(P)}}}catch(P){i={error:P}}finally{try{b&&!b.done&&(r=x.return)&&r.call(x)}finally{if(i)throw i.error}}}if(o)throw new bT(o)}},n.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)bR(e);else{if(e instanceof n){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._teardowns=(t=this._teardowns)!==null&&t!==void 0?t:[]).push(e)}},n.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},n.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},n.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&ky(t,e)},n.prototype.remove=function(e){var t=this._teardowns;t&&ky(t,e),e instanceof n&&e._removeParent(this)},n.EMPTY=(function(){var e=new n;return e.closed=!0,e})(),n})(),mO=Eh.EMPTY;function gO(n){return n instanceof Eh||n&&"closed"in n&&Fn(n.remove)&&Fn(n.add)&&Fn(n.unsubscribe)}function bR(n){Fn(n)?n():n.unsubscribe()}var q7={Promise:void 0},W7={setTimeout:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return setTimeout.apply(void 0,gu([],Ac(n)))},clearTimeout:function(n){return clearTimeout(n)},delegate:void 0};function _O(n){W7.setTimeout(function(){throw n})}function zd(){}function Gx(n){n()}var gC=(function(n){Pc(e,n);function e(t){var i=n.call(this)||this;return i.isStopped=!1,t?(i.destination=t,gO(t)&&t.add(i)):i.destination=H7,i}return e.create=function(t,i,r){return new _C(t,i,r)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,n.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e})(Eh),_C=(function(n){Pc(e,n);function e(t,i,r){var o=n.call(this)||this,c;if(Fn(t))c=t;else if(t){c=t.next,i=t.error,r=t.complete;var s;s=t,c=c?.bind(s),i=i?.bind(s),r=r?.bind(s)}return o.destination={next:c?xT(c):zd,error:xT(i??vO),complete:r?xT(r):zd},o}return e})(gC);function xT(n,e){return function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];try{n.apply(void 0,gu([],Ac(t)))}catch(r){_O(r)}}}function vO(n){throw n}var H7={closed:!0,next:zd,error:vO,complete:zd},s1=(function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"})();function bu(n){return n}function Z7(n){return n.length===0?bu:n.length===1?n[0]:function(t){return n.reduce(function(i,r){return r(i)},t)}}var gr=(function(){function n(e){e&&(this._subscribe=e)}return n.prototype.lift=function(e){var t=new n;return t.source=this,t.operator=e,t},n.prototype.subscribe=function(e,t,i){var r=this,o=Y7(e)?e:new _C(e,t,i);return Gx(function(){var c=r,s=c.operator,d=c.source;o.add(s?s.call(o,d):d?r._subscribe(o):r._trySubscribe(o))}),o},n.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},n.prototype.forEach=function(e,t){var i=this;return t=xR(t),new t(function(r,o){var c;c=i.subscribe(function(s){try{e(s)}catch(d){o(d),c?.unsubscribe()}},o,r)})},n.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},n.prototype[s1]=function(){return this},n.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Z7(e)(this)},n.prototype.toPromise=function(e){var t=this;return e=xR(e),new e(function(i,r){var o;t.subscribe(function(c){return o=c},function(c){return r(c)},function(){return i(o)})})},n.create=function(e){return new n(e)},n})();function xR(n){var e;return(e=n??q7.Promise)!==null&&e!==void 0?e:Promise}function X7(n){return n&&Fn(n.next)&&Fn(n.error)&&Fn(n.complete)}function Y7(n){return n&&n instanceof gC||X7(n)&&gO(n)}function yO(n){return Fn(n?.lift)}function Xn(n){return function(e){if(yO(e))return e.lift(function(t){try{return n(t,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}var Pn=(function(n){Pc(e,n);function e(t,i,r,o,c){var s=n.call(this,t)||this;return s.onFinalize=c,s._next=i?function(d){try{i(d)}catch(p){t.error(p)}}:n.prototype._next,s._error=o?function(d){try{o(d)}catch(p){t.error(p)}finally{this.unsubscribe()}}:n.prototype._error,s._complete=r?function(){try{r()}catch(d){t.error(d)}finally{this.unsubscribe()}}:n.prototype._complete,s}return e.prototype.unsubscribe=function(){var t,i=this.closed;n.prototype.unsubscribe.call(this),!i&&((t=this.onFinalize)===null||t===void 0||t.call(this))},e})(gC);function gi(){return Xn(function(n,e){var t=null;n._refCount++;var i=new Pn(e,void 0,void 0,void 0,function(){if(!n||n._refCount<=0||0<--n._refCount){t=null;return}var r=n._connection,o=t;t=null,r&&(!o||r===o)&&r.unsubscribe(),e.unsubscribe()});n.subscribe(i),i.closed||(t=n.connect())})}var K7=(function(n){Pc(e,n);function e(t,i){var r=n.call(this)||this;return r.source=t,r.subjectFactory=i,r._subject=null,r._refCount=0,r._connection=null,yO(t)&&(r.lift=t.lift),r}return e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject},e.prototype._teardown=function(){this._refCount=0;var t=this._connection;this._subject=this._connection=null,t?.unsubscribe()},e.prototype.connect=function(){var t=this,i=this._connection;if(!i){i=this._connection=new Eh;var r=this.getSubject();i.add(this.source.subscribe(new Pn(r,void 0,function(){t._teardown(),r.complete()},function(o){t._teardown(),r.error(o)},function(){return t._teardown()}))),i.closed&&(this._connection=null,i=Eh.EMPTY)}return i},e.prototype.refCount=function(){return gi()(this)},e})(gr),J7=r1(function(n){return function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),ri=(function(n){Pc(e,n);function e(){var t=n.call(this)||this;return t.closed=!1,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var i=new wR(this,this);return i.operator=t,i},e.prototype._throwIfClosed=function(){if(this.closed)throw new J7},e.prototype.next=function(t){var i=this;Gx(function(){var r,o;if(i._throwIfClosed(),!i.isStopped){var c=i.observers.slice();try{for(var s=du(c),d=s.next();!d.done;d=s.next()){var p=d.value;p.next(t)}}catch(g){r={error:g}}finally{try{d&&!d.done&&(o=s.return)&&o.call(s)}finally{if(r)throw r.error}}}})},e.prototype.error=function(t){var i=this;Gx(function(){if(i._throwIfClosed(),!i.isStopped){i.hasError=i.isStopped=!0,i.thrownError=t;for(var r=i.observers;r.length;)r.shift().error(t)}})},e.prototype.complete=function(){var t=this;Gx(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var i=t.observers;i.length;)i.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),n.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var i=this,r=i.hasError,o=i.isStopped,c=i.observers;return r||o?mO:(c.push(t),new Eh(function(){return ky(c,t)}))},e.prototype._checkFinalizedStatuses=function(t){var i=this,r=i.hasError,o=i.thrownError,c=i.isStopped;r?t.error(o):c&&t.complete()},e.prototype.asObservable=function(){var t=new gr;return t.source=this,t},e.create=function(t,i){return new wR(t,i)},e})(gr),wR=(function(n){Pc(e,n);function e(t,i){var r=n.call(this)||this;return r.destination=t,r.source=i,r}return e.prototype.next=function(t){var i,r;(r=(i=this.destination)===null||i===void 0?void 0:i.next)===null||r===void 0||r.call(i,t)},e.prototype.error=function(t){var i,r;(r=(i=this.destination)===null||i===void 0?void 0:i.error)===null||r===void 0||r.call(i,t)},e.prototype.complete=function(){var t,i;(i=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||i===void 0||i.call(t)},e.prototype._subscribe=function(t){var i,r;return(r=(i=this.source)===null||i===void 0?void 0:i.subscribe(t))!==null&&r!==void 0?r:mO},e})(ri),Ah=(function(n){Pc(e,n);function e(t){var i=n.call(this)||this;return i._value=t,i}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var i=n.prototype._subscribe.call(this,t);return!i.closed&&t.next(this._value),i},e.prototype.getValue=function(){var t=this,i=t.hasError,r=t.thrownError,o=t._value;if(i)throw r;return this._throwIfClosed(),o},e.prototype.next=function(t){n.prototype.next.call(this,this._value=t)},e})(ri),vC={now:function(){return(vC.delegate||Date).now()},delegate:void 0},bO=(function(n){Pc(e,n);function e(t,i,r){t===void 0&&(t=1/0),i===void 0&&(i=1/0),r===void 0&&(r=vC);var o=n.call(this)||this;return o._bufferSize=t,o._windowTime=i,o._timestampProvider=r,o._buffer=[],o._infiniteTimeWindow=!0,o._infiniteTimeWindow=i===1/0,o._bufferSize=Math.max(1,t),o._windowTime=Math.max(1,i),o}return e.prototype.next=function(t){var i=this,r=i.isStopped,o=i._buffer,c=i._infiniteTimeWindow,s=i._timestampProvider,d=i._windowTime;r||(o.push(t),!c&&o.push(s.now()+d)),this._trimBuffer(),n.prototype.next.call(this,t)},e.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var i=this._innerSubscribe(t),r=this,o=r._infiniteTimeWindow,c=r._buffer,s=c.slice(),d=0;d<s.length&&!t.closed;d+=o?1:2)t.next(s[d]);return this._checkFinalizedStatuses(t),i},e.prototype._trimBuffer=function(){var t=this,i=t._bufferSize,r=t._timestampProvider,o=t._buffer,c=t._infiniteTimeWindow,s=(c?1:2)*i;if(i<1/0&&s<o.length&&o.splice(0,o.length-s),!c){for(var d=r.now(),p=0,g=1;g<o.length&&o[g]<=d;g+=2)p=g;p&&o.splice(0,p+1)}},e})(ri),Q7=(function(n){Pc(e,n);function e(t,i){return n.call(this)||this}return e.prototype.schedule=function(t,i){return this},e})(Eh),KM={setInterval:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=KM.delegate;return(t?.setInterval||setInterval).apply(void 0,gu([],Ac(n)))},clearInterval:function(n){return clearInterval(n)},delegate:void 0},eW=(function(n){Pc(e,n);function e(t,i){var r=n.call(this,t,i)||this;return r.scheduler=t,r.work=i,r.pending=!1,r}return e.prototype.schedule=function(t,i){if(i===void 0&&(i=0),this.closed)return this;this.state=t;var r=this.id,o=this.scheduler;return r!=null&&(this.id=this.recycleAsyncId(o,r,i)),this.pending=!0,this.delay=i,this.id=this.id||this.requestAsyncId(o,this.id,i),this},e.prototype.requestAsyncId=function(t,i,r){return r===void 0&&(r=0),KM.setInterval(t.flush.bind(t,this),r)},e.prototype.recycleAsyncId=function(t,i,r){if(r===void 0&&(r=0),r!=null&&this.delay===r&&this.pending===!1)return i;KM.clearInterval(i)},e.prototype.execute=function(t,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var r=this._execute(t,i);if(r)return r;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,i){var r=!1,o;try{this.work(t)}catch(c){r=!0,o=!!c&&c||new Error(c)}if(r)return this.unsubscribe(),o},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,i=t.id,r=t.scheduler,o=r.actions;this.work=this.state=this.scheduler=null,this.pending=!1,ky(o,this),i!=null&&(this.id=this.recycleAsyncId(r,i,null)),this.delay=null,n.prototype.unsubscribe.call(this)}},e})(Q7),SR=(function(){function n(e,t){t===void 0&&(t=n.now),this.schedulerActionCtor=e,this.now=t}return n.prototype.schedule=function(e,t,i){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(i,t)},n.now=vC.now,n})(),tW=(function(n){Pc(e,n);function e(t,i){i===void 0&&(i=SR.now);var r=n.call(this,t,i)||this;return r.actions=[],r._active=!1,r._scheduled=void 0,r}return e.prototype.flush=function(t){var i=this.actions;if(this._active){i.push(t);return}var r;this._active=!0;do if(r=t.execute(t.state,t.delay))break;while(t=i.shift());if(this._active=!1,r){for(;t=i.shift();)t.unsubscribe();throw r}},e})(SR),yC=new tW(eW),xO=yC,c0=new gr(function(n){return n.complete()});function zi(n){return n?iW(n):c0}function iW(n){return new gr(function(e){return n.schedule(function(){return e.complete()})})}function bC(n,e){return new gr(function(t){var i=0;return e.schedule(function(){i===n.length?t.complete():(t.next(n[i++]),t.closed||this.schedule())})})}var xC=(function(n){return n&&typeof n.length=="number"&&typeof n!="function"});function wO(n){return Fn(n?.then)}function nW(n,e){return new gr(function(t){var i=new Eh;return i.add(e.schedule(function(){var r=n[s1]();i.add(r.subscribe({next:function(o){i.add(e.schedule(function(){return t.next(o)}))},error:function(o){i.add(e.schedule(function(){return t.error(o)}))},complete:function(){i.add(e.schedule(function(){return t.complete()}))}}))})),i})}function rW(n,e){return new gr(function(t){return e.schedule(function(){return n.then(function(i){t.add(e.schedule(function(){t.next(i),t.add(e.schedule(function(){return t.complete()}))}))},function(i){t.add(e.schedule(function(){return t.error(i)}))})})})}function sW(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var SO=sW();function TO(n,e,t,i){i===void 0&&(i=0);var r=e.schedule(function(){try{t.call(this)}catch(o){n.error(o)}},i);return n.add(r),r}function oW(n,e){return new gr(function(t){var i;return t.add(e.schedule(function(){i=n[SO](),TO(t,e,function(){var r=i.next(),o=r.value,c=r.done;c?t.complete():(t.next(o),this.schedule())})})),function(){return Fn(i?.return)&&i.return()}})}function MO(n,e){if(!n)throw new Error("Iterable cannot be null");return new gr(function(t){var i=new Eh;return i.add(e.schedule(function(){var r=n[Symbol.asyncIterator]();i.add(e.schedule(function(){var o=this;r.next().then(function(c){c.done?t.complete():(t.next(c.value),o.schedule())})}))})),i})}function CO(n){return Fn(n[s1])}function EO(n){return Fn(n?.[SO])}function AO(n){return Symbol.asyncIterator&&Fn(n?.[Symbol.asyncIterator])}function PO(n){return new TypeError("You provided "+(n!==null&&typeof n=="object"?"an invalid object":"'"+n+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function IO(n){return j7(this,arguments,function(){var t,i,r,o;return pO(this,function(c){switch(c.label){case 0:t=n.getReader(),c.label=1;case 1:c.trys.push([1,,9,10]),c.label=2;case 2:return[4,Ag(t.read())];case 3:return i=c.sent(),r=i.value,o=i.done,o?[4,Ag(void 0)]:[3,5];case 4:return[2,c.sent()];case 5:return[4,Ag(r)];case 6:return[4,c.sent()];case 7:return c.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function RO(n){return Fn(n?.getReader)}function aW(n,e){return MO(IO(n),e)}function lW(n,e){if(n!=null){if(CO(n))return nW(n,e);if(xC(n))return bC(n,e);if(wO(n))return rW(n,e);if(AO(n))return MO(n,e);if(EO(n))return oW(n,e);if(RO(n))return aW(n,e)}throw PO(n)}function Fr(n,e){return e?lW(n,e):cl(n)}function cl(n){if(n instanceof gr)return n;if(n!=null){if(CO(n))return cW(n);if(xC(n))return LO(n);if(wO(n))return uW(n);if(AO(n))return kO(n);if(EO(n))return hW(n);if(RO(n))return dW(n)}throw PO(n)}function cW(n){return new gr(function(e){var t=n[s1]();if(Fn(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function LO(n){return new gr(function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}function uW(n){return new gr(function(e){n.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,_O)})}function hW(n){return new gr(function(e){var t,i;try{for(var r=du(n),o=r.next();!o.done;o=r.next()){var c=o.value;if(e.next(c),e.closed)return}}catch(s){t={error:s}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}e.complete()})}function kO(n){return new gr(function(e){fW(n,e).catch(function(t){return e.error(t)})})}function dW(n){return kO(IO(n))}function fW(n,e){var t,i,r,o;return U7(this,void 0,void 0,function(){var c,s;return pO(this,function(d){switch(d.label){case 0:d.trys.push([0,5,6,11]),t=G7(n),d.label=1;case 1:return[4,t.next()];case 2:if(i=d.sent(),!!i.done)return[3,4];if(c=i.value,e.next(c),e.closed)return[2];d.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=d.sent(),r={error:s},[3,11];case 6:return d.trys.push([6,,9,10]),i&&!i.done&&(o=t.return)?[4,o.call(t)]:[3,8];case 7:d.sent(),d.label=8;case 8:return[3,10];case 9:if(r)throw r.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function o1(n,e){return e?bC(n,e):LO(n)}function DO(n){return n&&Fn(n.schedule)}function wC(n){return n[n.length-1]}function SC(n){return Fn(wC(n))?n.pop():void 0}function u0(n){return DO(wC(n))?n.pop():void 0}function pW(n,e){return typeof wC(n)=="number"?n.pop():e}function Ai(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=u0(n);return t?bC(n,t):o1(n)}function qx(n,e){var t=Fn(n)?n:function(){return n},i=function(r){return r.error(t())};return new gr(i)}var TC=r1(function(n){return function(){n(this),this.name="EmptyError",this.message="no elements in sequence"}});function FO(n){return n instanceof Date&&!isNaN(n)}var mW=r1(function(n){return function(t){t===void 0&&(t=null),n(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}});function JM(n,e){var t=FO(n)?{first:n}:{each:n},i=t.first,r=t.each,o=t.with,c=o===void 0?gW:o,s=t.scheduler,d=s===void 0?yC:s,p=t.meta,g=p===void 0?null:p;if(i==null&&r==null)throw new TypeError("No timeout provided.");return Xn(function(_,x){var b,S,P=null,L=0,E=function(C){S=TO(x,d,function(){b.unsubscribe(),cl(c({meta:g,lastValue:P,seen:L})).subscribe(x)},C)};b=_.subscribe(new Pn(x,function(C){S?.unsubscribe(),L++,x.next(P=C),r>0&&E(r)},void 0,void 0,function(){S?.closed||S?.unsubscribe(),P=null})),E(i!=null?typeof i=="number"?i:+i-d.now():r)})}function gW(n){throw new mW(n)}function it(n,e){return Xn(function(t,i){var r=0;t.subscribe(new Pn(i,function(o){i.next(n.call(e,o,r++))}))})}var _W=Array.isArray;function vW(n,e){return _W(e)?n.apply(void 0,gu([],Ac(e))):n(e)}function OO(n){return it(function(e){return vW(n,e)})}var yW=Array.isArray,bW=Object.getPrototypeOf,xW=Object.prototype,wW=Object.keys;function SW(n){if(n.length===1){var e=n[0];if(yW(e))return{args:e,keys:null};if(TW(e)){var t=wW(e);return{args:t.map(function(i){return e[i]}),keys:t}}}return{args:n,keys:null}}function TW(n){return n&&typeof n=="object"&&bW(n)===xW}function MW(n,e){return n.reduce(function(t,i,r){return t[i]=e[r],t},{})}function Si(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=u0(n),i=SC(n),r=SW(n),o=r.args,c=r.keys;if(o.length===0)return Fr([],t);var s=new gr(CW(o,t,c?function(d){return MW(c,d)}:bu));return i?s.pipe(OO(i)):s}function CW(n,e,t){return t===void 0&&(t=bu),function(i){TR(e,function(){for(var r=n.length,o=new Array(r),c=r,s=r,d=function(g){TR(e,function(){var _=Fr(n[g],e),x=!1;_.subscribe(new Pn(i,function(b){o[g]=b,x||(x=!0,s--),s||i.next(t(o.slice()))},function(){--c||i.complete()}))},i)},p=0;p<r;p++)d(p)},i)}}function TR(n,e,t){n?t.add(n.schedule(e)):e()}function zO(n,e,t,i,r,o,c,s){var d=[],p=0,g=0,_=!1,x=function(){_&&!d.length&&!p&&e.complete()},b=function(P){return p<i?S(P):d.push(P)},S=function(P){o&&e.next(P),p++;var L=!1;cl(t(P,g++)).subscribe(new Pn(e,function(E){o?b(E):e.next(E)},function(){L=!0},void 0,function(){if(L)try{p--;for(var E=function(){var C=d.shift();c?e.add(c.schedule(function(){return S(C)})):S(C)};d.length&&p<i;)E();x()}catch(C){e.error(C)}}))};return n.subscribe(new Pn(e,b,function(){_=!0,x()})),function(){}}function Hi(n,e,t){return t===void 0&&(t=1/0),Fn(e)?Hi(function(i,r){return it(function(o,c){return e(i,o,r,c)})(cl(n(i,r)))},t):(typeof e=="number"&&(t=e),Xn(function(i,r){return zO(i,r,n,t)}))}function op(n){return n===void 0&&(n=1/0),Hi(bu,n)}function EW(){return op(1)}function Ul(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return EW()(o1(n,u0(n)))}var AW=["addListener","removeListener"],PW=["addEventListener","removeEventListener"],IW=["on","off"];function Tr(n,e,t,i){if(Fn(t)&&(i=t,t=void 0),i)return Tr(n,e,t).pipe(OO(i));var r=Ac(kW(n)?PW.map(function(s){return function(d){return n[s](e,d,t)}}):RW(n)?AW.map(MR(n,e)):LW(n)?IW.map(MR(n,e)):[],2),o=r[0],c=r[1];if(!o&&xC(n))return Hi(function(s){return Tr(s,e,t)})(o1(n));if(!o)throw new TypeError("Invalid event target");return new gr(function(s){var d=function(){for(var p=[],g=0;g<arguments.length;g++)p[g]=arguments[g];return s.next(1<p.length?p:p[0])};return o(d),function(){return c(d)}})}function MR(n,e){return function(t){return function(i){return n[t](e,i)}}}function RW(n){return Fn(n.addListener)&&Fn(n.removeListener)}function LW(n){return Fn(n.on)&&Fn(n.off)}function kW(n){return Fn(n.addEventListener)&&Fn(n.removeEventListener)}function MC(n,e,t){n===void 0&&(n=0),t===void 0&&(t=xO);var i=-1;return e!=null&&(DO(e)?t=e:i=e),new gr(function(r){var o=FO(n)?+n-t.now():n;o<0&&(o=0);var c=0;return t.schedule(function(){r.closed||(r.next(c++),0<=i?this.schedule(void 0,i):r.complete())},o)})}function fn(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=u0(n),i=pW(n,1/0),r=n;return r.length?r.length===1?cl(r[0]):op(i)(o1(r,t)):c0}var DW=Array.isArray;function FW(n){return n.length===1&&DW(n[0])?n[0]:n}function oi(n,e){return Xn(function(t,i){var r=0;t.subscribe(new Pn(i,function(o){return n.call(e,o,r++)&&i.next(o)}))})}function Dy(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=SC(n),i=FW(n);return i.length?new gr(function(r){var o=i.map(function(){return[]}),c=i.map(function(){return!1});r.add(function(){o=c=null});for(var s=function(p){cl(i[p]).subscribe(new Pn(r,function(g){if(o[p].push(g),o.every(function(x){return x.length})){var _=o.map(function(x){return x.shift()});r.next(t?t.apply(void 0,gu([],Ac(_))):_),o.some(function(x,b){return!x.length&&c[b]})&&r.complete()}},function(){c[p]=!0,!o[p].length&&r.complete()}))},d=0;!r.closed&&d<i.length;d++)s(d);return function(){o=c=null}}):c0}function OW(n){return Xn(function(e,t){var i=!1,r=null,o=null,c=!1,s=function(){if(o?.unsubscribe(),o=null,i){i=!1;var p=r;r=null,t.next(p)}c&&t.complete()},d=function(){o=null,c&&t.complete()};e.subscribe(new Pn(t,function(p){i=!0,r=p,o||cl(n(p)).subscribe(o=new Pn(t,s,d))},function(){c=!0,(!i||!o||o.closed)&&t.complete()}))})}function BO(n,e){return e===void 0&&(e=xO),OW(function(){return MC(n,e)})}function xw(n,e){return e===void 0&&(e=null),e=e??n,Xn(function(t,i){var r=[],o=0;t.subscribe(new Pn(i,function(c){var s,d,p,g,_=null;o++%e===0&&r.push([]);try{for(var x=du(r),b=x.next();!b.done;b=x.next()){var S=b.value;S.push(c),n<=S.length&&(_=_??[],_.push(S))}}catch(E){s={error:E}}finally{try{b&&!b.done&&(d=x.return)&&d.call(x)}finally{if(s)throw s.error}}if(_)try{for(var P=du(_),L=P.next();!L.done;L=P.next()){var S=L.value;ky(r,S),i.next(S)}}catch(E){p={error:E}}finally{try{L&&!L.done&&(g=P.return)&&g.call(P)}finally{if(p)throw p.error}}},function(){var c,s;try{for(var d=du(r),p=d.next();!p.done;p=d.next()){var g=p.value;i.next(g)}}catch(_){c={error:_}}finally{try{p&&!p.done&&(s=d.return)&&s.call(d)}finally{if(c)throw c.error}}i.complete()},void 0,function(){r=null}))})}function zW(n){return Xn(function(e,t){var i=null,r=null,o=function(){r?.unsubscribe();var c=i;i=[],c&&t.next(c),cl(n()).subscribe(r=new Pn(t,o,zd))};o(),e.subscribe(new Pn(t,function(c){return i?.push(c)},function(){i&&t.next(i),t.complete()},void 0,function(){return i=r=null}))})}function $n(n){return Xn(function(e,t){var i=null,r=!1,o;i=e.subscribe(new Pn(t,void 0,void 0,function(c){o=cl(n(c,$n(n)(e))),i?(i.unsubscribe(),i=null,o.subscribe(t)):r=!0})),r&&(i.unsubscribe(),i=null,o.subscribe(t))})}function NO(n,e,t,i,r){return function(o,c){var s=t,d=e,p=0;o.subscribe(new Pn(c,function(g){var _=p++;d=s?n(d,g,_):(s=!0,g),i&&c.next(d)},r&&(function(){s&&c.next(d),c.complete()})))}}function CR(n,e){return Xn(NO(n,e,arguments.length>=2,!1,!0))}function wT(n,e){return Fn(e)?Hi(n,e,1):Hi(n,1)}function BW(n){return new gr(function(e){return n.subscribe(e)})}var NW={connector:function(){return new ri}};function $O(n,e){e===void 0&&(e=NW);var t=e.connector;return Xn(function(i,r){var o=t();Fr(n(BW(o))).subscribe(r),r.add(i.subscribe(o))})}function Fy(n,e){return e===void 0&&(e=yC),Xn(function(t,i){var r=null,o=null,c=null,s=function(){if(r){r.unsubscribe(),r=null;var p=o;o=null,i.next(p)}};function d(){var p=c+n,g=e.now();if(g<p){r=this.schedule(void 0,p-g),i.add(r);return}s()}t.subscribe(new Pn(i,function(p){o=p,c=e.now(),r||(r=e.schedule(d,n),i.add(r))},function(){s(),i.complete()},void 0,function(){o=r=null}))})}function VO(n){return Xn(function(e,t){var i=!1;e.subscribe(new Pn(t,function(r){i=!0,t.next(r)},function(){i||t.next(n),t.complete()}))})}function $l(n){return n<=0?function(){return c0}:Xn(function(e,t){var i=0;e.subscribe(new Pn(t,function(r){++i<=n&&(t.next(r),n<=i&&t.complete())}))})}function yi(n,e){return e===void 0&&(e=bu),n=n??$W,Xn(function(t,i){var r,o=!0;t.subscribe(new Pn(i,function(c){var s=e(c);(o||!n(r,s))&&(o=!1,r=s,i.next(c))}))})}function $W(n,e){return n===e}function UO(n){return n===void 0&&(n=VW),Xn(function(e,t){var i=!1;e.subscribe(new Pn(t,function(r){i=!0,t.next(r)},function(){return i?t.complete():t.error(n())}))})}function VW(){return new TC}function jO(n,e,t){return e===void 0&&(e=1/0),e=(e||0)<1?1/0:e,Xn(function(i,r){return zO(i,r,n,e,void 0,!0,t)})}function ga(n){return Xn(function(e,t){try{e.subscribe(t)}finally{t.add(n)}})}function wi(n,e){var t=arguments.length>=2;return function(i){return i.pipe(n?oi(function(r,o){return n(r,o,i)}):bu,$l(1),t?VO(e):UO(function(){return new TC}))}}function QM(n){return n<=0?function(){return c0}:Xn(function(e,t){var i=[];e.subscribe(new Pn(t,function(r){i.push(r),n<i.length&&i.shift()},function(){var r,o;try{for(var c=du(i),s=c.next();!s.done;s=c.next()){var d=s.value;t.next(d)}}catch(p){r={error:p}}finally{try{s&&!s.done&&(o=c.return)&&o.call(c)}finally{if(r)throw r.error}}t.complete()},void 0,function(){i=null}))})}function qg(n,e){var t=arguments.length>=2;return function(i){return i.pipe(n?oi(function(r,o){return n(r,o,i)}):bu,QM(1),t?VO(e):UO(function(){return new TC}))}}function GO(n,e){var t=Fn(n)?n:function(){return n};return Fn(e)?$O(e,{connector:t}):function(i){return new K7(i,t)}}function il(){return Xn(function(n,e){var t,i=!1;n.subscribe(new Pn(e,function(r){var o=t;t=r,i&&e.next([o,r]),i=!0}))})}function UW(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=n.length;if(t===0)throw new Error("list of properties cannot be empty.");return it(function(i){for(var r=i,o=0;o<t;o++){var c=r?.[n[o]];if(typeof c<"u")r=c;else return}return r})}function Ka(n){return n?function(e){return $O(n)(e)}:function(e){return GO(new ri)(e)}}function Pi(n,e,t,i){var r=Fn(t)?t:void 0;return function(o){return GO(new bO(n,e,i),r)(o)}}function e2(n){var e;e={count:n};var t=e.count,i=t===void 0?1/0:t,r=e.delay,o=e.resetOnSuccess,c=o===void 0?!1:o;return i<=0?bu:Xn(function(s,d){var p=0,g,_=function(){var x=!1;g=s.subscribe(new Pn(d,function(b){c&&(p=0),d.next(b)},void 0,function(b){if(p++<i){var S=function(){g?(g.unsubscribe(),g=null,_()):x=!0};if(r!=null){var P=typeof r=="number"?MC(r):cl(r(b,p)),L=new Pn(d,function(){L.unsubscribe(),S()},function(){d.complete()});P.subscribe(L)}else S()}else d.error(b)})),x&&(g.unsubscribe(),g=null,_())};_()})}function jW(n){return Xn(function(e,t){var i=!1,r=null;e.subscribe(new Pn(t,function(c){i=!0,r=c}));var o=function(){if(i){i=!1;var c=r;r=null,t.next(c)}};n.subscribe(new Pn(t,o,zd))})}function Vr(n,e){return Xn(NO(n,e,arguments.length>=2,!0))}function dn(n){n===void 0&&(n={});var e=n.connector,t=e===void 0?function(){return new ri}:e,i=n.resetOnError,r=i===void 0?!0:i,o=n.resetOnComplete,c=o===void 0?!0:o,s=n.resetOnRefCountZero,d=s===void 0?!0:s;return function(p){var g=null,_=null,x=null,b=0,S=!1,P=!1,L=function(){_?.unsubscribe(),_=null},E=function(){L(),g=x=null,S=P=!1},C=function(){var D=g;E(),D?.unsubscribe()};return Xn(function(D,O){b++,!P&&!S&&L();var U=x=x??t();O.add(function(){b--,b===0&&!P&&!S&&(_=ST(C,d))}),U.subscribe(O),g||(g=new _C({next:function(q){return U.next(q)},error:function(q){P=!0,L(),_=ST(E,r,q),U.error(q)},complete:function(){S=!0,L(),_=ST(E,c),U.complete()}}),Fr(D).subscribe(g))})(p)}}function ST(n,e){for(var t=[],i=2;i<arguments.length;i++)t[i-2]=arguments[i];return e===!0?(n(),null):e===!1?null:e.apply(void 0,gu([],Ac(t))).pipe($l(1)).subscribe(function(){return n()})}function Ys(n){return oi(function(e,t){return n<=t})}function t2(n){return Xn(function(e,t){var i=!1,r=0;e.subscribe(new Pn(t,function(o){return(i||(i=!n(o,r++)))&&t.next(o)}))})}function An(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=u0(n);return Xn(function(i,r){(t?Ul(n,i,t):Ul(n,i)).subscribe(r)})}function ei(n,e){return Xn(function(t,i){var r=null,o=0,c=!1,s=function(){return c&&!r&&i.complete()};t.subscribe(new Pn(i,function(d){r?.unsubscribe();var p=0,g=o++;cl(n(d,g)).subscribe(r=new Pn(i,function(_){return i.next(e?e(d,_,g,p++):_)},function(){r=null,s()}))},function(){c=!0,s()}))})}function Td(n){return Xn(function(e,t){cl(n).subscribe(new Pn(t,function(){return t.complete()},zd)),!t.closed&&e.subscribe(t)})}function qO(n,e){return e===void 0&&(e=!1),Xn(function(t,i){var r=0;t.subscribe(new Pn(i,function(o){var c=n(o,r++);(c||e)&&i.next(o),!c&&i.complete()}))})}function Dr(n,e,t){var i=Fn(n)||e||t?{next:n,error:e,complete:t}:n;return i?Xn(function(r,o){var c;(c=i.subscribe)===null||c===void 0||c.call(i);var s=!0;r.subscribe(new Pn(o,function(d){var p;(p=i.next)===null||p===void 0||p.call(i,d),o.next(d)},function(){var d;s=!1,(d=i.complete)===null||d===void 0||d.call(i),o.complete()},function(d){var p;s=!1,(p=i.error)===null||p===void 0||p.call(i,d),o.error(d)},function(){var d,p;s&&((d=i.unsubscribe)===null||d===void 0||d.call(i)),(p=i.finalize)===null||p===void 0||p.call(i)}))}):bu}function Ui(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=SC(n);return Xn(function(i,r){for(var o=n.length,c=new Array(o),s=n.map(function(){return!1}),d=!1,p=function(_){cl(n[_]).subscribe(new Pn(r,function(x){c[_]=x,!d&&!s[_]&&(s[_]=!0,(d=s.every(bu))&&(s=null))},zd))},g=0;g<o;g++)p(g);i.subscribe(new Pn(r,function(_){if(d){var x=gu([_],Ac(c));r.next(t?t.apply(void 0,gu([],Ac(x))):x)}}))})}class GW{createFilter(e){return new Function("node","return "+this._compile(e)+";")}_compile(e){if(e==null||e.length<=1)return"true";const t=e[0];return"("+(t==="=="?this._compileComparisonOp("===",e[1],e[2],!1):t==="!="?this._compileComparisonOp("!==",e[1],e[2],!1):t===">"||t===">="||t==="<"||t==="<="?this._compileComparisonOp(t,e[1],e[2],!0):t==="in"?this._compileInOp(e[1],e.slice(2)):t==="!in"?this._compileNegation(this._compileInOp(e[1],e.slice(2))):t==="all"?this._compileLogicalOp(e.slice(1),"&&"):"true")+")"}_compare(e,t){return e<t?-1:e>t?1:0}_compileComparisonOp(e,t,i,r){const o=this._compilePropertyReference(t),c=JSON.stringify(i);return(r?"typeof "+o+"===typeof "+c+"&&":"")+o+e+c}_compileInOp(e,t){const i=this._compare,r=JSON.stringify(t.sort(i)),o=this._compilePropertyReference(e);return r+".indexOf("+o+")!==-1"}_compileLogicalOp(e,t){const i=this._compile.bind(this);return e.map(i).join(t)}_compileNegation(e){return"!("+e+")"}_compilePropertyReference(e){return"node["+JSON.stringify(e)+"]"}}const WO="134",qW=0,ER=1,WW=2,HO=1,HW=2,Zv=3,Wg=0,qs=1,Ko=2,ZO=1,Pd=0,fy=1,AR=2,PR=3,IR=4,ZW=5,fg=100,XW=101,YW=102,RR=103,LR=104,KW=200,JW=201,QW=202,eH=203,XO=204,YO=205,tH=206,iH=207,nH=208,rH=209,sH=210,oH=0,aH=1,lH=2,i2=3,cH=4,uH=5,hH=6,dH=7,a1=0,fH=1,pH=2,ap=0,mH=1,gH=2,_H=3,vH=4,yH=5,KO=300,h0=301,d0=302,n2=303,r2=304,l1=306,CC=307,s2=1e3,el=1001,o2=1002,Zs=1003,kR=1004,DR=1005,Lo=1006,bH=1007,c1=1008,Bd=1009,xH=1010,wH=1011,ww=1012,SH=1013,Wx=1014,Sd=1015,Pg=1016,TH=1017,MH=1018,CH=1019,py=1020,EH=1021,lp=1022,aa=1023,AH=1024,PH=1025,IH=aa,Ig=1026,Oy=1027,RH=1028,LH=1029,kH=1030,DH=1031,FH=1032,OH=1033,FR=33776,OR=33777,zR=33778,BR=33779,NR=35840,$R=35841,VR=35842,UR=35843,zH=36196,jR=37492,GR=37496,BH=37808,NH=37809,$H=37810,VH=37811,UH=37812,jH=37813,GH=37814,qH=37815,WH=37816,HH=37817,ZH=37818,XH=37819,YH=37820,KH=37821,JH=36492,QH=37840,e9=37841,t9=37842,i9=37843,n9=37844,r9=37845,s9=37846,o9=37847,a9=37848,l9=37849,c9=37850,u9=37851,h9=37852,d9=37853,f9=2200,p9=2201,m9=2202,Sw=2300,Tw=2301,TT=2302,_g=2400,vg=2401,Mw=2402,EC=2500,JO=2501,g9=0,Fo=3e3,Sp=3001,AC=3007,PC=3002,_9=3003,QO=3004,ez=3005,tz=3006,v9=3200,y9=3201,u_=0,b9=1,MT=7680,x9=519,zy=35044,Cw=35048,qR="300 es";class Tp{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const o=r.indexOf(t);o!==-1&&r.splice(o,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const r=i.slice(0);for(let o=0,c=r.length;o<c;o++)r[o].call(this,e);e.target=null}}}let Bb=1234567;const my=Math.PI/180,By=180/Math.PI,uo=[];for(let n=0;n<256;n++)uo[n]=(n<16?"0":"")+n.toString(16);const w9=typeof crypto<"u"&&"randomUUID"in crypto;function Tc(){if(w9)return crypto.randomUUID().toUpperCase();const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(uo[n&255]+uo[n>>8&255]+uo[n>>16&255]+uo[n>>24&255]+"-"+uo[e&255]+uo[e>>8&255]+"-"+uo[e>>16&15|64]+uo[e>>24&255]+"-"+uo[t&63|128]+uo[t>>8&255]+"-"+uo[t>>16&255]+uo[t>>24&255]+uo[i&255]+uo[i>>8&255]+uo[i>>16&255]+uo[i>>24&255]).toUpperCase()}function _a(n,e,t){return Math.max(e,Math.min(t,n))}function IC(n,e){return(n%e+e)%e}function S9(n,e,t,i,r){return i+(n-e)*(r-i)/(t-e)}function T9(n,e,t){return n!==e?(t-n)/(e-n):0}function gy(n,e,t){return(1-t)*n+t*e}function M9(n,e,t,i){return gy(n,e,1-Math.exp(-t*i))}function C9(n,e=1){return e-Math.abs(IC(n,e*2)-e)}function E9(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function A9(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function P9(n,e){return n+Math.floor(Math.random()*(e-n+1))}function I9(n,e){return n+Math.random()*(e-n)}function R9(n){return n*(.5-Math.random())}function L9(n){return n!==void 0&&(Bb=n%2147483647),Bb=Bb*16807%2147483647,(Bb-1)/2147483646}function k9(n){return n*my}function D9(n){return n*By}function a2(n){return(n&n-1)===0&&n!==0}function F9(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function iz(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function O9(n,e,t,i,r){const o=Math.cos,c=Math.sin,s=o(t/2),d=c(t/2),p=o((e+i)/2),g=c((e+i)/2),_=o((e-i)/2),x=c((e-i)/2),b=o((i-e)/2),S=c((i-e)/2);switch(r){case"XYX":n.set(s*g,d*_,d*x,s*p);break;case"YZY":n.set(d*x,s*g,d*_,s*p);break;case"ZXZ":n.set(d*_,d*x,s*g,s*p);break;case"XZX":n.set(s*g,d*S,d*b,s*p);break;case"YXY":n.set(d*b,s*g,d*S,s*p);break;case"ZYZ":n.set(d*S,d*b,s*g,s*p);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}var Hg=Object.freeze({__proto__:null,DEG2RAD:my,RAD2DEG:By,generateUUID:Tc,clamp:_a,euclideanModulo:IC,mapLinear:S9,inverseLerp:T9,lerp:gy,damp:M9,pingpong:C9,smoothstep:E9,smootherstep:A9,randInt:P9,randFloat:I9,randFloatSpread:R9,seededRandom:L9,degToRad:k9,radToDeg:D9,isPowerOfTwo:a2,ceilPowerOfTwo:F9,floorPowerOfTwo:iz,setQuaternionFromProperEuler:O9});class li{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,i){return i!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),r=Math.sin(t),o=this.x-e.x,c=this.y-e.y;return this.x=o*i-c*r+e.x,this.y=o*r+c*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}li.prototype.isVector2=!0;class mo{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,r,o,c,s,d,p){const g=this.elements;return g[0]=e,g[1]=r,g[2]=s,g[3]=t,g[4]=o,g[5]=d,g[6]=i,g[7]=c,g[8]=p,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,o=this.elements,c=i[0],s=i[3],d=i[6],p=i[1],g=i[4],_=i[7],x=i[2],b=i[5],S=i[8],P=r[0],L=r[3],E=r[6],C=r[1],D=r[4],O=r[7],U=r[2],q=r[5],G=r[8];return o[0]=c*P+s*C+d*U,o[3]=c*L+s*D+d*q,o[6]=c*E+s*O+d*G,o[1]=p*P+g*C+_*U,o[4]=p*L+g*D+_*q,o[7]=p*E+g*O+_*G,o[2]=x*P+b*C+S*U,o[5]=x*L+b*D+S*q,o[8]=x*E+b*O+S*G,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],r=e[2],o=e[3],c=e[4],s=e[5],d=e[6],p=e[7],g=e[8];return t*c*g-t*s*p-i*o*g+i*s*d+r*o*p-r*c*d}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],o=e[3],c=e[4],s=e[5],d=e[6],p=e[7],g=e[8],_=g*c-s*p,x=s*d-g*o,b=p*o-c*d,S=t*_+i*x+r*b;if(S===0)return this.set(0,0,0,0,0,0,0,0,0);const P=1/S;return e[0]=_*P,e[1]=(r*p-g*i)*P,e[2]=(s*i-r*c)*P,e[3]=x*P,e[4]=(g*t-r*d)*P,e[5]=(r*o-s*t)*P,e[6]=b*P,e[7]=(i*d-p*t)*P,e[8]=(c*t-i*o)*P,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,o,c,s){const d=Math.cos(o),p=Math.sin(o);return this.set(i*d,i*p,-i*(d*c+p*s)+c+e,-r*p,r*d,-r*(-p*c+d*s)+s+t,0,0,1),this}scale(e,t){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this}rotate(e){const t=Math.cos(e),i=Math.sin(e),r=this.elements,o=r[0],c=r[3],s=r[6],d=r[1],p=r[4],g=r[7];return r[0]=t*o+i*d,r[3]=t*c+i*p,r[6]=t*s+i*g,r[1]=-i*o+t*d,r[4]=-i*c+t*p,r[7]=-i*s+t*g,this}translate(e,t){const i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}mo.prototype.isMatrix3=!0;function nz(n){if(n.length===0)return-1/0;let e=n[0];for(let t=1,i=n.length;t<i;++t)n[t]>e&&(e=n[t]);return e}function u1(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function WR(n,e=0){let t=3735928559^e,i=1103547991^e;for(let r=0,o;r<n.length;r++)o=n.charCodeAt(r),t=Math.imul(t^o,2654435761),i=Math.imul(i^o,1597334677);return t=Math.imul(t^t>>>16,2246822507)^Math.imul(i^i>>>13,3266489909),i=Math.imul(i^i>>>16,2246822507)^Math.imul(t^t>>>13,3266489909),4294967296*(2097151&i)+(t>>>0)}let $m;class h_{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{$m===void 0&&($m=u1("canvas")),$m.width=e.width,$m.height=e.height;const i=$m.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=$m}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}}let z9=0;class Bs extends Tp{constructor(e=Bs.DEFAULT_IMAGE,t=Bs.DEFAULT_MAPPING,i=el,r=el,o=Lo,c=c1,s=aa,d=Bd,p=1,g=Fo){super(),Object.defineProperty(this,"id",{value:z9++}),this.uuid=Tc(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=r,this.magFilter=o,this.minFilter=c,this.anisotropy=p,this.format=s,this.internalFormat=null,this.type=d,this.offset=new li(0,0),this.repeat=new li(1,1),this.center=new li(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new mo,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=g,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){const r=this.image;if(r.uuid===void 0&&(r.uuid=Tc()),!t&&e.images[r.uuid]===void 0){let o;if(Array.isArray(r)){o=[];for(let c=0,s=r.length;c<s;c++)r[c].isDataTexture?o.push(CT(r[c].image)):o.push(CT(r[c]))}else o=CT(r);e.images[r.uuid]={uuid:r.uuid,url:o}}i.image=r.uuid}return JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==KO)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case s2:e.x=e.x-Math.floor(e.x);break;case el:e.x=e.x<0?0:1;break;case o2:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case s2:e.y=e.y-Math.floor(e.y);break;case el:e.y=e.y<0?0:1;break;case o2:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&this.version++}}Bs.DEFAULT_IMAGE=void 0;Bs.DEFAULT_MAPPING=KO;Bs.prototype.isTexture=!0;function CT(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?h_.getDataURL(n):n.data?{data:Array.prototype.slice.call(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}class Zn{constructor(e=0,t=0,i=0,r=1){this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,o=this.w,c=e.elements;return this.x=c[0]*t+c[4]*i+c[8]*r+c[12]*o,this.y=c[1]*t+c[5]*i+c[9]*r+c[13]*o,this.z=c[2]*t+c[6]*i+c[10]*r+c[14]*o,this.w=c[3]*t+c[7]*i+c[11]*r+c[15]*o,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,o;const d=e.elements,p=d[0],g=d[4],_=d[8],x=d[1],b=d[5],S=d[9],P=d[2],L=d[6],E=d[10];if(Math.abs(g-x)<.01&&Math.abs(_-P)<.01&&Math.abs(S-L)<.01){if(Math.abs(g+x)<.1&&Math.abs(_+P)<.1&&Math.abs(S+L)<.1&&Math.abs(p+b+E-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const D=(p+1)/2,O=(b+1)/2,U=(E+1)/2,q=(g+x)/4,G=(_+P)/4,N=(S+L)/4;return D>O&&D>U?D<.01?(i=0,r=.707106781,o=.707106781):(i=Math.sqrt(D),r=q/i,o=G/i):O>U?O<.01?(i=.707106781,r=0,o=.707106781):(r=Math.sqrt(O),i=q/r,o=N/r):U<.01?(i=.707106781,r=.707106781,o=0):(o=Math.sqrt(U),i=G/o,r=N/o),this.set(i,r,o,t),this}let C=Math.sqrt((L-S)*(L-S)+(_-P)*(_-P)+(x-g)*(x-g));return Math.abs(C)<.001&&(C=1),this.x=(L-S)/C,this.y=(_-P)/C,this.z=(x-g)/C,this.w=Math.acos((p+b+E-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,i){return i!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}Zn.prototype.isVector4=!0;class Mc extends Tp{constructor(e,t,i={}){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new Zn(0,0,e,t),this.scissorTest=!1,this.viewport=new Zn(0,0,e,t),this.texture=new Bs(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:e,height:t,depth:1},this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:Lo,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}Mc.prototype.isWebGLRenderTarget=!0;class B9 extends Mc{constructor(e,t,i){super(e,t);const r=this.texture;this.texture=[];for(let o=0;o<i;o++)this.texture[o]=r.clone()}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,o=this.texture.length;r<o;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone();return this}}B9.prototype.isWebGLMultipleRenderTargets=!0;class rz extends Mc{constructor(e,t,i){super(e,t,i),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}}rz.prototype.isWebGLMultisampleRenderTarget=!0;class go{constructor(e=0,t=0,i=0,r=1){this._x=e,this._y=t,this._z=i,this._w=r}static slerp(e,t,i,r){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(e,t,r)}static slerpFlat(e,t,i,r,o,c,s){let d=i[r+0],p=i[r+1],g=i[r+2],_=i[r+3];const x=o[c+0],b=o[c+1],S=o[c+2],P=o[c+3];if(s===0){e[t+0]=d,e[t+1]=p,e[t+2]=g,e[t+3]=_;return}if(s===1){e[t+0]=x,e[t+1]=b,e[t+2]=S,e[t+3]=P;return}if(_!==P||d!==x||p!==b||g!==S){let L=1-s;const E=d*x+p*b+g*S+_*P,C=E>=0?1:-1,D=1-E*E;if(D>Number.EPSILON){const U=Math.sqrt(D),q=Math.atan2(U,E*C);L=Math.sin(L*q)/U,s=Math.sin(s*q)/U}const O=s*C;if(d=d*L+x*O,p=p*L+b*O,g=g*L+S*O,_=_*L+P*O,L===1-s){const U=1/Math.sqrt(d*d+p*p+g*g+_*_);d*=U,p*=U,g*=U,_*=U}}e[t]=d,e[t+1]=p,e[t+2]=g,e[t+3]=_}static multiplyQuaternionsFlat(e,t,i,r,o,c){const s=i[r],d=i[r+1],p=i[r+2],g=i[r+3],_=o[c],x=o[c+1],b=o[c+2],S=o[c+3];return e[t]=s*S+g*_+d*b-p*x,e[t+1]=d*S+g*x+p*_-s*b,e[t+2]=p*S+g*b+s*x-d*_,e[t+3]=g*S-s*_-d*x-p*b,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=e._x,r=e._y,o=e._z,c=e._order,s=Math.cos,d=Math.sin,p=s(i/2),g=s(r/2),_=s(o/2),x=d(i/2),b=d(r/2),S=d(o/2);switch(c){case"XYZ":this._x=x*g*_+p*b*S,this._y=p*b*_-x*g*S,this._z=p*g*S+x*b*_,this._w=p*g*_-x*b*S;break;case"YXZ":this._x=x*g*_+p*b*S,this._y=p*b*_-x*g*S,this._z=p*g*S-x*b*_,this._w=p*g*_+x*b*S;break;case"ZXY":this._x=x*g*_-p*b*S,this._y=p*b*_+x*g*S,this._z=p*g*S+x*b*_,this._w=p*g*_-x*b*S;break;case"ZYX":this._x=x*g*_-p*b*S,this._y=p*b*_+x*g*S,this._z=p*g*S-x*b*_,this._w=p*g*_+x*b*S;break;case"YZX":this._x=x*g*_+p*b*S,this._y=p*b*_+x*g*S,this._z=p*g*S-x*b*_,this._w=p*g*_-x*b*S;break;case"XZY":this._x=x*g*_-p*b*S,this._y=p*b*_-x*g*S,this._z=p*g*S+x*b*_,this._w=p*g*_+x*b*S;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+c)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],o=t[8],c=t[1],s=t[5],d=t[9],p=t[2],g=t[6],_=t[10],x=i+s+_;if(x>0){const b=.5/Math.sqrt(x+1);this._w=.25/b,this._x=(g-d)*b,this._y=(o-p)*b,this._z=(c-r)*b}else if(i>s&&i>_){const b=2*Math.sqrt(1+i-s-_);this._w=(g-d)/b,this._x=.25*b,this._y=(r+c)/b,this._z=(o+p)/b}else if(s>_){const b=2*Math.sqrt(1+s-i-_);this._w=(o-p)/b,this._x=(r+c)/b,this._y=.25*b,this._z=(d+g)/b}else{const b=2*Math.sqrt(1+_-i-s);this._w=(c-r)/b,this._x=(o+p)/b,this._y=(d+g)/b,this._z=.25*b}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(_a(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return t!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,o=e._z,c=e._w,s=t._x,d=t._y,p=t._z,g=t._w;return this._x=i*g+c*s+r*p-o*d,this._y=r*g+c*d+o*s-i*p,this._z=o*g+c*p+i*d-r*s,this._w=c*g-i*s-r*d-o*p,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,r=this._y,o=this._z,c=this._w;let s=c*e._w+i*e._x+r*e._y+o*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=c,this._x=i,this._y=r,this._z=o,this;const d=1-s*s;if(d<=Number.EPSILON){const b=1-t;return this._w=b*c+t*this._w,this._x=b*i+t*this._x,this._y=b*r+t*this._y,this._z=b*o+t*this._z,this.normalize(),this._onChangeCallback(),this}const p=Math.sqrt(d),g=Math.atan2(p,s),_=Math.sin((1-t)*g)/p,x=Math.sin(t*g)/p;return this._w=c*_+this._w*x,this._x=i*_+this._x*x,this._y=r*_+this._y*x,this._z=o*_+this._z*x,this._onChangeCallback(),this}slerpQuaternions(e,t,i){this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),o=2*Math.PI*Math.random();return this.set(t*Math.cos(r),i*Math.sin(o),i*Math.cos(o),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}go.prototype.isQuaternion=!0;class Ue{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(HR.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(HR.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,o=e.elements;return this.x=o[0]*t+o[3]*i+o[6]*r,this.y=o[1]*t+o[4]*i+o[7]*r,this.z=o[2]*t+o[5]*i+o[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,o=e.elements,c=1/(o[3]*t+o[7]*i+o[11]*r+o[15]);return this.x=(o[0]*t+o[4]*i+o[8]*r+o[12])*c,this.y=(o[1]*t+o[5]*i+o[9]*r+o[13])*c,this.z=(o[2]*t+o[6]*i+o[10]*r+o[14])*c,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,o=e.x,c=e.y,s=e.z,d=e.w,p=d*t+c*r-s*i,g=d*i+s*t-o*r,_=d*r+o*i-c*t,x=-o*t-c*i-s*r;return this.x=p*d+x*-o+g*-s-_*-c,this.y=g*d+x*-c+_*-o-p*-s,this.z=_*d+x*-s+p*-c-g*-o,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r,this.y=o[1]*t+o[5]*i+o[9]*r,this.z=o[2]*t+o[6]*i+o[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e,t){return t!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,o=e.z,c=t.x,s=t.y,d=t.z;return this.x=r*d-o*s,this.y=o*c-i*d,this.z=i*s-r*c,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return ET.copy(this).projectOnVector(e),this.sub(ET)}reflect(e){return this.sub(ET.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(_a(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,i){return i!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}Ue.prototype.isVector3=!0;const ET=new Ue,HR=new go;class ul{constructor(e=new Ue(1/0,1/0,1/0),t=new Ue(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,r=1/0,o=-1/0,c=-1/0,s=-1/0;for(let d=0,p=e.length;d<p;d+=3){const g=e[d],_=e[d+1],x=e[d+2];g<t&&(t=g),_<i&&(i=_),x<r&&(r=x),g>o&&(o=g),_>c&&(c=_),x>s&&(s=x)}return this.min.set(t,i,r),this.max.set(o,c,s),this}setFromBufferAttribute(e){let t=1/0,i=1/0,r=1/0,o=-1/0,c=-1/0,s=-1/0;for(let d=0,p=e.count;d<p;d++){const g=e.getX(d),_=e.getY(d),x=e.getZ(d);g<t&&(t=g),_<i&&(i=_),x<r&&(r=x),g>o&&(o=g),_>c&&(c=_),x>s&&(s=x)}return this.min.set(t,i,r),this.max.set(o,c,s),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Cv.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;t!==void 0&&(t.boundingBox===null&&t.computeBoundingBox(),AT.copy(t.boundingBox),AT.applyMatrix4(e.matrixWorld),this.union(AT));const i=e.children;for(let r=0,o=i.length;r<o;r++)this.expandByObject(i[r]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Cv),Cv.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Ev),Nb.subVectors(this.max,Ev),Vm.subVectors(e.a,Ev),Um.subVectors(e.b,Ev),jm.subVectors(e.c,Ev),ud.subVectors(Um,Vm),hd.subVectors(jm,Um),Uf.subVectors(Vm,jm);let t=[0,-ud.z,ud.y,0,-hd.z,hd.y,0,-Uf.z,Uf.y,ud.z,0,-ud.x,hd.z,0,-hd.x,Uf.z,0,-Uf.x,-ud.y,ud.x,0,-hd.y,hd.x,0,-Uf.y,Uf.x,0];return!PT(t,Vm,Um,jm,Nb)||(t=[1,0,0,0,1,0,0,0,1],!PT(t,Vm,Um,jm,Nb))?!1:($b.crossVectors(ud,hd),t=[$b.x,$b.y,$b.z],PT(t,Vm,Um,jm,Nb))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Cv.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(Cv).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(eh[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),eh[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),eh[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),eh[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),eh[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),eh[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),eh[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),eh[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(eh),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}ul.prototype.isBox3=!0;const eh=[new Ue,new Ue,new Ue,new Ue,new Ue,new Ue,new Ue,new Ue],Cv=new Ue,AT=new ul,Vm=new Ue,Um=new Ue,jm=new Ue,ud=new Ue,hd=new Ue,Uf=new Ue,Ev=new Ue,Nb=new Ue,$b=new Ue,jf=new Ue;function PT(n,e,t,i,r){for(let o=0,c=n.length-3;o<=c;o+=3){jf.fromArray(n,o);const s=r.x*Math.abs(jf.x)+r.y*Math.abs(jf.y)+r.z*Math.abs(jf.z),d=e.dot(jf),p=t.dot(jf),g=i.dot(jf);if(Math.max(-Math.max(d,p,g),Math.min(d,p,g))>s)return!1}return!0}const N9=new ul,ZR=new Ue,IT=new Ue,RT=new Ue;class d_{constructor(e=new Ue,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):N9.setFromPoints(e).getCenter(i);let r=0;for(let o=0,c=e.length;o<c;o++)r=Math.max(r,i.distanceToSquared(e[o]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){RT.subVectors(e,this.center);const t=RT.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),r=(i-this.radius)*.5;this.center.add(RT.multiplyScalar(r/i)),this.radius+=r}return this}union(e){return IT.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(ZR.copy(e.center).add(IT)),this.expandByPoint(ZR.copy(e.center).sub(IT)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const th=new Ue,LT=new Ue,Vb=new Ue,dd=new Ue,kT=new Ue,Ub=new Ue,DT=new Ue;class Mp{constructor(e=new Ue,t=new Ue(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,th)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=th.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(th.copy(this.direction).multiplyScalar(t).add(this.origin),th.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){LT.copy(e).add(t).multiplyScalar(.5),Vb.copy(t).sub(e).normalize(),dd.copy(this.origin).sub(LT);const o=e.distanceTo(t)*.5,c=-this.direction.dot(Vb),s=dd.dot(this.direction),d=-dd.dot(Vb),p=dd.lengthSq(),g=Math.abs(1-c*c);let _,x,b,S;if(g>0)if(_=c*d-s,x=c*s-d,S=o*g,_>=0)if(x>=-S)if(x<=S){const P=1/g;_*=P,x*=P,b=_*(_+c*x+2*s)+x*(c*_+x+2*d)+p}else x=o,_=Math.max(0,-(c*x+s)),b=-_*_+x*(x+2*d)+p;else x=-o,_=Math.max(0,-(c*x+s)),b=-_*_+x*(x+2*d)+p;else x<=-S?(_=Math.max(0,-(-c*o+s)),x=_>0?-o:Math.min(Math.max(-o,-d),o),b=-_*_+x*(x+2*d)+p):x<=S?(_=0,x=Math.min(Math.max(-o,-d),o),b=x*(x+2*d)+p):(_=Math.max(0,-(c*o+s)),x=_>0?o:Math.min(Math.max(-o,-d),o),b=-_*_+x*(x+2*d)+p);else x=c>0?-o:o,_=Math.max(0,-(c*x+s)),b=-_*_+x*(x+2*d)+p;return i&&i.copy(this.direction).multiplyScalar(_).add(this.origin),r&&r.copy(Vb).multiplyScalar(x).add(LT),b}intersectSphere(e,t){th.subVectors(e.center,this.origin);const i=th.dot(this.direction),r=th.dot(th)-i*i,o=e.radius*e.radius;if(r>o)return null;const c=Math.sqrt(o-r),s=i-c,d=i+c;return s<0&&d<0?null:s<0?this.at(d,t):this.at(s,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,o,c,s,d;const p=1/this.direction.x,g=1/this.direction.y,_=1/this.direction.z,x=this.origin;return p>=0?(i=(e.min.x-x.x)*p,r=(e.max.x-x.x)*p):(i=(e.max.x-x.x)*p,r=(e.min.x-x.x)*p),g>=0?(o=(e.min.y-x.y)*g,c=(e.max.y-x.y)*g):(o=(e.max.y-x.y)*g,c=(e.min.y-x.y)*g),i>c||o>r||((o>i||i!==i)&&(i=o),(c<r||r!==r)&&(r=c),_>=0?(s=(e.min.z-x.z)*_,d=(e.max.z-x.z)*_):(s=(e.max.z-x.z)*_,d=(e.min.z-x.z)*_),i>d||s>r)||((s>i||i!==i)&&(i=s),(d<r||r!==r)&&(r=d),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return this.intersectBox(e,th)!==null}intersectTriangle(e,t,i,r,o){kT.subVectors(t,e),Ub.subVectors(i,e),DT.crossVectors(kT,Ub);let c=this.direction.dot(DT),s;if(c>0){if(r)return null;s=1}else if(c<0)s=-1,c=-c;else return null;dd.subVectors(this.origin,e);const d=s*this.direction.dot(Ub.crossVectors(dd,Ub));if(d<0)return null;const p=s*this.direction.dot(kT.cross(dd));if(p<0||d+p>c)return null;const g=-s*dd.dot(DT);return g<0?null:this.at(g/c,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Li{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,r,o,c,s,d,p,g,_,x,b,S,P,L){const E=this.elements;return E[0]=e,E[4]=t,E[8]=i,E[12]=r,E[1]=o,E[5]=c,E[9]=s,E[13]=d,E[2]=p,E[6]=g,E[10]=_,E[14]=x,E[3]=b,E[7]=S,E[11]=P,E[15]=L,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Li().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,r=1/Gm.setFromMatrixColumn(e,0).length(),o=1/Gm.setFromMatrixColumn(e,1).length(),c=1/Gm.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*o,t[5]=i[5]*o,t[6]=i[6]*o,t[7]=0,t[8]=i[8]*c,t[9]=i[9]*c,t[10]=i[10]*c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,i=e.x,r=e.y,o=e.z,c=Math.cos(i),s=Math.sin(i),d=Math.cos(r),p=Math.sin(r),g=Math.cos(o),_=Math.sin(o);if(e.order==="XYZ"){const x=c*g,b=c*_,S=s*g,P=s*_;t[0]=d*g,t[4]=-d*_,t[8]=p,t[1]=b+S*p,t[5]=x-P*p,t[9]=-s*d,t[2]=P-x*p,t[6]=S+b*p,t[10]=c*d}else if(e.order==="YXZ"){const x=d*g,b=d*_,S=p*g,P=p*_;t[0]=x+P*s,t[4]=S*s-b,t[8]=c*p,t[1]=c*_,t[5]=c*g,t[9]=-s,t[2]=b*s-S,t[6]=P+x*s,t[10]=c*d}else if(e.order==="ZXY"){const x=d*g,b=d*_,S=p*g,P=p*_;t[0]=x-P*s,t[4]=-c*_,t[8]=S+b*s,t[1]=b+S*s,t[5]=c*g,t[9]=P-x*s,t[2]=-c*p,t[6]=s,t[10]=c*d}else if(e.order==="ZYX"){const x=c*g,b=c*_,S=s*g,P=s*_;t[0]=d*g,t[4]=S*p-b,t[8]=x*p+P,t[1]=d*_,t[5]=P*p+x,t[9]=b*p-S,t[2]=-p,t[6]=s*d,t[10]=c*d}else if(e.order==="YZX"){const x=c*d,b=c*p,S=s*d,P=s*p;t[0]=d*g,t[4]=P-x*_,t[8]=S*_+b,t[1]=_,t[5]=c*g,t[9]=-s*g,t[2]=-p*g,t[6]=b*_+S,t[10]=x-P*_}else if(e.order==="XZY"){const x=c*d,b=c*p,S=s*d,P=s*p;t[0]=d*g,t[4]=-_,t[8]=p*g,t[1]=x*_+P,t[5]=c*g,t[9]=b*_-S,t[2]=S*_-b,t[6]=s*g,t[10]=P*_+x}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose($9,e,V9)}lookAt(e,t,i){const r=this.elements;return Wa.subVectors(e,t),Wa.lengthSq()===0&&(Wa.z=1),Wa.normalize(),fd.crossVectors(i,Wa),fd.lengthSq()===0&&(Math.abs(i.z)===1?Wa.x+=1e-4:Wa.z+=1e-4,Wa.normalize(),fd.crossVectors(i,Wa)),fd.normalize(),jb.crossVectors(Wa,fd),r[0]=fd.x,r[4]=jb.x,r[8]=Wa.x,r[1]=fd.y,r[5]=jb.y,r[9]=Wa.y,r[2]=fd.z,r[6]=jb.z,r[10]=Wa.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,o=this.elements,c=i[0],s=i[4],d=i[8],p=i[12],g=i[1],_=i[5],x=i[9],b=i[13],S=i[2],P=i[6],L=i[10],E=i[14],C=i[3],D=i[7],O=i[11],U=i[15],q=r[0],G=r[4],N=r[8],V=r[12],j=r[1],z=r[5],Q=r[9],X=r[13],re=r[2],se=r[6],le=r[10],ce=r[14],be=r[3],Ee=r[7],$e=r[11],Ve=r[15];return o[0]=c*q+s*j+d*re+p*be,o[4]=c*G+s*z+d*se+p*Ee,o[8]=c*N+s*Q+d*le+p*$e,o[12]=c*V+s*X+d*ce+p*Ve,o[1]=g*q+_*j+x*re+b*be,o[5]=g*G+_*z+x*se+b*Ee,o[9]=g*N+_*Q+x*le+b*$e,o[13]=g*V+_*X+x*ce+b*Ve,o[2]=S*q+P*j+L*re+E*be,o[6]=S*G+P*z+L*se+E*Ee,o[10]=S*N+P*Q+L*le+E*$e,o[14]=S*V+P*X+L*ce+E*Ve,o[3]=C*q+D*j+O*re+U*be,o[7]=C*G+D*z+O*se+U*Ee,o[11]=C*N+D*Q+O*le+U*$e,o[15]=C*V+D*X+O*ce+U*Ve,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],r=e[8],o=e[12],c=e[1],s=e[5],d=e[9],p=e[13],g=e[2],_=e[6],x=e[10],b=e[14],S=e[3],P=e[7],L=e[11],E=e[15];return S*(+o*d*_-r*p*_-o*s*x+i*p*x+r*s*b-i*d*b)+P*(+t*d*b-t*p*x+o*c*x-r*c*b+r*p*g-o*d*g)+L*(+t*p*_-t*s*b-o*c*_+i*c*b+o*s*g-i*p*g)+E*(-r*s*g-t*d*_+t*s*x+r*c*_-i*c*x+i*d*g)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],o=e[3],c=e[4],s=e[5],d=e[6],p=e[7],g=e[8],_=e[9],x=e[10],b=e[11],S=e[12],P=e[13],L=e[14],E=e[15],C=_*L*p-P*x*p+P*d*b-s*L*b-_*d*E+s*x*E,D=S*x*p-g*L*p-S*d*b+c*L*b+g*d*E-c*x*E,O=g*P*p-S*_*p+S*s*b-c*P*b-g*s*E+c*_*E,U=S*_*d-g*P*d-S*s*x+c*P*x+g*s*L-c*_*L,q=t*C+i*D+r*O+o*U;if(q===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const G=1/q;return e[0]=C*G,e[1]=(P*x*o-_*L*o-P*r*b+i*L*b+_*r*E-i*x*E)*G,e[2]=(s*L*o-P*d*o+P*r*p-i*L*p-s*r*E+i*d*E)*G,e[3]=(_*d*o-s*x*o-_*r*p+i*x*p+s*r*b-i*d*b)*G,e[4]=D*G,e[5]=(g*L*o-S*x*o+S*r*b-t*L*b-g*r*E+t*x*E)*G,e[6]=(S*d*o-c*L*o-S*r*p+t*L*p+c*r*E-t*d*E)*G,e[7]=(c*x*o-g*d*o+g*r*p-t*x*p-c*r*b+t*d*b)*G,e[8]=O*G,e[9]=(S*_*o-g*P*o-S*i*b+t*P*b+g*i*E-t*_*E)*G,e[10]=(c*P*o-S*s*o+S*i*p-t*P*p-c*i*E+t*s*E)*G,e[11]=(g*s*o-c*_*o-g*i*p+t*_*p+c*i*b-t*s*b)*G,e[12]=U*G,e[13]=(g*P*r-S*_*r+S*i*x-t*P*x-g*i*L+t*_*L)*G,e[14]=(S*s*r-c*P*r-S*i*d+t*P*d+c*i*L-t*s*L)*G,e[15]=(c*_*r-g*s*r+g*i*d-t*_*d-c*i*x+t*s*x)*G,this}scale(e){const t=this.elements,i=e.x,r=e.y,o=e.z;return t[0]*=i,t[4]*=r,t[8]*=o,t[1]*=i,t[5]*=r,t[9]*=o,t[2]*=i,t[6]*=r,t[10]*=o,t[3]*=i,t[7]*=r,t[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),r=Math.sin(t),o=1-i,c=e.x,s=e.y,d=e.z,p=o*c,g=o*s;return this.set(p*c+i,p*s-r*d,p*d+r*s,0,p*s+r*d,g*s+i,g*d-r*c,0,p*d-r*s,g*d+r*c,o*d*d+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,o,c){return this.set(1,i,o,0,e,1,c,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){const r=this.elements,o=t._x,c=t._y,s=t._z,d=t._w,p=o+o,g=c+c,_=s+s,x=o*p,b=o*g,S=o*_,P=c*g,L=c*_,E=s*_,C=d*p,D=d*g,O=d*_,U=i.x,q=i.y,G=i.z;return r[0]=(1-(P+E))*U,r[1]=(b+O)*U,r[2]=(S-D)*U,r[3]=0,r[4]=(b-O)*q,r[5]=(1-(x+E))*q,r[6]=(L+C)*q,r[7]=0,r[8]=(S+D)*G,r[9]=(L-C)*G,r[10]=(1-(x+P))*G,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){const r=this.elements;let o=Gm.set(r[0],r[1],r[2]).length();const c=Gm.set(r[4],r[5],r[6]).length(),s=Gm.set(r[8],r[9],r[10]).length();this.determinant()<0&&(o=-o),e.x=r[12],e.y=r[13],e.z=r[14],_c.copy(this);const p=1/o,g=1/c,_=1/s;return _c.elements[0]*=p,_c.elements[1]*=p,_c.elements[2]*=p,_c.elements[4]*=g,_c.elements[5]*=g,_c.elements[6]*=g,_c.elements[8]*=_,_c.elements[9]*=_,_c.elements[10]*=_,t.setFromRotationMatrix(_c),i.x=o,i.y=c,i.z=s,this}makePerspective(e,t,i,r,o,c){c===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const s=this.elements,d=2*o/(t-e),p=2*o/(i-r),g=(t+e)/(t-e),_=(i+r)/(i-r),x=-(c+o)/(c-o),b=-2*c*o/(c-o);return s[0]=d,s[4]=0,s[8]=g,s[12]=0,s[1]=0,s[5]=p,s[9]=_,s[13]=0,s[2]=0,s[6]=0,s[10]=x,s[14]=b,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(e,t,i,r,o,c){const s=this.elements,d=1/(t-e),p=1/(i-r),g=1/(c-o),_=(t+e)*d,x=(i+r)*p,b=(c+o)*g;return s[0]=2*d,s[4]=0,s[8]=0,s[12]=-_,s[1]=0,s[5]=2*p,s[9]=0,s[13]=-x,s[2]=0,s[6]=0,s[10]=-2*g,s[14]=-b,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}Li.prototype.isMatrix4=!0;const Gm=new Ue,_c=new Li,$9=new Ue(0,0,0),V9=new Ue(1,1,1),fd=new Ue,jb=new Ue,Wa=new Ue,XR=new Li,YR=new go;class Cp{constructor(e=0,t=0,i=0,r=Cp.DefaultOrder){this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const r=e.elements,o=r[0],c=r[4],s=r[8],d=r[1],p=r[5],g=r[9],_=r[2],x=r[6],b=r[10];switch(t){case"XYZ":this._y=Math.asin(_a(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-g,b),this._z=Math.atan2(-c,o)):(this._x=Math.atan2(x,p),this._z=0);break;case"YXZ":this._x=Math.asin(-_a(g,-1,1)),Math.abs(g)<.9999999?(this._y=Math.atan2(s,b),this._z=Math.atan2(d,p)):(this._y=Math.atan2(-_,o),this._z=0);break;case"ZXY":this._x=Math.asin(_a(x,-1,1)),Math.abs(x)<.9999999?(this._y=Math.atan2(-_,b),this._z=Math.atan2(-c,p)):(this._y=0,this._z=Math.atan2(d,o));break;case"ZYX":this._y=Math.asin(-_a(_,-1,1)),Math.abs(_)<.9999999?(this._x=Math.atan2(x,b),this._z=Math.atan2(d,o)):(this._x=0,this._z=Math.atan2(-c,p));break;case"YZX":this._z=Math.asin(_a(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(-g,p),this._y=Math.atan2(-_,o)):(this._x=0,this._y=Math.atan2(s,b));break;case"XZY":this._z=Math.asin(-_a(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(x,p),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-g,b),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return XR.makeRotationFromQuaternion(e),this.setFromRotationMatrix(XR,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return YR.setFromEuler(this),this.setFromQuaternion(YR,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new Ue(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Cp.prototype.isEuler=!0;Cp.DefaultOrder="XYZ";Cp.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class sz{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}}let U9=0;const KR=new Ue,qm=new go,ih=new Li,Gb=new Ue,Av=new Ue,j9=new Ue,G9=new go,JR=new Ue(1,0,0),QR=new Ue(0,1,0),eL=new Ue(0,0,1),q9={type:"added"},tL={type:"removed"};class Ln extends Tp{constructor(){super(),Object.defineProperty(this,"id",{value:U9++}),this.uuid=Tc(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ln.DefaultUp.clone();const e=new Ue,t=new Cp,i=new go,r=new Ue(1,1,1);function o(){i.setFromEuler(t,!1)}function c(){t.setFromQuaternion(i,void 0,!1)}t._onChange(o),i._onChange(c),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Li},normalMatrix:{value:new mo}}),this.matrix=new Li,this.matrixWorld=new Li,this.matrixAutoUpdate=Ln.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new sz,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return qm.setFromAxisAngle(e,t),this.quaternion.multiply(qm),this}rotateOnWorldAxis(e,t){return qm.setFromAxisAngle(e,t),this.quaternion.premultiply(qm),this}rotateX(e){return this.rotateOnAxis(JR,e)}rotateY(e){return this.rotateOnAxis(QR,e)}rotateZ(e){return this.rotateOnAxis(eL,e)}translateOnAxis(e,t){return KR.copy(e).applyQuaternion(this.quaternion),this.position.add(KR.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(JR,e)}translateY(e){return this.translateOnAxis(QR,e)}translateZ(e){return this.translateOnAxis(eL,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(ih.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Gb.copy(e):Gb.set(e,t,i);const r=this.parent;this.updateWorldMatrix(!0,!1),Av.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ih.lookAt(Av,Gb,this.up):ih.lookAt(Gb,Av,this.up),this.quaternion.setFromRotationMatrix(ih),r&&(ih.extractRotation(r.matrixWorld),qm.setFromRotationMatrix(ih),this.quaternion.premultiply(qm.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(q9)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(tL)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(tL)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),ih.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),ih.multiply(e.parent.matrixWorld)),e.applyMatrix4(ih),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){const c=this.children[i].getObjectByProperty(e,t);if(c!==void 0)return c}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Av,e,j9),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Av,G9,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const r=this.children;for(let o=0,c=r.length;o<c;o++)r[o].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function o(s,d){return s[d.uuid]===void 0&&(s[d.uuid]=d.toJSON(e)),d.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=o(e.geometries,this.geometry);const s=this.geometry.parameters;if(s!==void 0&&s.shapes!==void 0){const d=s.shapes;if(Array.isArray(d))for(let p=0,g=d.length;p<g;p++){const _=d[p];o(e.shapes,_)}else o(e.shapes,d)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const s=[];for(let d=0,p=this.material.length;d<p;d++)s.push(o(e.materials,this.material[d]));r.material=s}else r.material=o(e.materials,this.material);if(this.children.length>0){r.children=[];for(let s=0;s<this.children.length;s++)r.children.push(this.children[s].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let s=0;s<this.animations.length;s++){const d=this.animations[s];r.animations.push(o(e.animations,d))}}if(t){const s=c(e.geometries),d=c(e.materials),p=c(e.textures),g=c(e.images),_=c(e.shapes),x=c(e.skeletons),b=c(e.animations);s.length>0&&(i.geometries=s),d.length>0&&(i.materials=d),p.length>0&&(i.textures=p),g.length>0&&(i.images=g),_.length>0&&(i.shapes=_),x.length>0&&(i.skeletons=x),b.length>0&&(i.animations=b)}return i.object=r,i;function c(s){const d=[];for(const p in s){const g=s[p];delete g.metadata,d.push(g)}return d}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const r=e.children[i];this.add(r.clone())}return this}}Ln.DefaultUp=new Ue(0,1,0);Ln.DefaultMatrixAutoUpdate=!0;Ln.prototype.isObject3D=!0;const vc=new Ue,nh=new Ue,FT=new Ue,rh=new Ue,Wm=new Ue,Hm=new Ue,iL=new Ue,OT=new Ue,zT=new Ue,BT=new Ue;class Xs{constructor(e=new Ue,t=new Ue,i=new Ue){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),vc.subVectors(e,t),r.cross(vc);const o=r.lengthSq();return o>0?r.multiplyScalar(1/Math.sqrt(o)):r.set(0,0,0)}static getBarycoord(e,t,i,r,o){vc.subVectors(r,t),nh.subVectors(i,t),FT.subVectors(e,t);const c=vc.dot(vc),s=vc.dot(nh),d=vc.dot(FT),p=nh.dot(nh),g=nh.dot(FT),_=c*p-s*s;if(_===0)return o.set(-2,-1,-1);const x=1/_,b=(p*d-s*g)*x,S=(c*g-s*d)*x;return o.set(1-b-S,S,b)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,rh),rh.x>=0&&rh.y>=0&&rh.x+rh.y<=1}static getUV(e,t,i,r,o,c,s,d){return this.getBarycoord(e,t,i,r,rh),d.set(0,0),d.addScaledVector(o,rh.x),d.addScaledVector(c,rh.y),d.addScaledVector(s,rh.z),d}static isFrontFacing(e,t,i,r){return vc.subVectors(i,t),nh.subVectors(e,t),vc.cross(nh).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return vc.subVectors(this.c,this.b),nh.subVectors(this.a,this.b),vc.cross(nh).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Xs.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Xs.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,r,o){return Xs.getUV(e,this.a,this.b,this.c,t,i,r,o)}containsPoint(e){return Xs.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Xs.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,r=this.b,o=this.c;let c,s;Wm.subVectors(r,i),Hm.subVectors(o,i),OT.subVectors(e,i);const d=Wm.dot(OT),p=Hm.dot(OT);if(d<=0&&p<=0)return t.copy(i);zT.subVectors(e,r);const g=Wm.dot(zT),_=Hm.dot(zT);if(g>=0&&_<=g)return t.copy(r);const x=d*_-g*p;if(x<=0&&d>=0&&g<=0)return c=d/(d-g),t.copy(i).addScaledVector(Wm,c);BT.subVectors(e,o);const b=Wm.dot(BT),S=Hm.dot(BT);if(S>=0&&b<=S)return t.copy(o);const P=b*p-d*S;if(P<=0&&p>=0&&S<=0)return s=p/(p-S),t.copy(i).addScaledVector(Hm,s);const L=g*S-b*_;if(L<=0&&_-g>=0&&b-S>=0)return iL.subVectors(o,r),s=(_-g)/(_-g+(b-S)),t.copy(r).addScaledVector(iL,s);const E=1/(L+P+x);return c=P*E,s=x*E,t.copy(i).addScaledVector(Wm,c).addScaledVector(Hm,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let W9=0;class Bo extends Tp{constructor(){super(),Object.defineProperty(this,"id",{value:W9++}),this.uuid=Tc(),this.name="",this.type="Material",this.fog=!0,this.blending=fy,this.side=Wg,this.vertexColors=!1,this.opacity=1,this.format=aa,this.transparent=!1,this.blendSrc=XO,this.blendDst=YO,this.blendEquation=fg,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=i2,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=x9,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=MT,this.stencilZFail=MT,this.stencilZPass=MT,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if(t==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===ZO;continue}const r=this[t];if(r===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==fy&&(i.blending=this.blending),this.side!==Wg&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.format!==aa&&(i.format=this.format),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData);function r(o){const c=[];for(const s in o){const d=o[s];delete d.metadata,c.push(d)}return c}if(t){const o=r(e.textures),c=r(e.images);o.length>0&&(i.textures=o),c.length>0&&(i.images=c)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.format=e.format,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const r=t.length;i=new Array(r);for(let o=0;o!==r;++o)i[o]=t[o].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}Bo.prototype.isMaterial=!0;const oz={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},yc={h:0,s:0,l:0},qb={h:0,s:0,l:0};function NT(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}function $T(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function VT(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}class Bi{constructor(e,t,i){return t===void 0&&i===void 0?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this}setRGB(e,t,i){return this.r=e,this.g=t,this.b=i,this}setHSL(e,t,i){if(e=IC(e,1),t=_a(t,0,1),i=_a(i,0,1),t===0)this.r=this.g=this.b=i;else{const r=i<=.5?i*(1+t):i+t-i*t,o=2*i-r;this.r=NT(o,r,e+1/3),this.g=NT(o,r,e),this.b=NT(o,r,e-1/3)}return this}setStyle(e){function t(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let r;const o=i[1],c=i[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,t(r[4]),this;if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,t(r[4]),this;break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c)){const s=parseFloat(r[1])/360,d=parseInt(r[2],10)/100,p=parseInt(r[3],10)/100;return t(r[4]),this.setHSL(s,d,p)}break}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=i[1],o=r.length;if(o===3)return this.r=parseInt(r.charAt(0)+r.charAt(0),16)/255,this.g=parseInt(r.charAt(1)+r.charAt(1),16)/255,this.b=parseInt(r.charAt(2)+r.charAt(2),16)/255,this;if(o===6)return this.r=parseInt(r.charAt(0)+r.charAt(1),16)/255,this.g=parseInt(r.charAt(2)+r.charAt(3),16)/255,this.b=parseInt(r.charAt(4)+r.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=oz[e.toLowerCase()];return t!==void 0?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){const i=t>0?1/t:1;return this.r=Math.pow(e.r,i),this.g=Math.pow(e.g,i),this.b=Math.pow(e.b,i),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=$T(e.r),this.g=$T(e.g),this.b=$T(e.b),this}copyLinearToSRGB(e){return this.r=VT(e.r),this.g=VT(e.g),this.b=VT(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return this.r*255<<16^this.g*255<<8^this.b*255<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){const t=this.r,i=this.g,r=this.b,o=Math.max(t,i,r),c=Math.min(t,i,r);let s,d;const p=(c+o)/2;if(c===o)s=0,d=0;else{const g=o-c;switch(d=p<=.5?g/(o+c):g/(2-o-c),o){case t:s=(i-r)/g+(i<r?6:0);break;case i:s=(r-t)/g+2;break;case r:s=(t-i)/g+4;break}s/=6}return e.h=s,e.s=d,e.l=p,e}getStyle(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"}offsetHSL(e,t,i){return this.getHSL(yc),yc.h+=e,yc.s+=t,yc.l+=i,this.setHSL(yc.h,yc.s,yc.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(yc),e.getHSL(qb);const i=gy(yc.h,qb.h,t),r=gy(yc.s,qb.s,t),o=gy(yc.l,qb.l,t);return this.setHSL(i,r,o),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),e.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Bi.NAMES=oz;Bi.prototype.isColor=!0;Bi.prototype.r=1;Bi.prototype.g=1;Bi.prototype.b=1;class f0 extends Bo{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new Bi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=a1,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}f0.prototype.isMeshBasicMaterial=!0;const Lr=new Ue,Wb=new li;class Mn{constructor(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i===!0,this.usage=zy,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,o=this.itemSize;r<o;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let i=0;for(let r=0,o=e.length;r<o;r++){let c=e[r];c===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),c=new Bi),t[i++]=c.r,t[i++]=c.g,t[i++]=c.b}return this}copyVector2sArray(e){const t=this.array;let i=0;for(let r=0,o=e.length;r<o;r++){let c=e[r];c===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),c=new li),t[i++]=c.x,t[i++]=c.y}return this}copyVector3sArray(e){const t=this.array;let i=0;for(let r=0,o=e.length;r<o;r++){let c=e[r];c===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),c=new Ue),t[i++]=c.x,t[i++]=c.y,t[i++]=c.z}return this}copyVector4sArray(e){const t=this.array;let i=0;for(let r=0,o=e.length;r<o;r++){let c=e[r];c===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),c=new Zn),t[i++]=c.x,t[i++]=c.y,t[i++]=c.z,t[i++]=c.w}return this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)Wb.fromBufferAttribute(this,t),Wb.applyMatrix3(e),this.setXY(t,Wb.x,Wb.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)Lr.fromBufferAttribute(this,t),Lr.applyMatrix3(e),this.setXYZ(t,Lr.x,Lr.y,Lr.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)Lr.x=this.getX(t),Lr.y=this.getY(t),Lr.z=this.getZ(t),Lr.applyMatrix4(e),this.setXYZ(t,Lr.x,Lr.y,Lr.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Lr.x=this.getX(t),Lr.y=this.getY(t),Lr.z=this.getZ(t),Lr.applyNormalMatrix(e),this.setXYZ(t,Lr.x,Lr.y,Lr.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Lr.x=this.getX(t),Lr.y=this.getY(t),Lr.z=this.getZ(t),Lr.transformDirection(e),this.setXYZ(t,Lr.x,Lr.y,Lr.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,o){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==zy&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}}Mn.prototype.isBufferAttribute=!0;class az extends Mn{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class lz extends Mn{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class H9 extends Mn{constructor(e,t,i){super(new Uint16Array(e),t,i)}}H9.prototype.isFloat16BufferAttribute=!0;class Ts extends Mn{constructor(e,t,i){super(new Float32Array(e),t,i)}}let Z9=0;const Cl=new Li,UT=new Ln,Zm=new Ue,Ha=new ul,Pv=new ul,io=new Ue;class Vn extends Tp{constructor(){super(),Object.defineProperty(this,"id",{value:Z9++}),this.uuid=Tc(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(nz(e)>65535?lz:az)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const o=new mo().getNormalMatrix(e);i.applyNormalMatrix(o),i.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Cl.makeRotationFromQuaternion(e),this.applyMatrix4(Cl),this}rotateX(e){return Cl.makeRotationX(e),this.applyMatrix4(Cl),this}rotateY(e){return Cl.makeRotationY(e),this.applyMatrix4(Cl),this}rotateZ(e){return Cl.makeRotationZ(e),this.applyMatrix4(Cl),this}translate(e,t,i){return Cl.makeTranslation(e,t,i),this.applyMatrix4(Cl),this}scale(e,t,i){return Cl.makeScale(e,t,i),this.applyMatrix4(Cl),this}lookAt(e){return UT.lookAt(e),UT.updateMatrix(),this.applyMatrix4(UT.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Zm).negate(),this.translate(Zm.x,Zm.y,Zm.z),this}setFromPoints(e){const t=[];for(let i=0,r=e.length;i<r;i++){const o=e[i];t.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new Ts(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ul);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new Ue(-1/0,-1/0,-1/0),new Ue(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++){const o=t[i];Ha.setFromBufferAttribute(o),this.morphTargetsRelative?(io.addVectors(this.boundingBox.min,Ha.min),this.boundingBox.expandByPoint(io),io.addVectors(this.boundingBox.max,Ha.max),this.boundingBox.expandByPoint(io)):(this.boundingBox.expandByPoint(Ha.min),this.boundingBox.expandByPoint(Ha.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new d_);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new Ue,1/0);return}if(e){const i=this.boundingSphere.center;if(Ha.setFromBufferAttribute(e),t)for(let o=0,c=t.length;o<c;o++){const s=t[o];Pv.setFromBufferAttribute(s),this.morphTargetsRelative?(io.addVectors(Ha.min,Pv.min),Ha.expandByPoint(io),io.addVectors(Ha.max,Pv.max),Ha.expandByPoint(io)):(Ha.expandByPoint(Pv.min),Ha.expandByPoint(Pv.max))}Ha.getCenter(i);let r=0;for(let o=0,c=e.count;o<c;o++)io.fromBufferAttribute(e,o),r=Math.max(r,i.distanceToSquared(io));if(t)for(let o=0,c=t.length;o<c;o++){const s=t[o],d=this.morphTargetsRelative;for(let p=0,g=s.count;p<g;p++)io.fromBufferAttribute(s,p),d&&(Zm.fromBufferAttribute(e,p),io.add(Zm)),r=Math.max(r,i.distanceToSquared(io))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=e.array,r=t.position.array,o=t.normal.array,c=t.uv.array,s=r.length/3;t.tangent===void 0&&this.setAttribute("tangent",new Mn(new Float32Array(4*s),4));const d=t.tangent.array,p=[],g=[];for(let j=0;j<s;j++)p[j]=new Ue,g[j]=new Ue;const _=new Ue,x=new Ue,b=new Ue,S=new li,P=new li,L=new li,E=new Ue,C=new Ue;function D(j,z,Q){_.fromArray(r,j*3),x.fromArray(r,z*3),b.fromArray(r,Q*3),S.fromArray(c,j*2),P.fromArray(c,z*2),L.fromArray(c,Q*2),x.sub(_),b.sub(_),P.sub(S),L.sub(S);const X=1/(P.x*L.y-L.x*P.y);isFinite(X)&&(E.copy(x).multiplyScalar(L.y).addScaledVector(b,-P.y).multiplyScalar(X),C.copy(b).multiplyScalar(P.x).addScaledVector(x,-L.x).multiplyScalar(X),p[j].add(E),p[z].add(E),p[Q].add(E),g[j].add(C),g[z].add(C),g[Q].add(C))}let O=this.groups;O.length===0&&(O=[{start:0,count:i.length}]);for(let j=0,z=O.length;j<z;++j){const Q=O[j],X=Q.start,re=Q.count;for(let se=X,le=X+re;se<le;se+=3)D(i[se+0],i[se+1],i[se+2])}const U=new Ue,q=new Ue,G=new Ue,N=new Ue;function V(j){G.fromArray(o,j*3),N.copy(G);const z=p[j];U.copy(z),U.sub(G.multiplyScalar(G.dot(z))).normalize(),q.crossVectors(N,z);const X=q.dot(g[j])<0?-1:1;d[j*4]=U.x,d[j*4+1]=U.y,d[j*4+2]=U.z,d[j*4+3]=X}for(let j=0,z=O.length;j<z;++j){const Q=O[j],X=Q.start,re=Q.count;for(let se=X,le=X+re;se<le;se+=3)V(i[se+0]),V(i[se+1]),V(i[se+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Mn(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let x=0,b=i.count;x<b;x++)i.setXYZ(x,0,0,0);const r=new Ue,o=new Ue,c=new Ue,s=new Ue,d=new Ue,p=new Ue,g=new Ue,_=new Ue;if(e)for(let x=0,b=e.count;x<b;x+=3){const S=e.getX(x+0),P=e.getX(x+1),L=e.getX(x+2);r.fromBufferAttribute(t,S),o.fromBufferAttribute(t,P),c.fromBufferAttribute(t,L),g.subVectors(c,o),_.subVectors(r,o),g.cross(_),s.fromBufferAttribute(i,S),d.fromBufferAttribute(i,P),p.fromBufferAttribute(i,L),s.add(g),d.add(g),p.add(g),i.setXYZ(S,s.x,s.y,s.z),i.setXYZ(P,d.x,d.y,d.z),i.setXYZ(L,p.x,p.y,p.z)}else for(let x=0,b=t.count;x<b;x+=3)r.fromBufferAttribute(t,x+0),o.fromBufferAttribute(t,x+1),c.fromBufferAttribute(t,x+2),g.subVectors(c,o),_.subVectors(r,o),g.cross(_),i.setXYZ(x+0,g.x,g.y,g.z),i.setXYZ(x+1,g.x,g.y,g.z),i.setXYZ(x+2,g.x,g.y,g.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(e,t){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const r in i){if(e.attributes[r]===void 0)continue;const c=i[r].array,s=e.attributes[r],d=s.array,p=s.itemSize*t,g=Math.min(d.length,c.length-p);for(let _=0,x=p;_<g;_++,x++)c[x]=d[_]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)io.fromBufferAttribute(e,t),io.normalize(),e.setXYZ(t,io.x,io.y,io.z)}toNonIndexed(){function e(s,d){const p=s.array,g=s.itemSize,_=s.normalized,x=new p.constructor(d.length*g);let b=0,S=0;for(let P=0,L=d.length;P<L;P++){s.isInterleavedBufferAttribute?b=d[P]*s.data.stride+s.offset:b=d[P]*g;for(let E=0;E<g;E++)x[S++]=p[b++]}return new Mn(x,g,_)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Vn,i=this.index.array,r=this.attributes;for(const s in r){const d=r[s],p=e(d,i);t.setAttribute(s,p)}const o=this.morphAttributes;for(const s in o){const d=[],p=o[s];for(let g=0,_=p.length;g<_;g++){const x=p[g],b=e(x,i);d.push(b)}t.morphAttributes[s]=d}t.morphTargetsRelative=this.morphTargetsRelative;const c=this.groups;for(let s=0,d=c.length;s<d;s++){const p=c[s];t.addGroup(p.start,p.count,p.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const d=this.parameters;for(const p in d)d[p]!==void 0&&(e[p]=d[p]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const d in i){const p=i[d];e.data.attributes[d]=p.toJSON(e.data)}const r={};let o=!1;for(const d in this.morphAttributes){const p=this.morphAttributes[d],g=[];for(let _=0,x=p.length;_<x;_++){const b=p[_];g.push(b.toJSON(e.data))}g.length>0&&(r[d]=g,o=!0)}o&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const c=this.groups;c.length>0&&(e.data.groups=JSON.parse(JSON.stringify(c)));const s=this.boundingSphere;return s!==null&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const r=e.attributes;for(const p in r){const g=r[p];this.setAttribute(p,g.clone(t))}const o=e.morphAttributes;for(const p in o){const g=[],_=o[p];for(let x=0,b=_.length;x<b;x++)g.push(_[x].clone(t));this.morphAttributes[p]=g}this.morphTargetsRelative=e.morphTargetsRelative;const c=e.groups;for(let p=0,g=c.length;p<g;p++){const _=c[p];this.addGroup(_.start,_.count,_.materialIndex)}const s=e.boundingBox;s!==null&&(this.boundingBox=s.clone());const d=e.boundingSphere;return d!==null&&(this.boundingSphere=d.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}Vn.prototype.isBufferGeometry=!0;const nL=new Li,Xm=new Mp,jT=new d_,pd=new Ue,md=new Ue,gd=new Ue,GT=new Ue,qT=new Ue,WT=new Ue,Hb=new Ue,Zb=new Ue,Xb=new Ue,Yb=new li,Kb=new li,Jb=new li,HT=new Ue,Qb=new Ue;class kr extends Ln{constructor(e=new Vn,t=new f0){super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,c=r.length;o<c;o++){const s=r[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=o}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const i=this.geometry,r=this.material,o=this.matrixWorld;if(r===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),jT.copy(i.boundingSphere),jT.applyMatrix4(o),e.ray.intersectsSphere(jT)===!1)||(nL.copy(o).invert(),Xm.copy(e.ray).applyMatrix4(nL),i.boundingBox!==null&&Xm.intersectsBox(i.boundingBox)===!1))return;let c;if(i.isBufferGeometry){const s=i.index,d=i.attributes.position,p=i.morphAttributes.position,g=i.morphTargetsRelative,_=i.attributes.uv,x=i.attributes.uv2,b=i.groups,S=i.drawRange;if(s!==null)if(Array.isArray(r))for(let P=0,L=b.length;P<L;P++){const E=b[P],C=r[E.materialIndex],D=Math.max(E.start,S.start),O=Math.min(s.count,Math.min(E.start+E.count,S.start+S.count));for(let U=D,q=O;U<q;U+=3){const G=s.getX(U),N=s.getX(U+1),V=s.getX(U+2);c=ex(this,C,e,Xm,d,p,g,_,x,G,N,V),c&&(c.faceIndex=Math.floor(U/3),c.face.materialIndex=E.materialIndex,t.push(c))}}else{const P=Math.max(0,S.start),L=Math.min(s.count,S.start+S.count);for(let E=P,C=L;E<C;E+=3){const D=s.getX(E),O=s.getX(E+1),U=s.getX(E+2);c=ex(this,r,e,Xm,d,p,g,_,x,D,O,U),c&&(c.faceIndex=Math.floor(E/3),t.push(c))}}else if(d!==void 0)if(Array.isArray(r))for(let P=0,L=b.length;P<L;P++){const E=b[P],C=r[E.materialIndex],D=Math.max(E.start,S.start),O=Math.min(d.count,Math.min(E.start+E.count,S.start+S.count));for(let U=D,q=O;U<q;U+=3){const G=U,N=U+1,V=U+2;c=ex(this,C,e,Xm,d,p,g,_,x,G,N,V),c&&(c.faceIndex=Math.floor(U/3),c.face.materialIndex=E.materialIndex,t.push(c))}}else{const P=Math.max(0,S.start),L=Math.min(d.count,S.start+S.count);for(let E=P,C=L;E<C;E+=3){const D=E,O=E+1,U=E+2;c=ex(this,r,e,Xm,d,p,g,_,x,D,O,U),c&&(c.faceIndex=Math.floor(E/3),t.push(c))}}}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}kr.prototype.isMesh=!0;function X9(n,e,t,i,r,o,c,s){let d;if(e.side===qs?d=i.intersectTriangle(c,o,r,!0,s):d=i.intersectTriangle(r,o,c,e.side!==Ko,s),d===null)return null;Qb.copy(s),Qb.applyMatrix4(n.matrixWorld);const p=t.ray.origin.distanceTo(Qb);return p<t.near||p>t.far?null:{distance:p,point:Qb.clone(),object:n}}function ex(n,e,t,i,r,o,c,s,d,p,g,_){pd.fromBufferAttribute(r,p),md.fromBufferAttribute(r,g),gd.fromBufferAttribute(r,_);const x=n.morphTargetInfluences;if(o&&x){Hb.set(0,0,0),Zb.set(0,0,0),Xb.set(0,0,0);for(let S=0,P=o.length;S<P;S++){const L=x[S],E=o[S];L!==0&&(GT.fromBufferAttribute(E,p),qT.fromBufferAttribute(E,g),WT.fromBufferAttribute(E,_),c?(Hb.addScaledVector(GT,L),Zb.addScaledVector(qT,L),Xb.addScaledVector(WT,L)):(Hb.addScaledVector(GT.sub(pd),L),Zb.addScaledVector(qT.sub(md),L),Xb.addScaledVector(WT.sub(gd),L)))}pd.add(Hb),md.add(Zb),gd.add(Xb)}n.isSkinnedMesh&&(n.boneTransform(p,pd),n.boneTransform(g,md),n.boneTransform(_,gd));const b=X9(n,e,t,i,pd,md,gd,HT);if(b){s&&(Yb.fromBufferAttribute(s,p),Kb.fromBufferAttribute(s,g),Jb.fromBufferAttribute(s,_),b.uv=Xs.getUV(HT,pd,md,gd,Yb,Kb,Jb,new li)),d&&(Yb.fromBufferAttribute(d,p),Kb.fromBufferAttribute(d,g),Jb.fromBufferAttribute(d,_),b.uv2=Xs.getUV(HT,pd,md,gd,Yb,Kb,Jb,new li));const S={a:p,b:g,c:_,normal:new Ue,materialIndex:0};Xs.getNormal(pd,md,gd,S.normal),b.face=S}return b}class p0 extends Vn{constructor(e=1,t=1,i=1,r=1,o=1,c=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:o,depthSegments:c};const s=this;r=Math.floor(r),o=Math.floor(o),c=Math.floor(c);const d=[],p=[],g=[],_=[];let x=0,b=0;S("z","y","x",-1,-1,i,t,e,c,o,0),S("z","y","x",1,-1,i,t,-e,c,o,1),S("x","z","y",1,1,e,i,t,r,c,2),S("x","z","y",1,-1,e,i,-t,r,c,3),S("x","y","z",1,-1,e,t,i,r,o,4),S("x","y","z",-1,-1,e,t,-i,r,o,5),this.setIndex(d),this.setAttribute("position",new Ts(p,3)),this.setAttribute("normal",new Ts(g,3)),this.setAttribute("uv",new Ts(_,2));function S(P,L,E,C,D,O,U,q,G,N,V){const j=O/G,z=U/N,Q=O/2,X=U/2,re=q/2,se=G+1,le=N+1;let ce=0,be=0;const Ee=new Ue;for(let $e=0;$e<le;$e++){const Ve=$e*z-X;for(let nt=0;nt<se;nt++){const He=nt*j-Q;Ee[P]=He*C,Ee[L]=Ve*D,Ee[E]=re,p.push(Ee.x,Ee.y,Ee.z),Ee[P]=0,Ee[L]=0,Ee[E]=q>0?1:-1,g.push(Ee.x,Ee.y,Ee.z),_.push(nt/G),_.push(1-$e/N),ce+=1}}for(let $e=0;$e<N;$e++)for(let Ve=0;Ve<G;Ve++){const nt=x+Ve+se*$e,He=x+Ve+se*($e+1),De=x+(Ve+1)+se*($e+1),ot=x+(Ve+1)+se*$e;d.push(nt,He,ot),d.push(He,De,ot),be+=6}s.addGroup(b,be,V),b+=be,x+=ce}}static fromJSON(e){return new p0(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Zg(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const r=n[t][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?e[t][i]=r.clone():Array.isArray(r)?e[t][i]=r.slice():e[t][i]=r}}return e}function Eo(n){const e={};for(let t=0;t<n.length;t++){const i=Zg(n[t]);for(const r in i)e[r]=i[r]}return e}const Y9={clone:Zg,merge:Eo};var K9=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,J9=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Jo extends Bo{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=K9,this.fragmentShader=J9,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Zg(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const c=this.uniforms[r].value;c&&c.isTexture?t.uniforms[r]={type:"t",value:c.toJSON(e).uuid}:c&&c.isColor?t.uniforms[r]={type:"c",value:c.getHex()}:c&&c.isVector2?t.uniforms[r]={type:"v2",value:c.toArray()}:c&&c.isVector3?t.uniforms[r]={type:"v3",value:c.toArray()}:c&&c.isVector4?t.uniforms[r]={type:"v4",value:c.toArray()}:c&&c.isMatrix3?t.uniforms[r]={type:"m3",value:c.toArray()}:c&&c.isMatrix4?t.uniforms[r]={type:"m4",value:c.toArray()}:t.uniforms[r]={value:c}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const i={};for(const r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}Jo.prototype.isShaderMaterial=!0;class m0 extends Ln{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Li,this.projectionMatrix=new Li,this.projectionMatrixInverse=new Li}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}m0.prototype.isCamera=!0;class ea extends m0{constructor(e=50,t=1,i=.1,r=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=By*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(my*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return By*2*Math.atan(Math.tan(my*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,r,o,c){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=o,this.view.height=c,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(my*.5*this.fov)/this.zoom,i=2*t,r=this.aspect*i,o=-.5*r;const c=this.view;if(this.view!==null&&this.view.enabled){const d=c.fullWidth,p=c.fullHeight;o+=c.offsetX*r/d,t-=c.offsetY*i/p,r*=c.width/d,i*=c.height/p}const s=this.filmOffset;s!==0&&(o+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+r,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}ea.prototype.isPerspectiveCamera=!0;const Ym=90,Km=1;class RC extends Ln{constructor(e,t,i){if(super(),this.type="CubeCamera",i.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=i;const r=new ea(Ym,Km,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Ue(1,0,0)),this.add(r);const o=new ea(Ym,Km,e,t);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new Ue(-1,0,0)),this.add(o);const c=new ea(Ym,Km,e,t);c.layers=this.layers,c.up.set(0,0,1),c.lookAt(new Ue(0,1,0)),this.add(c);const s=new ea(Ym,Km,e,t);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(new Ue(0,-1,0)),this.add(s);const d=new ea(Ym,Km,e,t);d.layers=this.layers,d.up.set(0,-1,0),d.lookAt(new Ue(0,0,1)),this.add(d);const p=new ea(Ym,Km,e,t);p.layers=this.layers,p.up.set(0,-1,0),p.lookAt(new Ue(0,0,-1)),this.add(p)}update(e,t){this.parent===null&&this.updateMatrixWorld();const i=this.renderTarget,[r,o,c,s,d,p]=this.children,g=e.xr.enabled,_=e.getRenderTarget();e.xr.enabled=!1;const x=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,o),e.setRenderTarget(i,2),e.render(t,c),e.setRenderTarget(i,3),e.render(t,s),e.setRenderTarget(i,4),e.render(t,d),i.texture.generateMipmaps=x,e.setRenderTarget(i,5),e.render(t,p),e.setRenderTarget(_),e.xr.enabled=g}}class h1 extends Bs{constructor(e,t,i,r,o,c,s,d,p,g){e=e!==void 0?e:[],t=t!==void 0?t:h0,super(e,t,i,r,o,c,s,d,p,g),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}h1.prototype.isCubeTexture=!0;class cz extends Mc{constructor(e,t,i){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=i),super(e,e,t),t=t||{},this.texture=new h1(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Lo,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=aa,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new p0(5,5,5),o=new Jo({name:"CubemapFromEquirect",uniforms:Zg(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:qs,blending:Pd});o.uniforms.tEquirect.value=t;const c=new kr(r,o),s=t.minFilter;return t.minFilter===c1&&(t.minFilter=Lo),new RC(1,10,this).update(e,c),t.minFilter=s,c.geometry.dispose(),c.material.dispose(),this}clear(e,t,i,r){const o=e.getRenderTarget();for(let c=0;c<6;c++)e.setRenderTarget(this,c),e.clear(t,i,r);e.setRenderTarget(o)}}cz.prototype.isWebGLCubeRenderTarget=!0;const ZT=new Ue,Q9=new Ue,eZ=new mo;class uh{constructor(e=new Ue(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const r=ZT.subVectors(i,t).cross(Q9.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const i=e.delta(ZT),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const o=-(e.start.dot(this.normal)+this.constant)/r;return o<0||o>1?null:t.copy(i).multiplyScalar(o).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||eZ.getNormalMatrix(e),r=this.coplanarPoint(ZT).applyMatrix4(e),o=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}uh.prototype.isPlane=!0;const Jm=new d_,tx=new Ue;class d1{constructor(e=new uh,t=new uh,i=new uh,r=new uh,o=new uh,c=new uh){this.planes=[e,t,i,r,o,c]}set(e,t,i,r,o,c){const s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(i),s[3].copy(r),s[4].copy(o),s[5].copy(c),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){const t=this.planes,i=e.elements,r=i[0],o=i[1],c=i[2],s=i[3],d=i[4],p=i[5],g=i[6],_=i[7],x=i[8],b=i[9],S=i[10],P=i[11],L=i[12],E=i[13],C=i[14],D=i[15];return t[0].setComponents(s-r,_-d,P-x,D-L).normalize(),t[1].setComponents(s+r,_+d,P+x,D+L).normalize(),t[2].setComponents(s+o,_+p,P+b,D+E).normalize(),t[3].setComponents(s-o,_-p,P-b,D-E).normalize(),t[4].setComponents(s-c,_-g,P-S,D-C).normalize(),t[5].setComponents(s+c,_+g,P+S,D+C).normalize(),this}intersectsObject(e){const t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),Jm.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Jm)}intersectsSprite(e){return Jm.center.set(0,0,0),Jm.radius=.7071067811865476,Jm.applyMatrix4(e.matrixWorld),this.intersectsSphere(Jm)}intersectsSphere(e){const t=this.planes,i=e.center,r=-e.radius;for(let o=0;o<6;o++)if(t[o].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const r=t[i];if(tx.x=r.normal.x>0?e.max.x:e.min.x,tx.y=r.normal.y>0?e.max.y:e.min.y,tx.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(tx)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function uz(){let n=null,e=!1,t=null,i=null;function r(o,c){t(o,c),i=n.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(i=n.requestAnimationFrame(r),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(o){t=o},setContext:function(o){n=o}}}function tZ(n,e){const t=e.isWebGL2,i=new WeakMap;function r(p,g){const _=p.array,x=p.usage,b=n.createBuffer();n.bindBuffer(g,b),n.bufferData(g,_,x),p.onUploadCallback();let S=5126;return _ instanceof Float32Array?S=5126:_ instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):_ instanceof Uint16Array?p.isFloat16BufferAttribute?t?S=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):S=5123:_ instanceof Int16Array?S=5122:_ instanceof Uint32Array?S=5125:_ instanceof Int32Array?S=5124:_ instanceof Int8Array?S=5120:(_ instanceof Uint8Array||_ instanceof Uint8ClampedArray)&&(S=5121),{buffer:b,type:S,bytesPerElement:_.BYTES_PER_ELEMENT,version:p.version}}function o(p,g,_){const x=g.array,b=g.updateRange;n.bindBuffer(_,p),b.count===-1?n.bufferSubData(_,0,x):(t?n.bufferSubData(_,b.offset*x.BYTES_PER_ELEMENT,x,b.offset,b.count):n.bufferSubData(_,b.offset*x.BYTES_PER_ELEMENT,x.subarray(b.offset,b.offset+b.count)),b.count=-1)}function c(p){return p.isInterleavedBufferAttribute&&(p=p.data),i.get(p)}function s(p){p.isInterleavedBufferAttribute&&(p=p.data);const g=i.get(p);g&&(n.deleteBuffer(g.buffer),i.delete(p))}function d(p,g){if(p.isGLBufferAttribute){const x=i.get(p);(!x||x.version<p.version)&&i.set(p,{buffer:p.buffer,type:p.type,bytesPerElement:p.elementSize,version:p.version});return}p.isInterleavedBufferAttribute&&(p=p.data);const _=i.get(p);_===void 0?i.set(p,r(p,g)):_.version<p.version&&(o(_.buffer,p,g),_.version=p.version)}return{get:c,remove:s,update:d}}class f1 extends Vn{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};const o=e/2,c=t/2,s=Math.floor(i),d=Math.floor(r),p=s+1,g=d+1,_=e/s,x=t/d,b=[],S=[],P=[],L=[];for(let E=0;E<g;E++){const C=E*x-c;for(let D=0;D<p;D++){const O=D*_-o;S.push(O,-C,0),P.push(0,0,1),L.push(D/s),L.push(1-E/d)}}for(let E=0;E<d;E++)for(let C=0;C<s;C++){const D=C+p*E,O=C+p*(E+1),U=C+1+p*(E+1),q=C+1+p*E;b.push(D,O,q),b.push(O,U,q)}this.setIndex(b),this.setAttribute("position",new Ts(S,3)),this.setAttribute("normal",new Ts(P,3)),this.setAttribute("uv",new Ts(L,2))}static fromJSON(e){return new f1(e.width,e.height,e.widthSegments,e.heightSegments)}}var iZ=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,nZ=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,rZ=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,sZ=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,oZ=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aZ=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,lZ="vec3 transformed = vec3( position );",cZ=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,uZ=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,hZ=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,dZ=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,fZ=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,pZ=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,mZ=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,gZ=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,_Z=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,vZ=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,yZ=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,bZ=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,xZ=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_maxMipLevel 8.0
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_maxTileSize 256.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		float texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );
		vec2 f = fract( uv );
		uv += 0.5 - f;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		if ( mipInt < cubeUV_maxMipLevel ) {
			uv.y += 2.0 * cubeUV_maxTileSize;
		}
		uv.y += filterInt * 2.0 * cubeUV_minTileSize;
		uv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );
		uv *= texelSize;
		vec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x += texelSize;
		vec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.y += texelSize;
		vec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x -= texelSize;
		vec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		vec3 tm = mix( tl, tr, f.x );
		vec3 bm = mix( bl, br, f.x );
		return mix( tm, bm, f.y );
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,wZ=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,SZ=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,TZ=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,MZ=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,CZ=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,EZ="gl_FragColor = linearToOutputTexel( gl_FragColor );",AZ=`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value ) {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,PZ=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
		envColor = envMapTexelToLinear( envColor );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,IZ=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,RZ=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,LZ=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,kZ=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,DZ=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,FZ=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,OZ=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,zZ=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,BZ=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,NZ=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		lightMapIrradiance *= PI;
	#endif
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,$Z=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,VZ=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointLightInfo( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotLightInfo( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
		#endif
	}
	#pragma unroll_loop_end
#endif`,UZ=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,jZ=`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec;
			#ifdef ENVMAP_MODE_REFLECTION
				reflectVec = reflect( - viewDir, normal );
				reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			#else
				reflectVec = refract( - viewDir, normal, refractionRatio );
			#endif
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,GZ=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,qZ=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,WZ=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,HZ=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,ZZ=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= specularColorMapTexelToLinear( texture2D( specularColorMap, vUv ) ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= sheenColorMapTexelToLinear( texture2D( sheenColorMap, vUv ) ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,XZ=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,YZ=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,KZ=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,JZ=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,QZ=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,eX=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,tX=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,iX=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,nX=`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,rX=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,sX=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,oX=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,aX=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,lX=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,cX=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] > 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1, 2 ) * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,uX=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform vec2 morphTargetsTextureSize;
		vec3 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset, const in int stride ) {
			float texelIndex = float( vertexIndex * stride + offset );
			float y = floor( texelIndex / morphTargetsTextureSize.x );
			float x = texelIndex - y * morphTargetsTextureSize.x;
			vec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );
			return texture( morphTargetsTexture, morphUV ).xyz;
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,hX=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			#ifndef USE_MORPHNORMALS
				if ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 1 ) * morphTargetInfluences[ i ];
			#else
				if ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 2 ) * morphTargetInfluences[ i ];
			#endif
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,dX=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,fX=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,pX=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,mX=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,gX=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,_X=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,vX=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,yX=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,bX=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,xX=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,wX=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,SX=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,TX=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,MX=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,CX=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,EX=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,AX=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,PX=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,IX=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,RX=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,LX=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,kX=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,DX=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,FX=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,OX=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,zX=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,BX=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,NX=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,$X=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,VX=`#ifdef USE_TRANSMISSION
	float transmissionAlpha = 1.0;
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;
	#ifdef USE_TRANSMISSIONMAP
		transmissionFactor *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		thicknessFactor *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationColor, attenuationDistance );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );
	transmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );
#endif`,UX=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( float roughness, float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef TEXTURE_LOD_EXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {
		if ( attenuationDistance == 0.0 ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,
		vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,
		vec3 attenuationColor, float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,jX=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,GX=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,qX=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,WX=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,HX=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,ZX=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,XX=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const YX=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,KX=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,JX=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,QX=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,eY=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,tY=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,iY=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,nY=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,rY=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,sY=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,oY=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,aY=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,lY=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,cY=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,uY=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,hY=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,dY=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,fY=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,pY=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,mY=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,gY=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,_Y=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vY=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,yY=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - clearcoat * Fcc ) + clearcoatSpecular * clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,bY=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,xY=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,wY=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,SY=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,TY=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,MY=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,CY=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,EY=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Tn={alphamap_fragment:iZ,alphamap_pars_fragment:nZ,alphatest_fragment:rZ,alphatest_pars_fragment:sZ,aomap_fragment:oZ,aomap_pars_fragment:aZ,begin_vertex:lZ,beginnormal_vertex:cZ,bsdfs:uZ,bumpmap_pars_fragment:hZ,clipping_planes_fragment:dZ,clipping_planes_pars_fragment:fZ,clipping_planes_pars_vertex:pZ,clipping_planes_vertex:mZ,color_fragment:gZ,color_pars_fragment:_Z,color_pars_vertex:vZ,color_vertex:yZ,common:bZ,cube_uv_reflection_fragment:xZ,defaultnormal_vertex:wZ,displacementmap_pars_vertex:SZ,displacementmap_vertex:TZ,emissivemap_fragment:MZ,emissivemap_pars_fragment:CZ,encodings_fragment:EZ,encodings_pars_fragment:AZ,envmap_fragment:PZ,envmap_common_pars_fragment:IZ,envmap_pars_fragment:RZ,envmap_pars_vertex:LZ,envmap_physical_pars_fragment:jZ,envmap_vertex:kZ,fog_vertex:DZ,fog_pars_vertex:FZ,fog_fragment:OZ,fog_pars_fragment:zZ,gradientmap_pars_fragment:BZ,lightmap_fragment:NZ,lightmap_pars_fragment:$Z,lights_lambert_vertex:VZ,lights_pars_begin:UZ,lights_toon_fragment:GZ,lights_toon_pars_fragment:qZ,lights_phong_fragment:WZ,lights_phong_pars_fragment:HZ,lights_physical_fragment:ZZ,lights_physical_pars_fragment:XZ,lights_fragment_begin:YZ,lights_fragment_maps:KZ,lights_fragment_end:JZ,logdepthbuf_fragment:QZ,logdepthbuf_pars_fragment:eX,logdepthbuf_pars_vertex:tX,logdepthbuf_vertex:iX,map_fragment:nX,map_pars_fragment:rX,map_particle_fragment:sX,map_particle_pars_fragment:oX,metalnessmap_fragment:aX,metalnessmap_pars_fragment:lX,morphnormal_vertex:cX,morphtarget_pars_vertex:uX,morphtarget_vertex:hX,normal_fragment_begin:dX,normal_fragment_maps:fX,normal_pars_fragment:pX,normal_pars_vertex:mX,normal_vertex:gX,normalmap_pars_fragment:_X,clearcoat_normal_fragment_begin:vX,clearcoat_normal_fragment_maps:yX,clearcoat_pars_fragment:bX,output_fragment:xX,packing:wX,premultiplied_alpha_fragment:SX,project_vertex:TX,dithering_fragment:MX,dithering_pars_fragment:CX,roughnessmap_fragment:EX,roughnessmap_pars_fragment:AX,shadowmap_pars_fragment:PX,shadowmap_pars_vertex:IX,shadowmap_vertex:RX,shadowmask_pars_fragment:LX,skinbase_vertex:kX,skinning_pars_vertex:DX,skinning_vertex:FX,skinnormal_vertex:OX,specularmap_fragment:zX,specularmap_pars_fragment:BX,tonemapping_fragment:NX,tonemapping_pars_fragment:$X,transmission_fragment:VX,transmission_pars_fragment:UX,uv_pars_fragment:jX,uv_pars_vertex:GX,uv_vertex:qX,uv2_pars_fragment:WX,uv2_pars_vertex:HX,uv2_vertex:ZX,worldpos_vertex:XX,background_vert:YX,background_frag:KX,cube_vert:JX,cube_frag:QX,depth_vert:eY,depth_frag:tY,distanceRGBA_vert:iY,distanceRGBA_frag:nY,equirect_vert:rY,equirect_frag:sY,linedashed_vert:oY,linedashed_frag:aY,meshbasic_vert:lY,meshbasic_frag:cY,meshlambert_vert:uY,meshlambert_frag:hY,meshmatcap_vert:dY,meshmatcap_frag:fY,meshnormal_vert:pY,meshnormal_frag:mY,meshphong_vert:gY,meshphong_frag:_Y,meshphysical_vert:vY,meshphysical_frag:yY,meshtoon_vert:bY,meshtoon_frag:xY,points_vert:wY,points_frag:SY,shadow_vert:TY,shadow_frag:MY,sprite_vert:CY,sprite_frag:EY},xi={common:{diffuse:{value:new Bi(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new mo},uv2Transform:{value:new mo},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new li(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Bi(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Bi(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new mo}},sprite:{diffuse:{value:new Bi(16777215)},opacity:{value:1},center:{value:new li(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new mo}}},iu={basic:{uniforms:Eo([xi.common,xi.specularmap,xi.envmap,xi.aomap,xi.lightmap,xi.fog]),vertexShader:Tn.meshbasic_vert,fragmentShader:Tn.meshbasic_frag},lambert:{uniforms:Eo([xi.common,xi.specularmap,xi.envmap,xi.aomap,xi.lightmap,xi.emissivemap,xi.fog,xi.lights,{emissive:{value:new Bi(0)}}]),vertexShader:Tn.meshlambert_vert,fragmentShader:Tn.meshlambert_frag},phong:{uniforms:Eo([xi.common,xi.specularmap,xi.envmap,xi.aomap,xi.lightmap,xi.emissivemap,xi.bumpmap,xi.normalmap,xi.displacementmap,xi.fog,xi.lights,{emissive:{value:new Bi(0)},specular:{value:new Bi(1118481)},shininess:{value:30}}]),vertexShader:Tn.meshphong_vert,fragmentShader:Tn.meshphong_frag},standard:{uniforms:Eo([xi.common,xi.envmap,xi.aomap,xi.lightmap,xi.emissivemap,xi.bumpmap,xi.normalmap,xi.displacementmap,xi.roughnessmap,xi.metalnessmap,xi.fog,xi.lights,{emissive:{value:new Bi(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Tn.meshphysical_vert,fragmentShader:Tn.meshphysical_frag},toon:{uniforms:Eo([xi.common,xi.aomap,xi.lightmap,xi.emissivemap,xi.bumpmap,xi.normalmap,xi.displacementmap,xi.gradientmap,xi.fog,xi.lights,{emissive:{value:new Bi(0)}}]),vertexShader:Tn.meshtoon_vert,fragmentShader:Tn.meshtoon_frag},matcap:{uniforms:Eo([xi.common,xi.bumpmap,xi.normalmap,xi.displacementmap,xi.fog,{matcap:{value:null}}]),vertexShader:Tn.meshmatcap_vert,fragmentShader:Tn.meshmatcap_frag},points:{uniforms:Eo([xi.points,xi.fog]),vertexShader:Tn.points_vert,fragmentShader:Tn.points_frag},dashed:{uniforms:Eo([xi.common,xi.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Tn.linedashed_vert,fragmentShader:Tn.linedashed_frag},depth:{uniforms:Eo([xi.common,xi.displacementmap]),vertexShader:Tn.depth_vert,fragmentShader:Tn.depth_frag},normal:{uniforms:Eo([xi.common,xi.bumpmap,xi.normalmap,xi.displacementmap,{opacity:{value:1}}]),vertexShader:Tn.meshnormal_vert,fragmentShader:Tn.meshnormal_frag},sprite:{uniforms:Eo([xi.sprite,xi.fog]),vertexShader:Tn.sprite_vert,fragmentShader:Tn.sprite_frag},background:{uniforms:{uvTransform:{value:new mo},t2D:{value:null}},vertexShader:Tn.background_vert,fragmentShader:Tn.background_frag},cube:{uniforms:Eo([xi.envmap,{opacity:{value:1}}]),vertexShader:Tn.cube_vert,fragmentShader:Tn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Tn.equirect_vert,fragmentShader:Tn.equirect_frag},distanceRGBA:{uniforms:Eo([xi.common,xi.displacementmap,{referencePosition:{value:new Ue},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Tn.distanceRGBA_vert,fragmentShader:Tn.distanceRGBA_frag},shadow:{uniforms:Eo([xi.lights,xi.fog,{color:{value:new Bi(0)},opacity:{value:1}}]),vertexShader:Tn.shadow_vert,fragmentShader:Tn.shadow_frag}};iu.physical={uniforms:Eo([iu.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new li(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new Bi(0)},sheenColorMap:{value:null},sheenRoughness:{value:0},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new li},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Bi(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularColor:{value:new Bi(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Tn.meshphysical_vert,fragmentShader:Tn.meshphysical_frag};function AY(n,e,t,i,r){const o=new Bi(0);let c=0,s,d,p=null,g=0,_=null;function x(S,P){let L=!1,E=P.isScene===!0?P.background:null;E&&E.isTexture&&(E=e.get(E));const C=n.xr,D=C.getSession&&C.getSession();D&&D.environmentBlendMode==="additive"&&(E=null),E===null?b(o,c):E&&E.isColor&&(b(E,1),L=!0),(n.autoClear||L)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),E&&(E.isCubeTexture||E.mapping===l1)?(d===void 0&&(d=new kr(new p0(1,1,1),new Jo({name:"BackgroundCubeMaterial",uniforms:Zg(iu.cube.uniforms),vertexShader:iu.cube.vertexShader,fragmentShader:iu.cube.fragmentShader,side:qs,depthTest:!1,depthWrite:!1,fog:!1})),d.geometry.deleteAttribute("normal"),d.geometry.deleteAttribute("uv"),d.onBeforeRender=function(O,U,q){this.matrixWorld.copyPosition(q.matrixWorld)},Object.defineProperty(d.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(d)),d.material.uniforms.envMap.value=E,d.material.uniforms.flipEnvMap.value=E.isCubeTexture&&E.isRenderTargetTexture===!1?-1:1,(p!==E||g!==E.version||_!==n.toneMapping)&&(d.material.needsUpdate=!0,p=E,g=E.version,_=n.toneMapping),S.unshift(d,d.geometry,d.material,0,0,null)):E&&E.isTexture&&(s===void 0&&(s=new kr(new f1(2,2),new Jo({name:"BackgroundMaterial",uniforms:Zg(iu.background.uniforms),vertexShader:iu.background.vertexShader,fragmentShader:iu.background.fragmentShader,side:Wg,depthTest:!1,depthWrite:!1,fog:!1})),s.geometry.deleteAttribute("normal"),Object.defineProperty(s.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(s)),s.material.uniforms.t2D.value=E,E.matrixAutoUpdate===!0&&E.updateMatrix(),s.material.uniforms.uvTransform.value.copy(E.matrix),(p!==E||g!==E.version||_!==n.toneMapping)&&(s.material.needsUpdate=!0,p=E,g=E.version,_=n.toneMapping),S.unshift(s,s.geometry,s.material,0,0,null))}function b(S,P){t.buffers.color.setClear(S.r,S.g,S.b,P,r)}return{getClearColor:function(){return o},setClearColor:function(S,P=1){o.set(S),c=P,b(o,c)},getClearAlpha:function(){return c},setClearAlpha:function(S){c=S,b(o,c)},render:x}}function PY(n,e,t,i){const r=n.getParameter(34921),o=i.isWebGL2?null:e.get("OES_vertex_array_object"),c=i.isWebGL2||o!==null,s={},d=P(null);let p=d;function g(X,re,se,le,ce){let be=!1;if(c){const Ee=S(le,se,re);p!==Ee&&(p=Ee,x(p.object)),be=L(le,ce),be&&E(le,ce)}else{const Ee=re.wireframe===!0;(p.geometry!==le.id||p.program!==se.id||p.wireframe!==Ee)&&(p.geometry=le.id,p.program=se.id,p.wireframe=Ee,be=!0)}X.isInstancedMesh===!0&&(be=!0),ce!==null&&t.update(ce,34963),be&&(G(X,re,se,le),ce!==null&&n.bindBuffer(34963,t.get(ce).buffer))}function _(){return i.isWebGL2?n.createVertexArray():o.createVertexArrayOES()}function x(X){return i.isWebGL2?n.bindVertexArray(X):o.bindVertexArrayOES(X)}function b(X){return i.isWebGL2?n.deleteVertexArray(X):o.deleteVertexArrayOES(X)}function S(X,re,se){const le=se.wireframe===!0;let ce=s[X.id];ce===void 0&&(ce={},s[X.id]=ce);let be=ce[re.id];be===void 0&&(be={},ce[re.id]=be);let Ee=be[le];return Ee===void 0&&(Ee=P(_()),be[le]=Ee),Ee}function P(X){const re=[],se=[],le=[];for(let ce=0;ce<r;ce++)re[ce]=0,se[ce]=0,le[ce]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:re,enabledAttributes:se,attributeDivisors:le,object:X,attributes:{},index:null}}function L(X,re){const se=p.attributes,le=X.attributes;let ce=0;for(const be in le){const Ee=se[be],$e=le[be];if(Ee===void 0||Ee.attribute!==$e||Ee.data!==$e.data)return!0;ce++}return p.attributesNum!==ce||p.index!==re}function E(X,re){const se={},le=X.attributes;let ce=0;for(const be in le){const Ee=le[be],$e={};$e.attribute=Ee,Ee.data&&($e.data=Ee.data),se[be]=$e,ce++}p.attributes=se,p.attributesNum=ce,p.index=re}function C(){const X=p.newAttributes;for(let re=0,se=X.length;re<se;re++)X[re]=0}function D(X){O(X,0)}function O(X,re){const se=p.newAttributes,le=p.enabledAttributes,ce=p.attributeDivisors;se[X]=1,le[X]===0&&(n.enableVertexAttribArray(X),le[X]=1),ce[X]!==re&&((i.isWebGL2?n:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](X,re),ce[X]=re)}function U(){const X=p.newAttributes,re=p.enabledAttributes;for(let se=0,le=re.length;se<le;se++)re[se]!==X[se]&&(n.disableVertexAttribArray(se),re[se]=0)}function q(X,re,se,le,ce,be){i.isWebGL2===!0&&(se===5124||se===5125)?n.vertexAttribIPointer(X,re,se,ce,be):n.vertexAttribPointer(X,re,se,le,ce,be)}function G(X,re,se,le){if(i.isWebGL2===!1&&(X.isInstancedMesh||le.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;C();const ce=le.attributes,be=se.getAttributes(),Ee=re.defaultAttributeValues;for(const $e in be){const Ve=be[$e];if(Ve.location>=0){let nt=ce[$e];if(nt===void 0&&($e==="instanceMatrix"&&X.instanceMatrix&&(nt=X.instanceMatrix),$e==="instanceColor"&&X.instanceColor&&(nt=X.instanceColor)),nt!==void 0){const He=nt.normalized,De=nt.itemSize,ot=t.get(nt);if(ot===void 0)continue;const xe=ot.buffer,Be=ot.type,Je=ot.bytesPerElement;if(nt.isInterleavedBufferAttribute){const ct=nt.data,xt=ct.stride,Se=nt.offset;if(ct&&ct.isInstancedInterleavedBuffer){for(let me=0;me<Ve.locationSize;me++)O(Ve.location+me,ct.meshPerAttribute);X.isInstancedMesh!==!0&&le._maxInstanceCount===void 0&&(le._maxInstanceCount=ct.meshPerAttribute*ct.count)}else for(let me=0;me<Ve.locationSize;me++)D(Ve.location+me);n.bindBuffer(34962,xe);for(let me=0;me<Ve.locationSize;me++)q(Ve.location+me,De/Ve.locationSize,Be,He,xt*Je,(Se+De/Ve.locationSize*me)*Je)}else{if(nt.isInstancedBufferAttribute){for(let ct=0;ct<Ve.locationSize;ct++)O(Ve.location+ct,nt.meshPerAttribute);X.isInstancedMesh!==!0&&le._maxInstanceCount===void 0&&(le._maxInstanceCount=nt.meshPerAttribute*nt.count)}else for(let ct=0;ct<Ve.locationSize;ct++)D(Ve.location+ct);n.bindBuffer(34962,xe);for(let ct=0;ct<Ve.locationSize;ct++)q(Ve.location+ct,De/Ve.locationSize,Be,He,De*Je,De/Ve.locationSize*ct*Je)}}else if(Ee!==void 0){const He=Ee[$e];if(He!==void 0)switch(He.length){case 2:n.vertexAttrib2fv(Ve.location,He);break;case 3:n.vertexAttrib3fv(Ve.location,He);break;case 4:n.vertexAttrib4fv(Ve.location,He);break;default:n.vertexAttrib1fv(Ve.location,He)}}}}U()}function N(){z();for(const X in s){const re=s[X];for(const se in re){const le=re[se];for(const ce in le)b(le[ce].object),delete le[ce];delete re[se]}delete s[X]}}function V(X){if(s[X.id]===void 0)return;const re=s[X.id];for(const se in re){const le=re[se];for(const ce in le)b(le[ce].object),delete le[ce];delete re[se]}delete s[X.id]}function j(X){for(const re in s){const se=s[re];if(se[X.id]===void 0)continue;const le=se[X.id];for(const ce in le)b(le[ce].object),delete le[ce];delete se[X.id]}}function z(){Q(),p!==d&&(p=d,x(p.object))}function Q(){d.geometry=null,d.program=null,d.wireframe=!1}return{setup:g,reset:z,resetDefaultState:Q,dispose:N,releaseStatesOfGeometry:V,releaseStatesOfProgram:j,initAttributes:C,enableAttribute:D,disableUnusedAttributes:U}}function IY(n,e,t,i){const r=i.isWebGL2;let o;function c(p){o=p}function s(p,g){n.drawArrays(o,p,g),t.update(g,o,1)}function d(p,g,_){if(_===0)return;let x,b;if(r)x=n,b="drawArraysInstanced";else if(x=e.get("ANGLE_instanced_arrays"),b="drawArraysInstancedANGLE",x===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}x[b](o,p,g,_),t.update(g,o,_)}this.setMode=c,this.render=s,this.renderInstances=d}function RY(n,e,t){let i;function r(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const G=e.get("EXT_texture_filter_anisotropic");i=n.getParameter(G.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function o(G){if(G==="highp"){if(n.getShaderPrecisionFormat(35633,36338).precision>0&&n.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";G="mediump"}return G==="mediump"&&n.getShaderPrecisionFormat(35633,36337).precision>0&&n.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const c=typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&n instanceof WebGL2ComputeRenderingContext;let s=t.precision!==void 0?t.precision:"highp";const d=o(s);d!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",d,"instead."),s=d);const p=c||e.has("WEBGL_draw_buffers"),g=t.logarithmicDepthBuffer===!0,_=n.getParameter(34930),x=n.getParameter(35660),b=n.getParameter(3379),S=n.getParameter(34076),P=n.getParameter(34921),L=n.getParameter(36347),E=n.getParameter(36348),C=n.getParameter(36349),D=x>0,O=c||e.has("OES_texture_float"),U=D&&O,q=c?n.getParameter(36183):0;return{isWebGL2:c,drawBuffers:p,getMaxAnisotropy:r,getMaxPrecision:o,precision:s,logarithmicDepthBuffer:g,maxTextures:_,maxVertexTextures:x,maxTextureSize:b,maxCubemapSize:S,maxAttributes:P,maxVertexUniforms:L,maxVaryings:E,maxFragmentUniforms:C,vertexTextures:D,floatFragmentTextures:O,floatVertexTextures:U,maxSamples:q}}function LY(n){const e=this;let t=null,i=0,r=!1,o=!1;const c=new uh,s=new mo,d={value:null,needsUpdate:!1};this.uniform=d,this.numPlanes=0,this.numIntersection=0,this.init=function(_,x,b){const S=_.length!==0||x||i!==0||r;return r=x,t=g(_,b,0),i=_.length,S},this.beginShadows=function(){o=!0,g(null)},this.endShadows=function(){o=!1,p()},this.setState=function(_,x,b){const S=_.clippingPlanes,P=_.clipIntersection,L=_.clipShadows,E=n.get(_);if(!r||S===null||S.length===0||o&&!L)o?g(null):p();else{const C=o?0:i,D=C*4;let O=E.clippingState||null;d.value=O,O=g(S,x,D,b);for(let U=0;U!==D;++U)O[U]=t[U];E.clippingState=O,this.numIntersection=P?this.numPlanes:0,this.numPlanes+=C}};function p(){d.value!==t&&(d.value=t,d.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function g(_,x,b,S){const P=_!==null?_.length:0;let L=null;if(P!==0){if(L=d.value,S!==!0||L===null){const E=b+P*4,C=x.matrixWorldInverse;s.getNormalMatrix(C),(L===null||L.length<E)&&(L=new Float32Array(E));for(let D=0,O=b;D!==P;++D,O+=4)c.copy(_[D]).applyMatrix4(C,s),c.normal.toArray(L,O),L[O+3]=c.constant}d.value=L,d.needsUpdate=!0}return e.numPlanes=P,e.numIntersection=0,L}}function kY(n){let e=new WeakMap;function t(c,s){return s===n2?c.mapping=h0:s===r2&&(c.mapping=d0),c}function i(c){if(c&&c.isTexture&&c.isRenderTargetTexture===!1){const s=c.mapping;if(s===n2||s===r2)if(e.has(c)){const d=e.get(c).texture;return t(d,c.mapping)}else{const d=c.image;if(d&&d.height>0){const p=n.getRenderTarget(),g=new cz(d.height/2);return g.fromEquirectangularTexture(n,c),e.set(c,g),n.setRenderTarget(p),c.addEventListener("dispose",r),t(g.texture,c.mapping)}else return null}}return c}function r(c){const s=c.target;s.removeEventListener("dispose",r);const d=e.get(s);d!==void 0&&(e.delete(s),d.dispose())}function o(){e=new WeakMap}return{get:i,dispose:o}}class p1 extends m0{constructor(e=-1,t=1,i=1,r=-1,o=.1,c=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=o,this.far=c,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,o,c){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=o,this.view.height=c,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let o=i-e,c=i+e,s=r+t,d=r-t;if(this.view!==null&&this.view.enabled){const p=(this.right-this.left)/this.view.fullWidth/this.zoom,g=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=p*this.view.offsetX,c=o+p*this.view.width,s-=g*this.view.offsetY,d=s-g*this.view.height}this.projectionMatrix.makeOrthographic(o,c,s,d,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}p1.prototype.isOrthographicCamera=!0;class m1 extends Jo{constructor(e){super(e),this.type="RawShaderMaterial"}}m1.prototype.isRawShaderMaterial=!0;const Rg=4,Id=8,Qc=Math.pow(2,Id),hz=[.125,.215,.35,.446,.526,.582],dz=Id-Rg+1+hz.length,Qm=20,Nd={[Fo]:0,[Sp]:1,[PC]:2,[QO]:3,[ez]:4,[tz]:5,[AC]:6},XT=new p1,{_lodPlanes:Iv,_sizeLods:rL,_sigmas:ix}=OY(),sL=new Bi;let YT=null;const Wf=(1+Math.sqrt(5))/2,eg=1/Wf,oL=[new Ue(1,1,1),new Ue(-1,1,1),new Ue(1,1,-1),new Ue(-1,1,-1),new Ue(0,Wf,eg),new Ue(0,Wf,-eg),new Ue(eg,0,Wf),new Ue(-eg,0,Wf),new Ue(Wf,eg,0),new Ue(-Wf,eg,0)];class DY{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=zY(Qm),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){YT=this._renderer.getRenderTarget();const o=this._allocateTargets();return this._sceneToCubeUV(e,i,r,o),t>0&&this._blur(o,0,0,t),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){this._cubemapShader===null&&(this._cubemapShader=cL(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){this._equirectShader===null&&(this._equirectShader=lL(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),this._cubemapShader!==null&&this._cubemapShader.dispose(),this._equirectShader!==null&&this._equirectShader.dispose();for(let e=0;e<Iv.length;e++)Iv[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(YT),e.scissorTest=!1,nx(e,0,0,e.width,e.height)}_fromTexture(e){YT=this._renderer.getRenderTarget();const t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){const t={magFilter:Zs,minFilter:Zs,generateMipmaps:!1,type:Bd,format:IH,encoding:FY(e)?e.encoding:PC,depthBuffer:!1},i=aL(t);return i.depthBuffer=!e,this._pingPongRenderTarget=aL(t),i}_compileMaterial(e){const t=new kr(Iv[0],e);this._renderer.compile(t,XT)}_sceneToCubeUV(e,t,i,r){const s=new ea(90,1,t,i),d=[1,-1,1,1,1,1],p=[1,1,1,-1,-1,-1],g=this._renderer,_=g.autoClear,x=g.outputEncoding,b=g.toneMapping;g.getClearColor(sL),g.toneMapping=ap,g.outputEncoding=Fo,g.autoClear=!1;const S=new f0({name:"PMREM.Background",side:qs,depthWrite:!1,depthTest:!1}),P=new kr(new p0,S);let L=!1;const E=e.background;E?E.isColor&&(S.color.copy(E),e.background=null,L=!0):(S.color.copy(sL),L=!0);for(let C=0;C<6;C++){const D=C%3;D==0?(s.up.set(0,d[C],0),s.lookAt(p[C],0,0)):D==1?(s.up.set(0,0,d[C]),s.lookAt(0,p[C],0)):(s.up.set(0,d[C],0),s.lookAt(0,0,p[C])),nx(r,D*Qc,C>2?Qc:0,Qc,Qc),g.setRenderTarget(r),L&&g.render(P,s),g.render(e,s)}P.geometry.dispose(),P.material.dispose(),g.toneMapping=b,g.outputEncoding=x,g.autoClear=_,e.background=E}_setEncoding(e,t){this._renderer.capabilities.isWebGL2===!0&&t.format===aa&&t.type===Bd&&t.encoding===Sp?e.value=Nd[Fo]:e.value=Nd[t.encoding]}_textureToCubeUV(e,t){const i=this._renderer,r=e.mapping===h0||e.mapping===d0;r?this._cubemapShader==null&&(this._cubemapShader=cL()):this._equirectShader==null&&(this._equirectShader=lL());const o=r?this._cubemapShader:this._equirectShader,c=new kr(Iv[0],o),s=o.uniforms;s.envMap.value=e,r||s.texelSize.value.set(1/e.image.width,1/e.image.height),this._setEncoding(s.inputEncoding,e),this._setEncoding(s.outputEncoding,t.texture),nx(t,0,0,3*Qc,2*Qc),i.setRenderTarget(t),i.render(c,XT)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let r=1;r<dz;r++){const o=Math.sqrt(ix[r]*ix[r]-ix[r-1]*ix[r-1]),c=oL[(r-1)%oL.length];this._blur(e,r-1,r,o,c)}t.autoClear=i}_blur(e,t,i,r,o){const c=this._pingPongRenderTarget;this._halfBlur(e,c,t,i,r,"latitudinal",o),this._halfBlur(c,e,i,i,r,"longitudinal",o)}_halfBlur(e,t,i,r,o,c,s){const d=this._renderer,p=this._blurMaterial;c!=="latitudinal"&&c!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const g=3,_=new kr(Iv[r],p),x=p.uniforms,b=rL[i]-1,S=isFinite(o)?Math.PI/(2*b):2*Math.PI/(2*Qm-1),P=o/S,L=isFinite(o)?1+Math.floor(g*P):Qm;L>Qm&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${L} samples when the maximum is set to ${Qm}`);const E=[];let C=0;for(let q=0;q<Qm;++q){const G=q/P,N=Math.exp(-G*G/2);E.push(N),q==0?C+=N:q<L&&(C+=2*N)}for(let q=0;q<E.length;q++)E[q]=E[q]/C;x.envMap.value=e.texture,x.samples.value=L,x.weights.value=E,x.latitudinal.value=c==="latitudinal",s&&(x.poleAxis.value=s),x.dTheta.value=S,x.mipInt.value=Id-i,this._setEncoding(x.inputEncoding,e.texture),this._setEncoding(x.outputEncoding,e.texture);const D=rL[r],O=3*Math.max(0,Qc-2*D),U=(r===0?0:2*Qc)+2*D*(r>Id-Rg?r-Id+Rg:0);nx(t,O,U,3*D,2*D),d.setRenderTarget(t),d.render(_,XT)}}function FY(n){return n===void 0||n.type!==Bd?!1:n.encoding===Fo||n.encoding===Sp||n.encoding===AC}function OY(){const n=[],e=[],t=[];let i=Id;for(let r=0;r<dz;r++){const o=Math.pow(2,i);e.push(o);let c=1/o;r>Id-Rg?c=hz[r-Id+Rg-1]:r==0&&(c=0),t.push(c);const s=1/(o-1),d=-s/2,p=1+s/2,g=[d,d,p,d,p,p,d,d,p,p,d,p],_=6,x=6,b=3,S=2,P=1,L=new Float32Array(b*x*_),E=new Float32Array(S*x*_),C=new Float32Array(P*x*_);for(let O=0;O<_;O++){const U=O%3*2/3-1,q=O>2?0:-1,G=[U,q,0,U+2/3,q,0,U+2/3,q+1,0,U,q,0,U+2/3,q+1,0,U,q+1,0];L.set(G,b*x*O),E.set(g,S*x*O);const N=[O,O,O,O,O,O];C.set(N,P*x*O)}const D=new Vn;D.setAttribute("position",new Mn(L,b)),D.setAttribute("uv",new Mn(E,S)),D.setAttribute("faceIndex",new Mn(C,P)),n.push(D),i>Rg&&i--}return{_lodPlanes:n,_sizeLods:e,_sigmas:t}}function aL(n){const e=new Mc(3*Qc,3*Qc,n);return e.texture.mapping=l1,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function nx(n,e,t,i,r){n.viewport.set(e,t,i,r),n.scissor.set(e,t,i,r)}function zY(n){const e=new Float32Array(n),t=new Ue(0,1,0);return new m1({name:"SphericalGaussianBlur",defines:{n},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:t},inputEncoding:{value:Nd[Fo]},outputEncoding:{value:Nd[Fo]}},vertexShader:LC(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			${kC()}

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:Pd,depthTest:!1,depthWrite:!1})}function lL(){const n=new li(1,1);return new m1({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:n},inputEncoding:{value:Nd[Fo]},outputEncoding:{value:Nd[Fo]}},vertexShader:LC(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform vec2 texelSize;

			${kC()}

			#include <common>

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				vec2 f = fract( uv / texelSize - 0.5 );
				uv -= f * texelSize;
				vec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x += texelSize.x;
				vec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.y += texelSize.y;
				vec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x -= texelSize.x;
				vec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;

				vec3 tm = mix( tl, tr, f.x );
				vec3 bm = mix( bl, br, f.x );
				gl_FragColor.rgb = mix( tm, bm, f.y );

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:Pd,depthTest:!1,depthWrite:!1})}function cL(){return new m1({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:Nd[Fo]},outputEncoding:{value:Nd[Fo]}},vertexShader:LC(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			${kC()}

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;
				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:Pd,depthTest:!1,depthWrite:!1})}function LC(){return`

		precision mediump float;
		precision mediump int;

		attribute vec3 position;
		attribute vec2 uv;
		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function kC(){return`

		uniform int inputEncoding;
		uniform int outputEncoding;

		#include <encodings_pars_fragment>

		vec4 inputTexelToLinear( vec4 value ) {

			if ( inputEncoding == 0 ) {

				return value;

			} else if ( inputEncoding == 1 ) {

				return sRGBToLinear( value );

			} else if ( inputEncoding == 2 ) {

				return RGBEToLinear( value );

			} else if ( inputEncoding == 3 ) {

				return RGBMToLinear( value, 7.0 );

			} else if ( inputEncoding == 4 ) {

				return RGBMToLinear( value, 16.0 );

			} else if ( inputEncoding == 5 ) {

				return RGBDToLinear( value, 256.0 );

			} else {

				return GammaToLinear( value, 2.2 );

			}

		}

		vec4 linearToOutputTexel( vec4 value ) {

			if ( outputEncoding == 0 ) {

				return value;

			} else if ( outputEncoding == 1 ) {

				return LinearTosRGB( value );

			} else if ( outputEncoding == 2 ) {

				return LinearToRGBE( value );

			} else if ( outputEncoding == 3 ) {

				return LinearToRGBM( value, 7.0 );

			} else if ( outputEncoding == 4 ) {

				return LinearToRGBM( value, 16.0 );

			} else if ( outputEncoding == 5 ) {

				return LinearToRGBD( value, 256.0 );

			} else {

				return LinearToGamma( value, 2.2 );

			}

		}

		vec4 envMapTexelToLinear( vec4 color ) {

			return inputTexelToLinear( color );

		}
	`}function BY(n){let e=new WeakMap,t=null;function i(s){if(s&&s.isTexture&&s.isRenderTargetTexture===!1){const d=s.mapping,p=d===n2||d===r2,g=d===h0||d===d0;if(p||g){if(e.has(s))return e.get(s).texture;{const _=s.image;if(p&&_&&_.height>0||g&&_&&r(_)){const x=n.getRenderTarget();t===null&&(t=new DY(n));const b=p?t.fromEquirectangular(s):t.fromCubemap(s);return e.set(s,b),n.setRenderTarget(x),s.addEventListener("dispose",o),b.texture}else return null}}}return s}function r(s){let d=0;const p=6;for(let g=0;g<p;g++)s[g]!==void 0&&d++;return d===p}function o(s){const d=s.target;d.removeEventListener("dispose",o);const p=e.get(d);p!==void 0&&(e.delete(d),p.dispose())}function c(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:c}}function NY(n){const e={};function t(i){if(e[i]!==void 0)return e[i];let r;switch(i){case"WEBGL_depth_texture":r=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=n.getExtension(i)}return e[i]=r,r}return{has:function(i){return t(i)!==null},init:function(i){i.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float")},get:function(i){const r=t(i);return r===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),r}}}function $Y(n,e,t,i){const r={},o=new WeakMap;function c(_){const x=_.target;x.index!==null&&e.remove(x.index);for(const S in x.attributes)e.remove(x.attributes[S]);x.removeEventListener("dispose",c),delete r[x.id];const b=o.get(x);b&&(e.remove(b),o.delete(x)),i.releaseStatesOfGeometry(x),x.isInstancedBufferGeometry===!0&&delete x._maxInstanceCount,t.memory.geometries--}function s(_,x){return r[x.id]===!0||(x.addEventListener("dispose",c),r[x.id]=!0,t.memory.geometries++),x}function d(_){const x=_.attributes;for(const S in x)e.update(x[S],34962);const b=_.morphAttributes;for(const S in b){const P=b[S];for(let L=0,E=P.length;L<E;L++)e.update(P[L],34962)}}function p(_){const x=[],b=_.index,S=_.attributes.position;let P=0;if(b!==null){const C=b.array;P=b.version;for(let D=0,O=C.length;D<O;D+=3){const U=C[D+0],q=C[D+1],G=C[D+2];x.push(U,q,q,G,G,U)}}else{const C=S.array;P=S.version;for(let D=0,O=C.length/3-1;D<O;D+=3){const U=D+0,q=D+1,G=D+2;x.push(U,q,q,G,G,U)}}const L=new(nz(x)>65535?lz:az)(x,1);L.version=P;const E=o.get(_);E&&e.remove(E),o.set(_,L)}function g(_){const x=o.get(_);if(x){const b=_.index;b!==null&&x.version<b.version&&p(_)}else p(_);return o.get(_)}return{get:s,update:d,getWireframeAttribute:g}}function VY(n,e,t,i){const r=i.isWebGL2;let o;function c(x){o=x}let s,d;function p(x){s=x.type,d=x.bytesPerElement}function g(x,b){n.drawElements(o,b,s,x*d),t.update(b,o,1)}function _(x,b,S){if(S===0)return;let P,L;if(r)P=n,L="drawElementsInstanced";else if(P=e.get("ANGLE_instanced_arrays"),L="drawElementsInstancedANGLE",P===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}P[L](o,b,s,x*d,S),t.update(b,o,S)}this.setMode=c,this.setIndex=p,this.render=g,this.renderInstances=_}function UY(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(o,c,s){switch(t.calls++,c){case 4:t.triangles+=s*(o/3);break;case 1:t.lines+=s*(o/2);break;case 3:t.lines+=s*(o-1);break;case 2:t.lines+=s*o;break;case 0:t.points+=s*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",c);break}}function r(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:r,update:i}}class DC extends Bs{constructor(e=null,t=1,i=1,r=1){super(null),this.image={data:e,width:t,height:i,depth:r},this.magFilter=Zs,this.minFilter=Zs,this.wrapR=el,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}DC.prototype.isDataTexture2DArray=!0;function jY(n,e){return n[0]-e[0]}function GY(n,e){return Math.abs(e[1])-Math.abs(n[1])}function uL(n,e){let t=1;const i=e.isInterleavedBufferAttribute?e.data.array:e.array;i instanceof Int8Array?t=127:i instanceof Int16Array?t=32767:i instanceof Int32Array?t=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",i),n.divideScalar(t)}function qY(n,e,t){const i={},r=new Float32Array(8),o=new WeakMap,c=new Ue,s=[];for(let p=0;p<8;p++)s[p]=[p,0];function d(p,g,_,x){const b=p.morphTargetInfluences;if(e.isWebGL2===!0){const S=g.morphAttributes.position.length;let P=o.get(g);if(P===void 0||P.count!==S){P!==void 0&&P.texture.dispose();const C=g.morphAttributes.normal!==void 0,D=g.morphAttributes.position,O=g.morphAttributes.normal||[],U=g.attributes.position.count,q=C===!0?2:1;let G=U*q,N=1;G>e.maxTextureSize&&(N=Math.ceil(G/e.maxTextureSize),G=e.maxTextureSize);const V=new Float32Array(G*N*4*S),j=new DC(V,G,N,S);j.format=aa,j.type=Sd;const z=q*4;for(let Q=0;Q<S;Q++){const X=D[Q],re=O[Q],se=G*N*4*Q;for(let le=0;le<X.count;le++){c.fromBufferAttribute(X,le),X.normalized===!0&&uL(c,X);const ce=le*z;V[se+ce+0]=c.x,V[se+ce+1]=c.y,V[se+ce+2]=c.z,V[se+ce+3]=0,C===!0&&(c.fromBufferAttribute(re,le),re.normalized===!0&&uL(c,re),V[se+ce+4]=c.x,V[se+ce+5]=c.y,V[se+ce+6]=c.z,V[se+ce+7]=0)}}P={count:S,texture:j,size:new li(G,N)},o.set(g,P)}let L=0;for(let C=0;C<b.length;C++)L+=b[C];const E=g.morphTargetsRelative?1:1-L;x.getUniforms().setValue(n,"morphTargetBaseInfluence",E),x.getUniforms().setValue(n,"morphTargetInfluences",b),x.getUniforms().setValue(n,"morphTargetsTexture",P.texture,t),x.getUniforms().setValue(n,"morphTargetsTextureSize",P.size)}else{const S=b===void 0?0:b.length;let P=i[g.id];if(P===void 0||P.length!==S){P=[];for(let O=0;O<S;O++)P[O]=[O,0];i[g.id]=P}for(let O=0;O<S;O++){const U=P[O];U[0]=O,U[1]=b[O]}P.sort(GY);for(let O=0;O<8;O++)O<S&&P[O][1]?(s[O][0]=P[O][0],s[O][1]=P[O][1]):(s[O][0]=Number.MAX_SAFE_INTEGER,s[O][1]=0);s.sort(jY);const L=g.morphAttributes.position,E=g.morphAttributes.normal;let C=0;for(let O=0;O<8;O++){const U=s[O],q=U[0],G=U[1];q!==Number.MAX_SAFE_INTEGER&&G?(L&&g.getAttribute("morphTarget"+O)!==L[q]&&g.setAttribute("morphTarget"+O,L[q]),E&&g.getAttribute("morphNormal"+O)!==E[q]&&g.setAttribute("morphNormal"+O,E[q]),r[O]=G,C+=G):(L&&g.hasAttribute("morphTarget"+O)===!0&&g.deleteAttribute("morphTarget"+O),E&&g.hasAttribute("morphNormal"+O)===!0&&g.deleteAttribute("morphNormal"+O),r[O]=0)}const D=g.morphTargetsRelative?1:1-C;x.getUniforms().setValue(n,"morphTargetBaseInfluence",D),x.getUniforms().setValue(n,"morphTargetInfluences",r)}}return{update:d}}function WY(n,e,t,i){let r=new WeakMap;function o(d){const p=i.render.frame,g=d.geometry,_=e.get(d,g);return r.get(_)!==p&&(e.update(_),r.set(_,p)),d.isInstancedMesh&&(d.hasEventListener("dispose",s)===!1&&d.addEventListener("dispose",s),t.update(d.instanceMatrix,34962),d.instanceColor!==null&&t.update(d.instanceColor,34962)),_}function c(){r=new WeakMap}function s(d){const p=d.target;p.removeEventListener("dispose",s),t.remove(p.instanceMatrix),p.instanceColor!==null&&t.remove(p.instanceColor)}return{update:o,dispose:c}}class fz extends Bs{constructor(e=null,t=1,i=1,r=1){super(null),this.image={data:e,width:t,height:i,depth:r},this.magFilter=Zs,this.minFilter=Zs,this.wrapR=el,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}fz.prototype.isDataTexture3D=!0;const pz=new Bs,HY=new DC,ZY=new fz,mz=new h1,hL=[],dL=[],fL=new Float32Array(16),pL=new Float32Array(9),mL=new Float32Array(4);function f_(n,e,t){const i=n[0];if(i<=0||i>0)return n;const r=e*t;let o=hL[r];if(o===void 0&&(o=new Float32Array(r),hL[r]=o),e!==0){i.toArray(o,0);for(let c=1,s=0;c!==e;++c)s+=t,n[c].toArray(o,s)}return o}function la(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function Oo(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function gz(n,e){let t=dL[e];t===void 0&&(t=new Int32Array(e),dL[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function XY(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function YY(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(la(t,e))return;n.uniform2fv(this.addr,e),Oo(t,e)}}function KY(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(la(t,e))return;n.uniform3fv(this.addr,e),Oo(t,e)}}function JY(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(la(t,e))return;n.uniform4fv(this.addr,e),Oo(t,e)}}function QY(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(la(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),Oo(t,e)}else{if(la(t,i))return;mL.set(i),n.uniformMatrix2fv(this.addr,!1,mL),Oo(t,i)}}function eK(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(la(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),Oo(t,e)}else{if(la(t,i))return;pL.set(i),n.uniformMatrix3fv(this.addr,!1,pL),Oo(t,i)}}function tK(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(la(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),Oo(t,e)}else{if(la(t,i))return;fL.set(i),n.uniformMatrix4fv(this.addr,!1,fL),Oo(t,i)}}function iK(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function nK(n,e){const t=this.cache;la(t,e)||(n.uniform2iv(this.addr,e),Oo(t,e))}function rK(n,e){const t=this.cache;la(t,e)||(n.uniform3iv(this.addr,e),Oo(t,e))}function sK(n,e){const t=this.cache;la(t,e)||(n.uniform4iv(this.addr,e),Oo(t,e))}function oK(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function aK(n,e){const t=this.cache;la(t,e)||(n.uniform2uiv(this.addr,e),Oo(t,e))}function lK(n,e){const t=this.cache;la(t,e)||(n.uniform3uiv(this.addr,e),Oo(t,e))}function cK(n,e){const t=this.cache;la(t,e)||(n.uniform4uiv(this.addr,e),Oo(t,e))}function uK(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.safeSetTexture2D(e||pz,r)}function hK(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture3D(e||ZY,r)}function dK(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.safeSetTextureCube(e||mz,r)}function fK(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2DArray(e||HY,r)}function pK(n){switch(n){case 5126:return XY;case 35664:return YY;case 35665:return KY;case 35666:return JY;case 35674:return QY;case 35675:return eK;case 35676:return tK;case 5124:case 35670:return iK;case 35667:case 35671:return nK;case 35668:case 35672:return rK;case 35669:case 35673:return sK;case 5125:return oK;case 36294:return aK;case 36295:return lK;case 36296:return cK;case 35678:case 36198:case 36298:case 36306:case 35682:return uK;case 35679:case 36299:case 36307:return hK;case 35680:case 36300:case 36308:case 36293:return dK;case 36289:case 36303:case 36311:case 36292:return fK}}function mK(n,e){n.uniform1fv(this.addr,e)}function gK(n,e){const t=f_(e,this.size,2);n.uniform2fv(this.addr,t)}function _K(n,e){const t=f_(e,this.size,3);n.uniform3fv(this.addr,t)}function vK(n,e){const t=f_(e,this.size,4);n.uniform4fv(this.addr,t)}function yK(n,e){const t=f_(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function bK(n,e){const t=f_(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function xK(n,e){const t=f_(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function wK(n,e){n.uniform1iv(this.addr,e)}function SK(n,e){n.uniform2iv(this.addr,e)}function TK(n,e){n.uniform3iv(this.addr,e)}function MK(n,e){n.uniform4iv(this.addr,e)}function CK(n,e){n.uniform1uiv(this.addr,e)}function EK(n,e){n.uniform2uiv(this.addr,e)}function AK(n,e){n.uniform3uiv(this.addr,e)}function PK(n,e){n.uniform4uiv(this.addr,e)}function IK(n,e,t){const i=e.length,r=gz(t,i);n.uniform1iv(this.addr,r);for(let o=0;o!==i;++o)t.safeSetTexture2D(e[o]||pz,r[o])}function RK(n,e,t){const i=e.length,r=gz(t,i);n.uniform1iv(this.addr,r);for(let o=0;o!==i;++o)t.safeSetTextureCube(e[o]||mz,r[o])}function LK(n){switch(n){case 5126:return mK;case 35664:return gK;case 35665:return _K;case 35666:return vK;case 35674:return yK;case 35675:return bK;case 35676:return xK;case 5124:case 35670:return wK;case 35667:case 35671:return SK;case 35668:case 35672:return TK;case 35669:case 35673:return MK;case 5125:return CK;case 36294:return EK;case 36295:return AK;case 36296:return PK;case 35678:case 36198:case 36298:case 36306:case 35682:return IK;case 35680:case 36300:case 36308:case 36293:return RK}}function kK(n,e,t){this.id=n,this.addr=t,this.cache=[],this.setValue=pK(e.type)}function _z(n,e,t){this.id=n,this.addr=t,this.cache=[],this.size=e.size,this.setValue=LK(e.type)}_z.prototype.updateCache=function(n){const e=this.cache;n instanceof Float32Array&&e.length!==n.length&&(this.cache=new Float32Array(n.length)),Oo(e,n)};function vz(n){this.id=n,this.seq=[],this.map={}}vz.prototype.setValue=function(n,e,t){const i=this.seq;for(let r=0,o=i.length;r!==o;++r){const c=i[r];c.setValue(n,e[c.id],t)}};const KT=/(\w+)(\])?(\[|\.)?/g;function gL(n,e){n.seq.push(e),n.map[e.id]=e}function DK(n,e,t){const i=n.name,r=i.length;for(KT.lastIndex=0;;){const o=KT.exec(i),c=KT.lastIndex;let s=o[1];const d=o[2]==="]",p=o[3];if(d&&(s=s|0),p===void 0||p==="["&&c+2===r){gL(t,p===void 0?new kK(s,n,e):new _z(s,n,e));break}else{let _=t.map[s];_===void 0&&(_=new vz(s),gL(t,_)),t=_}}}function Rd(n,e){this.seq=[],this.map={};const t=n.getProgramParameter(e,35718);for(let i=0;i<t;++i){const r=n.getActiveUniform(e,i),o=n.getUniformLocation(e,r.name);DK(r,o,this)}}Rd.prototype.setValue=function(n,e,t,i){const r=this.map[e];r!==void 0&&r.setValue(n,t,i)};Rd.prototype.setOptional=function(n,e,t){const i=e[t];i!==void 0&&this.setValue(n,t,i)};Rd.upload=function(n,e,t,i){for(let r=0,o=e.length;r!==o;++r){const c=e[r],s=t[c.id];s.needsUpdate!==!1&&c.setValue(n,s.value,i)}};Rd.seqWithValue=function(n,e){const t=[];for(let i=0,r=n.length;i!==r;++i){const o=n[i];o.id in e&&t.push(o)}return t};function _L(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}let FK=0;function OK(n){const e=n.split(`
`);for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join(`
`)}function yz(n){switch(n){case Fo:return["Linear","( value )"];case Sp:return["sRGB","( value )"];case PC:return["RGBE","( value )"];case QO:return["RGBM","( value, 7.0 )"];case ez:return["RGBM","( value, 16.0 )"];case tz:return["RGBD","( value, 256.0 )"];case AC:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case _9:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",n),["Linear","( value )"]}}function vL(n,e,t){const i=n.getShaderParameter(e,35713),r=n.getShaderInfoLog(e).trim();return i&&r===""?"":t.toUpperCase()+`

`+r+`

`+OK(n.getShaderSource(e))}function Gf(n,e){const t=yz(e);return"vec4 "+n+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function zK(n,e){const t=yz(e);return"vec4 "+n+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function BK(n,e){let t;switch(e){case mH:t="Linear";break;case gH:t="Reinhard";break;case _H:t="OptimizedCineon";break;case vH:t="ACESFilmic";break;case yH:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function NK(n){return[n.extensionDerivatives||n.envMapCubeUV||n.bumpMap||n.tangentSpaceNormalMap||n.clearcoatNormalMap||n.flatShading||n.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Xv).join(`
`)}function $K(n){const e=[];for(const t in n){const i=n[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function VK(n,e){const t={},i=n.getProgramParameter(e,35721);for(let r=0;r<i;r++){const o=n.getActiveAttrib(e,r),c=o.name;let s=1;o.type===35674&&(s=2),o.type===35675&&(s=3),o.type===35676&&(s=4),t[c]={type:o.type,location:n.getAttribLocation(e,c),locationSize:s}}return t}function Xv(n){return n!==""}function yL(n,e){return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function bL(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const UK=/^[ \t]*#include +<([\w\d./]+)>/gm;function l2(n){return n.replace(UK,jK)}function jK(n,e){const t=Tn[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return l2(t)}const GK=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,qK=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function xL(n){return n.replace(qK,bz).replace(GK,WK)}function WK(n,e,t,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),bz(n,e,t,i)}function bz(n,e,t,i){let r="";for(let o=parseInt(e);o<parseInt(t);o++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return r}function wL(n){let e="precision "+n.precision+` float;
precision `+n.precision+" int;";return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function HK(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===HO?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===HW?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===Zv&&(e="SHADOWMAP_TYPE_VSM"),e}function ZK(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case h0:case d0:e="ENVMAP_TYPE_CUBE";break;case l1:case CC:e="ENVMAP_TYPE_CUBE_UV";break}return e}function XK(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case d0:case CC:e="ENVMAP_MODE_REFRACTION";break}return e}function YK(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case a1:e="ENVMAP_BLENDING_MULTIPLY";break;case fH:e="ENVMAP_BLENDING_MIX";break;case pH:e="ENVMAP_BLENDING_ADD";break}return e}function KK(n,e,t,i){const r=n.getContext(),o=t.defines;let c=t.vertexShader,s=t.fragmentShader;const d=HK(t),p=ZK(t),g=XK(t),_=YK(t),x=n.gammaFactor>0?n.gammaFactor:1,b=t.isWebGL2?"":NK(t),S=$K(o),P=r.createProgram();let L,E,C=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(L=[S].filter(Xv).join(`
`),L.length>0&&(L+=`
`),E=[b,S].filter(Xv).join(`
`),E.length>0&&(E+=`
`)):(L=[wL(t),"#define SHADER_NAME "+t.shaderName,S,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+x,"#define MAX_BONES "+t.maxBones,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+g:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.useVertexTexture?"#define BONE_TEXTURE":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphTargets&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargets&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+d:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Xv).join(`
`),E=[b,wL(t),"#define SHADER_NAME "+t.shaderName,S,"#define GAMMA_FACTOR "+x,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+p:"",t.envMap?"#define "+g:"",t.envMap?"#define "+_:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+d:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==ap?"#define TONE_MAPPING":"",t.toneMapping!==ap?Tn.tonemapping_pars_fragment:"",t.toneMapping!==ap?BK("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.format===lp?"#define OPAQUE":"",Tn.encodings_pars_fragment,t.map?Gf("mapTexelToLinear",t.mapEncoding):"",t.matcap?Gf("matcapTexelToLinear",t.matcapEncoding):"",t.envMap?Gf("envMapTexelToLinear",t.envMapEncoding):"",t.emissiveMap?Gf("emissiveMapTexelToLinear",t.emissiveMapEncoding):"",t.specularColorMap?Gf("specularColorMapTexelToLinear",t.specularColorMapEncoding):"",t.sheenColorMap?Gf("sheenColorMapTexelToLinear",t.sheenColorMapEncoding):"",t.lightMap?Gf("lightMapTexelToLinear",t.lightMapEncoding):"",zK("linearToOutputTexel",t.outputEncoding),t.depthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Xv).join(`
`)),c=l2(c),c=yL(c,t),c=bL(c,t),s=l2(s),s=yL(s,t),s=bL(s,t),c=xL(c),s=xL(s),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(C=`#version 300 es
`,L=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+L,E=["#define varying in",t.glslVersion===qR?"":"out highp vec4 pc_fragColor;",t.glslVersion===qR?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+E);const D=C+L+c,O=C+E+s,U=_L(r,35633,D),q=_L(r,35632,O);if(r.attachShader(P,U),r.attachShader(P,q),t.index0AttributeName!==void 0?r.bindAttribLocation(P,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(P,0,"position"),r.linkProgram(P),n.debug.checkShaderErrors){const V=r.getProgramInfoLog(P).trim(),j=r.getShaderInfoLog(U).trim(),z=r.getShaderInfoLog(q).trim();let Q=!0,X=!0;if(r.getProgramParameter(P,35714)===!1){Q=!1;const re=vL(r,U,"vertex"),se=vL(r,q,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(P,35715)+`

Program Info Log: `+V+`
`+re+`
`+se)}else V!==""?console.warn("THREE.WebGLProgram: Program Info Log:",V):(j===""||z==="")&&(X=!1);X&&(this.diagnostics={runnable:Q,programLog:V,vertexShader:{log:j,prefix:L},fragmentShader:{log:z,prefix:E}})}r.deleteShader(U),r.deleteShader(q);let G;this.getUniforms=function(){return G===void 0&&(G=new Rd(r,P)),G};let N;return this.getAttributes=function(){return N===void 0&&(N=VK(r,P)),N},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(P),this.program=void 0},this.name=t.shaderName,this.id=FK++,this.cacheKey=e,this.usedTimes=1,this.program=P,this.vertexShader=U,this.fragmentShader=q,this}function JK(n,e,t,i,r,o,c){const s=[],d=r.isWebGL2,p=r.logarithmicDepthBuffer,g=r.floatVertexTextures,_=r.maxVertexUniforms,x=r.vertexTextures;let b=r.precision;const S={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},P=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap",,"roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","morphTargetsCount","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","specularIntensityMap","specularColorMap","specularColorMapEncoding","transmission","transmissionMap","thicknessMap","sheen","sheenColorMap","sheenColorMapEncoding","sheenRoughnessMap"];function L(G){const V=G.skeleton.bones;if(g)return 1024;{const z=Math.floor((_-20)/4),Q=Math.min(z,V.length);return Q<V.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+V.length+" bones. This GPU supports "+Q+"."),0):Q}}function E(G){let N;return G&&G.isTexture?N=G.encoding:G&&G.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),N=G.texture.encoding):N=Fo,d&&G&&G.isTexture&&G.format===aa&&G.type===Bd&&G.encoding===Sp&&(N=Fo),N}function C(G,N,V,j,z){const Q=j.fog,X=G.isMeshStandardMaterial?j.environment:null,re=(G.isMeshStandardMaterial?t:e).get(G.envMap||X),se=S[G.type],le=z.isSkinnedMesh?L(z):0;G.precision!==null&&(b=r.getMaxPrecision(G.precision),b!==G.precision&&console.warn("THREE.WebGLProgram.getParameters:",G.precision,"not supported, using",b,"instead."));let ce,be;if(se){const He=iu[se];ce=He.vertexShader,be=He.fragmentShader}else ce=G.vertexShader,be=G.fragmentShader;const Ee=n.getRenderTarget(),$e=G.alphaTest>0,Ve=G.clearcoat>0;return{isWebGL2:d,shaderID:se,shaderName:G.type,vertexShader:ce,fragmentShader:be,defines:G.defines,isRawShaderMaterial:G.isRawShaderMaterial===!0,glslVersion:G.glslVersion,precision:b,instancing:z.isInstancedMesh===!0,instancingColor:z.isInstancedMesh===!0&&z.instanceColor!==null,supportsVertexTextures:x,outputEncoding:Ee!==null?E(Ee.texture):n.outputEncoding,map:!!G.map,mapEncoding:E(G.map),matcap:!!G.matcap,matcapEncoding:E(G.matcap),envMap:!!re,envMapMode:re&&re.mapping,envMapEncoding:E(re),envMapCubeUV:!!re&&(re.mapping===l1||re.mapping===CC),lightMap:!!G.lightMap,lightMapEncoding:E(G.lightMap),aoMap:!!G.aoMap,emissiveMap:!!G.emissiveMap,emissiveMapEncoding:E(G.emissiveMap),bumpMap:!!G.bumpMap,normalMap:!!G.normalMap,objectSpaceNormalMap:G.normalMapType===b9,tangentSpaceNormalMap:G.normalMapType===u_,clearcoat:Ve,clearcoatMap:Ve&&!!G.clearcoatMap,clearcoatRoughnessMap:Ve&&!!G.clearcoatRoughnessMap,clearcoatNormalMap:Ve&&!!G.clearcoatNormalMap,displacementMap:!!G.displacementMap,roughnessMap:!!G.roughnessMap,metalnessMap:!!G.metalnessMap,specularMap:!!G.specularMap,specularIntensityMap:!!G.specularIntensityMap,specularColorMap:!!G.specularColorMap,specularColorMapEncoding:E(G.specularColorMap),alphaMap:!!G.alphaMap,alphaTest:$e,gradientMap:!!G.gradientMap,sheen:G.sheen>0,sheenColorMap:!!G.sheenColorMap,sheenColorMapEncoding:E(G.sheenColorMap),sheenRoughnessMap:!!G.sheenRoughnessMap,transmission:G.transmission>0,transmissionMap:!!G.transmissionMap,thicknessMap:!!G.thicknessMap,combine:G.combine,vertexTangents:!!G.normalMap&&!!z.geometry&&!!z.geometry.attributes.tangent,vertexColors:G.vertexColors,vertexAlphas:G.vertexColors===!0&&!!z.geometry&&!!z.geometry.attributes.color&&z.geometry.attributes.color.itemSize===4,vertexUvs:!!G.map||!!G.bumpMap||!!G.normalMap||!!G.specularMap||!!G.alphaMap||!!G.emissiveMap||!!G.roughnessMap||!!G.metalnessMap||!!G.clearcoatMap||!!G.clearcoatRoughnessMap||!!G.clearcoatNormalMap||!!G.displacementMap||!!G.transmissionMap||!!G.thicknessMap||!!G.specularIntensityMap||!!G.specularColorMap||!!G.sheenColorMap||G.sheenRoughnessMap,uvsVertexOnly:!(G.map||G.bumpMap||G.normalMap||G.specularMap||G.alphaMap||G.emissiveMap||G.roughnessMap||G.metalnessMap||G.clearcoatNormalMap||G.transmission>0||G.transmissionMap||G.thicknessMap||G.specularIntensityMap||G.specularColorMap||!!G.sheen>0||G.sheenColorMap||G.sheenRoughnessMap)&&!!G.displacementMap,fog:!!Q,useFog:G.fog,fogExp2:Q&&Q.isFogExp2,flatShading:!!G.flatShading,sizeAttenuation:G.sizeAttenuation,logarithmicDepthBuffer:p,skinning:z.isSkinnedMesh===!0&&le>0,maxBones:le,useVertexTexture:g,morphTargets:!!z.geometry&&!!z.geometry.morphAttributes.position,morphNormals:!!z.geometry&&!!z.geometry.morphAttributes.normal,morphTargetsCount:z.geometry&&z.geometry.morphAttributes.position?z.geometry.morphAttributes.position.length:0,numDirLights:N.directional.length,numPointLights:N.point.length,numSpotLights:N.spot.length,numRectAreaLights:N.rectArea.length,numHemiLights:N.hemi.length,numDirLightShadows:N.directionalShadowMap.length,numPointLightShadows:N.pointShadowMap.length,numSpotLightShadows:N.spotShadowMap.length,numClippingPlanes:c.numPlanes,numClipIntersection:c.numIntersection,format:G.format,dithering:G.dithering,shadowMapEnabled:n.shadowMap.enabled&&V.length>0,shadowMapType:n.shadowMap.type,toneMapping:G.toneMapped?n.toneMapping:ap,physicallyCorrectLights:n.physicallyCorrectLights,premultipliedAlpha:G.premultipliedAlpha,doubleSided:G.side===Ko,flipSided:G.side===qs,depthPacking:G.depthPacking!==void 0?G.depthPacking:!1,index0AttributeName:G.index0AttributeName,extensionDerivatives:G.extensions&&G.extensions.derivatives,extensionFragDepth:G.extensions&&G.extensions.fragDepth,extensionDrawBuffers:G.extensions&&G.extensions.drawBuffers,extensionShaderTextureLOD:G.extensions&&G.extensions.shaderTextureLOD,rendererExtensionFragDepth:d||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:d||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:d||i.has("EXT_shader_texture_lod"),customProgramCacheKey:G.customProgramCacheKey()}}function D(G){const N=[];if(G.shaderID?N.push(G.shaderID):(N.push(WR(G.fragmentShader)),N.push(WR(G.vertexShader))),G.defines!==void 0)for(const V in G.defines)N.push(V),N.push(G.defines[V]);if(G.isRawShaderMaterial===!1){for(let V=0;V<P.length;V++)N.push(G[P[V]]);N.push(n.outputEncoding),N.push(n.gammaFactor)}return N.push(G.customProgramCacheKey),N.join()}function O(G){const N=S[G.type];let V;if(N){const j=iu[N];V=Y9.clone(j.uniforms)}else V=G.uniforms;return V}function U(G,N){let V;for(let j=0,z=s.length;j<z;j++){const Q=s[j];if(Q.cacheKey===N){V=Q,++V.usedTimes;break}}return V===void 0&&(V=new KK(n,N,G,o),s.push(V)),V}function q(G){if(--G.usedTimes===0){const N=s.indexOf(G);s[N]=s[s.length-1],s.pop(),G.destroy()}}return{getParameters:C,getProgramCacheKey:D,getUniforms:O,acquireProgram:U,releaseProgram:q,programs:s}}function QK(){let n=new WeakMap;function e(o){let c=n.get(o);return c===void 0&&(c={},n.set(o,c)),c}function t(o){n.delete(o)}function i(o,c,s){n.get(o)[c]=s}function r(){n=new WeakMap}return{get:e,remove:t,update:i,dispose:r}}function eJ(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.program!==e.program?n.program.id-e.program.id:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function SL(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function TL(n){const e=[];let t=0;const i=[],r=[],o=[],c={id:-1};function s(){t=0,i.length=0,r.length=0,o.length=0}function d(b,S,P,L,E,C){let D=e[t];const O=n.get(P);return D===void 0?(D={id:b.id,object:b,geometry:S,material:P,program:O.program||c,groupOrder:L,renderOrder:b.renderOrder,z:E,group:C},e[t]=D):(D.id=b.id,D.object=b,D.geometry=S,D.material=P,D.program=O.program||c,D.groupOrder=L,D.renderOrder=b.renderOrder,D.z=E,D.group=C),t++,D}function p(b,S,P,L,E,C){const D=d(b,S,P,L,E,C);P.transmission>0?r.push(D):P.transparent===!0?o.push(D):i.push(D)}function g(b,S,P,L,E,C){const D=d(b,S,P,L,E,C);P.transmission>0?r.unshift(D):P.transparent===!0?o.unshift(D):i.unshift(D)}function _(b,S){i.length>1&&i.sort(b||eJ),r.length>1&&r.sort(S||SL),o.length>1&&o.sort(S||SL)}function x(){for(let b=t,S=e.length;b<S;b++){const P=e[b];if(P.id===null)break;P.id=null,P.object=null,P.geometry=null,P.material=null,P.program=null,P.group=null}}return{opaque:i,transmissive:r,transparent:o,init:s,push:p,unshift:g,finish:x,sort:_}}function tJ(n){let e=new WeakMap;function t(r,o){let c;return e.has(r)===!1?(c=new TL(n),e.set(r,[c])):o>=e.get(r).length?(c=new TL(n),e.get(r).push(c)):c=e.get(r)[o],c}function i(){e=new WeakMap}return{get:t,dispose:i}}function iJ(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new Ue,color:new Bi};break;case"SpotLight":t={position:new Ue,direction:new Ue,color:new Bi,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new Ue,color:new Bi,distance:0,decay:0};break;case"HemisphereLight":t={direction:new Ue,skyColor:new Bi,groundColor:new Bi};break;case"RectAreaLight":t={color:new Bi,position:new Ue,halfWidth:new Ue,halfHeight:new Ue};break}return n[e.id]=t,t}}}function nJ(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new li};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new li};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new li,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let rJ=0;function sJ(n,e){return(e.castShadow?1:0)-(n.castShadow?1:0)}function oJ(n,e){const t=new iJ,i=nJ(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let g=0;g<9;g++)r.probe.push(new Ue);const o=new Ue,c=new Li,s=new Li;function d(g,_){let x=0,b=0,S=0;for(let V=0;V<9;V++)r.probe[V].set(0,0,0);let P=0,L=0,E=0,C=0,D=0,O=0,U=0,q=0;g.sort(sJ);const G=_!==!0?Math.PI:1;for(let V=0,j=g.length;V<j;V++){const z=g[V],Q=z.color,X=z.intensity,re=z.distance,se=z.shadow&&z.shadow.map?z.shadow.map.texture:null;if(z.isAmbientLight)x+=Q.r*X*G,b+=Q.g*X*G,S+=Q.b*X*G;else if(z.isLightProbe)for(let le=0;le<9;le++)r.probe[le].addScaledVector(z.sh.coefficients[le],X);else if(z.isDirectionalLight){const le=t.get(z);if(le.color.copy(z.color).multiplyScalar(z.intensity*G),z.castShadow){const ce=z.shadow,be=i.get(z);be.shadowBias=ce.bias,be.shadowNormalBias=ce.normalBias,be.shadowRadius=ce.radius,be.shadowMapSize=ce.mapSize,r.directionalShadow[P]=be,r.directionalShadowMap[P]=se,r.directionalShadowMatrix[P]=z.shadow.matrix,O++}r.directional[P]=le,P++}else if(z.isSpotLight){const le=t.get(z);if(le.position.setFromMatrixPosition(z.matrixWorld),le.color.copy(Q).multiplyScalar(X*G),le.distance=re,le.coneCos=Math.cos(z.angle),le.penumbraCos=Math.cos(z.angle*(1-z.penumbra)),le.decay=z.decay,z.castShadow){const ce=z.shadow,be=i.get(z);be.shadowBias=ce.bias,be.shadowNormalBias=ce.normalBias,be.shadowRadius=ce.radius,be.shadowMapSize=ce.mapSize,r.spotShadow[E]=be,r.spotShadowMap[E]=se,r.spotShadowMatrix[E]=z.shadow.matrix,q++}r.spot[E]=le,E++}else if(z.isRectAreaLight){const le=t.get(z);le.color.copy(Q).multiplyScalar(X),le.halfWidth.set(z.width*.5,0,0),le.halfHeight.set(0,z.height*.5,0),r.rectArea[C]=le,C++}else if(z.isPointLight){const le=t.get(z);if(le.color.copy(z.color).multiplyScalar(z.intensity*G),le.distance=z.distance,le.decay=z.decay,z.castShadow){const ce=z.shadow,be=i.get(z);be.shadowBias=ce.bias,be.shadowNormalBias=ce.normalBias,be.shadowRadius=ce.radius,be.shadowMapSize=ce.mapSize,be.shadowCameraNear=ce.camera.near,be.shadowCameraFar=ce.camera.far,r.pointShadow[L]=be,r.pointShadowMap[L]=se,r.pointShadowMatrix[L]=z.shadow.matrix,U++}r.point[L]=le,L++}else if(z.isHemisphereLight){const le=t.get(z);le.skyColor.copy(z.color).multiplyScalar(X*G),le.groundColor.copy(z.groundColor).multiplyScalar(X*G),r.hemi[D]=le,D++}}C>0&&(e.isWebGL2||n.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=xi.LTC_FLOAT_1,r.rectAreaLTC2=xi.LTC_FLOAT_2):n.has("OES_texture_half_float_linear")===!0?(r.rectAreaLTC1=xi.LTC_HALF_1,r.rectAreaLTC2=xi.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=x,r.ambient[1]=b,r.ambient[2]=S;const N=r.hash;(N.directionalLength!==P||N.pointLength!==L||N.spotLength!==E||N.rectAreaLength!==C||N.hemiLength!==D||N.numDirectionalShadows!==O||N.numPointShadows!==U||N.numSpotShadows!==q)&&(r.directional.length=P,r.spot.length=E,r.rectArea.length=C,r.point.length=L,r.hemi.length=D,r.directionalShadow.length=O,r.directionalShadowMap.length=O,r.pointShadow.length=U,r.pointShadowMap.length=U,r.spotShadow.length=q,r.spotShadowMap.length=q,r.directionalShadowMatrix.length=O,r.pointShadowMatrix.length=U,r.spotShadowMatrix.length=q,N.directionalLength=P,N.pointLength=L,N.spotLength=E,N.rectAreaLength=C,N.hemiLength=D,N.numDirectionalShadows=O,N.numPointShadows=U,N.numSpotShadows=q,r.version=rJ++)}function p(g,_){let x=0,b=0,S=0,P=0,L=0;const E=_.matrixWorldInverse;for(let C=0,D=g.length;C<D;C++){const O=g[C];if(O.isDirectionalLight){const U=r.directional[x];U.direction.setFromMatrixPosition(O.matrixWorld),o.setFromMatrixPosition(O.target.matrixWorld),U.direction.sub(o),U.direction.transformDirection(E),x++}else if(O.isSpotLight){const U=r.spot[S];U.position.setFromMatrixPosition(O.matrixWorld),U.position.applyMatrix4(E),U.direction.setFromMatrixPosition(O.matrixWorld),o.setFromMatrixPosition(O.target.matrixWorld),U.direction.sub(o),U.direction.transformDirection(E),S++}else if(O.isRectAreaLight){const U=r.rectArea[P];U.position.setFromMatrixPosition(O.matrixWorld),U.position.applyMatrix4(E),s.identity(),c.copy(O.matrixWorld),c.premultiply(E),s.extractRotation(c),U.halfWidth.set(O.width*.5,0,0),U.halfHeight.set(0,O.height*.5,0),U.halfWidth.applyMatrix4(s),U.halfHeight.applyMatrix4(s),P++}else if(O.isPointLight){const U=r.point[b];U.position.setFromMatrixPosition(O.matrixWorld),U.position.applyMatrix4(E),b++}else if(O.isHemisphereLight){const U=r.hemi[L];U.direction.setFromMatrixPosition(O.matrixWorld),U.direction.transformDirection(E),U.direction.normalize(),L++}}}return{setup:d,setupView:p,state:r}}function ML(n,e){const t=new oJ(n,e),i=[],r=[];function o(){i.length=0,r.length=0}function c(_){i.push(_)}function s(_){r.push(_)}function d(_){t.setup(i,_)}function p(_){t.setupView(i,_)}return{init:o,state:{lightsArray:i,shadowsArray:r,lights:t},setupLights:d,setupLightsView:p,pushLight:c,pushShadow:s}}function aJ(n,e){let t=new WeakMap;function i(o,c=0){let s;return t.has(o)===!1?(s=new ML(n,e),t.set(o,[s])):c>=t.get(o).length?(s=new ML(n,e),t.get(o).push(s)):s=t.get(o)[c],s}function r(){t=new WeakMap}return{get:i,dispose:r}}class xz extends Bo{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=v9,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}xz.prototype.isMeshDepthMaterial=!0;class wz extends Bo{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new Ue,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}wz.prototype.isMeshDistanceMaterial=!0;const lJ=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,cJ=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Sz(n,e,t){let i=new d1;const r=new li,o=new li,c=new Zn,s=new xz({depthPacking:y9}),d=new wz,p={},g=t.maxTextureSize,_={0:qs,1:Wg,2:Ko},x=new Jo({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new li},radius:{value:4}},vertexShader:lJ,fragmentShader:cJ}),b=x.clone();b.defines.HORIZONTAL_PASS=1;const S=new Vn;S.setAttribute("position",new Mn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const P=new kr(S,x),L=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=HO,this.render=function(O,U,q){if(L.enabled===!1||L.autoUpdate===!1&&L.needsUpdate===!1||O.length===0)return;const G=n.getRenderTarget(),N=n.getActiveCubeFace(),V=n.getActiveMipmapLevel(),j=n.state;j.setBlending(Pd),j.buffers.color.setClear(1,1,1,1),j.buffers.depth.setTest(!0),j.setScissorTest(!1);for(let z=0,Q=O.length;z<Q;z++){const X=O[z],re=X.shadow;if(re===void 0){console.warn("THREE.WebGLShadowMap:",X,"has no shadow.");continue}if(re.autoUpdate===!1&&re.needsUpdate===!1)continue;r.copy(re.mapSize);const se=re.getFrameExtents();if(r.multiply(se),o.copy(re.mapSize),(r.x>g||r.y>g)&&(r.x>g&&(o.x=Math.floor(g/se.x),r.x=o.x*se.x,re.mapSize.x=o.x),r.y>g&&(o.y=Math.floor(g/se.y),r.y=o.y*se.y,re.mapSize.y=o.y)),re.map===null&&!re.isPointLightShadow&&this.type===Zv){const ce={minFilter:Lo,magFilter:Lo,format:aa};re.map=new Mc(r.x,r.y,ce),re.map.texture.name=X.name+".shadowMap",re.mapPass=new Mc(r.x,r.y,ce),re.camera.updateProjectionMatrix()}if(re.map===null){const ce={minFilter:Zs,magFilter:Zs,format:aa};re.map=new Mc(r.x,r.y,ce),re.map.texture.name=X.name+".shadowMap",re.camera.updateProjectionMatrix()}n.setRenderTarget(re.map),n.clear();const le=re.getViewportCount();for(let ce=0;ce<le;ce++){const be=re.getViewport(ce);c.set(o.x*be.x,o.y*be.y,o.x*be.z,o.y*be.w),j.viewport(c),re.updateMatrices(X,ce),i=re.getFrustum(),D(U,q,re.camera,X,this.type)}!re.isPointLightShadow&&this.type===Zv&&E(re,q),re.needsUpdate=!1}L.needsUpdate=!1,n.setRenderTarget(G,N,V)};function E(O,U){const q=e.update(P);x.defines.VSM_SAMPLES!==O.blurSamples&&(x.defines.VSM_SAMPLES=O.blurSamples,b.defines.VSM_SAMPLES=O.blurSamples,x.needsUpdate=!0,b.needsUpdate=!0),x.uniforms.shadow_pass.value=O.map.texture,x.uniforms.resolution.value=O.mapSize,x.uniforms.radius.value=O.radius,n.setRenderTarget(O.mapPass),n.clear(),n.renderBufferDirect(U,null,q,x,P,null),b.uniforms.shadow_pass.value=O.mapPass.texture,b.uniforms.resolution.value=O.mapSize,b.uniforms.radius.value=O.radius,n.setRenderTarget(O.map),n.clear(),n.renderBufferDirect(U,null,q,b,P,null)}function C(O,U,q,G,N,V,j){let z=null;const Q=G.isPointLight===!0?O.customDistanceMaterial:O.customDepthMaterial;if(Q!==void 0?z=Q:z=G.isPointLight===!0?d:s,n.localClippingEnabled&&q.clipShadows===!0&&q.clippingPlanes.length!==0||q.displacementMap&&q.displacementScale!==0||q.alphaMap&&q.alphaTest>0){const X=z.uuid,re=q.uuid;let se=p[X];se===void 0&&(se={},p[X]=se);let le=se[re];le===void 0&&(le=z.clone(),se[re]=le),z=le}return z.visible=q.visible,z.wireframe=q.wireframe,j===Zv?z.side=q.shadowSide!==null?q.shadowSide:q.side:z.side=q.shadowSide!==null?q.shadowSide:_[q.side],z.alphaMap=q.alphaMap,z.alphaTest=q.alphaTest,z.clipShadows=q.clipShadows,z.clippingPlanes=q.clippingPlanes,z.clipIntersection=q.clipIntersection,z.displacementMap=q.displacementMap,z.displacementScale=q.displacementScale,z.displacementBias=q.displacementBias,z.wireframeLinewidth=q.wireframeLinewidth,z.linewidth=q.linewidth,G.isPointLight===!0&&z.isMeshDistanceMaterial===!0&&(z.referencePosition.setFromMatrixPosition(G.matrixWorld),z.nearDistance=N,z.farDistance=V),z}function D(O,U,q,G,N){if(O.visible===!1)return;if(O.layers.test(U.layers)&&(O.isMesh||O.isLine||O.isPoints)&&(O.castShadow||O.receiveShadow&&N===Zv)&&(!O.frustumCulled||i.intersectsObject(O))){O.modelViewMatrix.multiplyMatrices(q.matrixWorldInverse,O.matrixWorld);const z=e.update(O),Q=O.material;if(Array.isArray(Q)){const X=z.groups;for(let re=0,se=X.length;re<se;re++){const le=X[re],ce=Q[le.materialIndex];if(ce&&ce.visible){const be=C(O,z,ce,G,q.near,q.far,N);n.renderBufferDirect(q,null,z,be,O,le)}}}else if(Q.visible){const X=C(O,z,Q,G,q.near,q.far,N);n.renderBufferDirect(q,null,z,X,O,null)}}const j=O.children;for(let z=0,Q=j.length;z<Q;z++)D(j[z],U,q,G,N)}}function uJ(n,e,t){const i=t.isWebGL2;function r(){let ee=!1;const de=new Zn;let pe=null;const Le=new Zn(0,0,0,0);return{setMask:function(Oe){pe!==Oe&&!ee&&(n.colorMask(Oe,Oe,Oe,Oe),pe=Oe)},setLocked:function(Oe){ee=Oe},setClear:function(Oe,dt,pt,rt,St){St===!0&&(Oe*=rt,dt*=rt,pt*=rt),de.set(Oe,dt,pt,rt),Le.equals(de)===!1&&(n.clearColor(Oe,dt,pt,rt),Le.copy(de))},reset:function(){ee=!1,pe=null,Le.set(-1,0,0,0)}}}function o(){let ee=!1,de=null,pe=null,Le=null;return{setTest:function(Oe){Oe?De(2929):ot(2929)},setMask:function(Oe){de!==Oe&&!ee&&(n.depthMask(Oe),de=Oe)},setFunc:function(Oe){if(pe!==Oe){if(Oe)switch(Oe){case oH:n.depthFunc(512);break;case aH:n.depthFunc(519);break;case lH:n.depthFunc(513);break;case i2:n.depthFunc(515);break;case cH:n.depthFunc(514);break;case uH:n.depthFunc(518);break;case hH:n.depthFunc(516);break;case dH:n.depthFunc(517);break;default:n.depthFunc(515)}else n.depthFunc(515);pe=Oe}},setLocked:function(Oe){ee=Oe},setClear:function(Oe){Le!==Oe&&(n.clearDepth(Oe),Le=Oe)},reset:function(){ee=!1,de=null,pe=null,Le=null}}}function c(){let ee=!1,de=null,pe=null,Le=null,Oe=null,dt=null,pt=null,rt=null,St=null;return{setTest:function(Dt){ee||(Dt?De(2960):ot(2960))},setMask:function(Dt){de!==Dt&&!ee&&(n.stencilMask(Dt),de=Dt)},setFunc:function(Dt,Bt,Jt){(pe!==Dt||Le!==Bt||Oe!==Jt)&&(n.stencilFunc(Dt,Bt,Jt),pe=Dt,Le=Bt,Oe=Jt)},setOp:function(Dt,Bt,Jt){(dt!==Dt||pt!==Bt||rt!==Jt)&&(n.stencilOp(Dt,Bt,Jt),dt=Dt,pt=Bt,rt=Jt)},setLocked:function(Dt){ee=Dt},setClear:function(Dt){St!==Dt&&(n.clearStencil(Dt),St=Dt)},reset:function(){ee=!1,de=null,pe=null,Le=null,Oe=null,dt=null,pt=null,rt=null,St=null}}}const s=new r,d=new o,p=new c;let g={},_=null,x={},b=null,S=!1,P=null,L=null,E=null,C=null,D=null,O=null,U=null,q=!1,G=null,N=null,V=null,j=null,z=null;const Q=n.getParameter(35661);let X=!1,re=0;const se=n.getParameter(7938);se.indexOf("WebGL")!==-1?(re=parseFloat(/^WebGL (\d)/.exec(se)[1]),X=re>=1):se.indexOf("OpenGL ES")!==-1&&(re=parseFloat(/^OpenGL ES (\d)/.exec(se)[1]),X=re>=2);let le=null,ce={};const be=n.getParameter(3088),Ee=n.getParameter(2978),$e=new Zn().fromArray(be),Ve=new Zn().fromArray(Ee);function nt(ee,de,pe){const Le=new Uint8Array(4),Oe=n.createTexture();n.bindTexture(ee,Oe),n.texParameteri(ee,10241,9728),n.texParameteri(ee,10240,9728);for(let dt=0;dt<pe;dt++)n.texImage2D(de+dt,0,6408,1,1,0,6408,5121,Le);return Oe}const He={};He[3553]=nt(3553,3553,1),He[34067]=nt(34067,34069,6),s.setClear(0,0,0,1),d.setClear(1),p.setClear(0),De(2929),d.setFunc(i2),qe(!1),st(ER),De(2884),Se(Pd);function De(ee){g[ee]!==!0&&(n.enable(ee),g[ee]=!0)}function ot(ee){g[ee]!==!1&&(n.disable(ee),g[ee]=!1)}function xe(ee){ee!==_&&(n.bindFramebuffer(36160,ee),_=ee)}function Be(ee,de){return de===null&&_!==null&&(de=_),x[ee]!==de?(n.bindFramebuffer(ee,de),x[ee]=de,i&&(ee===36009&&(x[36160]=de),ee===36160&&(x[36009]=de)),!0):!1}function Je(ee){return b!==ee?(n.useProgram(ee),b=ee,!0):!1}const ct={[fg]:32774,[XW]:32778,[YW]:32779};if(i)ct[RR]=32775,ct[LR]=32776;else{const ee=e.get("EXT_blend_minmax");ee!==null&&(ct[RR]=ee.MIN_EXT,ct[LR]=ee.MAX_EXT)}const xt={[KW]:0,[JW]:1,[QW]:768,[XO]:770,[sH]:776,[nH]:774,[tH]:772,[eH]:769,[YO]:771,[rH]:775,[iH]:773};function Se(ee,de,pe,Le,Oe,dt,pt,rt){if(ee===Pd){S===!0&&(ot(3042),S=!1);return}if(S===!1&&(De(3042),S=!0),ee!==ZW){if(ee!==P||rt!==q){if((L!==fg||D!==fg)&&(n.blendEquation(32774),L=fg,D=fg),rt)switch(ee){case fy:n.blendFuncSeparate(1,771,1,771);break;case AR:n.blendFunc(1,1);break;case PR:n.blendFuncSeparate(0,0,769,771);break;case IR:n.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",ee);break}else switch(ee){case fy:n.blendFuncSeparate(770,771,1,771);break;case AR:n.blendFunc(770,1);break;case PR:n.blendFunc(0,769);break;case IR:n.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",ee);break}E=null,C=null,O=null,U=null,P=ee,q=rt}return}Oe=Oe||de,dt=dt||pe,pt=pt||Le,(de!==L||Oe!==D)&&(n.blendEquationSeparate(ct[de],ct[Oe]),L=de,D=Oe),(pe!==E||Le!==C||dt!==O||pt!==U)&&(n.blendFuncSeparate(xt[pe],xt[Le],xt[dt],xt[pt]),E=pe,C=Le,O=dt,U=pt),P=ee,q=null}function me(ee,de){ee.side===Ko?ot(2884):De(2884);let pe=ee.side===qs;de&&(pe=!pe),qe(pe),ee.blending===fy&&ee.transparent===!1?Se(Pd):Se(ee.blending,ee.blendEquation,ee.blendSrc,ee.blendDst,ee.blendEquationAlpha,ee.blendSrcAlpha,ee.blendDstAlpha,ee.premultipliedAlpha),d.setFunc(ee.depthFunc),d.setTest(ee.depthTest),d.setMask(ee.depthWrite),s.setMask(ee.colorWrite);const Le=ee.stencilWrite;p.setTest(Le),Le&&(p.setMask(ee.stencilWriteMask),p.setFunc(ee.stencilFunc,ee.stencilRef,ee.stencilFuncMask),p.setOp(ee.stencilFail,ee.stencilZFail,ee.stencilZPass)),gt(ee.polygonOffset,ee.polygonOffsetFactor,ee.polygonOffsetUnits),ee.alphaToCoverage===!0?De(32926):ot(32926)}function qe(ee){G!==ee&&(ee?n.frontFace(2304):n.frontFace(2305),G=ee)}function st(ee){ee!==qW?(De(2884),ee!==N&&(ee===ER?n.cullFace(1029):ee===WW?n.cullFace(1028):n.cullFace(1032))):ot(2884),N=ee}function Rt(ee){ee!==V&&(X&&n.lineWidth(ee),V=ee)}function gt(ee,de,pe){ee?(De(32823),(j!==de||z!==pe)&&(n.polygonOffset(de,pe),j=de,z=pe)):ot(32823)}function Ae(ee){ee?De(3089):ot(3089)}function we(ee){ee===void 0&&(ee=33984+Q-1),le!==ee&&(n.activeTexture(ee),le=ee)}function vt(ee,de){le===null&&we();let pe=ce[le];pe===void 0&&(pe={type:void 0,texture:void 0},ce[le]=pe),(pe.type!==ee||pe.texture!==de)&&(n.bindTexture(ee,de||He[ee]),pe.type=ee,pe.texture=de)}function ye(){const ee=ce[le];ee!==void 0&&ee.type!==void 0&&(n.bindTexture(ee.type,null),ee.type=void 0,ee.texture=void 0)}function ie(){try{n.compressedTexImage2D.apply(n,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function ae(){try{n.texImage2D.apply(n,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function ke(){try{n.texImage3D.apply(n,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function Ze(ee){$e.equals(ee)===!1&&(n.scissor(ee.x,ee.y,ee.z,ee.w),$e.copy(ee))}function yt(ee){Ve.equals(ee)===!1&&(n.viewport(ee.x,ee.y,ee.z,ee.w),Ve.copy(ee))}function Me(){n.disable(3042),n.disable(2884),n.disable(2929),n.disable(32823),n.disable(3089),n.disable(2960),n.disable(32926),n.blendEquation(32774),n.blendFunc(1,0),n.blendFuncSeparate(1,0,1,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(513),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(519,0,4294967295),n.stencilOp(7680,7680,7680),n.clearStencil(0),n.cullFace(1029),n.frontFace(2305),n.polygonOffset(0,0),n.activeTexture(33984),n.bindFramebuffer(36160,null),i===!0&&(n.bindFramebuffer(36009,null),n.bindFramebuffer(36008,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),g={},le=null,ce={},_=null,x={},b=null,S=!1,P=null,L=null,E=null,C=null,D=null,O=null,U=null,q=!1,G=null,N=null,V=null,j=null,z=null,$e.set(0,0,n.canvas.width,n.canvas.height),Ve.set(0,0,n.canvas.width,n.canvas.height),s.reset(),d.reset(),p.reset()}return{buffers:{color:s,depth:d,stencil:p},enable:De,disable:ot,bindFramebuffer:Be,bindXRFramebuffer:xe,useProgram:Je,setBlending:Se,setMaterial:me,setFlipSided:qe,setCullFace:st,setLineWidth:Rt,setPolygonOffset:gt,setScissorTest:Ae,activeTexture:we,bindTexture:vt,unbindTexture:ye,compressedTexImage2D:ie,texImage2D:ae,texImage3D:ke,scissor:Ze,viewport:yt,reset:Me}}function hJ(n,e,t,i,r,o,c){const s=r.isWebGL2,d=r.maxTextures,p=r.maxCubemapSize,g=r.maxTextureSize,_=r.maxSamples,x=new WeakMap;let b,S=!1;try{S=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function P(Ae,we){return S?new OffscreenCanvas(Ae,we):u1("canvas")}function L(Ae,we,vt,ye){let ie=1;if((Ae.width>ye||Ae.height>ye)&&(ie=ye/Math.max(Ae.width,Ae.height)),ie<1||we===!0)if(typeof HTMLImageElement<"u"&&Ae instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Ae instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Ae instanceof ImageBitmap){const ae=we?iz:Math.floor,ke=ae(ie*Ae.width),Ze=ae(ie*Ae.height);b===void 0&&(b=P(ke,Ze));const yt=vt?P(ke,Ze):b;return yt.width=ke,yt.height=Ze,yt.getContext("2d").drawImage(Ae,0,0,ke,Ze),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Ae.width+"x"+Ae.height+") to ("+ke+"x"+Ze+")."),yt}else return"data"in Ae&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Ae.width+"x"+Ae.height+")."),Ae;return Ae}function E(Ae){return a2(Ae.width)&&a2(Ae.height)}function C(Ae){return s?!1:Ae.wrapS!==el||Ae.wrapT!==el||Ae.minFilter!==Zs&&Ae.minFilter!==Lo}function D(Ae,we){return Ae.generateMipmaps&&we&&Ae.minFilter!==Zs&&Ae.minFilter!==Lo}function O(Ae,we,vt,ye,ie=1){n.generateMipmap(Ae);const ae=i.get(we);ae.__maxMipLevel=Math.log2(Math.max(vt,ye,ie))}function U(Ae,we,vt,ye){if(s===!1)return we;if(Ae!==null){if(n[Ae]!==void 0)return n[Ae];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Ae+"'")}let ie=we;return we===6403&&(vt===5126&&(ie=33326),vt===5131&&(ie=33325),vt===5121&&(ie=33321)),we===6407&&(vt===5126&&(ie=34837),vt===5131&&(ie=34843),vt===5121&&(ie=32849)),we===6408&&(vt===5126&&(ie=34836),vt===5131&&(ie=34842),vt===5121&&(ie=ye===Sp?35907:32856)),(ie===33325||ie===33326||ie===34842||ie===34836)&&e.get("EXT_color_buffer_float"),ie}function q(Ae){return Ae===Zs||Ae===kR||Ae===DR?9728:9729}function G(Ae){const we=Ae.target;we.removeEventListener("dispose",G),V(we),we.isVideoTexture&&x.delete(we),c.memory.textures--}function N(Ae){const we=Ae.target;we.removeEventListener("dispose",N),j(we)}function V(Ae){const we=i.get(Ae);we.__webglInit!==void 0&&(n.deleteTexture(we.__webglTexture),i.remove(Ae))}function j(Ae){const we=Ae.texture,vt=i.get(Ae),ye=i.get(we);if(Ae){if(ye.__webglTexture!==void 0&&(n.deleteTexture(ye.__webglTexture),c.memory.textures--),Ae.depthTexture&&Ae.depthTexture.dispose(),Ae.isWebGLCubeRenderTarget)for(let ie=0;ie<6;ie++)n.deleteFramebuffer(vt.__webglFramebuffer[ie]),vt.__webglDepthbuffer&&n.deleteRenderbuffer(vt.__webglDepthbuffer[ie]);else n.deleteFramebuffer(vt.__webglFramebuffer),vt.__webglDepthbuffer&&n.deleteRenderbuffer(vt.__webglDepthbuffer),vt.__webglMultisampledFramebuffer&&n.deleteFramebuffer(vt.__webglMultisampledFramebuffer),vt.__webglColorRenderbuffer&&n.deleteRenderbuffer(vt.__webglColorRenderbuffer),vt.__webglDepthRenderbuffer&&n.deleteRenderbuffer(vt.__webglDepthRenderbuffer);if(Ae.isWebGLMultipleRenderTargets)for(let ie=0,ae=we.length;ie<ae;ie++){const ke=i.get(we[ie]);ke.__webglTexture&&(n.deleteTexture(ke.__webglTexture),c.memory.textures--),i.remove(we[ie])}i.remove(we),i.remove(Ae)}}let z=0;function Q(){z=0}function X(){const Ae=z;return Ae>=d&&console.warn("THREE.WebGLTextures: Trying to use "+Ae+" texture units while this GPU supports only "+d),z+=1,Ae}function re(Ae,we){const vt=i.get(Ae);if(Ae.isVideoTexture&&me(Ae),Ae.version>0&&vt.__version!==Ae.version){const ye=Ae.image;if(ye===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(ye.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{nt(vt,Ae,we);return}}t.activeTexture(33984+we),t.bindTexture(3553,vt.__webglTexture)}function se(Ae,we){const vt=i.get(Ae);if(Ae.version>0&&vt.__version!==Ae.version){nt(vt,Ae,we);return}t.activeTexture(33984+we),t.bindTexture(35866,vt.__webglTexture)}function le(Ae,we){const vt=i.get(Ae);if(Ae.version>0&&vt.__version!==Ae.version){nt(vt,Ae,we);return}t.activeTexture(33984+we),t.bindTexture(32879,vt.__webglTexture)}function ce(Ae,we){const vt=i.get(Ae);if(Ae.version>0&&vt.__version!==Ae.version){He(vt,Ae,we);return}t.activeTexture(33984+we),t.bindTexture(34067,vt.__webglTexture)}const be={[s2]:10497,[el]:33071,[o2]:33648},Ee={[Zs]:9728,[kR]:9984,[DR]:9986,[Lo]:9729,[bH]:9985,[c1]:9987};function $e(Ae,we,vt){if(vt?(n.texParameteri(Ae,10242,be[we.wrapS]),n.texParameteri(Ae,10243,be[we.wrapT]),(Ae===32879||Ae===35866)&&n.texParameteri(Ae,32882,be[we.wrapR]),n.texParameteri(Ae,10240,Ee[we.magFilter]),n.texParameteri(Ae,10241,Ee[we.minFilter])):(n.texParameteri(Ae,10242,33071),n.texParameteri(Ae,10243,33071),(Ae===32879||Ae===35866)&&n.texParameteri(Ae,32882,33071),(we.wrapS!==el||we.wrapT!==el)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(Ae,10240,q(we.magFilter)),n.texParameteri(Ae,10241,q(we.minFilter)),we.minFilter!==Zs&&we.minFilter!==Lo&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const ye=e.get("EXT_texture_filter_anisotropic");if(we.type===Sd&&e.has("OES_texture_float_linear")===!1||s===!1&&we.type===Pg&&e.has("OES_texture_half_float_linear")===!1)return;(we.anisotropy>1||i.get(we).__currentAnisotropy)&&(n.texParameterf(Ae,ye.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(we.anisotropy,r.getMaxAnisotropy())),i.get(we).__currentAnisotropy=we.anisotropy)}}function Ve(Ae,we){Ae.__webglInit===void 0&&(Ae.__webglInit=!0,we.addEventListener("dispose",G),Ae.__webglTexture=n.createTexture(),c.memory.textures++)}function nt(Ae,we,vt){let ye=3553;we.isDataTexture2DArray&&(ye=35866),we.isDataTexture3D&&(ye=32879),Ve(Ae,we),t.activeTexture(33984+vt),t.bindTexture(ye,Ae.__webglTexture),n.pixelStorei(37440,we.flipY),n.pixelStorei(37441,we.premultiplyAlpha),n.pixelStorei(3317,we.unpackAlignment),n.pixelStorei(37443,0);const ie=C(we)&&E(we.image)===!1,ae=L(we.image,ie,!1,g),ke=E(ae)||s,Ze=o.convert(we.format);let yt=o.convert(we.type),Me=U(we.internalFormat,Ze,yt,we.encoding);$e(ye,we,ke);let ee;const de=we.mipmaps;if(we.isDepthTexture)Me=6402,s?we.type===Sd?Me=36012:we.type===Wx?Me=33190:we.type===py?Me=35056:Me=33189:we.type===Sd&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),we.format===Ig&&Me===6402&&we.type!==ww&&we.type!==Wx&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),we.type=ww,yt=o.convert(we.type)),we.format===Oy&&Me===6402&&(Me=34041,we.type!==py&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),we.type=py,yt=o.convert(we.type))),t.texImage2D(3553,0,Me,ae.width,ae.height,0,Ze,yt,null);else if(we.isDataTexture)if(de.length>0&&ke){for(let pe=0,Le=de.length;pe<Le;pe++)ee=de[pe],t.texImage2D(3553,pe,Me,ee.width,ee.height,0,Ze,yt,ee.data);we.generateMipmaps=!1,Ae.__maxMipLevel=de.length-1}else t.texImage2D(3553,0,Me,ae.width,ae.height,0,Ze,yt,ae.data),Ae.__maxMipLevel=0;else if(we.isCompressedTexture){for(let pe=0,Le=de.length;pe<Le;pe++)ee=de[pe],we.format!==aa&&we.format!==lp?Ze!==null?t.compressedTexImage2D(3553,pe,Me,ee.width,ee.height,0,ee.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):t.texImage2D(3553,pe,Me,ee.width,ee.height,0,Ze,yt,ee.data);Ae.__maxMipLevel=de.length-1}else if(we.isDataTexture2DArray)t.texImage3D(35866,0,Me,ae.width,ae.height,ae.depth,0,Ze,yt,ae.data),Ae.__maxMipLevel=0;else if(we.isDataTexture3D)t.texImage3D(32879,0,Me,ae.width,ae.height,ae.depth,0,Ze,yt,ae.data),Ae.__maxMipLevel=0;else if(de.length>0&&ke){for(let pe=0,Le=de.length;pe<Le;pe++)ee=de[pe],t.texImage2D(3553,pe,Me,Ze,yt,ee);we.generateMipmaps=!1,Ae.__maxMipLevel=de.length-1}else t.texImage2D(3553,0,Me,Ze,yt,ae),Ae.__maxMipLevel=0;D(we,ke)&&O(ye,we,ae.width,ae.height),Ae.__version=we.version,we.onUpdate&&we.onUpdate(we)}function He(Ae,we,vt){if(we.image.length!==6)return;Ve(Ae,we),t.activeTexture(33984+vt),t.bindTexture(34067,Ae.__webglTexture),n.pixelStorei(37440,we.flipY),n.pixelStorei(37441,we.premultiplyAlpha),n.pixelStorei(3317,we.unpackAlignment),n.pixelStorei(37443,0);const ye=we&&(we.isCompressedTexture||we.image[0].isCompressedTexture),ie=we.image[0]&&we.image[0].isDataTexture,ae=[];for(let pe=0;pe<6;pe++)!ye&&!ie?ae[pe]=L(we.image[pe],!1,!0,p):ae[pe]=ie?we.image[pe].image:we.image[pe];const ke=ae[0],Ze=E(ke)||s,yt=o.convert(we.format),Me=o.convert(we.type),ee=U(we.internalFormat,yt,Me,we.encoding);$e(34067,we,Ze);let de;if(ye){for(let pe=0;pe<6;pe++){de=ae[pe].mipmaps;for(let Le=0;Le<de.length;Le++){const Oe=de[Le];we.format!==aa&&we.format!==lp?yt!==null?t.compressedTexImage2D(34069+pe,Le,ee,Oe.width,Oe.height,0,Oe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):t.texImage2D(34069+pe,Le,ee,Oe.width,Oe.height,0,yt,Me,Oe.data)}}Ae.__maxMipLevel=de.length-1}else{de=we.mipmaps;for(let pe=0;pe<6;pe++)if(ie){t.texImage2D(34069+pe,0,ee,ae[pe].width,ae[pe].height,0,yt,Me,ae[pe].data);for(let Le=0;Le<de.length;Le++){const dt=de[Le].image[pe].image;t.texImage2D(34069+pe,Le+1,ee,dt.width,dt.height,0,yt,Me,dt.data)}}else{t.texImage2D(34069+pe,0,ee,yt,Me,ae[pe]);for(let Le=0;Le<de.length;Le++){const Oe=de[Le];t.texImage2D(34069+pe,Le+1,ee,yt,Me,Oe.image[pe])}}Ae.__maxMipLevel=de.length}D(we,Ze)&&O(34067,we,ke.width,ke.height),Ae.__version=we.version,we.onUpdate&&we.onUpdate(we)}function De(Ae,we,vt,ye,ie){const ae=o.convert(vt.format),ke=o.convert(vt.type),Ze=U(vt.internalFormat,ae,ke,vt.encoding);ie===32879||ie===35866?t.texImage3D(ie,0,Ze,we.width,we.height,we.depth,0,ae,ke,null):t.texImage2D(ie,0,Ze,we.width,we.height,0,ae,ke,null),t.bindFramebuffer(36160,Ae),n.framebufferTexture2D(36160,ye,ie,i.get(vt).__webglTexture,0),t.bindFramebuffer(36160,null)}function ot(Ae,we,vt){if(n.bindRenderbuffer(36161,Ae),we.depthBuffer&&!we.stencilBuffer){let ye=33189;if(vt){const ie=we.depthTexture;ie&&ie.isDepthTexture&&(ie.type===Sd?ye=36012:ie.type===Wx&&(ye=33190));const ae=Se(we);n.renderbufferStorageMultisample(36161,ae,ye,we.width,we.height)}else n.renderbufferStorage(36161,ye,we.width,we.height);n.framebufferRenderbuffer(36160,36096,36161,Ae)}else if(we.depthBuffer&&we.stencilBuffer){if(vt){const ye=Se(we);n.renderbufferStorageMultisample(36161,ye,35056,we.width,we.height)}else n.renderbufferStorage(36161,34041,we.width,we.height);n.framebufferRenderbuffer(36160,33306,36161,Ae)}else{const ye=we.isWebGLMultipleRenderTargets===!0?we.texture[0]:we.texture,ie=o.convert(ye.format),ae=o.convert(ye.type),ke=U(ye.internalFormat,ie,ae,ye.encoding);if(vt){const Ze=Se(we);n.renderbufferStorageMultisample(36161,Ze,ke,we.width,we.height)}else n.renderbufferStorage(36161,ke,we.width,we.height)}n.bindRenderbuffer(36161,null)}function xe(Ae,we){if(we&&we.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,Ae),!(we.depthTexture&&we.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(we.depthTexture).__webglTexture||we.depthTexture.image.width!==we.width||we.depthTexture.image.height!==we.height)&&(we.depthTexture.image.width=we.width,we.depthTexture.image.height=we.height,we.depthTexture.needsUpdate=!0),re(we.depthTexture,0);const ye=i.get(we.depthTexture).__webglTexture;if(we.depthTexture.format===Ig)n.framebufferTexture2D(36160,36096,3553,ye,0);else if(we.depthTexture.format===Oy)n.framebufferTexture2D(36160,33306,3553,ye,0);else throw new Error("Unknown depthTexture format")}function Be(Ae){const we=i.get(Ae),vt=Ae.isWebGLCubeRenderTarget===!0;if(Ae.depthTexture){if(vt)throw new Error("target.depthTexture not supported in Cube render targets");xe(we.__webglFramebuffer,Ae)}else if(vt){we.__webglDepthbuffer=[];for(let ye=0;ye<6;ye++)t.bindFramebuffer(36160,we.__webglFramebuffer[ye]),we.__webglDepthbuffer[ye]=n.createRenderbuffer(),ot(we.__webglDepthbuffer[ye],Ae,!1)}else t.bindFramebuffer(36160,we.__webglFramebuffer),we.__webglDepthbuffer=n.createRenderbuffer(),ot(we.__webglDepthbuffer,Ae,!1);t.bindFramebuffer(36160,null)}function Je(Ae){const we=Ae.texture,vt=i.get(Ae),ye=i.get(we);Ae.addEventListener("dispose",N),Ae.isWebGLMultipleRenderTargets!==!0&&(ye.__webglTexture=n.createTexture(),ye.__version=we.version,c.memory.textures++);const ie=Ae.isWebGLCubeRenderTarget===!0,ae=Ae.isWebGLMultipleRenderTargets===!0,ke=Ae.isWebGLMultisampleRenderTarget===!0,Ze=we.isDataTexture3D||we.isDataTexture2DArray,yt=E(Ae)||s;if(s&&we.format===lp&&(we.type===Sd||we.type===Pg)&&(we.format=aa,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),ie){vt.__webglFramebuffer=[];for(let Me=0;Me<6;Me++)vt.__webglFramebuffer[Me]=n.createFramebuffer()}else if(vt.__webglFramebuffer=n.createFramebuffer(),ae)if(r.drawBuffers){const Me=Ae.texture;for(let ee=0,de=Me.length;ee<de;ee++){const pe=i.get(Me[ee]);pe.__webglTexture===void 0&&(pe.__webglTexture=n.createTexture(),c.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(ke)if(s){vt.__webglMultisampledFramebuffer=n.createFramebuffer(),vt.__webglColorRenderbuffer=n.createRenderbuffer(),n.bindRenderbuffer(36161,vt.__webglColorRenderbuffer);const Me=o.convert(we.format),ee=o.convert(we.type),de=U(we.internalFormat,Me,ee,we.encoding),pe=Se(Ae);n.renderbufferStorageMultisample(36161,pe,de,Ae.width,Ae.height),t.bindFramebuffer(36160,vt.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064,36161,vt.__webglColorRenderbuffer),n.bindRenderbuffer(36161,null),Ae.depthBuffer&&(vt.__webglDepthRenderbuffer=n.createRenderbuffer(),ot(vt.__webglDepthRenderbuffer,Ae,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(ie){t.bindTexture(34067,ye.__webglTexture),$e(34067,we,yt);for(let Me=0;Me<6;Me++)De(vt.__webglFramebuffer[Me],Ae,we,36064,34069+Me);D(we,yt)&&O(34067,we,Ae.width,Ae.height),t.unbindTexture()}else if(ae){const Me=Ae.texture;for(let ee=0,de=Me.length;ee<de;ee++){const pe=Me[ee],Le=i.get(pe);t.bindTexture(3553,Le.__webglTexture),$e(3553,pe,yt),De(vt.__webglFramebuffer,Ae,pe,36064+ee,3553),D(pe,yt)&&O(3553,pe,Ae.width,Ae.height)}t.unbindTexture()}else{let Me=3553;Ze&&(s?Me=we.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),t.bindTexture(Me,ye.__webglTexture),$e(Me,we,yt),De(vt.__webglFramebuffer,Ae,we,36064,Me),D(we,yt)&&O(Me,we,Ae.width,Ae.height,Ae.depth),t.unbindTexture()}Ae.depthBuffer&&Be(Ae)}function ct(Ae){const we=E(Ae)||s,vt=Ae.isWebGLMultipleRenderTargets===!0?Ae.texture:[Ae.texture];for(let ye=0,ie=vt.length;ye<ie;ye++){const ae=vt[ye];if(D(ae,we)){const ke=Ae.isWebGLCubeRenderTarget?34067:3553,Ze=i.get(ae).__webglTexture;t.bindTexture(ke,Ze),O(ke,ae,Ae.width,Ae.height),t.unbindTexture()}}}function xt(Ae){if(Ae.isWebGLMultisampleRenderTarget)if(s){const we=Ae.width,vt=Ae.height;let ye=16384;Ae.depthBuffer&&(ye|=256),Ae.stencilBuffer&&(ye|=1024);const ie=i.get(Ae);t.bindFramebuffer(36008,ie.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,ie.__webglFramebuffer),n.blitFramebuffer(0,0,we,vt,0,0,we,vt,ye,9728),t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,ie.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function Se(Ae){return s&&Ae.isWebGLMultisampleRenderTarget?Math.min(_,Ae.samples):0}function me(Ae){const we=c.render.frame;x.get(Ae)!==we&&(x.set(Ae,we),Ae.update())}let qe=!1,st=!1;function Rt(Ae,we){Ae&&Ae.isWebGLRenderTarget&&(qe===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),qe=!0),Ae=Ae.texture),re(Ae,we)}function gt(Ae,we){Ae&&Ae.isWebGLCubeRenderTarget&&(st===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),st=!0),Ae=Ae.texture),ce(Ae,we)}this.allocateTextureUnit=X,this.resetTextureUnits=Q,this.setTexture2D=re,this.setTexture2DArray=se,this.setTexture3D=le,this.setTextureCube=ce,this.setupRenderTarget=Je,this.updateRenderTargetMipmap=ct,this.updateMultisampleRenderTarget=xt,this.safeSetTexture2D=Rt,this.safeSetTextureCube=gt}function dJ(n,e,t){const i=t.isWebGL2;function r(o){let c;if(o===Bd)return 5121;if(o===TH)return 32819;if(o===MH)return 32820;if(o===CH)return 33635;if(o===xH)return 5120;if(o===wH)return 5122;if(o===ww)return 5123;if(o===SH)return 5124;if(o===Wx)return 5125;if(o===Sd)return 5126;if(o===Pg)return i?5131:(c=e.get("OES_texture_half_float"),c!==null?c.HALF_FLOAT_OES:null);if(o===EH)return 6406;if(o===lp)return 6407;if(o===aa)return 6408;if(o===AH)return 6409;if(o===PH)return 6410;if(o===Ig)return 6402;if(o===Oy)return 34041;if(o===RH)return 6403;if(o===LH)return 36244;if(o===kH)return 33319;if(o===DH)return 33320;if(o===FH)return 36248;if(o===OH)return 36249;if(o===FR||o===OR||o===zR||o===BR)if(c=e.get("WEBGL_compressed_texture_s3tc"),c!==null){if(o===FR)return c.COMPRESSED_RGB_S3TC_DXT1_EXT;if(o===OR)return c.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(o===zR)return c.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(o===BR)return c.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(o===NR||o===$R||o===VR||o===UR)if(c=e.get("WEBGL_compressed_texture_pvrtc"),c!==null){if(o===NR)return c.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(o===$R)return c.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(o===VR)return c.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(o===UR)return c.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(o===zH)return c=e.get("WEBGL_compressed_texture_etc1"),c!==null?c.COMPRESSED_RGB_ETC1_WEBGL:null;if((o===jR||o===GR)&&(c=e.get("WEBGL_compressed_texture_etc"),c!==null)){if(o===jR)return c.COMPRESSED_RGB8_ETC2;if(o===GR)return c.COMPRESSED_RGBA8_ETC2_EAC}if(o===BH||o===NH||o===$H||o===VH||o===UH||o===jH||o===GH||o===qH||o===WH||o===HH||o===ZH||o===XH||o===YH||o===KH||o===QH||o===e9||o===t9||o===i9||o===n9||o===r9||o===s9||o===o9||o===a9||o===l9||o===c9||o===u9||o===h9||o===d9)return c=e.get("WEBGL_compressed_texture_astc"),c!==null?o:null;if(o===JH)return c=e.get("EXT_texture_compression_bptc"),c!==null?o:null;if(o===py)return i?34042:(c=e.get("WEBGL_depth_texture"),c!==null?c.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:r}}class Tz extends ea{constructor(e=[]){super(),this.cameras=e}}Tz.prototype.isArrayCamera=!0;class Yv extends Ln{constructor(){super(),this.type="Group"}}Yv.prototype.isGroup=!0;const fJ={type:"move"};class JT{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Yv,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Yv,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Ue,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Ue),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Yv,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Ue,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Ue),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let r=null,o=null,c=null;const s=this._targetRay,d=this._grip,p=this._hand;if(e&&t.session.visibilityState!=="visible-blurred")if(s!==null&&(r=t.getPose(e.targetRaySpace,i),r!==null&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),r.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(r.linearVelocity)):s.hasLinearVelocity=!1,r.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(r.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(fJ))),p&&e.hand){c=!0;for(const P of e.hand.values()){const L=t.getJointPose(P,i);if(p.joints[P.jointName]===void 0){const C=new Yv;C.matrixAutoUpdate=!1,C.visible=!1,p.joints[P.jointName]=C,p.add(C)}const E=p.joints[P.jointName];L!==null&&(E.matrix.fromArray(L.transform.matrix),E.matrix.decompose(E.position,E.rotation,E.scale),E.jointRadius=L.radius),E.visible=L!==null}const g=p.joints["index-finger-tip"],_=p.joints["thumb-tip"],x=g.position.distanceTo(_.position),b=.02,S=.005;p.inputState.pinching&&x>b+S?(p.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!p.inputState.pinching&&x<=b-S&&(p.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else d!==null&&e.gripSpace&&(o=t.getPose(e.gripSpace,i),o!==null&&(d.matrix.fromArray(o.transform.matrix),d.matrix.decompose(d.position,d.rotation,d.scale),o.linearVelocity?(d.hasLinearVelocity=!0,d.linearVelocity.copy(o.linearVelocity)):d.hasLinearVelocity=!1,o.angularVelocity?(d.hasAngularVelocity=!0,d.angularVelocity.copy(o.angularVelocity)):d.hasAngularVelocity=!1));return s!==null&&(s.visible=r!==null),d!==null&&(d.visible=o!==null),p!==null&&(p.visible=c!==null),this}}class pJ extends Tp{constructor(e,t){super();const i=this,r=e.state;let o=null,c=1,s=null,d="local-floor",p=null,g=null,_=null,x=null,b=null,S=!1,P=null,L=null,E=null,C=null,D=null,O=null;const U=[],q=new Map,G=new ea;G.layers.enable(1),G.viewport=new Zn;const N=new ea;N.layers.enable(2),N.viewport=new Zn;const V=[G,N],j=new Tz;j.layers.enable(1),j.layers.enable(2);let z=null,Q=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(He){let De=U[He];return De===void 0&&(De=new JT,U[He]=De),De.getTargetRaySpace()},this.getControllerGrip=function(He){let De=U[He];return De===void 0&&(De=new JT,U[He]=De),De.getGripSpace()},this.getHand=function(He){let De=U[He];return De===void 0&&(De=new JT,U[He]=De),De.getHandSpace()};function X(He){const De=q.get(He.inputSource);De&&De.dispatchEvent({type:He.type,data:He.inputSource})}function re(){q.forEach(function(He,De){He.disconnect(De)}),q.clear(),z=null,Q=null,r.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),_&&t.deleteFramebuffer(_),P&&t.deleteFramebuffer(P),L&&t.deleteRenderbuffer(L),E&&t.deleteRenderbuffer(E),_=null,P=null,L=null,E=null,b=null,x=null,g=null,o=null,nt.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(He){c=He,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(He){d=He,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return s},this.getBaseLayer=function(){return x!==null?x:b},this.getBinding=function(){return g},this.getFrame=function(){return C},this.getSession=function(){return o},this.setSession=async function(He){if(o=He,o!==null){o.addEventListener("select",X),o.addEventListener("selectstart",X),o.addEventListener("selectend",X),o.addEventListener("squeeze",X),o.addEventListener("squeezestart",X),o.addEventListener("squeezeend",X),o.addEventListener("end",re),o.addEventListener("inputsourceschange",se);const De=t.getContextAttributes();if(De.xrCompatible!==!0&&await t.makeXRCompatible(),o.renderState.layers===void 0){const ot={antialias:De.antialias,alpha:De.alpha,depth:De.depth,stencil:De.stencil,framebufferScaleFactor:c};b=new XRWebGLLayer(o,t,ot),o.updateRenderState({baseLayer:b})}else if(t instanceof WebGLRenderingContext){const ot={antialias:!0,alpha:De.alpha,depth:De.depth,stencil:De.stencil,framebufferScaleFactor:c};b=new XRWebGLLayer(o,t,ot),o.updateRenderState({layers:[b]})}else{S=De.antialias;let ot=null;De.depth&&(O=256,De.stencil&&(O|=1024),D=De.stencil?33306:36096,ot=De.stencil?35056:33190);const xe={colorFormat:De.alpha?32856:32849,depthFormat:ot,scaleFactor:c};g=new XRWebGLBinding(o,t),x=g.createProjectionLayer(xe),_=t.createFramebuffer(),o.updateRenderState({layers:[x]}),S&&(P=t.createFramebuffer(),L=t.createRenderbuffer(),t.bindRenderbuffer(36161,L),t.renderbufferStorageMultisample(36161,4,32856,x.textureWidth,x.textureHeight),r.bindFramebuffer(36160,P),t.framebufferRenderbuffer(36160,36064,36161,L),t.bindRenderbuffer(36161,null),ot!==null&&(E=t.createRenderbuffer(),t.bindRenderbuffer(36161,E),t.renderbufferStorageMultisample(36161,4,ot,x.textureWidth,x.textureHeight),t.framebufferRenderbuffer(36160,D,36161,E),t.bindRenderbuffer(36161,null)),r.bindFramebuffer(36160,null))}s=await o.requestReferenceSpace(d),nt.setContext(o),nt.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};function se(He){const De=o.inputSources;for(let ot=0;ot<U.length;ot++)q.set(De[ot],U[ot]);for(let ot=0;ot<He.removed.length;ot++){const xe=He.removed[ot],Be=q.get(xe);Be&&(Be.dispatchEvent({type:"disconnected",data:xe}),q.delete(xe))}for(let ot=0;ot<He.added.length;ot++){const xe=He.added[ot],Be=q.get(xe);Be&&Be.dispatchEvent({type:"connected",data:xe})}}const le=new Ue,ce=new Ue;function be(He,De,ot){le.setFromMatrixPosition(De.matrixWorld),ce.setFromMatrixPosition(ot.matrixWorld);const xe=le.distanceTo(ce),Be=De.projectionMatrix.elements,Je=ot.projectionMatrix.elements,ct=Be[14]/(Be[10]-1),xt=Be[14]/(Be[10]+1),Se=(Be[9]+1)/Be[5],me=(Be[9]-1)/Be[5],qe=(Be[8]-1)/Be[0],st=(Je[8]+1)/Je[0],Rt=ct*qe,gt=ct*st,Ae=xe/(-qe+st),we=Ae*-qe;De.matrixWorld.decompose(He.position,He.quaternion,He.scale),He.translateX(we),He.translateZ(Ae),He.matrixWorld.compose(He.position,He.quaternion,He.scale),He.matrixWorldInverse.copy(He.matrixWorld).invert();const vt=ct+Ae,ye=xt+Ae,ie=Rt-we,ae=gt+(xe-we),ke=Se*xt/ye*vt,Ze=me*xt/ye*vt;He.projectionMatrix.makePerspective(ie,ae,ke,Ze,vt,ye)}function Ee(He,De){De===null?He.matrixWorld.copy(He.matrix):He.matrixWorld.multiplyMatrices(De.matrixWorld,He.matrix),He.matrixWorldInverse.copy(He.matrixWorld).invert()}this.updateCamera=function(He){if(o===null)return;j.near=N.near=G.near=He.near,j.far=N.far=G.far=He.far,(z!==j.near||Q!==j.far)&&(o.updateRenderState({depthNear:j.near,depthFar:j.far}),z=j.near,Q=j.far);const De=He.parent,ot=j.cameras;Ee(j,De);for(let Be=0;Be<ot.length;Be++)Ee(ot[Be],De);j.matrixWorld.decompose(j.position,j.quaternion,j.scale),He.position.copy(j.position),He.quaternion.copy(j.quaternion),He.scale.copy(j.scale),He.matrix.copy(j.matrix),He.matrixWorld.copy(j.matrixWorld);const xe=He.children;for(let Be=0,Je=xe.length;Be<Je;Be++)xe[Be].updateMatrixWorld(!0);ot.length===2?be(j,G,N):j.projectionMatrix.copy(G.projectionMatrix)},this.getCamera=function(){return j},this.getFoveation=function(){if(x!==null)return x.fixedFoveation;if(b!==null)return b.fixedFoveation},this.setFoveation=function(He){x!==null&&(x.fixedFoveation=He),b!==null&&b.fixedFoveation!==void 0&&(b.fixedFoveation=He)};let $e=null;function Ve(He,De){if(p=De.getViewerPose(s),C=De,p!==null){const xe=p.views;b!==null&&r.bindXRFramebuffer(b.framebuffer);let Be=!1;xe.length!==j.cameras.length&&(j.cameras.length=0,Be=!0);for(let Je=0;Je<xe.length;Je++){const ct=xe[Je];let xt=null;if(b!==null)xt=b.getViewport(ct);else{const me=g.getViewSubImage(x,ct);r.bindXRFramebuffer(_),me.depthStencilTexture!==void 0&&t.framebufferTexture2D(36160,D,3553,me.depthStencilTexture,0),t.framebufferTexture2D(36160,36064,3553,me.colorTexture,0),xt=me.viewport}const Se=V[Je];Se.matrix.fromArray(ct.transform.matrix),Se.projectionMatrix.fromArray(ct.projectionMatrix),Se.viewport.set(xt.x,xt.y,xt.width,xt.height),Je===0&&j.matrix.copy(Se.matrix),Be===!0&&j.cameras.push(Se)}S&&(r.bindXRFramebuffer(P),O!==null&&t.clear(O))}const ot=o.inputSources;for(let xe=0;xe<U.length;xe++){const Be=U[xe],Je=ot[xe];Be.update(Je,De,s)}if($e&&$e(He,De),S){const xe=x.textureWidth,Be=x.textureHeight;r.bindFramebuffer(36008,P),r.bindFramebuffer(36009,_),t.invalidateFramebuffer(36008,[D]),t.invalidateFramebuffer(36009,[D]),t.blitFramebuffer(0,0,xe,Be,0,0,xe,Be,16384,9728),t.invalidateFramebuffer(36008,[36064]),r.bindFramebuffer(36008,null),r.bindFramebuffer(36009,null),r.bindFramebuffer(36160,P)}C=null}const nt=new uz;nt.setAnimationLoop(Ve),this.setAnimationLoop=function(He){$e=He},this.dispose=function(){}}}function mJ(n){function e(E,C){E.fogColor.value.copy(C.color),C.isFog?(E.fogNear.value=C.near,E.fogFar.value=C.far):C.isFogExp2&&(E.fogDensity.value=C.density)}function t(E,C,D,O,U){C.isMeshBasicMaterial?i(E,C):C.isMeshLambertMaterial?(i(E,C),d(E,C)):C.isMeshToonMaterial?(i(E,C),g(E,C)):C.isMeshPhongMaterial?(i(E,C),p(E,C)):C.isMeshStandardMaterial?(i(E,C),C.isMeshPhysicalMaterial?x(E,C,U):_(E,C)):C.isMeshMatcapMaterial?(i(E,C),b(E,C)):C.isMeshDepthMaterial?(i(E,C),S(E,C)):C.isMeshDistanceMaterial?(i(E,C),P(E,C)):C.isMeshNormalMaterial?(i(E,C),L(E,C)):C.isLineBasicMaterial?(r(E,C),C.isLineDashedMaterial&&o(E,C)):C.isPointsMaterial?c(E,C,D,O):C.isSpriteMaterial?s(E,C):C.isShadowMaterial?(E.color.value.copy(C.color),E.opacity.value=C.opacity):C.isShaderMaterial&&(C.uniformsNeedUpdate=!1)}function i(E,C){E.opacity.value=C.opacity,C.color&&E.diffuse.value.copy(C.color),C.emissive&&E.emissive.value.copy(C.emissive).multiplyScalar(C.emissiveIntensity),C.map&&(E.map.value=C.map),C.alphaMap&&(E.alphaMap.value=C.alphaMap),C.specularMap&&(E.specularMap.value=C.specularMap),C.alphaTest>0&&(E.alphaTest.value=C.alphaTest);const D=n.get(C).envMap;if(D){E.envMap.value=D,E.flipEnvMap.value=D.isCubeTexture&&D.isRenderTargetTexture===!1?-1:1,E.reflectivity.value=C.reflectivity,E.ior.value=C.ior,E.refractionRatio.value=C.refractionRatio;const q=n.get(D).__maxMipLevel;q!==void 0&&(E.maxMipLevel.value=q)}C.lightMap&&(E.lightMap.value=C.lightMap,E.lightMapIntensity.value=C.lightMapIntensity),C.aoMap&&(E.aoMap.value=C.aoMap,E.aoMapIntensity.value=C.aoMapIntensity);let O;C.map?O=C.map:C.specularMap?O=C.specularMap:C.displacementMap?O=C.displacementMap:C.normalMap?O=C.normalMap:C.bumpMap?O=C.bumpMap:C.roughnessMap?O=C.roughnessMap:C.metalnessMap?O=C.metalnessMap:C.alphaMap?O=C.alphaMap:C.emissiveMap?O=C.emissiveMap:C.clearcoatMap?O=C.clearcoatMap:C.clearcoatNormalMap?O=C.clearcoatNormalMap:C.clearcoatRoughnessMap?O=C.clearcoatRoughnessMap:C.specularIntensityMap?O=C.specularIntensityMap:C.specularColorMap?O=C.specularColorMap:C.transmissionMap?O=C.transmissionMap:C.thicknessMap?O=C.thicknessMap:C.sheenColorMap?O=C.sheenColorMap:C.sheenRoughnessMap&&(O=C.sheenRoughnessMap),O!==void 0&&(O.isWebGLRenderTarget&&(O=O.texture),O.matrixAutoUpdate===!0&&O.updateMatrix(),E.uvTransform.value.copy(O.matrix));let U;C.aoMap?U=C.aoMap:C.lightMap&&(U=C.lightMap),U!==void 0&&(U.isWebGLRenderTarget&&(U=U.texture),U.matrixAutoUpdate===!0&&U.updateMatrix(),E.uv2Transform.value.copy(U.matrix))}function r(E,C){E.diffuse.value.copy(C.color),E.opacity.value=C.opacity}function o(E,C){E.dashSize.value=C.dashSize,E.totalSize.value=C.dashSize+C.gapSize,E.scale.value=C.scale}function c(E,C,D,O){E.diffuse.value.copy(C.color),E.opacity.value=C.opacity,E.size.value=C.size*D,E.scale.value=O*.5,C.map&&(E.map.value=C.map),C.alphaMap&&(E.alphaMap.value=C.alphaMap),C.alphaTest>0&&(E.alphaTest.value=C.alphaTest);let U;C.map?U=C.map:C.alphaMap&&(U=C.alphaMap),U!==void 0&&(U.matrixAutoUpdate===!0&&U.updateMatrix(),E.uvTransform.value.copy(U.matrix))}function s(E,C){E.diffuse.value.copy(C.color),E.opacity.value=C.opacity,E.rotation.value=C.rotation,C.map&&(E.map.value=C.map),C.alphaMap&&(E.alphaMap.value=C.alphaMap),C.alphaTest>0&&(E.alphaTest.value=C.alphaTest);let D;C.map?D=C.map:C.alphaMap&&(D=C.alphaMap),D!==void 0&&(D.matrixAutoUpdate===!0&&D.updateMatrix(),E.uvTransform.value.copy(D.matrix))}function d(E,C){C.emissiveMap&&(E.emissiveMap.value=C.emissiveMap)}function p(E,C){E.specular.value.copy(C.specular),E.shininess.value=Math.max(C.shininess,1e-4),C.emissiveMap&&(E.emissiveMap.value=C.emissiveMap),C.bumpMap&&(E.bumpMap.value=C.bumpMap,E.bumpScale.value=C.bumpScale,C.side===qs&&(E.bumpScale.value*=-1)),C.normalMap&&(E.normalMap.value=C.normalMap,E.normalScale.value.copy(C.normalScale),C.side===qs&&E.normalScale.value.negate()),C.displacementMap&&(E.displacementMap.value=C.displacementMap,E.displacementScale.value=C.displacementScale,E.displacementBias.value=C.displacementBias)}function g(E,C){C.gradientMap&&(E.gradientMap.value=C.gradientMap),C.emissiveMap&&(E.emissiveMap.value=C.emissiveMap),C.bumpMap&&(E.bumpMap.value=C.bumpMap,E.bumpScale.value=C.bumpScale,C.side===qs&&(E.bumpScale.value*=-1)),C.normalMap&&(E.normalMap.value=C.normalMap,E.normalScale.value.copy(C.normalScale),C.side===qs&&E.normalScale.value.negate()),C.displacementMap&&(E.displacementMap.value=C.displacementMap,E.displacementScale.value=C.displacementScale,E.displacementBias.value=C.displacementBias)}function _(E,C){E.roughness.value=C.roughness,E.metalness.value=C.metalness,C.roughnessMap&&(E.roughnessMap.value=C.roughnessMap),C.metalnessMap&&(E.metalnessMap.value=C.metalnessMap),C.emissiveMap&&(E.emissiveMap.value=C.emissiveMap),C.bumpMap&&(E.bumpMap.value=C.bumpMap,E.bumpScale.value=C.bumpScale,C.side===qs&&(E.bumpScale.value*=-1)),C.normalMap&&(E.normalMap.value=C.normalMap,E.normalScale.value.copy(C.normalScale),C.side===qs&&E.normalScale.value.negate()),C.displacementMap&&(E.displacementMap.value=C.displacementMap,E.displacementScale.value=C.displacementScale,E.displacementBias.value=C.displacementBias),n.get(C).envMap&&(E.envMapIntensity.value=C.envMapIntensity)}function x(E,C,D){_(E,C),E.ior.value=C.ior,C.sheen>0&&(E.sheenColor.value.copy(C.sheenColor).multiplyScalar(C.sheen),E.sheenRoughness.value=C.sheenRoughness,C.sheenColorMap&&(E.sheenColorMap.value=C.sheenColorMap),C.sheenRoughnessMap&&(E.sheenRoughnessMap.value=C.sheenRoughnessMap)),C.clearcoat>0&&(E.clearcoat.value=C.clearcoat,E.clearcoatRoughness.value=C.clearcoatRoughness,C.clearcoatMap&&(E.clearcoatMap.value=C.clearcoatMap),C.clearcoatRoughnessMap&&(E.clearcoatRoughnessMap.value=C.clearcoatRoughnessMap),C.clearcoatNormalMap&&(E.clearcoatNormalScale.value.copy(C.clearcoatNormalScale),E.clearcoatNormalMap.value=C.clearcoatNormalMap,C.side===qs&&E.clearcoatNormalScale.value.negate())),C.transmission>0&&(E.transmission.value=C.transmission,E.transmissionSamplerMap.value=D.texture,E.transmissionSamplerSize.value.set(D.width,D.height),C.transmissionMap&&(E.transmissionMap.value=C.transmissionMap),E.thickness.value=C.thickness,C.thicknessMap&&(E.thicknessMap.value=C.thicknessMap),E.attenuationDistance.value=C.attenuationDistance,E.attenuationColor.value.copy(C.attenuationColor)),E.specularIntensity.value=C.specularIntensity,E.specularColor.value.copy(C.specularColor),C.specularIntensityMap&&(E.specularIntensityMap.value=C.specularIntensityMap),C.specularColorMap&&(E.specularColorMap.value=C.specularColorMap)}function b(E,C){C.matcap&&(E.matcap.value=C.matcap),C.bumpMap&&(E.bumpMap.value=C.bumpMap,E.bumpScale.value=C.bumpScale,C.side===qs&&(E.bumpScale.value*=-1)),C.normalMap&&(E.normalMap.value=C.normalMap,E.normalScale.value.copy(C.normalScale),C.side===qs&&E.normalScale.value.negate()),C.displacementMap&&(E.displacementMap.value=C.displacementMap,E.displacementScale.value=C.displacementScale,E.displacementBias.value=C.displacementBias)}function S(E,C){C.displacementMap&&(E.displacementMap.value=C.displacementMap,E.displacementScale.value=C.displacementScale,E.displacementBias.value=C.displacementBias)}function P(E,C){C.displacementMap&&(E.displacementMap.value=C.displacementMap,E.displacementScale.value=C.displacementScale,E.displacementBias.value=C.displacementBias),E.referencePosition.value.copy(C.referencePosition),E.nearDistance.value=C.nearDistance,E.farDistance.value=C.farDistance}function L(E,C){C.bumpMap&&(E.bumpMap.value=C.bumpMap,E.bumpScale.value=C.bumpScale,C.side===qs&&(E.bumpScale.value*=-1)),C.normalMap&&(E.normalMap.value=C.normalMap,E.normalScale.value.copy(C.normalScale),C.side===qs&&E.normalScale.value.negate()),C.displacementMap&&(E.displacementMap.value=C.displacementMap,E.displacementScale.value=C.displacementScale,E.displacementBias.value=C.displacementBias)}return{refreshFogUniforms:e,refreshMaterialUniforms:t}}function gJ(){const n=u1("canvas");return n.style.display="block",n}function hr(n={}){const e=n.canvas!==void 0?n.canvas:gJ(),t=n.context!==void 0?n.context:null,i=n.alpha!==void 0?n.alpha:!1,r=n.depth!==void 0?n.depth:!0,o=n.stencil!==void 0?n.stencil:!0,c=n.antialias!==void 0?n.antialias:!1,s=n.premultipliedAlpha!==void 0?n.premultipliedAlpha:!0,d=n.preserveDrawingBuffer!==void 0?n.preserveDrawingBuffer:!1,p=n.powerPreference!==void 0?n.powerPreference:"default",g=n.failIfMajorPerformanceCaveat!==void 0?n.failIfMajorPerformanceCaveat:!1;let _=null,x=null;const b=[],S=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Fo,this.physicallyCorrectLights=!1,this.toneMapping=ap,this.toneMappingExposure=1;const P=this;let L=!1,E=0,C=0,D=null,O=-1,U=null;const q=new Zn,G=new Zn;let N=null,V=e.width,j=e.height,z=1,Q=null,X=null;const re=new Zn(0,0,V,j),se=new Zn(0,0,V,j);let le=!1;const ce=[],be=new d1;let Ee=!1,$e=!1,Ve=null;const nt=new Li,He=new Ue,De={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ot(){return D===null?z:1}let xe=t;function Be(Xe,kt){for(let lt=0;lt<Xe.length;lt++){const Ft=Xe[lt],Wt=e.getContext(Ft,kt);if(Wt!==null)return Wt}return null}try{const Xe={alpha:i,depth:r,stencil:o,antialias:c,premultipliedAlpha:s,preserveDrawingBuffer:d,powerPreference:p,failIfMajorPerformanceCaveat:g};if(e.addEventListener("webglcontextlost",pt,!1),e.addEventListener("webglcontextrestored",rt,!1),xe===null){const kt=["webgl2","webgl","experimental-webgl"];if(P.isWebGL1Renderer===!0&&kt.shift(),xe=Be(kt,Xe),xe===null)throw Be(kt)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}xe.getShaderPrecisionFormat===void 0&&(xe.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Xe){throw console.error("THREE.WebGLRenderer: "+Xe.message),Xe}let Je,ct,xt,Se,me,qe,st,Rt,gt,Ae,we,vt,ye,ie,ae,ke,Ze,yt,Me,ee,de,pe,Le;function Oe(){Je=new NY(xe),ct=new RY(xe,Je,n),Je.init(ct),pe=new dJ(xe,Je,ct),xt=new uJ(xe,Je,ct),ce[0]=1029,Se=new UY,me=new QK,qe=new hJ(xe,Je,xt,me,ct,pe,Se),st=new kY(P),Rt=new BY(P),gt=new tZ(xe,ct),Le=new PY(xe,Je,gt,ct),Ae=new $Y(xe,gt,Se,Le),we=new WY(xe,Ae,gt,Se),Me=new qY(xe,ct,qe),ke=new LY(me),vt=new JK(P,st,Rt,Je,ct,Le,ke),ye=new mJ(me),ie=new tJ(me),ae=new aJ(Je,ct),yt=new AY(P,st,xt,we,s),Ze=new Sz(P,we,ct),ee=new IY(xe,Je,Se,ct),de=new VY(xe,Je,Se,ct),Se.programs=vt.programs,P.capabilities=ct,P.extensions=Je,P.properties=me,P.renderLists=ie,P.shadowMap=Ze,P.state=xt,P.info=Se}Oe();const dt=new pJ(P,xe);this.xr=dt,this.getContext=function(){return xe},this.getContextAttributes=function(){return xe.getContextAttributes()},this.forceContextLoss=function(){const Xe=Je.get("WEBGL_lose_context");Xe&&Xe.loseContext()},this.forceContextRestore=function(){const Xe=Je.get("WEBGL_lose_context");Xe&&Xe.restoreContext()},this.getPixelRatio=function(){return z},this.setPixelRatio=function(Xe){Xe!==void 0&&(z=Xe,this.setSize(V,j,!1))},this.getSize=function(Xe){return Xe.set(V,j)},this.setSize=function(Xe,kt,lt){if(dt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}V=Xe,j=kt,e.width=Math.floor(Xe*z),e.height=Math.floor(kt*z),lt!==!1&&(e.style.width=Xe+"px",e.style.height=kt+"px"),this.setViewport(0,0,Xe,kt)},this.getDrawingBufferSize=function(Xe){return Xe.set(V*z,j*z).floor()},this.setDrawingBufferSize=function(Xe,kt,lt){V=Xe,j=kt,z=lt,e.width=Math.floor(Xe*lt),e.height=Math.floor(kt*lt),this.setViewport(0,0,Xe,kt)},this.getCurrentViewport=function(Xe){return Xe.copy(q)},this.getViewport=function(Xe){return Xe.copy(re)},this.setViewport=function(Xe,kt,lt,Ft){Xe.isVector4?re.set(Xe.x,Xe.y,Xe.z,Xe.w):re.set(Xe,kt,lt,Ft),xt.viewport(q.copy(re).multiplyScalar(z).floor())},this.getScissor=function(Xe){return Xe.copy(se)},this.setScissor=function(Xe,kt,lt,Ft){Xe.isVector4?se.set(Xe.x,Xe.y,Xe.z,Xe.w):se.set(Xe,kt,lt,Ft),xt.scissor(G.copy(se).multiplyScalar(z).floor())},this.getScissorTest=function(){return le},this.setScissorTest=function(Xe){xt.setScissorTest(le=Xe)},this.setOpaqueSort=function(Xe){Q=Xe},this.setTransparentSort=function(Xe){X=Xe},this.getClearColor=function(Xe){return Xe.copy(yt.getClearColor())},this.setClearColor=function(){yt.setClearColor.apply(yt,arguments)},this.getClearAlpha=function(){return yt.getClearAlpha()},this.setClearAlpha=function(){yt.setClearAlpha.apply(yt,arguments)},this.clear=function(Xe,kt,lt){let Ft=0;(Xe===void 0||Xe)&&(Ft|=16384),(kt===void 0||kt)&&(Ft|=256),(lt===void 0||lt)&&(Ft|=1024),xe.clear(Ft)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",pt,!1),e.removeEventListener("webglcontextrestored",rt,!1),ie.dispose(),ae.dispose(),me.dispose(),st.dispose(),Rt.dispose(),we.dispose(),Le.dispose(),dt.dispose(),dt.removeEventListener("sessionstart",$i),dt.removeEventListener("sessionend",vn),Ve&&(Ve.dispose(),Ve=null),on.stop()};function pt(Xe){Xe.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),L=!0}function rt(){console.log("THREE.WebGLRenderer: Context Restored."),L=!1;const Xe=Se.autoReset,kt=Ze.enabled,lt=Ze.autoUpdate,Ft=Ze.needsUpdate,Wt=Ze.type;Oe(),Se.autoReset=Xe,Ze.enabled=kt,Ze.autoUpdate=lt,Ze.needsUpdate=Ft,Ze.type=Wt}function St(Xe){const kt=Xe.target;kt.removeEventListener("dispose",St),Dt(kt)}function Dt(Xe){Bt(Xe),me.remove(Xe)}function Bt(Xe){const kt=me.get(Xe).programs;kt!==void 0&&kt.forEach(function(lt){vt.releaseProgram(lt)})}this.renderBufferDirect=function(Xe,kt,lt,Ft,Wt,qi){kt===null&&(kt=De);const Ii=Wt.isMesh&&Wt.matrixWorld.determinant()<0,Nt=Un(Xe,kt,lt,Ft,Wt);xt.setMaterial(Ft,Ii);let ai=lt.index;const pi=lt.attributes.position;if(ai===null){if(pi===void 0||pi.count===0)return}else if(ai.count===0)return;let Wi=1;Ft.wireframe===!0&&(ai=Ae.getWireframeAttribute(lt),Wi=2),Le.setup(Wt,Ft,Nt,lt,ai);let wt,Ri=ee;ai!==null&&(wt=gt.get(ai),Ri=de,Ri.setIndex(wt));const bi=ai!==null?ai.count:pi.count,Ni=lt.drawRange.start*Wi,Kn=lt.drawRange.count*Wi,Xi=qi!==null?qi.start*Wi:0,jn=qi!==null?qi.count*Wi:1/0,an=Math.max(Ni,Xi),zr=Math.min(bi,Ni+Kn,Xi+jn)-1,Gn=Math.max(0,zr-an+1);if(Gn!==0){if(Wt.isMesh)Ft.wireframe===!0?(xt.setLineWidth(Ft.wireframeLinewidth*ot()),Ri.setMode(1)):Ri.setMode(4);else if(Wt.isLine){let ln=Ft.linewidth;ln===void 0&&(ln=1),xt.setLineWidth(ln*ot()),Wt.isLineSegments?Ri.setMode(1):Wt.isLineLoop?Ri.setMode(2):Ri.setMode(3)}else Wt.isPoints?Ri.setMode(0):Wt.isSprite&&Ri.setMode(4);if(Wt.isInstancedMesh)Ri.renderInstances(an,Gn,Wt.count);else if(lt.isInstancedBufferGeometry){const ln=Math.min(lt.instanceCount,lt._maxInstanceCount);Ri.renderInstances(an,Gn,ln)}else Ri.render(an,Gn)}},this.compile=function(Xe,kt){x=ae.get(Xe),x.init(),S.push(x),Xe.traverseVisible(function(lt){lt.isLight&&lt.layers.test(kt.layers)&&(x.pushLight(lt),lt.castShadow&&x.pushShadow(lt))}),x.setupLights(P.physicallyCorrectLights),Xe.traverse(function(lt){const Ft=lt.material;if(Ft)if(Array.isArray(Ft))for(let Wt=0;Wt<Ft.length;Wt++){const qi=Ft[Wt];Yn(qi,Xe,lt)}else Yn(Ft,Xe,lt)}),S.pop(),x=null};let Jt=null;function vi(Xe){Jt&&Jt(Xe)}function $i(){on.stop()}function vn(){on.start()}const on=new uz;on.setAnimationLoop(vi),typeof window<"u"&&on.setContext(window),this.setAnimationLoop=function(Xe){Jt=Xe,dt.setAnimationLoop(Xe),Xe===null?on.stop():on.start()},dt.addEventListener("sessionstart",$i),dt.addEventListener("sessionend",vn),this.render=function(Xe,kt){if(kt!==void 0&&kt.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(L===!0)return;Xe.autoUpdate===!0&&Xe.updateMatrixWorld(),kt.parent===null&&kt.updateMatrixWorld(),dt.enabled===!0&&dt.isPresenting===!0&&(dt.cameraAutoUpdate===!0&&dt.updateCamera(kt),kt=dt.getCamera()),Xe.isScene===!0&&Xe.onBeforeRender(P,Xe,kt,D),x=ae.get(Xe,S.length),x.init(),S.push(x),nt.multiplyMatrices(kt.projectionMatrix,kt.matrixWorldInverse),be.setFromProjectionMatrix(nt),$e=this.localClippingEnabled,Ee=ke.init(this.clippingPlanes,$e,kt),_=ie.get(Xe,b.length),_.init(),b.push(_),Tt(Xe,kt,0,P.sortObjects),_.finish(),P.sortObjects===!0&&_.sort(Q,X),Ee===!0&&ke.beginShadows();const lt=x.state.shadowsArray;if(Ze.render(lt,Xe,kt),Ee===!0&&ke.endShadows(),this.info.autoReset===!0&&this.info.reset(),yt.render(_,Xe),x.setupLights(P.physicallyCorrectLights),kt.isArrayCamera){const Ft=kt.cameras;for(let Wt=0,qi=Ft.length;Wt<qi;Wt++){const Ii=Ft[Wt];gn(_,Xe,Ii,Ii.viewport)}}else gn(_,Xe,kt);D!==null&&(qe.updateMultisampleRenderTarget(D),qe.updateRenderTargetMipmap(D)),Xe.isScene===!0&&Xe.onAfterRender(P,Xe,kt),xt.buffers.depth.setTest(!0),xt.buffers.depth.setMask(!0),xt.buffers.color.setMask(!0),xt.setPolygonOffset(!1),Le.resetDefaultState(),O=-1,U=null,S.pop(),S.length>0?x=S[S.length-1]:x=null,b.pop(),b.length>0?_=b[b.length-1]:_=null};function Tt(Xe,kt,lt,Ft){if(Xe.visible===!1)return;if(Xe.layers.test(kt.layers)){if(Xe.isGroup)lt=Xe.renderOrder;else if(Xe.isLOD)Xe.autoUpdate===!0&&Xe.update(kt);else if(Xe.isLight)x.pushLight(Xe),Xe.castShadow&&x.pushShadow(Xe);else if(Xe.isSprite){if(!Xe.frustumCulled||be.intersectsSprite(Xe)){Ft&&He.setFromMatrixPosition(Xe.matrixWorld).applyMatrix4(nt);const Ii=we.update(Xe),Nt=Xe.material;Nt.visible&&_.push(Xe,Ii,Nt,lt,He.z,null)}}else if((Xe.isMesh||Xe.isLine||Xe.isPoints)&&(Xe.isSkinnedMesh&&Xe.skeleton.frame!==Se.render.frame&&(Xe.skeleton.update(),Xe.skeleton.frame=Se.render.frame),!Xe.frustumCulled||be.intersectsObject(Xe))){Ft&&He.setFromMatrixPosition(Xe.matrixWorld).applyMatrix4(nt);const Ii=we.update(Xe),Nt=Xe.material;if(Array.isArray(Nt)){const ai=Ii.groups;for(let pi=0,Wi=ai.length;pi<Wi;pi++){const wt=ai[pi],Ri=Nt[wt.materialIndex];Ri&&Ri.visible&&_.push(Xe,Ii,Ri,lt,He.z,wt)}}else Nt.visible&&_.push(Xe,Ii,Nt,lt,He.z,null)}}const qi=Xe.children;for(let Ii=0,Nt=qi.length;Ii<Nt;Ii++)Tt(qi[Ii],kt,lt,Ft)}function gn(Xe,kt,lt,Ft){const Wt=Xe.opaque,qi=Xe.transmissive,Ii=Xe.transparent;x.setupLightsView(lt),qi.length>0&&Er(Wt,kt,lt),Ft&&xt.viewport(q.copy(Ft)),Wt.length>0&&Di(Wt,kt,lt),qi.length>0&&Di(qi,kt,lt),Ii.length>0&&Di(Ii,kt,lt)}function Er(Xe,kt,lt){if(Ve===null){const Ii=c===!0&&ct.isWebGL2===!0?rz:Mc;Ve=new Ii(1024,1024,{generateMipmaps:!0,type:pe.convert(Pg)!==null?Pg:Bd,minFilter:c1,magFilter:Zs,wrapS:el,wrapT:el})}const Ft=P.getRenderTarget();P.setRenderTarget(Ve),P.clear();const Wt=P.toneMapping;P.toneMapping=ap,Di(Xe,kt,lt),P.toneMapping=Wt,qe.updateMultisampleRenderTarget(Ve),qe.updateRenderTargetMipmap(Ve),P.setRenderTarget(Ft)}function Di(Xe,kt,lt){const Ft=kt.isScene===!0?kt.overrideMaterial:null;for(let Wt=0,qi=Xe.length;Wt<qi;Wt++){const Ii=Xe[Wt],Nt=Ii.object,ai=Ii.geometry,pi=Ft===null?Ii.material:Ft,Wi=Ii.group;Nt.layers.test(lt.layers)&&yn(Nt,kt,lt,ai,pi,Wi)}}function yn(Xe,kt,lt,Ft,Wt,qi){Xe.onBeforeRender(P,kt,lt,Ft,Wt,qi),Xe.modelViewMatrix.multiplyMatrices(lt.matrixWorldInverse,Xe.matrixWorld),Xe.normalMatrix.getNormalMatrix(Xe.modelViewMatrix),Wt.onBeforeRender(P,kt,lt,Ft,Xe,qi),Wt.transparent===!0&&Wt.side===Ko?(Wt.side=qs,Wt.needsUpdate=!0,P.renderBufferDirect(lt,kt,Ft,Wt,Xe,qi),Wt.side=Wg,Wt.needsUpdate=!0,P.renderBufferDirect(lt,kt,Ft,Wt,Xe,qi),Wt.side=Ko):P.renderBufferDirect(lt,kt,Ft,Wt,Xe,qi),Xe.onAfterRender(P,kt,lt,Ft,Wt,qi)}function Yn(Xe,kt,lt){kt.isScene!==!0&&(kt=De);const Ft=me.get(Xe),Wt=x.state.lights,qi=x.state.shadowsArray,Ii=Wt.state.version,Nt=vt.getParameters(Xe,Wt.state,qi,kt,lt),ai=vt.getProgramCacheKey(Nt);let pi=Ft.programs;Ft.environment=Xe.isMeshStandardMaterial?kt.environment:null,Ft.fog=kt.fog,Ft.envMap=(Xe.isMeshStandardMaterial?Rt:st).get(Xe.envMap||Ft.environment),pi===void 0&&(Xe.addEventListener("dispose",St),pi=new Map,Ft.programs=pi);let Wi=pi.get(ai);if(Wi!==void 0){if(Ft.currentProgram===Wi&&Ft.lightsStateVersion===Ii)return Cn(Xe,Nt),Wi}else Nt.uniforms=vt.getUniforms(Xe),Xe.onBuild(lt,Nt,P),Xe.onBeforeCompile(Nt,P),Wi=vt.acquireProgram(Nt,ai),pi.set(ai,Wi),Ft.uniforms=Nt.uniforms;const wt=Ft.uniforms;(!Xe.isShaderMaterial&&!Xe.isRawShaderMaterial||Xe.clipping===!0)&&(wt.clippingPlanes=ke.uniform),Cn(Xe,Nt),Ft.needsLights=dr(Xe),Ft.lightsStateVersion=Ii,Ft.needsLights&&(wt.ambientLightColor.value=Wt.state.ambient,wt.lightProbe.value=Wt.state.probe,wt.directionalLights.value=Wt.state.directional,wt.directionalLightShadows.value=Wt.state.directionalShadow,wt.spotLights.value=Wt.state.spot,wt.spotLightShadows.value=Wt.state.spotShadow,wt.rectAreaLights.value=Wt.state.rectArea,wt.ltc_1.value=Wt.state.rectAreaLTC1,wt.ltc_2.value=Wt.state.rectAreaLTC2,wt.pointLights.value=Wt.state.point,wt.pointLightShadows.value=Wt.state.pointShadow,wt.hemisphereLights.value=Wt.state.hemi,wt.directionalShadowMap.value=Wt.state.directionalShadowMap,wt.directionalShadowMatrix.value=Wt.state.directionalShadowMatrix,wt.spotShadowMap.value=Wt.state.spotShadowMap,wt.spotShadowMatrix.value=Wt.state.spotShadowMatrix,wt.pointShadowMap.value=Wt.state.pointShadowMap,wt.pointShadowMatrix.value=Wt.state.pointShadowMatrix);const Ri=Wi.getUniforms(),bi=Rd.seqWithValue(Ri.seq,wt);return Ft.currentProgram=Wi,Ft.uniformsList=bi,Wi}function Cn(Xe,kt){const lt=me.get(Xe);lt.outputEncoding=kt.outputEncoding,lt.instancing=kt.instancing,lt.skinning=kt.skinning,lt.morphTargets=kt.morphTargets,lt.morphNormals=kt.morphNormals,lt.morphTargetsCount=kt.morphTargetsCount,lt.numClippingPlanes=kt.numClippingPlanes,lt.numIntersection=kt.numClipIntersection,lt.vertexAlphas=kt.vertexAlphas,lt.vertexTangents=kt.vertexTangents}function Un(Xe,kt,lt,Ft,Wt){kt.isScene!==!0&&(kt=De),qe.resetTextureUnits();const qi=kt.fog,Ii=Ft.isMeshStandardMaterial?kt.environment:null,Nt=D===null?P.outputEncoding:D.texture.encoding,ai=(Ft.isMeshStandardMaterial?Rt:st).get(Ft.envMap||Ii),pi=Ft.vertexColors===!0&&!!lt.attributes.color&&lt.attributes.color.itemSize===4,Wi=!!Ft.normalMap&&!!lt.attributes.tangent,wt=!!lt.morphAttributes.position,Ri=!!lt.morphAttributes.normal,bi=lt.morphAttributes.position?lt.morphAttributes.position.length:0,Ni=me.get(Ft),Kn=x.state.lights;if(Ee===!0&&($e===!0||Xe!==U)){const ns=Xe===U&&Ft.id===O;ke.setState(Ft,Xe,ns)}let Xi=!1;Ft.version===Ni.__version?(Ni.needsLights&&Ni.lightsStateVersion!==Kn.state.version||Ni.outputEncoding!==Nt||Wt.isInstancedMesh&&Ni.instancing===!1||!Wt.isInstancedMesh&&Ni.instancing===!0||Wt.isSkinnedMesh&&Ni.skinning===!1||!Wt.isSkinnedMesh&&Ni.skinning===!0||Ni.envMap!==ai||Ft.fog&&Ni.fog!==qi||Ni.numClippingPlanes!==void 0&&(Ni.numClippingPlanes!==ke.numPlanes||Ni.numIntersection!==ke.numIntersection)||Ni.vertexAlphas!==pi||Ni.vertexTangents!==Wi||Ni.morphTargets!==wt||Ni.morphNormals!==Ri||ct.isWebGL2===!0&&Ni.morphTargetsCount!==bi)&&(Xi=!0):(Xi=!0,Ni.__version=Ft.version);let jn=Ni.currentProgram;Xi===!0&&(jn=Yn(Ft,kt,Wt));let an=!1,zr=!1,Gn=!1;const ln=jn.getUniforms(),tn=Ni.uniforms;if(xt.useProgram(jn.program)&&(an=!0,zr=!0,Gn=!0),Ft.id!==O&&(O=Ft.id,zr=!0),an||U!==Xe){if(ln.setValue(xe,"projectionMatrix",Xe.projectionMatrix),ct.logarithmicDepthBuffer&&ln.setValue(xe,"logDepthBufFC",2/(Math.log(Xe.far+1)/Math.LN2)),U!==Xe&&(U=Xe,zr=!0,Gn=!0),Ft.isShaderMaterial||Ft.isMeshPhongMaterial||Ft.isMeshToonMaterial||Ft.isMeshStandardMaterial||Ft.envMap){const ns=ln.map.cameraPosition;ns!==void 0&&ns.setValue(xe,He.setFromMatrixPosition(Xe.matrixWorld))}(Ft.isMeshPhongMaterial||Ft.isMeshToonMaterial||Ft.isMeshLambertMaterial||Ft.isMeshBasicMaterial||Ft.isMeshStandardMaterial||Ft.isShaderMaterial)&&ln.setValue(xe,"isOrthographic",Xe.isOrthographicCamera===!0),(Ft.isMeshPhongMaterial||Ft.isMeshToonMaterial||Ft.isMeshLambertMaterial||Ft.isMeshBasicMaterial||Ft.isMeshStandardMaterial||Ft.isShaderMaterial||Ft.isShadowMaterial||Wt.isSkinnedMesh)&&ln.setValue(xe,"viewMatrix",Xe.matrixWorldInverse)}if(Wt.isSkinnedMesh){ln.setOptional(xe,Wt,"bindMatrix"),ln.setOptional(xe,Wt,"bindMatrixInverse");const ns=Wt.skeleton;ns&&(ct.floatVertexTextures?(ns.boneTexture===null&&ns.computeBoneTexture(),ln.setValue(xe,"boneTexture",ns.boneTexture,qe),ln.setValue(xe,"boneTextureSize",ns.boneTextureSize)):ln.setOptional(xe,ns,"boneMatrices"))}return lt&&(lt.morphAttributes.position!==void 0||lt.morphAttributes.normal!==void 0)&&Me.update(Wt,lt,Ft,jn),(zr||Ni.receiveShadow!==Wt.receiveShadow)&&(Ni.receiveShadow=Wt.receiveShadow,ln.setValue(xe,"receiveShadow",Wt.receiveShadow)),zr&&(ln.setValue(xe,"toneMappingExposure",P.toneMappingExposure),Ni.needsLights&&En(tn,Gn),qi&&Ft.fog&&ye.refreshFogUniforms(tn,qi),ye.refreshMaterialUniforms(tn,Ft,z,j,Ve),Rd.upload(xe,Ni.uniformsList,tn,qe)),Ft.isShaderMaterial&&Ft.uniformsNeedUpdate===!0&&(Rd.upload(xe,Ni.uniformsList,tn,qe),Ft.uniformsNeedUpdate=!1),Ft.isSpriteMaterial&&ln.setValue(xe,"center",Wt.center),ln.setValue(xe,"modelViewMatrix",Wt.modelViewMatrix),ln.setValue(xe,"normalMatrix",Wt.normalMatrix),ln.setValue(xe,"modelMatrix",Wt.matrixWorld),jn}function En(Xe,kt){Xe.ambientLightColor.needsUpdate=kt,Xe.lightProbe.needsUpdate=kt,Xe.directionalLights.needsUpdate=kt,Xe.directionalLightShadows.needsUpdate=kt,Xe.pointLights.needsUpdate=kt,Xe.pointLightShadows.needsUpdate=kt,Xe.spotLights.needsUpdate=kt,Xe.spotLightShadows.needsUpdate=kt,Xe.rectAreaLights.needsUpdate=kt,Xe.hemisphereLights.needsUpdate=kt}function dr(Xe){return Xe.isMeshLambertMaterial||Xe.isMeshToonMaterial||Xe.isMeshPhongMaterial||Xe.isMeshStandardMaterial||Xe.isShadowMaterial||Xe.isShaderMaterial&&Xe.lights===!0}this.getActiveCubeFace=function(){return E},this.getActiveMipmapLevel=function(){return C},this.getRenderTarget=function(){return D},this.setRenderTarget=function(Xe,kt=0,lt=0){D=Xe,E=kt,C=lt,Xe&&me.get(Xe).__webglFramebuffer===void 0&&qe.setupRenderTarget(Xe);let Ft=null,Wt=!1,qi=!1;if(Xe){const Nt=Xe.texture;(Nt.isDataTexture3D||Nt.isDataTexture2DArray)&&(qi=!0);const ai=me.get(Xe).__webglFramebuffer;Xe.isWebGLCubeRenderTarget?(Ft=ai[kt],Wt=!0):Xe.isWebGLMultisampleRenderTarget?Ft=me.get(Xe).__webglMultisampledFramebuffer:Ft=ai,q.copy(Xe.viewport),G.copy(Xe.scissor),N=Xe.scissorTest}else q.copy(re).multiplyScalar(z).floor(),G.copy(se).multiplyScalar(z).floor(),N=le;if(xt.bindFramebuffer(36160,Ft)&&ct.drawBuffers){let Nt=!1;if(Xe)if(Xe.isWebGLMultipleRenderTargets){const ai=Xe.texture;if(ce.length!==ai.length||ce[0]!==36064){for(let pi=0,Wi=ai.length;pi<Wi;pi++)ce[pi]=36064+pi;ce.length=ai.length,Nt=!0}}else(ce.length!==1||ce[0]!==36064)&&(ce[0]=36064,ce.length=1,Nt=!0);else(ce.length!==1||ce[0]!==1029)&&(ce[0]=1029,ce.length=1,Nt=!0);Nt&&(ct.isWebGL2?xe.drawBuffers(ce):Je.get("WEBGL_draw_buffers").drawBuffersWEBGL(ce))}if(xt.viewport(q),xt.scissor(G),xt.setScissorTest(N),Wt){const Nt=me.get(Xe.texture);xe.framebufferTexture2D(36160,36064,34069+kt,Nt.__webglTexture,lt)}else if(qi){const Nt=me.get(Xe.texture),ai=kt||0;xe.framebufferTextureLayer(36160,36064,Nt.__webglTexture,lt||0,ai)}O=-1},this.readRenderTargetPixels=function(Xe,kt,lt,Ft,Wt,qi,Ii){if(!(Xe&&Xe.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Nt=me.get(Xe).__webglFramebuffer;if(Xe.isWebGLCubeRenderTarget&&Ii!==void 0&&(Nt=Nt[Ii]),Nt){xt.bindFramebuffer(36160,Nt);try{const ai=Xe.texture,pi=ai.format,Wi=ai.type;if(pi!==aa&&pe.convert(pi)!==xe.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const wt=Wi===Pg&&(Je.has("EXT_color_buffer_half_float")||ct.isWebGL2&&Je.has("EXT_color_buffer_float"));if(Wi!==Bd&&pe.convert(Wi)!==xe.getParameter(35738)&&!(Wi===Sd&&(ct.isWebGL2||Je.has("OES_texture_float")||Je.has("WEBGL_color_buffer_float")))&&!wt){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}xe.checkFramebufferStatus(36160)===36053?kt>=0&&kt<=Xe.width-Ft&&lt>=0&&lt<=Xe.height-Wt&&xe.readPixels(kt,lt,Ft,Wt,pe.convert(pi),pe.convert(Wi),qi):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const ai=D!==null?me.get(D).__webglFramebuffer:null;xt.bindFramebuffer(36160,ai)}}},this.copyFramebufferToTexture=function(Xe,kt,lt=0){const Ft=Math.pow(2,-lt),Wt=Math.floor(kt.image.width*Ft),qi=Math.floor(kt.image.height*Ft);let Ii=pe.convert(kt.format);ct.isWebGL2&&(Ii===6407&&(Ii=32849),Ii===6408&&(Ii=32856)),qe.setTexture2D(kt,0),xe.copyTexImage2D(3553,lt,Ii,Xe.x,Xe.y,Wt,qi,0),xt.unbindTexture()},this.copyTextureToTexture=function(Xe,kt,lt,Ft=0){const Wt=kt.image.width,qi=kt.image.height,Ii=pe.convert(lt.format),Nt=pe.convert(lt.type);qe.setTexture2D(lt,0),xe.pixelStorei(37440,lt.flipY),xe.pixelStorei(37441,lt.premultiplyAlpha),xe.pixelStorei(3317,lt.unpackAlignment),kt.isDataTexture?xe.texSubImage2D(3553,Ft,Xe.x,Xe.y,Wt,qi,Ii,Nt,kt.image.data):kt.isCompressedTexture?xe.compressedTexSubImage2D(3553,Ft,Xe.x,Xe.y,kt.mipmaps[0].width,kt.mipmaps[0].height,Ii,kt.mipmaps[0].data):xe.texSubImage2D(3553,Ft,Xe.x,Xe.y,Ii,Nt,kt.image),Ft===0&&lt.generateMipmaps&&xe.generateMipmap(3553),xt.unbindTexture()},this.copyTextureToTexture3D=function(Xe,kt,lt,Ft,Wt=0){if(P.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const qi=Xe.max.x-Xe.min.x+1,Ii=Xe.max.y-Xe.min.y+1,Nt=Xe.max.z-Xe.min.z+1,ai=pe.convert(Ft.format),pi=pe.convert(Ft.type);let Wi;if(Ft.isDataTexture3D)qe.setTexture3D(Ft,0),Wi=32879;else if(Ft.isDataTexture2DArray)qe.setTexture2DArray(Ft,0),Wi=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}xe.pixelStorei(37440,Ft.flipY),xe.pixelStorei(37441,Ft.premultiplyAlpha),xe.pixelStorei(3317,Ft.unpackAlignment);const wt=xe.getParameter(3314),Ri=xe.getParameter(32878),bi=xe.getParameter(3316),Ni=xe.getParameter(3315),Kn=xe.getParameter(32877),Xi=lt.isCompressedTexture?lt.mipmaps[0]:lt.image;xe.pixelStorei(3314,Xi.width),xe.pixelStorei(32878,Xi.height),xe.pixelStorei(3316,Xe.min.x),xe.pixelStorei(3315,Xe.min.y),xe.pixelStorei(32877,Xe.min.z),lt.isDataTexture||lt.isDataTexture3D?xe.texSubImage3D(Wi,Wt,kt.x,kt.y,kt.z,qi,Ii,Nt,ai,pi,Xi.data):lt.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),xe.compressedTexSubImage3D(Wi,Wt,kt.x,kt.y,kt.z,qi,Ii,Nt,ai,Xi.data)):xe.texSubImage3D(Wi,Wt,kt.x,kt.y,kt.z,qi,Ii,Nt,ai,pi,Xi),xe.pixelStorei(3314,wt),xe.pixelStorei(32878,Ri),xe.pixelStorei(3316,bi),xe.pixelStorei(3315,Ni),xe.pixelStorei(32877,Kn),Wt===0&&Ft.generateMipmaps&&xe.generateMipmap(Wi),xt.unbindTexture()},this.initTexture=function(Xe){qe.setTexture2D(Xe,0),xt.unbindTexture()},this.resetState=function(){E=0,C=0,D=null,xt.reset(),Le.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}hr.prototype.isWebGLRenderer=!0;class _J extends hr{}_J.prototype.isWebGL1Renderer=!0;class vh extends Ln{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),t}}vh.prototype.isScene=!0;class g0{constructor(e,t){this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=zy,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Tc()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,o=this.stride;r<o;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Tc()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Tc()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}g0.prototype.isInterleavedBuffer=!0;const ys=new Ue;class Ny{constructor(e,t,i,r=!1){this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=r===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)ys.x=this.getX(t),ys.y=this.getY(t),ys.z=this.getZ(t),ys.applyMatrix4(e),this.setXYZ(t,ys.x,ys.y,ys.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)ys.x=this.getX(t),ys.y=this.getY(t),ys.z=this.getZ(t),ys.applyNormalMatrix(e),this.setXYZ(t,ys.x,ys.y,ys.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)ys.x=this.getX(t),ys.y=this.getY(t),ys.z=this.getZ(t),ys.transformDirection(e),this.setXYZ(t,ys.x,ys.y,ys.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,o){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=o,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)t.push(this.data.array[r+o])}return new Mn(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Ny(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)t.push(this.data.array[r+o])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}Ny.prototype.isInterleavedBufferAttribute=!0;class FC extends Bo{constructor(e){super(),this.type="SpriteMaterial",this.color=new Bi(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}FC.prototype.isSpriteMaterial=!0;let tg;const Rv=new Ue,ig=new Ue,ng=new Ue,rg=new li,Lv=new li,Mz=new Li,rx=new Ue,kv=new Ue,sx=new Ue,CL=new li,QT=new li,EL=new li;class Cz extends Ln{constructor(e){if(super(),this.type="Sprite",tg===void 0){tg=new Vn;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new g0(t,5);tg.setIndex([0,1,2,0,2,3]),tg.setAttribute("position",new Ny(i,3,0,!1)),tg.setAttribute("uv",new Ny(i,2,3,!1))}this.geometry=tg,this.material=e!==void 0?e:new FC,this.center=new li(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),ig.setFromMatrixScale(this.matrixWorld),Mz.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),ng.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&ig.multiplyScalar(-ng.z);const i=this.material.rotation;let r,o;i!==0&&(o=Math.cos(i),r=Math.sin(i));const c=this.center;ox(rx.set(-.5,-.5,0),ng,c,ig,r,o),ox(kv.set(.5,-.5,0),ng,c,ig,r,o),ox(sx.set(.5,.5,0),ng,c,ig,r,o),CL.set(0,0),QT.set(1,0),EL.set(1,1);let s=e.ray.intersectTriangle(rx,kv,sx,!1,Rv);if(s===null&&(ox(kv.set(-.5,.5,0),ng,c,ig,r,o),QT.set(0,1),s=e.ray.intersectTriangle(rx,sx,kv,!1,Rv),s===null))return;const d=e.ray.origin.distanceTo(Rv);d<e.near||d>e.far||t.push({distance:d,point:Rv.clone(),uv:Xs.getUV(Rv,rx,kv,sx,CL,QT,EL,new li),face:null,object:this})}copy(e){return super.copy(e),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}Cz.prototype.isSprite=!0;function ox(n,e,t,i,r,o){rg.subVectors(n,t).addScalar(.5).multiply(i),r!==void 0?(Lv.x=o*rg.x-r*rg.y,Lv.y=r*rg.x+o*rg.y):Lv.copy(rg),n.copy(e),n.x+=Lv.x,n.y+=Lv.y,n.applyMatrix4(Mz)}const AL=new Ue,PL=new Zn,IL=new Zn,vJ=new Ue,RL=new Li;class Ez extends kr{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Li,this.bindMatrixInverse=new Li}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Zn,t=this.geometry.attributes.skinWeight;for(let i=0,r=t.count;i<r;i++){e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.w=t.getW(i);const o=1/e.manhattanLength();o!==1/0?e.multiplyScalar(o):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const i=this.skeleton,r=this.geometry;PL.fromBufferAttribute(r.attributes.skinIndex,e),IL.fromBufferAttribute(r.attributes.skinWeight,e),AL.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let o=0;o<4;o++){const c=IL.getComponent(o);if(c!==0){const s=PL.getComponent(o);RL.multiplyMatrices(i.bones[s].matrixWorld,i.boneInverses[s]),t.addScaledVector(vJ.copy(AL).applyMatrix4(RL),c)}}return t.applyMatrix4(this.bindMatrixInverse)}}Ez.prototype.isSkinnedMesh=!0;class yJ extends Ln{constructor(){super(),this.type="Bone"}}yJ.prototype.isBone=!0;class bJ extends Bs{constructor(e=null,t=1,i=1,r,o,c,s,d,p=Zs,g=Zs,_,x){super(null,c,s,d,p,g,r,o,_,x),this.image={data:e,width:t,height:i},this.magFilter=p,this.minFilter=g,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}bJ.prototype.isDataTexture=!0;class c2 extends Mn{constructor(e,t,i,r=1){typeof i=="number"&&(r=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,i),this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}c2.prototype.isInstancedBufferAttribute=!0;const LL=new Li,kL=new Li,ax=[],Dv=new kr;class xJ extends kr{constructor(e,t,i){super(e,t),this.instanceMatrix=new c2(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){const i=this.matrixWorld,r=this.count;if(Dv.geometry=this.geometry,Dv.material=this.material,Dv.material!==void 0)for(let o=0;o<r;o++){this.getMatrixAt(o,LL),kL.multiplyMatrices(i,LL),Dv.matrixWorld=kL,Dv.raycast(e,ax);for(let c=0,s=ax.length;c<s;c++){const d=ax[c];d.instanceId=o,d.object=this,t.push(d)}ax.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new c2(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}xJ.prototype.isInstancedMesh=!0;class Ph extends Bo{constructor(e){super(),this.type="LineBasicMaterial",this.color=new Bi(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}Ph.prototype.isLineBasicMaterial=!0;const DL=new Ue,FL=new Ue,OL=new Li,eM=new Mp,lx=new d_;class Ep extends Ln{constructor(e=new Vn,t=new Ph){super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(e.index===null){const t=e.attributes.position,i=[0];for(let r=1,o=t.count;r<o;r++)DL.fromBufferAttribute(t,r-1),FL.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=DL.distanceTo(FL);e.setAttribute("lineDistance",new Ts(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,o=e.params.Line.threshold,c=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),lx.copy(i.boundingSphere),lx.applyMatrix4(r),lx.radius+=o,e.ray.intersectsSphere(lx)===!1)return;OL.copy(r).invert(),eM.copy(e.ray).applyMatrix4(OL);const s=o/((this.scale.x+this.scale.y+this.scale.z)/3),d=s*s,p=new Ue,g=new Ue,_=new Ue,x=new Ue,b=this.isLineSegments?2:1;if(i.isBufferGeometry){const S=i.index,L=i.attributes.position;if(S!==null){const E=Math.max(0,c.start),C=Math.min(S.count,c.start+c.count);for(let D=E,O=C-1;D<O;D+=b){const U=S.getX(D),q=S.getX(D+1);if(p.fromBufferAttribute(L,U),g.fromBufferAttribute(L,q),eM.distanceSqToSegment(p,g,x,_)>d)continue;x.applyMatrix4(this.matrixWorld);const N=e.ray.origin.distanceTo(x);N<e.near||N>e.far||t.push({distance:N,point:_.clone().applyMatrix4(this.matrixWorld),index:D,face:null,faceIndex:null,object:this})}}else{const E=Math.max(0,c.start),C=Math.min(L.count,c.start+c.count);for(let D=E,O=C-1;D<O;D+=b){if(p.fromBufferAttribute(L,D),g.fromBufferAttribute(L,D+1),eM.distanceSqToSegment(p,g,x,_)>d)continue;x.applyMatrix4(this.matrixWorld);const q=e.ray.origin.distanceTo(x);q<e.near||q>e.far||t.push({distance:q,point:_.clone().applyMatrix4(this.matrixWorld),index:D,face:null,faceIndex:null,object:this})}}}else i.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,c=r.length;o<c;o++){const s=r[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=o}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Ep.prototype.isLine=!0;const zL=new Ue,BL=new Ue;class g1 extends Ep{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(e.index===null){const t=e.attributes.position,i=[];for(let r=0,o=t.count;r<o;r+=2)zL.fromBufferAttribute(t,r),BL.fromBufferAttribute(t,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+zL.distanceTo(BL);e.setAttribute("lineDistance",new Ts(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}g1.prototype.isLineSegments=!0;class wJ extends Ep{constructor(e,t){super(e,t),this.type="LineLoop"}}wJ.prototype.isLineLoop=!0;class Az extends Bo{constructor(e){super(),this.type="PointsMaterial",this.color=new Bi(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}Az.prototype.isPointsMaterial=!0;const NL=new Li,u2=new Mp,cx=new d_,ux=new Ue;class Pz extends Ln{constructor(e=new Vn,t=new Az){super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,o=e.params.Points.threshold,c=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),cx.copy(i.boundingSphere),cx.applyMatrix4(r),cx.radius+=o,e.ray.intersectsSphere(cx)===!1)return;NL.copy(r).invert(),u2.copy(e.ray).applyMatrix4(NL);const s=o/((this.scale.x+this.scale.y+this.scale.z)/3),d=s*s;if(i.isBufferGeometry){const p=i.index,_=i.attributes.position;if(p!==null){const x=Math.max(0,c.start),b=Math.min(p.count,c.start+c.count);for(let S=x,P=b;S<P;S++){const L=p.getX(S);ux.fromBufferAttribute(_,L),$L(ux,L,d,r,e,t,this)}}else{const x=Math.max(0,c.start),b=Math.min(_.count,c.start+c.count);for(let S=x,P=b;S<P;S++)ux.fromBufferAttribute(_,S),$L(ux,S,d,r,e,t,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,c=r.length;o<c;o++){const s=r[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=o}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Pz.prototype.isPoints=!0;function $L(n,e,t,i,r,o,c){const s=u2.distanceSqToPoint(n);if(s<t){const d=new Ue;u2.closestPointToPoint(n,d),d.applyMatrix4(i);const p=r.ray.origin.distanceTo(d);if(p<r.near||p>r.far)return;o.push({distance:p,distanceToRay:Math.sqrt(s),point:d,index:e,face:null,object:c})}}class SJ extends Bs{constructor(e,t,i,r,o,c,s,d,p){super(e,t,i,r,o,c,s,d,p),this.format=s!==void 0?s:lp,this.minFilter=c!==void 0?c:Lo,this.magFilter=o!==void 0?o:Lo,this.generateMipmaps=!1;const g=this;function _(){g.needsUpdate=!0,e.requestVideoFrameCallback(_)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(_)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}SJ.prototype.isVideoTexture=!0;class TJ extends Bs{constructor(e,t,i,r,o,c,s,d,p,g,_,x){super(null,c,s,d,p,g,r,o,_,x),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}TJ.prototype.isCompressedTexture=!0;class MJ extends Bs{constructor(e,t,i,r,o,c,s,d,p){super(e,t,i,r,o,c,s,d,p),this.needsUpdate=!0}}MJ.prototype.isCanvasTexture=!0;class CJ extends Bs{constructor(e,t,i,r,o,c,s,d,p,g){if(g=g!==void 0?g:Ig,g!==Ig&&g!==Oy)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&g===Ig&&(i=ww),i===void 0&&g===Oy&&(i=py),super(null,r,o,c,s,d,g,i,p),this.image={width:e,height:t},this.magFilter=s!==void 0?s:Zs,this.minFilter=d!==void 0?d:Zs,this.flipY=!1,this.generateMipmaps=!1}}CJ.prototype.isDepthTexture=!0;class jl{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,r=this.getPoint(0),o=0;t.push(0);for(let c=1;c<=e;c++)i=this.getPoint(c/e),o+=i.distanceTo(r),t.push(o),r=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let r=0;const o=i.length;let c;t?c=t:c=e*i[o-1];let s=0,d=o-1,p;for(;s<=d;)if(r=Math.floor(s+(d-s)/2),p=i[r]-c,p<0)s=r+1;else if(p>0)d=r-1;else{d=r;break}if(r=d,i[r]===c)return r/(o-1);const g=i[r],x=i[r+1]-g,b=(c-g)/x;return(r+b)/(o-1)}getTangent(e,t){let r=e-1e-4,o=e+1e-4;r<0&&(r=0),o>1&&(o=1);const c=this.getPoint(r),s=this.getPoint(o),d=t||(c.isVector2?new li:new Ue);return d.copy(s).sub(c).normalize(),d}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new Ue,r=[],o=[],c=[],s=new Ue,d=new Li;for(let b=0;b<=e;b++){const S=b/e;r[b]=this.getTangentAt(S,new Ue)}o[0]=new Ue,c[0]=new Ue;let p=Number.MAX_VALUE;const g=Math.abs(r[0].x),_=Math.abs(r[0].y),x=Math.abs(r[0].z);g<=p&&(p=g,i.set(1,0,0)),_<=p&&(p=_,i.set(0,1,0)),x<=p&&i.set(0,0,1),s.crossVectors(r[0],i).normalize(),o[0].crossVectors(r[0],s),c[0].crossVectors(r[0],o[0]);for(let b=1;b<=e;b++){if(o[b]=o[b-1].clone(),c[b]=c[b-1].clone(),s.crossVectors(r[b-1],r[b]),s.length()>Number.EPSILON){s.normalize();const S=Math.acos(_a(r[b-1].dot(r[b]),-1,1));o[b].applyMatrix4(d.makeRotationAxis(s,S))}c[b].crossVectors(r[b],o[b])}if(t===!0){let b=Math.acos(_a(o[0].dot(o[e]),-1,1));b/=e,r[0].dot(s.crossVectors(o[0],o[e]))>0&&(b=-b);for(let S=1;S<=e;S++)o[S].applyMatrix4(d.makeRotationAxis(r[S],b*S)),c[S].crossVectors(r[S],o[S])}return{tangents:r,normals:o,binormals:c}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class _1 extends jl{constructor(e=0,t=0,i=1,r=1,o=0,c=Math.PI*2,s=!1,d=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=o,this.aEndAngle=c,this.aClockwise=s,this.aRotation=d}getPoint(e,t){const i=t||new li,r=Math.PI*2;let o=this.aEndAngle-this.aStartAngle;const c=Math.abs(o)<Number.EPSILON;for(;o<0;)o+=r;for(;o>r;)o-=r;o<Number.EPSILON&&(c?o=0:o=r),this.aClockwise===!0&&!c&&(o===r?o=-r:o=o-r);const s=this.aStartAngle+e*o;let d=this.aX+this.xRadius*Math.cos(s),p=this.aY+this.yRadius*Math.sin(s);if(this.aRotation!==0){const g=Math.cos(this.aRotation),_=Math.sin(this.aRotation),x=d-this.aX,b=p-this.aY;d=x*g-b*_+this.aX,p=x*_+b*g+this.aY}return i.set(d,p)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}_1.prototype.isEllipseCurve=!0;class Iz extends _1{constructor(e,t,i,r,o,c){super(e,t,i,i,r,o,c),this.type="ArcCurve"}}Iz.prototype.isArcCurve=!0;function OC(){let n=0,e=0,t=0,i=0;function r(o,c,s,d){n=o,e=s,t=-3*o+3*c-2*s-d,i=2*o-2*c+s+d}return{initCatmullRom:function(o,c,s,d,p){r(c,s,p*(s-o),p*(d-c))},initNonuniformCatmullRom:function(o,c,s,d,p,g,_){let x=(c-o)/p-(s-o)/(p+g)+(s-c)/g,b=(s-c)/g-(d-c)/(g+_)+(d-s)/_;x*=g,b*=g,r(c,s,x,b)},calc:function(o){const c=o*o,s=c*o;return n+e*o+t*c+i*s}}}const hx=new Ue,tM=new OC,iM=new OC,nM=new OC;class _y extends jl{constructor(e=[],t=!1,i="centripetal",r=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=r}getPoint(e,t=new Ue){const i=t,r=this.points,o=r.length,c=(o-(this.closed?0:1))*e;let s=Math.floor(c),d=c-s;this.closed?s+=s>0?0:(Math.floor(Math.abs(s)/o)+1)*o:d===0&&s===o-1&&(s=o-2,d=1);let p,g;this.closed||s>0?p=r[(s-1)%o]:(hx.subVectors(r[0],r[1]).add(r[0]),p=hx);const _=r[s%o],x=r[(s+1)%o];if(this.closed||s+2<o?g=r[(s+2)%o]:(hx.subVectors(r[o-1],r[o-2]).add(r[o-1]),g=hx),this.curveType==="centripetal"||this.curveType==="chordal"){const b=this.curveType==="chordal"?.5:.25;let S=Math.pow(p.distanceToSquared(_),b),P=Math.pow(_.distanceToSquared(x),b),L=Math.pow(x.distanceToSquared(g),b);P<1e-4&&(P=1),S<1e-4&&(S=P),L<1e-4&&(L=P),tM.initNonuniformCatmullRom(p.x,_.x,x.x,g.x,S,P,L),iM.initNonuniformCatmullRom(p.y,_.y,x.y,g.y,S,P,L),nM.initNonuniformCatmullRom(p.z,_.z,x.z,g.z,S,P,L)}else this.curveType==="catmullrom"&&(tM.initCatmullRom(p.x,_.x,x.x,g.x,this.tension),iM.initCatmullRom(p.y,_.y,x.y,g.y,this.tension),nM.initCatmullRom(p.z,_.z,x.z,g.z,this.tension));return i.set(tM.calc(d),iM.calc(d),nM.calc(d)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(new Ue().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}_y.prototype.isCatmullRomCurve3=!0;function VL(n,e,t,i,r){const o=(i-e)*.5,c=(r-t)*.5,s=n*n,d=n*s;return(2*t-2*i+o+c)*d+(-3*t+3*i-2*o-c)*s+o*n+t}function EJ(n,e){const t=1-n;return t*t*e}function AJ(n,e){return 2*(1-n)*n*e}function PJ(n,e){return n*n*e}function vy(n,e,t,i){return EJ(n,e)+AJ(n,t)+PJ(n,i)}function IJ(n,e){const t=1-n;return t*t*t*e}function RJ(n,e){const t=1-n;return 3*t*t*n*e}function LJ(n,e){return 3*(1-n)*n*n*e}function kJ(n,e){return n*n*n*e}function yy(n,e,t,i,r){return IJ(n,e)+RJ(n,t)+LJ(n,i)+kJ(n,r)}class zC extends jl{constructor(e=new li,t=new li,i=new li,r=new li){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new li){const i=t,r=this.v0,o=this.v1,c=this.v2,s=this.v3;return i.set(yy(e,r.x,o.x,c.x,s.x),yy(e,r.y,o.y,c.y,s.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}zC.prototype.isCubicBezierCurve=!0;class Rz extends jl{constructor(e=new Ue,t=new Ue,i=new Ue,r=new Ue){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new Ue){const i=t,r=this.v0,o=this.v1,c=this.v2,s=this.v3;return i.set(yy(e,r.x,o.x,c.x,s.x),yy(e,r.y,o.y,c.y,s.y),yy(e,r.z,o.z,c.z,s.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}Rz.prototype.isCubicBezierCurve3=!0;class v1 extends jl{constructor(e=new li,t=new li){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new li){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const i=t||new li;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}v1.prototype.isLineCurve=!0;class DJ extends jl{constructor(e=new Ue,t=new Ue){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new Ue){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class BC extends jl{constructor(e=new li,t=new li,i=new li){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new li){const i=t,r=this.v0,o=this.v1,c=this.v2;return i.set(vy(e,r.x,o.x,c.x),vy(e,r.y,o.y,c.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}BC.prototype.isQuadraticBezierCurve=!0;class Lz extends jl{constructor(e=new Ue,t=new Ue,i=new Ue){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new Ue){const i=t,r=this.v0,o=this.v1,c=this.v2;return i.set(vy(e,r.x,o.x,c.x),vy(e,r.y,o.y,c.y),vy(e,r.z,o.z,c.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Lz.prototype.isQuadraticBezierCurve3=!0;class NC extends jl{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new li){const i=t,r=this.points,o=(r.length-1)*e,c=Math.floor(o),s=o-c,d=r[c===0?c:c-1],p=r[c],g=r[c>r.length-2?r.length-1:c+1],_=r[c>r.length-3?r.length-1:c+2];return i.set(VL(s,d.x,p.x,g.x,_.x),VL(s,d.y,p.y,g.y,_.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(new li().fromArray(r))}return this}}NC.prototype.isSplineCurve=!0;var kz=Object.freeze({__proto__:null,ArcCurve:Iz,CatmullRomCurve3:_y,CubicBezierCurve:zC,CubicBezierCurve3:Rz,EllipseCurve:_1,LineCurve:v1,LineCurve3:DJ,QuadraticBezierCurve:BC,QuadraticBezierCurve3:Lz,SplineCurve:NC});class FJ extends jl{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new v1(t,e))}getPoint(e,t){const i=e*this.getLength(),r=this.getCurveLengths();let o=0;for(;o<r.length;){if(r[o]>=i){const c=r[o]-i,s=this.curves[o],d=s.getLength(),p=d===0?0:1-c/d;return s.getPointAt(p,t)}o++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let r=0,o=this.curves;r<o.length;r++){const c=o[r],s=c&&c.isEllipseCurve?e*2:c&&(c.isLineCurve||c.isLineCurve3)?1:c&&c.isSplineCurve?e*c.points.length:e,d=c.getPoints(s);for(let p=0;p<d.length;p++){const g=d[p];i&&i.equals(g)||(t.push(g),i=g)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const r=e.curves[t];this.curves.push(new kz[r.type]().fromJSON(r))}return this}}class h2 extends FJ{constructor(e){super(),this.type="Path",this.currentPoint=new li,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new v1(this.currentPoint.clone(),new li(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,r){const o=new BC(this.currentPoint.clone(),new li(e,t),new li(i,r));return this.curves.push(o),this.currentPoint.set(i,r),this}bezierCurveTo(e,t,i,r,o,c){const s=new zC(this.currentPoint.clone(),new li(e,t),new li(i,r),new li(o,c));return this.curves.push(s),this.currentPoint.set(o,c),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new NC(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,r,o,c){const s=this.currentPoint.x,d=this.currentPoint.y;return this.absarc(e+s,t+d,i,r,o,c),this}absarc(e,t,i,r,o,c){return this.absellipse(e,t,i,i,r,o,c),this}ellipse(e,t,i,r,o,c,s,d){const p=this.currentPoint.x,g=this.currentPoint.y;return this.absellipse(e+p,t+g,i,r,o,c,s,d),this}absellipse(e,t,i,r,o,c,s,d){const p=new _1(e,t,i,r,o,c,s,d);if(this.curves.length>0){const _=p.getPoint(0);_.equals(this.currentPoint)||this.lineTo(_.x,_.y)}this.curves.push(p);const g=p.getPoint(1);return this.currentPoint.copy(g),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class _0 extends h2{constructor(e){super(e),this.uuid=Tc(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const r=e.holes[t];this.holes.push(new h2().fromJSON(r))}return this}}const OJ={triangulate:function(n,e,t=2){const i=e&&e.length,r=i?e[0]*t:n.length;let o=Dz(n,0,r,t,!0);const c=[];if(!o||o.next===o.prev)return c;let s,d,p,g,_,x,b;if(i&&(o=VJ(n,e,o,t)),n.length>80*t){s=p=n[0],d=g=n[1];for(let S=t;S<r;S+=t)_=n[S],x=n[S+1],_<s&&(s=_),x<d&&(d=x),_>p&&(p=_),x>g&&(g=x);b=Math.max(p-s,g-d),b=b!==0?1/b:0}return $y(o,c,t,s,d,b),c}};function Dz(n,e,t,i,r){let o,c;if(r===JJ(n,e,t,i)>0)for(o=e;o<t;o+=i)c=UL(o,n[o],n[o+1],c);else for(o=t-i;o>=e;o-=i)c=UL(o,n[o],n[o+1],c);return c&&y1(c,c.next)&&(Uy(c),c=c.next),c}function $d(n,e){if(!n)return n;e||(e=n);let t=n,i;do if(i=!1,!t.steiner&&(y1(t,t.next)||cs(t.prev,t,t.next)===0)){if(Uy(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function $y(n,e,t,i,r,o,c){if(!n)return;!c&&o&&WJ(n,i,r,o);let s=n,d,p;for(;n.prev!==n.next;){if(d=n.prev,p=n.next,o?BJ(n,i,r,o):zJ(n)){e.push(d.i/t),e.push(n.i/t),e.push(p.i/t),Uy(n),n=p.next,s=p.next;continue}if(n=p,n===s){c?c===1?(n=NJ($d(n),e,t),$y(n,e,t,i,r,o,2)):c===2&&$J(n,e,t,i,r,o):$y($d(n),e,t,i,r,o,1);break}}}function zJ(n){const e=n.prev,t=n,i=n.next;if(cs(e,t,i)>=0)return!1;let r=n.next.next;for(;r!==n.prev;){if(yg(e.x,e.y,t.x,t.y,i.x,i.y,r.x,r.y)&&cs(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function BJ(n,e,t,i){const r=n.prev,o=n,c=n.next;if(cs(r,o,c)>=0)return!1;const s=r.x<o.x?r.x<c.x?r.x:c.x:o.x<c.x?o.x:c.x,d=r.y<o.y?r.y<c.y?r.y:c.y:o.y<c.y?o.y:c.y,p=r.x>o.x?r.x>c.x?r.x:c.x:o.x>c.x?o.x:c.x,g=r.y>o.y?r.y>c.y?r.y:c.y:o.y>c.y?o.y:c.y,_=d2(s,d,e,t,i),x=d2(p,g,e,t,i);let b=n.prevZ,S=n.nextZ;for(;b&&b.z>=_&&S&&S.z<=x;){if(b!==n.prev&&b!==n.next&&yg(r.x,r.y,o.x,o.y,c.x,c.y,b.x,b.y)&&cs(b.prev,b,b.next)>=0||(b=b.prevZ,S!==n.prev&&S!==n.next&&yg(r.x,r.y,o.x,o.y,c.x,c.y,S.x,S.y)&&cs(S.prev,S,S.next)>=0))return!1;S=S.nextZ}for(;b&&b.z>=_;){if(b!==n.prev&&b!==n.next&&yg(r.x,r.y,o.x,o.y,c.x,c.y,b.x,b.y)&&cs(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;S&&S.z<=x;){if(S!==n.prev&&S!==n.next&&yg(r.x,r.y,o.x,o.y,c.x,c.y,S.x,S.y)&&cs(S.prev,S,S.next)>=0)return!1;S=S.nextZ}return!0}function NJ(n,e,t){let i=n;do{const r=i.prev,o=i.next.next;!y1(r,o)&&Fz(r,i,i.next,o)&&Vy(r,o)&&Vy(o,r)&&(e.push(r.i/t),e.push(i.i/t),e.push(o.i/t),Uy(i),Uy(i.next),i=n=o),i=i.next}while(i!==n);return $d(i)}function $J(n,e,t,i,r,o){let c=n;do{let s=c.next.next;for(;s!==c.prev;){if(c.i!==s.i&&XJ(c,s)){let d=Oz(c,s);c=$d(c,c.next),d=$d(d,d.next),$y(c,e,t,i,r,o),$y(d,e,t,i,r,o);return}s=s.next}c=c.next}while(c!==n)}function VJ(n,e,t,i){const r=[];let o,c,s,d,p;for(o=0,c=e.length;o<c;o++)s=e[o]*i,d=o<c-1?e[o+1]*i:n.length,p=Dz(n,s,d,i,!1),p===p.next&&(p.steiner=!0),r.push(ZJ(p));for(r.sort(UJ),o=0;o<r.length;o++)jJ(r[o],t),t=$d(t,t.next);return t}function UJ(n,e){return n.x-e.x}function jJ(n,e){if(e=GJ(n,e),e){const t=Oz(e,n);$d(e,e.next),$d(t,t.next)}}function GJ(n,e){let t=e;const i=n.x,r=n.y;let o=-1/0,c;do{if(r<=t.y&&r>=t.next.y&&t.next.y!==t.y){const x=t.x+(r-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(x<=i&&x>o){if(o=x,x===i){if(r===t.y)return t;if(r===t.next.y)return t.next}c=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!c)return null;if(i===o)return c;const s=c,d=c.x,p=c.y;let g=1/0,_;t=c;do i>=t.x&&t.x>=d&&i!==t.x&&yg(r<p?i:o,r,d,p,r<p?o:i,r,t.x,t.y)&&(_=Math.abs(r-t.y)/(i-t.x),Vy(t,n)&&(_<g||_===g&&(t.x>c.x||t.x===c.x&&qJ(c,t)))&&(c=t,g=_)),t=t.next;while(t!==s);return c}function qJ(n,e){return cs(n.prev,n,e.prev)<0&&cs(e.next,n,n.next)<0}function WJ(n,e,t,i){let r=n;do r.z===null&&(r.z=d2(r.x,r.y,e,t,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==n);r.prevZ.nextZ=null,r.prevZ=null,HJ(r)}function HJ(n){let e,t,i,r,o,c,s,d,p=1;do{for(t=n,n=null,o=null,c=0;t;){for(c++,i=t,s=0,e=0;e<p&&(s++,i=i.nextZ,!!i);e++);for(d=p;s>0||d>0&&i;)s!==0&&(d===0||!i||t.z<=i.z)?(r=t,t=t.nextZ,s--):(r=i,i=i.nextZ,d--),o?o.nextZ=r:n=r,r.prevZ=o,o=r;t=i}o.nextZ=null,p*=2}while(c>1);return n}function d2(n,e,t,i,r){return n=32767*(n-t)*r,e=32767*(e-i)*r,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function ZJ(n){let e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function yg(n,e,t,i,r,o,c,s){return(r-c)*(e-s)-(n-c)*(o-s)>=0&&(n-c)*(i-s)-(t-c)*(e-s)>=0&&(t-c)*(o-s)-(r-c)*(i-s)>=0}function XJ(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!YJ(n,e)&&(Vy(n,e)&&Vy(e,n)&&KJ(n,e)&&(cs(n.prev,n,e.prev)||cs(n,e.prev,e))||y1(n,e)&&cs(n.prev,n,n.next)>0&&cs(e.prev,e,e.next)>0)}function cs(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function y1(n,e){return n.x===e.x&&n.y===e.y}function Fz(n,e,t,i){const r=fx(cs(n,e,t)),o=fx(cs(n,e,i)),c=fx(cs(t,i,n)),s=fx(cs(t,i,e));return!!(r!==o&&c!==s||r===0&&dx(n,t,e)||o===0&&dx(n,i,e)||c===0&&dx(t,n,i)||s===0&&dx(t,e,i))}function dx(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function fx(n){return n>0?1:n<0?-1:0}function YJ(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&Fz(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function Vy(n,e){return cs(n.prev,n,n.next)<0?cs(n,e,n.next)>=0&&cs(n,n.prev,e)>=0:cs(n,e,n.prev)<0||cs(n,n.next,e)<0}function KJ(n,e){let t=n,i=!1;const r=(n.x+e.x)/2,o=(n.y+e.y)/2;do t.y>o!=t.next.y>o&&t.next.y!==t.y&&r<(t.next.x-t.x)*(o-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==n);return i}function Oz(n,e){const t=new f2(n.i,n.x,n.y),i=new f2(e.i,e.x,e.y),r=n.next,o=e.prev;return n.next=e,e.prev=n,t.next=r,r.prev=t,i.next=t,t.prev=i,o.next=i,i.prev=o,i}function UL(n,e,t,i){const r=new f2(n,e,t);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Uy(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function f2(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function JJ(n,e,t,i){let r=0;for(let o=e,c=t-i;o<t;o+=i)r+=(n[c]-n[o])*(n[o+1]+n[c+1]),c=o;return r}class Ld{static area(e){const t=e.length;let i=0;for(let r=t-1,o=0;o<t;r=o++)i+=e[r].x*e[o].y-e[o].x*e[r].y;return i*.5}static isClockWise(e){return Ld.area(e)<0}static triangulateShape(e,t){const i=[],r=[],o=[];jL(e),GL(i,e);let c=e.length;t.forEach(jL);for(let d=0;d<t.length;d++)r.push(c),c+=t[d].length,GL(i,t[d]);const s=OJ.triangulate(i,r);for(let d=0;d<s.length;d+=3)o.push(s.slice(d,d+3));return o}}function jL(n){const e=n.length;e>2&&n[e-1].equals(n[0])&&n.pop()}function GL(n,e){for(let t=0;t<e.length;t++)n.push(e[t].x),n.push(e[t].y)}class p_ extends Vn{constructor(e=new _0([new li(.5,.5),new li(-.5,.5),new li(-.5,-.5),new li(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,r=[],o=[];for(let s=0,d=e.length;s<d;s++){const p=e[s];c(p)}this.setAttribute("position",new Ts(r,3)),this.setAttribute("uv",new Ts(o,2)),this.computeVertexNormals();function c(s){const d=[],p=t.curveSegments!==void 0?t.curveSegments:12,g=t.steps!==void 0?t.steps:1;let _=t.depth!==void 0?t.depth:1,x=t.bevelEnabled!==void 0?t.bevelEnabled:!0,b=t.bevelThickness!==void 0?t.bevelThickness:.2,S=t.bevelSize!==void 0?t.bevelSize:b-.1,P=t.bevelOffset!==void 0?t.bevelOffset:0,L=t.bevelSegments!==void 0?t.bevelSegments:3;const E=t.extrudePath,C=t.UVGenerator!==void 0?t.UVGenerator:QJ;t.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),_=t.amount);let D,O=!1,U,q,G,N;E&&(D=E.getSpacedPoints(g),O=!0,x=!1,U=E.computeFrenetFrames(g,!1),q=new Ue,G=new Ue,N=new Ue),x||(L=0,b=0,S=0,P=0);const V=s.extractPoints(p);let j=V.shape;const z=V.holes;if(!Ld.isClockWise(j)){j=j.reverse();for(let me=0,qe=z.length;me<qe;me++){const st=z[me];Ld.isClockWise(st)&&(z[me]=st.reverse())}}const X=Ld.triangulateShape(j,z),re=j;for(let me=0,qe=z.length;me<qe;me++){const st=z[me];j=j.concat(st)}function se(me,qe,st){return qe||console.error("THREE.ExtrudeGeometry: vec does not exist"),qe.clone().multiplyScalar(st).add(me)}const le=j.length,ce=X.length;function be(me,qe,st){let Rt,gt,Ae;const we=me.x-qe.x,vt=me.y-qe.y,ye=st.x-me.x,ie=st.y-me.y,ae=we*we+vt*vt,ke=we*ie-vt*ye;if(Math.abs(ke)>Number.EPSILON){const Ze=Math.sqrt(ae),yt=Math.sqrt(ye*ye+ie*ie),Me=qe.x-vt/Ze,ee=qe.y+we/Ze,de=st.x-ie/yt,pe=st.y+ye/yt,Le=((de-Me)*ie-(pe-ee)*ye)/(we*ie-vt*ye);Rt=Me+we*Le-me.x,gt=ee+vt*Le-me.y;const Oe=Rt*Rt+gt*gt;if(Oe<=2)return new li(Rt,gt);Ae=Math.sqrt(Oe/2)}else{let Ze=!1;we>Number.EPSILON?ye>Number.EPSILON&&(Ze=!0):we<-Number.EPSILON?ye<-Number.EPSILON&&(Ze=!0):Math.sign(vt)===Math.sign(ie)&&(Ze=!0),Ze?(Rt=-vt,gt=we,Ae=Math.sqrt(ae)):(Rt=we,gt=vt,Ae=Math.sqrt(ae/2))}return new li(Rt/Ae,gt/Ae)}const Ee=[];for(let me=0,qe=re.length,st=qe-1,Rt=me+1;me<qe;me++,st++,Rt++)st===qe&&(st=0),Rt===qe&&(Rt=0),Ee[me]=be(re[me],re[st],re[Rt]);const $e=[];let Ve,nt=Ee.concat();for(let me=0,qe=z.length;me<qe;me++){const st=z[me];Ve=[];for(let Rt=0,gt=st.length,Ae=gt-1,we=Rt+1;Rt<gt;Rt++,Ae++,we++)Ae===gt&&(Ae=0),we===gt&&(we=0),Ve[Rt]=be(st[Rt],st[Ae],st[we]);$e.push(Ve),nt=nt.concat(Ve)}for(let me=0;me<L;me++){const qe=me/L,st=b*Math.cos(qe*Math.PI/2),Rt=S*Math.sin(qe*Math.PI/2)+P;for(let gt=0,Ae=re.length;gt<Ae;gt++){const we=se(re[gt],Ee[gt],Rt);Be(we.x,we.y,-st)}for(let gt=0,Ae=z.length;gt<Ae;gt++){const we=z[gt];Ve=$e[gt];for(let vt=0,ye=we.length;vt<ye;vt++){const ie=se(we[vt],Ve[vt],Rt);Be(ie.x,ie.y,-st)}}}const He=S+P;for(let me=0;me<le;me++){const qe=x?se(j[me],nt[me],He):j[me];O?(G.copy(U.normals[0]).multiplyScalar(qe.x),q.copy(U.binormals[0]).multiplyScalar(qe.y),N.copy(D[0]).add(G).add(q),Be(N.x,N.y,N.z)):Be(qe.x,qe.y,0)}for(let me=1;me<=g;me++)for(let qe=0;qe<le;qe++){const st=x?se(j[qe],nt[qe],He):j[qe];O?(G.copy(U.normals[me]).multiplyScalar(st.x),q.copy(U.binormals[me]).multiplyScalar(st.y),N.copy(D[me]).add(G).add(q),Be(N.x,N.y,N.z)):Be(st.x,st.y,_/g*me)}for(let me=L-1;me>=0;me--){const qe=me/L,st=b*Math.cos(qe*Math.PI/2),Rt=S*Math.sin(qe*Math.PI/2)+P;for(let gt=0,Ae=re.length;gt<Ae;gt++){const we=se(re[gt],Ee[gt],Rt);Be(we.x,we.y,_+st)}for(let gt=0,Ae=z.length;gt<Ae;gt++){const we=z[gt];Ve=$e[gt];for(let vt=0,ye=we.length;vt<ye;vt++){const ie=se(we[vt],Ve[vt],Rt);O?Be(ie.x,ie.y+D[g-1].y,D[g-1].x+st):Be(ie.x,ie.y,_+st)}}}De(),ot();function De(){const me=r.length/3;if(x){let qe=0,st=le*qe;for(let Rt=0;Rt<ce;Rt++){const gt=X[Rt];Je(gt[2]+st,gt[1]+st,gt[0]+st)}qe=g+L*2,st=le*qe;for(let Rt=0;Rt<ce;Rt++){const gt=X[Rt];Je(gt[0]+st,gt[1]+st,gt[2]+st)}}else{for(let qe=0;qe<ce;qe++){const st=X[qe];Je(st[2],st[1],st[0])}for(let qe=0;qe<ce;qe++){const st=X[qe];Je(st[0]+le*g,st[1]+le*g,st[2]+le*g)}}i.addGroup(me,r.length/3-me,0)}function ot(){const me=r.length/3;let qe=0;xe(re,qe),qe+=re.length;for(let st=0,Rt=z.length;st<Rt;st++){const gt=z[st];xe(gt,qe),qe+=gt.length}i.addGroup(me,r.length/3-me,1)}function xe(me,qe){let st=me.length;for(;--st>=0;){const Rt=st;let gt=st-1;gt<0&&(gt=me.length-1);for(let Ae=0,we=g+L*2;Ae<we;Ae++){const vt=le*Ae,ye=le*(Ae+1),ie=qe+Rt+vt,ae=qe+gt+vt,ke=qe+gt+ye,Ze=qe+Rt+ye;ct(ie,ae,ke,Ze)}}}function Be(me,qe,st){d.push(me),d.push(qe),d.push(st)}function Je(me,qe,st){xt(me),xt(qe),xt(st);const Rt=r.length/3,gt=C.generateTopUV(i,r,Rt-3,Rt-2,Rt-1);Se(gt[0]),Se(gt[1]),Se(gt[2])}function ct(me,qe,st,Rt){xt(me),xt(qe),xt(Rt),xt(qe),xt(st),xt(Rt);const gt=r.length/3,Ae=C.generateSideWallUV(i,r,gt-6,gt-3,gt-2,gt-1);Se(Ae[0]),Se(Ae[1]),Se(Ae[3]),Se(Ae[1]),Se(Ae[2]),Se(Ae[3])}function xt(me){r.push(d[me*3+0]),r.push(d[me*3+1]),r.push(d[me*3+2])}function Se(me){o.push(me.x),o.push(me.y)}}}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,i=this.parameters.options;return eQ(t,i,e)}static fromJSON(e,t){const i=[];for(let o=0,c=e.shapes.length;o<c;o++){const s=t[e.shapes[o]];i.push(s)}const r=e.options.extrudePath;return r!==void 0&&(e.options.extrudePath=new kz[r.type]().fromJSON(r)),new p_(i,e.options)}}const QJ={generateTopUV:function(n,e,t,i,r){const o=e[t*3],c=e[t*3+1],s=e[i*3],d=e[i*3+1],p=e[r*3],g=e[r*3+1];return[new li(o,c),new li(s,d),new li(p,g)]},generateSideWallUV:function(n,e,t,i,r,o){const c=e[t*3],s=e[t*3+1],d=e[t*3+2],p=e[i*3],g=e[i*3+1],_=e[i*3+2],x=e[r*3],b=e[r*3+1],S=e[r*3+2],P=e[o*3],L=e[o*3+1],E=e[o*3+2];return Math.abs(s-g)<Math.abs(c-p)?[new li(c,1-d),new li(p,1-_),new li(x,1-S),new li(P,1-E)]:[new li(s,1-d),new li(g,1-_),new li(b,1-S),new li(L,1-E)]}};function eQ(n,e,t){if(t.shapes=[],Array.isArray(n))for(let i=0,r=n.length;i<r;i++){const o=n[i];t.shapes.push(o.uuid)}else t.shapes.push(n.uuid);return e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class $C extends Vn{constructor(e=new _0([new li(0,.5),new li(-.5,-.5),new li(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],r=[],o=[],c=[];let s=0,d=0;if(Array.isArray(e)===!1)p(e);else for(let g=0;g<e.length;g++)p(e[g]),this.addGroup(s,d,g),s+=d,d=0;this.setIndex(i),this.setAttribute("position",new Ts(r,3)),this.setAttribute("normal",new Ts(o,3)),this.setAttribute("uv",new Ts(c,2));function p(g){const _=r.length/3,x=g.extractPoints(t);let b=x.shape;const S=x.holes;Ld.isClockWise(b)===!1&&(b=b.reverse());for(let L=0,E=S.length;L<E;L++){const C=S[L];Ld.isClockWise(C)===!0&&(S[L]=C.reverse())}const P=Ld.triangulateShape(b,S);for(let L=0,E=S.length;L<E;L++){const C=S[L];b=b.concat(C)}for(let L=0,E=b.length;L<E;L++){const C=b[L];r.push(C.x,C.y,0),o.push(0,0,1),c.push(C.x,C.y)}for(let L=0,E=P.length;L<E;L++){const C=P[L],D=C[0]+_,O=C[1]+_,U=C[2]+_;i.push(D,O,U),d+=3}}}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return tQ(t,e)}static fromJSON(e,t){const i=[];for(let r=0,o=e.shapes.length;r<o;r++){const c=t[e.shapes[r]];i.push(c)}return new $C(i,e.curveSegments)}}function tQ(n,e){if(e.shapes=[],Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const r=n[t];e.shapes.push(r.uuid)}else e.shapes.push(n.uuid);return e}class VC extends Vn{constructor(e=1,t=32,i=16,r=0,o=Math.PI*2,c=0,s=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:o,thetaStart:c,thetaLength:s},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const d=Math.min(c+s,Math.PI);let p=0;const g=[],_=new Ue,x=new Ue,b=[],S=[],P=[],L=[];for(let E=0;E<=i;E++){const C=[],D=E/i;let O=0;E==0&&c==0?O=.5/t:E==i&&d==Math.PI&&(O=-.5/t);for(let U=0;U<=t;U++){const q=U/t;_.x=-e*Math.cos(r+q*o)*Math.sin(c+D*s),_.y=e*Math.cos(c+D*s),_.z=e*Math.sin(r+q*o)*Math.sin(c+D*s),S.push(_.x,_.y,_.z),x.copy(_).normalize(),P.push(x.x,x.y,x.z),L.push(q+O,1-D),C.push(p++)}g.push(C)}for(let E=0;E<i;E++)for(let C=0;C<t;C++){const D=g[E][C+1],O=g[E][C],U=g[E+1][C],q=g[E+1][C+1];(E!==0||c>0)&&b.push(D,O,q),(E!==i-1||d<Math.PI)&&b.push(O,U,q)}this.setIndex(b),this.setAttribute("position",new Ts(S,3)),this.setAttribute("normal",new Ts(P,3)),this.setAttribute("uv",new Ts(L,2))}static fromJSON(e){return new VC(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class iQ extends Bo{constructor(e){super(),this.type="ShadowMaterial",this.color=new Bi(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}iQ.prototype.isShadowMaterial=!0;class zz extends Bo{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Bi(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Bi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=u_,this.normalScale=new li(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}zz.prototype.isMeshStandardMaterial=!0;class nQ extends zz{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new li(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return _a(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenColor=new Bi(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Bi(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Bi(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}nQ.prototype.isMeshPhysicalMaterial=!0;class rQ extends Bo{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new Bi(16777215),this.specular=new Bi(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Bi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=u_,this.normalScale=new li(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=a1,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}rQ.prototype.isMeshPhongMaterial=!0;class sQ extends Bo{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Bi(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Bi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=u_,this.normalScale=new li(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}sQ.prototype.isMeshToonMaterial=!0;class oQ extends Bo{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=u_,this.normalScale=new li(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}oQ.prototype.isMeshNormalMaterial=!0;class aQ extends Bo{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new Bi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Bi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=a1,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}aQ.prototype.isMeshLambertMaterial=!0;class lQ extends Bo{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Bi(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=u_,this.normalScale=new li(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}lQ.prototype.isMeshMatcapMaterial=!0;class cQ extends Ph{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}cQ.prototype.isLineDashedMaterial=!0;const es={arraySlice:function(n,e,t){return es.isTypedArray(n)?new n.constructor(n.subarray(e,t!==void 0?t:n.length)):n.slice(e,t)},convertArray:function(n,e,t){return!n||!t&&n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)},isTypedArray:function(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)},getKeyframeOrder:function(n){function e(r,o){return n[r]-n[o]}const t=n.length,i=new Array(t);for(let r=0;r!==t;++r)i[r]=r;return i.sort(e),i},sortedArray:function(n,e,t){const i=n.length,r=new n.constructor(i);for(let o=0,c=0;c!==i;++o){const s=t[o]*e;for(let d=0;d!==e;++d)r[c++]=n[s+d]}return r},flattenJSON:function(n,e,t,i){let r=1,o=n[0];for(;o!==void 0&&o[i]===void 0;)o=n[r++];if(o===void 0)return;let c=o[i];if(c!==void 0)if(Array.isArray(c))do c=o[i],c!==void 0&&(e.push(o.time),t.push.apply(t,c)),o=n[r++];while(o!==void 0);else if(c.toArray!==void 0)do c=o[i],c!==void 0&&(e.push(o.time),c.toArray(t,t.length)),o=n[r++];while(o!==void 0);else do c=o[i],c!==void 0&&(e.push(o.time),t.push(c)),o=n[r++];while(o!==void 0)},subclip:function(n,e,t,i,r=30){const o=n.clone();o.name=e;const c=[];for(let d=0;d<o.tracks.length;++d){const p=o.tracks[d],g=p.getValueSize(),_=[],x=[];for(let b=0;b<p.times.length;++b){const S=p.times[b]*r;if(!(S<t||S>=i)){_.push(p.times[b]);for(let P=0;P<g;++P)x.push(p.values[b*g+P])}}_.length!==0&&(p.times=es.convertArray(_,p.times.constructor),p.values=es.convertArray(x,p.values.constructor),c.push(p))}o.tracks=c;let s=1/0;for(let d=0;d<o.tracks.length;++d)s>o.tracks[d].times[0]&&(s=o.tracks[d].times[0]);for(let d=0;d<o.tracks.length;++d)o.tracks[d].shift(-1*s);return o.resetDuration(),o},makeClipAdditive:function(n,e=0,t=n,i=30){i<=0&&(i=30);const r=t.tracks.length,o=e/i;for(let c=0;c<r;++c){const s=t.tracks[c],d=s.ValueTypeName;if(d==="bool"||d==="string")continue;const p=n.tracks.find(function(E){return E.name===s.name&&E.ValueTypeName===d});if(p===void 0)continue;let g=0;const _=s.getValueSize();s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(g=_/3);let x=0;const b=p.getValueSize();p.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(x=b/3);const S=s.times.length-1;let P;if(o<=s.times[0]){const E=g,C=_-g;P=es.arraySlice(s.values,E,C)}else if(o>=s.times[S]){const E=S*_+g,C=E+_-g;P=es.arraySlice(s.values,E,C)}else{const E=s.createInterpolant(),C=g,D=_-g;E.evaluate(o),P=es.arraySlice(E.resultBuffer,C,D)}d==="quaternion"&&new go().fromArray(P).normalize().conjugate().toArray(P);const L=p.times.length;for(let E=0;E<L;++E){const C=E*b+x;if(d==="quaternion")go.multiplyQuaternionsFlat(p.values,C,P,0,p.values,C);else{const D=b-x*2;for(let O=0;O<D;++O)p.values[C+O]-=P[O]}}}return n.blendMode=JO,n}};class Vd{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,r=t[i],o=t[i-1];e:{t:{let c;i:{n:if(!(e<r)){for(let s=i+2;;){if(r===void 0){if(e<o)break n;return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,e,o)}if(i===s)break;if(o=r,r=t[++i],e<r)break t}c=t.length;break i}if(!(e>=o)){const s=t[1];e<s&&(i=2,o=s);for(let d=i-2;;){if(o===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(i===d)break;if(r=o,o=t[--i-1],e>=o)break t}c=i,i=0;break i}break e}for(;i<c;){const s=i+c>>>1;e<t[s]?c=s:i=s+1}if(r=t[i],o=t[i-1],o===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(r===void 0)return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,o,e)}this._cachedIndex=i,this.intervalChanged_(i,o,r)}return this.interpolate_(i,o,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,o=e*r;for(let c=0;c!==r;++c)t[c]=i[o+c];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}Vd.prototype.beforeStart_=Vd.prototype.copySampleValue_;Vd.prototype.afterEnd_=Vd.prototype.copySampleValue_;class uQ extends Vd{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:_g,endingEnd:_g}}intervalChanged_(e,t,i){const r=this.parameterPositions;let o=e-2,c=e+1,s=r[o],d=r[c];if(s===void 0)switch(this.getSettings_().endingStart){case vg:o=e,s=2*t-i;break;case Mw:o=r.length-2,s=t+r[o]-r[o+1];break;default:o=e,s=i}if(d===void 0)switch(this.getSettings_().endingEnd){case vg:c=e,d=2*i-t;break;case Mw:c=1,d=i+r[1]-r[0];break;default:c=e-1,d=t}const p=(i-t)*.5,g=this.valueSize;this._weightPrev=p/(t-s),this._weightNext=p/(d-i),this._offsetPrev=o*g,this._offsetNext=c*g}interpolate_(e,t,i,r){const o=this.resultBuffer,c=this.sampleValues,s=this.valueSize,d=e*s,p=d-s,g=this._offsetPrev,_=this._offsetNext,x=this._weightPrev,b=this._weightNext,S=(i-t)/(r-t),P=S*S,L=P*S,E=-x*L+2*x*P-x*S,C=(1+x)*L+(-1.5-2*x)*P+(-.5+x)*S+1,D=(-1-b)*L+(1.5+b)*P+.5*S,O=b*L-b*P;for(let U=0;U!==s;++U)o[U]=E*c[g+U]+C*c[p+U]+D*c[d+U]+O*c[_+U];return o}}class Bz extends Vd{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const o=this.resultBuffer,c=this.sampleValues,s=this.valueSize,d=e*s,p=d-s,g=(i-t)/(r-t),_=1-g;for(let x=0;x!==s;++x)o[x]=c[p+x]*_+c[d+x]*g;return o}}class hQ extends Vd{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class xu{constructor(e,t,i,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=es.convertArray(t,this.TimeBufferType),this.values=es.convertArray(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:es.convertArray(e.times,Array),values:es.convertArray(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new hQ(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Bz(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new uQ(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Sw:t=this.InterpolantFactoryMethodDiscrete;break;case Tw:t=this.InterpolantFactoryMethodLinear;break;case TT:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Sw;case this.InterpolantFactoryMethodLinear:return Tw;case this.InterpolantFactoryMethodSmooth:return TT}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){const i=this.times,r=i.length;let o=0,c=r-1;for(;o!==r&&i[o]<e;)++o;for(;c!==-1&&i[c]>t;)--c;if(++c,o!==0||c!==r){o>=c&&(c=Math.max(c,1),o=c-1);const s=this.getValueSize();this.times=es.arraySlice(i,o,c),this.values=es.arraySlice(this.values,o*s,c*s)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,r=this.values,o=i.length;o===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let c=null;for(let s=0;s!==o;s++){const d=i[s];if(typeof d=="number"&&isNaN(d)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,s,d),e=!1;break}if(c!==null&&c>d){console.error("THREE.KeyframeTrack: Out of order keys.",this,s,d,c),e=!1;break}c=d}if(r!==void 0&&es.isTypedArray(r))for(let s=0,d=r.length;s!==d;++s){const p=r[s];if(isNaN(p)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,s,p),e=!1;break}}return e}optimize(){const e=es.arraySlice(this.times),t=es.arraySlice(this.values),i=this.getValueSize(),r=this.getInterpolation()===TT,o=e.length-1;let c=1;for(let s=1;s<o;++s){let d=!1;const p=e[s],g=e[s+1];if(p!==g&&(s!==1||p!==e[0]))if(r)d=!0;else{const _=s*i,x=_-i,b=_+i;for(let S=0;S!==i;++S){const P=t[_+S];if(P!==t[x+S]||P!==t[b+S]){d=!0;break}}}if(d){if(s!==c){e[c]=e[s];const _=s*i,x=c*i;for(let b=0;b!==i;++b)t[x+b]=t[_+b]}++c}}if(o>0){e[c]=e[o];for(let s=o*i,d=c*i,p=0;p!==i;++p)t[d+p]=t[s+p];++c}return c!==e.length?(this.times=es.arraySlice(e,0,c),this.values=es.arraySlice(t,0,c*i)):(this.times=e,this.values=t),this}clone(){const e=es.arraySlice(this.times,0),t=es.arraySlice(this.values,0),i=this.constructor,r=new i(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}xu.prototype.TimeBufferType=Float32Array;xu.prototype.ValueBufferType=Float32Array;xu.prototype.DefaultInterpolation=Tw;class m_ extends xu{}m_.prototype.ValueTypeName="bool";m_.prototype.ValueBufferType=Array;m_.prototype.DefaultInterpolation=Sw;m_.prototype.InterpolantFactoryMethodLinear=void 0;m_.prototype.InterpolantFactoryMethodSmooth=void 0;class Nz extends xu{}Nz.prototype.ValueTypeName="color";class Ew extends xu{}Ew.prototype.ValueTypeName="number";class dQ extends Vd{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const o=this.resultBuffer,c=this.sampleValues,s=this.valueSize,d=(i-t)/(r-t);let p=e*s;for(let g=p+s;p!==g;p+=4)go.slerpFlat(o,0,c,p-s,c,p,d);return o}}class v0 extends xu{InterpolantFactoryMethodLinear(e){return new dQ(this.times,this.values,this.getValueSize(),e)}}v0.prototype.ValueTypeName="quaternion";v0.prototype.DefaultInterpolation=Tw;v0.prototype.InterpolantFactoryMethodSmooth=void 0;class g_ extends xu{}g_.prototype.ValueTypeName="string";g_.prototype.ValueBufferType=Array;g_.prototype.DefaultInterpolation=Sw;g_.prototype.InterpolantFactoryMethodLinear=void 0;g_.prototype.InterpolantFactoryMethodSmooth=void 0;class Aw extends xu{}Aw.prototype.ValueTypeName="vector";class qL{constructor(e,t=-1,i,r=EC){this.name=e,this.tracks=i,this.duration=t,this.blendMode=r,this.uuid=Tc(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,r=1/(e.fps||1);for(let c=0,s=i.length;c!==s;++c)t.push(pQ(i[c]).scale(r));const o=new this(e.name,e.duration,t,e.blendMode);return o.uuid=e.uuid,o}static toJSON(e){const t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let o=0,c=i.length;o!==c;++o)t.push(xu.toJSON(i[o]));return r}static CreateFromMorphTargetSequence(e,t,i,r){const o=t.length,c=[];for(let s=0;s<o;s++){let d=[],p=[];d.push((s+o-1)%o,s,(s+1)%o),p.push(0,1,0);const g=es.getKeyframeOrder(d);d=es.sortedArray(d,1,g),p=es.sortedArray(p,1,g),!r&&d[0]===0&&(d.push(o),p.push(p[0])),c.push(new Ew(".morphTargetInfluences["+t[s].name+"]",d,p).scale(1/i))}return new this(e,-1,c)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const r=e;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===t)return i[r];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const r={},o=/^([\w-]*?)([\d]+)$/;for(let s=0,d=e.length;s<d;s++){const p=e[s],g=p.name.match(o);if(g&&g.length>1){const _=g[1];let x=r[_];x||(r[_]=x=[]),x.push(p)}}const c=[];for(const s in r)c.push(this.CreateFromMorphTargetSequence(s,r[s],t,i));return c}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(_,x,b,S,P){if(b.length!==0){const L=[],E=[];es.flattenJSON(b,L,E,S),L.length!==0&&P.push(new _(x,L,E))}},r=[],o=e.name||"default",c=e.fps||30,s=e.blendMode;let d=e.length||-1;const p=e.hierarchy||[];for(let _=0;_<p.length;_++){const x=p[_].keys;if(!(!x||x.length===0))if(x[0].morphTargets){const b={};let S;for(S=0;S<x.length;S++)if(x[S].morphTargets)for(let P=0;P<x[S].morphTargets.length;P++)b[x[S].morphTargets[P]]=-1;for(const P in b){const L=[],E=[];for(let C=0;C!==x[S].morphTargets.length;++C){const D=x[S];L.push(D.time),E.push(D.morphTarget===P?1:0)}r.push(new Ew(".morphTargetInfluence["+P+"]",L,E))}d=b.length*c}else{const b=".bones["+t[_].name+"]";i(Aw,b+".position",x,"pos",r),i(v0,b+".quaternion",x,"rot",r),i(Aw,b+".scale",x,"scl",r)}}return r.length===0?null:new this(o,d,r,s)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,r=e.length;i!==r;++i){const o=this.tracks[i];t=Math.max(t,o.times[o.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function fQ(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ew;case"vector":case"vector2":case"vector3":case"vector4":return Aw;case"color":return Nz;case"quaternion":return v0;case"bool":case"boolean":return m_;case"string":return g_}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function pQ(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=fQ(n.type);if(n.times===void 0){const t=[],i=[];es.flattenJSON(n.keys,t,i,"value"),n.times=t,n.values=i}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const Xg={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class mQ{constructor(e,t,i){const r=this;let o=!1,c=0,s=0,d;const p=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(g){s++,o===!1&&r.onStart!==void 0&&r.onStart(g,c,s),o=!0},this.itemEnd=function(g){c++,r.onProgress!==void 0&&r.onProgress(g,c,s),c===s&&(o=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(g){r.onError!==void 0&&r.onError(g)},this.resolveURL=function(g){return d?d(g):g},this.setURLModifier=function(g){return d=g,this},this.addHandler=function(g,_){return p.push(g,_),this},this.removeHandler=function(g){const _=p.indexOf(g);return _!==-1&&p.splice(_,2),this},this.getHandler=function(g){for(let _=0,x=p.length;_<x;_+=2){const b=p[_],S=p[_+1];if(b.global&&(b.lastIndex=0),b.test(g))return S}return null}}}const gQ=new mQ;class Kd{constructor(e){this.manager=e!==void 0?e:gQ,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(r,o){i.load(e,r,t,o)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const sh={};class _Q extends Kd{constructor(e){super(e)}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=Xg.get(e);if(o!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(o),this.manager.itemEnd(e)},0),o;if(sh[e]!==void 0){sh[e].push({onLoad:t,onProgress:i,onError:r});return}sh[e]=[],sh[e].push({onLoad:t,onProgress:i,onError:r});const c=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"});fetch(c).then(s=>{if(s.status===200||s.status===0){s.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received.");const d=sh[e],p=s.body.getReader(),g=s.headers.get("Content-Length"),_=g?parseInt(g):0,x=_!==0;let b=0;return new ReadableStream({start(S){P();function P(){p.read().then(({done:L,value:E})=>{if(L)S.close();else{b+=E.byteLength;const C=new ProgressEvent("progress",{lengthComputable:x,loaded:b,total:_});for(let D=0,O=d.length;D<O;D++){const U=d[D];U.onProgress&&U.onProgress(C)}S.enqueue(E),P()}})}}})}else throw Error(`fetch for "${s.url}" responded with ${s.status}: ${s.statusText}`)}).then(s=>{const d=new Response(s);switch(this.responseType){case"arraybuffer":return d.arrayBuffer();case"blob":return d.blob();case"document":return d.text().then(p=>new DOMParser().parseFromString(p,this.mimeType));case"json":return d.json();default:return d.text()}}).then(s=>{Xg.add(e,s);const d=sh[e];delete sh[e];for(let p=0,g=d.length;p<g;p++){const _=d[p];_.onLoad&&_.onLoad(s)}this.manager.itemEnd(e)}).catch(s=>{const d=sh[e];delete sh[e];for(let p=0,g=d.length;p<g;p++){const _=d[p];_.onError&&_.onError(s)}this.manager.itemError(e),this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class $z extends Kd{constructor(e){super(e)}load(e,t,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,c=Xg.get(e);if(c!==void 0)return o.manager.itemStart(e),setTimeout(function(){t&&t(c),o.manager.itemEnd(e)},0),c;const s=u1("img");function d(){g(),Xg.add(e,this),t&&t(this),o.manager.itemEnd(e)}function p(_){g(),r&&r(_),o.manager.itemError(e),o.manager.itemEnd(e)}function g(){s.removeEventListener("load",d,!1),s.removeEventListener("error",p,!1)}return s.addEventListener("load",d,!1),s.addEventListener("error",p,!1),e.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(s.crossOrigin=this.crossOrigin),o.manager.itemStart(e),s.src=e,s}}class vQ extends Kd{constructor(e){super(e)}load(e,t,i,r){const o=new h1,c=new $z(this.manager);c.setCrossOrigin(this.crossOrigin),c.setPath(this.path);let s=0;function d(p){c.load(e[p],function(g){o.images[p]=g,s++,s===6&&(o.needsUpdate=!0,t&&t(o))},void 0,r)}for(let p=0;p<e.length;++p)d(p);return o}}class yQ extends Kd{constructor(e){super(e)}load(e,t,i,r){const o=new Bs,c=new $z(this.manager);return c.setCrossOrigin(this.crossOrigin),c.setPath(this.path),c.load(e,function(s){o.image=s,o.needsUpdate=!0,t!==void 0&&t(o)},i,r),o}}class _u extends Ln{constructor(e,t=1){super(),this.type="Light",this.color=new Bi(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}_u.prototype.isLight=!0;class bQ extends _u{constructor(e,t,i){super(e,i),this.type="HemisphereLight",this.position.copy(Ln.DefaultUp),this.updateMatrix(),this.groundColor=new Bi(t)}copy(e){return _u.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}bQ.prototype.isHemisphereLight=!0;const WL=new Li,HL=new Ue,ZL=new Ue;class UC{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new li(512,512),this.map=null,this.mapPass=null,this.matrix=new Li,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new d1,this._frameExtents=new li(1,1),this._viewportCount=1,this._viewports=[new Zn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;HL.setFromMatrixPosition(e.matrixWorld),t.position.copy(HL),ZL.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(ZL),t.updateMatrixWorld(),WL.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(WL),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(t.projectionMatrix),i.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Vz extends UC{constructor(){super(new ea(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera,i=By*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,o=e.distance||t.far;(i!==t.fov||r!==t.aspect||o!==t.far)&&(t.fov=i,t.aspect=r,t.far=o,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}Vz.prototype.isSpotLightShadow=!0;class xQ extends _u{constructor(e,t,i=0,r=Math.PI/3,o=0,c=1){super(e,t),this.type="SpotLight",this.position.copy(Ln.DefaultUp),this.updateMatrix(),this.target=new Ln,this.distance=i,this.angle=r,this.penumbra=o,this.decay=c,this.shadow=new Vz}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}xQ.prototype.isSpotLight=!0;const XL=new Li,Fv=new Ue,rM=new Ue;class Uz extends UC{constructor(){super(new ea(90,1,.5,500)),this._frameExtents=new li(4,2),this._viewportCount=6,this._viewports=[new Zn(2,1,1,1),new Zn(0,1,1,1),new Zn(3,1,1,1),new Zn(1,1,1,1),new Zn(3,0,1,1),new Zn(1,0,1,1)],this._cubeDirections=[new Ue(1,0,0),new Ue(-1,0,0),new Ue(0,0,1),new Ue(0,0,-1),new Ue(0,1,0),new Ue(0,-1,0)],this._cubeUps=[new Ue(0,1,0),new Ue(0,1,0),new Ue(0,1,0),new Ue(0,1,0),new Ue(0,0,1),new Ue(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,r=this.matrix,o=e.distance||i.far;o!==i.far&&(i.far=o,i.updateProjectionMatrix()),Fv.setFromMatrixPosition(e.matrixWorld),i.position.copy(Fv),rM.copy(i.position),rM.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(rM),i.updateMatrixWorld(),r.makeTranslation(-Fv.x,-Fv.y,-Fv.z),XL.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(XL)}}Uz.prototype.isPointLightShadow=!0;class wQ extends _u{constructor(e,t,i=0,r=1){super(e,t),this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new Uz}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}wQ.prototype.isPointLight=!0;class jz extends UC{constructor(){super(new p1(-5,5,5,-5,.5,500))}}jz.prototype.isDirectionalLightShadow=!0;class SQ extends _u{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(Ln.DefaultUp),this.updateMatrix(),this.target=new Ln,this.shadow=new jz}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}SQ.prototype.isDirectionalLight=!0;class TQ extends _u{constructor(e,t){super(e,t),this.type="AmbientLight"}}TQ.prototype.isAmbientLight=!0;class MQ extends _u{constructor(e,t,i=10,r=10){super(e,t),this.type="RectAreaLight",this.width=i,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}MQ.prototype.isRectAreaLight=!0;class Gz{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Ue)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,r=e.y,o=e.z,c=this.coefficients;return t.copy(c[0]).multiplyScalar(.282095),t.addScaledVector(c[1],.488603*r),t.addScaledVector(c[2],.488603*o),t.addScaledVector(c[3],.488603*i),t.addScaledVector(c[4],1.092548*(i*r)),t.addScaledVector(c[5],1.092548*(r*o)),t.addScaledVector(c[6],.315392*(3*o*o-1)),t.addScaledVector(c[7],1.092548*(i*o)),t.addScaledVector(c[8],.546274*(i*i-r*r)),t}getIrradianceAt(e,t){const i=e.x,r=e.y,o=e.z,c=this.coefficients;return t.copy(c[0]).multiplyScalar(.886227),t.addScaledVector(c[1],2*.511664*r),t.addScaledVector(c[2],2*.511664*o),t.addScaledVector(c[3],2*.511664*i),t.addScaledVector(c[4],2*.429043*i*r),t.addScaledVector(c[5],2*.429043*r*o),t.addScaledVector(c[6],.743125*o*o-.247708),t.addScaledVector(c[7],2*.429043*i*o),t.addScaledVector(c[8],.429043*(i*i-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].fromArray(e,t+r*3);return this}toArray(e=[],t=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].toArray(e,t+r*3);return e}static getBasisAt(e,t){const i=e.x,r=e.y,o=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*o,t[3]=.488603*i,t[4]=1.092548*i*r,t[5]=1.092548*r*o,t[6]=.315392*(3*o*o-1),t[7]=1.092548*i*o,t[8]=.546274*(i*i-r*r)}}Gz.prototype.isSphericalHarmonics3=!0;class jC extends _u{constructor(e=new Gz,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}jC.prototype.isLightProbe=!0;class CQ{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let i=0,r=e.length;i<r;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.substr(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class EQ extends Vn{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}EQ.prototype.isInstancedBufferGeometry=!0;class AQ extends Kd{constructor(e){super(e),typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,c=Xg.get(e);if(c!==void 0)return o.manager.itemStart(e),setTimeout(function(){t&&t(c),o.manager.itemEnd(e)},0),c;const s={};s.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",s.headers=this.requestHeader,fetch(e,s).then(function(d){return d.blob()}).then(function(d){return createImageBitmap(d,Object.assign(o.options,{colorSpaceConversion:"none"}))}).then(function(d){Xg.add(e,d),t&&t(d),o.manager.itemEnd(e)}).catch(function(d){r&&r(d),o.manager.itemError(e),o.manager.itemEnd(e)}),o.manager.itemStart(e)}}AQ.prototype.isImageBitmapLoader=!0;let px;const PQ={getContext:function(){return px===void 0&&(px=new(window.AudioContext||window.webkitAudioContext)),px},setContext:function(n){px=n}};class IQ extends Kd{constructor(e){super(e)}load(e,t,i,r){const o=this,c=new _Q(this.manager);c.setResponseType("arraybuffer"),c.setPath(this.path),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(s){try{const d=s.slice(0);PQ.getContext().decodeAudioData(d,function(g){t(g)})}catch(d){r?r(d):console.error(d),o.manager.itemError(e)}},i,r)}}class RQ extends jC{constructor(e,t,i=1){super(void 0,i);const r=new Bi().set(e),o=new Bi().set(t),c=new Ue(r.r,r.g,r.b),s=new Ue(o.r,o.g,o.b),d=Math.sqrt(Math.PI),p=d*Math.sqrt(.75);this.sh.coefficients[0].copy(c).add(s).multiplyScalar(d),this.sh.coefficients[1].copy(c).sub(s).multiplyScalar(p)}}RQ.prototype.isHemisphereLightProbe=!0;class LQ extends jC{constructor(e,t=1){super(void 0,t);const i=new Bi().set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}LQ.prototype.isAmbientLightProbe=!0;class kQ{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=YL(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=YL();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function YL(){return(typeof performance>"u"?Date:performance).now()}class DQ extends Ln{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}class FQ{constructor(e,t,i){this.binding=e,this.valueSize=i;let r,o,c;switch(t){case"quaternion":r=this._slerp,o=this._slerpAdditive,c=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":r=this._select,o=this._select,c=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:r=this._lerp,o=this._lerpAdditive,c=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=o,this._setIdentity=c,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,r=this.valueSize,o=e*r+r;let c=this.cumulativeWeight;if(c===0){for(let s=0;s!==r;++s)i[o+s]=i[s];c=t}else{c+=t;const s=t/c;this._mixBufferRegion(i,o,0,s,r)}this.cumulativeWeight=c}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,r=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,r=e*t+t,o=this.cumulativeWeight,c=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,o<1){const d=t*this._origIndex;this._mixBufferRegion(i,r,d,1-o,t)}c>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*t,1,t);for(let d=t,p=t+t;d!==p;++d)if(i[d]!==i[d+t]){s.setValue(i,r);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,r=i*this._origIndex;e.getValue(t,r);for(let o=i,c=r;o!==c;++o)t[o]=t[r+o%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,r,o){if(r>=.5)for(let c=0;c!==o;++c)e[t+c]=e[i+c]}_slerp(e,t,i,r){go.slerpFlat(e,t,e,t,e,i,r)}_slerpAdditive(e,t,i,r,o){const c=this._workIndex*o;go.multiplyQuaternionsFlat(e,c,e,t,e,i),go.slerpFlat(e,t,e,t,e,c,r)}_lerp(e,t,i,r,o){const c=1-r;for(let s=0;s!==o;++s){const d=t+s;e[d]=e[d]*c+e[i+s]*r}}_lerpAdditive(e,t,i,r,o){for(let c=0;c!==o;++c){const s=t+c;e[s]=e[s]+e[i+c]*r}}}const GC="\\[\\]\\.:\\/",OQ=new RegExp("["+GC+"]","g"),qC="[^"+GC+"]",zQ="[^"+GC.replace("\\.","")+"]",BQ=/((?:WC+[\/:])*)/.source.replace("WC",qC),NQ=/(WCOD+)?/.source.replace("WCOD",zQ),$Q=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",qC),VQ=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",qC),UQ=new RegExp("^"+BQ+NQ+$Q+VQ+"$"),jQ=["material","materials","bones"];class GQ{constructor(e,t,i){const r=i||lr.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,o=i.length;r!==o;++r)i[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}class lr{constructor(e,t,i){this.path=t,this.parsedPath=i||lr.parseTrackName(t),this.node=lr.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new lr.Composite(e,t,i):new lr(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(OQ,"")}static parseTrackName(e){const t=UQ.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){const o=i.nodeName.substring(r+1);jQ.indexOf(o)!==-1&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=o)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(!t||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=function(o){for(let c=0;c<o.length;c++){const s=o[c];if(s.name===t||s.uuid===t)return s;const d=i(s.children);if(d)return d}return null},r=i(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let r=0,o=i.length;r!==o;++r)e[t++]=i[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let r=0,o=i.length;r!==o;++r)i[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let r=0,o=i.length;r!==o;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let r=0,o=i.length;r!==o;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,r=t.propertyName;let o=t.propertyIndex;if(e||(e=lr.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let p=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let g=0;g<e.length;g++)if(e[g].name===p){p=g;break}break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(p!==void 0){if(e[p]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[p]}}const c=e[r];if(c===void 0){const p=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+p+"."+r+" but it wasn't found.",e);return}let s=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?s=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(s=this.Versioning.MatrixWorldNeedsUpdate);let d=this.BindingType.Direct;if(o!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[o]!==void 0&&(o=e.morphTargetDictionary[o])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}d=this.BindingType.ArrayElement,this.resolvedProperty=c,this.propertyIndex=o}else c.fromArray!==void 0&&c.toArray!==void 0?(d=this.BindingType.HasFromToArray,this.resolvedProperty=c):Array.isArray(c)?(d=this.BindingType.EntireArray,this.resolvedProperty=c):this.propertyName=r;this.getValue=this.GetterByBindingType[d],this.setValue=this.SetterByBindingTypeAndVersioning[d][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}lr.Composite=GQ;lr.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};lr.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};lr.prototype.GetterByBindingType=[lr.prototype._getValue_direct,lr.prototype._getValue_array,lr.prototype._getValue_arrayElement,lr.prototype._getValue_toArray];lr.prototype.SetterByBindingTypeAndVersioning=[[lr.prototype._setValue_direct,lr.prototype._setValue_direct_setNeedsUpdate,lr.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[lr.prototype._setValue_array,lr.prototype._setValue_array_setNeedsUpdate,lr.prototype._setValue_array_setMatrixWorldNeedsUpdate],[lr.prototype._setValue_arrayElement,lr.prototype._setValue_arrayElement_setNeedsUpdate,lr.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[lr.prototype._setValue_fromArray,lr.prototype._setValue_fromArray_setNeedsUpdate,lr.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class qQ{constructor(e,t,i=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=r;const o=t.tracks,c=o.length,s=new Array(c),d={endingStart:_g,endingEnd:_g};for(let p=0;p!==c;++p){const g=o[p].createInterpolant(null);s[p]=g,g.settings=d}this._interpolantSettings=d,this._interpolants=s,this._propertyBindings=new Array(c),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=p9,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const r=this._clip.duration,o=e._clip.duration,c=o/r,s=r/o;e.warp(1,c,t),this.warp(s,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const r=this._mixer,o=r.time,c=this.timeScale;let s=this._timeScaleInterpolant;s===null&&(s=r._lendControlInterpolant(),this._timeScaleInterpolant=s);const d=s.parameterPositions,p=s.sampleValues;return d[0]=o,d[1]=o+i,p[0]=e/c,p[1]=t/c,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,r){if(!this.enabled){this._updateWeight(e);return}const o=this._startTime;if(o!==null){const d=(e-o)*i;if(d<0||i===0)return;this._startTime=null,t=i*d}t*=this._updateTimeScale(e);const c=this._updateTime(t),s=this._updateWeight(e);if(s>0){const d=this._interpolants,p=this._propertyBindings;switch(this.blendMode){case JO:for(let g=0,_=d.length;g!==_;++g)d[g].evaluate(c),p[g].accumulateAdditive(s);break;case EC:default:for(let g=0,_=d.length;g!==_;++g)d[g].evaluate(c),p[g].accumulate(r,s)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(i!==null){const r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;if(i!==null){const r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let r=this.time+e,o=this._loopCount;const c=i===m9;if(e===0)return o===-1?r:c&&(o&1)===1?t-r:r;if(i===f9){o===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(o===-1&&(e>=0?(o=0,this._setEndings(!0,this.repetitions===0,c)):this._setEndings(this.repetitions===0,!0,c)),r>=t||r<0){const s=Math.floor(r/t);r-=t*s,o+=Math.abs(s);const d=this.repetitions-o;if(d<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(d===1){const p=e<0;this._setEndings(p,!p,c)}else this._setEndings(!1,!1,c);this._loopCount=o,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:s})}}else this.time=r;if(c&&(o&1)===1)return t-r}return r}_setEndings(e,t,i){const r=this._interpolantSettings;i?(r.endingStart=vg,r.endingEnd=vg):(e?r.endingStart=this.zeroSlopeAtStart?vg:_g:r.endingStart=Mw,t?r.endingEnd=this.zeroSlopeAtEnd?vg:_g:r.endingEnd=Mw)}_scheduleFading(e,t,i){const r=this._mixer,o=r.time;let c=this._weightInterpolant;c===null&&(c=r._lendControlInterpolant(),this._weightInterpolant=c);const s=c.parameterPositions,d=c.sampleValues;return s[0]=o,d[0]=t,s[1]=o+e,d[1]=i,this}}class WQ extends Tp{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,r=e._clip.tracks,o=r.length,c=e._propertyBindings,s=e._interpolants,d=i.uuid,p=this._bindingsByRootAndName;let g=p[d];g===void 0&&(g={},p[d]=g);for(let _=0;_!==o;++_){const x=r[_],b=x.name;let S=g[b];if(S!==void 0)c[_]=S;else{if(S=c[_],S!==void 0){S._cacheIndex===null&&(++S.referenceCount,this._addInactiveBinding(S,d,b));continue}const P=t&&t._propertyBindings[_].binding.parsedPath;S=new FQ(lr.create(i,b,P),x.ValueTypeName,x.getValueSize()),++S.referenceCount,this._addInactiveBinding(S,d,b),c[_]=S}s[_].resultBuffer=S.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const i=(e._localRoot||this._root).uuid,r=e._clip.uuid,o=this._actionsByClip[r];this._bindAction(e,o&&o.knownActions[0]),this._addInactiveAction(e,r,i)}const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const o=t[i];o.useCount++===0&&(this._lendBinding(o),o.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const o=t[i];--o.useCount===0&&(o.restoreOriginalState(),this._takeBackBinding(o))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){const r=this._actions,o=this._actionsByClip;let c=o[t];if(c===void 0)c={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,o[t]=c;else{const s=c.knownActions;e._byClipCacheIndex=s.length,s.push(e)}e._cacheIndex=r.length,r.push(e),c.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null;const o=e._clip.uuid,c=this._actionsByClip,s=c[o],d=s.knownActions,p=d[d.length-1],g=e._byClipCacheIndex;p._byClipCacheIndex=g,d[g]=p,d.pop(),e._byClipCacheIndex=null;const _=s.actionByRoot,x=(e._localRoot||this._root).uuid;delete _[x],d.length===0&&delete c[o],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const o=t[i];--o.referenceCount===0&&this._removeInactiveBinding(o)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,o=t[r];e._cacheIndex=r,t[r]=e,o._cacheIndex=i,t[i]=o}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,o=t[r];e._cacheIndex=r,t[r]=e,o._cacheIndex=i,t[i]=o}_addInactiveBinding(e,t,i){const r=this._bindingsByRootAndName,o=this._bindings;let c=r[t];c===void 0&&(c={},r[t]=c),c[i]=e,e._cacheIndex=o.length,o.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,r=i.rootNode.uuid,o=i.path,c=this._bindingsByRootAndName,s=c[r],d=t[t.length-1],p=e._cacheIndex;d._cacheIndex=p,t[p]=d,t.pop(),delete s[o],Object.keys(s).length===0&&delete c[r]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,o=t[r];e._cacheIndex=r,t[r]=e,o._cacheIndex=i,t[i]=o}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,o=t[r];e._cacheIndex=r,t[r]=e,o._cacheIndex=i,t[i]=o}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return i===void 0&&(i=new Bz(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,o=t[r];e.__cacheIndex=r,t[r]=e,o.__cacheIndex=i,t[i]=o}clipAction(e,t,i){const r=t||this._root,o=r.uuid;let c=typeof e=="string"?qL.findByName(r,e):e;const s=c!==null?c.uuid:e,d=this._actionsByClip[s];let p=null;if(i===void 0&&(c!==null?i=c.blendMode:i=EC),d!==void 0){const _=d.actionByRoot[o];if(_!==void 0&&_.blendMode===i)return _;p=d.knownActions[0],c===null&&(c=p._clip)}if(c===null)return null;const g=new qQ(this,c,t,i);return this._bindAction(g,p),this._addInactiveAction(g,s,o),g}existingAction(e,t){const i=t||this._root,r=i.uuid,o=typeof e=="string"?qL.findByName(i,e):e,c=o?o.uuid:e,s=this._actionsByClip[c];return s!==void 0&&s.actionByRoot[r]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,r=this.time+=e,o=Math.sign(e),c=this._accuIndex^=1;for(let p=0;p!==i;++p)t[p]._update(r,e,o,c);const s=this._bindings,d=this._nActiveBindings;for(let p=0;p!==d;++p)s[p].apply(c);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,r=this._actionsByClip,o=r[i];if(o!==void 0){const c=o.knownActions;for(let s=0,d=c.length;s!==d;++s){const p=c[s];this._deactivateAction(p);const g=p._cacheIndex,_=t[t.length-1];p._cacheIndex=null,p._byClipCacheIndex=null,_._cacheIndex=g,t[g]=_,t.pop(),this._removeInactiveBindingsForAction(p)}delete r[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const c in i){const s=i[c].actionByRoot,d=s[t];d!==void 0&&(this._deactivateAction(d),this._removeInactiveAction(d))}const r=this._bindingsByRootAndName,o=r[t];if(o!==void 0)for(const c in o){const s=o[c];s.restoreOriginalState(),this._removeInactiveBinding(s)}}uncacheAction(e,t){const i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}WQ.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class HQ extends g0{constructor(e,t,i=1){super(e,t),this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}HQ.prototype.isInstancedInterleavedBuffer=!0;class Pw{constructor(e,t,i=0,r=1/0){this.ray=new Mp(e,t),this.near=i,this.far=r,this.camera=null,this.layers=new sz,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return p2(e,this,i,t),i.sort(KL),i}intersectObjects(e,t=!0,i=[]){for(let r=0,o=e.length;r<o;r++)p2(e[r],this,i,t);return i.sort(KL),i}}function KL(n,e){return n.distance-e.distance}function p2(n,e,t,i){if(n.layers.test(e.layers)&&n.raycast(e,t),i===!0){const r=n.children;for(let o=0,c=r.length;o<c;o++)p2(r[o],e,t,!0)}}const _d=new Ue,mx=new Li,sM=new Li;class ZQ extends g1{constructor(e){const t=qz(e),i=new Vn,r=[],o=[],c=new Bi(0,0,1),s=new Bi(0,1,0);for(let p=0;p<t.length;p++){const g=t[p];g.parent&&g.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),o.push(c.r,c.g,c.b),o.push(s.r,s.g,s.b))}i.setAttribute("position",new Ts(r,3)),i.setAttribute("color",new Ts(o,3));const d=new Ph({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(i,d),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,i=this.geometry,r=i.getAttribute("position");sM.copy(this.root.matrixWorld).invert();for(let o=0,c=0;o<t.length;o++){const s=t[o];s.parent&&s.parent.isBone&&(mx.multiplyMatrices(sM,s.matrixWorld),_d.setFromMatrixPosition(mx),r.setXYZ(c,_d.x,_d.y,_d.z),mx.multiplyMatrices(sM,s.parent.matrixWorld),_d.setFromMatrixPosition(mx),r.setXYZ(c+1,_d.x,_d.y,_d.z),c+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function qz(n){const e=[];n&&n.isBone&&e.push(n);for(let t=0;t<n.children.length;t++)e.push.apply(e,qz(n.children[t]));return e}class XQ extends g1{constructor(e=10,t=10,i=4473924,r=8947848){i=new Bi(i),r=new Bi(r);const o=t/2,c=e/t,s=e/2,d=[],p=[];for(let x=0,b=0,S=-s;x<=t;x++,S+=c){d.push(-s,0,S,s,0,S),d.push(S,0,-s,S,0,s);const P=x===o?i:r;P.toArray(p,b),b+=3,P.toArray(p,b),b+=3,P.toArray(p,b),b+=3,P.toArray(p,b),b+=3}const g=new Vn;g.setAttribute("position",new Ts(d,3)),g.setAttribute("color",new Ts(p,3));const _=new Ph({vertexColors:!0,toneMapped:!1});super(g,_),this.type="GridHelper"}}const YQ=new Float32Array(1);new Int32Array(YQ.buffer);jl.create=function(n,e){return console.log("THREE.Curve.create() has been deprecated"),n.prototype=Object.create(jl.prototype),n.prototype.constructor=n,n.prototype.getPoint=e,n};h2.prototype.fromPoints=function(n){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(n)};XQ.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};ZQ.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};Kd.prototype.extractUrlBase=function(n){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),CQ.extractUrlBase(n)};Kd.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};ul.prototype.center=function(n){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(n)};ul.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()};ul.prototype.isIntersectionBox=function(n){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(n)};ul.prototype.isIntersectionSphere=function(n){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(n)};ul.prototype.size=function(n){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(n)};d_.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()};d1.prototype.setFromMatrix=function(n){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(n)};mo.prototype.flattenToArrayOffset=function(n,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(n,e)};mo.prototype.multiplyVector3=function(n){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),n.applyMatrix3(this)};mo.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")};mo.prototype.applyToBufferAttribute=function(n){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),n.applyMatrix3(this)};mo.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")};mo.prototype.getInverse=function(n){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(n).invert()};Li.prototype.extractPosition=function(n){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(n)};Li.prototype.flattenToArrayOffset=function(n,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(n,e)};Li.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new Ue().setFromMatrixColumn(this,3)};Li.prototype.setRotationFromQuaternion=function(n){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(n)};Li.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")};Li.prototype.multiplyVector3=function(n){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)};Li.prototype.multiplyVector4=function(n){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)};Li.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")};Li.prototype.rotateAxis=function(n){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),n.transformDirection(this)};Li.prototype.crossVector=function(n){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)};Li.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")};Li.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")};Li.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")};Li.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")};Li.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")};Li.prototype.applyToBufferAttribute=function(n){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)};Li.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")};Li.prototype.makeFrustum=function(n,e,t,i,r,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(n,e,i,t,r,o)};Li.prototype.getInverse=function(n){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(n).invert()};uh.prototype.isIntersectionLine=function(n){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(n)};go.prototype.multiplyVector3=function(n){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),n.applyQuaternion(this)};go.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()};Mp.prototype.isIntersectionBox=function(n){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(n)};Mp.prototype.isIntersectionPlane=function(n){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(n)};Mp.prototype.isIntersectionSphere=function(n){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(n)};Xs.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()};Xs.prototype.barycoordFromPoint=function(n,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(n,e)};Xs.prototype.midpoint=function(n){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(n)};Xs.prototypenormal=function(n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(n)};Xs.prototype.plane=function(n){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(n)};Xs.barycoordFromPoint=function(n,e,t,i,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Xs.getBarycoord(n,e,t,i,r)};Xs.normal=function(n,e,t,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Xs.getNormal(n,e,t,i)};_0.prototype.extractAllPoints=function(n){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(n)};_0.prototype.extrude=function(n){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new p_(this,n)};_0.prototype.makeGeometry=function(n){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new $C(this,n)};li.prototype.fromAttribute=function(n,e,t){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(n,e,t)};li.prototype.distanceToManhattan=function(n){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(n)};li.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Ue.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")};Ue.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")};Ue.prototype.getPositionFromMatrix=function(n){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(n)};Ue.prototype.getScaleFromMatrix=function(n){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(n)};Ue.prototype.getColumnFromMatrix=function(n,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,n)};Ue.prototype.applyProjection=function(n){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(n)};Ue.prototype.fromAttribute=function(n,e,t){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(n,e,t)};Ue.prototype.distanceToManhattan=function(n){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(n)};Ue.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Zn.prototype.fromAttribute=function(n,e,t){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(n,e,t)};Zn.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Ln.prototype.getChildByName=function(n){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(n)};Ln.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")};Ln.prototype.translate=function(n,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,n)};Ln.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")};Ln.prototype.applyMatrix=function(n){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(n)};Object.defineProperties(Ln.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(n){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=n}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});kr.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")};Object.defineProperties(kr.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),g9},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});Ez.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};ea.prototype.setLens=function(n,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),e!==void 0&&(this.filmGauge=e),this.setFocalLength(n)};Object.defineProperties(_u.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(n){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=n}},shadowCameraLeft:{set:function(n){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=n}},shadowCameraRight:{set:function(n){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=n}},shadowCameraTop:{set:function(n){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=n}},shadowCameraBottom:{set:function(n){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=n}},shadowCameraNear:{set:function(n){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=n}},shadowCameraFar:{set:function(n){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=n}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(n){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=n}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(n){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=n}},shadowMapHeight:{set:function(n){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=n}}});Object.defineProperties(Mn.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Cw},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Cw)}}});Mn.prototype.setDynamic=function(n){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(n===!0?Cw:zy),this};Mn.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Mn.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};Vn.prototype.addIndex=function(n){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(n)};Vn.prototype.addAttribute=function(n,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(e&&e.isBufferAttribute)&&!(e&&e.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(n,new Mn(arguments[1],arguments[2]))):n==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(n,e)};Vn.prototype.addDrawCall=function(n,e,t){t!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(n,e)};Vn.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()};Vn.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")};Vn.prototype.removeAttribute=function(n){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(n)};Vn.prototype.applyMatrix=function(n){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(n)};Object.defineProperties(Vn.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}});g0.prototype.setDynamic=function(n){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(n===!0?Cw:zy),this};g0.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};p_.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")};p_.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")};p_.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")};vh.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")};Object.defineProperties(Bo.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Bi}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(n){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===ZO}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(n){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=n}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}});Object.defineProperties(Jo.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(n){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=n}}});hr.prototype.clearTarget=function(n,e,t,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(n),this.clear(e,t,i)};hr.prototype.animate=function(n){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(n)};hr.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()};hr.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()};hr.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision};hr.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()};hr.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")};hr.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")};hr.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")};hr.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")};hr.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")};hr.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")};hr.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures};hr.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")};hr.prototype.enableScissorTest=function(n){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(n)};hr.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};hr.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};hr.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};hr.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")};hr.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")};hr.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")};hr.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")};hr.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")};hr.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")};hr.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()};Object.defineProperties(hr.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(n){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=n}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(n){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=n}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(n){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=n===!0?Sp:Fo}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}});Object.defineProperties(Sz.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(Mc.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(n){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=n}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(n){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=n}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(n){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=n}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(n){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=n}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(n){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=n}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(n){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=n}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(n){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=n}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(n){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=n}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(n){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=n}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(n){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=n}}});DQ.prototype.load=function(n){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return new IQ().load(n,function(i){e.setBuffer(i)}),this};RC.prototype.updateCubeMap=function(n,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(n,e)};RC.prototype.clear=function(n,e,t,i){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(n,e,t,i)};h_.crossOrigin=void 0;h_.loadTexture=function(n,e,t,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const r=new yQ;r.setCrossOrigin(this.crossOrigin);const o=r.load(n,t,void 0,i);return e&&(o.mapping=e),o};h_.loadTextureCube=function(n,e,t,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const r=new vQ;r.setCrossOrigin(this.crossOrigin);const o=r.load(n,t,void 0,i);return e&&(o.mapping=e),o};h_.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};h_.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:WO}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=WO);const Yg=Math.PI/180,JL=180/Math.PI,Wz=6378137,Hz=635675231424518e-8;function ta(n,e,t,i,r,o){const c=WC(n,e,t);return KQ(c[0],c[1],c[2],i,r,o)}function _p(n,e,t,i,r,o){const c=JQ(n,e,t,i,r,o);return QQ(c[0],c[1],c[2])}function KQ(n,e,t,i,r,o){const c=WC(i,r,o),s=[n-c[0],e-c[1],t-c[2]];i=i*Yg,r=r*Yg;const d=Math.cos(i),p=Math.sin(i),g=Math.cos(r),_=Math.sin(r),x=-p*s[0]+d*s[1],b=-_*d*s[0]-_*p*s[1]+g*s[2],S=g*d*s[0]+g*p*s[1]+_*s[2];return[x,b,S]}function JQ(n,e,t,i,r,o){const c=WC(i,r,o);i=i*Yg,r=r*Yg;const s=Math.cos(i),d=Math.sin(i),p=Math.cos(r),g=Math.sin(r),_=-d*n-g*s*e+p*s*t+c[0],x=s*n-g*d*e+p*d*t+c[1],b=p*e+g*t+c[2];return[_,x,b]}function WC(n,e,t){const i=Wz,r=Hz;n=n*Yg,e=e*Yg;const o=Math.cos(n),c=Math.sin(n),s=Math.cos(e),d=Math.sin(e),p=i*i,g=r*r,_=1/Math.sqrt(p*s*s+g*d*d),x=(p*_+t)*s,b=x*o,S=x*c,P=(g*_+t)*d;return[b,S,P]}function QQ(n,e,t){const i=Wz,r=Hz,o=i*i,c=r*r,s=o-c,d=Math.sqrt(s/o),p=Math.sqrt(s/c),g=Math.sqrt(n*n+e*e),_=Math.atan2(t*i,g*r),x=Math.sin(_),b=Math.cos(_),S=Math.atan2(e,n),P=Math.atan2(t+p*p*r*x*x*x,g-d*d*i*b*b*b),L=Math.sin(P),E=Math.cos(P),C=i/Math.sqrt(1-d*d*L*L),D=g/E-C;return[S*JL,P*JL,D]}class HC{boundingBoxCorners(e,t){const i=_p(-t,-t,0,e.lng,e.lat,0),r=_p(t,t,0,e.lng,e.lat,0);return[{lat:i[1],lng:i[0]},{lat:r[1],lng:r[0]}]}rotationFromCompass(e,t){let i=0,r=0,o=0;switch(t){case 1:i=Math.PI/2;break;case 3:i=-Math.PI/2,o=Math.PI;break;case 6:r=-Math.PI/2,o=-Math.PI/2;break;case 8:r=Math.PI/2,o=Math.PI/2;break}const c=new Li().makeRotationZ(o),s=new Cp(i,r,e*Math.PI/180,"XYZ"),d=new Li().makeRotationFromEuler(s),p=new Zn().setAxisAngleFromRotationMatrix(d.multiply(c));return p.multiplyScalar(p.w).toArray().slice(0,3)}}class gx{constructor(e){if(!e)throw new Error(`Incorrect core image data ${e}`);this._cache=null,this._core=e,this._spatial=null}get assetsCached(){return this._core!=null&&this._spatial!=null&&this._cache!=null&&this._cache.image!=null&&this._cache.mesh!=null}get cameraParameters(){return this._spatial.camera_parameters}get cameraType(){return this._spatial.camera_type}get capturedAt(){return this._spatial.captured_at}get clusterId(){return this._spatial.cluster?this._spatial.cluster.id:null}get clusterUrl(){return this._spatial.cluster?this._spatial.cluster.url:null}get compassAngle(){return this._spatial.computed_compass_angle!=null?this._spatial.computed_compass_angle:this._spatial.compass_angle}get complete(){return this._spatial!=null}get computedAltitude(){return this._spatial.computed_altitude}get computedCompassAngle(){return this._spatial.computed_compass_angle}get computedLngLat(){return this._core.computed_geometry}get creatorId(){return this._spatial.creator.id}get creatorUsername(){return this._spatial.creator.username}get exifOrientation(){return this._spatial.exif_orientation}get height(){return this._spatial.height}get image(){return this._cache.image}get image$(){return this._cache.image$}get id(){return this._core.id}get lngLat(){return this._core.computed_geometry!=null?this._core.computed_geometry:this._core.geometry}get merged(){return this._spatial!=null&&this._spatial.merge_id!=null}get mergeId(){return this._spatial.merge_id}get mesh(){return this._cache.mesh}get originalAltitude(){return this._spatial.altitude}get originalCompassAngle(){return this._spatial.compass_angle}get originalLngLat(){return this._core.geometry}get ownerId(){return this._spatial.owner?this._spatial.owner.id:null}get private(){return this._spatial.private}get qualityScore(){return this._spatial.quality_score}get rotation(){return this._spatial.computed_rotation}get scale(){return this._spatial.atomic_scale}get sequenceId(){return this._core.sequence?this._core.sequence.id:null}get sequenceEdges(){return this._cache.sequenceEdges}get sequenceEdges$(){return this._cache.sequenceEdges$}get spatialEdges(){return this._cache.spatialEdges}get spatialEdges$(){return this._cache.spatialEdges$}get width(){return this._spatial.width}cacheAssets$(){return this._cache.cacheAssets$(this._spatial,this.merged).pipe(it(()=>this))}cacheImage$(){return this._cache.cacheImage$(this._spatial).pipe(it(()=>this))}cacheSequenceEdges(e){this._cache.cacheSequenceEdges(e)}cacheSpatialEdges(e){this._cache.cacheSpatialEdges(e)}dispose(){this._cache!=null&&(this._cache.dispose(),this._cache=null),this._core=null,this._spatial=null}initializeCache(e){if(this._cache!=null)throw new Error(`Image cache already initialized (${this.id}).`);this._cache=e}makeComplete(e){if(e==null)throw new Error("Fill can not be null.");this._spatial=e}resetSequenceEdges(){this._cache.resetSequenceEdges()}resetSpatialEdges(){this._cache.resetSpatialEdges()}uncache(){this._cache!=null&&(this._cache.dispose(),this._cache=null)}}class eee{constructor(e){this._disposed=!1,this._provider=e,this._image=null,this._mesh=null,this._sequenceEdges={cached:!1,edges:[]},this._spatialEdges={cached:!1,edges:[]},this._imageChanged$=new ri,this._image$=this._imageChanged$.pipe(An(null),Pi(1),gi()),this._iamgeSubscription=this._image$.subscribe(),this._sequenceEdgesChanged$=new ri,this._sequenceEdges$=this._sequenceEdgesChanged$.pipe(An(this._sequenceEdges),Pi(1),gi()),this._sequenceEdgesSubscription=this._sequenceEdges$.subscribe(()=>{}),this._spatialEdgesChanged$=new ri,this._spatialEdges$=this._spatialEdgesChanged$.pipe(An(this._spatialEdges),Pi(1),gi()),this._spatialEdgesSubscription=this._spatialEdges$.subscribe(()=>{}),this._cachingAssets$=null}get image(){return this._image}get image$(){return this._image$}get mesh(){return this._mesh}get sequenceEdges(){return this._sequenceEdges}get sequenceEdges$(){return this._sequenceEdges$}get spatialEdges(){return this._spatialEdges}get spatialEdges$(){return this._spatialEdges$}cacheAssets$(e,t){return this._cachingAssets$!=null?this._cachingAssets$:(this._cachingAssets$=Si(this._cacheImage$(e),this._cacheMesh$(e,t)).pipe(it(([i,r])=>(this._image=i,this._mesh=r,this)),ga(()=>{this._cachingAssets$=null}),Pi(1),gi()),this._cachingAssets$.pipe(wi(i=>!!i._image)).subscribe(()=>{this._imageChanged$.next(this._image)},()=>{}),this._cachingAssets$)}cacheImage$(e){if(this._image!=null)return Ai(this);const t=this._cacheImage$(e).pipe(wi(i=>!!i),Dr(i=>{this._disposeImage(),this._image=i}),it(()=>this),Pi(1),gi());return t.subscribe(()=>{this._imageChanged$.next(this._image)},()=>{}),t}cacheSequenceEdges(e){this._sequenceEdges={cached:!0,edges:e},this._sequenceEdgesChanged$.next(this._sequenceEdges)}cacheSpatialEdges(e){this._spatialEdges={cached:!0,edges:e},this._spatialEdgesChanged$.next(this._spatialEdges)}dispose(){this._iamgeSubscription.unsubscribe(),this._sequenceEdgesSubscription.unsubscribe(),this._spatialEdgesSubscription.unsubscribe(),this._disposeImage(),this._mesh=null,this._sequenceEdges={cached:!1,edges:[]},this._spatialEdges={cached:!1,edges:[]},this._imageChanged$.next(null),this._sequenceEdgesChanged$.next(this._sequenceEdges),this._spatialEdgesChanged$.next(this._spatialEdges),this._disposed=!0,this._imageAborter!=null&&(this._imageAborter(),this._imageAborter=null),this._meshAborter!=null&&(this._meshAborter(),this._meshAborter=null)}resetSequenceEdges(){this._sequenceEdges={cached:!1,edges:[]},this._sequenceEdgesChanged$.next(this._sequenceEdges)}resetSpatialEdges(){this._spatialEdges={cached:!1,edges:[]},this._spatialEdgesChanged$.next(this._spatialEdges)}_cacheImage$(e){return gr.create(t=>{const i=new Promise((o,c)=>{this._imageAborter=c}),r=e.thumb.url;if(!r){const o=e.thumb.id,c=`Incorrect thumb URL for ${e.id} (${o}, ${r})`;t.error(new Error(c));return}this._provider.getImageBuffer(r,i).then(o=>{this._imageAborter=null;const c=new Image;c.crossOrigin="Anonymous",c.onload=()=>{if(this._disposed){window.URL.revokeObjectURL(c.src);const d=`Image load was aborted (${r})`;t.error(new Error(d));return}t.next(c),t.complete()},c.onerror=()=>{this._imageAborter=null,t.error(new Error(`Failed to load image (${r})`))};const s=new Blob([o]);c.src=window.URL.createObjectURL(s)},o=>{this._imageAborter=null,t.error(o)})})}_cacheMesh$(e,t){return gr.create(i=>{if(!t){i.next(this._createEmptyMesh()),i.complete();return}const r=e.mesh.url;if(!r){const c=e.mesh.id,s=`Incorrect mesh URL for ${e.id} (${c}, ${r})`;console.warn(s),i.next(this._createEmptyMesh()),i.complete();return}const o=new Promise((c,s)=>{this._meshAborter=s});this._provider.getMesh(r,o).then(c=>{this._meshAborter=null,!this._disposed&&(i.next(c),i.complete())},c=>{this._meshAborter=null,console.error(c),i.next(this._createEmptyMesh()),i.complete()})})}_createEmptyMesh(){return{faces:[],vertices:[]}}_disposeImage(){this._image!=null&&window.URL.revokeObjectURL(this._image.src),this._image=null}}class tee{constructor(e){this._id=e.id,this._imageIds=e.image_ids}get id(){return this._id}get imageIds(){return this._imageIds}dispose(){this._id=null,this._imageIds=null}findNext(e){let t=this._imageIds.indexOf(e);return t+1>=this._imageIds.length||t===-1?null:this._imageIds[t+1]}findPrev(e){let t=this._imageIds.indexOf(e);return t===0||t===-1?null:this._imageIds[t-1]}}class iee{constructor(){this.sphericalPreferredDistance=2,this.sphericalMotion=2,this.sphericalSequencePenalty=1,this.sphericalMergeCCPenalty=4,this.stepPreferredDistance=4,this.stepMotion=3,this.stepRotation=4,this.stepSequencePenalty=2,this.stepMergeCCPenalty=6,this.similarDistance=2,this.similarRotation=3,this.turnDistance=4,this.turnMotion=2,this.turnSequencePenalty=1,this.turnMergeCCPenalty=4}}var Vt;(function(n){n[n.Next=0]="Next",n[n.Prev=1]="Prev",n[n.StepLeft=2]="StepLeft",n[n.StepRight=3]="StepRight",n[n.StepForward=4]="StepForward",n[n.StepBackward=5]="StepBackward",n[n.TurnLeft=6]="TurnLeft",n[n.TurnRight=7]="TurnRight",n[n.TurnU=8]="TurnU",n[n.Spherical=9]="Spherical",n[n.Similar=10]="Similar"})(Vt||(Vt={}));class nee{constructor(){this.steps={},this.turns={},this.spherical={},this.steps[Vt.StepForward]={direction:Vt.StepForward,motionChange:0,useFallback:!0},this.steps[Vt.StepBackward]={direction:Vt.StepBackward,motionChange:Math.PI,useFallback:!0},this.steps[Vt.StepLeft]={direction:Vt.StepLeft,motionChange:Math.PI/2,useFallback:!1},this.steps[Vt.StepRight]={direction:Vt.StepRight,motionChange:-Math.PI/2,useFallback:!1},this.turns[Vt.TurnLeft]={direction:Vt.TurnLeft,directionChange:Math.PI/2,motionChange:Math.PI/4},this.turns[Vt.TurnRight]={direction:Vt.TurnRight,directionChange:-Math.PI/2,motionChange:-Math.PI/4},this.turns[Vt.TurnU]={direction:Vt.TurnU,directionChange:Math.PI,motionChange:null},this.spherical[Vt.StepForward]={direction:Vt.StepForward,directionChange:0,next:Vt.StepLeft,prev:Vt.StepRight},this.spherical[Vt.StepBackward]={direction:Vt.StepBackward,directionChange:Math.PI,next:Vt.StepRight,prev:Vt.StepLeft},this.spherical[Vt.StepLeft]={direction:Vt.StepLeft,directionChange:Math.PI/2,next:Vt.StepBackward,prev:Vt.StepForward},this.spherical[Vt.StepRight]={direction:Vt.StepRight,directionChange:-Math.PI/2,next:Vt.StepForward,prev:Vt.StepBackward}}}class ree{constructor(){this.sphericalMinDistance=.1,this.sphericalMaxDistance=20,this.sphericalPreferredDistance=5,this.sphericalMaxItems=4,this.sphericalMaxStepTurnChange=Math.PI/8,this.rotationMaxDistance=this.turnMaxRigDistance,this.rotationMaxDirectionChange=Math.PI/6,this.rotationMaxVerticalDirectionChange=Math.PI/8,this.similarMaxDirectionChange=Math.PI/8,this.similarMaxDistance=12,this.similarMinTimeDifference=12*3600*1e3,this.stepMaxDistance=20,this.stepMaxDirectionChange=Math.PI/6,this.stepMaxDrift=Math.PI/6,this.stepPreferredDistance=4,this.turnMaxDistance=15,this.turnMaxDirectionChange=2*Math.PI/9,this.turnMaxRigDistance=.65,this.turnMinRigDirectionChange=Math.PI/6}get maxDistance(){return Math.max(this.sphericalMaxDistance,this.similarMaxDistance,this.stepMaxDistance,this.turnMaxDistance)}}class cr extends Error{constructor(e){super(e),Object.setPrototypeOf(this,cr.prototype),this.name="MapillaryError"}}class ma extends cr{constructor(e){super(e??"The argument is not valid."),Object.setPrototypeOf(this,ma.prototype),this.name="ArgumentMapillaryError"}}class vo{constructor(){this._epsilon=1e-9}azimuthalToBearing(e){return-e+Math.PI/2}degToRad(e){return Math.PI*e/180}radToDeg(e){return 180*e/Math.PI}rotationMatrix(e){let t=new Ue(e[0],e[1],e[2]),i=t.length();return i>0&&t.normalize(),new Li().makeRotationAxis(t,i)}rotate(e,t){let i=new Ue(e[0],e[1],e[2]),r=this.rotationMatrix(t);return i.applyMatrix4(r),i}opticalCenter(e,t){let i=[-e[0],-e[1],-e[2]],r=[-t[0],-t[1],-t[2]];return this.rotate(r,i)}viewingDirection(e){let t=[-e[0],-e[1],-e[2]];return this.rotate([0,0,1],t)}wrap(e,t,i){if(i<t)throw new Error("Invalid arguments: max must be larger than min.");let r=i-t;for(;e>i||e<t;)e>i?e=e-r:e<t&&(e=e+r);return e}wrapAngle(e){return this.wrap(e,-Math.PI,Math.PI)}clamp(e,t,i){return e<t?t:e>i?i:e}angleBetweenVector2(e,t,i,r){let o=Math.atan2(r,i)-Math.atan2(t,e);return this.wrapAngle(o)}angleDifference(e,t){let i=t-e;return this.wrapAngle(i)}relativeRotationAngle(e,t){let i=this.rotationMatrix([-e[0],-e[1],-e[2]]),r=this.rotationMatrix(t),c=i.multiply(r).elements,s=c[0]+c[5]+c[10];return Math.acos(Math.max(Math.min((s-1)/2,1),-1))}angleToPlane(e,t){let i=new Ue().fromArray(e),r=i.length();if(r<this._epsilon)return 0;let o=i.dot(new Ue().fromArray(t));return Math.asin(o/r)}azimuthal(e,t){const i=new Ue().fromArray(e),r=new Ue().fromArray(t),o=i.clone().dot(r),c=i.clone().sub(r.clone().multiplyScalar(o));return Math.atan2(c.y,c.x)}distanceFromLngLat(e,t,i,r){let o=6371e3,c=this.degToRad(r-t),s=this.degToRad(i-e),d=Math.sin(c/2)*Math.sin(c/2)+Math.cos(this.degToRad(t))*Math.cos(this.degToRad(r))*Math.sin(s/2)*Math.sin(s/2);return 2*o*Math.atan2(Math.sqrt(d),Math.sqrt(1-d))}}const see=new vo;function ki(n){return n==="spherical"}function Iw(n){return n==="fisheye"}function Rw(n,e,t){const i=ta(n.lng,n.lat,n.alt,t.lng,t.lat,t.alt),r=see.rotate(i,e);return[-r.x,-r.y,-r.z]}function ZC(n,e,t,i,r){const o=[];for(let d=0;d<e.length;++d){const p=e[d],g=t[d];for(let _=0;_<=i;++_)o.push([p[0]+g[0]*_/i,p[1]+g[1]*_/i])}const c=new m0;return c.up.copy(n.upVector()),c.position.copy(new Ue().fromArray(n.unprojectSfM([0,0],0))),c.lookAt(new Ue().fromArray(n.unprojectSfM([0,0],10))),c.updateMatrix(),c.updateMatrixWorld(!0),o.map(d=>{const p=n.unprojectBasic(d,1e4),g=r.worldToCamera(p,c);return[Math.abs(g[0]/g[2]),Math.abs(g[1]/g[2])]})}class oee{constructor(e,t,i){this._spatial=new vo,this._settings=e??new ree,this._directions=t??new nee,this._coefficients=i??new iee}getPotentialEdges(e,t,i){if(!e.complete)throw new ma("Image has to be full.");if(!e.merged)return[];let r=this._spatial.viewingDirection(e.rotation),o=this._spatial.angleToPlane(r.toArray(),[0,0,1]),c=[];for(let s of t){if(!s.merged||s.id===e.id)continue;let d=ta(s.lngLat.lng,s.lngLat.lat,s.computedAltitude,e.lngLat.lng,e.lngLat.lat,e.computedAltitude),p=new Ue(d[0],d[1],d[2]),g=p.length();if(g>this._settings.maxDistance&&i.indexOf(s.id)<0)continue;let _=this._spatial.angleBetweenVector2(r.x,r.y,p.x,p.y),x=this._spatial.angleToPlane(p.toArray(),[0,0,1]),b=this._spatial.viewingDirection(s.rotation),S=this._spatial.angleBetweenVector2(r.x,r.y,b.x,b.y),L=this._spatial.angleToPlane(b.toArray(),[0,0,1])-o,E=this._spatial.relativeRotationAngle(e.rotation,s.rotation),C=this._spatial.angleBetweenVector2(1,0,p.x,p.y),D=s.sequenceId!=null&&e.sequenceId!=null&&s.sequenceId===e.sequenceId,O=s.mergeId===e.mergeId,U=s.creatorId===e.creatorId,q={capturedAt:s.capturedAt,directionChange:S,distance:g,spherical:ki(s.cameraType),id:s.id,motionChange:_,rotation:E,sameMergeCC:O,sameSequence:D,sameUser:U,sequenceId:s.sequenceId,verticalDirectionChange:L,verticalMotion:x,worldMotionAzimuth:C};c.push(q)}return c}computeSequenceEdges(e,t){if(!e.complete)throw new ma("Image has to be full.");if(e.sequenceId!==t.id)throw new ma("Image and sequence does not correspond.");let i=[],r=t.findNext(e.id);r!=null&&i.push({data:{direction:Vt.Next,worldMotionAzimuth:Number.NaN},source:e.id,target:r});let o=t.findPrev(e.id);return o!=null&&i.push({data:{direction:Vt.Prev,worldMotionAzimuth:Number.NaN},source:e.id,target:o}),i}computeSimilarEdges(e,t){if(!e.complete)throw new ma("Image has to be full.");let i=ki(e.cameraType),r={};for(let s of t)if(s.sequenceId!=null&&!s.sameSequence){if(i){if(!s.spherical)continue}else if(!s.spherical&&Math.abs(s.directionChange)>this._settings.similarMaxDirectionChange)continue;s.distance>this._settings.similarMaxDistance||s.sameUser&&Math.abs(s.capturedAt-e.capturedAt)<this._settings.similarMinTimeDifference||(r[s.sequenceId]==null&&(r[s.sequenceId]=[]),r[s.sequenceId].push(s))}let o=[],c=ki(e.cameraType)?s=>s.distance:s=>this._coefficients.similarDistance*s.distance+this._coefficients.similarRotation*s.rotation;for(let s in r){if(!r.hasOwnProperty(s))continue;let d=Number.MAX_VALUE,p=null;for(let g of r[s]){let _=c(g);_<d&&(d=_,p=g)}p!=null&&o.push(p)}return o.map(s=>({data:{direction:Vt.Similar,worldMotionAzimuth:s.worldMotionAzimuth},source:e.id,target:s.id}))}computeStepEdges(e,t,i,r){if(!e.complete)throw new ma("Image has to be full.");let o=[];if(ki(e.cameraType))return o;for(let c in this._directions.steps){if(!this._directions.steps.hasOwnProperty(c))continue;let s=this._directions.steps[c],d=Number.MAX_VALUE,p=null,g=null;for(let _ of t){if(_.spherical||Math.abs(_.directionChange)>this._settings.stepMaxDirectionChange)continue;let x=this._spatial.angleDifference(s.motionChange,_.motionChange),b=this._spatial.angleDifference(_.directionChange,x),S=Math.max(Math.abs(x),Math.abs(b));if(Math.abs(S)>this._settings.stepMaxDrift)continue;let P=_.id;if(s.useFallback&&(P===i||P===r)&&(g=_),_.distance>this._settings.stepMaxDistance)continue;x=Math.sqrt(x*x+_.verticalMotion*_.verticalMotion);let L=this._coefficients.stepPreferredDistance*Math.abs(_.distance-this._settings.stepPreferredDistance)/this._settings.stepMaxDistance+this._coefficients.stepMotion*x/this._settings.stepMaxDrift+this._coefficients.stepRotation*_.rotation/this._settings.stepMaxDirectionChange+this._coefficients.stepSequencePenalty*(_.sameSequence?0:1)+this._coefficients.stepMergeCCPenalty*(_.sameMergeCC?0:1);L<d&&(d=L,p=_)}p=p??g,p!=null&&o.push({data:{direction:s.direction,worldMotionAzimuth:p.worldMotionAzimuth},source:e.id,target:p.id})}return o}computeTurnEdges(e,t){if(!e.complete)throw new ma("Image has to be full.");let i=[];if(ki(e.cameraType))return i;for(let r in this._directions.turns){if(!this._directions.turns.hasOwnProperty(r))continue;let o=this._directions.turns[r],c=Number.MAX_VALUE,s=null;for(let d of t){if(d.spherical||d.distance>this._settings.turnMaxDistance)continue;let p=o.direction!==Vt.TurnU&&d.distance<this._settings.turnMaxRigDistance&&Math.abs(d.directionChange)>this._settings.turnMinRigDirectionChange,g=this._spatial.angleDifference(o.directionChange,d.directionChange),_;if(p&&d.directionChange*o.directionChange>0&&Math.abs(d.directionChange)<Math.abs(o.directionChange))_=-Math.PI/2+Math.abs(d.directionChange);else{if(Math.abs(g)>this._settings.turnMaxDirectionChange)continue;let x=o.motionChange?this._spatial.angleDifference(o.motionChange,d.motionChange):0;x=Math.sqrt(x*x+d.verticalMotion*d.verticalMotion),_=this._coefficients.turnDistance*d.distance/this._settings.turnMaxDistance+this._coefficients.turnMotion*x/Math.PI+this._coefficients.turnSequencePenalty*(d.sameSequence?0:1)+this._coefficients.turnMergeCCPenalty*(d.sameMergeCC?0:1)}_<c&&(c=_,s=d)}s!=null&&i.push({data:{direction:o.direction,worldMotionAzimuth:s.worldMotionAzimuth},source:e.id,target:s.id})}return i}computePerspectiveToSphericalEdges(e,t){if(!e.complete)throw new ma("Image has to be full.");if(ki(e.cameraType))return[];let i=Number.MAX_VALUE,r=null;for(let o of t){if(!o.spherical)continue;let c=this._coefficients.sphericalPreferredDistance*Math.abs(o.distance-this._settings.sphericalPreferredDistance)/this._settings.sphericalMaxDistance+this._coefficients.sphericalMotion*Math.abs(o.motionChange)/Math.PI+this._coefficients.sphericalMergeCCPenalty*(o.sameMergeCC?0:1);c<i&&(i=c,r=o)}return r==null?[]:[{data:{direction:Vt.Spherical,worldMotionAzimuth:r.worldMotionAzimuth},source:e.id,target:r.id}]}computeSphericalEdges(e,t){if(!e.complete)throw new ma("Image has to be full.");if(!ki(e.cameraType))return[];let i=[],r=[],o=[];for(let g of t)if(!(g.distance>this._settings.sphericalMaxDistance))if(g.spherical){if(g.distance<this._settings.sphericalMinDistance)continue;r.push(g)}else for(let _ in this._directions.spherical){if(!this._directions.spherical.hasOwnProperty(_))continue;let x=this._directions.spherical[_],b=this._spatial.angleDifference(g.directionChange,g.motionChange),S=this._spatial.angleDifference(x.directionChange,b);if(!(Math.abs(S)>this._settings.sphericalMaxStepTurnChange)){o.push([x.direction,g]);break}}let c=Math.PI/this._settings.sphericalMaxItems,s=[],d=[];for(let g=0;g<this._settings.sphericalMaxItems;g++){let _=g/this._settings.sphericalMaxItems*2*Math.PI,x=Number.MAX_VALUE,b=null;for(let S of r){let P=this._spatial.angleDifference(_,S.motionChange);if(Math.abs(P)>c)continue;let L=Number.MAX_VALUE;for(let C of s){let D=Math.abs(this._spatial.angleDifference(C,S.motionChange));D<L&&(L=D)}if(L<=c)continue;let E=this._coefficients.sphericalPreferredDistance*Math.abs(S.distance-this._settings.sphericalPreferredDistance)/this._settings.sphericalMaxDistance+this._coefficients.sphericalMotion*Math.abs(P)/c+this._coefficients.sphericalSequencePenalty*(S.sameSequence?0:1)+this._coefficients.sphericalMergeCCPenalty*(S.sameMergeCC?0:1);E<x&&(x=E,b=S)}b!=null?(s.push(b.motionChange),i.push({data:{direction:Vt.Spherical,worldMotionAzimuth:b.worldMotionAzimuth},source:e.id,target:b.id})):d.push(_)}let p={};p[Vt.Spherical]=s,p[Vt.StepForward]=[],p[Vt.StepLeft]=[],p[Vt.StepBackward]=[],p[Vt.StepRight]=[];for(let g of d){let _=[];for(let x in this._directions.spherical){if(!this._directions.spherical.hasOwnProperty(x))continue;let b=this._directions.spherical[x],S=p[Vt.Spherical].concat(p[b.direction]).concat(p[b.prev]).concat(p[b.next]),P=Number.MAX_VALUE,L=null;for(let E of o){if(E[0]!==b.direction)continue;let C=this._spatial.angleDifference(g,E[1].motionChange);if(Math.abs(C)>c)continue;let D=Number.MAX_VALUE;for(let U of S){let q=Math.abs(this._spatial.angleDifference(U,E[1].motionChange));q<D&&(D=q)}if(D<=c)continue;let O=this._coefficients.sphericalPreferredDistance*Math.abs(E[1].distance-this._settings.sphericalPreferredDistance)/this._settings.sphericalMaxDistance+this._coefficients.sphericalMotion*Math.abs(C)/c+this._coefficients.sphericalMergeCCPenalty*(E[1].sameMergeCC?0:1);O<P&&(P=O,L=E)}L!=null&&(_.push(L),i.push({data:{direction:L[0],worldMotionAzimuth:L[1].worldMotionAzimuth},source:e.id,target:L[1].id}))}for(let x of _)p[x[0]].push(x[1].motionChange)}return i}}class ar extends cr{constructor(e){super(e),Object.setPrototypeOf(this,ar.prototype),this.name="GraphMapillaryError"}}class jy{constructor(e,t,i,r,o,c){this._api=e,this._cachedNodes={},this._cachedNodeTiles={},this._cachedSequenceNodes={},this._cachedSpatialEdges={},this._cachedTiles={},this._cachingFill$={},this._cachingFull$={},this._cachingSequenceNodes$={},this._cachingSequences$={},this._cachingSpatialArea$={},this._cachingTiles$={},this._changed$=new ri,this._filterCreator=o??new GW,this._filter=this._filterCreator.createFilter(void 0),this._filterSubject$=new ri,this._filter$=Ul(Ai(this._filter),this._filterSubject$).pipe(Pi(1),gi()),this._filterSubscription=this._filter$.subscribe(()=>{}),this._defaultAlt=2,this._edgeCalculator=r??new oee,this._graphCalculator=i??new HC,this._configuration=c??{maxSequences:50,maxUnusedImages:100,maxUnusedPreStoredImages:30,maxUnusedTiles:20},this._nodes={},this._nodeIndex=t??new jy._spatialIndex(16),this._nodeIndexTiles={},this._nodeToTile={},this._preStored={},this._requiredNodeTiles={},this._requiredSpatialArea={},this._sequences={},this._tileThreshold=20}static register(e){jy._spatialIndex=e}get api(){return this._api}get changed$(){return this._changed$}get filter$(){return this._filter$}cacheBoundingBox$(e,t){const i=this._api.data.geometry.bboxToCellIds(e,t).filter(r=>!(r in this._cachedTiles)).map(r=>r in this._cachingTiles$?this._cachingTiles$[r]:this._cacheTile$(r));return i.length===0&&i.push(Ai(this)),Fr(i).pipe(op(),qg(),Hi(()=>{const r=this._nodeIndex.search({maxX:t.lng,maxY:t.lat,minX:e.lng,minY:e.lat}).map(_=>_.node),o=[],c=[];for(const _ of r)_.complete?o.push(_):c.push(_.id);const s=[],d=200;for(;c.length>0;)s.push(c.splice(0,d));const p=Ai(o),g=s.map(_=>this._api.getSpatialImages$(_).pipe(it(x=>{const b=[];for(const S of x){if(!this.hasNode(S.node_id))continue;const L=this.getNode(S.node_id);L.complete||this._makeFull(L,S.node),b.push(L)}return b})));return fn(p,Fr(g).pipe(op()))}),CR((r,o)=>r.concat(o)))}cacheCell$(e){return(e in this._cachedTiles?Ai(this):e in this._cachingTiles$?this._cachingTiles$[e]:this._cacheTile$(e)).pipe(Hi(()=>{const i=this._cachedTiles[e];i.accessed=new Date().getTime();const r=i.nodes,o=[],c=[];for(const _ of r)_.complete?o.push(_):c.push(_.id);const s=[],d=200;for(;c.length>0;)s.push(c.splice(0,d));const p=Ai(o),g=s.map(_=>this._api.getSpatialImages$(_).pipe(it(x=>{const b=[];for(const S of x){if(!S.node){console.warn(`Image is empty (${S.node})`);continue}const P=S.node_id;if(!this.hasNode(P))continue;const L=this.getNode(P);L.complete||this._makeFull(L,S.node),b.push(L)}return b})));return fn(p,Fr(g).pipe(op()))}),CR((i,r)=>i.concat(r)))}cacheFill$(e){if(e in this._cachingFull$)throw new ar(`Cannot fill node while caching full (${e}).`);if(!this.hasNode(e))throw new ar(`Cannot fill node that does not exist in graph (${e}).`);if(e in this._cachingFill$)return this._cachingFill$[e];const t=this.getNode(e);if(t.complete)throw new ar(`Cannot fill node that is already full (${e}).`);return this._cachingFill$[e]=this._api.getSpatialImages$([e]).pipe(Dr(i=>{for(const r of i)r.node||console.warn(`Image is empty ${r.node_id}`),t.complete||this._makeFull(t,r.node),delete this._cachingFill$[r.node_id]}),it(()=>this),ga(()=>{e in this._cachingFill$&&delete this._cachingFill$[e],this._changed$.next(this)}),Ka(),gi()),this._cachingFill$[e]}cacheFull$(e){if(e in this._cachingFull$)return this._cachingFull$[e];if(this.hasNode(e))throw new ar(`Cannot cache full node that already exist in graph (${e}).`);return this._cachingFull$[e]=this._api.getImages$([e]).pipe(Dr(t=>{for(const i of t){if(!i.node)throw new ar(`Image does not exist (${e}, ${i.node}).`);const r=i.node_id;if(this.hasNode(r)){const o=this.getNode(e);o.complete||this._makeFull(o,i.node)}else{if(i.node.sequence.id==null)throw new ar(`Image has no sequence key (${e}).`);const o=new gx(i.node);this._makeFull(o,i.node);const c=this._api.data.geometry.lngLatToCellId(o.originalLngLat);this._preStore(c,o),this._setNode(o),delete this._cachingFull$[r]}}}),it(()=>this),ga(()=>{e in this._cachingFull$&&delete this._cachingFull$[e],this._changed$.next(this)}),Ka(),gi()),this._cachingFull$[e]}cacheNodeSequence$(e){if(!this.hasNode(e))throw new ar(`Cannot cache sequence edges of node that does not exist in graph (${e}).`);let t=this.getNode(e);if(t.sequenceId in this._sequences)throw new ar(`Sequence already cached (${e}), (${t.sequenceId}).`);return this._cacheSequence$(t.sequenceId)}cacheSequence$(e){if(e in this._sequences)throw new ar(`Sequence already cached (${e})`);return this._cacheSequence$(e)}cacheSequenceEdges(e){let t=this.getNode(e);if(!(t.sequenceId in this._sequences))throw new ar(`Sequence is not cached (${e}), (${t.sequenceId})`);let i=this._sequences[t.sequenceId].sequence,r=this._edgeCalculator.computeSequenceEdges(t,i);t.cacheSequenceEdges(r)}cacheSequenceNodes$(e,t){if(!this.hasSequence(e))throw new ar(`Cannot cache sequence nodes of sequence that does not exist in graph (${e}).`);if(this.hasSequenceNodes(e))throw new ar(`Sequence nodes already cached (${e}).`);const i=this.getSequence(e);if(i.id in this._cachingSequenceNodes$)return this._cachingSequenceNodes$[i.id];const r=[],o=i.imageIds.slice(),c=50;if(t&&o.length>c){const g=o.indexOf(t),_=Math.max(0,Math.min(g-c/2,o.length-c));r.push(o.splice(_,c))}const s=200;for(;o.length>0;)r.push(o.splice(0,s));let d=r.length;const p=Fr(r).pipe(Hi(g=>this._api.getImages$(g).pipe(Dr(_=>{for(const x of _){if(!x.node){console.warn(`Image empty (${x.node_id})`);continue}const b=x.node_id;if(this.hasNode(b)){const S=this.getNode(b);S.complete||this._makeFull(S,x.node)}else{x.node.sequence.id==null&&console.warn(`Sequence missing, discarding node (${x.node_id})`);const S=new gx(x.node);this._makeFull(S,x.node);const P=this._api.data.geometry.lngLatToCellId(S.originalLngLat);this._preStore(P,S),this._setNode(S)}}d--}),it(()=>this)),6),qg(),ga(()=>{delete this._cachingSequenceNodes$[i.id],d===0&&(this._cachedSequenceNodes[i.id]=!0)}),Ka(),gi());return this._cachingSequenceNodes$[i.id]=p,p}cacheSpatialArea$(e){if(!this.hasNode(e))throw new ar(`Cannot cache spatial area of node that does not exist in graph (${e}).`);if(e in this._cachedSpatialEdges)throw new ar(`Image already spatially cached (${e}).`);if(!(e in this._requiredSpatialArea))throw new ar(`Spatial area not determined (${e}).`);let t=this._requiredSpatialArea[e];if(Object.keys(t.cacheNodes).length===0)throw new ar(`Spatial nodes already cached (${e}).`);if(e in this._cachingSpatialArea$)return this._cachingSpatialArea$[e];let i=[];for(;t.cacheKeys.length>0;)i.push(t.cacheKeys.splice(0,200));let r=i.length,o=[];for(let c of i){let s=this._api.getSpatialImages$(c).pipe(Dr(d=>{for(const p of d){if(!p.node){console.warn(`Image is empty (${p.node_id})`);continue}const g=p.node_id,_=t.cacheNodes[g];if(_.complete){delete t.cacheNodes[g];continue}this._makeFull(_,p.node),delete t.cacheNodes[g]}--r===0&&delete this._cachingSpatialArea$[e]}),it(()=>this),$n(d=>{for(let p of c)p in t.all&&delete t.all[p],p in t.cacheNodes&&delete t.cacheNodes[p];throw--r===0&&delete this._cachingSpatialArea$[e],d}),ga(()=>{Object.keys(t.cacheNodes).length===0&&this._changed$.next(this)}),Ka(),gi());o.push(s)}return this._cachingSpatialArea$[e]=o,o}cacheSpatialEdges(e){if(e in this._cachedSpatialEdges)throw new ar(`Spatial edges already cached (${e}).`);let t=this.getNode(e),i=this._sequences[t.sequenceId].sequence,r=[],o=i.findPrev(t.id);o!=null&&r.push(o);let c=i.findNext(t.id);c!=null&&r.push(c);let s=this._requiredSpatialArea[e].all,d=[],p=this._filter;for(let x in s){if(!s.hasOwnProperty(x))continue;let b=s[x];p(b)&&d.push(b)}let g=this._edgeCalculator.getPotentialEdges(t,d,r),_=this._edgeCalculator.computeStepEdges(t,g,o,c);_=_.concat(this._edgeCalculator.computeTurnEdges(t,g)),_=_.concat(this._edgeCalculator.computeSphericalEdges(t,g)),_=_.concat(this._edgeCalculator.computePerspectiveToSphericalEdges(t,g)),_=_.concat(this._edgeCalculator.computeSimilarEdges(t,g)),t.cacheSpatialEdges(_),this._cachedSpatialEdges[e]=t,delete this._requiredSpatialArea[e],delete this._cachedNodeTiles[e]}cacheTiles$(e){if(e in this._cachedNodeTiles)throw new ar(`Tiles already cached (${e}).`);if(e in this._cachedSpatialEdges)throw new ar(`Spatial edges already cached so tiles considered cached (${e}).`);if(!(e in this._requiredNodeTiles))throw new ar(`Tiles have not been determined (${e}).`);let t=this._requiredNodeTiles[e];if(t.cache.length===0&&t.caching.length===0)throw new ar(`Tiles already cached (${e}).`);if(!this.hasNode(e))throw new ar(`Cannot cache tiles of node that does not exist in graph (${e}).`);let i=t.cache.slice();t.caching=this._requiredNodeTiles[e].caching.concat(i),t.cache=[];let r=[];for(let o of t.caching){const c=o in this._cachingTiles$?this._cachingTiles$[o]:this._cacheTile$(o);r.push(c.pipe(Dr(s=>{let d=t.caching.indexOf(o);d>-1&&t.caching.splice(d,1),t.caching.length===0&&t.cache.length===0&&(delete this._requiredNodeTiles[e],this._cachedNodeTiles[e]=!0)}),$n(s=>{let d=t.caching.indexOf(o);throw d>-1&&t.caching.splice(d,1),t.caching.length===0&&t.cache.length===0&&(delete this._requiredNodeTiles[e],this._cachedNodeTiles[e]=!0),s}),ga(()=>{this._changed$.next(this)}),Ka(),gi()))}return r}initializeCache(e){if(e in this._cachedNodes)throw new ar(`Image already in cache (${e}).`);const t=this.getNode(e),i=this._api.data;t.initializeCache(new eee(i));const r=new Date().getTime();this._cachedNodes[e]={accessed:r,node:t},this._updateCachedTileAccess(e,r)}isCachingFill(e){return e in this._cachingFill$}isCachingFull(e){return e in this._cachingFull$}isCachingNodeSequence(e){return this.getNode(e).sequenceId in this._cachingSequences$}isCachingSequence(e){return e in this._cachingSequences$}isCachingSequenceNodes(e){return e in this._cachingSequenceNodes$}isCachingTiles(e){return e in this._requiredNodeTiles&&this._requiredNodeTiles[e].cache.length===0&&this._requiredNodeTiles[e].caching.length>0}hasInitializedCache(e){return e in this._cachedNodes}hasNode(e){let t=new Date().getTime();return this._updateCachedNodeAccess(e,t),this._updateCachedTileAccess(e,t),e in this._nodes}hasNodeSequence(e){let i=this.getNode(e).sequenceId,r=i in this._sequences;return r&&(this._sequences[i].accessed=new Date().getTime()),r}hasSequence(e){let t=e in this._sequences;return t&&(this._sequences[e].accessed=new Date().getTime()),t}hasSequenceNodes(e){return e in this._cachedSequenceNodes}hasSpatialArea(e){if(!this.hasNode(e))throw new ar(`Spatial area nodes cannot be determined if node not in graph (${e}).`);if(e in this._cachedSpatialEdges)return!0;if(e in this._requiredSpatialArea)return Object.keys(this._requiredSpatialArea[e].cacheNodes).length===0;let t=this.getNode(e),i=this._graphCalculator.boundingBoxCorners(t.lngLat,this._tileThreshold),r=this._nodeIndex.search({maxX:i[1].lng,maxY:i[1].lat,minX:i[0].lng,minY:i[0].lat}),o={all:{},cacheKeys:[],cacheNodes:{}};for(let c of r)o.all[c.node.id]=c.node,c.node.complete||(o.cacheKeys.push(c.node.id),o.cacheNodes[c.node.id]=c.node);return this._requiredSpatialArea[e]=o,o.cacheKeys.length===0}hasTiles(e){if(e in this._cachedNodeTiles||e in this._cachedSpatialEdges)return!0;if(!this.hasNode(e))throw new ar(`Image does not exist in graph (${e}).`);let t={cache:[],caching:[]};if(e in this._requiredNodeTiles)t=this._requiredNodeTiles[e];else{const i=this.getNode(e),[r,o]=this._graphCalculator.boundingBoxCorners(i.lngLat,this._tileThreshold);t.cache=this._api.data.geometry.bboxToCellIds(r,o).filter(c=>!(c in this._cachedTiles)),t.cache.length>0&&(this._requiredNodeTiles[e]=t)}return t.cache.length===0&&t.caching.length===0}getNode(e){let t=new Date().getTime();return this._updateCachedNodeAccess(e,t),this._updateCachedTileAccess(e,t),this._nodes[e]}getSequence(e){let t=this._sequences[e];return t.accessed=new Date().getTime(),t.sequence}resetSpatialEdges(){let e=Object.keys(this._cachedSpatialEdges);for(let t of e)this._cachedSpatialEdges[t].resetSpatialEdges(),delete this._cachedSpatialEdges[t]}reset(e){const t=[];for(const i of e){if(!this.hasNode(i))throw new Error(`Image does not exist ${i}`);const r=this.getNode(i);r.resetSequenceEdges(),r.resetSpatialEdges(),t.push(r)}for(let i of Object.keys(this._cachedNodes))e.indexOf(i)===-1&&(this._cachedNodes[i].node.dispose(),delete this._cachedNodes[i]);this._cachedNodeTiles={},this._cachedSpatialEdges={},this._cachedTiles={},this._cachingFill$={},this._cachingFull$={},this._cachingSequences$={},this._cachingSpatialArea$={},this._cachingTiles$={},this._nodes={},this._nodeToTile={},this._preStored={};for(const i of t){this._nodes[i.id]=i;const r=this._api.data.geometry.lngLatToCellId(i.originalLngLat);this._preStore(r,i)}this._requiredNodeTiles={},this._requiredSpatialArea={},this._sequences={},this._nodeIndexTiles={},this._nodeIndex.clear()}setFilter(e){this._filter=this._filterCreator.createFilter(e),this._filterSubject$.next(this._filter)}uncache(e,t,i){const r={};this._addNewKeys(r,this._cachingFull$),this._addNewKeys(r,this._cachingFill$),this._addNewKeys(r,this._cachingSpatialArea$),this._addNewKeys(r,this._requiredNodeTiles),this._addNewKeys(r,this._requiredSpatialArea);for(const C of e)C in r||(r[C]=!0);const o=this._tileThreshold,c=this._graphCalculator,s=this._api.data.geometry,d=new Set(t);for(let C in r){if(!r.hasOwnProperty(C))continue;const D=this._nodes[C],[O,U]=c.boundingBoxCorners(D.lngLat,o),q=s.bboxToCellIds(O,U);for(const G of q)d.has(G)||d.add(G)}const p=[];for(let C in this._cachedTiles)!this._cachedTiles.hasOwnProperty(C)||d.has(C)||p.push([C,this._cachedTiles[C]]);const g=p.sort((C,D)=>D[1].accessed-C[1].accessed).slice(this._configuration.maxUnusedTiles).map(C=>C[0]);for(let C of g)this._uncacheTile(C,i);const _=[],x=[];for(let C in this._preStored){if(!this._preStored.hasOwnProperty(C)||C in this._cachingTiles$)continue;const D=this._preStored[C];for(let O in D)!D.hasOwnProperty(O)||O in r||D[O].sequenceId!==i&&(O in this._cachedNodes?_.push([this._cachedNodes[O],C]):x.push([O,C]))}const b=_.sort(([C],[D])=>D.accessed-C.accessed).slice(this._configuration.maxUnusedPreStoredImages).map(([C,D])=>[C.node.id,D]);this._uncachePreStored(x),this._uncachePreStored(b);const S=[];for(let C in this._cachedNodes)!this._cachedNodes.hasOwnProperty(C)||C in r||S.push(this._cachedNodes[C]);const P=S.sort((C,D)=>D.accessed-C.accessed).slice(this._configuration.maxUnusedImages);for(const C of P){C.node.uncache();const D=C.node.id;delete this._cachedNodes[D],D in this._cachedNodeTiles&&delete this._cachedNodeTiles[D],D in this._cachedSpatialEdges&&delete this._cachedSpatialEdges[D]}const L=[];for(let C in this._sequences)!this._sequences.hasOwnProperty(C)||C in this._cachingSequences$||C===i||L.push(this._sequences[C]);const E=L.sort((C,D)=>D.accessed-C.accessed).slice(this._configuration.maxSequences);for(const C of E){const D=C.sequence.id;delete this._sequences[D],D in this._cachedSequenceNodes&&delete this._cachedSequenceNodes[D],C.sequence.dispose()}}updateCells$(e){const t=this._cachedTiles,i=this._cachingTiles$;return Fr(e).pipe(Hi(r=>r in t?this._updateCell$(r):r in i?i[r].pipe($n(()=>Ai(this)),Hi(()=>this._updateCell$(r))):zi()))}unsubscribe(){this._filterSubscription.unsubscribe()}_addNewKeys(e,t){for(let i in t)!t.hasOwnProperty(i)||!this.hasNode(i)||i in e||(e[i]=!0)}_cacheSequence$(e){return e in this._cachingSequences$?this._cachingSequences$[e]:(this._cachingSequences$[e]=this._api.getSequence$(e).pipe(Dr(t=>{t?(t.id in this._sequences||(this._sequences[t.id]={accessed:new Date().getTime(),sequence:new tee(t)}),delete this._cachingSequences$[e]):console.warn(`Sequence does not exist (${e})`)}),it(()=>this),ga(()=>{e in this._cachingSequences$&&delete this._cachingSequences$[e],this._changed$.next(this)}),Ka(),gi()),this._cachingSequences$[e])}_cacheTile$(e){return this._cachingTiles$[e]=this._api.getCoreImages$(e).pipe(Dr(t=>{if(e in this._cachedTiles)return;const i=t.images;this._nodeIndexTiles[e]=[],this._cachedTiles[e]={accessed:new Date().getTime(),nodes:[]};const r=this._cachedTiles[e].nodes,o=this._removeFromPreStore(e);for(const c of i){if(!c)break;if(c.sequence.id==null){console.warn(`Sequence missing, discarding node (${c.id})`);continue}if(o!=null&&c.id in o){const p=o[c.id];delete o[c.id],r.push(p);const g={lat:p.lngLat.lat,lng:p.lngLat.lng,node:p};this._nodeIndex.insert(g),this._nodeIndexTiles[e].push(g),this._nodeToTile[p.id]=e;continue}const s=new gx(c);r.push(s);const d={lat:s.lngLat.lat,lng:s.lngLat.lng,node:s};this._nodeIndex.insert(d),this._nodeIndexTiles[e].push(d),this._nodeToTile[s.id]=e,this._setNode(s)}delete this._cachingTiles$[e]}),it(()=>this),$n(t=>{throw delete this._cachingTiles$[e],t}),Ka(),gi()),this._cachingTiles$[e]}_makeFull(e,t){t.computed_altitude==null&&(t.computed_altitude=this._defaultAlt),t.computed_rotation==null&&(t.computed_rotation=this._graphCalculator.rotationFromCompass(t.compass_angle,t.exif_orientation)),e.makeComplete(t)}_preStore(e,t){e in this._preStored||(this._preStored[e]={}),this._preStored[e][t.id]=t}_removeFromPreStore(e){let t=null;return e in this._preStored&&(t=this._preStored[e],delete this._preStored[e]),t}_setNode(e){let t=e.id;if(this.hasNode(t))throw new ar(`Image already exist (${t}).`);this._nodes[t]=e}_uncacheTile(e,t){for(let i of this._cachedTiles[e].nodes){let r=i.id;delete this._nodeToTile[r],r in this._cachedNodes&&delete this._cachedNodes[r],r in this._cachedNodeTiles&&delete this._cachedNodeTiles[r],r in this._cachedSpatialEdges&&delete this._cachedSpatialEdges[r],i.sequenceId===t?(this._preStore(e,i),i.uncache()):(delete this._nodes[r],i.sequenceId in this._cachedSequenceNodes&&delete this._cachedSequenceNodes[i.sequenceId],i.dispose())}for(let i of this._nodeIndexTiles[e])this._nodeIndex.remove(i);delete this._nodeIndexTiles[e],delete this._cachedTiles[e]}_uncachePreStored(e){let t={};for(let[i,r]of e){i in this._nodes&&delete this._nodes[i],i in this._cachedNodes&&delete this._cachedNodes[i];let o=this._preStored[r][i];o.sequenceId in this._cachedSequenceNodes&&delete this._cachedSequenceNodes[o.sequenceId],delete this._preStored[r][i],o.dispose(),t[r]=!0}for(let i in t)t.hasOwnProperty(i)&&Object.keys(this._preStored[i]).length===0&&delete this._preStored[i]}_updateCachedTileAccess(e,t){e in this._nodeToTile&&(this._cachedTiles[this._nodeToTile[e]].accessed=t)}_updateCachedNodeAccess(e,t){e in this._cachedNodes&&(this._cachedNodes[e].accessed=t)}_updateCell$(e){return this._api.getCoreImages$(e).pipe(Hi(t=>{if(!(e in this._cachedTiles))return zi();const i=this._nodeIndex,r=this._nodeIndexTiles[e],o=this._nodeToTile,c=this._cachedTiles[e];c.accessed=new Date().getTime();const s=c.nodes,d=t.images;for(const p of d){if(p==null)break;if(this.hasNode(p.id))continue;if(p.sequence.id==null){console.warn(`Sequence missing, discarding node (${p.id})`);continue}const g=new gx(p);s.push(g);const _={lat:g.lngLat.lat,lng:g.lngLat.lng,node:g};i.insert(_),r.push(_),o[g.id]=e,this._setNode(g)}return Ai(e)}),$n(t=>(console.error(t),zi())))}}class Gy{constructor(){this._hash={},this._index=new Gy._spatialIndex(16),this._indexChanged$=new ri,this._updated$=new ri}static register(e){Gy._spatialIndex=e}get changed$(){return this._indexChanged$}get updated$(){return this._updated$}add(e){const t=[],i=this._hash,r=this._index;for(const o of e){const c=o.id;c in i&&(r.remove(i[c]),t.push(o));const s={lat:o.lngLat.lat,lng:o.lngLat.lng,marker:o};i[c]=s,r.insert(s)}t.length>0&&this._updated$.next(t),e.length>t.length&&this._indexChanged$.next(this)}has(e){return e in this._hash}get(e){return this.has(e)?this._hash[e].marker:void 0}getAll(){return this._index.all().map(e=>e.marker)}remove(e){const t=this._hash,i=this._index;let r=!1;for(const o of e){if(!(o in t))continue;const c=t[o];i.remove(c),delete t[o],r=!0}r&&this._indexChanged$.next(this)}removeAll(){this._hash={},this._index.clear(),this._indexChanged$.next(this)}search([e,t]){return this._index.search({maxX:t.lng,maxY:t.lat,minX:e.lng,minY:e.lat}).map(i=>i.marker)}update(e){const t=this._hash,i=this._index,r=e.id;if(!(r in t))return;i.remove(t[r]);const o={lat:e.lngLat.lat,lng:e.lngLat.lng,marker:e};t[r]=o,i.insert(o)}}function aee(n,e,t,i,r){Zz(n,e,t||0,i||n.length-1,r||lee)}function Zz(n,e,t,i,r){for(;i>t;){if(i-t>600){var o=i-t+1,c=e-t+1,s=Math.log(o),d=.5*Math.exp(2*s/3),p=.5*Math.sqrt(s*d*(o-d)/o)*(c-o/2<0?-1:1),g=Math.max(t,Math.floor(e-c*d/o+p)),_=Math.min(i,Math.floor(e+(o-c)*d/o+p));Zz(n,e,g,_,r)}var x=n[e],b=t,S=i;for(Ov(n,t,e),r(n[i],x)>0&&Ov(n,t,i);b<S;){for(Ov(n,b,S),b++,S--;r(n[b],x)<0;)b++;for(;r(n[S],x)>0;)S--}r(n[t],x)===0?Ov(n,t,S):(S++,Ov(n,S,i)),S<=e&&(t=S+1),e<=S&&(i=S-1)}}function Ov(n,e,t){var i=n[e];n[e]=n[t],n[t]=i}function lee(n,e){return n<e?-1:n>e?1:0}class cee{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const i=[];if(!vx(e,t))return i;const r=this.toBBox,o=[];for(;t;){for(let c=0;c<t.children.length;c++){const s=t.children[c],d=t.leaf?r(s):s;vx(e,d)&&(t.leaf?i.push(s):aM(e,d)?this._all(s,i):o.push(s))}t=o.pop()}return i}collides(e){let t=this.data;if(!vx(e,t))return!1;const i=[];for(;t;){for(let r=0;r<t.children.length;r++){const o=t.children[r],c=t.leaf?this.toBBox(o):o;if(vx(e,c)){if(t.leaf||aM(e,c))return!0;i.push(o)}}t=i.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let i=0;i<e.length;i++)this.insert(e[i]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const i=this.data;this.data=t,t=i}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=pg([]),this}remove(e,t){if(!e)return this;let i=this.data;const r=this.toBBox(e),o=[],c=[];let s,d,p;for(;i||o.length;){if(i||(i=o.pop(),d=o[o.length-1],s=c.pop(),p=!0),i.leaf){const g=uee(e,i.children,t);if(g!==-1)return i.children.splice(g,1),o.push(i),this._condense(o),this}!p&&!i.leaf&&aM(i,r)?(o.push(i),c.push(s),s=0,d=i,i=i.children[0]):d?(s++,i=d.children[s],p=!1):i=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const i=[];for(;e;)e.leaf?t.push(...e.children):i.push(...e.children),e=i.pop();return t}_build(e,t,i,r){const o=i-t+1;let c=this._maxEntries,s;if(o<=c)return s=pg(e.slice(t,i+1)),sg(s,this.toBBox),s;r||(r=Math.ceil(Math.log(o)/Math.log(c)),c=Math.ceil(o/Math.pow(c,r-1))),s=pg([]),s.leaf=!1,s.height=r;const d=Math.ceil(o/c),p=d*Math.ceil(Math.sqrt(c));QL(e,t,i,p,this.compareMinX);for(let g=t;g<=i;g+=p){const _=Math.min(g+p-1,i);QL(e,g,_,d,this.compareMinY);for(let x=g;x<=_;x+=d){const b=Math.min(x+d-1,_);s.children.push(this._build(e,x,b,r-1))}}return sg(s,this.toBBox),s}_chooseSubtree(e,t,i,r){for(;r.push(t),!(t.leaf||r.length-1===i);){let o=1/0,c=1/0,s;for(let d=0;d<t.children.length;d++){const p=t.children[d],g=oM(p),_=fee(e,p)-g;_<c?(c=_,o=g<o?g:o,s=p):_===c&&g<o&&(o=g,s=p)}t=s||t.children[0]}return t}_insert(e,t,i){const r=i?e:this.toBBox(e),o=[],c=this._chooseSubtree(r,this.data,t,o);for(c.children.push(e),Jv(c,r);t>=0&&o[t].children.length>this._maxEntries;)this._split(o,t),t--;this._adjustParentBBoxes(r,o,t)}_split(e,t){const i=e[t],r=i.children.length,o=this._minEntries;this._chooseSplitAxis(i,o,r);const c=this._chooseSplitIndex(i,o,r),s=pg(i.children.splice(c,i.children.length-c));s.height=i.height,s.leaf=i.leaf,sg(i,this.toBBox),sg(s,this.toBBox),t?e[t-1].children.push(s):this._splitRoot(i,s)}_splitRoot(e,t){this.data=pg([e,t]),this.data.height=e.height+1,this.data.leaf=!1,sg(this.data,this.toBBox)}_chooseSplitIndex(e,t,i){let r,o=1/0,c=1/0;for(let s=t;s<=i-t;s++){const d=Kv(e,0,s,this.toBBox),p=Kv(e,s,i,this.toBBox),g=pee(d,p),_=oM(d)+oM(p);g<o?(o=g,r=s,c=_<c?_:c):g===o&&_<c&&(c=_,r=s)}return r||i-t}_chooseSplitAxis(e,t,i){const r=e.leaf?this.compareMinX:hee,o=e.leaf?this.compareMinY:dee,c=this._allDistMargin(e,t,i,r),s=this._allDistMargin(e,t,i,o);c<s&&e.children.sort(r)}_allDistMargin(e,t,i,r){e.children.sort(r);const o=this.toBBox,c=Kv(e,0,t,o),s=Kv(e,i-t,i,o);let d=_x(c)+_x(s);for(let p=t;p<i-t;p++){const g=e.children[p];Jv(c,e.leaf?o(g):g),d+=_x(c)}for(let p=i-t-1;p>=t;p--){const g=e.children[p];Jv(s,e.leaf?o(g):g),d+=_x(s)}return d}_adjustParentBBoxes(e,t,i){for(let r=i;r>=0;r--)Jv(t[r],e)}_condense(e){for(let t=e.length-1,i;t>=0;t--)e[t].children.length===0?t>0?(i=e[t-1].children,i.splice(i.indexOf(e[t]),1)):this.clear():sg(e[t],this.toBBox)}}function uee(n,e,t){if(!t)return e.indexOf(n);for(let i=0;i<e.length;i++)if(t(n,e[i]))return i;return-1}function sg(n,e){Kv(n,0,n.children.length,e,n)}function Kv(n,e,t,i,r){r||(r=pg(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let o=e;o<t;o++){const c=n.children[o];Jv(r,n.leaf?i(c):c)}return r}function Jv(n,e){return n.minX=Math.min(n.minX,e.minX),n.minY=Math.min(n.minY,e.minY),n.maxX=Math.max(n.maxX,e.maxX),n.maxY=Math.max(n.maxY,e.maxY),n}function hee(n,e){return n.minX-e.minX}function dee(n,e){return n.minY-e.minY}function oM(n){return(n.maxX-n.minX)*(n.maxY-n.minY)}function _x(n){return n.maxX-n.minX+(n.maxY-n.minY)}function fee(n,e){return(Math.max(e.maxX,n.maxX)-Math.min(e.minX,n.minX))*(Math.max(e.maxY,n.maxY)-Math.min(e.minY,n.minY))}function pee(n,e){const t=Math.max(n.minX,e.minX),i=Math.max(n.minY,e.minY),r=Math.min(n.maxX,e.maxX),o=Math.min(n.maxY,e.maxY);return Math.max(0,r-t)*Math.max(0,o-i)}function aM(n,e){return n.minX<=e.minX&&n.minY<=e.minY&&e.maxX<=n.maxX&&e.maxY<=n.maxY}function vx(n,e){return e.minX<=n.maxX&&e.minY<=n.maxY&&e.maxX>=n.minX&&e.maxY>=n.minY}function pg(n){return{children:n,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function QL(n,e,t,i,r){const o=[e,t];for(;o.length;){if(t=o.pop(),e=o.pop(),t-e<=i)continue;const c=e+Math.ceil((t-e)/i/2)*i;aee(n,c,e,t,r),o.push(e,c,c,t)}}class Xz extends cee{compareMinX(e,t){return e.lng-t.lng}compareMinY(e,t){return e.lat-t.lat}toBBox(e){return{minX:e.lng,minY:e.lat,maxX:e.lng,maxY:e.lat}}}class Mr{constructor(e,t){this._components={};for(const i in Mr.registeredComponents){if(!Mr.registeredComponents.hasOwnProperty(i))continue;const r=Mr.registeredComponents[i];this._components[i]={active:!1,component:new r(i,e,t)}}this._coverComponent=new Mr.registeredCoverComponent("cover",e,t),this._coverComponent.activate(),this._coverActivated=!0}static register(e){Mr.registeredComponents[e.componentName]===void 0&&(Mr.registeredComponents[e.componentName]=e)}static registerCover(e){Mr.registeredCoverComponent=e}get coverActivated(){return this._coverActivated}activateCover(){if(!this._coverActivated){this._coverActivated=!0;for(const e in this._components){if(!this._components.hasOwnProperty(e))continue;const t=this._components[e];t.active&&t.component.deactivate()}}}deactivateCover(){if(this._coverActivated){this._coverActivated=!1;for(const e in this._components){if(!this._components.hasOwnProperty(e))continue;const t=this._components[e];t.active&&t.component.activate()}}}activate(e){this._checkName(e),this._components[e].active=!0,this._coverActivated||this.get(e).activate()}configure(e,t){this._checkName(e),this.get(e).configure(t)}deactivate(e){this._checkName(e),this._components[e].active=!1,this._coverActivated||this.get(e).deactivate()}get(e){return this._components[e].component}getCover(){return this._coverComponent}remove(){this._coverComponent.deactivate();for(const e in this._components)this._components.hasOwnProperty(e)&&this._components[e].component.deactivate()}_checkName(e){if(!(e in this._components))throw new ma(`Component does not exist: ${e}`)}}Mr.registeredComponents={};var qy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function mee(n){if(n.__esModule)return n;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(n).forEach(function(t){var i=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,i.get?i:{enumerable:!0,get:function(){return n[t]}})}),e}function gee(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var _ee=Array.isArray,vee=Object.prototype.toString,XC=_ee||yee;function yee(n){return vee.call(n)==="[object Array]"}var y0="2",bee=y0;Wl.NONE=0;Wl.VTEXT=1;Wl.VNODE=2;Wl.WIDGET=3;Wl.PROPS=4;Wl.ORDER=5;Wl.INSERT=6;Wl.REMOVE=7;Wl.THUNK=8;var Yz=Wl;function Wl(n,e,t){this.type=Number(n),this.vNode=e,this.patch=t}Wl.prototype.version=bee;Wl.prototype.type="VirtualPatch";var xee=y0,b0=wee;function wee(n){return n&&n.type==="VirtualNode"&&n.version===xee}var See=y0,b1=Tee;function Tee(n){return n&&n.type==="VirtualText"&&n.version===See}var Ap=Mee;function Mee(n){return n&&n.type==="Widget"}var x1=Cee;function Cee(n){return n&&n.type==="Thunk"}var Eee=b0,Aee=b1,Pee=Ap,e3=x1,Kz=Iee;function Iee(n,e){var t=n,i=e;return e3(e)&&(i=t3(e,n)),e3(n)&&(t=t3(n,null)),{a:t,b:i}}function t3(n,e){var t=n.vnode;if(t||(t=n.vnode=n.render(e)),!(Eee(t)||Aee(t)||Pee(t)))throw new Error("thunk did not return a valid node");return t}var Jz=function(e){return typeof e=="object"&&e!==null},w1=Ree;function Ree(n){return n&&(typeof n.hook=="function"&&!n.hasOwnProperty("hook")||typeof n.unhook=="function"&&!n.hasOwnProperty("unhook"))}var i3=Jz,Lee=w1,kee=Qz;function Qz(n,e){var t;for(var i in n){i in e||(t=t||{},t[i]=void 0);var r=n[i],o=e[i];if(r!==o)if(i3(r)&&i3(o))if(n3(o)!==n3(r))t=t||{},t[i]=o;else if(Lee(o))t=t||{},t[i]=o;else{var c=Qz(r,o);c&&(t=t||{},t[i]=c)}else t=t||{},t[i]=o}for(var s in e)s in n||(t=t||{},t[s]=e[s]);return t}function n3(n){if(Object.getPrototypeOf)return Object.getPrototypeOf(n);if(n.__proto__)return n.__proto__;if(n.constructor)return n.constructor.prototype}var Dee=XC,Qr=Yz,vp=b0,r3=b1,Hx=Ap,Lw=x1,Fee=Kz,Oee=kee,zee=eB;function eB(n,e){var t={a:n};return tB(n,e,t,0),t}function tB(n,e,t,i){if(n!==e){var r=t[i],o=!1;if(Lw(n)||Lw(e))YC(n,e,t,i);else if(e==null)Hx(n)||(s3(n,t,i),r=t[i]),r=bc(r,new Qr(Qr.REMOVE,n,e));else if(vp(e))if(vp(n))if(n.tagName===e.tagName&&n.namespace===e.namespace&&n.key===e.key){var c=Oee(n.properties,e.properties);c&&(r=bc(r,new Qr(Qr.PROPS,n,c))),r=Bee(n,e,t,r,i)}else r=bc(r,new Qr(Qr.VNODE,n,e)),o=!0;else r=bc(r,new Qr(Qr.VNODE,n,e)),o=!0;else r3(e)?r3(n)?n.text!==e.text&&(r=bc(r,new Qr(Qr.VTEXT,n,e))):(r=bc(r,new Qr(Qr.VTEXT,n,e)),o=!0):Hx(e)&&(Hx(n)||(o=!0),r=bc(r,new Qr(Qr.WIDGET,n,e)));r&&(t[i]=r),o&&s3(n,t,i)}}function Bee(n,e,t,i,r){for(var o=n.children,c=Vee(o,e.children),s=c.children,d=o.length,p=s.length,g=d>p?d:p,_=0;_<g;_++){var x=o[_],b=s[_];r+=1,x?tB(x,b,t,r):b&&(i=bc(i,new Qr(Qr.INSERT,null,b))),vp(x)&&x.count&&(r+=x.count)}return c.moves&&(i=bc(i,new Qr(Qr.ORDER,n,c.moves))),i}function s3(n,e,t){nB(n,e,t),iB(n,e,t)}function iB(n,e,t){if(Hx(n))typeof n.destroy=="function"&&(e[t]=bc(e[t],new Qr(Qr.REMOVE,n,null)));else if(vp(n)&&(n.hasWidgets||n.hasThunks))for(var i=n.children,r=i.length,o=0;o<r;o++){var c=i[o];t+=1,iB(c,e,t),vp(c)&&c.count&&(t+=c.count)}else Lw(n)&&YC(n,null,e,t)}function YC(n,e,t,i){var r=Fee(n,e),o=eB(r.a,r.b);Nee(o)&&(t[i]=new Qr(Qr.THUNK,null,o))}function Nee(n){for(var e in n)if(e!=="a")return!0;return!1}function nB(n,e,t){if(vp(n)){if(n.hooks&&(e[t]=bc(e[t],new Qr(Qr.PROPS,n,$ee(n.hooks)))),n.descendantHooks||n.hasThunks)for(var i=n.children,r=i.length,o=0;o<r;o++){var c=i[o];t+=1,nB(c,e,t),vp(c)&&c.count&&(t+=c.count)}}else Lw(n)&&YC(n,null,e,t)}function $ee(n){var e={};for(var t in n)e[t]=void 0;return e}function Vee(n,e){var t=o3(e),i=t.keys,r=t.free;if(r.length===e.length)return{children:e,moves:null};var o=o3(n),c=o.keys,s=o.free;if(s.length===n.length)return{children:e,moves:null};for(var d=[],p=0,g=r.length,_=0,x=0;x<n.length;x++){var b=n[x],S;b.key?i.hasOwnProperty(b.key)?(S=i[b.key],d.push(e[S])):(S=x-_++,d.push(null)):p<g?(S=r[p++],d.push(e[S])):(S=x-_++,d.push(null))}for(var P=p>=r.length?e.length:r[p],L=0;L<e.length;L++){var E=e[L];E.key?c.hasOwnProperty(E.key)||d.push(E):L>=P&&d.push(E)}for(var C=d.slice(),D=0,O=[],U=[],q,G=0;G<e.length;){var N=e[G];for(q=C[D];q===null&&C.length;)O.push(yx(C,D,null)),q=C[D];!q||q.key!==N.key?N.key?(q&&q.key?i[q.key]!==G+1?(O.push(yx(C,D,q.key)),q=C[D],!q||q.key!==N.key?U.push({key:N.key,to:G}):D++):U.push({key:N.key,to:G}):U.push({key:N.key,to:G}),G++):q&&q.key&&O.push(yx(C,D,q.key)):(D++,G++)}for(;D<C.length;)q=C[D],O.push(yx(C,D,q&&q.key));return O.length===_&&!U.length?{children:d,moves:null}:{children:d,moves:{removes:O,inserts:U}}}function yx(n,e,t){return n.splice(e,1),{from:e,key:t}}function o3(n){for(var e={},t=[],i=n.length,r=0;r<i;r++){var o=n[r];o.key?e[o.key]=r:t.push(r)}return{keys:e,free:t}}function bc(n,e){return n?(Dee(n)?n.push(e):n=[n,e],n):e}var Uee=zee,jee=Uee,a3=Array.prototype.slice,rB=Gee;function Gee(n,e){for(("length"in n)||(n=[n]),n=a3.call(n);n.length;){var t=n.shift(),i=e(t);if(i)return i;t.childNodes&&t.childNodes.length&&(n=a3.call(t.childNodes).concat(n))}}var qee=Kg;function Kg(n,e){if(!(this instanceof Kg))return new Kg(n,e);this.data=n,this.nodeValue=n,this.length=n.length,this.ownerDocument=e||null}Kg.prototype.nodeType=8;Kg.prototype.nodeName="#comment";Kg.prototype.toString=function(){return"[object Comment]"};var Wee=Ud;function Ud(n,e){if(!(this instanceof Ud))return new Ud(n);this.data=n||"",this.length=this.data.length,this.ownerDocument=e||null}Ud.prototype.type="DOMTextNode";Ud.prototype.nodeType=3;Ud.prototype.nodeName="#text";Ud.prototype.toString=function(){return this.data};Ud.prototype.replaceData=function(e,t,i){var r=this.data,o=r.substring(0,e),c=r.substring(e+t,r.length);this.data=o+i+c,this.length=this.data.length};var sB=Hee;function Hee(n){var e=this,t=n.type;n.target||(n.target=e),e.listeners||(e.listeners={});var i=e.listeners[t];if(i)return i.forEach(function(r){n.currentTarget=e,typeof r=="function"?r(n):r.handleEvent(n)});e.parentNode&&e.parentNode.dispatchEvent(n)}var oB=Zee;function Zee(n,e){var t=this;t.listeners||(t.listeners={}),t.listeners[n]||(t.listeners[n]=[]),t.listeners[n].indexOf(e)===-1&&t.listeners[n].push(e)}var aB=Xee;function Xee(n,e){var t=this;if(t.listeners&&t.listeners[n]){var i=t.listeners[n],r=i.indexOf(e);r!==-1&&i.splice(r,1)}}var Yee=lB,Kee=["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"];function lB(n){switch(n.nodeType){case 3:return KC(n.data);case 8:return"<!--"+n.data+"-->";default:return Jee(n)}}function Jee(n){var e=[],t=n.tagName;return n.namespaceURI==="http://www.w3.org/1999/xhtml"&&(t=t.toLowerCase()),e.push("<"+t+ite(n)+tte(n)),Kee.indexOf(t)>-1?e.push(" />"):(e.push(">"),n.childNodes.length?e.push.apply(e,n.childNodes.map(lB)):n.textContent||n.innerText?e.push(KC(n.textContent||n.innerText)):n.innerHTML&&e.push(n.innerHTML),e.push("</"+t+">")),e.join("")}function Qee(n,e){var t=typeof n[e];return e==="style"&&Object.keys(n.style).length>0?!0:n.hasOwnProperty(e)&&(t==="string"||t==="boolean"||t==="number")&&e!=="nodeName"&&e!=="className"&&e!=="tagName"&&e!=="textContent"&&e!=="innerText"&&e!=="namespaceURI"&&e!=="innerHTML"}function ete(n){if(typeof n=="string")return n;var e="";return Object.keys(n).forEach(function(t){var i=n[t];t=t.replace(/[A-Z]/g,function(r){return"-"+r.toLowerCase()}),e+=t+":"+i+";"}),e}function tte(n){var e=n.dataset,t=[];for(var i in e)t.push({name:"data-"+i,value:e[i]});return t.length?cB(t):""}function cB(n){var e=[];return n.forEach(function(t){var i=t.name,r=t.value;i==="style"&&(r=ete(r)),e.push(i+'="'+nte(r)+'"')}),e.length?" "+e.join(" "):""}function ite(n){var e=[];for(var t in n)Qee(n,t)&&e.push({name:t,value:n[t]});for(var i in n._attributes)for(var r in n._attributes[i]){var o=n._attributes[i][r],c=(o.prefix?o.prefix+":":"")+r;e.push({name:c,value:o.value})}return n.className&&e.push({name:"class",value:n.className}),e.length?cB(e):""}function KC(n){var e="";return typeof n=="string"?e=n:n&&(e=n.toString()),e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function nte(n){return KC(n).replace(/"/g,"&quot;")}var JC=rB,rte=sB,ste=oB,ote=aB,ate=Yee,l3="http://www.w3.org/1999/xhtml",uB=Gr;function Gr(n,e,t){if(!(this instanceof Gr))return new Gr(n);var i=t===void 0?l3:t||null;this.tagName=i===l3?String(n).toUpperCase():n,this.nodeName=this.tagName,this.className="",this.dataset={},this.childNodes=[],this.parentNode=null,this.style={},this.ownerDocument=e||null,this.namespaceURI=i,this._attributes={},this.tagName==="INPUT"&&(this.type="text")}Gr.prototype.type="DOMElement";Gr.prototype.nodeType=1;Gr.prototype.appendChild=function(e){return e.parentNode&&e.parentNode.removeChild(e),this.childNodes.push(e),e.parentNode=this,e};Gr.prototype.replaceChild=function(e,t){e.parentNode&&e.parentNode.removeChild(e);var i=this.childNodes.indexOf(t);return t.parentNode=null,this.childNodes[i]=e,e.parentNode=this,t};Gr.prototype.removeChild=function(e){var t=this.childNodes.indexOf(e);return this.childNodes.splice(t,1),e.parentNode=null,e};Gr.prototype.insertBefore=function(e,t){e.parentNode&&e.parentNode.removeChild(e);var i=t==null?-1:this.childNodes.indexOf(t);return i>-1?this.childNodes.splice(i,0,e):this.childNodes.push(e),e.parentNode=this,e};Gr.prototype.setAttributeNS=function(e,t,i){var r=null,o=t,c=t.indexOf(":");if(c>-1&&(r=t.substr(0,c),o=t.substr(c+1)),this.tagName==="INPUT"&&t==="type")this.type=i;else{var s=this._attributes[e]||(this._attributes[e]={});s[o]={value:i,prefix:r}}};Gr.prototype.getAttributeNS=function(e,t){var i=this._attributes[e],r=i&&i[t]&&i[t].value;return this.tagName==="INPUT"&&t==="type"?this.type:typeof r!="string"?null:r};Gr.prototype.removeAttributeNS=function(e,t){var i=this._attributes[e];i&&delete i[t]};Gr.prototype.hasAttributeNS=function(e,t){var i=this._attributes[e];return!!i&&t in i};Gr.prototype.setAttribute=function(e,t){return this.setAttributeNS(null,e,t)};Gr.prototype.getAttribute=function(e){return this.getAttributeNS(null,e)};Gr.prototype.removeAttribute=function(e){return this.removeAttributeNS(null,e)};Gr.prototype.hasAttribute=function(e){return this.hasAttributeNS(null,e)};Gr.prototype.removeEventListener=ote;Gr.prototype.addEventListener=ste;Gr.prototype.dispatchEvent=rte;Gr.prototype.focus=function(){};Gr.prototype.toString=function(){return ate(this)};Gr.prototype.getElementsByClassName=function(e){var t=e.split(" "),i=[];return JC(this,function(r){if(r.nodeType===1){var o=r.className||"",c=o.split(" ");t.every(function(s){return c.indexOf(s)!==-1})&&i.push(r)}}),i};Gr.prototype.getElementsByTagName=function(e){e=e.toLowerCase();var t=[];return JC(this.childNodes,function(i){i.nodeType===1&&(e==="*"||i.tagName.toLowerCase()===e)&&t.push(i)}),t};Gr.prototype.contains=function(e){return JC(this,function(t){return e===t})||!1};var QC=uB,lte=vu;function vu(n){if(!(this instanceof vu))return new vu;this.childNodes=[],this.parentNode=null,this.ownerDocument=n||null}vu.prototype.type="DocumentFragment";vu.prototype.nodeType=11;vu.prototype.nodeName="#document-fragment";vu.prototype.appendChild=QC.prototype.appendChild;vu.prototype.replaceChild=QC.prototype.replaceChild;vu.prototype.removeChild=QC.prototype.removeChild;vu.prototype.toString=function(){return this.childNodes.map(function(e){return String(e)}).join("")};var cte=eE;function eE(n){}eE.prototype.initEvent=function(e,t,i){this.type=e,this.bubbles=t,this.cancelable=i};eE.prototype.preventDefault=function(){};var ute=rB,hte=qee,dte=Wee,x0=uB,fte=lte,pte=cte,mte=sB,gte=oB,_te=aB,vte=kw;function kw(){if(!(this instanceof kw))return new kw;this.head=this.createElement("head"),this.body=this.createElement("body"),this.documentElement=this.createElement("html"),this.documentElement.appendChild(this.head),this.documentElement.appendChild(this.body),this.childNodes=[this.documentElement],this.nodeType=9}var hl=kw.prototype;hl.createTextNode=function(e){return new dte(e,this)};hl.createElementNS=function(e,t){var i=e===null?null:String(e);return new x0(t,this,i)};hl.createElement=function(e){return new x0(e,this)};hl.createDocumentFragment=function(){return new fte(this)};hl.createEvent=function(e){return new pte};hl.createComment=function(e){return new hte(e,this)};hl.getElementById=function(e){e=String(e);var t=ute(this.childNodes,function(i){if(String(i.id)===e)return i});return t||null};hl.getElementsByClassName=x0.prototype.getElementsByClassName;hl.getElementsByTagName=x0.prototype.getElementsByTagName;hl.contains=x0.prototype.contains;hl.removeEventListener=_te;hl.addEventListener=gte;hl.dispatchEvent=mte;var yte=vte,bte=new yte,c3=typeof qy<"u"?qy:typeof window<"u"?window:{},xte=bte,Qv;typeof document<"u"?Qv=document:(Qv=c3["__GLOBAL_DOCUMENT_CACHE@4"],Qv||(Qv=c3["__GLOBAL_DOCUMENT_CACHE@4"]=xte));var hB=Qv,m2=Jz,dB=w1,fB=wte;function wte(n,e,t){for(var i in e){var r=e[i];r===void 0?u3(n,i,r,t):dB(r)?(u3(n,i,r,t),r.hook&&r.hook(n,i,t?t[i]:void 0)):m2(r)?Ste(n,e,t,i,r):n[i]=r}}function u3(n,e,t,i){if(i){var r=i[e];if(dB(r))r.unhook&&r.unhook(n,e,t);else if(e==="attributes")for(var o in r)n.removeAttribute(o);else if(e==="style")for(var c in r)n.style[c]="";else typeof r=="string"?n[e]="":n[e]=null}}function Ste(n,e,t,i,r){var o=t?t[i]:void 0;if(i==="attributes"){for(var c in r){var s=r[c];s===void 0?n.removeAttribute(c):n.setAttribute(c,s)}return}if(o&&m2(o)&&h3(o)!==h3(r)){n[i]=r;return}m2(n[i])||(n[i]={});var d=i==="style"?"":void 0;for(var p in r){var g=r[p];n[i][p]=g===void 0?d:g}}function h3(n){if(Object.getPrototypeOf)return Object.getPrototypeOf(n);if(n.__proto__)return n.__proto__;if(n.constructor)return n.constructor.prototype}var d3=hB,Tte=fB,Mte=b0,Cte=b1,Ete=Ap,Ate=Kz,pB=mB;function mB(n,e){var t=e&&e.document||d3,i=e?e.warn:null;if(n=Ate(n).a,Ete(n))return n.init();if(Cte(n))return t.createTextNode(n.text);if(!Mte(n))return i&&i("Item is not a valid virtual dom node",n),null;var r=n.namespace===null?t.createElement(n.tagName):t.createElementNS(n.namespace,n.tagName),o=n.properties;Tte(r,o);for(var c=n.children,s=0;s<c.length;s++){var d=mB(c[s],e);d&&r.appendChild(d)}return r}var Pte={},Ite=Rte;function Rte(n,e,t,i){return!t||t.length===0?{}:(t.sort(Lte),gB(n,e,t,i,0))}function gB(n,e,t,i,r){if(i=i||{},n){f3(t,r,r)&&(i[r]=n);var o=e.children;if(o)for(var c=n.childNodes,s=0;s<e.children.length;s++){r+=1;var d=o[s]||Pte,p=r+(d.count||0);f3(t,r,p)&&gB(c[s],d,t,i,r),r=p}}return i}function f3(n,e,t){if(n.length===0)return!1;for(var i=0,r=n.length-1,o,c;i<=r;){if(o=(r+i)/2>>0,c=n[o],i===r)return c>=e&&c<=t;if(c<e)i=o+1;else if(c>t)r=o-1;else return!0}return!1}function Lte(n,e){return n>e?1:-1}var p3=Ap,kte=Dte;function Dte(n,e){return p3(n)&&p3(e)?"name"in n&&"name"in e?n.id===e.id:n.init===e.init:!1}var Fte=fB,Ote=Ap,vd=Yz,zte=kte,Bte=Nte;function Nte(n,e,t){var i=n.type,r=n.vNode,o=n.patch;switch(i){case vd.REMOVE:return $te(e,r);case vd.INSERT:return Vte(e,o,t);case vd.VTEXT:return Ute(e,r,o,t);case vd.WIDGET:return jte(e,r,o,t);case vd.VNODE:return Gte(e,r,o,t);case vd.ORDER:return qte(e,o),e;case vd.PROPS:return Fte(e,o,r.properties),e;case vd.THUNK:return Wte(e,t.patch(e,o,t));default:return e}}function $te(n,e){var t=n.parentNode;return t&&t.removeChild(n),_B(n,e),null}function Vte(n,e,t){var i=t.render(e,t);return n&&n.appendChild(i),n}function Ute(n,e,t,i){var r;if(n.nodeType===3)n.replaceData(0,n.length,t.text),r=n;else{var o=n.parentNode;r=i.render(t,i),o&&r!==n&&o.replaceChild(r,n)}return r}function jte(n,e,t,i){var r=zte(e,t),o;r?o=t.update(e,n)||n:o=i.render(t,i);var c=n.parentNode;return c&&o!==n&&c.replaceChild(o,n),r||_B(n,e),o}function Gte(n,e,t,i){var r=n.parentNode,o=i.render(t,i);return r&&o!==n&&r.replaceChild(o,n),o}function _B(n,e){typeof e.destroy=="function"&&Ote(e)&&e.destroy(n)}function qte(n,e){for(var t=n.childNodes,i={},r,o,c,s=0;s<e.removes.length;s++)o=e.removes[s],r=t[o.from],o.key&&(i[o.key]=r),n.removeChild(r);for(var d=t.length,p=0;p<e.inserts.length;p++)c=e.inserts[p],r=i[c.key],n.insertBefore(r,c.to>=d++?null:t[c.to])}function Wte(n,e){return n&&e&&n!==e&&n.parentNode&&n.parentNode.replaceChild(e,n),e}var Hte=hB,Zte=XC,Xte=pB,Yte=Ite,m3=Bte,Kte=vB;function vB(n,e,t){return t=t||{},t.patch=t.patch&&t.patch!==vB?t.patch:Jte,t.render=t.render||Xte,t.patch(n,e,t)}function Jte(n,e,t){var i=eie(e);if(i.length===0)return n;var r=Yte(n,e.a,i),o=n.ownerDocument;!t.document&&o!==Hte&&(t.document=o);for(var c=0;c<i.length;c++){var s=i[c];n=Qte(n,r[s],e[s],t)}return n}function Qte(n,e,t,i){if(!e)return n;var r;if(Zte(t))for(var o=0;o<t.length;o++)r=m3(t[o],e,i),e===n&&(n=r);else r=m3(t,e,i),e===n&&(n=r);return n}function eie(n){var e=[];for(var t in n)t!=="a"&&e.push(Number(t));return e}var tie=Kte,iie=tie,nie=y0,rie=b0,sie=Ap,oie=x1,aie=w1,yB=tE,lie={},cie=[];function tE(n,e,t,i,r){this.tagName=n,this.properties=e||lie,this.children=t||cie,this.key=i!=null?String(i):void 0,this.namespace=typeof r=="string"?r:null;var o=t&&t.length||0,c=0,s=!1,d=!1,p=!1,g;for(var _ in e)if(e.hasOwnProperty(_)){var x=e[_];aie(x)&&x.unhook&&(g||(g={}),g[_]=x)}for(var b=0;b<o;b++){var S=t[b];rie(S)?(c+=S.count||0,!s&&S.hasWidgets&&(s=!0),!d&&S.hasThunks&&(d=!0),!p&&(S.hooks||S.descendantHooks)&&(p=!0)):!s&&sie(S)?typeof S.destroy=="function"&&(s=!0):!d&&oie(S)&&(d=!0)}this.count=o+c,this.hasWidgets=s,this.hasThunks=d,this.hooks=g,this.descendantHooks=p}tE.prototype.version=nie;tE.prototype.type="VirtualNode";var uie=y0,bB=iE;function iE(n){this.text=String(n)}iE.prototype.version=uie;iE.prototype.type="VirtualText";var hie=(function(e){var t=String.prototype.split,i=/()??/.exec("")[1]===e,r;return r=function(o,_,s){if(Object.prototype.toString.call(_)!=="[object RegExp]")return t.call(o,_,s);var d=[],p=(_.ignoreCase?"i":"")+(_.multiline?"m":"")+(_.extended?"x":"")+(_.sticky?"y":""),g=0,_=new RegExp(_.source,p+"g"),x,b,S,P;for(o+="",i||(x=new RegExp("^"+_.source+"$(?!\\s)",p)),s=s===e?-1>>>0:s>>>0;(b=_.exec(o))&&(S=b.index+b[0].length,!(S>g&&(d.push(o.slice(g,b.index)),!i&&b.length>1&&b[0].replace(x,function(){for(var L=1;L<arguments.length-2;L++)arguments[L]===e&&(b[L]=e)}),b.length>1&&b.index<o.length&&Array.prototype.push.apply(d,b.slice(1)),P=b[0].length,g=S,d.length>=s)));)_.lastIndex===b.index&&_.lastIndex++;return g===o.length?(P||!_.test(""))&&d.push(""):d.push(o.slice(g)),d.length>s?d.slice(0,s):d},r})(),die=hie,fie=/([\.#]?[a-zA-Z0-9\u007F-\uFFFF_:-]+)/,pie=/^\.|#/,mie=gie;function gie(n,e){if(!n)return"DIV";var t=!e.hasOwnProperty("id"),i=die(n,fie),r=null;pie.test(i[1])&&(r="DIV");var o,c,s,d;for(d=0;d<i.length;d++)c=i[d],c&&(s=c.charAt(0),r?s==="."?(o=o||[],o.push(c.substring(1,c.length))):s==="#"&&t&&(e.id=c.substring(1,c.length)):r=c);return o&&(e.className&&o.push(e.className),e.className=o.join(" ")),e.namespace?r:r.toUpperCase()}var _ie=Dw;function Dw(n){if(!(this instanceof Dw))return new Dw(n);this.value=n}Dw.prototype.hook=function(n,e){n[e]!==this.value&&(n[e]=this.value)};var lM=typeof window<"u"?window:typeof qy<"u"?qy:{},vie=yie;function yie(n,e){return n in lM?lM[n]:(lM[n]=e,e)}var g3=vie,bie=xie;function xie(n,e,t){var i="__INDIVIDUAL_ONE_VERSION_"+n,r=i+"_ENFORCE_SINGLETON",o=g3(r,e);if(o!==e)throw new Error("Can only have one copy of "+n+`.
You already have version `+o+` installed.
This means you cannot install version `+e);return g3(i,t)}var wie=bie,xB="7";wie("ev-store",xB);var _3="__EV_STORE_KEY@"+xB,Sie=Tie;function Tie(n){var e=n[_3];return e||(e=n[_3]={}),e}var wB=Sie,Mie=Wy;function Wy(n){if(!(this instanceof Wy))return new Wy(n);this.value=n}Wy.prototype.hook=function(n,e){var t=wB(n),i=e.substr(3);t[i]=this.value};Wy.prototype.unhook=function(n,e){var t=wB(n),i=e.substr(3);t[i]=void 0};var SB=XC,Cie=yB,v3=bB,Eie=b0,Aie=b1,Pie=Ap,TB=w1,Iie=x1,Rie=mie,Lie=_ie,kie=Mie,Die=Fie;function Fie(n,e,t){var i=[],r,o,c,s;return!t&&zie(e)&&(t=e,o={}),o=o||e||{},r=Rie(n,o),o.hasOwnProperty("key")&&(c=o.key,o.key=void 0),o.hasOwnProperty("namespace")&&(s=o.namespace,o.namespace=void 0),r==="INPUT"&&!s&&o.hasOwnProperty("value")&&o.value!==void 0&&!TB(o.value)&&(o.value=Lie(o.value)),Oie(o),t!=null&&MB(t,i,r,o),new Cie(r,o,i,c,s)}function MB(n,e,t,i){if(typeof n=="string")e.push(new v3(n));else if(typeof n=="number")e.push(new v3(String(n)));else if(CB(n))e.push(n);else if(SB(n))for(var r=0;r<n.length;r++)MB(n[r],e,t,i);else{if(n==null)return;throw Bie({foreignObject:n,parentVnode:{tagName:t,properties:i}})}}function Oie(n){for(var e in n)if(n.hasOwnProperty(e)){var t=n[e];if(TB(t))continue;e.substr(0,3)==="ev-"&&(n[e]=kie(t))}}function CB(n){return Eie(n)||Aie(n)||Pie(n)||Iie(n)}function zie(n){return typeof n=="string"||SB(n)||CB(n)}function Bie(n){var e=new Error;return e.type="virtual-hyperscript.unexpected.virtual-element",e.message=`Unexpected virtual child passed to h().
Expected a VNode / Vthunk / VWidget / string but:
got:
`+y3(n.foreignObject)+`.
The parent vnode is:
`+y3(n.parentVnode),e.foreignObject=n.foreignObject,e.parentVnode=n.parentVnode,e}function y3(n){try{return JSON.stringify(n,null,"    ")}catch{return String(n)}}var Nie=Die,$ie=Nie,Vie=pB,Uie=Vie,jie=jee,Gie=iie,qie=$ie,Wie=Uie,Hie=yB,Zie=bB,Gt={diff:jie,patch:Gie,h:qie,create:Wie,VNode:Hie,VText:Zie};class S1{constructor(){this._events={}}fire(e,t){if(this._listens(e))for(const i of this._events[e])i(t)}off(e,t){if(!e){this._events={};return}if(this._listens(e)){const i=this._events[e].indexOf(t);i>=0&&this._events[e].splice(i,1),this._events[e].length||delete this._events[e]}}on(e,t){this._events[e]=this._events[e]||[],this._events[e].push(t)}_listens(e){return e in this._events}}class yo{constructor(){this._subscriptions=[]}push(e){this._subscriptions.push(e)}unsubscribe(){for(const e of this._subscriptions)e.unsubscribe();this._subscriptions=[]}}class bo extends S1{constructor(e,t,i){super(),this._activated$=new Ah(!1),this._configurationSubject$=new ri,this._activated=!1,this._container=t,this._name=e,this._navigator=i,this._subscriptions=new yo,this._configuration$=this._configurationSubject$.pipe(An(this.defaultConfiguration),Vr((r,o)=>{for(let c in o)o.hasOwnProperty(c)&&(r[c]=o[c]);return r}),Pi(1),gi()),this._configuration$.subscribe(()=>{})}get activated(){return this._activated}get activated$(){return this._activated$}get defaultConfiguration(){return this._getDefaultConfiguration()}get configuration$(){return this._configuration$}get name(){return this._name}activate(e){this._activated||(e!==void 0&&this._configurationSubject$.next(e),this._activated=!0,this._activate(),this._activated$.next(!0))}configure(e){this._configurationSubject$.next(e)}deactivate(){this._activated&&(this._activated=!1,this._deactivate(),this._container.domRenderer.clear(this._name),this._container.glRenderer.clear(this._name),this._activated$.next(!1))}fire(e,t){super.fire(e,t)}off(e,t){super.off(e,t)}on(e,t){super.on(e,t)}resize(){}}var Qo;(function(n){n[n.Hidden=0]="Hidden",n[n.Loading=1]="Loading",n[n.Visible=2]="Visible"})(Qo||(Qo={}));class EB extends bo{constructor(e,t,i){super(e,t,i)}_activate(){const e=this.configuration$.pipe(wi(i=>!!i.id),oi(i=>!i.src),ei(i=>this._getImageSrc$(i.id).pipe($n(r=>(console.error(r),zi())))),Pi(1),gi()),t=this._subscriptions;t.push(e.pipe(it(i=>({src:i}))).subscribe(i=>{this._configurationSubject$.next(i)})),t.push(Si(this.configuration$,e).pipe(oi(([i,r])=>!!i.src&&i.src!==r),wi()).subscribe(([,i])=>{window.URL.revokeObjectURL(i)})),t.push(this._configuration$.pipe(yi(void 0,i=>i.state),ei(i=>Si(Ai(i.state),this._navigator.stateService.currentImage$)),ei(([i,r])=>{const o=Si(Ai(r.id),r.image$.pipe(oi(c=>!!c),it(c=>c.src)));return i===Qo.Visible?o.pipe(wi()):o}),yi(([i,r],[o,c])=>i===o&&r===c),it(([i,r])=>({id:i,src:r}))).subscribe(this._configurationSubject$)),t.push(Si(this._configuration$,this._container.configurationService.exploreUrl$,this._container.renderService.size$).pipe(it(([i,r,o])=>{if(!i.src)return{name:this._name,vNode:Gt.h("div",[])};const c=o.width<=640||o.height<=480?".mapillary-cover-compact":"";if(i.state===Qo.Hidden){const d=Gt.h("div.mapillary-cover-container.mapillary-cover-done"+c,[this._getCoverBackgroundVNode(i)]);return{name:this._name,vNode:d}}const s=Gt.h("div.mapillary-cover-container"+c,[this._getCoverButtonVNode(i,r)]);return{name:this._name,vNode:s}})).subscribe(this._container.domRenderer.render$))}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{state:Qo.Visible}}_getCoverButtonVNode(e,t){const i=e.state===Qo.Loading?"div.mapillary-cover.mapillary-cover-loading":"div.mapillary-cover",r=Gt.h("div.mapillary-cover-button",[Gt.h("div.mapillary-cover-button-icon",[])]),o=Gt.h("a.mapillary-cover-logo",{href:t,target:"_blank"},[]),c=Gt.h("div.mapillary-cover-indicator",{onclick:()=>{this.configure({state:Qo.Loading})}},[]);return Gt.h(i,[this._getCoverBackgroundVNode(e),c,r,o])}_getCoverBackgroundVNode(e){const t={style:{backgroundImage:`url(${e.src})`}},i=[];return e.state===Qo.Loading&&i.push(Gt.h("div.mapillary-cover-spinner",{},[])),Gt.h("div.mapillary-cover-background",t,i)}_getImageSrc$(e){return gr.create(t=>{this._navigator.api.getImages$([e]).subscribe(i=>{for(const r of i){const o=typeof e=="number"?e.toString():e;if(r.node_id===o){this._navigator.api.data.getImageBuffer(r.node.thumb.url).then(c=>{const s=new Image;s.crossOrigin="Anonymous",s.onload=()=>{t.next(s.src),t.complete()},s.onerror=()=>{t.error(new Error(`Failed to load cover image (${e})`))};const d=new Blob([c]);s.src=window.URL.createObjectURL(d)},c=>{t.error(c)});return}}t.error(new cr(`Non existent cover key: ${e}`))},i=>{t.error(i)})})}}EB.componentName="cover";class AB extends bo{_activate(){this._subscriptions.push(Si(this._container.configurationService.exploreUrl$,this._navigator.stateService.currentImage$,this._container.renderService.size$).pipe(it(([e,t,i])=>{const r=this._makeAttribution(t.creatorUsername,e,t.id,t.capturedAt,i.width);return{name:this._name,vNode:r}})).subscribe(this._container.domRenderer.render$))}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{}}makeImageUrl(e,t){return`${e}/app/?pKey=${t}&focus=photo`}_makeAttribution(e,t,i,r,o){const c=o<=640,s=this._makeDate(r,c),d=this._makeBy(e,t,i,c),p=c?".mapillary-attribution-compact":"";return Gt.h("div.mapillary-attribution-container"+p,{},[...d,s])}_makeBy(e,t,i,r){const o=Gt.h("div.mapillary-attribution-logo",[]);return e?this._makeCreatorBy(o,e,t,i,r):this._makeGeneralBy(o,t,i,r)}_makeCreatorBy(e,t,i,r,o){const c=Gt.h("a.mapillary-attribution-icon-container",{href:i,rel:"noreferrer",target:"_blank"},[e]),s=o?`${t}`:`image by ${t}`,d=Gt.h("div.mapillary-attribution-username",{textContent:s},[]),p=Gt.h("a.mapillary-attribution-image-container",{href:this.makeImageUrl(i,r),rel:"noreferrer",target:"_blank"},[d]);return[c,p]}_makeGeneralBy(e,t,i,r){const o=Gt.h("div.mapillary-attribution-username",{textContent:"images by"},[]),c=Gt.h("div.mapillary-attribution-icon-container",{},[e]),s=Gt.h("div.mapillary-attribution-username",{textContent:"contributors"},[]),d=[c,s];return r||d.unshift(o),[Gt.h("a.mapillary-attribution-image-container",{href:this.makeImageUrl(t,i),rel:"noreferrer",target:"_blank"},d)]}_makeDate(e,t){const i=new Date(e).toDateString().split(" "),r=(i.length>3?t?[i[3]]:[i[1],i[2]+",",i[3]]:i).join(" ");return Gt.h("div.mapillary-attribution-date",{textContent:r},[])}}AB.componentName="attribution";class zo{constructor(){this._unprojectDepth=200}basicToCanvas(e,t,i,r,o){const c=r.unprojectBasic([e,t],this._unprojectDepth);return this.projectToCanvas(c,i,o)}basicToCanvasSafe(e,t,i,r,o){const c=this.basicToViewportSafe(e,t,r,o);return c===null?null:this.viewportToCanvas(c[0],c[1],i)}basicToViewport(e,t,i,r){const o=i.unprojectBasic([e,t],this._unprojectDepth);return this.projectToViewport(o,r)}basicToViewportSafe(e,t,i,r){const o=i.unprojectBasic([e,t],this._unprojectDepth);return this.worldToCamera(o,r)[2]>0?null:this.projectToViewport(o,r)}cameraToViewport(e,t){const i=new Ue().fromArray(e).applyMatrix4(t.projectionMatrix);return[i.x,i.y]}canvasPosition(e,t){const i=t.getBoundingClientRect(),r=e.clientX-i.left-t.clientLeft,o=e.clientY-i.top-t.clientTop;return[r,o]}canvasToBasic(e,t,i,r,o){const c=this.unprojectFromCanvas(e,t,i,o).toArray();return r.projectBasic(c)}canvasToViewport(e,t,i){const[r,o]=this.containerToCanvas(i),c=2*e/r-1,s=1-2*t/o;return[c,s]}containerToCanvas(e){return[e.offsetWidth,e.offsetHeight]}getBasicDistances(e,t){const i=this.viewportToBasic(-1,1,e,t),r=this.viewportToBasic(1,1,e,t),o=this.viewportToBasic(1,-1,e,t),c=this.viewportToBasic(-1,-1,e,t);let s=0,d=0,p=0,g=0;return i[1]<0&&r[1]<0&&(s=i[1]>r[1]?-i[1]:-r[1]),r[0]>1&&o[0]>1&&(d=r[0]<o[0]?r[0]-1:o[0]-1),o[1]>1&&c[1]>1&&(p=o[1]<c[1]?o[1]-1:c[1]-1),c[0]<0&&i[0]<0&&(g=c[0]>i[0]?-c[0]:-i[0]),[s,d,p,g]}getPixelDistances(e,t,i){const r=this.viewportToBasic(-1,1,t,i),o=this.viewportToBasic(1,1,t,i),c=this.viewportToBasic(1,-1,t,i),s=this.viewportToBasic(-1,-1,t,i);let d=0,p=0,g=0,_=0;const[x,b]=this.containerToCanvas(e);if(r[1]<0&&o[1]<0){const S=r[1]>o[1]?r[0]:o[0],P=this.basicToCanvas(S,0,e,t,i);d=P[1]>0?P[1]:0}if(o[0]>1&&c[0]>1){const S=o[0]<c[0]?o[1]:c[1],P=this.basicToCanvas(1,S,e,t,i);p=P[0]<x?x-P[0]:0}if(c[1]>1&&s[1]>1){const S=c[1]<s[1]?c[0]:s[0],P=this.basicToCanvas(S,1,e,t,i);g=P[1]<b?b-P[1]:0}if(s[0]<0&&r[0]<0){const S=s[0]>r[0]?s[1]:r[1],P=this.basicToCanvas(0,S,e,t,i);_=P[0]>0?P[0]:0}return[d,p,g,_]}insideElement(e,t){const i=t.getBoundingClientRect(),r=i.left+t.clientLeft,o=r+t.clientWidth,c=i.top+t.clientTop,s=c+t.clientHeight;return e.clientX>r&&e.clientX<o&&e.clientY>c&&e.clientY<s}projectToCanvas(e,t,i){const r=this.projectToViewport(e,i);return this.viewportToCanvas(r[0],r[1],t)}projectToCanvasSafe(e,t,i){if(this.worldToCamera(e,i)[2]>0)return null;const o=this.projectToViewport(e,i);return this.viewportToCanvas(o[0],o[1],t)}projectToViewport(e,t){const i=new Ue(e[0],e[1],e[2]).project(t);return[i.x,i.y]}unprojectFromCanvas(e,t,i,r){const o=this.canvasToViewport(e,t,i);return this.unprojectFromViewport(o[0],o[1],r)}unprojectFromViewport(e,t,i){return new Ue(e,t,1).unproject(i)}viewportToBasic(e,t,i,r){const o=new Ue(e,t,1).unproject(r).toArray();return i.projectBasic(o)}viewportToCanvas(e,t,i){const[r,o]=this.containerToCanvas(i),c=r*(e+1)/2,s=-o*(t-1)/2;return[c,s]}worldToCamera(e,t){return new Ue(e[0],e[1],e[2]).applyMatrix4(t.matrixWorldInverse).toArray()}}var kd;(function(n){n[n.Automatic=0]="Automatic",n[n.Large=1]="Large",n[n.Small=2]="Small"})(kd||(kd={}));class PB extends bo{constructor(e,t,i){super(e,t,i),this._spatial=new vo,this._viewportCoords=new zo,this._svgNamespace="http://www.w3.org/2000/svg",this._distinctThreshold=Math.PI/360,this._animationSpeed=.075}_activate(){const e=this._subscriptions,t=this._container.renderService.renderCamera$.pipe(it(d=>{let p=this._spatial.degToRad(d.perspective.fov),g=d.perspective.aspect===Number.POSITIVE_INFINITY?Math.PI:Math.atan(d.perspective.aspect*Math.tan(.5*p))*2;return[this._spatial.azimuthalToBearing(d.rotation.phi),g]}),yi((d,p)=>Math.abs(p[0]-d[0])<this._distinctThreshold&&Math.abs(p[1]-d[1])<this._distinctThreshold)),i=Si(this._navigator.stateService.currentState$.pipe(yi(void 0,d=>d.state.currentImage.id)),this._navigator.panService.panImages$).pipe(it(([d,p])=>{const g=d.state.currentImage,_=d.state.currentTransform;if(ki(g.cameraType))return[Math.PI,Math.PI];const x=this._computeProjectedPoints(_),b=this._spatial.degToRad(this._computeHorizontalFov(x));let S=b/2,P=b/2;for(const[L,,E]of p){const C=this._spatial.wrap(L.compassAngle-g.compassAngle,-180,180);C<0?S=this._spatial.degToRad(Math.abs(C))+E/2:P=this._spatial.degToRad(Math.abs(C))+E/2}return[S,P]}),yi(([d,p],[g,_])=>Math.abs(g-d)<this._distinctThreshold&&Math.abs(_-p)<this._distinctThreshold)),r=Si(this._navigator.stateService.currentState$.pipe(yi(void 0,d=>d.state.currentImage.id)),this._container.renderService.bearing$).pipe(it(([d,p])=>this._spatial.degToRad(d.state.currentImage.compassAngle-p))),o=new ri,c=o.pipe(Vr((d,p)=>p(d),{alpha:0,curr:[0,0,0],prev:[0,0,0]}),it(d=>{const p=Hg.smootherstep(d.alpha,0,1),g=d.curr,_=d.prev;return[this._interpolate(_[0],g[0],p),this._interpolate(_[1],g[1],p)]}));e.push(i.pipe(it(d=>p=>{const g=Hg.smootherstep(p.alpha,0,1),_=p.curr,x=p.prev,b=[this._interpolate(x[0],_[0],g),this._interpolate(x[1],_[1],g)];return{alpha:0,curr:d.slice(),prev:b}})).subscribe(o)),e.push(i.pipe(ei(()=>this._container.renderService.renderCameraFrame$.pipe(Ys(1),Vr(d=>d+this._animationSpeed,0),qO(d=>d<=1+this._animationSpeed),it(d=>Math.min(d,1)))),it(d=>p=>({alpha:d,curr:p.curr.slice(),prev:p.prev.slice()}))).subscribe(o));const s=Si(r,c).pipe(it(([d,p])=>[d,p[0],p[1]]));e.push(Si(t,s,this._configuration$,this._container.renderService.size$).pipe(it(([[d,p],[g,_,x],b,S])=>{const P=this._createBackground(d),L=this._createFovIndicator(_,x,g),E=this._createNorth(d),C=this._createCircleSectorCompass(this._createCircleSector(Math.max(Math.PI/20,p),"#FFF")),D=b.size===kd.Small||b.size===kd.Automatic&&S.width<640?".mapillary-bearing-compact":"";return{name:this._name,vNode:Gt.h("div.mapillary-bearing-indicator-container"+D,{oncontextmenu:O=>{O.preventDefault()}},[P,L,E,C])}})).subscribe(this._container.domRenderer.render$))}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{size:kd.Automatic}}_createFovIndicator(e,t,i){const r=this._createFovArc(e,t),o=Gt.h("g",{attributes:{transform:"translate(18,18)"},namespace:this._svgNamespace},[r]);return Gt.h("svg",{attributes:{viewBox:"0 0 36 36"},namespace:this._svgNamespace,style:{height:"36px",left:"2px",position:"absolute",top:"2px",transform:`rotateZ(${this._spatial.radToDeg(i)}deg)`,width:"36px"}},[o])}_createFovArc(e,t){const o=e+t;if(o>2*Math.PI-Math.PI/90)return Gt.h("circle",{attributes:{cx:"0",cy:"0","fill-opacity":"0",r:`${16.75}`,stroke:"#FFF","stroke-width":`${2.5}`},namespace:this._svgNamespace},[]);let c=-Math.PI/2-e,s=c+o,d=16.75*Math.cos(c),p=16.75*Math.sin(c),g=16.75*Math.cos(s),_=16.75*Math.sin(s),x=o>=Math.PI?1:0,b=`M ${d} ${p} A ${16.75} ${16.75} 0 ${x} 1 ${g} ${_}`;return Gt.h("path",{attributes:{d:b,"fill-opacity":"0",stroke:"#FFF","stroke-width":`${2.5}`},namespace:this._svgNamespace},[])}_createCircleSectorCompass(e){let t=Gt.h("g",{attributes:{transform:"translate(1,1)"},namespace:this._svgNamespace},[e]);return Gt.h("svg",{attributes:{viewBox:"0 0 2 2"},namespace:this._svgNamespace,style:{height:"26px",left:"7px",position:"absolute",top:"7px",width:"26px"}},[t])}_createCircleSector(e,t){if(e>2*Math.PI-Math.PI/90)return Gt.h("circle",{attributes:{cx:"0",cy:"0",fill:t,r:"1"},namespace:this._svgNamespace},[]);let i=-Math.PI/2-e/2,r=i+e,o=Math.cos(i),c=Math.sin(i),s=Math.cos(r),d=Math.sin(r),p=e>=Math.PI?1:0,g=`M 0 0 ${o} ${c} A 1 1 0 ${p} 1 ${s} ${d}`;return Gt.h("path",{attributes:{d:g,fill:t},namespace:this._svgNamespace},[])}_createNorth(e){const t=Gt.h("div.mapillary-bearing-north",[]);return Gt.h("div.mapillary-bearing-north-container",{style:{transform:`rotateZ(${this._spatial.radToDeg(-e)}deg)`}},[t])}_createBackground(e){return Gt.h("div.mapillary-bearing-indicator-background",{style:{transform:`rotateZ(${this._spatial.radToDeg(-e)}deg)`}},[Gt.h("div.mapillary-bearing-indicator-background-circle",[]),Gt.h("div.mapillary-bearing-indicator-background-arrow-container",[Gt.h("div.mapillary-bearing-indicator-background-arrow",[])])])}_computeProjectedPoints(e){return ZC(e,[[1,0]],[[0,.5]],12,this._viewportCoords)}_computeHorizontalFov(e){const t=e.map(r=>this._coordToFov(r[0]));return Math.min(...t)}_coordToFov(e){return this._spatial.radToDeg(2*Math.atan(e))}_interpolate(e,t,i){return(1-i)*e+i*t}}PB.componentName="bearing";class IB extends bo{constructor(e,t,i){super(e,t,i)}_activate(){const e=this._subscriptions;e.push(Si(this._navigator.stateService.currentImage$.pipe(ei(t=>t.sequenceEdges$),oi(t=>t.cached)),this._configuration$).pipe(ei(t=>{let i=t[0],r=t[1],o=Math.max(0,Math.min(4,r.depth.sequence)),c=this._cache$(i.edges,Vt.Next,o),s=this._cache$(i.edges,Vt.Prev,o);return fn(c,s).pipe($n(d=>(console.error("Failed to cache sequence edges.",d),zi())))})).subscribe(()=>{})),e.push(Si(this._navigator.stateService.currentImage$.pipe(ei(t=>Si(Ai(t),t.spatialEdges$.pipe(oi(i=>i.cached))))),this._configuration$).pipe(ei(([[t,i],r])=>{let o=i.edges,c=r.depth,s=Math.max(0,Math.min(2,c.spherical)),d=ki(t.cameraType)?0:Math.max(0,Math.min(3,c.step)),p=ki(t.cameraType)?0:Math.max(0,Math.min(1,c.turn)),g=this._cache$(o,Vt.Spherical,s),_=this._cache$(o,Vt.StepForward,d),x=this._cache$(o,Vt.StepBackward,d),b=this._cache$(o,Vt.StepLeft,d),S=this._cache$(o,Vt.StepRight,d),P=this._cache$(o,Vt.TurnLeft,p),L=this._cache$(o,Vt.TurnRight,p),E=this._cache$(o,Vt.TurnU,p);return fn(_,x,b,S,g,P,L,E).pipe($n(C=>(console.error("Failed to cache spatial edges.",C),zi())))})).subscribe(()=>{}))}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{depth:{spherical:1,sequence:2,step:1,turn:0}}}_cache$(e,t,i){return Dy(Ai(e),Ai(i)).pipe(jO(r=>{let o=r[0],c=r[1],s=[];if(c>0)for(let d of o)d.data.direction===t&&s.push(Dy(this._navigator.graphService.cacheImage$(d.target).pipe(Hi(p=>this._imageToEdges$(p,t))),Ai(c-1)));return Fr(s).pipe(op())}),Ys(1))}_imageToEdges$(e,t){return([Vt.Next,Vt.Prev].indexOf(t)>-1?e.sequenceEdges$:e.spatialEdges$).pipe(wi(i=>i.cached),it(i=>i.edges))}}IB.componentName="cache";class Vl extends cr{constructor(e){super(e??"The request was cancelled."),Object.setPrototypeOf(this,Vl.prototype),this.name="CancelMapillaryError"}}class Xie{constructor(e,t){this._spatial=new vo,this._minThresholdWidth=320,this._maxThresholdWidth=1480,this._minThresholdHeight=240,this._maxThresholdHeight=820,this._configure(e),this._resize(t),this._reset()}get minWidth(){return this._minWidth}get maxWidth(){return this._maxWidth}get containerWidth(){return this._containerWidth}get containerWidthCss(){return this._containerWidthCss}get containerMarginCss(){return this._containerMarginCss}get containerLeftCss(){return this._containerLeftCss}get containerHeight(){return this._containerHeight}get containerHeightCss(){return this._containerHeightCss}get containerBottomCss(){return this._containerBottomCss}get stepCircleSize(){return this._stepCircleSize}get stepCircleSizeCss(){return this._stepCircleSizeCss}get stepCircleMarginCss(){return this._stepCircleMarginCss}get turnCircleSize(){return this._turnCircleSize}get turnCircleSizeCss(){return this._turnCircleSizeCss}get outerRadius(){return this._outerRadius}get innerRadius(){return this._innerRadius}get shadowOffset(){return this._shadowOffset}configure(e){this._configure(e),this._reset()}resize(e){this._resize(e),this._reset()}angleToCoordinates(e){return[Math.cos(e),Math.sin(e)]}relativeAngleToCoordiantes(e,t){let i=this._spatial.wrapAngle(e-t);return this.angleToCoordinates(i)}_configure(e){this._minWidth=e.minWidth,this._maxWidth=this._getMaxWidth(e.minWidth,e.maxWidth)}_resize(e){this._elementWidth=e.width,this._elementHeight=e.height}_reset(){this._containerWidth=this._getContainerWidth(this._elementWidth,this._elementHeight),this._containerHeight=this._getContainerHeight(this.containerWidth),this._stepCircleSize=this._getStepCircleDiameter(this._containerHeight),this._turnCircleSize=this._getTurnCircleDiameter(this.containerHeight),this._outerRadius=this._getOuterRadius(this._containerHeight),this._innerRadius=this._getInnerRadius(this._containerHeight),this._shadowOffset=3,this._containerWidthCss=this._numberToCssPixels(this._containerWidth),this._containerMarginCss=this._numberToCssPixels(-.5*this._containerWidth),this._containerLeftCss=this._numberToCssPixels(Math.floor(.5*this._elementWidth)),this._containerHeightCss=this._numberToCssPixels(this._containerHeight),this._containerBottomCss=this._numberToCssPixels(Math.floor(-.08*this._containerHeight)),this._stepCircleSizeCss=this._numberToCssPixels(this._stepCircleSize),this._stepCircleMarginCss=this._numberToCssPixels(-.5*this._stepCircleSize),this._turnCircleSizeCss=this._numberToCssPixels(this._turnCircleSize)}_getContainerWidth(e,t){let i=(e-this._minThresholdWidth)/(this._maxThresholdWidth-this._minThresholdWidth),r=(t-this._minThresholdHeight)/(this._maxThresholdHeight-this._minThresholdHeight),o=Math.max(0,Math.min(1,Math.min(i,r)));return o=.04*Math.round(25*o),this._minWidth+o*(this._maxWidth-this._minWidth)}_getContainerHeight(e){return .77*e}_getStepCircleDiameter(e){return .34*e}_getTurnCircleDiameter(e){return .3*e}_getOuterRadius(e){return .31*e}_getInnerRadius(e){return .125*e}_numberToCssPixels(e){return e+"px"}_getMaxWidth(e,t){return e>t?e:t}}class Yie{constructor(e,t){this._isEdge=!1,this._spatial=new vo,this._calculator=new Xie(e,t),this._image=null,this._rotation={phi:0,theta:0},this._epsilon=.5*Math.PI/180,this._highlightKey=null,this._distinguishSequence=!1,this._needsRender=!1,this._stepEdges=[],this._turnEdges=[],this._sphericalEdges=[],this._sequenceEdgeKeys=[],this._stepDirections=[Vt.StepForward,Vt.StepBackward,Vt.StepLeft,Vt.StepRight],this._turnDirections=[Vt.TurnLeft,Vt.TurnRight,Vt.TurnU],this._turnNames={},this._turnNames[Vt.TurnLeft]="mapillary-direction-turn-left",this._turnNames[Vt.TurnRight]="mapillary-direction-turn-right",this._turnNames[Vt.TurnU]="mapillary-direction-turn-around";let i=!!document.documentMode;this._isEdge=!i&&!!window.StyleMedia}get needsRender(){return this._needsRender}render(e){this._needsRender=!1;let t=this._rotation,i=[],r=[];return ki(this._image.cameraType)?i=i.concat(this._createSphericalArrows(e,t)):(i=i.concat(this._createPerspectiveToSphericalArrows(e,t)),i=i.concat(this._createStepArrows(e,t)),r=r.concat(this._createTurnArrows(e))),this._getContainer(i,r,t)}setEdges(e,t){this._setEdges(e,t),this._setNeedsRender()}setImage(e){this._image=e,this._clearEdges(),this._setNeedsRender()}setRenderCamera(e){let t=e.rotation;Math.abs(t.phi-this._rotation.phi)<this._epsilon||(this._rotation=t,this._setNeedsRender())}setConfiguration(e){let t=!1;(this._highlightKey!==e.highlightId||this._distinguishSequence!==e.distinguishSequence)&&(this._highlightKey=e.highlightId,this._distinguishSequence=e.distinguishSequence,t=!0),(this._calculator.minWidth!==e.minWidth||this._calculator.maxWidth!==e.maxWidth)&&(this._calculator.configure(e),t=!0),t&&this._setNeedsRender()}resize(e){this._calculator.resize(e),this._setNeedsRender()}_setNeedsRender(){this._image!=null&&(this._needsRender=!0)}_clearEdges(){this._stepEdges=[],this._turnEdges=[],this._sphericalEdges=[],this._sequenceEdgeKeys=[]}_setEdges(e,t){this._stepEdges=[],this._turnEdges=[],this._sphericalEdges=[],this._sequenceEdgeKeys=[];for(let i of e.edges){let r=i.data.direction;if(this._stepDirections.indexOf(r)>-1){this._stepEdges.push(i);continue}if(this._turnDirections.indexOf(r)>-1){this._turnEdges.push(i);continue}i.data.direction===Vt.Spherical&&this._sphericalEdges.push(i)}if(this._distinguishSequence&&t!=null){let i=this._sphericalEdges.concat(this._stepEdges).concat(this._turnEdges);for(let r of i){let o=r.target;for(let c of t.imageIds)if(c===o){this._sequenceEdgeKeys.push(o);break}}}}_createSphericalArrows(e,t){let i=[];for(let r of this._sphericalEdges)i.push(this._createVNodeByKey(e,r.target,r.data.worldMotionAzimuth,t,this._calculator.outerRadius,"mapillary-direction-arrow-spherical"));for(let r of this._stepEdges)i.push(this._createSphericalToPerspectiveArrow(e,r.target,r.data.worldMotionAzimuth,t,r.data.direction));return i}_createSphericalToPerspectiveArrow(e,t,i,r,o){let c=Math.PI/8,s=r.phi;switch(o){case Vt.StepBackward:s=r.phi-Math.PI;break;case Vt.StepLeft:s=r.phi+Math.PI/2;break;case Vt.StepRight:s=r.phi-Math.PI/2;break}return Math.abs(this._spatial.wrapAngle(i-s))<c?this._createVNodeByKey(e,t,i,r,this._calculator.outerRadius,"mapillary-direction-arrow-step"):this._createVNodeInactive(t,i,r)}_createPerspectiveToSphericalArrows(e,t){let i=[];for(let r of this._sphericalEdges)i.push(this._createVNodeByKey(e,r.target,r.data.worldMotionAzimuth,t,this._calculator.innerRadius,"mapillary-direction-arrow-spherical",!0));return i}_createStepArrows(e,t){let i=[];for(let r of this._stepEdges)i.push(this._createVNodeByDirection(e,r.target,r.data.worldMotionAzimuth,t,r.data.direction));return i}_createTurnArrows(e){let t=[];for(let i of this._turnEdges){let r=i.data.direction,o=this._turnNames[r];t.push(this._createVNodeByTurn(e,i.target,o,r))}return t}_createVNodeByKey(e,t,i,r,o,c,s){let d=p=>{e.moveTo$(t).subscribe(void 0,g=>{g instanceof Vl||console.error(g)})};return this._createVNode(t,i,r,o,c,"mapillary-direction-circle",d,s)}_createVNodeByDirection(e,t,i,r,o){let c=s=>{e.moveDir$(o).subscribe(void 0,d=>{d instanceof Vl||console.error(d)})};return this._createVNode(t,i,r,this._calculator.outerRadius,"mapillary-direction-arrow-step","mapillary-direction-circle",c)}_createVNodeByTurn(e,t,i,r){let o=g=>{e.moveDir$(r).subscribe(void 0,_=>{_ instanceof Vl||console.error(_)})},c={height:this._calculator.turnCircleSizeCss,transform:"rotate(0)",width:this._calculator.turnCircleSizeCss};switch(r){case Vt.TurnLeft:c.left="5px",c.top="5px";break;case Vt.TurnRight:c.right="5px",c.top="5px";break;case Vt.TurnU:c.left="5px",c.bottom="5px";break}let s={attributes:{"data-id":t},onclick:o,style:c},d="mapillary-direction-turn-circle";this._sequenceEdgeKeys.indexOf(t)>-1&&(d+="-sequence"),this._highlightKey===t&&(d+="-highlight");let p=Gt.h(`div.${i}`,{},[]);return Gt.h("div."+d,s,[p])}_createVNodeInactive(e,t,i){return this._createVNode(e,t,i,this._calculator.outerRadius,"mapillary-direction-arrow-inactive","mapillary-direction-circle-inactive")}_createVNode(e,t,i,r,o,c,s,d){let p=this._calculator.angleToCoordinates(t-i.phi),g=Math.round(-r*p[1]+.5*this._calculator.containerWidth),_=Math.round(-r*p[0]+.5*this._calculator.containerHeight),x=this._calculator.relativeAngleToCoordiantes(t,i.phi),b=this._calculator.shadowOffset,S=-b*x[1],P=b*x[0],L=`drop-shadow(${S}px ${P}px 1px rgba(0,0,0,0.8))`,E={style:{"-webkit-filter":L,filter:L}},C=Gt.h("div."+o,E,[]),D=-this._spatial.radToDeg(t-i.phi),O=d?`translate(${g}px, ${_}px) rotate(${D}deg) translateZ(-0.01px)`:`translate(${g}px, ${_}px) rotate(${D}deg)`,U={attributes:{"data-id":e},onclick:s,style:{height:this._calculator.stepCircleSizeCss,marginLeft:this._calculator.stepCircleMarginCss,marginTop:this._calculator.stepCircleMarginCss,transform:O,width:this._calculator.stepCircleSizeCss}};return this._sequenceEdgeKeys.indexOf(e)>-1&&(c+="-sequence"),this._highlightKey===e&&(c+="-highlight"),Gt.h("div."+c,U,[C])}_getContainer(e,t,i){let r=this._isEdge?"rotateX(60deg)":`perspective(${this._calculator.containerWidthCss}) rotateX(60deg)`,o={oncontextmenu:c=>{c.preventDefault()},style:{bottom:this._calculator.containerBottomCss,height:this._calculator.containerHeightCss,left:this._calculator.containerLeftCss,marginLeft:this._calculator.containerMarginCss,transform:r,width:this._calculator.containerWidthCss}};return Gt.h("div.mapillary-direction-perspective",o,t.concat(e))}}class RB extends bo{constructor(e,t,i,r){super(e,t,i),this._renderer=r||new Yie(this.defaultConfiguration,{height:t.container.offsetHeight,width:t.container.offsetWidth}),this._hoveredIdSubject$=new ri,this._hoveredId$=this._hoveredIdSubject$.pipe(dn())}fire(e,t){super.fire(e,t)}off(e,t){super.off(e,t)}on(e,t){super.on(e,t)}_activate(){const e=this._subscriptions;e.push(this._configuration$.subscribe(t=>{this._renderer.setConfiguration(t)})),e.push(this._container.renderService.size$.subscribe(t=>{this._renderer.resize(t)})),e.push(this._navigator.stateService.currentImage$.pipe(Dr(t=>{this._container.domRenderer.render$.next({name:this._name,vNode:Gt.h("div",{},[])}),this._renderer.setImage(t)}),Ui(this._configuration$),ei(([t,i])=>Si(t.spatialEdges$,i.distinguishSequence?this._navigator.graphService.cacheSequence$(t.sequenceId).pipe($n(r=>(console.error(`Failed to cache sequence (${t.sequenceId})`,r),Ai(null)))):Ai(null)))).subscribe(([t,i])=>{this._renderer.setEdges(t,i)})),e.push(this._container.renderService.renderCameraFrame$.pipe(Dr(t=>{this._renderer.setRenderCamera(t)}),it(()=>this._renderer),oi(t=>t.needsRender),it(t=>({name:this._name,vNode:t.render(this._navigator)}))).subscribe(this._container.domRenderer.render$)),e.push(Si(this._container.domRenderer.element$,this._container.renderService.renderCamera$,this._container.mouseService.mouseMove$.pipe(An(null)),this._container.mouseService.mouseUp$.pipe(An(null))).pipe(it(([t])=>{let i=t.getElementsByClassName("mapillary-direction-perspective");for(let r=0;r<i.length;r++){let o=i.item(r).querySelector(":hover");if(o!=null&&o.hasAttribute("data-id"))return o.getAttribute("data-id")}return null}),yi()).subscribe(this._hoveredIdSubject$)),e.push(this._hoveredId$.subscribe(t=>{const i="hover",r={id:t,target:this,type:i};this.fire(i,r)}))}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{distinguishSequence:!1,maxWidth:460,minWidth:260}}}RB.componentName="direction";const Kie=`
#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

#define tau 6.28318530718

uniform sampler2D projectorTex;
uniform float opacity;

varying vec4 vRstq;

void main()
{
    vec3 b = normalize(vRstq.xyz);
    float lat = -asin(b.y);
    float lng = atan(b.x, b.z);
    float x = lng / tau + 0.5;
    float y = lat / tau * 2.0 + 0.5;
    vec4 baseColor = texture2D(projectorTex, vec2(x, y));
    baseColor.a = opacity;
    gl_FragColor = baseColor;
}
`,Jie=`
#ifdef GL_ES
precision highp float;
#endif

uniform mat4 projectorMat;

varying vec4 vRstq;

void main()
{
    vRstq = projectorMat * vec4(position, 1.0);
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,Qie=`
#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

#define tau 6.28318530718

uniform sampler2D projectorTex;
uniform float curtain;
uniform float opacity;

varying vec4 vRstq;

void main()
{
    vec3 b = normalize(vRstq.xyz);
    float lat = -asin(b.y);
    float lng = atan(b.x, b.z);
    float x = lng / tau + 0.5;
    float y = lat / tau * 2.0 + 0.5;

    bool inverted = curtain < 0.5;

    float curtainMin = inverted ? curtain + 0.5 : curtain - 0.5;
    float curtainMax = curtain;

    bool insideCurtain = inverted ?
        x > curtainMin || x < curtainMax :
        x > curtainMin && x < curtainMax;

    vec4 baseColor;
    if (insideCurtain) {
        baseColor = texture2D(projectorTex, vec2(x, y));
        baseColor.a = opacity;
    } else {
        baseColor = vec4(0.0, 0.0, 0.0, 0.0);
    }

    gl_FragColor = baseColor;
}
`,ene=`
#ifdef GL_ES
precision highp float;
#endif

uniform mat4 projectorMat;

varying vec4 vRstq;

void main()
{
    vRstq = projectorMat * vec4(position, 1.0);
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,tne=`
#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform sampler2D projectorTex;
uniform float opacity;
uniform float focal;
uniform float k1;
uniform float k2;
uniform float scale_x;
uniform float scale_y;
uniform float radial_peak;

varying vec4 vRstq;

void main()
{
    float x = vRstq.x;
    float y = vRstq.y;
    float z = vRstq.z;

    float r = sqrt(x * x + y * y);
    float theta = atan(r, z);

    if (radial_peak > 0. && theta > radial_peak) {
        theta = radial_peak;
    }

    float theta2 = theta * theta;
    float theta_d = theta * (1.0 + theta2 * (k1 + theta2 * k2));
    float s = focal * theta_d / r;

    float u = scale_x * s * x + 0.5;
    float v = -scale_y * s * y + 0.5;

    vec4 baseColor;
    if (u >= 0. && u <= 1. && v >= 0. && v <= 1.) {
        baseColor = texture2D(projectorTex, vec2(u, v));
        baseColor.a = opacity;
    } else {
        baseColor = vec4(0.0, 0.0, 0.0, 0.0);
    }

    gl_FragColor = baseColor;
}
`,ine=`
#ifdef GL_ES
precision highp float;
#endif

uniform mat4 projectorMat;

varying vec4 vRstq;

void main()
{
    vRstq = projectorMat * vec4(position, 1.0);
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,nne=`
#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform sampler2D projectorTex;
uniform float opacity;
uniform float focal;
uniform float k1;
uniform float k2;
uniform float scale_x;
uniform float scale_y;
uniform float radial_peak;
uniform float curtain;

varying vec4 vRstq;

void main()
{
    float x = vRstq.x;
    float y = vRstq.y;
    float z = vRstq.z;

    float r2 = sqrt(x * x + y * y);
    float theta = atan(r2, z);

    if (radial_peak > 0. && theta > radial_peak) {
        theta = radial_peak;
    }

    float theta2 = theta * theta;
    float theta_d = theta * (1.0 + theta2 * (k1 + theta2 * k2));
    float s = focal * theta_d / r2;

    float u = scale_x * s * x + 0.5;
    float v = -scale_y * s * y + 0.5;

    vec4 baseColor;
    if ((u < curtain || curtain >= 1.0) && u >= 0. && u <= 1. && v >= 0. && v <= 1.) {
        baseColor = texture2D(projectorTex, vec2(u, v));
        baseColor.a = opacity;
    } else {
        baseColor = vec4(0.0, 0.0, 0.0, 0.0);
    }

    gl_FragColor = baseColor;
}
`,rne=`
#ifdef GL_ES
precision highp float;
#endif

uniform mat4 projectorMat;

varying vec4 vRstq;

void main()
{
    vRstq = projectorMat * vec4(position, 1.0);
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,sne=`
#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform sampler2D projectorTex;
uniform float opacity;
uniform float focal;
uniform float k1;
uniform float k2;
uniform float scale_x;
uniform float scale_y;
uniform float radial_peak;

varying vec4 vRstq;

void main()
{
    float x = vRstq.x / vRstq.z;
    float y = vRstq.y / vRstq.z;
    float r2 = x * x + y * y;

    if (radial_peak > 0. && r2 > radial_peak * sqrt(r2)) {
        r2 = radial_peak * radial_peak;
    }

    float d = 1.0 + k1 * r2 + k2 * r2 * r2;
    float u = scale_x * focal * d * x + 0.5;
    float v = - scale_y * focal * d * y + 0.5;

    vec4 baseColor;
    if (u >= 0. && u <= 1. && v >= 0. && v <= 1.) {
        baseColor = texture2D(projectorTex, vec2(u, v));
        baseColor.a = opacity;
    } else {
        baseColor = vec4(0.0, 0.0, 0.0, 0.0);
    }

    gl_FragColor = baseColor;
}
`,one=`
#ifdef GL_ES
precision highp float;
#endif

uniform mat4 projectorMat;

varying vec4 vRstq;

void main()
{
    vRstq = projectorMat * vec4(position, 1.0);
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,ane=`
#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform sampler2D projectorTex;
uniform float opacity;
uniform float focal;
uniform float k1;
uniform float k2;
uniform float scale_x;
uniform float scale_y;
uniform float radial_peak;
uniform float curtain;

varying vec4 vRstq;

void main()
{
    float x = vRstq.x / vRstq.z;
    float y = vRstq.y / vRstq.z;
    float r2 = x * x + y * y;

    if (radial_peak > 0. && r2 > radial_peak * sqrt(r2)) {
        r2 = radial_peak * radial_peak;
    }

    float d = 1.0 + k1 * r2 + k2 * r2 * r2;
    float u = scale_x * focal * d * x + 0.5;
    float v = - scale_y * focal * d * y + 0.5;

    vec4 baseColor;
    if ((u < curtain || curtain >= 1.0) && u >= 0. && u <= 1. && v >= 0. && v <= 1.) {
        baseColor = texture2D(projectorTex, vec2(u, v));
        baseColor.a = opacity;
    } else {
        baseColor = vec4(0.0, 0.0, 0.0, 0.0);
    }

    gl_FragColor = baseColor;
}
`,lne=`
#ifdef GL_ES
precision highp float;
#endif

uniform mat4 projectorMat;

varying vec4 vRstq;

void main()
{
    vRstq = projectorMat * vec4(position, 1.0);
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,cne=`
#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform sampler2D projectorTex;
uniform float opacity;

varying vec4 vRstq;

void main()
{
    float u = vRstq.x / vRstq.w;
    float v = vRstq.y / vRstq.w;

    vec4 baseColor;
    if (u >= 0. && u <= 1. && v >= 0. && v <= 1.) {
        baseColor = texture2D(projectorTex, vec2(u, v));
        baseColor.a = opacity;
    } else {
        baseColor = vec4(0.0, 0.0, 0.0, 0.0);
    }

    gl_FragColor = baseColor;
}
`,une=`
#ifdef GL_ES
precision highp float;
#endif

uniform mat4 projectorMat;

varying vec4 vRstq;

void main()
{
    vRstq = projectorMat * vec4(position, 1.0);
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,hne=`
#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform sampler2D projectorTex;
uniform float opacity;
uniform float curtain;

varying vec4 vRstq;

void main()
{
    float u = vRstq.x / vRstq.w;
    float v = vRstq.y / vRstq.w;

    vec4 baseColor;
    if ((u < curtain || curtain >= 1.0) && u >= 0. && u <= 1. && v >= 0. && v <= 1.) {
        baseColor = texture2D(projectorTex, vec2(u, v));
        baseColor.a = opacity;
    } else {
        baseColor = vec4(0.0, 0.0, 0.0, 0.0);
    }

    gl_FragColor = baseColor;
}
`,dne=`
#ifdef GL_ES
precision highp float;
#endif

uniform mat4 projectorMat;

varying vec4 vRstq;

void main()
{
    vRstq = projectorMat * vec4(position, 1.0);
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`;class Kr{}Kr.fisheye={fragment:tne,vertex:ine};Kr.fisheyeCurtain={fragment:nne,vertex:rne};Kr.perspective={fragment:sne,vertex:one};Kr.perspectiveCurtain={fragment:ane,vertex:lne};Kr.perspectiveDistorted={fragment:cne,vertex:une};Kr.perspectiveDistortedCurtain={fragment:hne,vertex:dne};Kr.spherical={fragment:Kie,vertex:Jie};Kr.sphericalCurtain={fragment:Qie,vertex:ene};class LB{constructor(e,t){this._imagePlaneDepth=e??200,this._imageSphereRadius=t??200}createMesh(e,t){return ki(t.cameraType)?this._createImageSphere(e,t):Iw(t.cameraType)?this._createImagePlaneFisheye(e,t):this._createImagePlane(e,t)}createFlatMesh(e,t,i,r,o,c){let s=this._createTexture(e.image),d=this._createDistortedPlaneMaterialParameters(t,s),p=new Jo(d),g=this._getFlatImagePlaneGeoFromBasic(t,i,r,o,c);return new kr(g,p)}createCurtainMesh(e,t){return ki(t.cameraType)?this._createSphereCurtainMesh(e,t):Iw(t.cameraType)?this._createCurtainMeshFisheye(e,t):this._createCurtainMesh(e,t)}createDistortedCurtainMesh(e,t){return this._createDistortedCurtainMesh(e,t)}_createCurtainMesh(e,t){let i=this._createTexture(e.image),r=this._createCurtainPlaneMaterialParameters(t,i),o=new Jo(r),c=this._useMesh(t,e)?this._getImagePlaneGeo(t,e):this._getRegularFlatImagePlaneGeo(t);return new kr(c,o)}_createCurtainMeshFisheye(e,t){let i=this._createTexture(e.image),r=this._createCurtainPlaneMaterialParametersFisheye(t,i),o=new Jo(r),c=this._useMesh(t,e)?this._getImagePlaneGeoFisheye(t,e):this._getRegularFlatImagePlaneGeo(t);return new kr(c,o)}_createDistortedCurtainMesh(e,t){let i=this._createTexture(e.image),r=this._createDistortedCurtainPlaneMaterialParameters(t,i),o=new Jo(r),c=this._getRegularFlatImagePlaneGeo(t);return new kr(c,o)}_createSphereCurtainMesh(e,t){let i=this._createTexture(e.image),r=this._createCurtainSphereMaterialParameters(t,i),o=new Jo(r);return this._useMesh(t,e)?new kr(this._getImageSphereGeo(t,e),o):new kr(this._getFlatImageSphereGeo(t),o)}_createImageSphere(e,t){let i=this._createTexture(e.image),r=this._createSphereMaterialParameters(t,i),o=new Jo(r);return this._useMesh(t,e)?new kr(this._getImageSphereGeo(t,e),o):new kr(this._getFlatImageSphereGeo(t),o)}_createImagePlane(e,t){let i=this._createTexture(e.image),r=this._createPlaneMaterialParameters(t,i),o=new Jo(r),c=this._useMesh(t,e)?this._getImagePlaneGeo(t,e):this._getRegularFlatImagePlaneGeo(t);return new kr(c,o)}_createImagePlaneFisheye(e,t){let i=this._createTexture(e.image),r=this._createPlaneMaterialParametersFisheye(t,i),o=new Jo(r),c=this._useMesh(t,e)?this._getImagePlaneGeoFisheye(t,e):this._getRegularFlatImagePlaneGeoFisheye(t);return new kr(c,o)}_createSphereMaterialParameters(e,t){return{depthWrite:!1,fragmentShader:Kr.spherical.fragment,side:Ko,transparent:!0,uniforms:{opacity:{value:1},projectorMat:{value:e.rt},projectorTex:{value:t}},vertexShader:Kr.spherical.vertex}}_createCurtainSphereMaterialParameters(e,t){return{depthWrite:!1,fragmentShader:Kr.sphericalCurtain.fragment,side:Ko,transparent:!0,uniforms:{curtain:{value:1},opacity:{value:1},projectorMat:{value:e.rt},projectorTex:{value:t}},vertexShader:Kr.sphericalCurtain.vertex}}_createPlaneMaterialParameters(e,t){return{depthWrite:!1,fragmentShader:Kr.perspective.fragment,side:Ko,transparent:!0,uniforms:{focal:{value:e.focal},k1:{value:e.ck1},k2:{value:e.ck2},opacity:{value:1},projectorMat:{value:e.basicRt},projectorTex:{value:t},radial_peak:{value:e.radialPeak?e.radialPeak:0},scale_x:{value:Math.max(e.basicHeight,e.basicWidth)/e.basicWidth},scale_y:{value:Math.max(e.basicWidth,e.basicHeight)/e.basicHeight}},vertexShader:Kr.perspective.vertex}}_createPlaneMaterialParametersFisheye(e,t){return{depthWrite:!1,fragmentShader:Kr.fisheye.fragment,side:Ko,transparent:!0,uniforms:{focal:{value:e.focal},k1:{value:e.ck1},k2:{value:e.ck2},opacity:{value:1},projectorMat:{value:e.basicRt},projectorTex:{value:t},radial_peak:{value:e.radialPeak?e.radialPeak:0},scale_x:{value:Math.max(e.basicHeight,e.basicWidth)/e.basicWidth},scale_y:{value:Math.max(e.basicWidth,e.basicHeight)/e.basicHeight}},vertexShader:Kr.fisheye.vertex}}_createCurtainPlaneMaterialParametersFisheye(e,t){return{depthWrite:!1,fragmentShader:Kr.fisheyeCurtain.fragment,side:Ko,transparent:!0,uniforms:{curtain:{value:1},focal:{value:e.focal},k1:{value:e.ck1},k2:{value:e.ck2},opacity:{value:1},projectorMat:{value:e.basicRt},projectorTex:{value:t},radial_peak:{value:e.radialPeak?e.radialPeak:0},scale_x:{value:Math.max(e.basicHeight,e.basicWidth)/e.basicWidth},scale_y:{value:Math.max(e.basicWidth,e.basicHeight)/e.basicHeight}},vertexShader:Kr.fisheyeCurtain.vertex}}_createCurtainPlaneMaterialParameters(e,t){return{depthWrite:!1,fragmentShader:Kr.perspectiveCurtain.fragment,side:Ko,transparent:!0,uniforms:{curtain:{value:1},focal:{value:e.focal},k1:{value:e.ck1},k2:{value:e.ck2},opacity:{value:1},projectorMat:{value:e.basicRt},projectorTex:{value:t},radial_peak:{value:e.radialPeak?e.radialPeak:0},scale_x:{value:Math.max(e.basicHeight,e.basicWidth)/e.basicWidth},scale_y:{value:Math.max(e.basicWidth,e.basicHeight)/e.basicHeight}},vertexShader:Kr.perspectiveCurtain.vertex}}_createDistortedCurtainPlaneMaterialParameters(e,t){return{depthWrite:!1,fragmentShader:Kr.perspectiveDistortedCurtain.fragment,side:Ko,transparent:!0,uniforms:{curtain:{value:1},opacity:{value:1},projectorMat:{value:e.projectorMatrix()},projectorTex:{value:t}},vertexShader:Kr.perspectiveDistortedCurtain.vertex}}_createDistortedPlaneMaterialParameters(e,t){return{depthWrite:!1,fragmentShader:Kr.perspectiveDistorted.fragment,side:Ko,transparent:!0,uniforms:{opacity:{value:1},projectorMat:{value:e.projectorMatrix()},projectorTex:{value:t}},vertexShader:Kr.perspectiveDistorted.vertex}}_createTexture(e){let t=new Bs(e);return t.minFilter=Lo,t.needsUpdate=!0,t}_useMesh(e,t){return t.mesh.vertices.length&&e.hasValidScale}_getImageSphereGeo(e,t){const i=e.srtInverse;let r=5*e.scale,o=this._imageSphereRadius*e.scale,c=t.mesh.vertices,s=c.length/3,d=new Float32Array(c.length);for(let x=0;x<s;++x){let b=3*x,S=c[b+0],P=c[b+1],L=c[b+2],E=Math.sqrt(S*S+P*P+L*L),D=Math.max(r,Math.min(E,o))/E,O=new Ue(S*D,P*D,L*D);O.applyMatrix4(i),d[b+0]=O.x,d[b+1]=O.y,d[b+2]=O.z}let p=t.mesh.faces,g=new Uint16Array(p.length);for(let x=0;x<p.length;++x)g[x]=p[x];let _=new Vn;return _.setAttribute("position",new Mn(d,3)),_.setIndex(new Mn(g,1)),_}_getImagePlaneGeo(e,t){const r=e.srtInverse;let o=5*e.scale,c=this._imagePlaneDepth*e.scale,s=t.mesh.vertices,d=s.length/3,p=new Float32Array(s.length);for(let b=0;b<d;++b){let S=3*b,P=s[S+0],L=s[S+1],E=s[S+2];b<4&&(P*=3,L*=3);let C=Math.max(o,Math.min(E,c)),D=C/E,O=new Ue(P*D,L*D,C);O.applyMatrix4(r),p[S+0]=O.x,p[S+1]=O.y,p[S+2]=O.z}let g=t.mesh.faces,_=new Uint16Array(g.length);for(let b=0;b<g.length;++b)_[b]=g[b];let x=new Vn;return x.setAttribute("position",new Mn(p,3)),x.setIndex(new Mn(_,1)),x}_getImagePlaneGeoFisheye(e,t){const i=e.srtInverse;let r=5*e.scale,o=this._imagePlaneDepth*e.scale,c=t.mesh.vertices,s=c.length/3,d=new Float32Array(c.length);for(let x=0;x<s;++x){let b=3*x,S=c[b+0],P=c[b+1],L=c[b+2],E=Math.sqrt(S*S+P*P+L*L),D=Math.max(r,Math.min(E,o))/E,O=new Ue(S*D,P*D,L*D);O.applyMatrix4(i),d[b+0]=O.x,d[b+1]=O.y,d[b+2]=O.z}let p=t.mesh.faces,g=new Uint16Array(p.length);for(let x=0;x<p.length;++x)g[x]=p[x];let _=new Vn;return _.setAttribute("position",new Mn(d,3)),_.setIndex(new Mn(g,1)),_}_getFlatImageSphereGeo(e){const t=new VC(this._imageSphereRadius,20,40),i=e.rt.clone().invert();return t.applyMatrix4(i),t}_getRegularFlatImagePlaneGeo(e){let t=e.width,i=e.height,r=Math.max(t,i),o=t/2/r,c=i/2/r;return this._getFlatImagePlaneGeo(e,o,c)}_getFlatImagePlaneGeo(e,t,i){let r=[];return r.push(e.unprojectSfM([-t,-i],this._imagePlaneDepth)),r.push(e.unprojectSfM([t,-i],this._imagePlaneDepth)),r.push(e.unprojectSfM([t,i],this._imagePlaneDepth)),r.push(e.unprojectSfM([-t,i],this._imagePlaneDepth)),this._createFlatGeometry(r)}_getRegularFlatImagePlaneGeoFisheye(e){let t=e.width,i=e.height,r=Math.max(t,i),o=t/2/r,c=i/2/r;return this._getFlatImagePlaneGeoFisheye(e,o,c)}_getFlatImagePlaneGeoFisheye(e,t,i){let r=[];return r.push(e.unprojectSfM([-t,-i],this._imagePlaneDepth)),r.push(e.unprojectSfM([t,-i],this._imagePlaneDepth)),r.push(e.unprojectSfM([t,i],this._imagePlaneDepth)),r.push(e.unprojectSfM([-t,i],this._imagePlaneDepth)),this._createFlatGeometry(r)}_getFlatImagePlaneGeoFromBasic(e,t,i,r,o){let c=[];return c.push(e.unprojectBasic([t,r],this._imagePlaneDepth)),c.push(e.unprojectBasic([i,r],this._imagePlaneDepth)),c.push(e.unprojectBasic([i,o],this._imagePlaneDepth)),c.push(e.unprojectBasic([t,o],this._imagePlaneDepth)),this._createFlatGeometry(c)}_createFlatGeometry(e){let t=new Float32Array(12);for(let o=0;o<e.length;o++){let c=3*o;t[c+0]=e[o][0],t[c+1]=e[o][1],t[c+2]=e[o][2]}let i=new Uint16Array(6);i[0]=0,i[1]=1,i[2]=3,i[3]=1,i[4]=2,i[5]=3;let r=new Vn;return r.setAttribute("position",new Mn(t,3)),r.setIndex(new Mn(i,1)),r}}class kB{constructor(){this._planes={},this._planesOld={},this._planesPeriphery={},this._scene=new vh,this._sceneOld=new vh,this._scenePeriphery=new vh}get planes(){return this._planes}get planesOld(){return this._planesOld}get planesPeriphery(){return this._planesPeriphery}get scene(){return this._scene}get sceneOld(){return this._sceneOld}get scenePeriphery(){return this._scenePeriphery}updateImagePlanes(e){this._dispose(this._planesOld,this.sceneOld);for(const t in this._planes){if(!this._planes.hasOwnProperty(t))continue;const i=this._planes[t];this._scene.remove(i),this._sceneOld.add(i)}for(const t in e)e.hasOwnProperty(t)&&this._scene.add(e[t]);this._planesOld=this._planes,this._planes=e}addImagePlanes(e){for(const t in e){if(!e.hasOwnProperty(t))continue;const i=e[t];this._scene.add(i),this._planes[t]=i}}addImagePlanesOld(e){for(const t in e){if(!e.hasOwnProperty(t))continue;const i=e[t];this._sceneOld.add(i),this._planesOld[t]=i}}setImagePlanes(e){this._clear(),this.addImagePlanes(e)}addPeripheryPlanes(e){for(const t in e){if(!e.hasOwnProperty(t))continue;const i=e[t];this._scenePeriphery.add(i),this._planesPeriphery[t]=i}}setPeripheryPlanes(e){this._clearPeriphery(),this.addPeripheryPlanes(e)}setImagePlanesOld(e){this._clearOld(),this.addImagePlanesOld(e)}clear(){this._clear(),this._clearOld()}_clear(){this._dispose(this._planes,this._scene),this._planes={}}_clearOld(){this._dispose(this._planesOld,this._sceneOld),this._planesOld={}}_clearPeriphery(){this._dispose(this._planesPeriphery,this._scenePeriphery),this._planesPeriphery={}}_dispose(e,t){for(const i in e){if(!e.hasOwnProperty(i))continue;const r=e[i];t.remove(r),r.geometry.dispose(),r.material.dispose();let o=r.material.uniforms.projectorTex.value;o?.dispose()}}}class fne{constructor(){this._factory=new LB,this._scene=new kB,this._alpha=0,this._alphaOld=0,this._fadeOutSpeed=.05,this._currentKey=null,this._previousKey=null,this._providerDisposers={},this._frameId=0,this._needsRender=!1}get frameId(){return this._frameId}get needsRender(){return this._needsRender}indicateNeedsRender(){this._needsRender=!0}addPeripheryPlane(e,t){const i=this._factory.createMesh(e,t),r={};r[e.id]=i,this._scene.addPeripheryPlanes(r),this._needsRender=!0}clearPeripheryPlanes(){this._scene.setPeripheryPlanes({}),this._needsRender=!0}updateFrame(e){this._updateFrameId(e.id),this._needsRender=this._updateAlpha(e.state.alpha)||this._needsRender,this._needsRender=this._updateAlphaOld(e.state.alpha)||this._needsRender,this._needsRender=this._updateImagePlanes(e.state)||this._needsRender}setTextureProvider(e,t){if(e!==this._currentKey)return;let i=t.textureCreated$.subscribe(c=>{this._updateTexture(c)}),r=t.textureUpdated$.subscribe(c=>{this._needsRender=!0}),o=()=>{i.unsubscribe(),r.unsubscribe(),t.dispose()};if(e in this._providerDisposers){let c=this._providerDisposers[e];c(),delete this._providerDisposers[e]}this._providerDisposers[e]=o}updateTextureImage(e,t){this._needsRender=!0;const i=this._extend({},this._scene.planes,this._scene.planesOld,this._scene.planesPeriphery);for(const r in i){if(!i.hasOwnProperty(r)||r!==t.id)continue;let s=i[r].material.uniforms.projectorTex.value;s.image=e,s.needsUpdate=!0}}render(e,t){const i=this._scene.planes,r=this._scene.planesOld,o=this._scene.planesPeriphery,c=Object.keys(r).length?1:this._alpha,s=Object.keys(r).length?1:Math.floor(this._alpha);for(const d in i){if(!i.hasOwnProperty(d))continue;const p=i[d];p.material.uniforms.opacity.value=c}for(const d in r){if(!r.hasOwnProperty(d))continue;const p=r[d];p.material.uniforms.opacity.value=this._alphaOld}for(const d in o){if(!o.hasOwnProperty(d))continue;const p=o[d];p.material.uniforms.opacity.value=s}t.render(this._scene.scenePeriphery,e),t.render(this._scene.scene,e),t.render(this._scene.sceneOld,e);for(const d in i){if(!i.hasOwnProperty(d))continue;const p=i[d];p.material.uniforms.opacity.value=this._alpha}t.render(this._scene.scene,e)}clearNeedsRender(){this._needsRender=!1}dispose(){this._scene.clear()}_updateFrameId(e){this._frameId=e}_updateAlpha(e){return e===this._alpha?!1:(this._alpha=e,!0)}_updateAlphaOld(e){return e<1||this._alphaOld===0?!1:(this._alphaOld=Math.max(0,this._alphaOld-this._fadeOutSpeed),!0)}_updateImagePlanes(e){if(e.currentImage==null||e.currentImage.id===this._currentKey)return!1;let t=e.previousImage!=null?e.previousImage.id:null,i=e.currentImage.id;if(this._previousKey!==t&&this._previousKey!==i&&this._previousKey in this._providerDisposers){let c=this._providerDisposers[this._previousKey];c(),delete this._providerDisposers[this._previousKey]}if(t!=null){if(t!==this._currentKey&&t!==this._previousKey){let c=this._factory.createMesh(e.previousImage,e.previousTransform);const s={};s[t]=c,this._scene.updateImagePlanes(s)}this._previousKey=t}this._currentKey=i;let r=this._factory.createMesh(e.currentImage,e.currentTransform);const o={};return o[i]=r,this._scene.updateImagePlanes(o),this._alphaOld=1,!0}_updateTexture(e){this._needsRender=!0;const t=this._scene.planes;for(const i in t){if(!t.hasOwnProperty(i))continue;let o=t[i].material,c=o.uniforms.projectorTex.value;o.uniforms.projectorTex.value=null,c.dispose(),o.uniforms.projectorTex.value=e}}_extend(e,...t){for(const i of t)for(const r in i)i.hasOwnProperty(r)&&(e[r]=i[r]);return e}}var Ih;(function(n){n[n.Background=0]="Background",n[n.Opaque=1]="Opaque"})(Ih||(Ih={}));class DB{constructor(e){this._api=e,this._urls$=new Map}getImage$(e){let t;const i=new Promise((r,o)=>{t=o});return[gr.create(r=>{this._api.data.getImageBuffer(e,i).then(o=>{t=null;const c=new Image;c.crossOrigin="Anonymous",c.onload=()=>{window.URL.revokeObjectURL(c.src),r.next(c),r.complete()},c.onerror=()=>{t=null,window.URL.revokeObjectURL(c.src),r.error(new Error("Failed to load image tile"))};const s=new Blob([o]);c.src=window.URL.createObjectURL(s)},o=>{t=null,r.error(o)})}),()=>{t&&t()}]}getURLs$(e,t){const i=this._inventId(e,t);if(this._urls$.has(i))return this._urls$.get(i);const r={imageId:e,z:t},o=this._api.getImageTiles$(r).pipe(it(c=>c.node),ga(()=>{this._urls$.delete(i)}),Ka(),gi());return this._urls$.set(i,o),o}_inventId(e,t){return`${e}-${t}`}}class g2{constructor(){this._tiles=new Map,this._urlLevels=new Set,this._urls=new Map}add(e,t){if(this._tiles.has(e))throw new Error(`Image tile already stored (${e})`);this._tiles.set(e,t)}addURLs(e,t){const i=this._urls;for(const r of t){const o=this.inventId(r);if(this._urls.has(o))throw new Error(`URL already stored (${o})`);i.set(o,r.url)}this._urlLevels.add(e)}dispose(){this._tiles.forEach(e=>window.URL.revokeObjectURL(e.src)),this._tiles.clear(),this._urls.clear(),this._urlLevels.clear()}get(e){return this._tiles.get(e)}getURL(e){return this._urls.get(e)}has(e){return this._tiles.has(e)}hasURL(e){return this._urls.has(e)}hasURLLevel(e){return this._urlLevels.has(e)}inventId(e){return`${e.z}-${e.x}-${e.y}`}}class FB{constructor(){this._viewportCoords=new zo}computeRegionOfInterest(e,t,i){const r=this._viewportBoundaryPoints(4),o=this._viewportPointsBoundingBox(r,e,i);this._clipBoundingBox(o);const c=2/t.width,s=2/t.height,d=[[-.5*c,.5*s],[.5*c,.5*s],[.5*c,-.5*s],[-.5*c,-.5*s]],p=this._viewportPointsBoundingBox(d,e,i),g=p.minX<p.maxX;return{bbox:o,pixelHeight:p.maxY-p.minY,pixelWidth:p.maxX-p.minX+(g?0:1)}}_viewportBoundaryPoints(e){const t=[],i=[[-1,1],[1,1],[1,-1],[-1,-1]],r=[[2,0],[0,-2],[-2,0],[0,2]];for(let o=0;o<4;++o){const c=i[o],s=r[o];for(let d=0;d<e;++d)t.push([c[0]+s[0]*d/e,c[1]+s[1]*d/e])}return t}_viewportPointsBoundingBox(e,t,i){const r=e.map(o=>this._viewportCoords.viewportToBasic(o[0],o[1],i,t.perspective));return ki(i.cameraType)?this._boundingBoxSpherical(r):this._boundingBox(r)}_boundingBox(e){const t={maxX:Number.NEGATIVE_INFINITY,maxY:Number.NEGATIVE_INFINITY,minX:Number.POSITIVE_INFINITY,minY:Number.POSITIVE_INFINITY};for(let i=0;i<e.length;++i)t.minX=Math.min(t.minX,e[i][0]),t.maxX=Math.max(t.maxX,e[i][0]),t.minY=Math.min(t.minY,e[i][1]),t.maxY=Math.max(t.maxY,e[i][1]);return t}_boundingBoxSpherical(e){const t=[],i=[];for(let o=0;o<e.length;++o)t.push(e[o][0]),i.push(e[o][1]);t.sort((o,c)=>this._sign(o-c)),i.sort((o,c)=>this._sign(o-c));const r=this._intervalSpherical(t);return{maxX:r[1],maxY:i[i.length-1],minX:r[0],minY:i[0]}}_intervalSpherical(e){let t=0,i=-1;for(let o=0;o<e.length-1;++o){const c=e[o+1]-e[o];c>t&&(t=c,i=o)}return e[0]+1-e[e.length-1]>t?[e[0],e[e.length-1]]:[e[i+1],e[i]]}_clipBoundingBox(e){e.minX=Math.max(0,Math.min(1,e.minX)),e.maxX=Math.max(0,Math.min(1,e.maxX)),e.minY=Math.max(0,Math.min(1,e.minY)),e.maxY=Math.max(0,Math.min(1,e.maxY))}_sign(e){return e>0?1:e<0?-1:0}}const pne=11,OB=1024;function b3(n,e,t){return Math.max(e,Math.min(t,n))}function zB(n){return OB/nE(n)}function nE(n){return Math.pow(2,n.z-n.max)}function mne(n){const e=Math.max(n.w,n.h);return Math.log(e)/Math.log(2)}function BB(n){return Math.ceil(mne(n))}function gne(n,e,t){return Math.max(e,Math.min(t,BB(n)))}function x3(n,e,t){const i=zB(t),r=e.w,o=e.h,c=Math.ceil(r/i)-1,s=Math.ceil(o/i)-1,d=b3(Math.floor(r*n[0]/i),0,c),p=b3(Math.floor(o*n[1]/i),0,s);return{x:d,y:p}}function cM(n,e,t){const r=1/nE(t)*OB,o=r*n.x,c=r*n.y,s=Math.min(r,e.w-o);return{h:Math.min(r,e.h-c),x:o,y:c,w:s}}function w3(n,e,t){return t*n<=e&&e<t*(n+1)}function _ne(n,e){if(n.z===e.z)return n.x===e.x&&n.y===e.y;const t=n.z<e.z?n:e,i=n.z<e.z?e:n,r=1/nE({max:i.z,z:t.z}),o=w3(t.x,i.x,r),c=w3(t.y,i.y,r);return o&&c}function vne(n,e,t,i){const r=[];if(n.x>e.x){const c=zB(i),s=Math.ceil(t.w/c)-1;for(let d=n.x;d<=s;d++)r.push(d);for(let d=0;d<=e.x;d++)r.push(d)}else for(let c=n.x;c<=e.x;c++)r.push(c);const o=[];for(const c of r)for(let s=n.y;s<=e.y;s++)o.push({x:c,y:s});return o}function S3(n){return n.w>0&&n.h>0}class _2{constructor(e,t,i,r,o,c,s){const d={h:i,w:t};S3(d)||console.warn(`Original image size (${t}, ${i}) is invalid (${e}). Tiles will not be loaded.`),this._imageId=e,this._size=d,this._level={max:BB(this._size),z:-1},this._holder=new yo,this._updated$=new ri,this._createdSubject$=new ri,this._created$=this._createdSubject$.pipe(Pi(1),gi()),this._holder.push(this._created$.subscribe(()=>{})),this._hasSubject$=new ri,this._has$=this._hasSubject$.pipe(An(!1),Pi(1),gi()),this._holder.push(this._has$.subscribe(()=>{})),this._renderedLevel=new Set,this._rendered=new Map,this._subscriptions=new Map,this._urlSubscriptions=new Map,this._loader=o,this._store=c,this._background=r,this._renderer=s,this._aborts=[],this._render=null,this._disposed=!1}get disposed(){return this._disposed}get hasTexture$(){return this._has$}get id(){return this._imageId}get textureUpdated$(){return this._updated$}get textureCreated$(){return this._created$}abort(){this._subscriptions.forEach(e=>e.unsubscribe()),this._subscriptions.clear();for(const e of this._aborts)e();this._aborts=[]}dispose(){if(this._disposed){console.warn(`Texture already disposed (${this._imageId})`);return}this._urlSubscriptions.forEach(e=>e.unsubscribe()),this._urlSubscriptions.clear(),this.abort(),this._render!=null&&(this._render.target.dispose(),this._render.target=null,this._render.camera=null,this._render=null),this._store.dispose(),this._holder.unsubscribe(),this._renderedLevel.clear(),this._background=null,this._renderer=null,this._disposed=!0}setRegionOfInterest(e){if(!S3(this._size))return;const t=1/e.pixelWidth,i=1/e.pixelHeight,r=gne({h:i,w:t},pne,this._level.max);r!==this._level.z&&(this.abort(),this._level.z=r,this._renderedLevel.clear(),this._rendered.forEach((d,p)=>{d.z===r&&this._renderedLevel.add(p)})),this._render==null&&this._initRender();const o=x3([e.bbox.minX,e.bbox.minY],this._size,this._level),c=x3([e.bbox.maxX,e.bbox.maxY],this._size,this._level),s=vne(o,c,this._size,this._level);this._fetchTiles(r,s)}_fetchTile(e){const t=this._loader.getImage$(e.url),i=t[0],r=t[1];this._aborts.push(r);const o=this._store.inventId(e),c=i.subscribe(s=>{const d=cM(e,this._size,this._level);this._renderToTarget(d,s),this._subscriptions.delete(o),this._removeFromArray(r,this._aborts),this._markRendered(e),this._store.add(o,s),this._updated$.next(!0)},s=>{this._subscriptions.delete(o),this._removeFromArray(r,this._aborts),console.error(s)});c.closed||this._subscriptions.set(o,c)}_fetchTiles(e,t){const r=(this._store.hasURLLevel(e)?Ai(void 0):this._loader.getURLs$(this._imageId,e).pipe(Dr(o=>{this._store.hasURLLevel(e)||this._store.addURLs(e,o)}))).subscribe(()=>{if(e===this._level.z){for(const o of t){const c={x:o.x,y:o.y,z:e,url:null},s=this._store.inventId(c);if(!(this._renderedLevel.has(s)||this._subscriptions.has(s))){if(this._store.has(s)){const d=cM(o,this._size,this._level);this._renderToTarget(d,this._store.get(s)),this._markRendered(c),this._updated$.next(!0);continue}c.url=this._store.getURL(s),this._fetchTile(c)}}this._urlSubscriptions.delete(e)}},o=>{this._urlSubscriptions.delete(e),console.error(o)});r.closed||this._urlSubscriptions.set(e,r)}_initRender(){const e=this._size.w/2,t=this._size.h/2,i=-1,r=1,o=new p1(-e,e,t,-t,i,r);o.position.z=1;const c=this._renderer.getContext(),s=c.getParameter(c.MAX_TEXTURE_SIZE),d=Math.max(this._size.w,this._size.h),p=s>d?1:s/d,g=Math.floor(p*this._size.w),_=Math.floor(p*this._size.h),x=new Mc(g,_,{depthBuffer:!1,format:lp,magFilter:Lo,minFilter:Lo,stencilBuffer:!1});this._render={camera:o,target:x};const b=cM({x:0,y:0},this._size,{max:this._level.max,z:0});this._renderToTarget(b,this._background),this._createdSubject$.next(x.texture),this._hasSubject$.next(!0)}_markRendered(e){const t=Array.from(this._rendered.entries()).filter(([r,o])=>o.z!==e.z);for(const[r,o]of t)_ne(e,o)&&this._rendered.delete(r);const i=this._store.inventId(e);this._rendered.set(i,e),this._renderedLevel.add(i)}_removeFromArray(e,t){const i=t.indexOf(e);i!==-1&&t.splice(i,1)}_renderToTarget(e,t){const i=new Bs(t);i.minFilter=Lo,i.needsUpdate=!0;const r=new f1(e.w,e.h),o=new f0({map:i,side:Wg}),c=new kr(r,o);c.position.x=-this._size.w/2+e.x+e.w/2,c.position.y=this._size.h/2-e.y-e.h/2;const s=new vh;s.add(c);const d=this._renderer.getRenderTarget();this._renderer.resetState(),this._renderer.setRenderTarget(this._render.target),this._renderer.render(s,this._render.camera),this._renderer.setRenderTarget(d),s.remove(c),r.dispose(),o.dispose(),i.dispose()}}var Oi;(function(n){n[n.Custom=0]="Custom",n[n.Earth=1]="Earth",n[n.Traversing=2]="Traversing",n[n.Waiting=3]="Waiting",n[n.WaitingInteractively=4]="WaitingInteractively"})(Oi||(Oi={}));class NB extends bo{constructor(e,t,i){super(e,t,i),this._imageTileLoader=new DB(i.api),this._roiCalculator=new FB,this._rendererOperation$=new ri,this._rendererCreator$=new ri,this._rendererDisposer$=new ri,this._renderer$=this._rendererOperation$.pipe(Vr((r,o)=>o(r),null),oi(r=>r!=null),yi(void 0,r=>r.frameId)),this._rendererCreator$.pipe(it(()=>r=>{if(r!=null)throw new Error("Multiple image plane states can not be created at the same time");return new fne})).subscribe(this._rendererOperation$),this._rendererDisposer$.pipe(it(()=>r=>(r.dispose(),null))).subscribe(this._rendererOperation$)}_activate(){const e=this._subscriptions;e.push(this._renderer$.pipe(it(d=>{const p={name:this._name,renderer:{frameId:d.frameId,needsRender:d.needsRender,render:d.render.bind(d),pass:Ih.Background}};return d.clearNeedsRender(),p})).subscribe(this._container.glRenderer.render$)),this._rendererCreator$.next(null),e.push(this._navigator.stateService.currentState$.pipe(it(d=>p=>(p.updateFrame(d),p))).subscribe(this._rendererOperation$));const t=this._container.configurationService.imageTiling$.pipe(ei(d=>d?this._navigator.stateService.currentState$:new ri),yi(void 0,d=>d.state.currentImage.id),Ui(this._container.glRenderer.webGLRenderer$),it(([d,p])=>{const g=d.state,_=g.currentImage,x=g.currentTransform;return new _2(_.id,x.basicWidth,x.basicHeight,_.image,this._imageTileLoader,new g2,p)}),Pi(1),gi());e.push(t.subscribe(()=>{})),e.push(t.pipe(it(d=>p=>(p.setTextureProvider(d.id,d),p))).subscribe(this._rendererOperation$)),e.push(t.pipe(il()).subscribe(d=>{d[0].abort()}));const i=this._container.configurationService.imageTiling$.pipe(ei(d=>d?Si(this._navigator.stateService.state$,this._navigator.stateService.inTranslation$):new ri),ei(([d,p])=>(d===Oi.Traversing||d===Oi.Waiting||d===Oi.WaitingInteractively)&&!p?this._container.renderService.renderCameraFrame$:zi()),it(d=>({camera:d,height:d.size.height.valueOf(),lookat:d.camera.lookat.clone(),width:d.size.width.valueOf(),zoom:d.zoom.valueOf()})),il(),it(([d,p])=>{const g=d.width===p.width&&d.height===p.height&&d.zoom===p.zoom&&d.lookat.equals(p.lookat);return{camera:p.camera,stalled:g}}),yi((d,p)=>d.stalled===p.stalled),oi(d=>d.stalled),Ui(this._container.renderService.size$,this._navigator.stateService.currentTransform$));e.push(t.pipe(ei(d=>i.pipe(it(([p,g,_])=>{const x=p.camera,b=new zo().viewportToBasic(0,0,_,x.perspective);if(!(b[0]<0||b[1]<0||b[0]>1||b[1]>1))return[this._roiCalculator.computeRegionOfInterest(x,g,_),d]}),oi(p=>!!p))),oi(d=>!d[1].disposed)).subscribe(([d,p])=>{p.setRegionOfInterest(d)}));const r=t.pipe(ei(d=>d.hasTexture$),An(!1),Pi(1),gi());e.push(r.subscribe(()=>{})),e.push(this._navigator.panService.panImages$.pipe(oi(d=>d.length===0),it(()=>d=>(d.clearPeripheryPlanes(),d))).subscribe(this._rendererOperation$));const o=this._navigator.panService.panImages$.pipe(ei(d=>Fr(d).pipe(Hi(([p,g])=>Si(this._navigator.graphService.cacheImage$(p.id).pipe($n(_=>(console.error(`Failed to cache periphery image (${p.id})`,_),zi()))),Ai(g))))),dn());e.push(o.pipe(it(([d,p])=>g=>(g.addPeripheryPlane(d,p),g))).subscribe(this._rendererOperation$)),e.push(o.pipe(Hi(([d])=>d.cacheImage$().pipe($n(()=>zi()))),it(d=>p=>(p.updateTextureImage(d.image,d),p))).subscribe(this._rendererOperation$));const c=this._navigator.stateService.currentState$.pipe(it(d=>d.state.alpha<1),yi()),s=Si(this._container.mouseService.active$,this._container.touchService.active$,this._navigator.stateService.inMotion$,c).pipe(it(([d,p,g,_])=>!(d||p||g||_)),oi(d=>d));e.push(this._navigator.stateService.state$.pipe(ei(d=>d===Oi.Traversing?this._navigator.panService.panImages$:zi()),ei(d=>s.pipe(Ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentImage$,this._navigator.stateService.currentTransform$),Hi(([,p,g,_])=>Ai([p,g,_,d])))),ei(([d,p,g,_])=>{const x=d.camera.lookat.clone().sub(d.camera.position),P=[new vo().viewingDirection(p.rotation).angleTo(x),void 0],L=new zo().viewportToBasic(0,0,g,d.perspective);L[0]>=0&&L[0]<=1&&L[1]>=0&&L[1]<=1&&(P[0]=Number.NEGATIVE_INFINITY);for(const[E]of _){const D=new vo().viewingDirection(E.rotation).angleTo(x);D<P[0]&&(P[0]=D,P[1]=E.id)}return P[1]?this._navigator.moveTo$(P[1]).pipe($n(()=>zi())):zi()})).subscribe())}_deactivate(){this._rendererDisposer$.next(null),this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{}}}NB.componentName="image";class wu{constructor(e,t,i){this._component=e,this._container=t,this._navigator=i,this._enabled=!1}get isEnabled(){return this._enabled}enable(){this._enabled||!this._component.activated||(this._enable(),this._enabled=!0,this._component.configure(this._getConfiguration(!0)))}disable(){this._enabled&&(this._disable(),this._enabled=!1,this._component.activated&&this._component.configure(this._getConfiguration(!1)))}}class yne extends wu{_enable(){const e=this._navigator.stateService.currentImage$.pipe(ei(t=>t.sequenceEdges$));this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(Ui(e)).subscribe(([t,i])=>{let r=null;switch(t.keyCode){case 38:r=Vt.Next;break;case 40:r=Vt.Prev;break;default:return}if(t.preventDefault(),!(!t.altKey||t.shiftKey||!i.cached)){for(const o of i.edges)if(o.data.direction===r){this._navigator.moveTo$(o.target).subscribe(void 0,c=>{c instanceof Vl||console.error(c)});return}}})}_disable(){this._keyDownSubscription.unsubscribe()}_getConfiguration(e){return{keySequenceNavigation:e}}}class bne extends wu{constructor(e,t,i,r){super(e,t,i),this._spatial=r}_enable(){const e=this._navigator.stateService.currentImage$.pipe(ei(t=>t.spatialEdges$));this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(Ui(e,this._navigator.stateService.currentState$)).subscribe(([t,i,r])=>{let o=ki(r.state.currentImage.cameraType),c=null;switch(t.keyCode){case 37:c=t.shiftKey&&!o?Vt.TurnLeft:Vt.StepLeft;break;case 38:c=t.shiftKey&&!o?Vt.Spherical:Vt.StepForward;break;case 39:c=t.shiftKey&&!o?Vt.TurnRight:Vt.StepRight;break;case 40:c=t.shiftKey&&!o?Vt.TurnU:Vt.StepBackward;break;default:return}if(t.preventDefault(),!(t.altKey||!i.cached||t.shiftKey&&o))if(!o)this._moveDir(c,i);else{const s={};s[Vt.StepBackward]=Math.PI,s[Vt.StepForward]=0,s[Vt.StepLeft]=Math.PI/2,s[Vt.StepRight]=-Math.PI/2;const d=this._rotationFromCamera(r.state.camera).phi,p=this._spatial.wrapAngle(d+s[c]),g=Math.PI/4,_=i.edges.filter(S=>S.data.direction===Vt.Spherical||S.data.direction===c);let x=Number.MAX_VALUE,b=null;for(const S of _){const P=Math.abs(this._spatial.wrapAngle(S.data.worldMotionAzimuth-p));P<Math.min(x,g)&&(x=P,b=S.target)}if(b==null)return;this._moveTo(b)}})}_disable(){this._keyDownSubscription.unsubscribe()}_getConfiguration(e){return{keySpatialNavigation:e}}_moveDir(e,t){for(const i of t.edges)if(i.data.direction===e){this._moveTo(i.target);return}}_moveTo(e){this._navigator.moveTo$(e).subscribe(void 0,t=>{t instanceof Vl||console.error(t)})}_rotationFromCamera(e){let t=e.lookat.clone().sub(e.position),i=t.clone().dot(e.up),r=t.clone().sub(e.up.clone().multiplyScalar(i)),o=Math.atan2(r.y,r.x),c=Math.PI/2-this._spatial.angleToPlane(t.toArray(),[0,0,1]);return{phi:o,theta:c}}}class xne extends wu{constructor(e,t,i,r){super(e,t,i),this._viewportCoords=r}_enable(){this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(Ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$)).subscribe(([e,t,i])=>{if(e.altKey||e.ctrlKey||e.metaKey)return;let r=0;switch(e.key){case"+":r=1;break;case"-":r=-1;break;default:return}e.preventDefault();const o=this._viewportCoords.unprojectFromViewport(0,0,t.perspective),c=i.projectBasic(o.toArray());this._navigator.stateService.zoomIn(r,c)})}_disable(){this._keyDownSubscription.unsubscribe()}_getConfiguration(e){return{keyZoom:e}}}class wne extends wu{_enable(){this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(Ui(this._navigator.playService.playing$,this._navigator.playService.direction$,this._navigator.playService.speed$,this._navigator.stateService.currentImage$.pipe(ei(e=>e.sequenceEdges$)),this._navigator.stateService.state$.pipe(it(e=>e===Oi.Earth),yi()))).subscribe(([e,t,i,r,o,c])=>{if(!(e.altKey||e.ctrlKey||e.metaKey)){switch(e.key){case"D":if(!e.shiftKey)return;const s=t?null:i===Vt.Next?Vt.Prev:i===Vt.Prev?Vt.Next:null;s!=null&&this._navigator.playService.setDirection(s);break;case" ":if(e.shiftKey)return;if(!c)if(t)this._navigator.playService.stop();else for(let d of o.edges)d.data.direction===i&&this._navigator.playService.play();break;case"<":this._navigator.playService.setSpeed(r-.05);break;case">":this._navigator.playService.setSpeed(r+.05);break;default:return}e.preventDefault()}})}_disable(){this._keyDownSubscription.unsubscribe()}_getConfiguration(e){return{keyPlay:e}}}class $B extends bo{constructor(e,t,i){super(e,t,i),this._keyPlayHandler=new wne(this,t,i),this._keySequenceNavigationHandler=new yne(this,t,i),this._keySpatialNavigationHandler=new bne(this,t,i,new vo),this._keyZoomHandler=new xne(this,t,i,new zo)}get keyPlay(){return this._keyPlayHandler}get keySequenceNavigation(){return this._keySequenceNavigationHandler}get keySpatialNavigation(){return this._keySpatialNavigationHandler}get keyZoom(){return this._keyZoomHandler}_activate(){this._subscriptions.push(this._configuration$.subscribe(e=>{e.keyPlay?this._keyPlayHandler.enable():this._keyPlayHandler.disable(),e.keySequenceNavigation?this._keySequenceNavigationHandler.enable():this._keySequenceNavigationHandler.disable(),e.keySpatialNavigation?this._keySpatialNavigationHandler.enable():this._keySpatialNavigationHandler.disable(),e.keyZoom?this._keyZoomHandler.enable():this._keyZoomHandler.disable()}))}_deactivate(){this._subscriptions.unsubscribe(),this._keyPlayHandler.disable(),this._keySequenceNavigationHandler.disable(),this._keySpatialNavigationHandler.disable(),this._keyZoomHandler.disable()}_getDefaultConfiguration(){return{keyPlay:!0,keySequenceNavigation:!0,keySpatialNavigation:!0,keyZoom:!0}}}$B.componentName="keyboard";class Sne{constructor(e,t){this._needsRender=!1,this._interactiveObjects=[],this._markers={},this._objectMarkers={},this._raycaster=t||new Pw,this._scene=e||new vh}get markers(){return this._markers}get needsRender(){return this._needsRender}add(e,t){e.id in this._markers&&this._dispose(e.id),e.createGeometry(t),this._scene.add(e.geometry),this._markers[e.id]=e;for(let i of e.getInteractiveObjects())this._interactiveObjects.push(i),this._objectMarkers[i.uuid]=e.id;this._needsRender=!0}clear(){for(const e in this._markers)this._markers.hasOwnProperty&&this._dispose(e);this._needsRender=!0}get(e){return this._markers[e]}getAll(){return Object.keys(this._markers).map(e=>this._markers[e])}has(e){return e in this._markers}intersectObjects([e,t],i){this._raycaster.setFromCamera(new li(e,t),i);const r=this._raycaster.intersectObjects(this._interactiveObjects);for(const o of r)if(o.object.uuid in this._objectMarkers)return this._objectMarkers[o.object.uuid];return null}lerpAltitude(e,t,i){e in this._markers&&(this._markers[e].lerpAltitude(t,i),this._needsRender=!0)}remove(e){e in this._markers&&(this._dispose(e),this._needsRender=!0)}render(e,t){t.render(this._scene,e),this._needsRender=!1}update(e,t,i){if(!(e in this._markers))return;this._markers[e].updatePosition(t,i),this._needsRender=!0}_dispose(e){const t=this._markers[e];this._scene.remove(t.geometry);for(let i of t.getInteractiveObjects()){const r=this._interactiveObjects.indexOf(i);r!==-1?this._interactiveObjects.splice(r,1):console.warn(`Object does not exist (${i.id}) for ${e}`),delete this._objectMarkers[i.uuid]}t.disposeGeometry(),delete this._markers[e]}}class VB extends bo{constructor(e,t,i){super(e,t,i),this._graphCalculator=new HC,this._markerScene=new Sne,this._markerSet=new Gy,this._viewportCoords=new zo,this._relativeGroundAltitude=-2}add(e){this._markerSet.add(e)}fire(e,t){super.fire(e,t)}get(e){return this._markerSet.get(e)}getAll(){return this._markerSet.getAll()}getMarkerIdAt(e){return new Promise((t,i)=>{this._container.renderService.renderCamera$.pipe(wi(),it(r=>{const o=this._viewportCoords.canvasToViewport(e[0],e[1],this._container.container);return this._markerScene.intersectObjects(o,r.perspective)})).subscribe(r=>{t(r)},r=>{i(r)})})}has(e){return this._markerSet.has(e)}off(e,t){super.off(e,t)}on(e,t){super.on(e,t)}remove(e){this._markerSet.remove(e)}removeAll(){this._markerSet.removeAll()}_activate(){const e=this._navigator.stateService.currentState$.pipe(it(S=>S.state.camera.position.z+this._relativeGroundAltitude),yi((S,P)=>Math.abs(S-P)<.01),Pi(1),gi()),t=Si(e,this._navigator.stateService.reference$).pipe(wi(),it(()=>{}),Pi(1),gi()),i=this._configuration$.pipe(it(S=>({visibleBBoxSize:Math.max(1,Math.min(200,S.visibleBBoxSize))}))),r=this._navigator.stateService.currentImage$.pipe(it(S=>S.lngLat),Pi(1),gi()),o=Si(i,r).pipe(it(([S,P])=>this._graphCalculator.boundingBoxCorners(P,S.visibleBBoxSize/2)),Pi(1),gi()),c=Si(Ul(Ai(this._markerSet),this._markerSet.changed$),o).pipe(it(([S,P])=>S.search(P))),s=this._subscriptions;s.push(t.pipe(ei(()=>c.pipe(Ui(this._navigator.stateService.reference$,e)))).subscribe(([S,P,L])=>{const E=this._markerScene,C=E.markers,D=Object.assign({},C);for(const O of S)if(O.id in C)delete D[O.id];else{const U=ta(O.lngLat.lng,O.lngLat.lat,P.alt+L,P.lng,P.lat,P.alt);E.add(O,U)}for(const O in D)D.hasOwnProperty(O)&&E.remove(O)})),s.push(t.pipe(ei(()=>this._markerSet.updated$.pipe(Ui(o,this._navigator.stateService.reference$,e)))).subscribe(([S,[P,L],E,C])=>{const D=this._markerScene;for(const O of S){const U=D.has(O.id),q=O.lngLat.lat>P.lat&&O.lngLat.lat<L.lat&&O.lngLat.lng>P.lng&&O.lngLat.lng<L.lng;if(q){const G=ta(O.lngLat.lng,O.lngLat.lat,E.alt+C,E.lng,E.lat,E.alt);D.add(O,G)}else!q&&U&&D.remove(O.id)}})),s.push(this._navigator.stateService.reference$.pipe(Ys(1),Ui(e)).subscribe(([S,P])=>{const L=this._markerScene;for(const E of L.getAll()){const C=ta(E.lngLat.lng,E.lngLat.lat,S.alt+P,S.lng,S.lat,S.alt);L.update(E.id,C)}})),s.push(e.pipe(Ys(1),Ui(this._navigator.stateService.reference$,r)).subscribe(([S,P,L])=>{const E=this._markerScene,C=ta(L.lng,L.lat,P.alt+S,P.lng,P.lat,P.alt);for(const D of E.getAll()){const O=ta(D.lngLat.lng,D.lngLat.lat,P.alt+S,P.lng,P.lat,P.alt),U=O[0]-C[0],q=O[1]-C[1],G=Math.sqrt(U*U+q*q);G>50||E.lerpAltitude(D.id,S,Math.min(1,Math.max(0,1.2-1.2*G/50)))}})),s.push(this._navigator.stateService.currentState$.pipe(it(S=>{const P=this._markerScene;return{name:this._name,renderer:{frameId:S.id,needsRender:P.needsRender,render:P.render.bind(P),pass:Ih.Opaque}}})).subscribe(this._container.glRenderer.render$));const d=Si(this._container.renderService.renderCamera$,this._container.mouseService.mouseMove$).pipe(it(([S,P])=>{const L=this._container.container,[E,C]=this._viewportCoords.canvasPosition(P,L),D=this._viewportCoords.canvasToViewport(E,C,L);return this._markerScene.intersectObjects(D,S.perspective)}),Pi(1),gi()),p=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragStart$).pipe(it(()=>!0)),g=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragEnd$).pipe(it(()=>!1)),_=fn(p,g).pipe(An(!1));s.push(fn(p.pipe(Ui(d)),Si(g,Ai(null))).pipe(An([!1,null]),il()).subscribe(([S,P])=>{const L=P[0],E=L?"markerdragstart":"markerdragend",C=L?P[1]:S[1],O={marker:this._markerScene.get(C),target:this,type:E};this.fire(E,O)}));const x=fn(this._container.mouseService.mouseDown$.pipe(it(()=>!0)),this._container.mouseService.documentMouseUp$.pipe(it(()=>!1))).pipe(An(!1));s.push(Si(this._container.mouseService.active$,d.pipe(yi()),x,_).pipe(it(([S,P,L,E])=>!S&&P!=null&&L||E),yi()).subscribe(S=>{S?(this._container.mouseService.claimMouse(this._name,1),this._container.mouseService.claimWheel(this._name,1)):(this._container.mouseService.unclaimMouse(this._name),this._container.mouseService.unclaimWheel(this._name))}));const b=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragStart$).pipe(Ui(d,this._container.renderService.renderCamera$),it(([S,P,L])=>{const E=this._markerScene.get(P),C=this._container.container,[D,O]=this._viewportCoords.projectToCanvas(E.geometry.position.toArray(),C,L.perspective),[U,q]=this._viewportCoords.canvasPosition(S,C),G=[U-D,q-O];return[E,G,L]}),Pi(1),gi());s.push(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDrag$).pipe(Ui(b,this._navigator.stateService.reference$,i)).subscribe(([S,[P,L,E],C,D])=>{if(!this._markerScene.has(P.id))return;const O=this._container.container,[U,q]=this._viewportCoords.canvasPosition(S,O),G=U-L[0],N=q-L[1],[V,j]=this._viewportCoords.canvasToViewport(G,N,O),z=new Ue(V,j,1).unproject(E.perspective).sub(E.perspective.position).normalize(),Q=Math.min(this._relativeGroundAltitude/z.z,D.visibleBBoxSize/2-.1);if(Q<0)return;const X=z.clone().multiplyScalar(Q).add(E.perspective.position);X.z=E.perspective.position.z+this._relativeGroundAltitude;const[re,se]=_p(X.x,X.y,X.z,C.lng,C.lat,C.alt);this._markerScene.update(P.id,X.toArray(),{lat:se,lng:re}),this._markerSet.update(P);const le="markerposition",ce={marker:P,target:this,type:le};this.fire(le,ce)}))}_deactivate(){this._subscriptions.unsubscribe(),this._markerScene.clear()}_getDefaultConfiguration(){return{visibleBBoxSize:100}}}VB.componentName="marker";function Tne(n){return n>0?1:n<0?-1:0}function bx(n,e){return n.x<=Math.max(e.p1.x,e.p2.x)&&n.x>=Math.min(e.p1.x,e.p2.x)&&n.y>=Math.max(e.p1.y,e.p2.y)&&n.y>=Math.min(e.p1.y,e.p2.y)}function UB(n,e){const t=n.p2.x-n.p1.x,i=n.p2.y-n.p1.y,r=e.p2.x-e.p1.x,o=e.p2.y-e.p1.y,c=t*o-i*r,s=t*t+i*i,d=r*r+o*o;return c*c<1e-10*s*d}function xx(n,e,t){const i=(e.y-n.y)*(t.x-e.x)-(t.y-e.y)*(e.x-n.x);return Tne(i)}function Mne(n,e){if(UB(n,e))return!1;const t=xx(n.p1,n.p2,e.p1),i=xx(n.p1,n.p2,e.p2),r=xx(e.p1,e.p2,n.p1),o=xx(e.p1,e.p2,n.p2);return!!(t!==i&&r!==o||t===0&&bx(e.p1,n)||i===0&&bx(e.p2,n)||r===0&&bx(n.p1,e)||o===0&&bx(n.p2,e))}function Cne(n,e){if(UB(n,e))return;const t=n.p1.x,i=n.p2.x,r=n.p1.y,o=n.p2.y,c=e.p1.x,s=e.p2.x,d=e.p1.y,p=e.p2.y,g=(t-i)*(d-p)-(r-o)*(c-s),_=(t*o-r*i)*(c-s)-(t-i)*(c*p-d*s),x=(t*o-r*i)*(d-p)-(r-o)*(c*p-d*s);return{x:_/g,y:x/g}}function Ene(n){let e=[],t=[[0,0],[1,0],[1,1],[0,1]],i=[[1,0],[0,1],[-1,0],[0,-1]];for(let r=0;r<4;++r){let o=t[r],c=i[r];for(let s=0;s<n;++s)e.push([o[0]+c[0]*s/n,o[1]+c[1]*s/n])}return e}function uM(n,e){return n>=-1&&n<=1&&e>=-1&&e<=1}function wx(n,e){return n>=0&&n<=1&&e>=0&&e<=1}function Fw(n,e,t){const r=Ene(100).map(D=>t.basicToViewportSafe(D[0],D[1],n,e)),o=[],c=[{x:-1,y:1},{x:1,y:1},{x:1,y:-1},{x:-1,y:-1}],s=[!1,!1,!1,!1];for(let D=0;D<r.length;D++){const O=r[D],U=r[(D+1)%r.length];if(O===null)continue;if(U===null){uM(O[0],O[1])&&o.push(O);continue}const[q,G]=O,[N,V]=U;if(uM(q,G))if(uM(N,V))o.push(O);else for(let j=0;j<4;j++){const z={p1:{x:q,y:G},p2:{x:N,y:V}},Q={p1:c[j],p2:c[(j+1)%4]};if(Mne(z,Q)){const re=Cne(z,Q);o.push(O,[re.x,re.y]),s[j]=!0}}}const[d,p]=t.viewportToBasic(-1,1,n,e),[g,_]=t.viewportToBasic(1,1,n,e),[x,b]=t.viewportToBasic(1,-1,n,e),[S,P]=t.viewportToBasic(-1,-1,n,e);wx(d,p)&&(s[3]=s[0]=!0),wx(g,_)&&(s[0]=s[1]=!0),wx(x,b)&&(s[1]=s[2]=!0),wx(S,P)&&(s[2]=s[3]=!0);const L=[-1,-1,1,1];for(let D of o){const O=D[0],U=D[1];O>L[1]&&(L[1]=O),O<L[3]&&(L[3]=O),U>L[0]&&(L[0]=U),U<L[2]&&(L[2]=U)}const E=[1,1,-1,-1],C=[];for(let D=0;D<4;D++){if(s[D]){C.push(0);continue}C.push(Math.abs(E[D]-L[D]))}return C}class Ane extends wu{constructor(e,t,i,r,o){super(e,t,i),this._spatial=o,this._viewportCoords=r}_enable(){const e=this._navigator.stateService.currentState$.pipe(it(t=>t.state.alpha<1),yi());this._bounceSubscription=Si(e,this._navigator.stateService.inTranslation$,this._container.mouseService.active$,this._container.touchService.active$).pipe(it(t=>t[0]||t[1]||t[2]||t[3]),yi(),ei(t=>t?zi():Si(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$.pipe(wi()))),Ui(this._navigator.panService.panImages$)).subscribe(([[t,i],r])=>{if(!i.hasValidScale&&t.camera.focal<.1||t.perspective.aspect===0||t.perspective.aspect===Number.POSITIVE_INFINITY)return;const o=Fw(i,t.perspective,this._viewportCoords),c=this._viewportCoords.viewportToBasic(0,0,i,t.perspective);(c[0]<0||c[0]>1)&&r.length>0&&(o[0]=o[2]=0);for(const[,L]of r){const E=Fw(L,t.perspective,this._viewportCoords);for(let C=1;C<o.length;C+=2)E[C]<o[C]&&(o[C]=E[C])}if(Math.max(...o)<.01)return;const s=o[1]-o[3],d=o[0]-o[2],p=this._viewportCoords.unprojectFromViewport(0,0,t.perspective).sub(t.perspective.position),g=this._viewportCoords.unprojectFromViewport(s,0,t.perspective).sub(t.perspective.position),_=this._viewportCoords.unprojectFromViewport(0,d,t.perspective).sub(t.perspective.position);let x=(s>0?1:-1)*g.angleTo(p),b=(d>0?1:-1)*_.angleTo(p);const S=Math.PI/60,P=.1;x=this._spatial.clamp(P*x,-S,S),b=this._spatial.clamp(P*b,-S,S),this._navigator.stateService.rotateUnbounded({phi:x,theta:b})})}_disable(){this._bounceSubscription.unsubscribe()}_getConfiguration(){return{}}}class Zx{static filteredPairwiseMouseDrag$(e,t){return this._filteredPairwiseMouseDrag$(e,t,t.mouseDragStart$,t.mouseDrag$,t.mouseDragEnd$)}static filteredPairwiseMouseRightDrag$(e,t){return this._filteredPairwiseMouseDrag$(e,t,t.mouseRightDragStart$,t.mouseRightDrag$,t.mouseRightDragEnd$)}static _filteredPairwiseMouseDrag$(e,t,i,r,o){return t.filtered$(e,i).pipe(ei(c=>{const s=Ul(Ai(c),t.filtered$(e,r)),d=t.filtered$(e,o).pipe(it(()=>null));return fn(s,d).pipe(qO(p=>!!p),An(null))}),il(),oi(c=>c[0]!=null&&c[1]!=null))}}class Pne extends wu{constructor(e,t,i,r,o){super(e,t,i),this._spatial=o,this._viewportCoords=r}_enable(){let e=this._container.mouseService.filtered$(this._component.name,this._container.mouseService.mouseDragStart$).pipe(it(()=>!0),dn()),t=this._container.mouseService.filtered$(this._component.name,this._container.mouseService.mouseDragEnd$).pipe(it(()=>!1),dn());this._activeMouseSubscription=fn(e,t).subscribe(this._container.mouseService.activate$);const i=fn(e,t).pipe(ei(s=>s?this._container.mouseService.documentMouseMove$:zi()));this._preventDefaultSubscription=fn(i,this._container.touchService.touchMove$).subscribe(s=>{s.preventDefault()});let r=this._container.touchService.singleTouchDragStart$.pipe(it(()=>!0)),o=this._container.touchService.singleTouchDragEnd$.pipe(it(()=>!1));this._activeTouchSubscription=fn(r,o).subscribe(this._container.touchService.activate$);const c=this._navigator.stateService.currentState$.pipe(it(s=>ki(s.state.currentImage.cameraType)||s.state.imagesAhead<1),yi(),ei(s=>{if(!s)return zi();const d=Zx.filteredPairwiseMouseDrag$(this._component.name,this._container.mouseService),p=fn(this._container.touchService.singleTouchDragStart$,this._container.touchService.singleTouchDrag$,this._container.touchService.singleTouchDragEnd$.pipe(it(()=>null))).pipe(it(g=>g!=null&&g.touches.length>0?g.touches[0]:null),il(),oi(g=>g[0]!=null&&g[1]!=null));return fn(d,p)}),Ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$,this._navigator.panService.panImages$),it(([s,d,p,g])=>{let _=s[0],x=s[1],b=x.clientX-_.clientX,S=x.clientY-_.clientY,P=this._container.container,[L,E]=this._viewportCoords.canvasPosition(x,P),C=this._viewportCoords.unprojectFromCanvas(L,E,P,d.perspective).sub(d.perspective.position),D=this._viewportCoords.unprojectFromCanvas(L-b,E,P,d.perspective).sub(d.perspective.position),O=this._viewportCoords.unprojectFromCanvas(L,E-S,P,d.perspective).sub(d.perspective.position),U=(b>0?1:-1)*D.angleTo(C),q=(S>0?-1:1)*O.angleTo(C);const G=Fw(p,d.perspective,this._viewportCoords);for(const[,N]of g){const V=Fw(N,d.perspective,this._viewportCoords);for(let j=0;j<G.length;j++)V[j]<G[j]&&(G[j]=V[j])}return G[0]>0&&q<0&&(q/=Math.max(1,200*G[0])),G[2]>0&&q>0&&(q/=Math.max(1,200*G[2])),G[1]>0&&U<0&&(U/=Math.max(1,200*G[1])),G[3]>0&&U>0&&(U/=Math.max(1,200*G[3])),{phi:U,theta:q}}),dn());this._rotateWithoutInertiaSubscription=c.subscribe(s=>{this._navigator.stateService.rotateWithoutInertia(s)}),this._rotateSubscription=c.pipe(Vr((s,d)=>(this._drainBuffer(s),s.push([Date.now(),d]),s),[]),jW(fn(this._container.mouseService.filtered$(this._component.name,this._container.mouseService.mouseDragEnd$),this._container.touchService.singleTouchDragEnd$)),it(s=>{const d=this._drainBuffer(s.slice()),p={phi:0,theta:0};for(const x of d)p.phi+=x[1].phi,p.theta+=x[1].theta;const g=d.length;g>0&&(p.phi/=g,p.theta/=g);const _=Math.PI/18;return p.phi=this._spatial.clamp(p.phi,-_,_),p.theta=this._spatial.clamp(p.theta,-_,_),p})).subscribe(s=>{this._navigator.stateService.rotate(s)})}_disable(){this._activeMouseSubscription.unsubscribe(),this._activeTouchSubscription.unsubscribe(),this._preventDefaultSubscription.unsubscribe(),this._rotateSubscription.unsubscribe(),this._rotateWithoutInertiaSubscription.unsubscribe(),this._activeMouseSubscription=null,this._activeTouchSubscription=null,this._preventDefaultSubscription=null,this._rotateSubscription=null}_getConfiguration(e){return{dragPan:e}}_drainBuffer(e){const i=Date.now();for(;e.length>0&&i-e[0][0]>50;)e.shift();return e}}class Ine extends wu{constructor(e,t,i,r,o){super(e,t,i),this._spatial=o,this._viewportCoords=r,this._subscriptions=new yo}_enable(){const e=this._navigator.stateService.state$.pipe(it(i=>i===Oi.Earth),Pi(1),gi()),t=this._subscriptions;t.push(e.pipe(ei(i=>i?this._container.mouseService.mouseWheel$:zi())).subscribe(i=>{i.preventDefault()})),t.push(e.pipe(ei(i=>i?Zx.filteredPairwiseMouseDrag$(this._component.name,this._container.mouseService).pipe(oi(([r,o])=>!(r.ctrlKey&&o.ctrlKey))):zi()),Ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$),it(([[i,r],o,c])=>{const s=[0,0,1],d=[0,0,-2],p=this._planeIntersection(r,s,d,o.perspective,this._container.container),g=this._planeIntersection(i,s,d,o.perspective,this._container.container);return!p||!g?null:new Ue().subVectors(p,g).multiplyScalar(-1).toArray()}),oi(i=>!!i)).subscribe(i=>{this._navigator.stateService.truck(i)})),t.push(e.pipe(ei(i=>i?Zx.filteredPairwiseMouseDrag$(this._component.name,this._container.mouseService).pipe(oi(([r,o])=>r.ctrlKey&&o.ctrlKey)):zi()),it(([i,r])=>this._mousePairToRotation(i,r))).subscribe(i=>{this._navigator.stateService.orbit(i)})),t.push(e.pipe(ei(i=>i?Zx.filteredPairwiseMouseRightDrag$(this._component.name,this._container.mouseService).pipe(oi(([r,o])=>!r.ctrlKey&&!o.ctrlKey)):zi()),it(([i,r])=>this._mousePairToRotation(i,r))).subscribe(i=>{this._navigator.stateService.orbit(i)})),t.push(e.pipe(ei(i=>i?this._container.mouseService.filteredWheel$(this._component.name,this._container.mouseService.mouseWheel$):zi()),it(i=>{let r=i.deltaY;i.deltaMode===1?r=40*r:i.deltaMode===2&&(r=800*r);const o=this._viewportCoords.containerToCanvas(this._container.container);return-r/o[1]})).subscribe(i=>{this._navigator.stateService.dolly(i)}))}_disable(){this._subscriptions.unsubscribe()}_getConfiguration(){return{}}_eventToViewport(e,t){const i=this._viewportCoords.canvasPosition(e,t);return this._viewportCoords.canvasToViewport(i[0],i[1],t)}_mousePairToRotation(e,t){const[i,r]=this._eventToViewport(t,this._container.container),[o,c]=this._eventToViewport(e,this._container.container),s=(o-i)*Math.PI,d=(r-c)*Math.PI/2;return{phi:s,theta:d}}_planeIntersection(e,t,i,r,o){const[c,s]=this._viewportCoords.canvasPosition(e,o),d=this._viewportCoords.unprojectFromCanvas(c,s,o,r).sub(r.position).normalize();if(Math.abs(this._spatial.angleToPlane(d.toArray(),t))<Math.PI/90)return null;const p=r.position.clone(),g=new Ue().fromArray(t),_=new Ue().fromArray(i),x=new Ue().subVectors(_,p).dot(g)/d.clone().dot(g),b=new Ue().addVectors(p,d.multiplyScalar(x));return this._viewportCoords.worldToCamera(b.toArray(),r)[2]>0?null:b}}class Rne extends wu{constructor(e,t,i,r){super(e,t,i),this._viewportCoords=r}_enable(){this._container.mouseService.claimWheel(this._component.name,0),this._preventDefaultSubscription=this._container.mouseService.mouseWheel$.subscribe(e=>{e.preventDefault()}),this._zoomSubscription=this._container.mouseService.filteredWheel$(this._component.name,this._container.mouseService.mouseWheel$).pipe(Ui(this._navigator.stateService.currentState$,(e,t)=>[e,t]),oi(e=>{let t=e[1].state;return ki(t.currentImage.cameraType)||t.imagesAhead<1}),it(e=>e[0]),Ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$,(e,t,i)=>[e,t,i])).subscribe(e=>{let t=e[0],i=e[1],r=e[2],o=this._container.container,[c,s]=this._viewportCoords.canvasPosition(t,o),d=this._viewportCoords.unprojectFromCanvas(c,s,o,i.perspective),p=r.projectBasic(d.toArray()),g=t.deltaY;t.deltaMode===1?g=40*g:t.deltaMode===2&&(g=800*g);const _=this._viewportCoords.containerToCanvas(o);let x=-3*g/_[1];this._navigator.stateService.zoomIn(x,p)})}_disable(){this._container.mouseService.unclaimWheel(this._component.name),this._preventDefaultSubscription.unsubscribe(),this._zoomSubscription.unsubscribe(),this._preventDefaultSubscription=null,this._zoomSubscription=null}_getConfiguration(e){return{scrollZoom:e}}}class Lne extends wu{constructor(e,t,i,r){super(e,t,i),this._viewportCoords=r}_enable(){this._preventDefaultSubscription=this._container.touchService.pinch$.subscribe(i=>{i.originalEvent.preventDefault()});let e=this._container.touchService.pinchStart$.pipe(it(i=>!0)),t=this._container.touchService.pinchEnd$.pipe(it(i=>!1));this._activeSubscription=fn(e,t).subscribe(this._container.touchService.activate$),this._zoomSubscription=this._container.touchService.pinch$.pipe(Ui(this._navigator.stateService.currentState$),oi(i=>{let r=i[1].state;return ki(r.currentImage.cameraType)||r.imagesAhead<1}),it(i=>i[0]),Ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$)).subscribe(([i,r,o])=>{let c=this._container.container,[s,d]=this._viewportCoords.canvasPosition(i,c),p=this._viewportCoords.unprojectFromCanvas(s,d,c,r.perspective),g=o.projectBasic(p.toArray());const[_,x]=this._viewportCoords.containerToCanvas(c);let b=3*i.distanceChange/Math.min(_,x);this._navigator.stateService.zoomIn(b,g)})}_disable(){this._activeSubscription.unsubscribe(),this._preventDefaultSubscription.unsubscribe(),this._zoomSubscription.unsubscribe(),this._preventDefaultSubscription=null,this._zoomSubscription=null}_getConfiguration(e){return{touchZoom:e}}}class jB extends bo{constructor(e,t,i){super(e,t,i);const r=new vo,o=new zo;this._bounceHandler=new Ane(this,t,i,o,r),this._dragPanHandler=new Pne(this,t,i,o,r),this._earthControlHandler=new Ine(this,t,i,o,r),this._scrollZoomHandler=new Rne(this,t,i,o),this._touchZoomHandler=new Lne(this,t,i,o)}get dragPan(){return this._dragPanHandler}get earthControl(){return this._earthControlHandler}get scrollZoom(){return this._scrollZoomHandler}get touchZoom(){return this._touchZoomHandler}_activate(){this._bounceHandler.enable(),this._subscriptions.push(this._configuration$.subscribe(e=>{e.dragPan?this._dragPanHandler.enable():this._dragPanHandler.disable(),e.earthControl?this._earthControlHandler.enable():this._earthControlHandler.disable(),e.scrollZoom?this._scrollZoomHandler.enable():this._scrollZoomHandler.disable(),e.touchZoom?this._touchZoomHandler.enable():this._touchZoomHandler.disable()})),this._container.mouseService.claimMouse(this._name,0)}_deactivate(){this._container.mouseService.unclaimMouse(this._name),this._subscriptions.unsubscribe(),this._bounceHandler.disable(),this._dragPanHandler.disable(),this._earthControlHandler.disable(),this._scrollZoomHandler.disable(),this._touchZoomHandler.disable()}_getDefaultConfiguration(){return{dragPan:!0,earthControl:!0,scrollZoom:!0,touchZoom:!0}}}jB.componentName="pointer";class rE{constructor(e){this._document=e||document}get document(){return this._document}createElement(e,t,i){const r=this._document.createElement(e);return t&&(r.className=t),i&&i.appendChild(r),r}}class GB extends bo{constructor(e,t,i,r){super(e,t,i),this._dom=r||new rE,this._popups=[],this._added$=new ri,this._popups$=new ri}add(e){for(const t of e)this._popups.indexOf(t)===-1&&(this._popups.push(t),this._activated&&t.setParentContainer(this._popupContainer));this._added$.next(e),this._popups$.next(this._popups)}getAll(){return this._popups.slice()}remove(e){for(const t of e)this._remove(t);this._popups$.next(this._popups)}removeAll(){for(const e of this._popups.slice())this._remove(e);this._popups$.next(this._popups)}_activate(){this._popupContainer=this._dom.createElement("div","mapillary-popup-container",this._container.container);for(const i of this._popups)i.setParentContainer(this._popupContainer);const e=this._subscriptions;e.push(Si(this._container.renderService.renderCamera$,this._container.renderService.size$,this._navigator.stateService.currentTransform$).subscribe(([i,r,o])=>{for(const c of this._popups)c.update(i,r,o)}));const t=this._popups$.pipe(An(this._popups),ei(i=>Fr(i).pipe(Hi(r=>r.changed$))),it(i=>[i]));e.push(fn(this._added$,t).pipe(Ui(this._container.renderService.renderCamera$,this._container.renderService.size$,this._navigator.stateService.currentTransform$)).subscribe(([i,r,o,c])=>{for(const s of i)s.update(r,o,c)}))}_deactivate(){this._subscriptions.unsubscribe();for(const e of this._popups)e.remove();this._container.container.removeChild(this._popupContainer),delete this._popupContainer}_getDefaultConfiguration(){return{}}_remove(e){const t=this._popups.indexOf(e);if(t===-1)return;const i=this._popups.splice(t,1)[0];this._activated&&i.remove()}}GB.componentName="popup";var ra;(function(n){n[n.Sequence=0]="Sequence",n[n.Spatial=1]="Spatial"})(ra||(ra={}));var fo;(function(n){n[n.Default=0]="Default",n[n.Playback=1]="Playback",n[n.Timeline=2]="Timeline"})(fo||(fo={}));class kne{constructor(e){this._container=e,this._minThresholdWidth=320,this._maxThresholdWidth=1480,this._minThresholdHeight=240,this._maxThresholdHeight=820,this._stepperDefaultWidth=108,this._controlsDefaultWidth=88,this._defaultHeight=30,this._expandControls=!1,this._mode=fo.Default,this._speed=.5,this._changingSpeed=!1,this._index=null,this._changingPosition=!1,this._mouseEnterDirection$=new ri,this._mouseLeaveDirection$=new ri,this._notifyChanged$=new ri,this._notifyChangingPositionChanged$=new ri,this._notifySpeedChanged$=new ri,this._notifyIndexChanged$=new ri}get changed$(){return this._notifyChanged$}get changingPositionChanged$(){return this._notifyChangingPositionChanged$}get speed$(){return this._notifySpeedChanged$}get index$(){return this._notifyIndexChanged$}get mouseEnterDirection$(){return this._mouseEnterDirection$}get mouseLeaveDirection$(){return this._mouseLeaveDirection$}activate(){this._changingSubscription||(this._changingSubscription=fn(this._container.mouseService.documentMouseUp$,this._container.touchService.touchEnd$.pipe(oi(e=>e.touches.length===0))).subscribe(()=>{this._changingSpeed&&(this._changingSpeed=!1),this._changingPosition&&this._setChangingPosition(!1)}))}deactivate(){this._changingSubscription&&(this._changingSpeed=!1,this._changingPosition=!1,this._expandControls=!1,this._mode=fo.Default,this._changingSubscription.unsubscribe(),this._changingSubscription=null)}render(e,t,i,r,o,c,s,d,p){if(t.visible===!1)return Gt.h("div.mapillary-sequence-container",{},[]);const g=this._createStepper(e,t,s,i,d,p),_=this._createSequenceControls(i),x=this._createPlaybackControls(i,r,d,t),b=this._createTimelineControls(i,o,c);return Gt.h("div.mapillary-sequence-container",[g,_,x,b])}getContainerWidth(e,t){let i=t.minWidth,r=t.maxWidth;r<i&&(r=i);let o=(e.width-this._minThresholdWidth)/(this._maxThresholdWidth-this._minThresholdWidth),c=(e.height-this._minThresholdHeight)/(this._maxThresholdHeight-this._minThresholdHeight),s=Math.max(0,Math.min(1,Math.min(o,c)));return i+s*(r-i)}_createPositionInput(e,t){this._index=e;const i=b=>{this._index=Number(b.target.value),this._notifyIndexChanged$.next(this._index)},r=this._container.domContainer.getBoundingClientRect(),o=Math.max(276,Math.min(410,5+.8*r.width))-65,c=b=>{b.stopPropagation(),this._setChangingPosition(!0)},s=b=>{this._changingPosition===!0&&b.stopPropagation()},p={max:t??1,min:0,onchange:i,oninput:i,onkeydown:b=>{(b.key==="ArrowDown"||b.key==="ArrowLeft"||b.key==="ArrowRight"||b.key==="ArrowUp")&&b.preventDefault()},onpointerdown:c,onpointermove:s,ontouchmove:s,ontouchstart:c,style:{width:`${o}px`},type:"range",value:e??0},g=e==null||t==null||t<=1;g&&(p.disabled="true");const _=Gt.h("input.mapillary-sequence-position",p,[]),x=g?".mapillary-sequence-position-container-inactive":".mapillary-sequence-position-container";return Gt.h("div"+x,[_])}_createSpeedInput(e){this._speed=e;const t=p=>{this._speed=Number(p.target.value)/1e3,this._notifySpeedChanged$.next(this._speed)},i=this._container.domContainer.getBoundingClientRect(),r=Math.max(276,Math.min(410,5+.8*i.width))-160,o=p=>{this._changingSpeed=!0,p.stopPropagation()},c=p=>{this._changingSpeed===!0&&p.stopPropagation()},s=p=>{(p.key==="ArrowDown"||p.key==="ArrowLeft"||p.key==="ArrowRight"||p.key==="ArrowUp")&&p.preventDefault()},d=Gt.h("input.mapillary-sequence-speed",{max:1e3,min:0,onchange:t,oninput:t,onkeydown:s,onpointerdown:o,onpointermove:c,ontouchmove:c,ontouchstart:o,style:{width:`${r}px`},type:"range",value:1e3*e},[]);return Gt.h("div.mapillary-sequence-speed-container",[d])}_createPlaybackControls(e,t,i,r){if(this._mode!==fo.Playback)return Gt.h("div.mapillary-sequence-playback",[]);const o=Gt.h("div.mapillary-sequence-switch-icon.mapillary-sequence-icon-visible",[]),c=r.direction===Vt.Next?Vt.Prev:Vt.Next,s=r.playing,d={onclick:()=>{s||i.configure({direction:c})}},p=r.playing?".mapillary-sequence-switch-button-inactive":".mapillary-sequence-switch-button",g=Gt.h("div"+p,d,[o]),_=Gt.h("div.mapillary-sequence-slow-icon.mapillary-sequence-icon-visible",[]),x=Gt.h("div.mapillary-sequence-slow-container",[_]),b=Gt.h("div.mapillary-sequence-fast-icon.mapillary-sequence-icon-visible",[]),S=Gt.h("div.mapillary-sequence-fast-container",[b]),P=Gt.h("div.mapillary-sequence-close-icon.mapillary-sequence-icon-visible",[]),L={onclick:()=>{this._mode=fo.Default,this._notifyChanged$.next(this)}},E=Gt.h("div.mapillary-sequence-close-button",L,[P]),C=this._createSpeedInput(t),D=[g,x,C,S,E],U={style:{top:`${Math.round(e/this._stepperDefaultWidth*this._defaultHeight+10)}px`}};return Gt.h("div.mapillary-sequence-playback",U,D)}_createPlayingButton(e,t,i,r,o){let c=r.direction===Vt.Next&&e!=null||r.direction===Vt.Prev&&t!=null;c=c&&i;let d={onclick:r.playing?()=>{o.stop()}:c?()=>{o.play()}:null},p={};r.direction===Vt.Prev&&(p.style={transform:"rotate(180deg) translate(50%, 50%)"});let g=Gt.h("div.mapillary-sequence-icon",p,[]),_=r.playing?"mapillary-sequence-stop":c?"mapillary-sequence-play":"mapillary-sequence-play-inactive";return Gt.h("div."+_,d,[g])}_createSequenceControls(e){const t=Math.round(8/this._stepperDefaultWidth*e),i={onclick:()=>{this._expandControls=!this._expandControls,this._mode=fo.Default,this._notifyChanged$.next(this)},style:{"border-bottom-right-radius":`${t}px`,"border-top-right-radius":`${t}px`}},r=Gt.h("div.mapillary-sequence-expander-bar",[]),o=Gt.h("div.mapillary-sequence-expander-button",i,[r]),c=this._mode===fo.Playback?".mapillary-sequence-fast-icon-gray.mapillary-sequence-icon-visible":".mapillary-sequence-fast-icon",s=Gt.h("div"+c,[]),d={onclick:()=>{this._mode=this._mode===fo.Playback?fo.Default:fo.Playback,this._notifyChanged$.next(this)}},p=Gt.h("div.mapillary-sequence-playback-button",d,[s]),g=this._mode===fo.Timeline?".mapillary-sequence-timeline-icon-gray.mapillary-sequence-icon-visible":".mapillary-sequence-timeline-icon",_=Gt.h("div"+g,[]),x={onclick:()=>{this._mode=this._mode===fo.Timeline?fo.Default:fo.Timeline,this._notifyChanged$.next(this)}},b=Gt.h("div.mapillary-sequence-timeline-button",x,[_]),S={style:{height:this._defaultHeight/this._stepperDefaultWidth*e+"px",transform:`translate(${e/2+2}px, 0)`,width:this._controlsDefaultWidth/this._stepperDefaultWidth*e+"px"}},P=".mapillary-sequence-controls"+(this._expandControls?".mapillary-sequence-controls-expanded":"");return Gt.h("div"+P,S,[p,b,o])}_createSequenceArrows(e,t,i,r,o){let c={onclick:e!=null?()=>{o.moveDir$(Vt.Next).subscribe(void 0,b=>{b instanceof Vl||console.error(b)})}:null,onpointerenter:()=>{this._mouseEnterDirection$.next(Vt.Next)},onpointerleave:()=>{this._mouseLeaveDirection$.next(Vt.Next)}};const s=Math.round(8/this._stepperDefaultWidth*i);let d={onclick:t!=null?()=>{o.moveDir$(Vt.Prev).subscribe(void 0,b=>{b instanceof Vl||console.error(b)})}:null,onpointerenter:()=>{this._mouseEnterDirection$.next(Vt.Prev)},onpointerleave:()=>{this._mouseLeaveDirection$.next(Vt.Prev)},style:{"border-bottom-left-radius":`${s}px`,"border-top-left-radius":`${s}px`}},p=this._getStepClassName(Vt.Next,e,r.highlightId),g=this._getStepClassName(Vt.Prev,t,r.highlightId),_=Gt.h("div.mapillary-sequence-icon",[]),x=Gt.h("div.mapillary-sequence-icon",[]);return[Gt.h("div."+g,d,[x]),Gt.h("div."+p,c,[_])]}_createStepper(e,t,i,r,o,c){let s=null,d=null;for(let x of e.edges)x.data.direction===Vt.Next&&(s=x.target),x.data.direction===Vt.Prev&&(d=x.target);const p=this._createPlayingButton(s,d,i,t,o),g=this._createSequenceArrows(s,d,r,t,c);g.splice(1,0,p);const _={oncontextmenu:x=>{x.preventDefault()},style:{height:this._defaultHeight/this._stepperDefaultWidth*r+"px",width:r+"px"}};return Gt.h("div.mapillary-sequence-stepper",_,g)}_createTimelineControls(e,t,i){if(this._mode!==fo.Timeline)return Gt.h("div.mapillary-sequence-timeline",[]);const r=this._createPositionInput(t,i),o=Gt.h("div.mapillary-sequence-close-icon.mapillary-sequence-icon-visible",[]),c={onclick:()=>{this._mode=fo.Default,this._notifyChanged$.next(this)}},s=Gt.h("div.mapillary-sequence-close-button",c,[o]),p={style:{top:`${Math.round(e/this._stepperDefaultWidth*this._defaultHeight+10)}px`}};return Gt.h("div.mapillary-sequence-timeline",p,[r,s])}_getStepClassName(e,t,i){let r=e===Vt.Next?"mapillary-sequence-step-next":"mapillary-sequence-step-prev";return t==null?r+="-inactive":i===t&&(r+="-highlight"),r}_setChangingPosition(e){this._changingPosition=e,this._notifyChangingPositionChanged$.next(e)}}class qB extends bo{constructor(e,t,i,r,o){super(e,t,i),this._sequenceDOMRenderer=r||new kne(t),this._scheduler=o,this._containerWidth$=new ri,this._hoveredIdSubject$=new ri,this._hoveredId$=this._hoveredIdSubject$.pipe(dn()),this._navigator.playService.playing$.pipe(Ys(1),Ui(this._configuration$)).subscribe(([c,s])=>{const d="playing",p={playing:c,target:this,type:d};this.fire(d,p),c!==s.playing&&(c?this.play():this.stop())}),this._navigator.playService.direction$.pipe(Ys(1),Ui(this._configuration$)).subscribe(([c,s])=>{c!==s.direction&&this.configure({direction:c})})}fire(e,t){super.fire(e,t)}off(e,t){super.off(e,t)}on(e,t){super.on(e,t)}play(){this.configure({playing:!0})}stop(){this.configure({playing:!1})}_activate(){this._sequenceDOMRenderer.activate();const e=this._navigator.stateService.currentImage$.pipe(ei(s=>s.sequenceEdges$),Pi(1),gi()),t=this._navigator.stateService.currentImage$.pipe(yi(void 0,s=>s.sequenceId),ei(s=>Ul(Ai(null),this._navigator.graphService.cacheSequence$(s.sequenceId).pipe(e2(3),$n(d=>(console.error("Failed to cache sequence",d),Ai(null)))))),An(null),Pi(1),gi()),i=this._subscriptions;i.push(t.subscribe());const r=this._sequenceDOMRenderer.index$.pipe(Ui(t),it(([s,d])=>d!=null?d.imageIds[s]:null),oi(s=>!!s),yi(),Ka(),gi());i.push(fn(r.pipe(Fy(100,this._scheduler)),r.pipe(BO(400,this._scheduler))).pipe(yi(),ei(s=>this._navigator.moveTo$(s).pipe($n(()=>zi())))).subscribe()),i.push(this._sequenceDOMRenderer.changingPositionChanged$.pipe(oi(s=>s)).subscribe(()=>{this._navigator.graphService.setGraphMode(ra.Sequence)})),i.push(this._sequenceDOMRenderer.changingPositionChanged$.pipe(oi(s=>!s)).subscribe(()=>{this._navigator.graphService.setGraphMode(ra.Spatial)})),this._navigator.graphService.graphMode$.pipe(ei(s=>s===ra.Spatial?this._navigator.stateService.currentImage$.pipe($l(2)):zi()),oi(s=>!s.spatialEdges.cached),ei(s=>this._navigator.graphService.cacheImage$(s.id).pipe($n(()=>zi())))).subscribe(),i.push(this._sequenceDOMRenderer.changingPositionChanged$.pipe(oi(s=>s)).subscribe(()=>{this._navigator.playService.stop()})),i.push(Si(this._navigator.graphService.graphMode$,this._sequenceDOMRenderer.changingPositionChanged$.pipe(An(!1),yi())).pipe(Ui(this._navigator.stateService.currentImage$),ei(([[s,d],p])=>d&&s===ra.Sequence?this._navigator.graphService.cacheSequenceImages$(p.sequenceId,p.id).pipe(e2(3),$n(g=>(console.error("Failed to cache sequence images.",g),zi()))):zi())).subscribe());const o=t.pipe(ei(s=>{if(!s)return Ai({index:null,max:null});let d=!0;return this._sequenceDOMRenderer.changingPositionChanged$.pipe(An(!1),yi(),ei(p=>{const g=!p&&d?0:1;return d=!1,p?r:this._navigator.stateService.currentImage$.pipe(it(_=>_.id),yi(),Ys(g))}),it(p=>{const g=s.imageIds.indexOf(p);return g===-1?{index:null,max:null}:{index:g,max:s.imageIds.length-1}}))})),c=this._navigator.stateService.state$.pipe(it(s=>s===Oi.Earth),yi());i.push(Si(e,this._configuration$,this._containerWidth$,this._sequenceDOMRenderer.changed$.pipe(An(this._sequenceDOMRenderer)),this._navigator.playService.speed$,o,c).pipe(it(([s,d,p,,g,_,x])=>{const b=this._sequenceDOMRenderer.render(s,d,p,g,_.index,_.max,!x,this,this._navigator);return{name:this._name,vNode:b}})).subscribe(this._container.domRenderer.render$)),i.push(this._sequenceDOMRenderer.speed$.subscribe(s=>{this._navigator.playService.setSpeed(s)})),i.push(this._configuration$.pipe(it(s=>s.direction),yi()).subscribe(s=>{this._navigator.playService.setDirection(s)})),i.push(Si(this._container.renderService.size$,this._configuration$.pipe(yi((s,d)=>s[0]===d[0]&&s[1]===d[1],s=>[s.minWidth,s.maxWidth]))).pipe(it(([s,d])=>this._sequenceDOMRenderer.getContainerWidth(s,d))).subscribe(this._containerWidth$)),i.push(this._configuration$.pipe(it(s=>s.playing),yi()).subscribe(s=>{s?this._navigator.playService.play():this._navigator.playService.stop()})),i.push(this._sequenceDOMRenderer.mouseEnterDirection$.pipe(ei(s=>{const d=e.pipe(it(p=>{for(let g of p.edges)if(g.data.direction===s)return g.target;return null}),Td(this._sequenceDOMRenderer.mouseLeaveDirection$));return Ul(d,Ai(null))}),yi()).subscribe(this._hoveredIdSubject$)),i.push(this._hoveredId$.subscribe(s=>{const d="hover",p={id:s,target:this,type:d};this.fire(d,p)}))}_deactivate(){this._subscriptions.unsubscribe(),this._sequenceDOMRenderer.deactivate()}_getDefaultConfiguration(){return{direction:Vt.Next,maxWidth:108,minWidth:70,playing:!1,visible:!0}}}qB.componentName="sequence";var Dl;(function(n){n[n.Motion=0]="Motion",n[n.Stationary=1]="Stationary"})(Dl||(Dl={}));const Dne=1e-8;class Lg{constructor(e,t,i,r,o,c,s,d,p,g){this._orientation=this._getValue(e,1);let _=s!=null?s.width:4,x=s!=null?s.height:3,b=this._orientation<5;this._width=this._getValue(t,b?_:x),this._height=this._getValue(i,b?x:_),this._basicAspect=b?this._width/this._height:this._height/this._width,this._basicWidth=b?t:i,this._basicHeight=b?i:t;const S=this._getCameraParameters(p,g),P=S[0],L=S[1],E=S[2];this._focal=this._getValue(P,1),this._scale=this._getValue(r,0),this._worldToCamera=this.createWorldToCamera(o,c),this._worldToCameraInverse=new Li().copy(this._worldToCamera).invert(),this._scaledWorldToCamera=this._createScaledWorldToCamera(this._worldToCamera,this._scale),this._scaledWorldToCameraInverse=new Li().copy(this._scaledWorldToCamera).invert(),this._basicWorldToCamera=this._createBasicWorldToCamera(this._worldToCamera,e),this._textureScale=d||[1,1],this._ck1=L||0,this._ck2=E||0,this._cameraType=g||"perspective",this._radialPeak=this._getRadialPeak(this._ck1,this._ck2)}get ck1(){return this._ck1}get ck2(){return this._ck2}get cameraType(){return this._cameraType}get basicAspect(){return this._basicAspect}get basicHeight(){return this._basicHeight}get basicRt(){return this._basicWorldToCamera}get basicWidth(){return this._basicWidth}get focal(){return this._focal}get height(){return this._height}get orientation(){return this._orientation}get rt(){return this._worldToCamera}get srt(){return this._scaledWorldToCamera}get srtInverse(){return this._scaledWorldToCameraInverse}get scale(){return this._scale}get hasValidScale(){return this._scale>.01&&this._scale<50}get radialPeak(){return this._radialPeak}get width(){return this._width}upVector(){let e=this._worldToCamera.elements;switch(this._orientation){case 1:return new Ue(-e[1],-e[5],-e[9]);case 3:return new Ue(e[1],e[5],e[9]);case 6:return new Ue(-e[0],-e[4],-e[8]);case 8:return new Ue(e[0],e[4],e[8]);default:return new Ue(-e[1],-e[5],-e[9])}}projectorMatrix(){let e=this._normalizedToTextureMatrix(),t=this._focal,i=new Li().set(t,0,0,0,0,t,0,0,0,0,0,0,0,0,1,0);return e.multiply(i),e.multiply(this._worldToCamera),e}projectBasic(e){let t=this.projectSfM(e);return this._sfmToBasic(t)}unprojectBasic(e,t,i){let r=this._basicToSfm(e);return this.unprojectSfM(r,t,i)}projectSfM(e){let t=new Zn(e[0],e[1],e[2],1);return t.applyMatrix4(this._worldToCamera),this._bearingToSfm([t.x,t.y,t.z])}unprojectSfM(e,t,i){const r=this._sfmToBearing(e),c=(i&&!ki(this._cameraType)?new Zn(t*r[0]/r[2],t*r[1]/r[2],t,1):new Zn(t*r[0],t*r[1],t*r[2],1)).applyMatrix4(this._worldToCameraInverse);return[c.x/c.w,c.y/c.w,c.z/c.w]}_sfmToBearing(e){if(ki(this._cameraType)){let t=e[0]*2*Math.PI,i=-e[1]*2*Math.PI,r=Math.cos(i)*Math.sin(t),o=-Math.sin(i),c=Math.cos(i)*Math.cos(t);return[r,o,c]}else if(Iw(this._cameraType)){let[t,i]=[e[0]/this._focal,e[1]/this._focal];const r=Math.sqrt(t*t+i*i);let o=this._distortionFromDistortedRadius(r,this._ck1,this._ck2,this._radialPeak),c=r/o,s=Math.cos(c),d=Math.sin(c);const p=r>Dne?1/r:1;let g=d*t*p,_=d*i*p;return[g,_,s]}else{let[t,i]=[e[0]/this._focal,e[1]/this._focal];const r=Math.sqrt(t*t+i*i);let o=this._distortionFromDistortedRadius(r,this._ck1,this._ck2,this._radialPeak);const c=t/o,s=i/o;let d=new Ue(c,s,1);return d.normalize(),[d.x,d.y,d.z]}}_distortionFromDistortedRadius(e,t,i,r){let o=1;for(let c=0;c<10;c++){let s=e/o;s>r&&(s=r),o=1+t*Math.pow(s,2)+i*Math.pow(s,4)}return o}_bearingToSfm(e){if(ki(this._cameraType)){let t=e[0],i=e[1],r=e[2],o=Math.atan2(t,r),c=Math.atan2(-i,Math.sqrt(t*t+r*r));return[o/(2*Math.PI),-c/(2*Math.PI)]}else if(Iw(this._cameraType))if(e[2]>0){const[t,i,r]=e,o=Math.sqrt(t*t+i*i);let c=Math.atan2(o,r);c>this._radialPeak&&(c=this._radialPeak);const s=1+Math.pow(c,2)*(this._ck1+Math.pow(c,2)*this._ck2),d=this._focal*s*c/o;return[d*t,d*i]}else return[e[0]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,e[1]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY];else if(e[2]>0){let[t,i]=[e[0]/e[2],e[1]/e[2]],r=t*t+i*i;const o=Math.pow(this._radialPeak,2);r>o&&(r=o);const c=1+this._ck1*r+this._ck2*Math.pow(r,2);return[this._focal*c*t,this._focal*c*i]}else return[e[0]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,e[1]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY]}_basicToSfm(e){let t,i;switch(this._orientation){case 1:t=e[0],i=e[1];break;case 3:t=1-e[0],i=1-e[1];break;case 6:t=e[1],i=1-e[0];break;case 8:t=1-e[1],i=e[0];break;default:t=e[0],i=e[1];break}let r=this._width,o=this._height,c=Math.max(r,o),s=t*r/c-r/c/2,d=i*o/c-o/c/2;return[s,d]}_sfmToBasic(e){let t=this._width,i=this._height,r=Math.max(t,i),o=(e[0]+t/r/2)/t*r,c=(e[1]+i/r/2)/i*r,s,d;switch(this._orientation){case 1:s=o,d=c;break;case 3:s=1-o,d=1-c;break;case 6:s=1-c,d=o;break;case 8:s=c,d=1-o;break;default:s=o,d=c;break}return[s,d]}_getValue(e,t){return e!=null&&e>0?e:t}_getCameraParameters(e,t){if(ki(t))return[];if(!e||e.length===0)return[1,0,0];const i=3-e.length;return i<=0?e:e.concat(new Array(i).fill(0))}createWorldToCamera(e,t){const i=new Ue(e[0],e[1],e[2]),r=i.length();r>0&&i.normalize();const o=new Li;return o.makeRotationAxis(i,r),o.setPosition(new Ue(t[0],t[1],t[2])),o}_createScaledWorldToCamera(e,t){const i=e.clone(),r=i.elements;return r[12]=t*r[12],r[13]=t*r[13],r[14]=t*r[14],i.scale(new Ue(t,t,t)),i}_createBasicWorldToCamera(e,t){const i=new Ue(0,0,1);let r=0;switch(t){case 3:r=Math.PI;break;case 6:r=Math.PI/2;break;case 8:r=3*Math.PI/2;break}return new Li().makeRotationAxis(i,r).multiply(e)}_getRadialPeak(e,t){const i=5*t,r=3*e,c=Math.pow(r,2)-4*i*1;if(c<0)return;const s=(-r-Math.sqrt(c))/2/i,d=(-r+Math.sqrt(c))/2/i,p=Math.min(s,d),g=Math.max(s,d);return p>0?Math.sqrt(p):g>0?Math.sqrt(g):void 0}_normalizedToTextureMatrix(){const e=Math.max(this._width,this._height),t=this._orientation<5?this._textureScale[0]:this._textureScale[1],i=this._orientation<5?this._textureScale[1]:this._textureScale[0],r=e/this._width*t,o=e/this._height*i;switch(this._orientation){case 1:return new Li().set(r,0,0,.5,0,-o,0,.5,0,0,1,0,0,0,0,1);case 3:return new Li().set(-r,0,0,.5,0,o,0,.5,0,0,1,0,0,0,0,1);case 6:return new Li().set(0,-o,0,.5,-r,0,0,.5,0,0,1,0,0,0,0,1);case 8:return new Li().set(0,o,0,.5,r,0,0,.5,0,0,1,0,0,0,0,1);default:return new Li().set(r,0,0,.5,0,-o,0,.5,0,0,1,0,0,0,0,1)}}}class Fne{constructor(){this._factory=new LB,this._scene=new kB,this._spatial=new vo,this._currentKey=null,this._previousKey=null,this._disabled=!1,this._curtain=1,this._frameId=0,this._needsRender=!1,this._mode=null,this._currentProviderDisposers={},this._previousProviderDisposers={}}get disabled(){return this._disabled}get frameId(){return this._frameId}get needsRender(){return this._needsRender}setTextureProvider(e,t){this._setTextureProvider(e,this._currentKey,t,this._currentProviderDisposers,this._updateTexture.bind(this))}setTextureProviderPrev(e,t){this._setTextureProvider(e,this._previousKey,t,this._previousProviderDisposers,this._updateTexturePrev.bind(this))}update(e,t){this._updateFrameId(e.id),this._updateImagePlanes(e.state,t)}updateCurtain(e){this._curtain!==e&&(this._curtain=e,this._updateCurtain(),this._needsRender=!0)}updateTexture(e,t){const i=t.id===this._currentKey?this._scene.planes:t.id===this._previousKey?this._scene.planesOld:{};if(Object.keys(i).length!==0){this._needsRender=!0;for(const r in i){if(!i.hasOwnProperty(r))continue;let s=i[r].material.uniforms.projectorTex.value;s.image=e,s.needsUpdate=!0}}}updateTextureImage(e,t){if(this._currentKey!==t.id)return;this._needsRender=!0;const i=this._scene.planes;for(const r in i){if(!i.hasOwnProperty(r))continue;let s=i[r].material.uniforms.projectorTex.value;s.image=e,s.needsUpdate=!0}}render(e,t){this.disabled||t.render(this._scene.sceneOld,e),t.render(this._scene.scene,e),this._needsRender=!1}dispose(){this._scene.clear();for(const e in this._currentProviderDisposers)this._currentProviderDisposers.hasOwnProperty(e)&&this._currentProviderDisposers[e]();for(const e in this._previousProviderDisposers)this._previousProviderDisposers.hasOwnProperty(e)&&this._previousProviderDisposers[e]();this._currentProviderDisposers={},this._previousProviderDisposers={}}_getBasicCorners(e,t){let i,r;return e>t?(i=.5,r=.5*e/t):(i=.5*t/e,r=.5),[[.5-i,.5-r],[.5+i,.5+r]]}_setDisabled(e){this._disabled=e.currentImage==null||e.previousImage==null||ki(e.currentImage.cameraType)&&!ki(e.previousImage.cameraType)}_setTextureProvider(e,t,i,r,o){if(e!==t)return;let c=i.textureCreated$.subscribe(o),s=i.textureUpdated$.subscribe(p=>{this._needsRender=!0}),d=()=>{c.unsubscribe(),s.unsubscribe(),i.dispose()};if(e in r){let p=r[e];p(),delete r[e]}r[e]=d}_updateCurtain(){const e=this._scene.planes;for(const t in e){if(!e.hasOwnProperty(t))continue;let r=e[t].material;r.uniforms.curtain&&(r.uniforms.curtain.value=this._curtain)}}_updateFrameId(e){this._frameId=e}_updateImagePlanes(e,t){const i=e.currentImage!=null&&this._currentKey!==e.currentImage.id,r=e.previousImage!=null&&this._previousKey!==e.previousImage.id,o=this._mode!==t;if(!(i||r||o))return;this._setDisabled(e),this._needsRender=!0,this._mode=t;const c=e.motionless||t===Dl.Stationary||ki(e.currentImage.cameraType);if((this.disabled||r)&&this._previousKey in this._previousProviderDisposers&&(this._previousProviderDisposers[this._previousKey](),delete this._previousProviderDisposers[this._previousKey]),this.disabled)this._scene.setImagePlanesOld({});else if(r||o){const s=e.previousImage;this._previousKey=s.id;const d=e.currentTransform.rt.elements;let p=[d[12],d[13],d[14]];const g=e.currentTransform.basicAspect,_=e.previousTransform.basicAspect,x=g>_?[1,_/g]:[g/_,1];let b=e.currentImage.rotation,S=e.currentImage.width,P=e.currentImage.height;ki(s.cameraType)&&(b=e.previousImage.rotation,p=this._spatial.rotate(this._spatial.opticalCenter(e.currentImage.rotation,p).toArray(),b).multiplyScalar(-1).toArray(),S=e.previousImage.width,P=e.previousImage.height);const L=new Lg(e.currentImage.exifOrientation,S,P,e.currentImage.scale,b,p,s.image,x,e.currentImage.cameraParameters,e.currentImage.cameraType);let E;if(ki(s.cameraType))E=this._factory.createMesh(s,c||ki(e.currentImage.cameraType)?L:e.previousTransform);else if(c){const[[D,O],[U,q]]=this._getBasicCorners(g,_);E=this._factory.createFlatMesh(e.previousImage,L,D,U,O,q)}else E=this._factory.createMesh(e.previousImage,e.previousTransform);const C={};C[s.id]=E,this._scene.setImagePlanesOld(C)}if(i||o){this._currentKey in this._currentProviderDisposers&&(this._currentProviderDisposers[this._currentKey](),delete this._currentProviderDisposers[this._currentKey]),this._currentKey=e.currentImage.id;const s={};ki(e.currentImage.cameraType)?s[e.currentImage.id]=this._factory.createCurtainMesh(e.currentImage,e.currentTransform):c?s[e.currentImage.id]=this._factory.createDistortedCurtainMesh(e.currentImage,e.currentTransform):s[e.currentImage.id]=this._factory.createCurtainMesh(e.currentImage,e.currentTransform),this._scene.setImagePlanes(s),this._updateCurtain()}}_updateTexture(e){this._needsRender=!0;const t=this._scene.planes;for(const i in t){if(!t.hasOwnProperty(i))continue;let o=t[i].material,c=o.uniforms.projectorTex.value;o.uniforms.projectorTex.value=null,c.dispose(),o.uniforms.projectorTex.value=e}}_updateTexturePrev(e){this._needsRender=!0;const t=this._scene.planesOld;for(const i in t){if(!t.hasOwnProperty(i))continue;let o=t[i].material,c=o.uniforms.projectorTex.value;o.uniforms.projectorTex.value=null,c.dispose(),o.uniforms.projectorTex.value=e}}}class One{constructor(e){this._container=e,this._interacting=!1,this._notifyModeChanged$=new ri,this._notifyPositionChanged$=new ri,this._stopInteractionSubscription=null}get mode$(){return this._notifyModeChanged$}get position$(){return this._notifyPositionChanged$}activate(){this._stopInteractionSubscription||(this._stopInteractionSubscription=fn(this._container.mouseService.documentMouseUp$,this._container.touchService.touchEnd$.pipe(oi(e=>e.touches.length===0))).subscribe(e=>{this._interacting&&(this._interacting=!1)}))}deactivate(){this._stopInteractionSubscription&&(this._interacting=!1,this._stopInteractionSubscription.unsubscribe(),this._stopInteractionSubscription=null)}render(e,t,i,r,o){const c=[];if(o){c.push(Gt.h("div.mapillary-slider-border",[]));const p=!(i||r);p&&(c.push(this._createModeButton(t)),c.push(this._createModeButton2d(t))),c.push(this._createPositionInput(e,p))}const s=this._container.domContainer.getBoundingClientRect(),d=Math.max(215,Math.min(400,s.width-100));return Gt.h("div.mapillary-slider-container",{style:{width:`${d}px`}},c)}_createModeButton(e){const t={onclick:()=>{e!==Dl.Motion&&this._notifyModeChanged$.next(Dl.Motion)}},i=e===Dl.Stationary?"mapillary-slider-mode-button-inactive":"mapillary-slider-mode-button";return Gt.h("div."+i,t,[Gt.h("div.mapillary-slider-mode-icon",[])])}_createModeButton2d(e){const t={onclick:()=>{e!==Dl.Stationary&&this._notifyModeChanged$.next(Dl.Stationary)}},i=e===Dl.Motion?"mapillary-slider-mode-button-2d-inactive":"mapillary-slider-mode-button-2d";return Gt.h("div."+i,t,[Gt.h("div.mapillary-slider-mode-icon-2d",[])])}_createPositionInput(e,t){const i=g=>{this._notifyPositionChanged$.next(Number(g.target.value)/1e3)},r=g=>{this._interacting=!0,g.stopPropagation()},o=g=>{this._interacting&&g.stopPropagation()},c=g=>{(g.key==="ArrowDown"||g.key==="ArrowLeft"||g.key==="ArrowRight"||g.key==="ArrowUp")&&g.preventDefault()},s=this._container.domContainer.getBoundingClientRect(),d=Math.max(215,Math.min(400,s.width-105))-84+(t?0:52),p=Gt.h("input.mapillary-slider-position",{max:1e3,min:0,onchange:i,oninput:i,onkeydown:c,onpointerdown:r,onpointermove:o,ontouchmove:o,ontouchstart:r,style:{width:`${d}px`},type:"range",value:1e3*e},[]);return Gt.h("div.mapillary-slider-position-container",[p])}}class WB extends bo{constructor(e,t,i,r){super(e,t,i),this._viewportCoords=r||new zo,this._domRenderer=new One(t),this._imageTileLoader=new DB(i.api),this._roiCalculator=new FB,this._spatial=new vo,this._glRendererOperation$=new ri,this._glRendererCreator$=new ri,this._glRendererDisposer$=new ri,this._glRenderer$=this._glRendererOperation$.pipe(Vr((o,c)=>c(o),null),oi(o=>o!=null),yi(void 0,o=>o.frameId)),this._glRendererCreator$.pipe(it(()=>o=>{if(o!=null)throw new Error("Multiple slider states can not be created at the same time");return new Fne})).subscribe(this._glRendererOperation$),this._glRendererDisposer$.pipe(it(()=>o=>(o.dispose(),null))).subscribe(this._glRendererOperation$)}_activate(){const e=this._subscriptions;e.push(this._domRenderer.mode$.subscribe(b=>{this.configure({mode:b})})),e.push(this._glRenderer$.pipe(it(b=>({name:this._name,renderer:{frameId:b.frameId,needsRender:b.needsRender,render:b.render.bind(b),pass:Ih.Background}}))).subscribe(this._container.glRenderer.render$));const t=Ul(this.configuration$.pipe(it(b=>b.initialPosition!=null?b.initialPosition:1),wi()),this._domRenderer.position$),i=this.configuration$.pipe(it(b=>b.mode),yi()),r=this._navigator.stateService.currentState$.pipe(it(b=>b.state.motionless),yi()),o=this._navigator.stateService.currentState$.pipe(it(b=>ki(b.state.currentImage.cameraType)),yi()),c=Si(this._configuration$.pipe(it(b=>b.sliderVisible)),this._navigator.stateService.currentState$.pipe(it(b=>!(b.state.currentImage==null||b.state.previousImage==null||ki(b.state.currentImage.cameraType)&&!ki(b.state.previousImage.cameraType))),yi())).pipe(it(([b,S])=>b&&S),yi());this._waitSubscription=Si(i,r,o,c).pipe(Ui(this._navigator.stateService.state$)).subscribe(([[b,S,P,L],E])=>{const C=L&&(S||b===Dl.Stationary||P);C&&E!==Oi.WaitingInteractively?this._navigator.stateService.waitInteractively():!C&&E!==Oi.Waiting&&this._navigator.stateService.wait()}),e.push(Si(t,i,r,o,c).subscribe(([b,S,P,L])=>{P||S===Dl.Stationary||L?this._navigator.stateService.moveTo(1):this._navigator.stateService.moveTo(b)})),e.push(Si(t,i,r,o,c,this._container.renderService.size$).pipe(it(([b,S,P,L,E])=>({name:this._name,vNode:this._domRenderer.render(b,S,P,L,E)}))).subscribe(this._container.domRenderer.render$)),this._glRendererCreator$.next(null),e.push(Si(t,o,c,this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$).pipe(it(([b,S,P,L,E])=>{if(!S)return P?b:1;const C=this._viewportCoords.viewportToBasic(-1.15,0,E,L.perspective),D=this._viewportCoords.viewportToBasic(1.15,0,E,L.perspective),O=D[0]<C[0]?D[0]+1:D[0],U=C[0]+b*(O-C[0]);return U>1?U-1:U}),it(b=>S=>(S.updateCurtain(b),S))).subscribe(this._glRendererOperation$)),e.push(Si(this._navigator.stateService.currentState$,i).pipe(it(([b,S])=>P=>(P.update(b,S),P))).subscribe(this._glRendererOperation$)),e.push(this._configuration$.pipe(oi(b=>b.ids!=null),ei(b=>Dy(Dy(this._catchCacheImage$(b.ids.background),this._catchCacheImage$(b.ids.foreground)).pipe(it(S=>({background:S[0],foreground:S[1]}))),this._navigator.stateService.currentState$.pipe(wi())).pipe(it(S=>({images:S[0],state:S[1].state}))))).subscribe(b=>{if(!(b.state.currentImage!=null&&b.state.previousImage!=null&&b.state.currentImage.id===b.images.foreground.id&&b.state.previousImage.id===b.images.background.id)){if(b.state.currentImage.id===b.images.background.id){this._navigator.stateService.setImages([b.images.foreground]);return}if(b.state.currentImage.id===b.images.foreground.id&&b.state.trajectory.length===1){this._navigator.stateService.prependImages([b.images.background]);return}this._navigator.stateService.setImages([b.images.background]),this._navigator.stateService.setImages([b.images.foreground])}},b=>{console.error(b)}));const s=this._container.configurationService.imageTiling$.pipe(ei(b=>b?this._navigator.stateService.currentState$:new ri),yi(void 0,b=>b.state.currentImage.id),Ui(this._container.glRenderer.webGLRenderer$,this._container.renderService.size$),it(([b,S,P])=>{const L=b.state;Math.max(P.width,P.height);const E=L.currentImage,C=L.currentTransform;return new _2(E.id,C.basicWidth,C.basicHeight,E.image,this._imageTileLoader,new g2,S)}),Pi(1),gi());e.push(s.subscribe(()=>{})),e.push(s.pipe(it(b=>S=>(S.setTextureProvider(b.id,b),S))).subscribe(this._glRendererOperation$)),e.push(s.pipe(il()).subscribe(b=>{b[0].abort()}));const d=this._container.configurationService.imageTiling$.pipe(ei(b=>b?Si(this._container.renderService.renderCameraFrame$,this._container.renderService.size$.pipe(Fy(250))):new ri),it(([b,S])=>[b.camera.position.clone(),b.camera.lookat.clone(),b.zoom.valueOf(),S.height.valueOf(),S.width.valueOf()]),il(),t2(b=>b[1][2]-b[0][2]<0||b[1][2]===0),it(b=>{let S=b[0][0].equals(b[1][0]),P=b[0][1].equals(b[1][1]),L=b[0][2]===b[1][2],E=b[0][3]===b[1][3],C=b[0][4]===b[1][4];return S&&P&&L&&E&&C}),yi(),oi(b=>b),ei(()=>this._container.renderService.renderCameraFrame$.pipe(wi())),Ui(this._container.renderService.size$,this._navigator.stateService.currentTransform$));e.push(s.pipe(ei(b=>d.pipe(it(([S,P,L])=>[this._roiCalculator.computeRegionOfInterest(S,P,L),b]))),oi(b=>!b[1].disposed)).subscribe(b=>{let S=b[0];b[1].setRegionOfInterest(S)}));const p=s.pipe(ei(b=>b.hasTexture$),An(!1),Pi(1),gi());e.push(p.subscribe(()=>{}));const g=this._container.configurationService.imageTiling$.pipe(ei(b=>b?this._navigator.stateService.currentState$:new ri),oi(b=>!!b.state.previousImage),yi(void 0,b=>b.state.previousImage.id),Ui(this._container.glRenderer.webGLRenderer$,this._container.renderService.size$),it(([b,S,P])=>{const L=b.state,E=L.previousImage,C=L.previousTransform;return new _2(E.id,C.basicWidth,C.basicHeight,E.image,this._imageTileLoader,new g2,S)}),Pi(1),gi());e.push(g.subscribe(()=>{})),e.push(g.pipe(it(b=>S=>(S.setTextureProviderPrev(b.id,b),S))).subscribe(this._glRendererOperation$)),e.push(g.pipe(il()).subscribe(b=>{b[0].abort()}));const _=this._container.configurationService.imageTiling$.pipe(ei(b=>b?Si(this._container.renderService.renderCameraFrame$,this._container.renderService.size$.pipe(Fy(250))):new ri),it(([b,S])=>[b.camera.position.clone(),b.camera.lookat.clone(),b.zoom.valueOf(),S.height.valueOf(),S.width.valueOf()]),il(),t2(b=>b[1][2]-b[0][2]<0||b[1][2]===0),it(b=>{let S=b[0][0].equals(b[1][0]),P=b[0][1].equals(b[1][1]),L=b[0][2]===b[1][2],E=b[0][3]===b[1][3],C=b[0][4]===b[1][4];return S&&P&&L&&E&&C}),yi(),oi(b=>b),ei(()=>this._container.renderService.renderCameraFrame$.pipe(wi())),Ui(this._container.renderService.size$,this._navigator.stateService.currentTransform$));e.push(g.pipe(ei(b=>_.pipe(it(([S,P,L])=>[this._roiCalculator.computeRegionOfInterest(S,P,L),b]))),oi(b=>!b[1].disposed),Ui(this._navigator.stateService.currentState$)).subscribe(([[b,S],P])=>{let L=null;if(ki(P.state.previousImage.cameraType))if(ki(P.state.currentImage.cameraType)){const E=this._spatial.viewingDirection(P.state.currentImage.rotation),C=this._spatial.viewingDirection(P.state.previousImage.rotation),O=this._spatial.angleBetweenVector2(E.x,E.y,C.x,C.y)/(2*Math.PI);L={bbox:{maxX:this._spatial.wrap(b.bbox.maxX+O,0,1),maxY:b.bbox.maxY,minX:this._spatial.wrap(b.bbox.minX+O,0,1),minY:b.bbox.minY},pixelHeight:b.pixelHeight,pixelWidth:b.pixelWidth}}else{const E=this._spatial.viewingDirection(P.state.currentImage.rotation),C=this._spatial.viewingDirection(P.state.previousImage.rotation),O=this._spatial.angleBetweenVector2(E.x,E.y,C.x,C.y)/(2*Math.PI),U=this._spatial.angleToPlane(E.toArray(),[0,0,1]),G=(this._spatial.angleToPlane(C.toArray(),[0,0,1])-U)/(2*Math.PI),N=P.state.currentTransform,V=Math.max(N.basicWidth,N.basicHeight),j=V>0?2*Math.atan(.5*N.basicWidth/(V*N.focal)):Math.PI/3,z=V>0?2*Math.atan(.5*N.basicHeight/(V*N.focal)):Math.PI/3,Q=j/(2*Math.PI),X=z/Math.PI,re=(b.bbox.maxX-b.bbox.minX)*Q,se=(b.bbox.maxY-b.bbox.minY)*X,le=b.pixelWidth*Q,ce=b.pixelHeight*X,be=(b.bbox.minX+b.bbox.maxX)/2-.5,Ee=(b.bbox.minY+b.bbox.maxY)/2-.5,$e=.5+O+Q*be-re/2,Ve=.5+O+Q*be+re/2,nt=.5+G+X*Ee-se/2,He=.5+G+X*Ee+se/2;L={bbox:{maxX:this._spatial.wrap(Ve,0,1),maxY:He,minX:this._spatial.wrap($e,0,1),minY:nt},pixelHeight:ce,pixelWidth:le}}else{const E=P.state.currentTransform.basicAspect,C=P.state.previousTransform.basicAspect,[[D,O],[U,q]]=this._getBasicCorners(E,C),G=U-D,N=q-O,V=b.pixelWidth/G,j=b.pixelHeight/N,z=(G-1)/(2*G)+b.bbox.minX/G,Q=(G-1)/(2*G)+b.bbox.maxX/G,X=(N-1)/(2*N)+b.bbox.minY/N,re=(N-1)/(2*N)+b.bbox.maxY/N,se={maxX:Q,maxY:re,minX:z,minY:X};this._clipBoundingBox(se),L={bbox:se,pixelHeight:j,pixelWidth:V}}S.setRegionOfInterest(L)}));const x=g.pipe(ei(b=>b.hasTexture$),An(!1),Pi(1),gi());e.push(x.subscribe(()=>{}))}_deactivate(){this._waitSubscription.unsubscribe(),this._navigator.stateService.state$.pipe(wi()).subscribe(e=>{e!==Oi.Traversing&&this._navigator.stateService.traverse()}),this._glRendererDisposer$.next(null),this._domRenderer.deactivate(),this._subscriptions.unsubscribe(),this.configure({ids:null})}_getDefaultConfiguration(){return{initialPosition:1,mode:Dl.Motion,sliderVisible:!0}}_catchCacheImage$(e){return this._navigator.graphService.cacheImage$(e).pipe($n(t=>(console.error(`Failed to cache slider image (${e})`,t),zi())))}_getBasicCorners(e,t){let i,r;return e>t?(i=.5,r=.5*e/t):(i=.5*t/e,r=.5),[[.5-i,.5-r],[.5+i,.5+r]]}_clipBoundingBox(e){e.minX=Math.max(0,Math.min(1,e.minX)),e.maxX=Math.max(0,Math.min(1,e.maxX)),e.minY=Math.max(0,Math.min(1,e.minY)),e.maxY=Math.max(0,Math.min(1,e.maxY))}}WB.componentName="slider";class w0{constructor(e,t){this._subscriptions=new yo,this._graphService=e,this._stateService=t;const i=this._subscriptions;this._directionSubject$=new ri,this._direction$=this._directionSubject$.pipe(An(Vt.Next),Pi(1),gi()),i.push(this._direction$.subscribe()),this._playing=!1,this._playingSubject$=new ri,this._playing$=this._playingSubject$.pipe(An(this._playing),Pi(1),gi()),i.push(this._playing$.subscribe()),this._speed=.5,this._speedSubject$=new ri,this._speed$=this._speedSubject$.pipe(An(this._speed),Pi(1),gi()),i.push(this._speed$.subscribe()),this._imagesAhead=this._mapImagesAhead(this._mapSpeed(this._speed)),this._bridging$=null}get playing(){return this._playing}get direction$(){return this._direction$}get playing$(){return this._playing$}get speed$(){return this._speed$}play(){if(this._playing)return;this._stateService.cutImages();const e=this._setSpeed(this._speed);this._stateService.setSpeed(e),this._graphModeSubscription=this._speed$.pipe(it(i=>i>w0.sequenceSpeed?ra.Sequence:ra.Spatial),yi()).subscribe(i=>{this._graphService.setGraphMode(i)}),this._cacheSubscription=Si(this._stateService.currentImage$.pipe(it(i=>[i.sequenceId,i.id]),yi(void 0,([i])=>i)),this._graphService.graphMode$,this._direction$).pipe(ei(([[i,r],o,c])=>{if(c!==Vt.Next&&c!==Vt.Prev)return Ai([void 0,c]);const s=(o===ra.Sequence?this._graphService.cacheSequenceImages$(i,r):this._graphService.cacheSequence$(i)).pipe(e2(3),$n(d=>(console.error(d),Ai(void 0))));return Si(s,Ai(c))}),ei(([i,r])=>{if(i===void 0)return zi();const o=i.imageIds.slice();return r===Vt.Prev&&o.reverse(),this._stateService.currentState$.pipe(it(c=>[c.state.trajectory[c.state.trajectory.length-1].id,c.state.imagesAhead]),Vr(([c,s],[d,p])=>{c===void 0&&(c=d);const g=o.length-1;if(p>=this._imagesAhead||o[g]===c)return[c,[]];const _=o.indexOf(d),x=o.indexOf(c)+1,b=Math.min(g,_+this._imagesAhead-p)+1;return b<=x?[c,[]]:[o[b-1],o.slice(x,b)]},[void 0,[]]),Hi(([c,s])=>Fr(s)))}),Hi(i=>this._graphService.cacheImage$(i).pipe($n(()=>zi())),6)).subscribe(),this._playingSubscription=this._stateService.currentState$.pipe(oi(i=>i.state.imagesAhead<this._imagesAhead),yi(void 0,i=>i.state.lastImage.id),it(i=>{const r=i.state.lastImage,o=i.state.trajectory;let c;for(let s=o.length-2;s>=0;s--){const d=o[s];if(d.sequenceId!==r.sequenceId)break;if(d.capturedAt!==r.capturedAt){c=d.capturedAt<r.capturedAt;break}}return[i.state.lastImage,c]}),Ui(this._direction$),ei(([[i,r],o])=>Dy(([Vt.Next,Vt.Prev].indexOf(o)>-1?i.sequenceEdges$:i.spatialEdges$).pipe(wi(c=>c.cached),JM(15e3)),Ai(o)).pipe(it(([c,s])=>{for(let d of c.edges)if(d.data.direction===s)return d.target;return null}),ei(c=>c!=null?this._graphService.cacheImage$(c):zi())))).subscribe(i=>{this._stateService.appendImagess([i])},i=>{console.error(i),this.stop()}),this._clearSubscription=this._stateService.currentImage$.pipe(xw(1,10)).subscribe(i=>{this._stateService.clearPriorImages()}),this._setPlaying(!0);const t=this._stateService.currentState$.pipe(it(i=>i.state),yi(([i,r],[o,c])=>i===o&&r===c,i=>[i.currentImage.id,i.lastImage.id]),oi(i=>i.currentImage.id===i.lastImage.id&&i.currentIndex===i.trajectory.length-1),it(i=>i.currentImage));this._stopSubscription=Si(t,this._direction$).pipe(ei(([i,r])=>{const o=([Vt.Next,Vt.Prev].indexOf(r)>-1?i.sequenceEdges$:i.spatialEdges$).pipe(wi(c=>c.cached),JM(15e3),$n(c=>(console.error(c),Ai({cached:!1,edges:[]}))));return Si(Ai(r),o).pipe(it(([c,s])=>{for(const d of s.edges)if(d.data.direction===c)return!0;return!1}))}),Hi(i=>i||!this._bridging$?Ai(i):this._bridging$.pipe(it(r=>r!=null),$n(r=>(console.error(r),Ai(!1))))),wi(i=>!i)).subscribe(void 0,void 0,()=>{this.stop()}),this._stopSubscription.closed&&(this._stopSubscription=null),this._earthSubscription=this._stateService.state$.pipe(it(i=>i===Oi.Earth),yi(),wi(i=>i)).subscribe(void 0,void 0,()=>{this.stop()}),this._earthSubscription.closed&&(this._earthSubscription=null)}dispose(){this.stop(),this._subscriptions.unsubscribe()}setDirection(e){this._directionSubject$.next(e)}setSpeed(e){if(e=Math.max(0,Math.min(1,e)),e===this._speed)return;const t=this._setSpeed(e);this._playing&&this._stateService.setSpeed(t),this._speedSubject$.next(this._speed)}stop(){this._playing&&(this._stopSubscription&&(this._stopSubscription.closed||this._stopSubscription.unsubscribe(),this._stopSubscription=null),this._earthSubscription&&(this._earthSubscription.closed||this._earthSubscription.unsubscribe(),this._earthSubscription=null),this._graphModeSubscription.unsubscribe(),this._graphModeSubscription=null,this._cacheSubscription.unsubscribe(),this._cacheSubscription=null,this._playingSubscription.unsubscribe(),this._playingSubscription=null,this._clearSubscription.unsubscribe(),this._clearSubscription=null,this._stateService.setSpeed(1),this._stateService.cutImages(),this._graphService.setGraphMode(ra.Spatial),this._setPlaying(!1))}_mapSpeed(e){const t=2*e-1;return Math.pow(10,t)-.2*t}_mapImagesAhead(e){return Math.round(Math.max(10,Math.min(50,8+6*e)))}_setPlaying(e){this._playing=e,this._playingSubject$.next(e)}_setSpeed(e){this._speed=e;const t=this._mapSpeed(this._speed);return this._imagesAhead=this._mapImagesAhead(t),t}}w0.sequenceSpeed=.54;var Ol;(function(n){n[n.Hidden=0]="Hidden",n[n.Homogeneous=1]="Homogeneous",n[n.Cluster=2]="Cluster",n[n.ConnectedComponent=3]="ConnectedComponent",n[n.Sequence=4]="Sequence"})(Ol||(Ol={}));var Hy;(function(n){n[n.Hidden=0]="Hidden",n[n.Altitude=1]="Altitude",n[n.Flat=2]="Flat"})(Hy||(Hy={}));class zne extends Pz{constructor(e){super(),this._originalSize=e.originalSize;const{cluster:t,color:i,scale:r,translation:o}=e;this._makeAttributes(t),this.material.size=r*this._originalSize,this.setColor(i),this.matrixAutoUpdate=!1,this.position.fromArray(o),this.updateMatrix(),this.updateMatrixWorld(!1)}dispose(){this.geometry.dispose(),this.material.dispose()}setColor(e){this.material.vertexColors=e==null,this.material.color=new Bi(e),this.material.needsUpdate=!0}resize(e){this.material.size=e*this._originalSize,this.material.needsUpdate=!0}_makeAttributes(e){const t=[],i=[],r=e.points;for(const c in r){if(!r.hasOwnProperty(c))continue;const s=r[c];t.push(...s.coordinates);const d=s.color;i.push(d[0]),i.push(d[1]),i.push(d[2])}const o=this.geometry;o.setAttribute("position",new Mn(new Float32Array(t),3)),o.setAttribute("color",new Mn(new Float32Array(i),3))}}class Bne extends Ep{constructor(e){super(),this._makeAttributes(e),this.matrixAutoUpdate=!1,this.updateMatrix(),this.updateMatrixWorld(!1)}dispose(){this.geometry.dispose(),this.material.dispose()}_makeAttributes(e){const t=e.slice();t.push(e[0]);let i=0;const r=new Float32Array(3*(e.length+1));for(const o of t)r[i++]=o[0],r[i++]=o[1],r[i++]=o[2];this.geometry.setAttribute("position",new Mn(r,3))}}const Nne=14,$ne=6;function T3(n,e){return n===e}function Vne(n){return Math.pow(2,n)}function Une(n){const t=Vne(n)/2;return{min:[-t,-t,-t],max:[t,t,t]}}class sE{constructor(e,t,i,r){this.level=e,this.leafLevel=t,this.boundingBox=i,this.parent=r,this.children=[],this.items=[],r&&r.children.push(this)}get isEmpty(){return!(this.children.length||this.items.length)}add(e){const t=this;if(!t.boundingBox.containsPoint(e.position))throw new Error("Item not contained in node");if(T3(t.level,t.leafLevel))return t.items.push(e),this;for(const i of t.children)if(i.boundingBox.containsPoint(e.position))return i.add(e);for(const i of t._generateBoundingBoxes())if(i.containsPoint(e.position))return new sE(t.level-1,t.leafLevel,i,t).add(e);throw new Error("Item not contained in children")}intersect(e,t,i){if(e.intersectBox(this.boundingBox,t)){if(T3(this.level,this.leafLevel)){i.push(this);return}for(const r of this.children)r.intersect(e,t,i)}}remove(e){const t=this.items.indexOf(e);if(t<0)throw new Error(`Item does not exist ${e.uuid}`);this.items.splice(t,1)}traverse(){const e=this;if(!e.isEmpty)return;const t=e.parent;if(!t)return;const i=t.children.indexOf(e);if(i<0)throw new Error("Corrupt octree");t.children.splice(i,1),this.parent=null,t.traverse()}_generateBoundingBoxes(){const e=this,t=e.boundingBox.min,r=(e.boundingBox.max.x-t.x)/2,o=[[t.x,t.y+r,t.z+r],[t.x+r,t.y+r,t.z+r],[t.x,t.y,t.z+r],[t.x+r,t.y,t.z+r],[t.x,t.y+r,t.z],[t.x+r,t.y+r,t.z],[t.x,t.y,t.z],[t.x+r,t.y,t.z]],c=[];for(const[s,d,p]of o)c.push(new ul(new Ue(s,d,p),new Ue(s+r,d+r,p+r)));return c}}class jne{constructor(e,t){if(this.rootLevel=e,this.leafLevel=t,t>e)throw new Error;this._index=new Map,this._root=this._makeRoot()}get root(){return this._root}add(e){if(!this.root.boundingBox.containsPoint(e.position)){console.warn(`Object outside bounding box ${e.uuid}`);return}const t=this._root.add(e);this._index.set(e.uuid,t)}has(e){return this._index.has(e.uuid)}intersect(e){const t=[],i=new Ue;return this._root.intersect(e,i,t),t.map(r=>r.items).reduce((r,o)=>(r.push(...o),r),[])}reset(){this._root=this._makeRoot(),this._index.clear()}remove(e){if(!this.has(e))throw new Error(`Frame does not exist ${e.uuid}`);const t=this._index.get(e.uuid);t.remove(e),t.traverse(),this._index.delete(e.uuid)}_makeRoot(){const e=this.rootLevel,t=Une(e),i=new ul(new Ue().fromArray(t.min),new Ue().fromArray(t.max));return new sE(e,this.leafLevel,i)}}class Gne{constructor(e,t){this._objects=[],this._objectImageMap=new Map,this._octree=e??new jne(Nne,$ne),this._raycaster=t??new Pw,this._interactiveLayer=1,this._raycaster=t||new Pw(void 0,void 0,1,1e4),this._lineThreshold=.2,this._largeLineThreshold=.4,this._raycaster.params.Line.threshold=this._lineThreshold,this._raycaster.layers.set(this._interactiveLayer)}get interactiveLayer(){return this._interactiveLayer}get octree(){return this._octree}get raycaster(){return this._raycaster}add(e,t){const i=e.uuid;this._objectImageMap.set(i,t),this._objects.push(e),this._octree.add(e)}intersectObjects(e,t){this._raycaster.setFromCamera(new li().fromArray(e),t);const i=this._octree.intersect(this.raycaster.ray),r=this._raycaster.intersectObjects(i),o=this._objectImageMap;for(const c of r){const s=c.object.uuid;if(o.has(s))return o.get(s)}return null}remove(e){const t=this._objects,i=t.indexOf(e);if(i!==-1){const r=t.splice(i,1);for(const o of r)this._objectImageMap.delete(o.uuid);this._octree.remove(e)}else console.warn("Object does not exist")}resetIntersectionThreshold(e){this._raycaster.params.Line.threshold=e?this._largeLineThreshold:this._lineThreshold}}class qne extends Ep{constructor(e){super(e.geometry,e.material);const t=e.mode,i=e.originalOrigin,o=e.transform.unprojectBasic([0,0],0);this._relativeAltitude=i[2]-o[2],this._makeAttributes(o,i,t),this.matrixAutoUpdate=!1,this.position.fromArray(o),this.updateMatrix(),this.updateMatrixWorld(!1)}dispose(){this.geometry.dispose(),this.material.dispose()}setMode(e){const t=this.geometry.attributes.position,i=t.array;i[5]=this._modeToAltitude(e),t.needsUpdate=!0,this.geometry.computeBoundingSphere()}_makeAttributes(e,t,i){const r=new Float32Array(6);r[0]=0,r[1]=0,r[2]=0,r[3]=t[0]-e[0],r[4]=t[1]-e[1],r[5]=this._modeToAltitude(i);const o=new Mn(r,3);this.geometry.setAttribute("position",o),o.needsUpdate=!0,this.geometry.computeBoundingSphere()}_modeToAltitude(e){return e===Hy.Altitude?this._relativeAltitude:0}}class HB extends g1{constructor(e){super(e.geometry,e.material);const t=e.color,i=e.size,r=e.scale,o=e.transform,c=o.unprojectBasic([0,0],0),s=this._makePositions(i,o,c);this._makeAttributes(s,t),this.geometry.computeBoundingSphere(),this.geometry.computeBoundingBox(),this.matrixAutoUpdate=!1,this.position.fromArray(c),this.scale.set(r,r,r),this.updateMatrix(),this.updateMatrixWorld(!1)}dispose(){this.geometry.dispose(),this.material.dispose()}setColor(e){return this._updateColorAttribute(e),this}resize(e){return this.scale.set(e,e,e),this.updateMatrix(),this.updateMatrixWorld(!1),this}_makeAttributes(e,t){const i=this.geometry,r=new Mn(new Float32Array(e),3);i.setAttribute("position",r),r.needsUpdate=!0;const o=new Mn(new Float32Array(e.length),3);i.setAttribute("color",o),this._updateColorAttribute(t)}_updateColorAttribute(e){const[t,i,r]=new Bi(e).toArray(),o=this.geometry.attributes.color,c=o.array,s=c.length;let d=0;for(let p=0;p<s;p++)c[d++]=t,c[d++]=i,c[d++]=r;o.needsUpdate=!0}}class Wne extends HB{_makePositions(e,t,i){const o=[];o.push(...this._makeAxis(e,t,i)),o.push(...this._makeLat(.5,10,e,t,i));for(const c of[0,.25,.5,.75])o.push(...this._makeLng(c,10,e,t,i));return o}_makeAxis(e,t,i){const r=t.unprojectBasic([.5,1],.8*e),o=t.unprojectBasic([.5,0],1.2*e);return[r[0]-i[0],r[1]-i[1],r[2]-i[2],o[0]-i[0],o[1]-i[1],o[2]-i[2]]}_makeLat(e,t,i,r,o){const c=.8*i,[s,d,p]=o,g=[],_=r.unprojectBasic([0,e],c);_[0]-=s,_[1]-=d,_[2]-=p,g.push(..._);for(let x=1;x<=t;x++){const b=r.unprojectBasic([x/t,e],c);b[0]-=s,b[1]-=d,b[2]-=p,g.push(...b,...b)}return g.push(..._),g}_makeLng(e,t,i,r,o){const c=.8*i,[s,d,p]=o,g=[],_=r.unprojectBasic([e,0],c);_[0]-=s,_[1]-=d,_[2]-=p,g.push(..._);for(let x=0;x<=t;x++){const b=r.unprojectBasic([e,x/t],c);b[0]-=s,b[1]-=d,b[2]-=p,g.push(...b,...b)}return g.push(..._),g}}class Hne extends HB{_makePositions(e,t,i){const o=[];return o.push(...this._makeDiags(e,t,i)),o.push(...this._makeFrame(e,8,t,i)),o}_makeDiags(e,t,i){const[r,o,c]=i,s=[0,0,0],d=[];for(const p of[[0,0],[1,0],[1,1],[0,1]]){const g=t.unprojectBasic(p,e);g[0]-=r,g[1]-=o,g[2]-=c,d.push(...s,...g)}return d}_makeFrame(e,t,i,r){const o=[];o.push(...this._subsample([0,1],[0,0],t)),o.push(...this._subsample([0,0],[1,0],t)),o.push(...this._subsample([1,0],[1,1],t));const[c,s,d]=r,p=[];for(const g of o){const _=i.unprojectBasic(g,e);_[0]-=c,_[1]-=s,_[2]-=d,p.push(..._)}return p}_interpolate(e,t,i){return e+i*(t-e)}_subsample(e,t,i){if(i<1)return[e,t];const r=[];r.push(e);for(let o=0;o<=i;o++){const c=[];for(let s=0;s<3;s++)c.push(this._interpolate(e[s],t[s],o/(i+1)));r.push(c),r.push(c)}return r.push(t),r}}function Ow(n,e,t){const[i,r,o]=e,[c,s,d]=_p(i,r,o,t.lng,t.lat,t.alt);return ta(c,s,d,n.lng,n.lat,n.alt)}class Zne{constructor(e,t,i){this.id=e,this._scene=t,this._intersection=i,this.cameras=new Ln,this.keys=[],this._positionLines={},this._positions=new Ln,this._cameraFrames={},this._clusters=new Map,this._connectedComponents=new Map,this._sequences=new Map,this._props={},this.clusterVisibles={},this._frameMaterial=new Ph({fog:!1,vertexColors:!0}),this._positionMaterial=new Ph({fog:!1,color:16711680}),this._scene.add(this.cameras,this._positions)}addImage(e){const t=e.image,i=t.id;if(this.hasImage(i))throw new Error(`Image exists ${i}`);const r=e.idMap.ccId;this._connectedComponents.has(r)||this._connectedComponents.set(r,[]);const o=e.idMap.clusterId;this._clusters.has(o)||this._clusters.set(o,[]);const c=e.idMap.sequenceId;this._sequences.has(c)||this._sequences.set(c,[]),this._props[i]={image:t,ids:{ccId:r,clusterId:o,sequenceId:c}},this.keys.push(i)}applyCameraColor(e,t){this._cameraFrames[e].setColor(t)}applyCameraSize(e){for(const t of this.cameras.children)t.resize(e)}applyFilter(e){var t;const i=this.clusterVisibles;for(const s in i)i.hasOwnProperty(s)&&(i[s]=!1);const r=this._cameraFrames,o=this._positionLines,c=this._intersection.interactiveLayer;for(const s of Object.values(this._props)){const d=s.image,p=e(d),g=d.id;o[g].visible=p;const _=r[g];this._setCameraVisibility(_,p,c),i[t=s.ids.clusterId]||(i[t]=p)}}applyPositionMode(e){this._positions.visible=e!==Hy.Hidden;for(const t of this._positions.children)t.setMode(e)}dispose(){this._disposeCameras(),this._disposePositions(),this._scene=null,this._intersection=null}getCamerasByMode(e){if(e===Ol.Cluster)return this._clusters;if(e===Ol.ConnectedComponent)return this._connectedComponents;if(e===Ol.Sequence)return this._sequences;const t=Ol,i=t[t.Homogeneous],r=new Map;return r.set(i,this.cameras.children),r}getColorId(e,t){const i=this._props[e],r=Ol;switch(t){case r.Cluster:return i.ids.clusterId;case r.ConnectedComponent:return i.ids.ccId;case r.Sequence:return i.ids.sequenceId;default:return r[r.Homogeneous]}}hasImage(e){return this.keys.indexOf(e)!==-1}resetReference(e,t){const i=this._cameraFrames;for(const o in i){if(!i.hasOwnProperty(o))continue;const c=i[o];c.position.fromArray(Ow(e,c.position.toArray(),t))}const r=this._positionLines;for(const o in r){if(!r.hasOwnProperty(o))continue;const c=r[o];c.position.fromArray(Ow(e,c.position.toArray(),t))}}visualize(e){var t,i;const r=e.id,o=e.visible,c=e.transform,s={color:e.color,material:this._frameMaterial,scale:e.scale,size:e.maxSize,transform:c},d=ki(c.cameraType)?new Wne(s):new Hne(s),p=this._intersection.interactiveLayer;this._setCameraVisibility(d,o,p),this.cameras.add(d),this._cameraFrames[r]=d,this._intersection.add(d,r);const _=this._props[r].ids;(t=this.clusterVisibles)[i=_.clusterId]||(t[i]=o),this._connectedComponents.get(_.ccId).push(d),this._clusters.get(_.clusterId).push(d),this._sequences.get(_.sequenceId).push(d);const x={material:this._positionMaterial,mode:e.positionMode,originalOrigin:e.originalPosition,transform:c},b=new qne(x);b.visible=o,this._positions.add(b),this._positionLines[r]=b}_disposeCameras(){const e=this._intersection,t=this.cameras;for(const i of t.children.slice())i.dispose(),e.remove(i),t.remove(i);this._scene.remove(this.cameras)}_disposePositions(){const e=this._positions;for(const t of e.children.slice())t.dispose(),e.remove(t);this._scene.remove(this._positions)}_setCameraVisibility(e,t,i){e.visible=t,t?e.layers.enable(i):e.layers.disable(i)}}class Xne{constructor(){this._colors=new Map;const e=Ol;this._colors.set(e[e.Homogeneous],"#FFFFFF")}getColor(e){const t=this._colors;return t.has(e)||t.set(e,this._randomColor()),t.get(e)}_randomColor(){return`hsl(${Math.floor(360*Math.random())}, 100%, 50%)`}}function v2(n){return n!==Ol.Hidden}function Yne(n){return n===Oi.Custom||n===Oi.Earth}var ru;(function(n){n[n.Hidden=0]="Hidden",n[n.Original=1]="Original",n[n.Cluster=2]="Cluster"})(ru||(ru={}));const Kne="NO_CLUSTER_ID",Jne="NO_MERGE_ID",Qne="NO_SEQUENCE_ID";class ere{constructor(e,t){this._rayNearScale=1.1,this._originalPointSize=2,this._originalCameraSize=2,this._imageCellMap=new Map,this._scene=t||new vh,this._scene.autoUpdate=!1,this._intersection=new Gne,this._assets=new Xne,this._needsRender=!1,this._images={},this._cells={},this._cellClusters={},this._clusters={},this._cameraVisualizationMode=e.cameraVisualizationMode?e.cameraVisualizationMode:Ol.Homogeneous,this._cameraSize=e.cameraSize,this._pointSize=e.pointSize,this._pointVisualizationMode=e.pointVisualizationMode?e.pointVisualizationMode:ru.Original,this._positionMode=e.originalPositionMode,this._cellsVisible=e.cellsVisible,this._hoveredId=null,this._selectedId=null,this._colors={hover:"#FF0000",select:"#FF8000"},this._filter=()=>!0}get needsRender(){return this._needsRender}get intersection(){return this._intersection}addCluster(e,t,i){if(this.hasCluster(e.id,i))return;const r=e.id;if(!(r in this._clusters)){this._clusters[r]={points:new Ln,cellIds:[]};const o=this._getClusterVisible(r),c=this._clusters[r],s=this._pointVisualizationMode===ru.Cluster?this._assets.getColor(r):null,d=new zne({cluster:e,color:s,originalSize:this._originalPointSize,scale:this._pointSize,translation:t});c.points.visible=o,c.points.add(d),this._scene.add(c.points)}this._clusters[r].cellIds.indexOf(i)===-1&&this._clusters[r].cellIds.push(i),i in this._cellClusters||(this._cellClusters[i]={keys:[]}),this._cellClusters[i].keys.indexOf(r)===-1&&this._cellClusters[i].keys.push(r),this._needsRender=!0}addImage(e,t,i,r){var o,c,s;const d=e.id,p={clusterId:(o=e.clusterId)!==null&&o!==void 0?o:Kne,sequenceId:(c=e.sequenceId)!==null&&c!==void 0?c:Qne,ccId:(s=e.mergeId)!==null&&s!==void 0?s:Jne};if(!(r in this._images)){const S=new Zne(r,this._scene,this._intersection);S.cameras.visible=v2(this._cameraVisualizationMode),S.applyPositionMode(this._positionMode),this._images[r]=S}const g=this._images[r];if(g.hasImage(d))return;g.addImage({idMap:p,image:e});const _=g.getColorId(d,this._cameraVisualizationMode),x=this._assets.getColor(_),b=this._filter(e);if(g.visualize({id:d,color:x,positionMode:this._positionMode,scale:this._cameraSize,transform:t,visible:b,maxSize:this._originalCameraSize,originalPosition:i}),this._imageCellMap.set(d,r),d===this._selectedId&&this._highlight(d,this._colors.select,this._cameraVisualizationMode),p.clusterId in this._clusters){const S=this._getClusterVisible(p.clusterId);this._clusters[p.clusterId].points.visible=S}this._needsRender=!0}addCell(e,t){if(this.hasCell(t))return;const i=new Bne(e);this._cells[t]=new Ln,this._cells[t].visible=this._cellsVisible,this._cells[t].add(i),this._scene.add(this._cells[t]),this._needsRender=!0}deactivate(){this._filter=()=>!0,this._selectedId=null,this._hoveredId=null,this.uncache()}hasCluster(e,t){return e in this._clusters&&this._clusters[e].cellIds.indexOf(t)!==-1}hasCell(e){return e in this._cells}hasImage(e,t){return t in this._images&&this._images[t].hasImage(e)}render(e,t){t.render(this._scene,e),this._needsRender=!1}resetReference(e,t){const i=this._clusters;for(const c in i){if(!i.hasOwnProperty(c))continue;const s=i[c];s.points.position.fromArray(Ow(e,s.points.position.toArray(),t))}const r=this._cells;for(const c in r){if(!r.hasOwnProperty(c))continue;const s=r[c];s.position.fromArray(Ow(e,s.position.toArray(),t))}const o=this._images;for(const c in o){if(!o.hasOwnProperty(c))continue;o[c].resetReference(e,t)}}setCameraSize(e){if(Math.abs(e-this._cameraSize)<.001)return;const t=this._images;for(const i of Object.keys(t))t[i].applyCameraSize(e);this._intersection.raycaster.near=this._getNear(e),this._cameraSize=e,this._needsRender=!0}setFilter(e){this._filter=e;const t={};for(const r of Object.values(this._images)){r.applyFilter(e);const o=r.clusterVisibles;for(const c in o)o.hasOwnProperty(c)&&(c in t||(t[c]=!1),t[c]||(t[c]=o[c]))}const i=this._pointVisualizationMode!==ru.Hidden;for(const r in t){if(!t.hasOwnProperty(r))continue;t[r]&&(t[r]=i);const o=t[r];r in this._clusters&&(this._clusters[r].points.visible=o)}this._needsRender=!0}setHoveredImage(e){if(e!=null&&!this._imageCellMap.has(e))throw new cr(`Image does not exist: ${e}`);this._hoveredId!==e&&(this._needsRender=!0,this._hoveredId!=null&&(this._hoveredId===this._selectedId?this._highlight(this._hoveredId,this._colors.select,this._cameraVisualizationMode):this._resetCameraColor(this._hoveredId)),this._highlight(e,this._colors.hover,this._cameraVisualizationMode),this._hoveredId=e)}setNavigationState(e){this._intersection.resetIntersectionThreshold(e)}setPointSize(e){if(Math.abs(e-this._pointSize)<.001)return;const t=this._clusters;for(const i in t)if(t.hasOwnProperty(i))for(const r of t[i].points.children)r.resize(e);this._pointSize=e,this._needsRender=!0}setPointVisualizationMode(e){if(e!==this._pointVisualizationMode){this._pointVisualizationMode=e;for(const t in this._clusters){if(!this._clusters.hasOwnProperty(t))continue;const i=this._clusters[t];i.points.visible=this._getClusterVisible(t);for(const r of i.points.children){const o=e===ru.Cluster?this._assets.getColor(t):null;r.setColor(o)}}this._needsRender=!0}}setPositionMode(e){if(e!==this._positionMode){for(const t of Object.values(this._images))t.applyPositionMode(e);this._positionMode=e,this._needsRender=!0}}setSelectedImage(e){this._selectedId!==e&&(this._needsRender=!0,this._selectedId!=null&&this._resetCameraColor(this._selectedId),this._highlight(e,this._colors.select,this._cameraVisualizationMode),this._selectedId=e)}setCellVisibility(e){if(e!==this._cellsVisible){for(const t in this._cells)this._cells.hasOwnProperty(t)&&(this._cells[t].visible=e);this._cellsVisible=e,this._needsRender=!0}}setCameraVisualizationMode(e){if(e===this._cameraVisualizationMode)return;const t=v2(e),i=this._assets;for(const r of Object.values(this._images))r.cameras.visible=t,r.getCamerasByMode(e).forEach((c,s)=>{const d=i.getColor(s);for(const p of c)p.setColor(d)});this._highlight(this._hoveredId,this._colors.hover,e),this._highlight(this._selectedId,this._colors.select,e),this._cameraVisualizationMode=e,this._needsRender=!0}uncache(e){for(const t of Object.keys(this._cellClusters))e&&e.indexOf(t)!==-1||this._disposeReconstruction(t);for(const t of Object.keys(this._images)){if(e&&e.indexOf(t)!==-1)continue;const i=this._imageCellMap,r=this._images[t].keys;for(const o of r)i.delete(o);this._images[t].dispose(),delete this._images[t]}for(const t of Object.keys(this._cells))e&&e.indexOf(t)!==-1||this._disposeCell(t);this._needsRender=!0}_getClusterVisible(e){if(this._pointVisualizationMode===ru.Hidden)return!1;let t=!1;for(const i of Object.values(this._images)){const r=i.clusterVisibles;e in r&&(t||(t=r[e]))}return t}_disposePoints(e){for(const t of this._cellClusters[e].keys){if(!(t in this._clusters))continue;const i=this._clusters[t].cellIds.indexOf(e);if(i!==-1&&(this._clusters[t].cellIds.splice(i,1),!(this._clusters[t].cellIds.length>0))){for(const r of this._clusters[t].points.children.slice())r.dispose();this._scene.remove(this._clusters[t].points),delete this._clusters[t]}}}_disposeReconstruction(e){this._disposePoints(e),delete this._cellClusters[e]}_disposeCell(e){const t=this._cells[e];for(const i of t.children.slice())i.dispose(),t.remove(i);this._scene.remove(t),delete this._cells[e]}_getNear(e){const t=this._rayNearScale*this._originalCameraSize*e;return Math.max(1,t)}_resetCameraColor(e){const t=this._imageCellMap;if(e==null||!t.has(e))return;const i=t.get(e),r=this._images[i],o=r.getColorId(e,this._cameraVisualizationMode),c=this._assets.getColor(o);r.applyCameraColor(e,c)}_highlight(e,t,i){const r=this._imageCellMap;if(e==null||!r.has(e))return;const o=r.get(e);t=i===Ol.Homogeneous?t:"#FFFFFF",this._images[o].applyCameraColor(e,t)}}class tre{constructor(e,t){this._graphService=e,this._data=t,this._cells={},this._cacheRequests={},this._clusters={},this._clusterCells={},this._cellClusters={},this._cachingCells$={},this._cachingClusters$={}}cacheClusters$(e){if(!this.hasCell(e))throw new Error("Cannot cache reconstructions of a non-existing cell.");if(this.hasClusters(e))throw new Error("Cannot cache reconstructions that already exists.");if(this.isCachingClusters(e))return this._cachingClusters$[e];const t=this.getCell(e).filter(c=>!!c.clusterId&&!!c.clusterUrl).map(c=>({key:c.clusterId,url:c.clusterUrl})),i=Array.from(new Map(t.map(c=>[c.key,c])).values());this._cellClusters[e]=i,this._cacheRequests[e]=[];let r;const o=new Promise((c,s)=>{r=s});return this._cacheRequests[e].push(r),this._cachingClusters$[e]=this._cacheClusters$(i,e,o).pipe(ga(()=>{e in this._cachingClusters$&&delete this._cachingClusters$[e],e in this._cacheRequests&&delete this._cacheRequests[e]}),Ka(),gi()),this._cachingClusters$[e]}cacheCell$(e){if(this.hasCell(e))throw new Error("Cannot cache cell that already exists.");return this.isCachingCell(e)?this._cachingCells$[e]:(this._cachingCells$[e]=this._graphService.cacheCell$(e).pipe($n(t=>(console.error(t),zi())),oi(()=>!(e in this._cells)),Dr(t=>{this._cells[e]=[],this._cells[e].push(...t),delete this._cachingCells$[e]}),ga(()=>{e in this._cachingCells$&&delete this._cachingCells$[e]}),Ka(),gi()),this._cachingCells$[e])}isCachingClusters(e){return e in this._cachingClusters$}isCachingCell(e){return e in this._cachingCells$}hasClusters(e){if(e in this._cachingClusters$||!(e in this._cellClusters))return!1;for(const t of this._cellClusters[e])if(!(t.key in this._clusters))return!1;return!0}hasCell(e){return!(e in this._cachingCells$)&&e in this._cells}getClusters(e){return e in this._cellClusters?this._cellClusters[e].map(t=>this._clusters[t.key]).filter(t=>!!t):[]}getCell(e){return e in this._cells?this._cells[e]:[]}uncache(e){for(let t of Object.keys(this._cacheRequests))if(!(e&&e.indexOf(t)!==-1)){for(const i of this._cacheRequests[t])i();delete this._cacheRequests[t]}for(let t of Object.keys(this._cellClusters))if(!(e&&e.indexOf(t)!==-1)){for(const i of this._cellClusters[t]){if(!(i.key in this._clusterCells))continue;const r=this._clusterCells[i.key].indexOf(t);r!==-1&&(this._clusterCells[i.key].splice(r,1),!(this._clusterCells[i.key].length>0)&&(delete this._clusterCells[i.key],delete this._clusters[i.key]))}delete this._cellClusters[t]}for(let t of Object.keys(this._cells))e&&e.indexOf(t)!==-1||delete this._cells[t]}updateCell$(e){if(!this.hasCell(e))throw new Error("Cannot update cell that does not exists.");return this._graphService.cacheCell$(e).pipe($n(t=>(console.error(t),zi())),oi(()=>e in this._cells),Dr(t=>{this._cells[e]=[],this._cells[e].push(...t)}),Ka(),gi())}updateClusters$(e){if(!this.hasCell(e))throw new Error("Cannot update reconstructions of a non-existing cell.");if(!this.hasClusters(e))throw new Error("Cannot update reconstructions for cell that is not cached.");const t=this.getCell(e).filter(r=>!!r.clusterId&&!!r.clusterUrl).map(r=>({key:r.clusterId,url:r.clusterUrl})),i=Array.from(new Map(t.map(r=>[r.key,r])).values()).filter(r=>!(r.key in this._clusters));return this._cellClusters[e].push(...i),this._cacheClusters$(i,e,null)}_cacheClusters$(e,t,i){return Fr(e).pipe(Hi(r=>this._hasCluster(r.key)?Ai(this._getCluster(r.key)):this._getCluster$(r.url,r.key,i).pipe($n(o=>(o instanceof Vl||console.error(o),zi()))),6),oi(()=>t in this._cellClusters),Dr(r=>{this._hasCluster(r.id)||(this._clusters[r.id]=r),r.id in this._clusterCells||(this._clusterCells[r.id]=[]),this._clusterCells[r.id].indexOf(t)===-1&&this._clusterCells[r.id].push(t)}))}_getCluster(e){return this._clusters[e]}_getCluster$(e,t,i){return gr.create(r=>{this._data.getCluster(e,i).then(o=>{o.id=t,r.next(o),r.complete()},o=>{r.error(o)})})}_hasCluster(e){return e in this._clusters}}function y2(n,e,t){const i=new Set;return i.add(n),ZB(i,[n],0,e,t),Array.from(i)}function ZB(n,e,t,i,r){if(t>=i)return;const o=[];for(const s of e){const d=r.getAdjacent(s);o.push(...d)}const c=[];for(const s of o)n.has(s)||(n.add(s),c.push(s));ZB(n,c,t+1,i,r)}class XB extends bo{constructor(e,t,i){super(e,t,i),this._cache=new tre(i.graphService,i.api.data),this._scene=new ere(this._getDefaultConfiguration()),this._viewportCoords=new zo,this._spatial=new vo}getFrameIdAt(e){return new Promise((t,i)=>{this._container.renderService.renderCamera$.pipe(wi(),it(r=>{const o=this._viewportCoords.canvasToViewport(e[0],e[1],this._container.container);return this._scene.intersection.intersectObjects(o,r.perspective)})).subscribe(r=>{t(r)},r=>{i(r)})})}_activate(){this._navigator.cacheService.configure({cellDepth:3});const e=this._subscriptions;e.push(this._navigator.stateService.reference$.pipe(il()).subscribe(([x,b])=>{this._scene.resetReference(b,x)})),e.push(this._navigator.graphService.filter$.subscribe(x=>{this._scene.setFilter(x)}));const t=this._container.renderService.bearing$.pipe(it(x=>6*Math.floor(x/6)),yi(),Pi(1),gi()),i=this._navigator.stateService.currentImage$.pipe(it(x=>this._navigator.api.data.geometry.lngLatToCellId(x.originalLngLat)),yi(),Pi(1),gi()),r=this._configuration$.pipe(it(x=>this._spatial.clamp(x.cellGridDepth,1,3)),yi(),Pi(1),gi()),o=Si(this._navigator.playService.playing$,this._navigator.playService.speed$).pipe(it(([x,b])=>x&&b>w0.sequenceSpeed),yi(),Pi(1),gi()),c=this._navigator.stateService.state$.pipe(it(x=>Yne(x)),yi(),Pi(1),gi());e.push(c.subscribe(x=>{this._scene.setNavigationState(x)}));const s=Si(c,o,t,r,this._navigator.stateService.currentImage$).pipe(yi(([x,b,S,P,L],[E,C,D,O,U])=>{if(x!==E)return!1;const q=L.id===U.id&&b===C&&P===O;return x?q:q&&S===D}),wT(([x,b,S,P,L])=>{if(x){const C=this._navigator.api.data.geometry,D=C.lngLatToCellId(L.originalLngLat),O=b?[D]:y2(D,P,C);return Ai(O)}const E=b?30:90;return Ai(this._cellsInFov(L,S,E))}),ei(x=>Fr(x).pipe(Hi(b=>(this._cache.hasCell(b)?Ai(this._cache.getCell(b)):this._cache.cacheCell$(b)).pipe(it(P=>({id:b,images:P}))),6))));e.push(s.pipe(Ui(this._navigator.stateService.reference$)).subscribe(([x,b])=>{this._scene.hasCell(x.id)||this._scene.addCell(this._cellToTopocentric(x.id,b),x.id)})),e.push(s.pipe(Ui(this._navigator.stateService.reference$)).subscribe(([x,b])=>{this._addSceneImages(x,b)})),e.push(s.pipe(wT(x=>{const b=x.id;let S;return this._cache.hasClusters(b)?S=Fr(this._cache.getClusters(b)):this._cache.isCachingClusters(b)?S=this._cache.cacheClusters$(b).pipe(qg(null,{}),ei(()=>Fr(this._cache.getClusters(b)))):this._cache.hasCell(b)?S=this._cache.cacheClusters$(b):S=zi(),Si(Ai(b),S)}),Ui(this._navigator.stateService.reference$)).subscribe(([[x,b],S])=>{this._scene.hasCluster(b.id,x)||this._scene.addCluster(b,this._computeTranslation(b,S),x)})),e.push(this._configuration$.pipe(it(x=>{var b;x.cameraSize=this._spatial.clamp(x.cameraSize,.01,1),x.pointSize=this._spatial.clamp(x.pointSize,.01,1);const S=x.pointsVisible?(b=x.pointVisualizationMode)!==null&&b!==void 0?b:ru.Original:ru.Hidden;return{cameraSize:x.cameraSize,cameraVisualizationMode:x.cameraVisualizationMode,cellsVisible:x.cellsVisible,originalPositionMode:x.originalPositionMode,pointSize:x.pointSize,pointVisualizationMode:S}}),yi((x,b)=>x.cameraSize===b.cameraSize&&x.cameraVisualizationMode===b.cameraVisualizationMode&&x.cellsVisible===b.cellsVisible&&x.originalPositionMode===b.originalPositionMode&&x.pointSize===b.pointSize&&x.pointVisualizationMode===b.pointVisualizationMode)).subscribe(x=>{this._scene.setCameraSize(x.cameraSize);const b=x.cameraVisualizationMode;this._scene.setCameraVisualizationMode(b),this._scene.setCellVisibility(x.cellsVisible),this._scene.setPointSize(x.pointSize);const S=x.pointVisualizationMode;this._scene.setPointVisualizationMode(S);const P=x.originalPositionMode;this._scene.setPositionMode(P)})),e.push(Si(i,r).subscribe(([x,b])=>{const S=y2(x,b,this._navigator.api.data.geometry);this._scene.uncache(S),this._cache.uncache(S)})),e.push(this._navigator.playService.playing$.pipe(ei(x=>x?zi():this._container.mouseService.dblClick$),Ui(this._container.renderService.renderCamera$),ei(([x,b])=>{const S=this._container.container,[P,L]=this._viewportCoords.canvasPosition(x,S),E=this._viewportCoords.canvasToViewport(P,L,S),C=this._scene.intersection.intersectObjects(E,b.perspective);return C?this._navigator.moveTo$(C).pipe($n(()=>zi())):zi()})).subscribe());const d=Si(this._configuration$,this._navigator.stateService.state$).pipe(it(([x,b])=>(x.cameraSize=this._spatial.clamp(x.cameraSize,.01,1),{size:x.cameraSize,visible:v2(x.cameraVisualizationMode),state:b})),yi((x,b)=>x.size===b.size&&x.visible===b.visible&&x.state===b.state)),p=this._container.mouseService.mouseMove$.pipe(Pi(1),gi());e.push(p.subscribe());const g=fn(this._container.mouseService.mouseEnter$,this._container.mouseService.mouseLeave$,this._container.mouseService.windowBlur$);e.push(Si(this._navigator.playService.playing$,g,c,this._navigator.graphService.filter$).pipe(ei(([x,b])=>!x&&b.type==="pointerenter"?Si(Ul(p.pipe($l(1)),this._container.mouseService.mouseMove$),this._container.renderService.renderCamera$,d):Si(Ai(b),Ai(null),Ai(null)))).subscribe(([x,b])=>{if(x.type!=="pointermove"){this._scene.setHoveredImage(null);return}const S=this._container.container,[P,L]=this._viewportCoords.canvasPosition(x,S),E=this._viewportCoords.canvasToViewport(P,L,S),C=this._scene.intersection.intersectObjects(E,b.perspective);this._scene.setHoveredImage(C)})),e.push(this._navigator.stateService.currentId$.subscribe(x=>{this._scene.setSelectedImage(x)})),e.push(this._navigator.stateService.currentState$.pipe(it(x=>{const b=this._scene;return{name:this._name,renderer:{frameId:x.id,needsRender:b.needsRender,render:b.render.bind(b),pass:Ih.Opaque}}})).subscribe(this._container.glRenderer.render$));const _=this._navigator.graphService.dataAdded$.pipe(oi(x=>this._cache.hasCell(x)),Hi(x=>this._cache.updateCell$(x).pipe(it(b=>({id:x,images:b})),Ui(this._navigator.stateService.reference$))),Ka(),gi());e.push(_.subscribe(([x,b])=>{this._addSceneImages(x,b)})),e.push(_.pipe(wT(([x])=>{const b=x.id,S=this._cache;let P;return S.hasClusters(b)?P=S.updateClusters$(b):S.isCachingClusters(b)?P=this._cache.cacheClusters$(b).pipe(qg(null,{}),ei(()=>Fr(S.updateClusters$(b)))):P=zi(),Si(Ai(b),P)}),Ui(this._navigator.stateService.reference$)).subscribe(([[x,b],S])=>{this._scene.hasCluster(b.id,x)||this._scene.addCluster(b,this._computeTranslation(b,S),x)}))}_deactivate(){this._subscriptions.unsubscribe(),this._cache.uncache(),this._scene.deactivate(),this._navigator.cacheService.configure()}_getDefaultConfiguration(){return{cameraSize:.1,cameraVisualizationMode:Ol.Homogeneous,cellGridDepth:1,originalPositionMode:Hy.Hidden,pointSize:.1,pointsVisible:!0,pointVisualizationMode:ru.Original,cellsVisible:!1}}_addSceneImages(e,t){const i=e.id,r=e.images;for(const o of r)this._scene.hasImage(o.id,i)||this._scene.addImage(o,this._createTransform(o,t),this._computeOriginalPosition(o,t),i)}_cellsInFov(e,t,i){const r=this._spatial,o=this._navigator.api.data.geometry,c=o.lngLatToCellId(e.originalLngLat),s=[c],d=i/2,p=o.getAdjacent(c);for(const g of p){const _=o.getVertices(g);for(const x of _){const[b,S]=ta(x.lng,x.lat,0,e.lngLat.lng,e.lngLat.lat,0),P=Math.atan2(S,b),L=r.radToDeg(r.azimuthalToBearing(P));Math.abs(L-t)<d&&s.push(g)}}return s}_computeOriginalPosition(e,t){return ta(e.originalLngLat.lng,e.originalLngLat.lat,e.originalAltitude!=null?e.originalAltitude:e.computedAltitude,t.lng,t.lat,t.alt)}_cellToTopocentric(e,t){return this._navigator.api.data.geometry.getVertices(e).map(r=>ta(r.lng,r.lat,-2,t.lng,t.lat,t.alt))}_computeTranslation(e,t){return ta(e.reference.lng,e.reference.lat,e.reference.alt,t.lng,t.lat,t.alt)}_createTransform(e,t){const i=Rw({alt:e.computedAltitude,lat:e.lngLat.lat,lng:e.lngLat.lng},e.rotation,t);return new Lg(e.exifOrientation,e.width,e.height,e.scale,e.rotation,i,void 0,void 0,e.cameraParameters,e.cameraType)}}XB.componentName="spatial";class oE{constructor(){this._notifyChanged$=new ri}get changed$(){return this._notifyChanged$}}class Os extends cr{constructor(e){super(e??"The provided geometry value is incorrect"),Object.setPrototypeOf(this,Os.prototype),this.name="GeometryTagError"}}class ire extends oE{constructor(e){if(super(),e.length<2)throw new Os("A points geometry must have two or more positions.");this._points=[];for(const i of e){if(i[0]<0||i[0]>1||i[1]<0||i[1]>1)throw new Os("Basic coordinates of points must be on the interval [0, 1].");this._points.push(i.slice())}}get points(){return this._points}addPoint2d(e){const t=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))];this._points.push(t),this._notifyChanged$.next(this)}getPoint2d(e){return this._points[e].slice()}removePoint2d(e){if(e<0||e>=this._points.length||this._points.length<3)throw new Os("Index for removed point must be valid.");this._points.splice(e,1),this._notifyChanged$.next(this)}setVertex2d(e,t,i){this.setPoint2d(e,t,i)}setPoint2d(e,t,i){const r=[Math.max(0,Math.min(1,t[0])),Math.max(0,Math.min(1,t[1]))];this._points[e]=r,this._notifyChanged$.next(this)}getPoints3d(e){return this._getPoints3d(this._points,e)}getPoint3d(e,t){return t.unprojectBasic(this._points[e],200)}getPoints2d(){return this._points.slice()}getCentroid2d(e){if(!e)throw new Os("Get centroid must be called with a transform for points geometries.");const[t,i,r,o]=this.getRect2d(e),c=t<r?(t+r)/2:(t+r+1)/2%1,s=(i+o)/2;return[c,s]}getCentroid3d(e){let t=this.getCentroid2d();return e.unprojectBasic(t,200)}getRect2d(e){let t=1,i=0,r=1,o=0;const c=this._points;for(const s of c)s[0]<t&&(t=s[0]),s[0]>i&&(i=s[0]),s[1]<r&&(r=s[1]),s[1]>o&&(o=s[1]);if(ki(e.cameraType)){const s=[];for(let g=0;g<c.length;g++)s[g]=g;s.sort((g,_)=>c[g][0]<c[_][0]?-1:c[g][0]>c[_][0]?1:g<_?-1:1);let d=c[s[0]][0]+1-c[s[s.length-1]][0],p=0;for(let g=0;g<s.length-1;g++){const _=s[g],x=s[g+1],b=c[x][0]-c[_][0];b>d&&(d=b,p=g+1)}p>0&&(t=c[s[p]][0],i=c[s[p-1]][0])}return[t,r,i,o]}setCentroid2d(e,t){throw new Error("Not implemented")}_getPoints3d(e,t){return e.map(i=>t.unprojectBasic(i,200))}}class YB{constructor(e,t,i){this._geometry=e,this._transform=t,this._viewportCoords=i||new zo,this._aborted$=new ri,this._created$=new ri,this._glObjectsChanged$=new ri,this._geometryChangedSubscription=this._geometry.changed$.subscribe(()=>{this._onGeometryChanged(),this._glObjectsChanged$.next(this)})}get geometry(){return this._geometry}get glObjects(){return this._glObjects}get aborted$(){return this._aborted$}get created$(){return this._created$}get glObjectsChanged$(){return this._glObjectsChanged$}get geometryChanged$(){return this._geometry.changed$.pipe(it(()=>this))}dispose(){this._geometryChangedSubscription.unsubscribe()}_canvasToTransform(e){const t=Math.round(e[0]),i=Math.round(e[1]);return`translate(-50%,-50%) translate(${t}px,${i}px)`}_colorToBackground(e){return"#"+("000000"+e.toString(16)).substr(-6)}_createOutine(e,t){const i=this._getLinePositions(e),r=new Vn;r.setAttribute("position",new Mn(i,3));const o=new Ph({color:t,linewidth:1});return new Ep(r,o)}_disposeLine(e){e!=null&&(e.geometry.dispose(),e.material.dispose())}_getLinePositions(e){const t=e.length,i=new Float32Array(t*3);for(let r=0;r<t;++r){const o=3*r,c=e[r];i[o]=c[0],i[o+1]=c[1],i[o+2]=c[2]}return i}}var aE={exports:{}};aE.exports=T1;aE.exports.default=T1;function T1(n,e,t){t=t||2;var i=e&&e.length,r=i?e[0]*t:n.length,o=KB(n,0,r,t,!0),c=[];if(!o||o.next===o.prev)return c;var s,d,p,g,_,x,b;if(i&&(o=are(n,e,o,t)),n.length>80*t){s=p=n[0],d=g=n[1];for(var S=t;S<r;S+=t)_=n[S],x=n[S+1],_<s&&(s=_),x<d&&(d=x),_>p&&(p=_),x>g&&(g=x);b=Math.max(p-s,g-d),b=b!==0?1/b:0}return Zy(o,c,t,s,d,b),c}function KB(n,e,t,i,r){var o,c;if(r===w2(n,e,t,i)>0)for(o=e;o<t;o+=i)c=M3(o,n[o],n[o+1],c);else for(o=t-i;o>=e;o-=i)c=M3(o,n[o],n[o+1],c);return c&&M1(c,c.next)&&(Yy(c),c=c.next),c}function jd(n,e){if(!n)return n;e||(e=n);var t=n,i;do if(i=!1,!t.steiner&&(M1(t,t.next)||us(t.prev,t,t.next)===0)){if(Yy(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function Zy(n,e,t,i,r,o,c){if(n){!c&&o&&dre(n,i,r,o);for(var s=n,d,p;n.prev!==n.next;){if(d=n.prev,p=n.next,o?rre(n,i,r,o):nre(n)){e.push(d.i/t),e.push(n.i/t),e.push(p.i/t),Yy(n),n=p.next,s=p.next;continue}if(n=p,n===s){c?c===1?(n=sre(jd(n),e,t),Zy(n,e,t,i,r,o,2)):c===2&&ore(n,e,t,i,r,o):Zy(jd(n),e,t,i,r,o,1);break}}}}function nre(n){var e=n.prev,t=n,i=n.next;if(us(e,t,i)>=0)return!1;for(var r=n.next.next;r!==n.prev;){if(bg(e.x,e.y,t.x,t.y,i.x,i.y,r.x,r.y)&&us(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function rre(n,e,t,i){var r=n.prev,o=n,c=n.next;if(us(r,o,c)>=0)return!1;for(var s=r.x<o.x?r.x<c.x?r.x:c.x:o.x<c.x?o.x:c.x,d=r.y<o.y?r.y<c.y?r.y:c.y:o.y<c.y?o.y:c.y,p=r.x>o.x?r.x>c.x?r.x:c.x:o.x>c.x?o.x:c.x,g=r.y>o.y?r.y>c.y?r.y:c.y:o.y>c.y?o.y:c.y,_=b2(s,d,e,t,i),x=b2(p,g,e,t,i),b=n.prevZ,S=n.nextZ;b&&b.z>=_&&S&&S.z<=x;){if(b!==n.prev&&b!==n.next&&bg(r.x,r.y,o.x,o.y,c.x,c.y,b.x,b.y)&&us(b.prev,b,b.next)>=0||(b=b.prevZ,S!==n.prev&&S!==n.next&&bg(r.x,r.y,o.x,o.y,c.x,c.y,S.x,S.y)&&us(S.prev,S,S.next)>=0))return!1;S=S.nextZ}for(;b&&b.z>=_;){if(b!==n.prev&&b!==n.next&&bg(r.x,r.y,o.x,o.y,c.x,c.y,b.x,b.y)&&us(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;S&&S.z<=x;){if(S!==n.prev&&S!==n.next&&bg(r.x,r.y,o.x,o.y,c.x,c.y,S.x,S.y)&&us(S.prev,S,S.next)>=0)return!1;S=S.nextZ}return!0}function sre(n,e,t){var i=n;do{var r=i.prev,o=i.next.next;!M1(r,o)&&JB(r,i,i.next,o)&&Xy(r,o)&&Xy(o,r)&&(e.push(r.i/t),e.push(i.i/t),e.push(o.i/t),Yy(i),Yy(i.next),i=n=o),i=i.next}while(i!==n);return jd(i)}function ore(n,e,t,i,r,o){var c=n;do{for(var s=c.next.next;s!==c.prev;){if(c.i!==s.i&&mre(c,s)){var d=QB(c,s);c=jd(c,c.next),d=jd(d,d.next),Zy(c,e,t,i,r,o),Zy(d,e,t,i,r,o);return}s=s.next}c=c.next}while(c!==n)}function are(n,e,t,i){var r=[],o,c,s,d,p;for(o=0,c=e.length;o<c;o++)s=e[o]*i,d=o<c-1?e[o+1]*i:n.length,p=KB(n,s,d,i,!1),p===p.next&&(p.steiner=!0),r.push(pre(p));for(r.sort(lre),o=0;o<r.length;o++)t=cre(r[o],t),t=jd(t,t.next);return t}function lre(n,e){return n.x-e.x}function cre(n,e){var t=ure(n,e);if(!t)return e;var i=QB(t,n),r=jd(t,t.next);return jd(i,i.next),e===t?r:e}function ure(n,e){var t=e,i=n.x,r=n.y,o=-1/0,c;do{if(r<=t.y&&r>=t.next.y&&t.next.y!==t.y){var s=t.x+(r-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(s<=i&&s>o){if(o=s,s===i){if(r===t.y)return t;if(r===t.next.y)return t.next}c=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!c)return null;if(i===o)return c;var d=c,p=c.x,g=c.y,_=1/0,x;t=c;do i>=t.x&&t.x>=p&&i!==t.x&&bg(r<g?i:o,r,p,g,r<g?o:i,r,t.x,t.y)&&(x=Math.abs(r-t.y)/(i-t.x),Xy(t,n)&&(x<_||x===_&&(t.x>c.x||t.x===c.x&&hre(c,t)))&&(c=t,_=x)),t=t.next;while(t!==d);return c}function hre(n,e){return us(n.prev,n,e.prev)<0&&us(e.next,n,n.next)<0}function dre(n,e,t,i){var r=n;do r.z===null&&(r.z=b2(r.x,r.y,e,t,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==n);r.prevZ.nextZ=null,r.prevZ=null,fre(r)}function fre(n){var e,t,i,r,o,c,s,d,p=1;do{for(t=n,n=null,o=null,c=0;t;){for(c++,i=t,s=0,e=0;e<p&&(s++,i=i.nextZ,!!i);e++);for(d=p;s>0||d>0&&i;)s!==0&&(d===0||!i||t.z<=i.z)?(r=t,t=t.nextZ,s--):(r=i,i=i.nextZ,d--),o?o.nextZ=r:n=r,r.prevZ=o,o=r;t=i}o.nextZ=null,p*=2}while(c>1);return n}function b2(n,e,t,i,r){return n=32767*(n-t)*r,e=32767*(e-i)*r,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function pre(n){var e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function bg(n,e,t,i,r,o,c,s){return(r-c)*(e-s)-(n-c)*(o-s)>=0&&(n-c)*(i-s)-(t-c)*(e-s)>=0&&(t-c)*(o-s)-(r-c)*(i-s)>=0}function mre(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!gre(n,e)&&(Xy(n,e)&&Xy(e,n)&&_re(n,e)&&(us(n.prev,n,e.prev)||us(n,e.prev,e))||M1(n,e)&&us(n.prev,n,n.next)>0&&us(e.prev,e,e.next)>0)}function us(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function M1(n,e){return n.x===e.x&&n.y===e.y}function JB(n,e,t,i){var r=Tx(us(n,e,t)),o=Tx(us(n,e,i)),c=Tx(us(t,i,n)),s=Tx(us(t,i,e));return!!(r!==o&&c!==s||r===0&&Sx(n,t,e)||o===0&&Sx(n,i,e)||c===0&&Sx(t,n,i)||s===0&&Sx(t,e,i))}function Sx(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function Tx(n){return n>0?1:n<0?-1:0}function gre(n,e){var t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&JB(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function Xy(n,e){return us(n.prev,n,n.next)<0?us(n,e,n.next)>=0&&us(n,n.prev,e)>=0:us(n,e,n.prev)<0||us(n,n.next,e)<0}function _re(n,e){var t=n,i=!1,r=(n.x+e.x)/2,o=(n.y+e.y)/2;do t.y>o!=t.next.y>o&&t.next.y!==t.y&&r<(t.next.x-t.x)*(o-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==n);return i}function QB(n,e){var t=new x2(n.i,n.x,n.y),i=new x2(e.i,e.x,e.y),r=n.next,o=e.prev;return n.next=e,e.prev=n,t.next=r,r.prev=t,i.next=t,t.prev=i,o.next=i,i.prev=o,i}function M3(n,e,t,i){var r=new x2(n,e,t);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Yy(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function x2(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}T1.deviation=function(n,e,t,i){var r=e&&e.length,o=r?e[0]*t:n.length,c=Math.abs(w2(n,0,o,t));if(r)for(var s=0,d=e.length;s<d;s++){var p=e[s]*t,g=s<d-1?e[s+1]*t:n.length;c-=Math.abs(w2(n,p,g,t))}var _=0;for(s=0;s<i.length;s+=3){var x=i[s]*t,b=i[s+1]*t,S=i[s+2]*t;_+=Math.abs((n[x]-n[S])*(n[b+1]-n[x+1])-(n[x]-n[b])*(n[S+1]-n[x+1]))}return c===0&&_===0?0:Math.abs((_-c)/c)};function w2(n,e,t,i){for(var r=0,o=e,c=t-i;o<t;o+=i)r+=(n[c]-n[o])*(n[o+1]+n[c+1]),c=o;return r}T1.flatten=function(n){for(var e=n[0][0].length,t={vertices:[],holes:[],dimensions:e},i=0,r=0;r<n.length;r++){for(var o=0;o<n[r].length;o++)for(var c=0;c<e;c++)t.vertices.push(n[r][o][c]);r>0&&(i+=n[r-1].length,t.holes.push(i))}return t};var C3=aE.exports,lE={exports:{}};class vre{constructor(e=[],t=yre){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:i}=this,r=t[e];for(;e>0;){const o=e-1>>1,c=t[o];if(i(r,c)>=0)break;t[e]=c,e=o}t[e]=r}_down(e){const{data:t,compare:i}=this,r=this.length>>1,o=t[e];for(;e<r;){let c=(e<<1)+1,s=t[c];const d=c+1;if(d<this.length&&i(t[d],s)<0&&(c=d,s=t[d]),i(s,o)>=0)break;t[e]=s,e=c}t[e]=o}}function yre(n,e){return n<e?-1:n>e?1:0}var bre=Object.freeze({__proto__:null,default:vre}),xre=mee(bre),Xx=xre;Xx.default&&(Xx=Xx.default);lE.exports=eN;lE.exports.default=eN;function eN(n,e,t){e=e||1;for(var i,r,o,c,s=0;s<n[0].length;s++){var d=n[0][s];(!s||d[0]<i)&&(i=d[0]),(!s||d[1]<r)&&(r=d[1]),(!s||d[0]>o)&&(o=d[0]),(!s||d[1]>c)&&(c=d[1])}var p=o-i,g=c-r,_=Math.min(p,g),x=_/2;if(_===0){var b=[i,r];return b.distance=0,b}for(var S=new Xx(void 0,wre),P=i;P<o;P+=_)for(var L=r;L<c;L+=_)S.push(new wd(P+x,L+x,x,n));var E=Tre(n),C=new wd(i+p/2,r+g/2,0,n);C.d>E.d&&(E=C);for(var D=S.length;S.length;){var O=S.pop();O.d>E.d&&(E=O,t&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,D)),!(O.max-E.d<=e)&&(x=O.h/2,S.push(new wd(O.x-x,O.y-x,x,n)),S.push(new wd(O.x+x,O.y-x,x,n)),S.push(new wd(O.x-x,O.y+x,x,n)),S.push(new wd(O.x+x,O.y+x,x,n)),D+=4)}t&&(console.log("num probes: "+D),console.log("best distance: "+E.d));var U=[E.x,E.y];return U.distance=E.d,U}function wre(n,e){return e.max-n.max}function wd(n,e,t,i){this.x=n,this.y=e,this.h=t,this.d=Sre(n,e,i),this.max=this.d+this.h*Math.SQRT2}function Sre(n,e,t){for(var i=!1,r=1/0,o=0;o<t.length;o++)for(var c=t[o],s=0,d=c.length,p=d-1;s<d;p=s++){var g=c[s],_=c[p];g[1]>e!=_[1]>e&&n<(_[0]-g[0])*(e-g[1])/(_[1]-g[1])+g[0]&&(i=!i),r=Math.min(r,Mre(n,e,g,_))}return r===0?0:(i?1:-1)*Math.sqrt(r)}function Tre(n){for(var e=0,t=0,i=0,r=n[0],o=0,c=r.length,s=c-1;o<c;s=o++){var d=r[o],p=r[s],g=d[0]*p[1]-p[0]*d[1];t+=(d[0]+p[0])*g,i+=(d[1]+p[1])*g,e+=g*3}return e===0?new wd(r[0][0],r[0][1],0,n):new wd(t/e,i/e,0,n)}function Mre(n,e,t,i){var r=t[0],o=t[1],c=i[0]-r,s=i[1]-o;if(c!==0||s!==0){var d=((n-r)*c+(e-o)*s)/(c*c+s*s);d>1?(r=i[0],o=i[1]):d>0&&(r+=c*d,o+=s*d)}return c=n-r,s=e-o,c*c+s*s}var Cre=lE.exports;function Ere(n,e){return n>e?1:n<e?-1:0}class cE{constructor(e=Ere,t=!1){this._compare=e,this._root=null,this._size=0,this._noDuplicates=!!t}rotateLeft(e){var t=e.right;t&&(e.right=t.left,t.left&&(t.left.parent=e),t.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.left=e),e.parent=t}rotateRight(e){var t=e.left;t&&(e.left=t.right,t.right&&(t.right.parent=e),t.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.right=e),e.parent=t}_splay(e){for(;e.parent;){var t=e.parent;t.parent?t.left===e&&t.parent.left===t?(this.rotateRight(t.parent),this.rotateRight(t)):t.right===e&&t.parent.right===t?(this.rotateLeft(t.parent),this.rotateLeft(t)):t.left===e&&t.parent.right===t?(this.rotateRight(t),this.rotateLeft(t)):(this.rotateLeft(t),this.rotateRight(t)):t.left===e?this.rotateRight(t):this.rotateLeft(t)}}splay(e){for(var t,i,r,o,c;e.parent;)t=e.parent,i=t.parent,i&&i.parent?(r=i.parent,r.left===i?r.left=e:r.right=e,e.parent=r):(e.parent=null,this._root=e),o=e.left,c=e.right,e===t.left?(i&&(i.left===t?(t.right?(i.left=t.right,i.left.parent=i):i.left=null,t.right=i,i.parent=t):(o?(i.right=o,o.parent=i):i.right=null,e.left=i,i.parent=e)),c?(t.left=c,c.parent=t):t.left=null,e.right=t,t.parent=e):(i&&(i.right===t?(t.left?(i.right=t.left,i.right.parent=i):i.right=null,t.left=i,i.parent=t):(c?(i.left=c,c.parent=i):i.left=null,e.right=i,i.parent=e)),o?(t.right=o,o.parent=t):t.right=null,e.left=t,t.parent=e)}replace(e,t){e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.parent=e.parent)}minNode(e=this._root){if(e)for(;e.left;)e=e.left;return e}maxNode(e=this._root){if(e)for(;e.right;)e=e.right;return e}insert(e,t){var i=this._root,r=null,o=this._compare,c;if(this._noDuplicates)for(;i;){if(r=i,c=o(i.key,e),c===0)return;o(i.key,e)<0?i=i.right:i=i.left}else for(;i;)r=i,o(i.key,e)<0?i=i.right:i=i.left;return i={key:e,data:t,left:null,right:null,parent:r},r?o(r.key,i.key)<0?r.right=i:r.left=i:this._root=i,this.splay(i),this._size++,i}find(e){for(var t=this._root,i=this._compare;t;){var r=i(t.key,e);if(r<0)t=t.right;else if(r>0)t=t.left;else return t}return null}contains(e){for(var t=this._root,i=this._compare;t;){var r=i(e,t.key);if(r===0)return!0;r<0?t=t.left:t=t.right}return!1}remove(e){var t=this.find(e);if(!t)return!1;if(this.splay(t),!t.left)this.replace(t,t.right);else if(!t.right)this.replace(t,t.left);else{var i=this.minNode(t.right);i.parent!==t&&(this.replace(i,i.right),i.right=t.right,i.right.parent=i),this.replace(t,i),i.left=t.left,i.left.parent=i}return this._size--,!0}removeNode(e){if(!e)return!1;if(this.splay(e),!e.left)this.replace(e,e.right);else if(!e.right)this.replace(e,e.left);else{var t=this.minNode(e.right);t.parent!==e&&(this.replace(t,t.right),t.right=e.right,t.right.parent=t),this.replace(e,t),t.left=e.left,t.left.parent=t}return this._size--,!0}erase(e){var t=this.find(e);if(t){this.splay(t);var i=t.left,r=t.right,o=null;i&&(i.parent=null,o=this.maxNode(i),this.splay(o),this._root=o),r&&(i?o.right=r:this._root=r,r.parent=o),this._size--}}pop(){var e=this._root,t=null;if(e){for(;e.left;)e=e.left;t={key:e.key,data:e.data},this.remove(e.key)}return t}next(e){var t=e;if(t)if(t.right)for(t=t.right;t&&t.left;)t=t.left;else for(t=e.parent;t&&t.right===e;)e=t,t=t.parent;return t}prev(e){var t=e;if(t)if(t.left)for(t=t.left;t&&t.right;)t=t.right;else for(t=e.parent;t&&t.left===e;)e=t,t=t.parent;return t}forEach(e){for(var t=this._root,i=[],r=!1,o=0;!r;)t?(i.push(t),t=t.left):i.length>0?(t=i.pop(),e(t,o++),t=t.right):r=!0;return this}range(e,t,i,r){const o=[],c=this._compare;let s=this._root,d;for(;o.length!==0||s;)if(s)o.push(s),s=s.left;else{if(s=o.pop(),d=c(s.key,t),d>0)break;if(c(s.key,e)>=0&&i.call(r,s))return this;s=s.right}return this}keys(){for(var e=this._root,t=[],i=[],r=!1;!r;)e?(t.push(e),e=e.left):t.length>0?(e=t.pop(),i.push(e.key),e=e.right):r=!0;return i}values(){for(var e=this._root,t=[],i=[],r=!1;!r;)e?(t.push(e),e=e.left):t.length>0?(e=t.pop(),i.push(e.data),e=e.right):r=!0;return i}at(e){for(var t=this._root,i=[],r=!1,o=0;!r;)if(t)i.push(t),t=t.left;else if(i.length>0){if(t=i.pop(),o===e)return t;o++,t=t.right}else r=!0;return null}load(e=[],t=[],i=!1){if(this._size!==0)throw new Error("bulk-load: tree is not empty");const r=e.length;return i&&T2(e,t,0,r-1,this._compare),this._root=S2(null,e,t,0,r),this._size=r,this}min(){var e=this.minNode(this._root);return e?e.key:null}max(){var e=this.maxNode(this._root);return e?e.key:null}isEmpty(){return this._root===null}get size(){return this._size}static createTree(e,t,i,r,o){return new cE(i,o).load(e,t,r)}}function S2(n,e,t,i,r){const o=r-i;if(o>0){const c=i+Math.floor(o/2),s=e[c],d=t[c],p={key:s,data:d,parent:n};return p.left=S2(p,e,t,i,c),p.right=S2(p,e,t,c+1,r),p}return null}function T2(n,e,t,i,r){if(t>=i)return;const o=n[t+i>>1];let c=t-1,s=i+1;for(;;){do c++;while(r(n[c],o)<0);do s--;while(r(n[s],o)>0);if(c>=s)break;let d=n[c];n[c]=n[s],n[s]=d,d=e[c],e[c]=e[s],e[s]=d}T2(n,e,t,s,r),T2(n,e,s+1,i,r)}const tN=0,iN=1,nN=2,rN=3,zw=0,M2=1,Bw=2,sN=3;function zv(n,e,t){e===null?(n.inOut=!1,n.otherInOut=!0):(n.isSubject===e.isSubject?(n.inOut=!e.inOut,n.otherInOut=e.otherInOut):(n.inOut=!e.otherInOut,n.otherInOut=e.isVertical()?!e.inOut:e.inOut),e&&(n.prevInResult=!E3(e,t)||e.isVertical()?e.prevInResult:e)),E3(n,t)?n.resultTransition=Are(n,t):n.resultTransition=0}function E3(n,e){switch(n.type){case tN:switch(e){case zw:return!n.otherInOut;case M2:return n.otherInOut;case Bw:return n.isSubject&&n.otherInOut||!n.isSubject&&!n.otherInOut;case sN:return!0}break;case nN:return e===zw||e===M2;case rN:return e===Bw;case iN:return!1}return!1}function Are(n,e){let t=!n.inOut,i=!n.otherInOut,r;switch(e){case zw:r=t&&i;break;case M2:r=t||i;break;case sN:r=t^i;break;case Bw:n.isSubject?r=t&&!i:r=i&&!t;break}return r?1:-1}class Jg{constructor(e,t,i,r,o){this.left=t,this.point=e,this.otherEvent=i,this.isSubject=r,this.type=o||tN,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0}isBelow(e){const t=this.point,i=this.otherEvent.point;return this.left?(t[0]-e[0])*(i[1]-e[1])-(i[0]-e[0])*(t[1]-e[1])>0:(i[0]-e[0])*(t[1]-e[1])-(t[0]-e[0])*(i[1]-e[1])>0}isAbove(e){return!this.isBelow(e)}isVertical(){return this.point[0]===this.otherEvent.point[0]}get inResult(){return this.resultTransition!==0}clone(){const e=new Jg(this.point,this.left,this.otherEvent,this.isSubject,this.type);return e.contourId=this.contourId,e.resultTransition=this.resultTransition,e.prevInResult=this.prevInResult,e.isExteriorRing=this.isExteriorRing,e.inOut=this.inOut,e.otherInOut=this.otherInOut,e}}function eu(n,e){return n[0]===e[0]?n[1]===e[1]:!1}const yh=11102230246251565e-32,Co=134217729,Pre=(3+8*yh)*yh;function hM(n,e,t,i,r){let o,c,s,d,p=e[0],g=i[0],_=0,x=0;g>p==g>-p?(o=p,p=e[++_]):(o=g,g=i[++x]);let b=0;if(_<n&&x<t)for(g>p==g>-p?(c=p+o,s=o-(c-p),p=e[++_]):(c=g+o,s=o-(c-g),g=i[++x]),o=c,s!==0&&(r[b++]=s);_<n&&x<t;)g>p==g>-p?(c=o+p,d=c-o,s=o-(c-d)+(p-d),p=e[++_]):(c=o+g,d=c-o,s=o-(c-d)+(g-d),g=i[++x]),o=c,s!==0&&(r[b++]=s);for(;_<n;)c=o+p,d=c-o,s=o-(c-d)+(p-d),p=e[++_],o=c,s!==0&&(r[b++]=s);for(;x<t;)c=o+g,d=c-o,s=o-(c-d)+(g-d),g=i[++x],o=c,s!==0&&(r[b++]=s);return(o!==0||b===0)&&(r[b++]=o),b}function Ire(n,e){let t=e[0];for(let i=1;i<n;i++)t+=e[i];return t}function S0(n){return new Float64Array(n)}const Rre=(3+16*yh)*yh,Lre=(2+12*yh)*yh,kre=(9+64*yh)*yh*yh,og=S0(4),A3=S0(8),P3=S0(12),I3=S0(16),Xo=S0(4);function Dre(n,e,t,i,r,o,c){let s,d,p,g,_,x,b,S,P,L,E,C,D,O,U,q,G,N;const V=n-r,j=t-r,z=e-o,Q=i-o;O=V*Q,x=Co*V,b=x-(x-V),S=V-b,x=Co*Q,P=x-(x-Q),L=Q-P,U=S*L-(O-b*P-S*P-b*L),q=z*j,x=Co*z,b=x-(x-z),S=z-b,x=Co*j,P=x-(x-j),L=j-P,G=S*L-(q-b*P-S*P-b*L),E=U-G,_=U-E,og[0]=U-(E+_)+(_-G),C=O+E,_=C-O,D=O-(C-_)+(E-_),E=D-q,_=D-E,og[1]=D-(E+_)+(_-q),N=C+E,_=N-C,og[2]=C-(N-_)+(E-_),og[3]=N;let X=Ire(4,og),re=Lre*c;if(X>=re||-X>=re||(_=n-V,s=n-(V+_)+(_-r),_=t-j,p=t-(j+_)+(_-r),_=e-z,d=e-(z+_)+(_-o),_=i-Q,g=i-(Q+_)+(_-o),s===0&&d===0&&p===0&&g===0)||(re=kre*c+Pre*Math.abs(X),X+=V*g+Q*s-(z*p+j*d),X>=re||-X>=re))return X;O=s*Q,x=Co*s,b=x-(x-s),S=s-b,x=Co*Q,P=x-(x-Q),L=Q-P,U=S*L-(O-b*P-S*P-b*L),q=d*j,x=Co*d,b=x-(x-d),S=d-b,x=Co*j,P=x-(x-j),L=j-P,G=S*L-(q-b*P-S*P-b*L),E=U-G,_=U-E,Xo[0]=U-(E+_)+(_-G),C=O+E,_=C-O,D=O-(C-_)+(E-_),E=D-q,_=D-E,Xo[1]=D-(E+_)+(_-q),N=C+E,_=N-C,Xo[2]=C-(N-_)+(E-_),Xo[3]=N;const se=hM(4,og,4,Xo,A3);O=V*g,x=Co*V,b=x-(x-V),S=V-b,x=Co*g,P=x-(x-g),L=g-P,U=S*L-(O-b*P-S*P-b*L),q=z*p,x=Co*z,b=x-(x-z),S=z-b,x=Co*p,P=x-(x-p),L=p-P,G=S*L-(q-b*P-S*P-b*L),E=U-G,_=U-E,Xo[0]=U-(E+_)+(_-G),C=O+E,_=C-O,D=O-(C-_)+(E-_),E=D-q,_=D-E,Xo[1]=D-(E+_)+(_-q),N=C+E,_=N-C,Xo[2]=C-(N-_)+(E-_),Xo[3]=N;const le=hM(se,A3,4,Xo,P3);O=s*g,x=Co*s,b=x-(x-s),S=s-b,x=Co*g,P=x-(x-g),L=g-P,U=S*L-(O-b*P-S*P-b*L),q=d*p,x=Co*d,b=x-(x-d),S=d-b,x=Co*p,P=x-(x-p),L=p-P,G=S*L-(q-b*P-S*P-b*L),E=U-G,_=U-E,Xo[0]=U-(E+_)+(_-G),C=O+E,_=C-O,D=O-(C-_)+(E-_),E=D-q,_=D-E,Xo[1]=D-(E+_)+(_-q),N=C+E,_=N-C,Xo[2]=C-(N-_)+(E-_),Xo[3]=N;const ce=hM(le,P3,4,Xo,I3);return I3[ce-1]}function Fre(n,e,t,i,r,o){const c=(e-o)*(t-r),s=(n-r)*(i-o),d=c-s;if(c===0||s===0||c>0!=s>0)return d;const p=Math.abs(c+s);return Math.abs(d)>=Rre*p?d:-Dre(n,e,t,i,r,o,p)}function C2(n,e,t){const i=Fre(n[0],n[1],e[0],e[1],t[0],t[1]);return i>0?-1:i<0?1:0}function Gd(n,e){const t=n.point,i=e.point;return t[0]>i[0]?1:t[0]<i[0]?-1:t[1]!==i[1]?t[1]>i[1]?1:-1:Ore(n,e,t)}function Ore(n,e,t,i){return n.left!==e.left?n.left?1:-1:C2(t,n.otherEvent.point,e.otherEvent.point)!==0?n.isBelow(e.otherEvent.point)?-1:1:!n.isSubject&&e.isSubject?1:-1}function yd(n,e,t){const i=new Jg(e,!1,n,n.isSubject),r=new Jg(e,!0,n.otherEvent,n.isSubject);return eu(n.point,n.otherEvent.point)&&console.warn("what is that, a collapsed segment?",n),i.contourId=r.contourId=n.contourId,Gd(r,n.otherEvent)>0&&(n.otherEvent.left=!0,r.left=!1),n.otherEvent.otherEvent=r,n.otherEvent=i,t.push(r),t.push(i),t}function Mx(n,e){return n[0]*e[1]-n[1]*e[0]}function dM(n,e){return n[0]*e[0]+n[1]*e[1]}function zre(n,e,t,i,r){const o=[e[0]-n[0],e[1]-n[1]],c=[i[0]-t[0],i[1]-t[1]];function s(L,E,C){return[L[0]+E*C[0],L[1]+E*C[1]]}const d=[t[0]-n[0],t[1]-n[1]];let p=Mx(o,c),g=p*p;const _=dM(o,o);if(g>0){const L=Mx(d,c)/p;if(L<0||L>1)return null;const E=Mx(d,o)/p;return E<0||E>1?null:L===0||L===1?[s(n,L,o)]:E===0||E===1?[s(t,E,c)]:[s(n,L,o)]}if(p=Mx(d,o),g=p*p,g>0)return null;const x=dM(o,d)/_,b=x+dM(o,c)/_,S=Math.min(x,b),P=Math.max(x,b);return S<=1&&P>=0?S===1?[s(n,S>0?S:0,o)]:P===0?[s(n,P<1?P:1,o)]:[s(n,S>0?S:0,o),s(n,P<1?P:1,o)]:null}function fM(n,e,t){const i=zre(n.point,n.otherEvent.point,e.point,e.otherEvent.point),r=i?i.length:0;if(r===0||r===1&&(eu(n.point,e.point)||eu(n.otherEvent.point,e.otherEvent.point))||r===2&&n.isSubject===e.isSubject)return 0;if(r===1)return!eu(n.point,i[0])&&!eu(n.otherEvent.point,i[0])&&yd(n,i[0],t),!eu(e.point,i[0])&&!eu(e.otherEvent.point,i[0])&&yd(e,i[0],t),1;const o=[];let c=!1,s=!1;return eu(n.point,e.point)?c=!0:Gd(n,e)===1?o.push(e,n):o.push(n,e),eu(n.otherEvent.point,e.otherEvent.point)?s=!0:Gd(n.otherEvent,e.otherEvent)===1?o.push(e.otherEvent,n.otherEvent):o.push(n.otherEvent,e.otherEvent),c&&s||c?(e.type=iN,n.type=e.inOut===n.inOut?nN:rN,c&&!s&&yd(o[1].otherEvent,o[0].point,t),2):s?(yd(o[0],o[1].point,t),3):o[0]!==o[3].otherEvent?(yd(o[0],o[1].point,t),yd(o[1],o[2].point,t),3):(yd(o[0],o[1].point,t),yd(o[3].otherEvent,o[2].point,t),3)}function Bre(n,e){if(n===e)return 0;if(C2(n.point,n.otherEvent.point,e.point)!==0||C2(n.point,n.otherEvent.point,e.otherEvent.point)!==0)return eu(n.point,e.point)?n.isBelow(e.otherEvent.point)?-1:1:n.point[0]===e.point[0]?n.point[1]<e.point[1]?-1:1:Gd(n,e)===1?e.isAbove(n.point)?-1:1:n.isBelow(e.point)?-1:1;if(n.isSubject===e.isSubject){let t=n.point,i=e.point;if(t[0]===i[0]&&t[1]===i[1])return t=n.otherEvent.point,i=e.otherEvent.point,t[0]===i[0]&&t[1]===i[1]?0:n.contourId>e.contourId?1:-1}else return n.isSubject?-1:1;return Gd(n,e)===1?1:-1}function Nre(n,e,t,i,r,o){const c=new cE(Bre),s=[],d=Math.min(i[2],r[2]);let p,g,_;for(;n.length!==0;){let x=n.pop();if(s.push(x),x.point[0]>d||o===Bw)break;if(x.left){g=p=c.insert(x),_=c.minNode(),p!==_?p=c.prev(p):p=null,g=c.next(g);const b=p?p.key:null;let S;if(zv(x,b,o),g&&fM(x,g.key,n)===2&&(zv(x,b,o),zv(x,g.key,o)),p&&fM(p.key,x,n)===2){let P=p;P!==_?P=c.prev(P):P=null,S=P?P.key:null,zv(b,S,o),zv(x,b,o)}}else x=x.otherEvent,g=p=c.find(x),p&&g&&(p!==_?p=c.prev(p):p=null,g=c.next(g),c.remove(x),g&&p&&fM(p.key,g.key,n))}return s}class $re{constructor(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null}isExterior(){return this.holeOf==null}}function Vre(n){let e,t,i,r;const o=[];for(t=0,i=n.length;t<i;t++)e=n[t],(e.left&&e.inResult||!e.left&&e.otherEvent.inResult)&&o.push(e);let c=!1;for(;!c;)for(c=!0,t=0,i=o.length;t<i;t++)t+1<i&&Gd(o[t],o[t+1])===1&&(r=o[t],o[t]=o[t+1],o[t+1]=r,c=!1);for(t=0,i=o.length;t<i;t++)e=o[t],e.otherPos=t;for(t=0,i=o.length;t<i;t++)e=o[t],e.left||(r=e.otherPos,e.otherPos=e.otherEvent.otherPos,e.otherEvent.otherPos=r);return o}function Ure(n,e,t,i){let r=n+1,o=e[n].point,c;const s=e.length;for(r<s&&(c=e[r].point);r<s&&c[0]===o[0]&&c[1]===o[1];){if(t[r])r++;else return r;c=e[r].point}for(r=n-1;t[r]&&r>i;)r--;return r}function jre(n,e,t){const i=new $re;if(n.prevInResult!=null){const r=n.prevInResult,o=r.outputContourId;if(r.resultTransition>0){const s=e[o];if(s.holeOf!=null){const d=s.holeOf;e[d].holeIds.push(t),i.holeOf=d,i.depth=e[o].depth}else e[o].holeIds.push(t),i.holeOf=o,i.depth=e[o].depth+1}else i.holeOf=null,i.depth=e[o].depth}else i.holeOf=null,i.depth=0;return i}function Gre(n){let e,t;const i=Vre(n),r={},o=[];for(e=0,t=i.length;e<t;e++){if(r[e])continue;const c=o.length,s=jre(i[e],o,c),d=x=>{r[x]=!0,i[x].outputContourId=c};let p=e,g=e;const _=i[e].point;for(s.points.push(_);d(p),p=i[p].otherPos,d(p),s.points.push(i[p].point),p=Ure(p,i,r,g),p!=g;);o.push(s)}return o}var uE={exports:{}};uE.exports=Ky;uE.exports.default=Ky;function Ky(n,e){if(!(this instanceof Ky))return new Ky(n,e);if(this.data=n||[],this.length=this.data.length,this.compare=e||qre,this.length>0)for(var t=(this.length>>1)-1;t>=0;t--)this._down(t)}function qre(n,e){return n<e?-1:n>e?1:0}Ky.prototype={push:function(n){this.data.push(n),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var n=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),n}},peek:function(){return this.data[0]},_up:function(n){for(var e=this.data,t=this.compare,i=e[n];n>0;){var r=n-1>>1,o=e[r];if(t(i,o)>=0)break;e[n]=o,n=r}e[n]=i},_down:function(n){for(var e=this.data,t=this.compare,i=this.length>>1,r=e[n];n<i;){var o=(n<<1)+1,c=o+1,s=e[o];if(c<this.length&&t(e[c],s)<0&&(o=c,s=e[c]),t(s,r)>=0)break;e[n]=s,n=o}e[n]=r}};var Wre=uE.exports;const R3=Math.max,L3=Math.min;let Cx=0;function k3(n,e,t,i,r,o){let c,s,d,p,g,_;for(c=0,s=n.length-1;c<s;c++){if(d=n[c],p=n[c+1],g=new Jg(d,!1,void 0,e),_=new Jg(p,!1,g,e),g.otherEvent=_,d[0]===p[0]&&d[1]===p[1])continue;g.contourId=_.contourId=t,o||(g.isExteriorRing=!1,_.isExteriorRing=!1),Gd(g,_)>0?_.left=!0:g.left=!0;const x=d[0],b=d[1];r[0]=L3(r[0],x),r[1]=L3(r[1],b),r[2]=R3(r[2],x),r[3]=R3(r[3],b),i.push(g),i.push(_)}}function Hre(n,e,t,i,r){const o=new Wre(null,Gd);let c,s,d,p,g,_;for(d=0,p=n.length;d<p;d++)for(c=n[d],g=0,_=c.length;g<_;g++)s=g===0,s&&Cx++,k3(c[g],!0,Cx,o,t,s);for(d=0,p=e.length;d<p;d++)for(c=e[d],g=0,_=c.length;g<_;g++)s=g===0,s&&Cx++,k3(c[g],!1,Cx,o,i,s);return o}const Nw=[];function Zre(n,e,t){let i=null;return n.length*e.length===0&&(i=Nw),i}function Xre(n,e,t,i,r){let o=null;return(t[0]>i[2]||i[0]>t[2]||t[1]>i[3]||i[1]>t[3])&&(o=Nw),o}function Yre(n,e,t){typeof n[0][0][0]=="number"&&(n=[n]),typeof e[0][0][0]=="number"&&(e=[e]);let i=Zre(n,e);if(i)return i===Nw?null:i;const r=[1/0,1/0,-1/0,-1/0],o=[1/0,1/0,-1/0,-1/0],c=Hre(n,e,r,o);if(i=Xre(n,e,r,o),i)return i===Nw?null:i;const s=Nre(c,n,e,r,o,t),d=Gre(s),p=[];for(let g=0;g<d.length;g++){let _=d[g];if(_.isExterior()){let x=[_.points];for(let b=0;b<_.holeIds.length;b++){let S=_.holeIds[b];x.push(d[S].points)}p.push(x)}}return p}function Kre(n,e){return Yre(n,e,zw)}class oN extends oE{constructor(){super(),this._subsampleThreshold=.005}_getPoleOfInaccessibility2d(e){return Cre([e],.03)}_project(e,t){const i=this._createCamera(t.upVector().toArray(),t.unprojectSfM([0,0],0),t.unprojectSfM([0,0],10));return this._deunproject(e,t,i)}_subsample(e,t=this._subsampleThreshold){const i=[],r=e.length;for(let o=0;o<r;o++){const c=e[o],s=e[(o+1)%r];i.push(c);const d=Math.sqrt(Math.pow(s[0]-c[0],2)+Math.pow(s[1]-c[1],2)),p=Math.floor(d/t),g=1/(p+1);for(let _=1;_<=p;_++){const x=_*g,b=[(1-x)*c[0]+x*s[0],(1-x)*c[1]+x*s[1]];i.push(b)}}return i}_triangulate(e,t,i,r){let o=[e.slice(0,-1)];for(let g of i??[])o.push(g.slice(0,-1));let c=t.slice(0,-1);for(let g of r??[])c=c.concat(g.slice(0,-1));let s=C3.flatten(o),d=C3(s.vertices,s.holes,s.dimensions),p=[];for(let g=0;g<d.length;++g){let _=c[d[g]];p.push(_[0]),p.push(_[1]),p.push(_[2])}return p}_triangulateSpherical(e,t,i){const r=[];for(let d=0;d<3;d++)for(let p=0;p<3;p++){const g=d===0?-1e-9:1e-9,_=p===0?-1e-9:1e-9,x=d/3+g,b=p/3+_,S=(d+1)/3+1e-9,P=(p+1)/3+1e-9,L=[[x,b],[x,P],[S,P],[S,b],[x,b]],E=[(2*d+1)/6,(2*p+1)/6];r.push(...this._triangulateSubarea(e,t,L,E,i))}return r}_unproject(e,t,i=200){return e.map(r=>t.unprojectBasic(r,i))}_createCamera(e,t,i){const r=new m0;return r.up.copy(new Ue().fromArray(e)),r.position.copy(new Ue().fromArray(t)),r.lookAt(new Ue().fromArray(i)),r.updateMatrix(),r.updateMatrixWorld(!0),r}_deunproject(e,t,i){return e.map(r=>{const o=t.unprojectBasic(r,1e4),c=new Ue(o[0],o[1],o[2]).applyMatrix4(i.matrixWorldInverse);return[c.x/c.z,c.y/c.z]})}_triangulateSubarea(e,t,i,r,o){const c=Kre([e,...t],[i]);if(!c)return[];const s=[],d=this._subsampleThreshold,p=this._createCamera(o.upVector().toArray(),o.unprojectSfM([0,0],0),o.unprojectBasic(r,10));for(const g of c){const _=this._subsample(g[0],d),x=this._deunproject(_,o,p),b=this._unproject(_,o),S=[],P=[];for(let L=1;L<g.length;L++){let E=this._subsample(g[L],d);const C=this._deunproject(E,o,p),D=this._unproject(E,o);S.push(C),P.push(D)}s.push(...this._triangulate(x,b,S,P))}return s}}class va extends oN{constructor(e){if(super(),e.length!==4)throw new Os("Rectangle needs to have four values.");if(e[1]>e[3])throw new Os("Basic Y coordinates values can not be inverted.");for(let t of e)if(t<0||t>1)throw new Os("Basic coordinates must be on the interval [0, 1].");this._anchorIndex=void 0,this._rect=e.slice(0,4),this._inverted=this._rect[0]>this._rect[2]}get anchorIndex(){return this._anchorIndex}get inverted(){return this._inverted}get rect(){return this._rect}initializeAnchorIndexing(e){if(this._anchorIndex!==void 0)throw new Os("Anchor indexing is already initialized.");if(e<0||e>3)throw new Os(`Invalid anchor index: ${e}.`);this._anchorIndex=e===void 0?0:e}terminateAnchorIndexing(){this._anchorIndex=void 0}setOppositeVertex2d(e,t){if(this._anchorIndex===void 0)throw new Os("Anchor indexing needs to be initialized.");const i=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))],r=this._rect.slice(),o=this._anchorIndex===0?[r[0],r[3]]:this._anchorIndex===1?[r[0],r[1]]:this._anchorIndex===2?[r[2],r[1]]:[r[2],r[3]];if(ki(t.cameraType)){const c=this._anchorIndex<2?i[0]-r[2]:i[0]-r[0];!this._inverted&&this._anchorIndex<2&&i[0]<.25&&r[2]>.75&&c<-.5?(this._inverted=!0,this._anchorIndex=o[1]>i[1]?0:1):!this._inverted&&this._anchorIndex>=2&&i[0]<.25&&r[2]>.75&&c<-.5?(this._inverted=!0,this._anchorIndex=o[1]>i[1]?0:1):this._inverted&&this._anchorIndex>=2&&i[0]<.25&&r[0]>.75&&c<-.5?(this._inverted=!1,o[0]>i[0]?this._anchorIndex=o[1]>i[1]?3:2:this._anchorIndex=o[1]>i[1]?0:1):!this._inverted&&this._anchorIndex>=2&&i[0]>.75&&r[0]<.25&&c>.5?(this._inverted=!0,this._anchorIndex=o[1]>i[1]?3:2):!this._inverted&&this._anchorIndex<2&&i[0]>.75&&r[0]<.25&&c>.5?(this._inverted=!0,this._anchorIndex=o[1]>i[1]?3:2):this._inverted&&this._anchorIndex<2&&i[0]>.75&&r[2]<.25&&c>.5?(this._inverted=!1,o[0]>i[0]?this._anchorIndex=o[1]>i[1]?3:2:this._anchorIndex=o[1]>i[1]?0:1):this._inverted&&this._anchorIndex<2&&i[0]>r[0]?(this._inverted=!1,this._anchorIndex=o[1]>i[1]?0:1):this._inverted&&this._anchorIndex>=2&&i[0]<r[2]?(this._inverted=!1,this._anchorIndex=o[1]>i[1]?3:2):this._inverted?this._anchorIndex<2?this._anchorIndex=o[1]>i[1]?0:1:this._anchorIndex=o[1]>i[1]?3:2:o[0]<=i[0]&&o[1]>i[1]?this._anchorIndex=0:o[0]<=i[0]&&o[1]<=i[1]?this._anchorIndex=1:o[0]>i[0]&&o[1]<=i[1]?this._anchorIndex=2:this._anchorIndex=3;const s=[];this._anchorIndex===0?(s[0]=o[0],s[1]=i[1],s[2]=i[0],s[3]=o[1]):this._anchorIndex===1?(s[0]=o[0],s[1]=o[1],s[2]=i[0],s[3]=i[1]):this._anchorIndex===2?(s[0]=i[0],s[1]=o[1],s[2]=o[0],s[3]=i[1]):(s[0]=i[0],s[1]=i[1],s[2]=o[0],s[3]=o[1]),(!this._inverted&&s[0]>s[2]||this._inverted&&s[0]<s[2])&&(s[0]=r[0],s[2]=r[2]),s[1]>s[3]&&(s[1]=r[1],s[3]=r[3]),this._rect[0]=s[0],this._rect[1]=s[1],this._rect[2]=s[2],this._rect[3]=s[3]}else{o[0]<=i[0]&&o[1]>i[1]?this._anchorIndex=0:o[0]<=i[0]&&o[1]<=i[1]?this._anchorIndex=1:o[0]>i[0]&&o[1]<=i[1]?this._anchorIndex=2:this._anchorIndex=3;const c=[];this._anchorIndex===0?(c[0]=o[0],c[1]=i[1],c[2]=i[0],c[3]=o[1]):this._anchorIndex===1?(c[0]=o[0],c[1]=o[1],c[2]=i[0],c[3]=i[1]):this._anchorIndex===2?(c[0]=i[0],c[1]=o[1],c[2]=o[0],c[3]=i[1]):(c[0]=i[0],c[1]=i[1],c[2]=o[0],c[3]=o[1]),c[0]>c[2]&&(c[0]=r[0],c[2]=r[2]),c[1]>c[3]&&(c[1]=r[1],c[3]=r[3]),this._rect[0]=c[0],this._rect[1]=c[1],this._rect[2]=c[2],this._rect[3]=c[3]}this._notifyChanged$.next(this)}setVertex2d(e,t,i){let r=this._rect.slice(),o=[Math.max(0,Math.min(1,t[0])),Math.max(0,Math.min(1,t[1]))],c=[];if(e===0?(c[0]=o[0],c[1]=r[1],c[2]=r[2],c[3]=o[1]):e===1?(c[0]=o[0],c[1]=o[1],c[2]=r[2],c[3]=r[3]):e===2?(c[0]=r[0],c[1]=o[1],c[2]=o[0],c[3]=r[3]):e===3&&(c[0]=r[0],c[1]=r[1],c[2]=o[0],c[3]=o[1]),ki(i.cameraType)){let s=e<2&&o[0]>.75&&r[0]<.25||e>=2&&this._inverted&&o[0]>.75&&r[2]<.25,d=e<2&&this._inverted&&o[0]<.25&&r[0]>.75||e>=2&&o[0]<.25&&r[2]>.75;s||d?this._inverted=!this._inverted:(c[0]-r[0]<-.25&&(c[0]=r[0]),c[2]-r[2]>.25&&(c[2]=r[2])),(!this._inverted&&c[0]>c[2]||this._inverted&&c[0]<c[2])&&(c[0]=r[0],c[2]=r[2])}else c[0]>c[2]&&(c[0]=r[0],c[2]=r[2]);c[1]>c[3]&&(c[1]=r[1],c[3]=r[3]),this._rect[0]=c[0],this._rect[1]=c[1],this._rect[2]=c[2],this._rect[3]=c[3],this._notifyChanged$.next(this)}setCentroid2d(e,t){let i=this._rect.slice(),r=i[0],o=this._inverted?i[2]+1:i[2],c=i[1],s=i[3],d=r+(o-r)/2,p=c+(s-c)/2,g=0;if(ki(t.cameraType))g=this._inverted?e[0]+1-d:e[0]-d;else{let S=-r,P=1-o;g=Math.max(S,Math.min(P,e[0]-d))}let _=-c,x=1-s,b=Math.max(_,Math.min(x,e[1]-p));this._rect[0]=i[0]+g,this._rect[1]=i[1]+b,this._rect[2]=i[2]+g,this._rect[3]=i[3]+b,this._rect[0]<0?(this._rect[0]+=1,this._inverted=!this._inverted):this._rect[0]>1&&(this._rect[0]-=1,this._inverted=!this._inverted),this._rect[2]<0?(this._rect[2]+=1,this._inverted=!this._inverted):this._rect[2]>1&&(this._rect[2]-=1,this._inverted=!this._inverted),this._notifyChanged$.next(this)}getPoints3d(e){return this._getPoints2d().map(t=>e.unprojectBasic(t,200))}getVertex2d(e){return this._rectToVertices2d(this._rect)[e]}getNonAdjustedVertex2d(e){return this._rectToNonAdjustedVertices2d(this._rect)[e]}getVertex3d(e,t){return t.unprojectBasic(this._rectToVertices2d(this._rect)[e],200)}getVertices2d(){return this._rectToVertices2d(this._rect)}getVertices3d(e){return this._rectToVertices2d(this._rect).map(t=>e.unprojectBasic(t,200))}getCentroid2d(){const e=this._rect,t=e[0],i=this._inverted?e[2]+1:e[2],r=e[1],o=e[3],c=(t+i)/2,s=(r+o)/2;return[c,s]}getCentroid3d(e){const t=this.getCentroid2d();return e.unprojectBasic(t,200)}getPoleOfInaccessibility2d(){return this._getPoleOfInaccessibility2d(this._rectToVertices2d(this._rect))}getPoleOfInaccessibility3d(e){let t=this._getPoleOfInaccessibility2d(this._rectToVertices2d(this._rect));return e.unprojectBasic(t,200)}getTriangles3d(e){return ki(e.cameraType)?[]:this._triangulate(this._project(this._getPoints2d(),e),this.getPoints3d(e))}validate(e){let t=this._rect;return!(!this._inverted&&e[0]<t[0]||e[0]-t[2]>.25||e[1]<t[1])}_getPoints2d(){let e=this._rectToVertices2d(this._rect),t=e.length-1,i=10,r=[];for(let o=0;o<t;++o){let c=e[o][0],s=e[o][1],d=e[o+1][0],p=e[o+1][1],g=(d-c)/(i-1),_=(p-s)/(i-1);for(let x=0;x<i;++x){let b=[c+x*g,s+x*_];r.push(b)}}return r}_rectToVertices2d(e){return[[e[0],e[3]],[e[0],e[1]],[this._inverted?e[2]+1:e[2],e[1]],[this._inverted?e[2]+1:e[2],e[3]],[e[0],e[3]]]}_rectToNonAdjustedVertices2d(e){return[[e[0],e[3]],[e[0],e[1]],[e[2],e[1]],[e[2],e[3]],[e[0],e[3]]]}}class Jre extends YB{constructor(e,t,i,r){super(e,i,r),this._options={color:t.color==null?16777215:t.color,indicateCompleter:t.indicateCompleter==null?!0:t.indicateCompleter},this._rectGeometry=new va(this._geometry.getRect2d(i)),this._createGlObjects()}create(){this._geometry.points.length<3||(this._geometry.removePoint2d(this._geometry.points.length-1),this._created$.next(this))}dispose(){super.dispose(),this._disposeObjects()}getDOMObjects(e,t){const i={offsetHeight:t.height,offsetWidth:t.width},r=[],o=this._geometry.getPoints2d(),c=o.length;for(let s=0;s<c-1;s++){const d=s,[p,g]=o[s],_=this._viewportCoords.basicToCanvasSafe(p,g,i,this._transform,e);if(!_)continue;const x=C=>{C.stopPropagation(),this._aborted$.next(this)},b=C=>{C.stopPropagation(),this._geometry.removePoint2d(d)},S=this._canvasToTransform(_),P={onclick:s===0&&c<3?x:b,style:{transform:S}};r.push(Gt.h("div.mapillary-tag-interactor",P,[]));const E={style:{background:this._colorToBackground(this._options.color),transform:S}};r.push(Gt.h("div.mapillary-tag-vertex",E,[]))}if(c>2&&this._options.indicateCompleter===!0){const[s,d]=this._geometry.getCentroid2d(this._transform),p=this._viewportCoords.basicToCanvasSafe(s,d,i,this._transform,e);if(p){const g=P=>{P.stopPropagation(),this._geometry.removePoint2d(this._geometry.points.length-1),this._created$.next(this)},_=this._canvasToTransform(p),x={onclick:g,style:{transform:_}};r.push(Gt.h("div.mapillary-tag-completer.mapillary-tag-larger",x,[]));const b={style:{background:this._colorToBackground(this._options.color),transform:_}};r.push(Gt.h("div.mapillary-tag-vertex.mapillary-tag-larger",b,[]));const S={style:{transform:_}};r.push(Gt.h("div.mapillary-tag-dot",S,[]))}}return r}_onGeometryChanged(){this._disposeObjects(),this._rectGeometry=new va(this._geometry.getRect2d(this._transform)),this._createGlObjects()}_createGlObjects(){this._glObjects=[];const e=this._rectGeometry.getPoints3d(this._transform);this._outline=this._createOutine(e,this._options.color),this._glObjects.push(this._outline)}_disposeObjects(){this._disposeLine(this._outline),this._outline=null,this._glObjects=null}}class bh extends oN{constructor(e,t){super();let i=e.length;if(i<3)throw new Os("A polygon must have three or more positions.");if(e[0][0]!==e[i-1][0]||e[0][1]!==e[i-1][1])throw new Os("First and last positions must be equivalent.");this._polygon=[];for(let r of e){if(r[0]<0||r[0]>1||r[1]<0||r[1]>1)throw new Os("Basic coordinates of polygon must be on the interval [0, 1].");this._polygon.push(r.slice())}if(this._holes=[],t!=null)for(let r=0;r<t.length;r++){let o=t[r],c=o.length;if(c<3)throw new Os("A polygon hole must have three or more positions.");if(o[0][0]!==o[c-1][0]||o[0][1]!==o[c-1][1])throw new Os("First and last positions of hole must be equivalent.");this._holes.push([]);for(let s of o){if(s[0]<0||s[0]>1||s[1]<0||s[1]>1)throw new Os("Basic coordinates of hole must be on the interval [0, 1].");this._holes[r].push(s.slice())}}}get polygon(){return this._polygon}get holes(){return this._holes}addVertex2d(e){let t=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))];this._polygon.splice(this._polygon.length-1,0,t),this._notifyChanged$.next(this)}getVertex2d(e){return this._polygon[e].slice()}removeVertex2d(e){if(e<0||e>=this._polygon.length||this._polygon.length<4)throw new Os("Index for removed vertex must be valid.");if(e>0&&e<this._polygon.length-1)this._polygon.splice(e,1);else{this._polygon.splice(0,1),this._polygon.pop();let t=this._polygon[0].slice();this._polygon.push(t)}this._notifyChanged$.next(this)}setVertex2d(e,t,i){let r=[Math.max(0,Math.min(1,t[0])),Math.max(0,Math.min(1,t[1]))];e===0||e===this._polygon.length-1?(this._polygon[0]=r.slice(),this._polygon[this._polygon.length-1]=r.slice()):this._polygon[e]=r.slice(),this._notifyChanged$.next(this)}setCentroid2d(e,t){let i=this._polygon.map(L=>L[0]),r=this._polygon.map(L=>L[1]),o=Math.min.apply(Math,i),c=Math.max.apply(Math,i),s=Math.min.apply(Math,r),d=Math.max.apply(Math,r),p=this.getCentroid2d(),g=-o,_=1-c,x=-s,b=1-d,S=Math.max(g,Math.min(_,e[0]-p[0])),P=Math.max(x,Math.min(b,e[1]-p[1]));for(let L of this._polygon)L[0]+=S,L[1]+=P;this._notifyChanged$.next(this)}getPoints3d(e){return this._getPoints3d(this._subsample(this._polygon),e)}getVertex3d(e,t){return t.unprojectBasic(this._polygon[e],200)}getVertices2d(){return this._polygon.slice()}getVertices3d(e){return this._getPoints3d(this._polygon,e)}getHolePoints3d(e){return this._holes.map(t=>this._getPoints3d(this._subsample(t),e))}getHoleVertices3d(e){return this._holes.map(t=>this._getPoints3d(t,e))}getCentroid2d(){let e=this._polygon,t=0,i=0,r=0;for(let o=0;o<e.length-1;o++){let c=e[o][0],s=e[o][1],d=e[o+1][0],p=e[o+1][1],g=c*p-d*s;t+=g,i+=(c+d)*g,r+=(s+p)*g}return t/=2,i/=6*t,r/=6*t,[i,r]}getCentroid3d(e){let t=this.getCentroid2d();return e.unprojectBasic(t,200)}get3dDomainTriangles3d(e){return this._triangulate(this._project(this._polygon,e),this.getVertices3d(e),this._holes.map(t=>this._project(t,e)),this.getHoleVertices3d(e))}getTriangles3d(e){if(ki(e.cameraType))return this._triangulateSpherical(this._polygon.slice(),this.holes.slice(),e);const t=this._project(this._subsample(this._polygon),e),i=this.getPoints3d(e),r=this._holes.map(c=>this._project(this._subsample(c),e)),o=this.getHolePoints3d(e);return this._triangulate(t,i,r,o)}getPoleOfInaccessibility2d(){return this._getPoleOfInaccessibility2d(this._polygon.slice())}getPoleOfInaccessibility3d(e){let t=this._getPoleOfInaccessibility2d(this._polygon.slice());return e.unprojectBasic(t,200)}_getPoints3d(e,t){return e.map(i=>t.unprojectBasic(i,200))}}class D3 extends YB{constructor(e,t,i,r){super(e,i,r),this._options={color:t.color==null?16777215:t.color},this._createGlObjects()}create(){if(this._geometry instanceof va)this._created$.next(this);else if(this._geometry instanceof bh){const e=this._geometry;e.removeVertex2d(e.polygon.length-2),this._created$.next(this)}}dispose(){super.dispose(),this._disposeLine(this._outline),this._disposeObjects()}getDOMObjects(e,t){const i=[],r={offsetHeight:t.height,offsetWidth:t.width},o=c=>{c.stopPropagation(),this._aborted$.next(this)};if(this._geometry instanceof va){const c=this._geometry.anchorIndex,s=c===void 0?1:c,[d,p]=this._geometry.getVertex2d(s),g=this._viewportCoords.basicToCanvasSafe(d,p,r,this._transform,e);if(g!=null){const _=this._colorToBackground(this._options.color),x=this._canvasToTransform(g),b={style:{background:_,transform:x}},S={onclick:o,style:{transform:x}};i.push(Gt.h("div.mapillary-tag-interactor",S,[])),i.push(Gt.h("div.mapillary-tag-vertex",b,[]))}}else if(this._geometry instanceof bh){const c=this._geometry,[s,d]=c.getVertex2d(0),p=this._viewportCoords.basicToCanvasSafe(s,d,r,this._transform,e);if(p!=null){const _=c.polygon.length>4?P=>{P.stopPropagation(),c.removeVertex2d(c.polygon.length-2),this._created$.next(this)}:o,x=this._canvasToTransform(p),b={onclick:_,style:{transform:x}},S=c.polygon.length>4?"mapillary-tag-completer":"mapillary-tag-interactor";i.push(Gt.h("div."+S,b,[]))}if(c.polygon.length>3){const[_,x]=c.getVertex2d(c.polygon.length-3),b=this._viewportCoords.basicToCanvasSafe(_,x,r,this._transform,e);if(b!=null){const S=E=>{E.stopPropagation(),c.removeVertex2d(c.polygon.length-3)},P=this._canvasToTransform(b),L={onclick:S,style:{transform:P}};i.push(Gt.h("div.mapillary-tag-interactor",L,[]))}}const g=c.polygon.slice();g.splice(-2,2);for(const _ of g){const x=this._viewportCoords.basicToCanvasSafe(_[0],_[1],r,this._transform,e);if(x!=null){const b=this._colorToBackground(this._options.color),S=this._canvasToTransform(x),P={style:{background:b,transform:S}};i.push(Gt.h("div.mapillary-tag-vertex",P,[]))}}}return i}addPoint(e){if(this._geometry instanceof va){if(!this._geometry.validate(e))return;this._created$.next(this)}else this._geometry instanceof bh&&this._geometry.addVertex2d(e)}_onGeometryChanged(){this._disposeLine(this._outline),this._disposeObjects(),this._createGlObjects()}_disposeObjects(){this._outline=null,this._glObjects=[]}_createGlObjects(){const e=this._geometry instanceof va?this._geometry.getPoints3d(this._transform):this._geometry.getVertices3d(this._transform);this._outline=this._createOutine(e,this._options.color),this._glObjects=[this._outline]}}class Qre{constructor(e,t){this._component=e,this._navigator=t,this._tagOperation$=new ri,this._createPoints$=new ri,this._createPolygon$=new ri,this._createRect$=new ri,this._delete$=new ri,this._tag$=this._tagOperation$.pipe(Vr((i,r)=>r(i),null),dn()),this._replayedTag$=this._tag$.pipe(Pi(1),gi()),this._replayedTag$.subscribe(),this._createPoints$.pipe(Ui(this._component.configuration$,this._navigator.stateService.currentTransform$),it(([i,r,o])=>()=>{const c=new ire([[i[0],i[1]],[i[0],i[1]]]);return new Jre(c,{color:r.createColor,indicateCompleter:r.indicatePointsCompleter},o)})).subscribe(this._tagOperation$),this._createRect$.pipe(Ui(this._component.configuration$,this._navigator.stateService.currentTransform$),it(([i,r,o])=>()=>{const c=new va([i[0],i[1],i[0],i[1]]);return new D3(c,{color:r.createColor},o)})).subscribe(this._tagOperation$),this._createPolygon$.pipe(Ui(this._component.configuration$,this._navigator.stateService.currentTransform$),it(([i,r,o])=>()=>{const c=new bh([[i[0],i[1]],[i[0],i[1]],[i[0],i[1]]]);return new D3(c,{color:r.createColor},o)})).subscribe(this._tagOperation$),this._delete$.pipe(it(()=>()=>null)).subscribe(this._tagOperation$)}get createRect$(){return this._createRect$}get createPolygon$(){return this._createPolygon$}get createPoints$(){return this._createPoints$}get delete$(){return this._delete$}get tag$(){return this._tag$}get replayedTag$(){return this._replayedTag$}}class ese{render(e,t,i,r,o){let c=[];for(const s of e)c=c.concat(s.getDOMObjects(i,r,o));return t!=null&&(c=c.concat(t.getDOMObjects(r,o))),Gt.h("div.mapillary-tag-container",{},c)}clear(){return Gt.h("div",{},[])}}class tse{constructor(e,t){this._createTag=null,this._needsRender=!1,this._raycaster=t||new Pw,this._scene=e||new vh,this._objectTags={},this._retrievableObjects=[],this._tags={}}get needsRender(){return this._needsRender}add(e){for(let t of e)t.tag.id in this._tags&&this._remove(t.tag.id),this._add(t);this._needsRender=!0}addCreateTag(e){for(const t of e.glObjects)this._scene.add(t);this._createTag={tag:e,objects:e.glObjects},this._needsRender=!0}clear(){for(const e of Object.keys(this._tags))this._remove(e);this._needsRender=!1}get(e){return this.has(e)?this._tags[e].tag:void 0}has(e){return e in this._tags}hasCreateTag(){return this._createTag!=null}intersectObjects([e,t],i){this._raycaster.setFromCamera(new li(e,t),i);const r=this._raycaster.intersectObjects(this._retrievableObjects),o=[];for(const c of r)c.object.uuid in this._objectTags&&o.push(this._objectTags[c.object.uuid]);return o}remove(e){for(const t of e)this._remove(t);this._needsRender=!0}removeAll(){for(const e of Object.keys(this._tags))this._remove(e);this._needsRender=!0}removeCreateTag(){if(this._createTag!=null){for(const e of this._createTag.objects)this._scene.remove(e);this._createTag.tag.dispose(),this._createTag=null,this._needsRender=!0}}render(e,t){t.render(this._scene,e),this._needsRender=!1}update(){this._needsRender=!0}updateCreateTagObjects(e){if(this._createTag.tag!==e)throw new Error("Create tags do not have the same reference.");for(let t of this._createTag.objects)this._scene.remove(t);for(const t of e.glObjects)this._scene.add(t);this._createTag.objects=e.glObjects,this._needsRender=!0}updateObjects(e){const t=e.tag.id;if(this._tags[t].tag!==e)throw new Error("Tags do not have the same reference.");const i=this._tags[t];this._removeObjects(i),delete this._tags[t],this._add(e),this._needsRender=!0}_add(e){const t=e.tag.id,i={tag:e,objects:[],retrievableObjects:[]};this._tags[t]=i;for(const r of e.getGLObjects())i.objects.push(r),this._scene.add(r);for(const r of e.getRetrievableObjects())i.retrievableObjects.push(r),this._retrievableObjects.push(r),this._objectTags[r.uuid]=e.tag.id}_remove(e){const t=this._tags[e];this._removeObjects(t),t.tag.dispose(),delete this._tags[e]}_removeObjects(e){for(const t of e.objects)this._scene.remove(t);for(const t of e.retrievableObjects){const i=this._retrievableObjects.indexOf(t);i!==-1&&this._retrievableObjects.splice(i,1)}}}var xg;(function(n){n[n.Default=0]="Default",n[n.CreatePoint=1]="CreatePoint",n[n.CreatePoints=2]="CreatePoints",n[n.CreatePolygon=3]="CreatePolygon",n[n.CreateRect=4]="CreateRect",n[n.CreateRectDrag=5]="CreateRectDrag"})(xg||(xg={}));var nl;(function(n){n[n.None=0]="None",n[n.Centroid=1]="Centroid",n[n.Vertex=2]="Vertex"})(nl||(nl={}));class aN{constructor(e,t,i){this._tag=e,this._transform=t,this._viewportCoords=i||new zo,this._glObjectsChanged$=new ri,this._interact$=new ri}get glObjectsChanged$(){return this._glObjectsChanged$}get interact$(){return this._interact$}get tag(){return this._tag}}class lN extends aN{constructor(e,t){super(e,t),this._geometryChangedSubscription=this._tag.geometry.changed$.subscribe(()=>{this._onGeometryChanged()}),this._changedSubscription=this._tag.changed$.subscribe(()=>{this._onTagChanged()&&this._glObjectsChanged$.next(this)})}dispose(){this._changedSubscription.unsubscribe(),this._geometryChangedSubscription.unsubscribe()}_colorToCss(e){return"#"+("000000"+e.toString(16)).substr(-6)}_createFill(){let e=this._getTriangles(),t=new Float32Array(e),i=new Vn;i.setAttribute("position",new Mn(t,3)),i.computeBoundingSphere();let r=new f0({side:Ko,transparent:!0});return this._updateFillMaterial(r),new kr(i,r)}_createLine(e){let t=this._getLinePositions(e),i=new Vn;i.setAttribute("position",new Mn(t,3)),i.computeBoundingSphere();let r=new Ph;this._updateLineBasicMaterial(r);const o=new Ep(i,r);return o.renderOrder=1,o}_createOutline(){return this._createLine(this._getPoints3d())}_disposeFill(){this._fill!=null&&(this._fill.geometry.dispose(),this._fill.material.dispose(),this._fill=null)}_disposeOutline(){this._outline!=null&&(this._outline.geometry.dispose(),this._outline.material.dispose(),this._outline=null)}_getLinePositions(e){let t=e.length,i=new Float32Array(t*3);for(let r=0;r<t;++r){let o=3*r,c=e[r];i[o+0]=c[0],i[o+1]=c[1],i[o+2]=c[2]}return i}_interact(e,t,i){return r=>{let o=r.offsetX-r.target.offsetWidth/2,c=r.offsetY-r.target.offsetHeight/2;this._interact$.next({cursor:t,offsetX:o,offsetY:c,operation:e,tag:this._tag,vertexIndex:i})}}_updateFillGeometry(){let e=this._getTriangles(),t=new Float32Array(e),i=this._fill.geometry,r=i.getAttribute("position");r.array.length===t.length?(r.set(t),r.needsUpdate=!0):(i.deleteAttribute("position"),i.setAttribute("position",new Mn(t,3))),i.computeBoundingSphere()}_updateLine(e,t){let i=this._getLinePositions(t),r=e.geometry,o=r.getAttribute("position");o.set(i),o.needsUpdate=!0,r.computeBoundingSphere()}_updateOulineGeometry(){this._updateLine(this._outline,this._getPoints3d())}}class ise extends lN{constructor(e,t){super(e,t),this._rectGeometry=new va(this._tag.geometry.getRect2d(t)),this._fill=ki(t.cameraType)?null:this._createFill(),this._outline=this._tag.lineWidth>=1?this._createOutline():null}dispose(){super.dispose(),this._disposeFill(),this._disposeOutline()}getDOMObjects(e,t,i){const r=[],o={offsetHeight:i.height,offsetWidth:i.width};if(!this._tag.editable)return r;const c=this._colorToCss(this._tag.lineColor),s=this._tag.geometry.getPoints2d();for(let d=0;d<s.length;d++){const[p,g]=s[d],_=this._viewportCoords.basicToCanvasSafe(p,g,o,this._transform,t);if(_==null)continue;const x="crosshair",b=this._interact(nl.Vertex,x,d),S=Math.round(_[0]),P=Math.round(_[1]),L=`translate(-50%, -50%) translate(${S}px,${P}px)`,E={onpointerdown:b,style:{background:c,transform:L,cursor:x}};if(r.push(Gt.h("div.mapillary-tag-resizer",E,[])),!this._tag.indicateVertices)continue;const C={style:{background:c,transform:L}};r.push(Gt.h("div.mapillary-tag-vertex",C,[]))}return r}getGLObjects(){const e=[];return this._fill!=null&&e.push(this._fill),this._outline!=null&&e.push(this._outline),e}getRetrievableObjects(){return this._fill!=null?[this._fill]:[]}_onGeometryChanged(){this._rectGeometry=new va(this._tag.geometry.getRect2d(this._transform)),this._fill!=null&&this._updateFillGeometry(),this._outline!=null&&this._updateOulineGeometry()}_onTagChanged(){let e=!1;return this._fill!=null&&this._updateFillMaterial(this._fill.material),this._outline==null?this._tag.lineWidth>=1&&(this._outline=this._createOutline(),e=!0):this._updateOutlineMaterial(),e}_getPoints3d(){return this._rectGeometry.getPoints3d(this._transform)}_getTriangles(){return this._rectGeometry.getTriangles3d(this._transform)}_updateFillMaterial(e){e.color=new Bi(this._tag.fillColor),e.opacity=this._tag.fillOpacity,e.needsUpdate=!0}_updateLineBasicMaterial(e){e.color=new Bi(this._tag.lineColor),e.linewidth=Math.max(this._tag.lineWidth,1),e.visible=this._tag.lineWidth>=1&&this._tag.lineOpacity>0,e.opacity=this._tag.lineOpacity,e.transparent=this._tag.lineOpacity<1,e.needsUpdate=!0}_updateOutlineMaterial(){let e=this._outline.material;this._updateLineBasicMaterial(e)}}class hE extends S1{constructor(e,t){super(),this._id=e,this._geometry=t,this._notifyChanged$=new ri,this._notifyChanged$.subscribe(i=>{const o={target:this,type:"tag"};this.fire("tag",o)}),this._geometry.changed$.subscribe(i=>{const r="geometry",o={target:this,type:r};this.fire(r,o)})}get id(){return this._id}get geometry(){return this._geometry}get changed$(){return this._notifyChanged$}get geometryChanged$(){return this._geometry.changed$.pipe(it(()=>this),dn())}fire(e,t){super.fire(e,t)}off(e,t){super.off(e,t)}on(e,t){super.on(e,t)}}class F3 extends hE{constructor(e,t,i){super(e,t),i=i||{},this._editable=i.editable==null?!1:i.editable,this._fillColor=i.fillColor==null?16777215:i.fillColor,this._fillOpacity=i.fillOpacity==null?0:i.fillOpacity,this._indicateVertices=i.indicateVertices==null?!0:i.indicateVertices,this._lineColor=i.lineColor==null?16777215:i.lineColor,this._lineOpacity=i.lineOpacity==null?1:i.lineOpacity,this._lineWidth=i.lineWidth==null?1:i.lineWidth}get editable(){return this._editable}set editable(e){this._editable=e,this._notifyChanged$.next(this)}get fillColor(){return this._fillColor}set fillColor(e){this._fillColor=e,this._notifyChanged$.next(this)}get fillOpacity(){return this._fillOpacity}set fillOpacity(e){this._fillOpacity=e,this._notifyChanged$.next(this)}get geometry(){return this._geometry}get indicateVertices(){return this._indicateVertices}set indicateVertices(e){this._indicateVertices=e,this._notifyChanged$.next(this)}get lineColor(){return this._lineColor}set lineColor(e){this._lineColor=e,this._notifyChanged$.next(this)}get lineOpacity(){return this._lineOpacity}set lineOpacity(e){this._lineOpacity=e,this._notifyChanged$.next(this)}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=e,this._notifyChanged$.next(this)}setOptions(e){this._editable=e.editable==null?this._editable:e.editable,this._indicateVertices=e.indicateVertices==null?this._indicateVertices:e.indicateVertices,this._lineColor=e.lineColor==null?this._lineColor:e.lineColor,this._lineWidth=e.lineWidth==null?this._lineWidth:e.lineWidth,this._fillColor=e.fillColor==null?this._fillColor:e.fillColor,this._fillOpacity=e.fillOpacity==null?this._fillOpacity:e.fillOpacity,this._notifyChanged$.next(this)}}var Qg;(function(n){n[n.TwoDimensional=0]="TwoDimensional",n[n.ThreeDimensional=1]="ThreeDimensional"})(Qg||(Qg={}));class nse extends lN{constructor(e,t){super(e,t),this._fill=ki(t.cameraType)?e.domain===Qg.TwoDimensional&&e.geometry instanceof bh?this._createFill():null:this._createFill(),this._holes=this._tag.lineWidth>=1?this._createHoles():[],this._outline=this._tag.lineWidth>=1?this._createOutline():null}dispose(){super.dispose(),this._disposeFill(),this._disposeHoles(),this._disposeOutline()}getDOMObjects(e,t,i){const r=[],o=this._tag.geometry instanceof va,c=!ki(this._transform.cameraType),s={offsetHeight:i.height,offsetWidth:i.width};if(this._tag.icon!=null&&(o||c)){const[g,_]=this._tag.geometry instanceof va?this._tag.geometry.getVertex2d(this._tag.iconIndex):this._tag.geometry.getPoleOfInaccessibility2d(),x=this._viewportCoords.basicToCanvasSafe(g,_,s,this._transform,t);if(x!=null){const b=()=>{this._interact$.next({offsetX:0,offsetY:0,operation:nl.None,tag:this._tag})};if(e.loaded){const S=e.getDOMSprite(this._tag.icon,this._tag.iconFloat),P=Math.round(x[0]),L=Math.round(x[1]),E=`translate(${P}px,${L}px)`,D={onclick:O=>{O.stopPropagation(),this._tag.click$.next(this._tag)},onpointerdown:b,style:{transform:E}};r.push(Gt.h("div.mapillary-tag-symbol",D,[S]))}}}else if(this._tag.text!=null&&(o||c)){const[g,_]=this._tag.geometry instanceof va?this._tag.geometry.getVertex2d(3):this._tag.geometry.getPoleOfInaccessibility2d(),x=this._viewportCoords.basicToCanvasSafe(g,_,s,this._transform,t);if(x!=null){const b=Math.round(x[0]),S=Math.round(x[1]),P=this._tag.geometry instanceof va?`translate(${b}px,${S}px)`:`translate(-50%, -50%) translate(${b}px,${S}px)`,E={onpointerdown:()=>{this._interact$.next({offsetX:0,offsetY:0,operation:nl.None,tag:this._tag})},style:{color:this._colorToCss(this._tag.textColor),transform:P},textContent:this._tag.text};r.push(Gt.h("span.mapillary-tag-symbol",E,[]))}}if(!this._tag.editable)return r;const d=this._colorToCss(this._tag.lineColor);if(this._tag.geometry instanceof va){const[g,_]=this._tag.geometry.getCentroid2d(),x=this._viewportCoords.basicToCanvasSafe(g,_,s,this._transform,t);if(x!=null){const b=this._interact(nl.Centroid,"move"),S=Math.round(x[0]),P=Math.round(x[1]),L=`translate(-50%, -50%) translate(${S}px,${P}px)`,E={onpointerdown:b,style:{background:d,transform:L}};r.push(Gt.h("div.mapillary-tag-mover",E,[]))}}const p=this._tag.geometry.getVertices2d();for(let g=0;g<p.length-1;g++){if(o&&(this._tag.icon!=null&&g===this._tag.iconIndex||this._tag.icon==null&&this._tag.text!=null&&g===3))continue;const[_,x]=p[g],b=this._viewportCoords.basicToCanvasSafe(_,x,s,this._transform,t);if(b==null)continue;const S=o?g%2===0?"nesw-resize":"nwse-resize":"crosshair",P=this._interact(nl.Vertex,S,g),L=Math.round(b[0]),E=Math.round(b[1]),C=`translate(-50%, -50%) translate(${L}px,${E}px)`,D={onpointerdown:P,style:{background:d,transform:C,cursor:S}};if(r.push(Gt.h("div.mapillary-tag-resizer",D,[])),!this._tag.indicateVertices)continue;const O={style:{background:d,transform:C}};r.push(Gt.h("div.mapillary-tag-vertex",O,[]))}return r}getGLObjects(){const e=[];this._fill!=null&&e.push(this._fill);for(const t of this._holes)e.push(t);return this._outline!=null&&e.push(this._outline),e}getRetrievableObjects(){return this._fill!=null?[this._fill]:[]}_onGeometryChanged(){this._fill!=null&&this._updateFillGeometry(),this._holes.length>0&&this._updateHoleGeometries(),this._outline!=null&&this._updateOulineGeometry()}_onTagChanged(){let e=!1;return this._fill!=null&&this._updateFillMaterial(this._fill.material),this._outline==null?this._tag.lineWidth>=1&&(this._holes=this._createHoles(),this._outline=this._createOutline(),e=!0):(this._updateHoleMaterials(),this._updateOutlineMaterial()),e}_getPoints3d(){return this._in3dDomain()?this._tag.geometry.getVertices3d(this._transform):this._tag.geometry.getPoints3d(this._transform)}_getTriangles(){return this._in3dDomain()?this._tag.geometry.get3dDomainTriangles3d(this._transform):this._tag.geometry.getTriangles3d(this._transform)}_updateFillMaterial(e){e.color=new Bi(this._tag.fillColor),e.opacity=this._tag.fillOpacity,e.needsUpdate=!0}_updateLineBasicMaterial(e){e.color=new Bi(this._tag.lineColor),e.linewidth=Math.max(this._tag.lineWidth,1),e.visible=this._tag.lineWidth>=1&&this._tag.lineOpacity>0,e.opacity=this._tag.lineOpacity,e.transparent=this._tag.lineOpacity<1,e.needsUpdate=!0}_createHoles(){let e=[];if(this._tag.geometry instanceof bh){let t=this._getHoles3d();for(let i of t){let r=this._createLine(i);e.push(r)}}return e}_disposeHoles(){for(let e of this._holes)e.geometry.dispose(),e.material.dispose();this._holes=[]}_getHoles3d(){const e=this._tag.geometry;return this._in3dDomain()?e.getHoleVertices3d(this._transform):e.getHolePoints3d(this._transform)}_in3dDomain(){return this._tag.geometry instanceof bh&&this._tag.domain===Qg.ThreeDimensional}_updateHoleGeometries(){let e=this._getHoles3d();if(e.length!==this._holes.length)throw new Error("Changing the number of holes is not supported.");for(let t=0;t<this._holes.length;t++){let i=e[t],r=this._holes[t];this._updateLine(r,i)}}_updateHoleMaterials(){for(const e of this._holes)this._updateLineBasicMaterial(e.material)}_updateOutlineMaterial(){this._updateLineBasicMaterial(this._outline.material)}}var as;(function(n){n[n.Bottom=0]="Bottom",n[n.BottomLeft=1]="BottomLeft",n[n.BottomRight=2]="BottomRight",n[n.Center=3]="Center",n[n.Left=4]="Left",n[n.Right=5]="Right",n[n.Top=6]="Top",n[n.TopLeft=7]="TopLeft",n[n.TopRight=8]="TopRight"})(as||(as={}));class O3 extends hE{constructor(e,t,i){super(e,t),i=i||{};const r=i.domain!=null&&t instanceof bh?i.domain:Qg.TwoDimensional,o=this._twoDimensionalPolygon(r,t);this._domain=r,this._editable=i.editable==null||o?!1:i.editable,this._fillColor=i.fillColor==null?16777215:i.fillColor,this._fillOpacity=i.fillOpacity==null?0:i.fillOpacity,this._icon=i.icon===void 0?null:i.icon,this._iconFloat=i.iconFloat==null?as.Center:i.iconFloat,this._iconIndex=i.iconIndex==null?3:i.iconIndex,this._indicateVertices=i.indicateVertices==null?!0:i.indicateVertices,this._lineColor=i.lineColor==null?16777215:i.lineColor,this._lineOpacity=i.lineOpacity==null?1:i.lineOpacity,this._lineWidth=i.lineWidth==null?1:i.lineWidth,this._text=i.text===void 0?null:i.text,this._textColor=i.textColor==null?16777215:i.textColor,this._click$=new ri,this._click$.subscribe(()=>{const c="click",s={target:this,type:c};this.fire(c,s)})}get click$(){return this._click$}get domain(){return this._domain}get editable(){return this._editable}set editable(e){this._twoDimensionalPolygon(this._domain,this._geometry)||(this._editable=e,this._notifyChanged$.next(this))}get fillColor(){return this._fillColor}set fillColor(e){this._fillColor=e,this._notifyChanged$.next(this)}get fillOpacity(){return this._fillOpacity}set fillOpacity(e){this._fillOpacity=e,this._notifyChanged$.next(this)}get geometry(){return this._geometry}get icon(){return this._icon}set icon(e){this._icon=e,this._notifyChanged$.next(this)}get iconFloat(){return this._iconFloat}set iconFloat(e){this._iconFloat=e,this._notifyChanged$.next(this)}get iconIndex(){return this._iconIndex}set iconIndex(e){this._iconIndex=e,this._notifyChanged$.next(this)}get indicateVertices(){return this._indicateVertices}set indicateVertices(e){this._indicateVertices=e,this._notifyChanged$.next(this)}get lineColor(){return this._lineColor}set lineColor(e){this._lineColor=e,this._notifyChanged$.next(this)}get lineOpacity(){return this._lineOpacity}set lineOpacity(e){this._lineOpacity=e,this._notifyChanged$.next(this)}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=e,this._notifyChanged$.next(this)}get text(){return this._text}set text(e){this._text=e,this._notifyChanged$.next(this)}get textColor(){return this._textColor}set textColor(e){this._textColor=e,this._notifyChanged$.next(this)}fire(e,t){super.fire(e,t)}off(e,t){super.off(e,t)}on(e,t){super.on(e,t)}setOptions(e){const t=this._twoDimensionalPolygon(this._domain,this._geometry);this._editable=t||e.editable==null?this._editable:e.editable,this._icon=e.icon===void 0?this._icon:e.icon,this._iconFloat=e.iconFloat==null?this._iconFloat:e.iconFloat,this._iconIndex=e.iconIndex==null?this._iconIndex:e.iconIndex,this._indicateVertices=e.indicateVertices==null?this._indicateVertices:e.indicateVertices,this._lineColor=e.lineColor==null?this._lineColor:e.lineColor,this._lineWidth=e.lineWidth==null?this._lineWidth:e.lineWidth,this._fillColor=e.fillColor==null?this._fillColor:e.fillColor,this._fillOpacity=e.fillOpacity==null?this._fillOpacity:e.fillOpacity,this._text=e.text===void 0?this._text:e.text,this._textColor=e.textColor==null?this._textColor:e.textColor,this._notifyChanged$.next(this)}_twoDimensionalPolygon(e,t){return e!==Qg.ThreeDimensional&&t instanceof bh}}class rse extends aN{dispose(){}getDOMObjects(e,t,i){const r=this._tag,o={offsetHeight:i.height,offsetWidth:i.width},c=[],[s,d]=r.geometry.getCentroid2d(),p=this._viewportCoords.basicToCanvasSafe(s,d,o,this._transform,t);if(p!=null){const g=E=>{this._interact$.next({offsetX:0,offsetY:0,operation:nl.None,tag:r})},_=Math.round(p[0]),x=Math.round(p[1]);if(r.icon!=null){if(e.loaded){const E=e.getDOMSprite(r.icon,as.Bottom),C=`translate(${_}px,${x+8}px)`,D={onpointerdown:g,style:{pointerEvents:"all",transform:C}};c.push(Gt.h("div",D,[E]))}}else if(r.text!=null){const E=`translate(-50%,0%) translate(${_}px,${x+8}px)`,C={onpointerdown:g,style:{color:this._colorToCss(r.textColor),transform:E},textContent:r.text};c.push(Gt.h("span.mapillary-tag-symbol",C,[]))}const b=this._interact(nl.Centroid,r,"move"),S=this._colorToCss(r.color),P=`translate(-50%,-50%) translate(${_}px,${x}px)`;if(r.editable){let E={onpointerdown:b,style:{background:S,transform:P}};c.push(Gt.h("div.mapillary-tag-spot-interactor",E,[]))}const L={style:{background:S,transform:P}};c.push(Gt.h("div.mapillary-tag-vertex",L,[]))}return c}getGLObjects(){return[]}getRetrievableObjects(){return[]}_colorToCss(e){return"#"+("000000"+e.toString(16)).substr(-6)}_interact(e,t,i,r){return o=>{const c=o.offsetX-o.target.offsetWidth/2,s=o.offsetY-o.target.offsetHeight/2;this._interact$.next({cursor:i,offsetX:c,offsetY:s,operation:e,tag:t,vertexIndex:r})}}}class z3 extends hE{constructor(e,t,i){super(e,t),i=i||{},this._color=i.color==null?16777215:i.color,this._editable=i.editable==null?!1:i.editable,this._icon=i.icon===void 0?null:i.icon,this._text=i.text===void 0?null:i.text,this._textColor=i.textColor==null?16777215:i.textColor}get color(){return this._color}set color(e){this._color=e,this._notifyChanged$.next(this)}get editable(){return this._editable}set editable(e){this._editable=e,this._notifyChanged$.next(this)}get icon(){return this._icon}set icon(e){this._icon=e,this._notifyChanged$.next(this)}get text(){return this._text}set text(e){this._text=e,this._notifyChanged$.next(this)}get textColor(){return this._textColor}set textColor(e){this._textColor=e,this._notifyChanged$.next(this)}setOptions(e){this._color=e.color==null?this._color:e.color,this._editable=e.editable==null?this._editable:e.editable,this._icon=e.icon===void 0?this._icon:e.icon,this._text=e.text===void 0?this._text:e.text,this._textColor=e.textColor==null?this._textColor:e.textColor,this._notifyChanged$.next(this)}}class sse{constructor(){this._active=!1,this._hash={},this._hashDeactivated={},this._notifyChanged$=new ri}get active(){return this._active}get changed$(){return this._notifyChanged$}activate(e){if(!this._active){for(const t in this._hashDeactivated){if(!this._hashDeactivated.hasOwnProperty(t))continue;const i=this._hashDeactivated[t];this._add(i,e)}this._hashDeactivated={},this._active=!0,this._notifyChanged$.next(this)}}deactivate(){if(this._active){for(const e in this._hash)this._hash.hasOwnProperty(e)&&(this._hashDeactivated[e]=this._hash[e].tag);this._hash={},this._active=!1}}add(e,t){this._assertActivationState(!0);for(const i of e)this._add(i,t);this._notifyChanged$.next(this)}addDeactivated(e){this._assertActivationState(!1);for(const t of e){if(!(t instanceof O3||t instanceof z3||t instanceof F3))throw new Error("Tag type not supported");this._hashDeactivated[t.id]=t}}get(e){return this.has(e)?this._hash[e]:void 0}getAll(){const e=this._hash;return Object.keys(e).map(t=>e[t])}getAllDeactivated(){const e=this._hashDeactivated;return Object.keys(e).map(t=>e[t])}getDeactivated(e){return this.hasDeactivated(e)?this._hashDeactivated[e]:void 0}has(e){return e in this._hash}hasDeactivated(e){return e in this._hashDeactivated}remove(e){this._assertActivationState(!0);const t=this._hash;for(const i of e)i in t&&delete t[i];this._notifyChanged$.next(this)}removeAll(){this._assertActivationState(!0),this._hash={},this._notifyChanged$.next(this)}removeAllDeactivated(){this._assertActivationState(!1),this._hashDeactivated={}}removeDeactivated(e){this._assertActivationState(!1);const t=this._hashDeactivated;for(const i of e)i in t&&delete t[i]}_add(e,t){if(e instanceof O3)this._hash[e.id]=new nse(e,t);else if(e instanceof z3)this._hash[e.id]=new rse(e,t);else if(e instanceof F3)this._hash[e.id]=new ise(e,t);else throw new Error("Tag type not supported")}_assertActivationState(e){if(e!==this._active)throw new Error("Tag set not in correct state for operation.")}}class ose extends oE{constructor(e){super();let t=e[0],i=e[1];if(t<0||t>1||i<0||i>1)throw new Os("Basic coordinates must be on the interval [0, 1].");this._point=e.slice()}get point(){return this._point}getCentroid2d(){return this._point.slice()}getCentroid3d(e){return e.unprojectBasic(this._point,200)}setCentroid2d(e,t){let i=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))];this._point[0]=i[0],this._point[1]=i[1],this._notifyChanged$.next(this)}}class cN extends wu{constructor(e,t,i,r){super(e,t,i),this._name=`${this._component.name}-${this._getNameExtension()}`,this._viewportCoords=r}_getConfiguration(e){return{}}_mouseEventToBasic(e,t,i,r,o,c){o=o??0,c=c??0;const[s,d]=this._viewportCoords.canvasPosition(e,t);return this._viewportCoords.canvasToBasic(s-o,d-c,t,r,i.perspective)}}class dE extends cN{constructor(e,t,i,r,o){super(e,t,i,r),this._tagCreator=o,this._geometryCreated$=new ri}get geometryCreated$(){return this._geometryCreated$}_enable(){this._enableCreate(),this._container.container.classList.add("component-tag-create")}_disable(){this._container.container.classList.remove("component-tag-create"),this._disableCreate()}_validateBasic(e){const t=e[0],i=e[1];return 0<=t&&t<=1&&0<=i&&i<=1}_mouseEventToBasic$(e){return e.pipe(Ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$),it(([t,i,r])=>this._mouseEventToBasic(t,this._container.container,i,r)))}}class ase extends dE{_enableCreate(){this._container.mouseService.deferPixels(this._name,4),this._geometryCreatedSubscription=this._mouseEventToBasic$(this._container.mouseService.proximateClick$).pipe(oi(this._validateBasic),it(e=>new ose(e))).subscribe(this._geometryCreated$)}_disableCreate(){this._container.mouseService.undeferPixels(this._name),this._geometryCreatedSubscription.unsubscribe()}_getNameExtension(){return"create-point"}}class fE extends dE{_enableCreate(){this._container.mouseService.deferPixels(this._name,4);const e=this._navigator.stateService.currentTransform$.pipe(it(()=>{}),Pi(1),gi());this._deleteSubscription=e.pipe(Ys(1)).subscribe(this._tagCreator.delete$);const t=this._mouseEventToBasic$(this._container.mouseService.proximateClick$).pipe(dn());this._createSubscription=e.pipe(ei(()=>t.pipe(oi(this._validateBasic),$l(1)))).subscribe(this._create$),this._setVertexSubscription=this._tagCreator.tag$.pipe(ei(i=>i?Si(Ai(i),fn(this._container.mouseService.mouseMove$,this._container.mouseService.domMouseMove$),this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$):zi())).subscribe(([i,r,o,c])=>{const s=this._mouseEventToBasic(r,this._container.container,o,c);this._setVertex2d(i,s,c)}),this._addPointSubscription=this._tagCreator.tag$.pipe(ei(i=>i?Si(Ai(i),t):zi())).subscribe(([i,r])=>{this._addPoint(i,r)}),this._geometryCreateSubscription=this._tagCreator.tag$.pipe(ei(i=>i?i.created$.pipe(it(r=>r.geometry)):zi())).subscribe(this._geometryCreated$)}_disableCreate(){this._container.mouseService.undeferPixels(this._name),this._tagCreator.delete$.next(null),this._addPointSubscription.unsubscribe(),this._createSubscription.unsubscribe(),this._deleteSubscription.unsubscribe(),this._geometryCreateSubscription.unsubscribe(),this._setVertexSubscription.unsubscribe()}}class lse extends fE{get _create$(){return this._tagCreator.createPoints$}_addPoint(e,t){e.geometry.addPoint2d(t)}_getNameExtension(){return"create-points"}_setVertex2d(e,t,i){e.geometry.setPoint2d(e.geometry.points.length-1,t,i)}}class cse extends fE{get _create$(){return this._tagCreator.createPolygon$}_addPoint(e,t){e.addPoint(t)}_getNameExtension(){return"create-polygon"}_setVertex2d(e,t,i){e.geometry.setVertex2d(e.geometry.polygon.length-2,t,i)}}class use extends fE{get _create$(){return this._tagCreator.createRect$}_addPoint(e,t){const i=e.geometry;i.validate(t)||(t=i.getNonAdjustedVertex2d(3)),e.addPoint(t)}_enable(){super._enable(),this._initializeAnchorIndexingSubscription=this._tagCreator.tag$.pipe(oi(e=>!!e)).subscribe(e=>{e.geometry.initializeAnchorIndexing()})}_disable(){super._disable(),this._initializeAnchorIndexingSubscription.unsubscribe()}_getNameExtension(){return"create-rect"}_setVertex2d(e,t,i){e.geometry.setOppositeVertex2d(t,i)}}class hse extends dE{_enableCreate(){this._container.mouseService.claimMouse(this._name,2),this._deleteSubscription=this._navigator.stateService.currentTransform$.pipe(it(i=>null),Ys(1)).subscribe(this._tagCreator.delete$),this._createSubscription=this._mouseEventToBasic$(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragStart$)).pipe(oi(this._validateBasic)).subscribe(this._tagCreator.createRect$),this._initializeAnchorIndexingSubscription=this._tagCreator.tag$.pipe(oi(i=>!!i)).subscribe(i=>{i.geometry.initializeAnchorIndexing()});const e=Si(fn(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseMove$),this._container.mouseService.filtered$(this._name,this._container.mouseService.domMouseMove$)),this._container.renderService.renderCamera$).pipe(Ui(this._navigator.stateService.currentTransform$),it(([[i,r],o])=>this._mouseEventToBasic(i,this._container.container,r,o)));this._setVertexSubscription=this._tagCreator.tag$.pipe(ei(i=>i?Si(Ai(i),e,this._navigator.stateService.currentTransform$):zi())).subscribe(([i,r,o])=>{i.geometry.setOppositeVertex2d(r,o)});const t=this._container.mouseService.mouseDragEnd$.pipe(Ui(this._mouseEventToBasic$(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDrag$)).pipe(oi(this._validateBasic)),(i,r)=>r),dn());this._addPointSubscription=this._tagCreator.tag$.pipe(ei(i=>i?Si(Ai(i),t):zi())).subscribe(([i,r])=>{const o=i.geometry;o.validate(r)||(r=o.getNonAdjustedVertex2d(3)),i.addPoint(r)}),this._geometryCreatedSubscription=this._tagCreator.tag$.pipe(ei(i=>i?i.created$.pipe(it(r=>r.geometry)):zi())).subscribe(this._geometryCreated$)}_disableCreate(){this._container.mouseService.unclaimMouse(this._name),this._tagCreator.delete$.next(null),this._addPointSubscription.unsubscribe(),this._createSubscription.unsubscribe(),this._deleteSubscription.unsubscribe(),this._geometryCreatedSubscription.unsubscribe(),this._initializeAnchorIndexingSubscription.unsubscribe(),this._setVertexSubscription.unsubscribe()}_getNameExtension(){return"create-rect-drag"}}class dse extends cN{constructor(e,t,i,r,o){super(e,t,i,r),this._tagSet=o}_enable(){const e=this._tagSet.changed$.pipe(it(t=>t.getAll()),ei(t=>Fr(t).pipe(Hi(i=>i.interact$))),ei(t=>Ul(Ai(t),this._container.mouseService.documentMouseUp$.pipe(it(()=>({offsetX:0,offsetY:0,operation:nl.None,tag:null})),wi()))),dn());fn(this._container.mouseService.mouseMove$,this._container.mouseService.domMouseMove$).pipe(dn()),this._claimMouseSubscription=e.pipe(ei(t=>t.tag?this._container.mouseService.domMouseDragStart$:zi())).subscribe(()=>{this._container.mouseService.claimMouse(this._name,3)}),this._cursorSubscription=e.pipe(it(t=>t.cursor),yi()).subscribe(t=>{const i=["crosshair","move","nesw-resize","nwse-resize"];for(const r of i)this._container.container.classList.remove(`component-tag-edit-${r}`);t&&this._container.container.classList.add(`component-tag-edit-${t}`)}),this._unclaimMouseSubscription=this._container.mouseService.filtered$(this._name,this._container.mouseService.domMouseDragEnd$).subscribe(t=>{this._container.mouseService.unclaimMouse(this._name)}),this._preventDefaultSubscription=e.pipe(ei(t=>t.tag?this._container.mouseService.documentMouseMove$:zi())).subscribe(t=>{t.preventDefault()}),this._updateGeometrySubscription=e.pipe(ei(t=>{if(t.operation===nl.None||!t.tag)return zi();const i=this._container.mouseService.filtered$(this._name,this._container.mouseService.domMouseDrag$).pipe(oi(r=>this._viewportCoords.insideElement(r,this._container.container)));return Si(i,this._container.renderService.renderCamera$).pipe(Ui(Ai(t),this._navigator.stateService.currentTransform$,([r,o],c,s)=>[r,o,c,s]))})).subscribe(([t,i,r,o])=>{const c=this._mouseEventToBasic(t,this._container.container,i,o,r.offsetX,r.offsetY),s=r.tag.geometry;r.operation===nl.Centroid?s.setCentroid2d(c,o):r.operation===nl.Vertex&&s.setVertex2d(r.vertexIndex,c,o)})}_disable(){this._claimMouseSubscription.unsubscribe(),this._cursorSubscription.unsubscribe(),this._preventDefaultSubscription.unsubscribe(),this._unclaimMouseSubscription.unsubscribe(),this._updateGeometrySubscription.unsubscribe()}_getNameExtension(){return"edit-vertex"}}class uN extends bo{constructor(e,t,i){super(e,t,i),this._tagDomRenderer=new ese,this._tagScene=new tse,this._tagSet=new sse,this._tagCreator=new Qre(this,i),this._viewportCoords=new zo,this._createHandlers={CreatePoint:new ase(this,t,i,this._viewportCoords,this._tagCreator),CreatePoints:new lse(this,t,i,this._viewportCoords,this._tagCreator),CreatePolygon:new cse(this,t,i,this._viewportCoords,this._tagCreator),CreateRect:new use(this,t,i,this._viewportCoords,this._tagCreator),CreateRectDrag:new hse(this,t,i,this._viewportCoords,this._tagCreator),Default:void 0},this._editVertexHandler=new dse(this,t,i,this._viewportCoords,this._tagSet),this._renderTags$=this._tagSet.changed$.pipe(it(r=>{const o=r.getAll();return o.sort((c,s)=>{const d=c.tag.id,p=s.tag.id;return d<p?-1:d>p?1:0}),o}),dn()),this._tagChanged$=this._renderTags$.pipe(ei(r=>Fr(r).pipe(Hi(o=>fn(o.tag.changed$,o.tag.geometryChanged$)))),dn()),this._renderTagGLChanged$=this._renderTags$.pipe(ei(r=>Fr(r).pipe(Hi(o=>o.glObjectsChanged$))),dn()),this._createGeometryChanged$=this._tagCreator.tag$.pipe(ei(r=>r!=null?r.geometryChanged$:zi()),dn()),this._createGLObjectsChanged$=this._tagCreator.tag$.pipe(ei(r=>r!=null?r.glObjectsChanged$:zi()),dn()),this._creatingConfiguration$=this._configuration$.pipe(yi((r,o)=>r.mode===o.mode,r=>({createColor:r.createColor,mode:r.mode})),Pi(1),gi()),this._creatingConfiguration$.subscribe(r=>{const o="tagmode",c={mode:r.mode,target:this,type:o};this.fire(o,c)})}add(e){this._activated?this._navigator.stateService.currentTransform$.pipe(wi()).subscribe(t=>{this._tagSet.add(e,t);const i=e.map(r=>this._tagSet.get(r.id));this._tagScene.add(i)}):this._tagSet.addDeactivated(e)}calculateRect(e){return new Promise((t,i)=>{this._navigator.stateService.currentTransform$.pipe(wi(),it(r=>e.getRect2d(r))).subscribe(r=>{t(r)},r=>{i(r)})})}create(){this._tagCreator.replayedTag$.pipe(wi(),oi(e=>!!e)).subscribe(e=>{e.create()})}changeMode(e){this.configure({mode:e})}fire(e,t){super.fire(e,t)}get(e){if(this._activated){const t=this._tagSet.get(e);return t!==void 0?t.tag:void 0}else return this._tagSet.getDeactivated(e)}getAll(){return this.activated?this._tagSet.getAll().map(e=>e.tag):this._tagSet.getAllDeactivated()}getTagIdsAt(e){return new Promise((t,i)=>{this._container.renderService.renderCamera$.pipe(wi(),it(r=>{const o=this._viewportCoords.canvasToViewport(e[0],e[1],this._container.container);return this._tagScene.intersectObjects(o,r.perspective)})).subscribe(r=>{t(r)},r=>{i(r)})})}has(e){return this._activated?this._tagSet.has(e):this._tagSet.hasDeactivated(e)}off(e,t){super.off(e,t)}on(e,t){super.on(e,t)}remove(e){this._activated?(this._tagSet.remove(e),this._tagScene.remove(e)):this._tagSet.removeDeactivated(e)}removeAll(){this._activated?(this._tagSet.removeAll(),this._tagScene.removeAll()):this._tagSet.removeAllDeactivated()}_activate(){this._editVertexHandler.enable();const e=Fr(Object.keys(this._createHandlers)).pipe(it(i=>this._createHandlers[i]),oi(i=>!!i),Hi(i=>i.geometryCreated$),dn()),t=this._subscriptions;t.push(e.subscribe(i=>{const r="geometrycreate",o={geometry:i,target:this,type:r};this.fire(r,o)})),t.push(this._tagCreator.tag$.pipe(t2(i=>i==null),yi()).subscribe(i=>{const r=i!=null?"tagcreatestart":"tagcreateend",o={target:this,type:r};this.fire(r,o)})),t.push(e.subscribe(()=>{this.changeMode(xg.Default)})),t.push(this._creatingConfiguration$.subscribe(i=>{this._disableCreateHandlers();const r=xg[i.mode],o=this._createHandlers[r];o&&o.enable()})),t.push(this._renderTags$.subscribe(()=>{const i="tags",r={target:this,type:i};this.fire(i,r)})),t.push(this._tagCreator.tag$.pipe(ei(i=>i!=null?i.aborted$.pipe(it(()=>null)):zi())).subscribe(()=>{this.changeMode(xg.Default)})),t.push(this._tagCreator.tag$.subscribe(i=>{this._tagScene.hasCreateTag()&&this._tagScene.removeCreateTag(),i!=null&&this._tagScene.addCreateTag(i)})),t.push(this._createGLObjectsChanged$.subscribe(i=>{this._tagScene.updateCreateTagObjects(i)})),t.push(this._renderTagGLChanged$.subscribe(i=>{this._tagScene.updateObjects(i)})),t.push(this._tagChanged$.subscribe(()=>{this._tagScene.update()})),t.push(Si(this._renderTags$.pipe(An([]),Dr(()=>{this._container.domRenderer.render$.next({name:this._name,vNode:this._tagDomRenderer.clear()})})),this._container.renderService.renderCamera$,this._container.spriteService.spriteAtlas$,this._container.renderService.size$,this._tagChanged$.pipe(An(null)),fn(this._tagCreator.tag$,this._createGeometryChanged$).pipe(An(null))).pipe(it(([i,r,o,c,,s])=>({name:this._name,vNode:this._tagDomRenderer.render(i,s,o,r.perspective,c)}))).subscribe(this._container.domRenderer.render$)),t.push(this._navigator.stateService.currentState$.pipe(it(i=>{const r=this._tagScene;return{name:this._name,renderer:{frameId:i.id,needsRender:r.needsRender,render:r.render.bind(r),pass:Ih.Opaque}}})).subscribe(this._container.glRenderer.render$)),this._navigator.stateService.currentTransform$.pipe(wi()).subscribe(i=>{this._tagSet.activate(i),this._tagScene.add(this._tagSet.getAll())})}_deactivate(){this._editVertexHandler.disable(),this._disableCreateHandlers(),this._tagScene.clear(),this._tagSet.deactivate(),this._tagCreator.delete$.next(null),this._subscriptions.unsubscribe(),this._container.container.classList.remove("component-tag-create")}_getDefaultConfiguration(){return{createColor:16777215,indicatePointsCompleter:!0,mode:xg.Default}}_disableCreateHandlers(){const e=this._createHandlers;for(const t in e){if(!e.hasOwnProperty(t))continue;const i=e[t];i&&i.disable()}}}uN.componentName="tag";class hN extends bo{constructor(e,t,i){super(e,t,i),this._viewportCoords=new zo,this._zoomDelta$=new ri}_activate(){const e=this._subscriptions;e.push(Si(this._navigator.stateService.currentState$,this._navigator.stateService.state$,this._configuration$,this._container.renderService.size$).pipe(it(([t,i,r,o])=>{const c=t.state.zoom,s=Gt.h("div.mapillary-zoom-in-icon",[]),d=c>=3||i===Oi.Waiting?Gt.h("div.mapillary-zoom-in-button-inactive",[s]):Gt.h("div.mapillary-zoom-in-button",{onclick:()=>{this._zoomDelta$.next(1)}},[s]),p=Gt.h("div.mapillary-zoom-out-icon",[]),g=c<=0||i===Oi.Waiting?Gt.h("div.mapillary-zoom-out-button-inactive",[p]):Gt.h("div.mapillary-zoom-out-button",{onclick:()=>{this._zoomDelta$.next(-1)}},[p]),_=r.size===kd.Small||r.size===kd.Automatic&&o.width<640?".mapillary-zoom-compact":"";return{name:this._name,vNode:Gt.h("div.mapillary-zoom-container"+_,{oncontextmenu:x=>{x.preventDefault()}},[d,g])}})).subscribe(this._container.domRenderer.render$)),e.push(this._zoomDelta$.pipe(Ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$)).subscribe(([t,i,r])=>{const o=this._viewportCoords.unprojectFromViewport(0,0,i.perspective),c=r.projectBasic(o.toArray());this._navigator.stateService.zoomIn(t,c)}))}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{size:kd.Automatic}}}hN.componentName="zoom";class dN extends bo{constructor(e,t,i,r){super(e,t,i),this._canvasId=`${t.id}-${this._name}`,this._dom=r||new rE}_activate(){const e=this._container.domRenderer.element$.pipe(it(()=>this._dom.document.getElementById(this._canvasId)),oi(t=>!!t),it(t=>{const i=t.parentElement,r=i.offsetWidth,o=i.offsetHeight;return[t,{height:o,width:r}]}),yi((t,i)=>t.height===i.height&&t.width===i.width,([,t])=>t));this._subscriptions.push(Si(e,this._navigator.stateService.currentImage$).subscribe(([[t,i],r])=>{t.width=i.width,t.height=i.height,t.getContext("2d").drawImage(r.image,0,0,i.width,i.height)})),this._container.domRenderer.renderAdaptive$.next({name:this._name,vNode:Gt.h(`canvas#${this._canvasId}`,[])})}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{}}}dN.componentName="imagefallback";class fN extends bo{constructor(e,t,i){super(e,t,i),this._seqNames={},this._seqNames[Vt[Vt.Prev]]="-prev",this._seqNames[Vt[Vt.Next]]="-next",this._spaTopNames={},this._spaTopNames[Vt[Vt.TurnLeft]]="-turn-left",this._spaTopNames[Vt[Vt.StepLeft]]="-left",this._spaTopNames[Vt[Vt.StepForward]]="-forward",this._spaTopNames[Vt[Vt.StepRight]]="-right",this._spaTopNames[Vt[Vt.TurnRight]]="-turn-right",this._spaBottomNames={},this._spaBottomNames[Vt[Vt.TurnU]]="-turn-around",this._spaBottomNames[Vt[Vt.StepBackward]]="-backward"}_activate(){this._subscriptions.push(Si(this._navigator.stateService.currentImage$,this._configuration$).pipe(ei(([e,t])=>{const i=t.sequence?e.sequenceEdges$.pipe(it(o=>o.edges.map(c=>c.data.direction))):Ai([]),r=!ki(e.cameraType)&&t.spatial?e.spatialEdges$.pipe(it(o=>o.edges.map(c=>c.data.direction))):Ai([]);return Si(i,r).pipe(it(([o,c])=>o.concat(c)))}),it(e=>{const t=this._createArrowRow(this._seqNames,e),i=this._createArrowRow(this._spaTopNames,e),r=this._createArrowRow(this._spaBottomNames,e),o=Gt.h("div.mapillary-navigation-sequence",t),c=Gt.h("div.NavigationSpatialTop",i),s=Gt.h("div.mapillary-navigation-spatial-bottom",r),d=Gt.h("div.mapillary-navigation-spatial",[c,s]);return{name:this._name,vNode:Gt.h("div.NavigationContainer",[o,d])}})).subscribe(this._container.domRenderer.render$))}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{sequence:!0,spatial:!0}}_createArrowRow(e,t){const i=[];for(const r in e){if(!e.hasOwnProperty(r))continue;const o=Vt[r];t.indexOf(o)!==-1?i.push(this._createVNode(o,e[r],"visible")):i.push(this._createVNode(o,e[r],"hidden"))}return i}_createVNode(e,t,i){return Gt.h(`span.mapillary-navigation-button.mapillary-navigation${t}`,{onclick:()=>{this._navigator.moveDir$(e).subscribe(void 0,r=>{r instanceof Vl||console.error(r)})},style:{visibility:i}},[])}}fN.componentName="navigationfallback";function __(n){let e=n.length;for(;--e>=0;)n[e]=0}const fse=3,pse=258,pN=29,mse=256,gse=mse+1+pN,mN=30,_se=512,vse=new Array((gse+2)*2);__(vse);const yse=new Array(mN*2);__(yse);const bse=new Array(_se);__(bse);const xse=new Array(pse-fse+1);__(xse);const wse=new Array(pN);__(wse);const Sse=new Array(mN);__(Sse);const Tse=(n,e,t,i)=>{let r=n&65535|0,o=n>>>16&65535|0,c=0;for(;t!==0;){c=t>2e3?2e3:t,t-=c;do r=r+e[i++]|0,o=o+r|0;while(--c);r%=65521,o%=65521}return r|o<<16|0};var E2=Tse;const Mse=()=>{let n,e=[];for(var t=0;t<256;t++){n=t;for(var i=0;i<8;i++)n=n&1?3988292384^n>>>1:n>>>1;e[t]=n}return e},Cse=new Uint32Array(Mse()),Ese=(n,e,t,i)=>{const r=Cse,o=i+t;n^=-1;for(let c=i;c<o;c++)n=n>>>8^r[(n^e[c])&255];return n^-1};var Jc=Ese,A2={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},gN={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const Ase=(n,e)=>Object.prototype.hasOwnProperty.call(n,e);var Pse=function(n){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(const i in t)Ase(t,i)&&(n[i]=t[i])}}return n},Ise=n=>{let e=0;for(let i=0,r=n.length;i<r;i++)e+=n[i].length;const t=new Uint8Array(e);for(let i=0,r=0,o=n.length;i<o;i++){let c=n[i];t.set(c,r),r+=c.length}return t},_N={assign:Pse,flattenChunks:Ise};let vN=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{vN=!1}const Jy=new Uint8Array(256);for(let n=0;n<256;n++)Jy[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;Jy[254]=Jy[254]=1;var Rse=n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let e,t,i,r,o,c=n.length,s=0;for(r=0;r<c;r++)t=n.charCodeAt(r),(t&64512)===55296&&r+1<c&&(i=n.charCodeAt(r+1),(i&64512)===56320&&(t=65536+(t-55296<<10)+(i-56320),r++)),s+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(s),o=0,r=0;o<s;r++)t=n.charCodeAt(r),(t&64512)===55296&&r+1<c&&(i=n.charCodeAt(r+1),(i&64512)===56320&&(t=65536+(t-55296<<10)+(i-56320),r++)),t<128?e[o++]=t:t<2048?(e[o++]=192|t>>>6,e[o++]=128|t&63):t<65536?(e[o++]=224|t>>>12,e[o++]=128|t>>>6&63,e[o++]=128|t&63):(e[o++]=240|t>>>18,e[o++]=128|t>>>12&63,e[o++]=128|t>>>6&63,e[o++]=128|t&63);return e};const Lse=(n,e)=>{if(e<65534&&n.subarray&&vN)return String.fromCharCode.apply(null,n.length===e?n:n.subarray(0,e));let t="";for(let i=0;i<e;i++)t+=String.fromCharCode(n[i]);return t};var kse=(n,e)=>{const t=e||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,e));let i,r;const o=new Array(t*2);for(r=0,i=0;i<t;){let c=n[i++];if(c<128){o[r++]=c;continue}let s=Jy[c];if(s>4){o[r++]=65533,i+=s-1;continue}for(c&=s===2?31:s===3?15:7;s>1&&i<t;)c=c<<6|n[i++]&63,s--;if(s>1){o[r++]=65533;continue}c<65536?o[r++]=c:(c-=65536,o[r++]=55296|c>>10&1023,o[r++]=56320|c&1023)}return Lse(o,r)},Dse=(n,e)=>{e=e||n.length,e>n.length&&(e=n.length);let t=e-1;for(;t>=0&&(n[t]&192)===128;)t--;return t<0||t===0?e:t+Jy[n[t]]>e?t:e},P2={string2buf:Rse,buf2string:kse,utf8border:Dse};function Fse(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Ose=Fse;const Ex=30,zse=12;var Bse=function(e,t){let i,r,o,c,s,d,p,g,_,x,b,S,P,L,E,C,D,O,U,q,G,N,V,j;const z=e.state;i=e.next_in,V=e.input,r=i+(e.avail_in-5),o=e.next_out,j=e.output,c=o-(t-e.avail_out),s=o+(e.avail_out-257),d=z.dmax,p=z.wsize,g=z.whave,_=z.wnext,x=z.window,b=z.hold,S=z.bits,P=z.lencode,L=z.distcode,E=(1<<z.lenbits)-1,C=(1<<z.distbits)-1;e:do{S<15&&(b+=V[i++]<<S,S+=8,b+=V[i++]<<S,S+=8),D=P[b&E];t:for(;;){if(O=D>>>24,b>>>=O,S-=O,O=D>>>16&255,O===0)j[o++]=D&65535;else if(O&16){U=D&65535,O&=15,O&&(S<O&&(b+=V[i++]<<S,S+=8),U+=b&(1<<O)-1,b>>>=O,S-=O),S<15&&(b+=V[i++]<<S,S+=8,b+=V[i++]<<S,S+=8),D=L[b&C];i:for(;;){if(O=D>>>24,b>>>=O,S-=O,O=D>>>16&255,O&16){if(q=D&65535,O&=15,S<O&&(b+=V[i++]<<S,S+=8,S<O&&(b+=V[i++]<<S,S+=8)),q+=b&(1<<O)-1,q>d){e.msg="invalid distance too far back",z.mode=Ex;break e}if(b>>>=O,S-=O,O=o-c,q>O){if(O=q-O,O>g&&z.sane){e.msg="invalid distance too far back",z.mode=Ex;break e}if(G=0,N=x,_===0){if(G+=p-O,O<U){U-=O;do j[o++]=x[G++];while(--O);G=o-q,N=j}}else if(_<O){if(G+=p+_-O,O-=_,O<U){U-=O;do j[o++]=x[G++];while(--O);if(G=0,_<U){O=_,U-=O;do j[o++]=x[G++];while(--O);G=o-q,N=j}}}else if(G+=_-O,O<U){U-=O;do j[o++]=x[G++];while(--O);G=o-q,N=j}for(;U>2;)j[o++]=N[G++],j[o++]=N[G++],j[o++]=N[G++],U-=3;U&&(j[o++]=N[G++],U>1&&(j[o++]=N[G++]))}else{G=o-q;do j[o++]=j[G++],j[o++]=j[G++],j[o++]=j[G++],U-=3;while(U>2);U&&(j[o++]=j[G++],U>1&&(j[o++]=j[G++]))}}else if((O&64)===0){D=L[(D&65535)+(b&(1<<O)-1)];continue i}else{e.msg="invalid distance code",z.mode=Ex;break e}break}}else if((O&64)===0){D=P[(D&65535)+(b&(1<<O)-1)];continue t}else if(O&32){z.mode=zse;break e}else{e.msg="invalid literal/length code",z.mode=Ex;break e}break}}while(i<r&&o<s);U=S>>3,i-=U,S-=U<<3,b&=(1<<S)-1,e.next_in=i,e.next_out=o,e.avail_in=i<r?5+(r-i):5-(i-r),e.avail_out=o<s?257+(s-o):257-(o-s),z.hold=b,z.bits=S};const ag=15,B3=852,N3=592,$3=0,pM=1,V3=2,Nse=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),$se=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Vse=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Use=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),jse=(n,e,t,i,r,o,c,s)=>{const d=s.bits;let p=0,g=0,_=0,x=0,b=0,S=0,P=0,L=0,E=0,C=0,D,O,U,q,G,N=null,V=0,j;const z=new Uint16Array(ag+1),Q=new Uint16Array(ag+1);let X=null,re=0,se,le,ce;for(p=0;p<=ag;p++)z[p]=0;for(g=0;g<i;g++)z[e[t+g]]++;for(b=d,x=ag;x>=1&&z[x]===0;x--);if(b>x&&(b=x),x===0)return r[o++]=1<<24|64<<16|0,r[o++]=1<<24|64<<16|0,s.bits=1,0;for(_=1;_<x&&z[_]===0;_++);for(b<_&&(b=_),L=1,p=1;p<=ag;p++)if(L<<=1,L-=z[p],L<0)return-1;if(L>0&&(n===$3||x!==1))return-1;for(Q[1]=0,p=1;p<ag;p++)Q[p+1]=Q[p]+z[p];for(g=0;g<i;g++)e[t+g]!==0&&(c[Q[e[t+g]]++]=g);if(n===$3?(N=X=c,j=19):n===pM?(N=Nse,V-=257,X=$se,re-=257,j=256):(N=Vse,X=Use,j=-1),C=0,g=0,p=_,G=o,S=b,P=0,U=-1,E=1<<b,q=E-1,n===pM&&E>B3||n===V3&&E>N3)return 1;for(;;){se=p-P,c[g]<j?(le=0,ce=c[g]):c[g]>j?(le=X[re+c[g]],ce=N[V+c[g]]):(le=96,ce=0),D=1<<p-P,O=1<<S,_=O;do O-=D,r[G+(C>>P)+O]=se<<24|le<<16|ce|0;while(O!==0);for(D=1<<p-1;C&D;)D>>=1;if(D!==0?(C&=D-1,C+=D):C=0,g++,--z[p]===0){if(p===x)break;p=e[t+c[g]]}if(p>b&&(C&q)!==U){for(P===0&&(P=b),G+=_,S=p-P,L=1<<S;S+P<x&&(L-=z[S+P],!(L<=0));)S++,L<<=1;if(E+=1<<S,n===pM&&E>B3||n===V3&&E>N3)return 1;U=C&q,r[U]=b<<24|S<<16|G-o|0}}return C!==0&&(r[G+C]=p-P<<24|64<<16|0),s.bits=b,0};var by=jse;const Gse=0,yN=1,bN=2,{Z_FINISH:U3,Z_BLOCK:qse,Z_TREES:Ax,Z_OK:yp,Z_STREAM_END:Wse,Z_NEED_DICT:Hse,Z_STREAM_ERROR:Gl,Z_DATA_ERROR:xN,Z_MEM_ERROR:wN,Z_BUF_ERROR:Zse,Z_DEFLATED:j3}=gN,SN=1,G3=2,q3=3,W3=4,H3=5,Z3=6,X3=7,Y3=8,K3=9,J3=10,$w=11,oh=12,mM=13,Q3=14,gM=15,ek=16,tk=17,ik=18,nk=19,Px=20,Ix=21,rk=22,sk=23,ok=24,ak=25,lk=26,_M=27,ck=28,uk=29,Yr=30,TN=31,Xse=32,Yse=852,Kse=592,Jse=15,Qse=Jse,hk=n=>(n>>>24&255)+(n>>>8&65280)+((n&65280)<<8)+((n&255)<<24);function eoe(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const MN=n=>{if(!n||!n.state)return Gl;const e=n.state;return n.total_in=n.total_out=e.total=0,n.msg="",e.wrap&&(n.adler=e.wrap&1),e.mode=SN,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(Yse),e.distcode=e.distdyn=new Int32Array(Kse),e.sane=1,e.back=-1,yp},CN=n=>{if(!n||!n.state)return Gl;const e=n.state;return e.wsize=0,e.whave=0,e.wnext=0,MN(n)},EN=(n,e)=>{let t;if(!n||!n.state)return Gl;const i=n.state;return e<0?(t=0,e=-e):(t=(e>>4)+1,e<48&&(e&=15)),e&&(e<8||e>15)?Gl:(i.window!==null&&i.wbits!==e&&(i.window=null),i.wrap=t,i.wbits=e,CN(n))},AN=(n,e)=>{if(!n)return Gl;const t=new eoe;n.state=t,t.window=null;const i=EN(n,e);return i!==yp&&(n.state=null),i},toe=n=>AN(n,Qse);let dk=!0,vM,yM;const ioe=n=>{if(dk){vM=new Int32Array(512),yM=new Int32Array(32);let e=0;for(;e<144;)n.lens[e++]=8;for(;e<256;)n.lens[e++]=9;for(;e<280;)n.lens[e++]=7;for(;e<288;)n.lens[e++]=8;for(by(yN,n.lens,0,288,vM,0,n.work,{bits:9}),e=0;e<32;)n.lens[e++]=5;by(bN,n.lens,0,32,yM,0,n.work,{bits:5}),dk=!1}n.lencode=vM,n.lenbits=9,n.distcode=yM,n.distbits=5},PN=(n,e,t,i)=>{let r;const o=n.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),i>=o.wsize?(o.window.set(e.subarray(t-o.wsize,t),0),o.wnext=0,o.whave=o.wsize):(r=o.wsize-o.wnext,r>i&&(r=i),o.window.set(e.subarray(t-i,t-i+r),o.wnext),i-=r,i?(o.window.set(e.subarray(t-i,t),0),o.wnext=i,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r))),0},noe=(n,e)=>{let t,i,r,o,c,s,d,p,g,_,x,b,S,P,L=0,E,C,D,O,U,q,G,N;const V=new Uint8Array(4);let j,z;const Q=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!n||!n.state||!n.output||!n.input&&n.avail_in!==0)return Gl;t=n.state,t.mode===oh&&(t.mode=mM),c=n.next_out,r=n.output,d=n.avail_out,o=n.next_in,i=n.input,s=n.avail_in,p=t.hold,g=t.bits,_=s,x=d,N=yp;e:for(;;)switch(t.mode){case SN:if(t.wrap===0){t.mode=mM;break}for(;g<16;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}if(t.wrap&2&&p===35615){t.check=0,V[0]=p&255,V[1]=p>>>8&255,t.check=Jc(t.check,V,2,0),p=0,g=0,t.mode=G3;break}if(t.flags=0,t.head&&(t.head.done=!1),!(t.wrap&1)||(((p&255)<<8)+(p>>8))%31){n.msg="incorrect header check",t.mode=Yr;break}if((p&15)!==j3){n.msg="unknown compression method",t.mode=Yr;break}if(p>>>=4,g-=4,G=(p&15)+8,t.wbits===0)t.wbits=G;else if(G>t.wbits){n.msg="invalid window size",t.mode=Yr;break}t.dmax=1<<t.wbits,n.adler=t.check=1,t.mode=p&512?J3:oh,p=0,g=0;break;case G3:for(;g<16;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}if(t.flags=p,(t.flags&255)!==j3){n.msg="unknown compression method",t.mode=Yr;break}if(t.flags&57344){n.msg="unknown header flags set",t.mode=Yr;break}t.head&&(t.head.text=p>>8&1),t.flags&512&&(V[0]=p&255,V[1]=p>>>8&255,t.check=Jc(t.check,V,2,0)),p=0,g=0,t.mode=q3;case q3:for(;g<32;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}t.head&&(t.head.time=p),t.flags&512&&(V[0]=p&255,V[1]=p>>>8&255,V[2]=p>>>16&255,V[3]=p>>>24&255,t.check=Jc(t.check,V,4,0)),p=0,g=0,t.mode=W3;case W3:for(;g<16;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}t.head&&(t.head.xflags=p&255,t.head.os=p>>8),t.flags&512&&(V[0]=p&255,V[1]=p>>>8&255,t.check=Jc(t.check,V,2,0)),p=0,g=0,t.mode=H3;case H3:if(t.flags&1024){for(;g<16;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}t.length=p,t.head&&(t.head.extra_len=p),t.flags&512&&(V[0]=p&255,V[1]=p>>>8&255,t.check=Jc(t.check,V,2,0)),p=0,g=0}else t.head&&(t.head.extra=null);t.mode=Z3;case Z3:if(t.flags&1024&&(b=t.length,b>s&&(b=s),b&&(t.head&&(G=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(i.subarray(o,o+b),G)),t.flags&512&&(t.check=Jc(t.check,i,b,o)),s-=b,o+=b,t.length-=b),t.length))break e;t.length=0,t.mode=X3;case X3:if(t.flags&2048){if(s===0)break e;b=0;do G=i[o+b++],t.head&&G&&t.length<65536&&(t.head.name+=String.fromCharCode(G));while(G&&b<s);if(t.flags&512&&(t.check=Jc(t.check,i,b,o)),s-=b,o+=b,G)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=Y3;case Y3:if(t.flags&4096){if(s===0)break e;b=0;do G=i[o+b++],t.head&&G&&t.length<65536&&(t.head.comment+=String.fromCharCode(G));while(G&&b<s);if(t.flags&512&&(t.check=Jc(t.check,i,b,o)),s-=b,o+=b,G)break e}else t.head&&(t.head.comment=null);t.mode=K3;case K3:if(t.flags&512){for(;g<16;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}if(p!==(t.check&65535)){n.msg="header crc mismatch",t.mode=Yr;break}p=0,g=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),n.adler=t.check=0,t.mode=oh;break;case J3:for(;g<32;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}n.adler=t.check=hk(p),p=0,g=0,t.mode=$w;case $w:if(t.havedict===0)return n.next_out=c,n.avail_out=d,n.next_in=o,n.avail_in=s,t.hold=p,t.bits=g,Hse;n.adler=t.check=1,t.mode=oh;case oh:if(e===qse||e===Ax)break e;case mM:if(t.last){p>>>=g&7,g-=g&7,t.mode=_M;break}for(;g<3;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}switch(t.last=p&1,p>>>=1,g-=1,p&3){case 0:t.mode=Q3;break;case 1:if(ioe(t),t.mode=Px,e===Ax){p>>>=2,g-=2;break e}break;case 2:t.mode=tk;break;case 3:n.msg="invalid block type",t.mode=Yr}p>>>=2,g-=2;break;case Q3:for(p>>>=g&7,g-=g&7;g<32;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}if((p&65535)!==(p>>>16^65535)){n.msg="invalid stored block lengths",t.mode=Yr;break}if(t.length=p&65535,p=0,g=0,t.mode=gM,e===Ax)break e;case gM:t.mode=ek;case ek:if(b=t.length,b){if(b>s&&(b=s),b>d&&(b=d),b===0)break e;r.set(i.subarray(o,o+b),c),s-=b,o+=b,d-=b,c+=b,t.length-=b;break}t.mode=oh;break;case tk:for(;g<14;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}if(t.nlen=(p&31)+257,p>>>=5,g-=5,t.ndist=(p&31)+1,p>>>=5,g-=5,t.ncode=(p&15)+4,p>>>=4,g-=4,t.nlen>286||t.ndist>30){n.msg="too many length or distance symbols",t.mode=Yr;break}t.have=0,t.mode=ik;case ik:for(;t.have<t.ncode;){for(;g<3;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}t.lens[Q[t.have++]]=p&7,p>>>=3,g-=3}for(;t.have<19;)t.lens[Q[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,j={bits:t.lenbits},N=by(Gse,t.lens,0,19,t.lencode,0,t.work,j),t.lenbits=j.bits,N){n.msg="invalid code lengths set",t.mode=Yr;break}t.have=0,t.mode=nk;case nk:for(;t.have<t.nlen+t.ndist;){for(;L=t.lencode[p&(1<<t.lenbits)-1],E=L>>>24,C=L>>>16&255,D=L&65535,!(E<=g);){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}if(D<16)p>>>=E,g-=E,t.lens[t.have++]=D;else{if(D===16){for(z=E+2;g<z;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}if(p>>>=E,g-=E,t.have===0){n.msg="invalid bit length repeat",t.mode=Yr;break}G=t.lens[t.have-1],b=3+(p&3),p>>>=2,g-=2}else if(D===17){for(z=E+3;g<z;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}p>>>=E,g-=E,G=0,b=3+(p&7),p>>>=3,g-=3}else{for(z=E+7;g<z;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}p>>>=E,g-=E,G=0,b=11+(p&127),p>>>=7,g-=7}if(t.have+b>t.nlen+t.ndist){n.msg="invalid bit length repeat",t.mode=Yr;break}for(;b--;)t.lens[t.have++]=G}}if(t.mode===Yr)break;if(t.lens[256]===0){n.msg="invalid code -- missing end-of-block",t.mode=Yr;break}if(t.lenbits=9,j={bits:t.lenbits},N=by(yN,t.lens,0,t.nlen,t.lencode,0,t.work,j),t.lenbits=j.bits,N){n.msg="invalid literal/lengths set",t.mode=Yr;break}if(t.distbits=6,t.distcode=t.distdyn,j={bits:t.distbits},N=by(bN,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,j),t.distbits=j.bits,N){n.msg="invalid distances set",t.mode=Yr;break}if(t.mode=Px,e===Ax)break e;case Px:t.mode=Ix;case Ix:if(s>=6&&d>=258){n.next_out=c,n.avail_out=d,n.next_in=o,n.avail_in=s,t.hold=p,t.bits=g,Bse(n,x),c=n.next_out,r=n.output,d=n.avail_out,o=n.next_in,i=n.input,s=n.avail_in,p=t.hold,g=t.bits,t.mode===oh&&(t.back=-1);break}for(t.back=0;L=t.lencode[p&(1<<t.lenbits)-1],E=L>>>24,C=L>>>16&255,D=L&65535,!(E<=g);){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}if(C&&(C&240)===0){for(O=E,U=C,q=D;L=t.lencode[q+((p&(1<<O+U)-1)>>O)],E=L>>>24,C=L>>>16&255,D=L&65535,!(O+E<=g);){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}p>>>=O,g-=O,t.back+=O}if(p>>>=E,g-=E,t.back+=E,t.length=D,C===0){t.mode=lk;break}if(C&32){t.back=-1,t.mode=oh;break}if(C&64){n.msg="invalid literal/length code",t.mode=Yr;break}t.extra=C&15,t.mode=rk;case rk:if(t.extra){for(z=t.extra;g<z;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}t.length+=p&(1<<t.extra)-1,p>>>=t.extra,g-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=sk;case sk:for(;L=t.distcode[p&(1<<t.distbits)-1],E=L>>>24,C=L>>>16&255,D=L&65535,!(E<=g);){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}if((C&240)===0){for(O=E,U=C,q=D;L=t.distcode[q+((p&(1<<O+U)-1)>>O)],E=L>>>24,C=L>>>16&255,D=L&65535,!(O+E<=g);){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}p>>>=O,g-=O,t.back+=O}if(p>>>=E,g-=E,t.back+=E,C&64){n.msg="invalid distance code",t.mode=Yr;break}t.offset=D,t.extra=C&15,t.mode=ok;case ok:if(t.extra){for(z=t.extra;g<z;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}t.offset+=p&(1<<t.extra)-1,p>>>=t.extra,g-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){n.msg="invalid distance too far back",t.mode=Yr;break}t.mode=ak;case ak:if(d===0)break e;if(b=x-d,t.offset>b){if(b=t.offset-b,b>t.whave&&t.sane){n.msg="invalid distance too far back",t.mode=Yr;break}b>t.wnext?(b-=t.wnext,S=t.wsize-b):S=t.wnext-b,b>t.length&&(b=t.length),P=t.window}else P=r,S=c-t.offset,b=t.length;b>d&&(b=d),d-=b,t.length-=b;do r[c++]=P[S++];while(--b);t.length===0&&(t.mode=Ix);break;case lk:if(d===0)break e;r[c++]=t.length,d--,t.mode=Ix;break;case _M:if(t.wrap){for(;g<32;){if(s===0)break e;s--,p|=i[o++]<<g,g+=8}if(x-=d,n.total_out+=x,t.total+=x,x&&(n.adler=t.check=t.flags?Jc(t.check,r,x,c-x):E2(t.check,r,x,c-x)),x=d,(t.flags?p:hk(p))!==t.check){n.msg="incorrect data check",t.mode=Yr;break}p=0,g=0}t.mode=ck;case ck:if(t.wrap&&t.flags){for(;g<32;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}if(p!==(t.total&4294967295)){n.msg="incorrect length check",t.mode=Yr;break}p=0,g=0}t.mode=uk;case uk:N=Wse;break e;case Yr:N=xN;break e;case TN:return wN;case Xse:default:return Gl}return n.next_out=c,n.avail_out=d,n.next_in=o,n.avail_in=s,t.hold=p,t.bits=g,(t.wsize||x!==n.avail_out&&t.mode<Yr&&(t.mode<_M||e!==U3))&&PN(n,n.output,n.next_out,x-n.avail_out),_-=n.avail_in,x-=n.avail_out,n.total_in+=_,n.total_out+=x,t.total+=x,t.wrap&&x&&(n.adler=t.check=t.flags?Jc(t.check,r,x,n.next_out-x):E2(t.check,r,x,n.next_out-x)),n.data_type=t.bits+(t.last?64:0)+(t.mode===oh?128:0)+(t.mode===Px||t.mode===gM?256:0),(_===0&&x===0||e===U3)&&N===yp&&(N=Zse),N},roe=n=>{if(!n||!n.state)return Gl;let e=n.state;return e.window&&(e.window=null),n.state=null,yp},soe=(n,e)=>{if(!n||!n.state)return Gl;const t=n.state;return(t.wrap&2)===0?Gl:(t.head=e,e.done=!1,yp)},ooe=(n,e)=>{const t=e.length;let i,r,o;return!n||!n.state||(i=n.state,i.wrap!==0&&i.mode!==$w)?Gl:i.mode===$w&&(r=1,r=E2(r,e,t,0),r!==i.check)?xN:(o=PN(n,e,t,t),o?(i.mode=TN,wN):(i.havedict=1,yp))};var aoe=CN,loe=EN,coe=MN,uoe=toe,hoe=AN,doe=noe,foe=roe,poe=soe,moe=ooe,goe="pako inflate (from Nodeca project)",hh={inflateReset:aoe,inflateReset2:loe,inflateResetKeep:coe,inflateInit:uoe,inflateInit2:hoe,inflate:doe,inflateEnd:foe,inflateGetHeader:poe,inflateSetDictionary:moe,inflateInfo:goe};function _oe(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var voe=_oe;const IN=Object.prototype.toString,{Z_NO_FLUSH:yoe,Z_FINISH:boe,Z_OK:Qy,Z_STREAM_END:bM,Z_NEED_DICT:xM,Z_STREAM_ERROR:xoe,Z_DATA_ERROR:fk,Z_MEM_ERROR:woe}=gN;function C1(n){this.options=_N.assign({chunkSize:1024*64,windowBits:15,to:""},n||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(n&&n.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15)===0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ose,this.strm.avail_out=0;let t=hh.inflateInit2(this.strm,e.windowBits);if(t!==Qy)throw new Error(A2[t]);if(this.header=new voe,hh.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=P2.string2buf(e.dictionary):IN.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=hh.inflateSetDictionary(this.strm,e.dictionary),t!==Qy)))throw new Error(A2[t])}C1.prototype.push=function(n,e){const t=this.strm,i=this.options.chunkSize,r=this.options.dictionary;let o,c,s;if(this.ended)return!1;for(e===~~e?c=e:c=e===!0?boe:yoe,IN.call(n)==="[object ArrayBuffer]"?t.input=new Uint8Array(n):t.input=n,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(i),t.next_out=0,t.avail_out=i),o=hh.inflate(t,c),o===xM&&r&&(o=hh.inflateSetDictionary(t,r),o===Qy?o=hh.inflate(t,c):o===fk&&(o=xM));t.avail_in>0&&o===bM&&t.state.wrap>0&&n[t.next_in]!==0;)hh.inflateReset(t),o=hh.inflate(t,c);switch(o){case xoe:case fk:case xM:case woe:return this.onEnd(o),this.ended=!0,!1}if(s=t.avail_out,t.next_out&&(t.avail_out===0||o===bM))if(this.options.to==="string"){let d=P2.utf8border(t.output,t.next_out),p=t.next_out-d,g=P2.buf2string(t.output,d);t.next_out=p,t.avail_out=i-p,p&&t.output.set(t.output.subarray(d,d+p),0),this.onData(g)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(o===Qy&&s===0)){if(o===bM)return o=hh.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};C1.prototype.onData=function(n){this.chunks.push(n)};C1.prototype.onEnd=function(n){n===Qy&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=_N.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};function Soe(n,e){const t=new C1(e);if(t.push(n),t.err)throw t.msg||A2[t.err];return t.result}var Toe=Soe,Moe={inflate:Toe};const{inflate:Coe}=Moe;var Eoe=Coe,pE={};pE.read=function(n,e,t,i,r){var o,c,s=r*8-i-1,d=(1<<s)-1,p=d>>1,g=-7,_=t?r-1:0,x=t?-1:1,b=n[e+_];for(_+=x,o=b&(1<<-g)-1,b>>=-g,g+=s;g>0;o=o*256+n[e+_],_+=x,g-=8);for(c=o&(1<<-g)-1,o>>=-g,g+=i;g>0;c=c*256+n[e+_],_+=x,g-=8);if(o===0)o=1-p;else{if(o===d)return c?NaN:(b?-1:1)*(1/0);c=c+Math.pow(2,i),o=o-p}return(b?-1:1)*c*Math.pow(2,o-i)};pE.write=function(n,e,t,i,r,o){var c,s,d,p=o*8-r-1,g=(1<<p)-1,_=g>>1,x=r===23?Math.pow(2,-24)-Math.pow(2,-77):0,b=i?0:o-1,S=i?1:-1,P=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,c=g):(c=Math.floor(Math.log(e)/Math.LN2),e*(d=Math.pow(2,-c))<1&&(c--,d*=2),c+_>=1?e+=x/d:e+=x*Math.pow(2,1-_),e*d>=2&&(c++,d/=2),c+_>=g?(s=0,c=g):c+_>=1?(s=(e*d-1)*Math.pow(2,r),c=c+_):(s=e*Math.pow(2,_-1)*Math.pow(2,r),c=0));r>=8;n[t+b]=s&255,b+=S,s/=256,r-=8);for(c=c<<r|s,p+=r;p>0;n[t+b]=c&255,b+=S,c/=256,p-=8);n[t+b-S]|=P*128};var Aoe=Wn,Rx=pE;function Wn(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}Wn.Varint=0;Wn.Fixed64=1;Wn.Bytes=2;Wn.Fixed32=5;var I2=65536*65536,pk=1/I2,Poe=12,RN=typeof TextDecoder>"u"?null:new TextDecoder("utf8");Wn.prototype={destroy:function(){this.buf=null},readFields:function(n,e,t){for(t=t||this.length;this.pos<t;){var i=this.readVarint(),r=i>>3,o=this.pos;this.type=i&7,n(r,e,this),this.pos===o&&this.skip(i)}return e},readMessage:function(n,e){return this.readFields(n,e,this.readVarint()+this.pos)},readFixed32:function(){var n=Lx(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=gk(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=Lx(this.buf,this.pos)+Lx(this.buf,this.pos+4)*I2;return this.pos+=8,n},readSFixed64:function(){var n=Lx(this.buf,this.pos)+gk(this.buf,this.pos+4)*I2;return this.pos+=8,n},readFloat:function(){var n=Rx.read(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=Rx.read(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var e=this.buf,t,i;return i=e[this.pos++],t=i&127,i<128||(i=e[this.pos++],t|=(i&127)<<7,i<128)||(i=e[this.pos++],t|=(i&127)<<14,i<128)||(i=e[this.pos++],t|=(i&127)<<21,i<128)?t:(i=e[this.pos],t|=(i&15)<<28,Ioe(t,n,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2===1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=Poe&&RN?Goe(this.buf,e,n):joe(this.buf,e,n)},readBytes:function(){var n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e},readPackedVarint:function(n,e){if(this.type!==Wn.Bytes)return n.push(this.readVarint(e));var t=ah(this);for(n=n||[];this.pos<t;)n.push(this.readVarint(e));return n},readPackedSVarint:function(n){if(this.type!==Wn.Bytes)return n.push(this.readSVarint());var e=ah(this);for(n=n||[];this.pos<e;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==Wn.Bytes)return n.push(this.readBoolean());var e=ah(this);for(n=n||[];this.pos<e;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==Wn.Bytes)return n.push(this.readFloat());var e=ah(this);for(n=n||[];this.pos<e;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==Wn.Bytes)return n.push(this.readDouble());var e=ah(this);for(n=n||[];this.pos<e;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==Wn.Bytes)return n.push(this.readFixed32());var e=ah(this);for(n=n||[];this.pos<e;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==Wn.Bytes)return n.push(this.readSFixed32());var e=ah(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==Wn.Bytes)return n.push(this.readFixed64());var e=ah(this);for(n=n||[];this.pos<e;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==Wn.Bytes)return n.push(this.readSFixed64());var e=ah(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed64());return n},skip:function(n){var e=n&7;if(e===Wn.Varint)for(;this.buf[this.pos++]>127;);else if(e===Wn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Wn.Fixed32)this.pos+=4;else if(e===Wn.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(n,e){this.writeVarint(n<<3|e)},realloc:function(n){for(var e=this.length||16;e<this.pos+n;)e*=2;if(e!==this.length){var t=new Uint8Array(e);t.set(this.buf),this.buf=t,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),cg(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),cg(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),cg(this.buf,n&-1,this.pos),cg(this.buf,Math.floor(n*pk),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),cg(this.buf,n&-1,this.pos),cg(this.buf,Math.floor(n*pk),this.pos+4),this.pos+=8},writeVarint:function(n){if(n=+n||0,n>268435455||n<0){Roe(n,this);return}this.realloc(4),this.buf[this.pos++]=n&127|(n>127?128:0),!(n<=127)&&(this.buf[this.pos++]=(n>>>=7)&127|(n>127?128:0),!(n<=127)&&(this.buf[this.pos++]=(n>>>=7)&127|(n>127?128:0),!(n<=127)&&(this.buf[this.pos++]=n>>>7&127)))},writeSVarint:function(n){this.writeVarint(n<0?-n*2-1:n*2)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(n.length*4),this.pos++;var e=this.pos;this.pos=qoe(this.buf,n,this.pos);var t=this.pos-e;t>=128&&mk(e,t,this),this.pos=e-1,this.writeVarint(t),this.pos+=t},writeFloat:function(n){this.realloc(4),Rx.write(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),Rx.write(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var e=n.length;this.writeVarint(e),this.realloc(e);for(var t=0;t<e;t++)this.buf[this.pos++]=n[t]},writeRawMessage:function(n,e){this.pos++;var t=this.pos;n(e,this);var i=this.pos-t;i>=128&&mk(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeMessage:function(n,e,t){this.writeTag(n,Wn.Bytes),this.writeRawMessage(e,t)},writePackedVarint:function(n,e){e.length&&this.writeMessage(n,Doe,e)},writePackedSVarint:function(n,e){e.length&&this.writeMessage(n,Foe,e)},writePackedBoolean:function(n,e){e.length&&this.writeMessage(n,Boe,e)},writePackedFloat:function(n,e){e.length&&this.writeMessage(n,Ooe,e)},writePackedDouble:function(n,e){e.length&&this.writeMessage(n,zoe,e)},writePackedFixed32:function(n,e){e.length&&this.writeMessage(n,Noe,e)},writePackedSFixed32:function(n,e){e.length&&this.writeMessage(n,$oe,e)},writePackedFixed64:function(n,e){e.length&&this.writeMessage(n,Voe,e)},writePackedSFixed64:function(n,e){e.length&&this.writeMessage(n,Uoe,e)},writeBytesField:function(n,e){this.writeTag(n,Wn.Bytes),this.writeBytes(e)},writeFixed32Field:function(n,e){this.writeTag(n,Wn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(n,e){this.writeTag(n,Wn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(n,e){this.writeTag(n,Wn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(n,e){this.writeTag(n,Wn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(n,e){this.writeTag(n,Wn.Varint),this.writeVarint(e)},writeSVarintField:function(n,e){this.writeTag(n,Wn.Varint),this.writeSVarint(e)},writeStringField:function(n,e){this.writeTag(n,Wn.Bytes),this.writeString(e)},writeFloatField:function(n,e){this.writeTag(n,Wn.Fixed32),this.writeFloat(e)},writeDoubleField:function(n,e){this.writeTag(n,Wn.Fixed64),this.writeDouble(e)},writeBooleanField:function(n,e){this.writeVarintField(n,!!e)}};function Ioe(n,e,t){var i=t.buf,r,o;if(o=i[t.pos++],r=(o&112)>>4,o<128||(o=i[t.pos++],r|=(o&127)<<3,o<128)||(o=i[t.pos++],r|=(o&127)<<10,o<128)||(o=i[t.pos++],r|=(o&127)<<17,o<128)||(o=i[t.pos++],r|=(o&127)<<24,o<128)||(o=i[t.pos++],r|=(o&1)<<31,o<128))return lg(n,r,e);throw new Error("Expected varint not more than 10 bytes")}function ah(n){return n.type===Wn.Bytes?n.readVarint()+n.pos:n.pos+1}function lg(n,e,t){return t?e*4294967296+(n>>>0):(e>>>0)*4294967296+(n>>>0)}function Roe(n,e){var t,i;if(n>=0?(t=n%4294967296|0,i=n/4294967296|0):(t=~(-n%4294967296),i=~(-n/4294967296),t^4294967295?t=t+1|0:(t=0,i=i+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),Loe(t,i,e),koe(i,e)}function Loe(n,e,t){t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos]=n&127}function koe(n,e){var t=(n&7)<<4;e.buf[e.pos++]|=t|((n>>>=3)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127)))))}function mk(n,e,t){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));t.realloc(i);for(var r=t.pos-1;r>=n;r--)t.buf[r+i]=t.buf[r]}function Doe(n,e){for(var t=0;t<n.length;t++)e.writeVarint(n[t])}function Foe(n,e){for(var t=0;t<n.length;t++)e.writeSVarint(n[t])}function Ooe(n,e){for(var t=0;t<n.length;t++)e.writeFloat(n[t])}function zoe(n,e){for(var t=0;t<n.length;t++)e.writeDouble(n[t])}function Boe(n,e){for(var t=0;t<n.length;t++)e.writeBoolean(n[t])}function Noe(n,e){for(var t=0;t<n.length;t++)e.writeFixed32(n[t])}function $oe(n,e){for(var t=0;t<n.length;t++)e.writeSFixed32(n[t])}function Voe(n,e){for(var t=0;t<n.length;t++)e.writeFixed64(n[t])}function Uoe(n,e){for(var t=0;t<n.length;t++)e.writeSFixed64(n[t])}function Lx(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+n[e+3]*16777216}function cg(n,e,t){n[t]=e,n[t+1]=e>>>8,n[t+2]=e>>>16,n[t+3]=e>>>24}function gk(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+(n[e+3]<<24)}function joe(n,e,t){for(var i="",r=e;r<t;){var o=n[r],c=null,s=o>239?4:o>223?3:o>191?2:1;if(r+s>t)break;var d,p,g;s===1?o<128&&(c=o):s===2?(d=n[r+1],(d&192)===128&&(c=(o&31)<<6|d&63,c<=127&&(c=null))):s===3?(d=n[r+1],p=n[r+2],(d&192)===128&&(p&192)===128&&(c=(o&15)<<12|(d&63)<<6|p&63,(c<=2047||c>=55296&&c<=57343)&&(c=null))):s===4&&(d=n[r+1],p=n[r+2],g=n[r+3],(d&192)===128&&(p&192)===128&&(g&192)===128&&(c=(o&15)<<18|(d&63)<<12|(p&63)<<6|g&63,(c<=65535||c>=1114112)&&(c=null))),c===null?(c=65533,s=1):c>65535&&(c-=65536,i+=String.fromCharCode(c>>>10&1023|55296),c=56320|c&1023),i+=String.fromCharCode(c),r+=s}return i}function Goe(n,e,t){return RN.decode(n.subarray(e,t))}function qoe(n,e,t){for(var i=0,r,o;i<e.length;i++){if(r=e.charCodeAt(i),r>55295&&r<57344)if(o)if(r<56320){n[t++]=239,n[t++]=191,n[t++]=189,o=r;continue}else r=o-55296<<10|r-56320|65536,o=null;else{r>56319||i+1===e.length?(n[t++]=239,n[t++]=191,n[t++]=189):o=r;continue}else o&&(n[t++]=239,n[t++]=191,n[t++]=189,o=null);r<128?n[t++]=r:(r<2048?n[t++]=r>>6|192:(r<65536?n[t++]=r>>12|224:(n[t++]=r>>18|240,n[t++]=r>>12&63|128),n[t++]=r>>6&63|128),n[t++]=r&63|128)}return t}function Woe(n){const e=Eoe(n,{to:"string"});return JSON.parse(e)}function wM(n,e){return LN(n,"GET","arraybuffer",[],null,e)}function LN(n,e,t,i,r,o){const c=new XMLHttpRequest,s=new Promise((d,p)=>{c.open(e,n,!0);for(const g of i)c.setRequestHeader(g.name,g.value);c.responseType=t,c.timeout=15e3,c.onload=()=>{var g;if(c.status!==200){const _=(g=c.response)!==null&&g!==void 0?g:new cr(`Response status error: ${n}`);p(_)}c.response||p(new cr(`Response empty: ${n}`)),d(c.response)},c.onerror=()=>{p(new cr(`Request error: ${n}`))},c.ontimeout=()=>{p(new cr(`Request timeout: ${n}`))},c.onabort=()=>{p(new cr(`Request aborted: ${n}`))},c.send(e==="POST"?r:null)});return o&&o.catch(()=>{c.abort()}),s}function Hoe(n){const e=new Aoe(n),t={faces:[],vertices:[]};return e.readFields(Zoe,t)}function Zoe(n,e,t){n===1?e.vertices.push(t.readFloat()):n===2?e.faces.push(t.readVarint()):console.warn(`Unsupported pbf tag (${n})`)}class Xoe extends S1{constructor(e){super(),this._geometry=e}get geometry(){return this._geometry}fire(e,t){super.fire(e,t)}getCoreImages(e){return Promise.reject(new cr("Not implemented"))}getCluster(e,t){return Promise.reject(new cr("Not implemented"))}getSpatialImages(e){return Promise.reject(new cr("Not implemented"))}getImages(e){return Promise.reject(new cr("Not implemented"))}getImageBuffer(e,t){return Promise.reject(new cr("Not implemented"))}getImageTiles(e){return Promise.reject(new cr("Not implemented"))}getMesh(e,t){return Promise.reject(new cr("Not implemented"))}getSequence(e){return Promise.reject(new cr("Not implemented"))}off(e,t){super.off(e,t)}on(e,t){super.on(e,t)}setAccessToken(e){throw new cr("Not implemented")}}class Yoe{constructor(){}bboxToCellIds(e,t){throw new cr("Not implemented")}getAdjacent(e){throw new cr("Not implemented")}getVertices(e){throw new cr("Not implemented")}lngLatToCellId(e){throw new cr("Not implemented")}_approxBboxToCellIds(e,t){if(t.lat<=e.lat||t.lng<=e.lng)throw new cr("North east needs to be top right of south west");const i=(e.lat+t.lat)/2,r=(e.lng+t.lng)/2,o=ta(t.lng,t.lat,0,r,i,0),c=Math.max(o[0],o[1]);return this._lngLatToCellIds({lat:i,lng:r},c)}_enuToGeodetic(e,t){const[i,r]=_p(e[0],e[1],e[2],t.lng,t.lat,0);return{lat:r,lng:i}}_getLngLatBoundingBoxCorners(e,t){return[[-t,t,0],[t,t,0],[t,-t,0],[-t,-t,0]].map(i=>this._enuToGeodetic(i,e))}_lngLatToCellIds(e,t){const i=this.lngLatToCellId(e),r=this._getLngLatBoundingBoxCorners(e,t);for(const o of r)if(this.lngLatToCellId(o)!==i)return[i,...this.getAdjacent(i)];return[i]}}var lh={exports:{}},Yx={exports:{}};(function(n){(function(e,t){typeof gee=="function"&&n&&n.exports?n.exports=t():(e.dcodeIO=e.dcodeIO||{}).Long=t()})(qy,function(){function e(j,z,Q){this.low=j|0,this.high=z|0,this.unsigned=!!Q}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1});function t(j){return(j&&j.__isLong__)===!0}e.isLong=t;var i={},r={};function o(j,z){var Q,X,re;return z?(j>>>=0,(re=0<=j&&j<256)&&(X=r[j],X)?X:(Q=s(j,(j|0)<0?-1:0,!0),re&&(r[j]=Q),Q)):(j|=0,(re=-128<=j&&j<128)&&(X=i[j],X)?X:(Q=s(j,j<0?-1:0,!1),re&&(i[j]=Q),Q))}e.fromInt=o;function c(j,z){if(isNaN(j)||!isFinite(j))return z?C:E;if(z){if(j<0)return C;if(j>=S)return G}else{if(j<=-P)return N;if(j+1>=P)return q}return j<0?c(-j,z).neg():s(j%b|0,j/b|0,z)}e.fromNumber=c;function s(j,z,Q){return new e(j,z,Q)}e.fromBits=s;var d=Math.pow;function p(j,z,Q){if(j.length===0)throw Error("empty string");if(j==="NaN"||j==="Infinity"||j==="+Infinity"||j==="-Infinity")return E;if(typeof z=="number"?(Q=z,z=!1):z=!!z,Q=Q||10,Q<2||36<Q)throw RangeError("radix");var X;if((X=j.indexOf("-"))>0)throw Error("interior hyphen");if(X===0)return p(j.substring(1),z,Q).neg();for(var re=c(d(Q,8)),se=E,le=0;le<j.length;le+=8){var ce=Math.min(8,j.length-le),be=parseInt(j.substring(le,le+ce),Q);if(ce<8){var Ee=c(d(Q,ce));se=se.mul(Ee).add(c(be))}else se=se.mul(re),se=se.add(c(be))}return se.unsigned=z,se}e.fromString=p;function g(j){return j instanceof e?j:typeof j=="number"?c(j):typeof j=="string"?p(j):s(j.low,j.high,j.unsigned)}e.fromValue=g;var _=65536,x=1<<24,b=_*_,S=b*b,P=S/2,L=o(x),E=o(0);e.ZERO=E;var C=o(0,!0);e.UZERO=C;var D=o(1);e.ONE=D;var O=o(1,!0);e.UONE=O;var U=o(-1);e.NEG_ONE=U;var q=s(-1,2147483647,!1);e.MAX_VALUE=q;var G=s(-1,-1,!0);e.MAX_UNSIGNED_VALUE=G;var N=s(0,-2147483648,!1);e.MIN_VALUE=N;var V=e.prototype;return V.toInt=function(){return this.unsigned?this.low>>>0:this.low},V.toNumber=function(){return this.unsigned?(this.high>>>0)*b+(this.low>>>0):this.high*b+(this.low>>>0)},V.toString=function(z){if(z=z||10,z<2||36<z)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(N)){var Q=c(z),X=this.div(Q),re=X.mul(Q).sub(this);return X.toString(z)+re.toInt().toString(z)}else return"-"+this.neg().toString(z);for(var se=c(d(z,6),this.unsigned),le=this,ce="";;){var be=le.div(se),Ee=le.sub(be.mul(se)).toInt()>>>0,$e=Ee.toString(z);if(le=be,le.isZero())return $e+ce;for(;$e.length<6;)$e="0"+$e;ce=""+$e+ce}},V.getHighBits=function(){return this.high},V.getHighBitsUnsigned=function(){return this.high>>>0},V.getLowBits=function(){return this.low},V.getLowBitsUnsigned=function(){return this.low>>>0},V.getNumBitsAbs=function(){if(this.isNegative())return this.eq(N)?64:this.neg().getNumBitsAbs();for(var z=this.high!=0?this.high:this.low,Q=31;Q>0&&(z&1<<Q)==0;Q--);return this.high!=0?Q+33:Q+1},V.isZero=function(){return this.high===0&&this.low===0},V.isNegative=function(){return!this.unsigned&&this.high<0},V.isPositive=function(){return this.unsigned||this.high>=0},V.isOdd=function(){return(this.low&1)===1},V.isEven=function(){return(this.low&1)===0},V.equals=function(z){return t(z)||(z=g(z)),this.unsigned!==z.unsigned&&this.high>>>31===1&&z.high>>>31===1?!1:this.high===z.high&&this.low===z.low},V.eq=V.equals,V.notEquals=function(z){return!this.eq(z)},V.neq=V.notEquals,V.lessThan=function(z){return this.comp(z)<0},V.lt=V.lessThan,V.lessThanOrEqual=function(z){return this.comp(z)<=0},V.lte=V.lessThanOrEqual,V.greaterThan=function(z){return this.comp(z)>0},V.gt=V.greaterThan,V.greaterThanOrEqual=function(z){return this.comp(z)>=0},V.gte=V.greaterThanOrEqual,V.compare=function(z){if(t(z)||(z=g(z)),this.eq(z))return 0;var Q=this.isNegative(),X=z.isNegative();return Q&&!X?-1:!Q&&X?1:this.unsigned?z.high>>>0>this.high>>>0||z.high===this.high&&z.low>>>0>this.low>>>0?-1:1:this.sub(z).isNegative()?-1:1},V.comp=V.compare,V.negate=function(){return!this.unsigned&&this.eq(N)?N:this.not().add(D)},V.neg=V.negate,V.add=function(z){t(z)||(z=g(z));var Q=this.high>>>16,X=this.high&65535,re=this.low>>>16,se=this.low&65535,le=z.high>>>16,ce=z.high&65535,be=z.low>>>16,Ee=z.low&65535,$e=0,Ve=0,nt=0,He=0;return He+=se+Ee,nt+=He>>>16,He&=65535,nt+=re+be,Ve+=nt>>>16,nt&=65535,Ve+=X+ce,$e+=Ve>>>16,Ve&=65535,$e+=Q+le,$e&=65535,s(nt<<16|He,$e<<16|Ve,this.unsigned)},V.subtract=function(z){return t(z)||(z=g(z)),this.add(z.neg())},V.sub=V.subtract,V.multiply=function(z){if(this.isZero()||(t(z)||(z=g(z)),z.isZero()))return E;if(this.eq(N))return z.isOdd()?N:E;if(z.eq(N))return this.isOdd()?N:E;if(this.isNegative())return z.isNegative()?this.neg().mul(z.neg()):this.neg().mul(z).neg();if(z.isNegative())return this.mul(z.neg()).neg();if(this.lt(L)&&z.lt(L))return c(this.toNumber()*z.toNumber(),this.unsigned);var Q=this.high>>>16,X=this.high&65535,re=this.low>>>16,se=this.low&65535,le=z.high>>>16,ce=z.high&65535,be=z.low>>>16,Ee=z.low&65535,$e=0,Ve=0,nt=0,He=0;return He+=se*Ee,nt+=He>>>16,He&=65535,nt+=re*Ee,Ve+=nt>>>16,nt&=65535,nt+=se*be,Ve+=nt>>>16,nt&=65535,Ve+=X*Ee,$e+=Ve>>>16,Ve&=65535,Ve+=re*be,$e+=Ve>>>16,Ve&=65535,Ve+=se*ce,$e+=Ve>>>16,Ve&=65535,$e+=Q*Ee+X*be+re*ce+se*le,$e&=65535,s(nt<<16|He,$e<<16|Ve,this.unsigned)},V.mul=V.multiply,V.divide=function(z){if(t(z)||(z=g(z)),z.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?C:E;var Q,X,re;if(this.unsigned){if(z.unsigned||(z=z.toUnsigned()),z.gt(this))return C;if(z.gt(this.shru(1)))return O;re=C}else{if(this.eq(N)){if(z.eq(D)||z.eq(U))return N;if(z.eq(N))return D;var se=this.shr(1);return Q=se.div(z).shl(1),Q.eq(E)?z.isNegative()?D:U:(X=this.sub(z.mul(Q)),re=Q.add(X.div(z)),re)}else if(z.eq(N))return this.unsigned?C:E;if(this.isNegative())return z.isNegative()?this.neg().div(z.neg()):this.neg().div(z).neg();if(z.isNegative())return this.div(z.neg()).neg();re=E}for(X=this;X.gte(z);){Q=Math.max(1,Math.floor(X.toNumber()/z.toNumber()));for(var le=Math.ceil(Math.log(Q)/Math.LN2),ce=le<=48?1:d(2,le-48),be=c(Q),Ee=be.mul(z);Ee.isNegative()||Ee.gt(X);)Q-=ce,be=c(Q,this.unsigned),Ee=be.mul(z);be.isZero()&&(be=D),re=re.add(be),X=X.sub(Ee)}return re},V.div=V.divide,V.modulo=function(z){return t(z)||(z=g(z)),this.sub(this.div(z).mul(z))},V.mod=V.modulo,V.not=function(){return s(~this.low,~this.high,this.unsigned)},V.and=function(z){return t(z)||(z=g(z)),s(this.low&z.low,this.high&z.high,this.unsigned)},V.or=function(z){return t(z)||(z=g(z)),s(this.low|z.low,this.high|z.high,this.unsigned)},V.xor=function(z){return t(z)||(z=g(z)),s(this.low^z.low,this.high^z.high,this.unsigned)},V.shiftLeft=function(z){return t(z)&&(z=z.toInt()),(z&=63)===0?this:z<32?s(this.low<<z,this.high<<z|this.low>>>32-z,this.unsigned):s(0,this.low<<z-32,this.unsigned)},V.shl=V.shiftLeft,V.shiftRight=function(z){return t(z)&&(z=z.toInt()),(z&=63)===0?this:z<32?s(this.low>>>z|this.high<<32-z,this.high>>z,this.unsigned):s(this.high>>z-32,this.high>=0?0:-1,this.unsigned)},V.shr=V.shiftRight,V.shiftRightUnsigned=function(z){if(t(z)&&(z=z.toInt()),z&=63,z===0)return this;var Q=this.high;if(z<32){var X=this.low;return s(X>>>z|Q<<32-z,Q>>>z,this.unsigned)}else return z===32?s(Q,0,this.unsigned):s(Q>>>z-32,0,this.unsigned)},V.shru=V.shiftRightUnsigned,V.toSigned=function(){return this.unsigned?s(this.low,this.high,!1):this},V.toUnsigned=function(){return this.unsigned?this:s(this.low,this.high,!0)},V.toBytes=function(j){return j?this.toBytesLE():this.toBytesBE()},V.toBytesLE=function(){var j=this.high,z=this.low;return[z&255,z>>>8&255,z>>>16&255,z>>>24&255,j&255,j>>>8&255,j>>>16&255,j>>>24&255]},V.toBytesBE=function(){var j=this.high,z=this.low;return[j>>>24&255,j>>>16&255,j>>>8&255,j&255,z>>>24&255,z>>>16&255,z>>>8&255,z&255]},e})})(Yx);(function(n){(function(e){var t=e.S2={L:{}};t.L.LatLng=function(p,g,_){var x=parseFloat(p,10),b=parseFloat(g,10);if(isNaN(x)||isNaN(b))throw new Error("Invalid LatLng object: ("+p+", "+g+")");return _!==!0&&(x=Math.max(Math.min(x,90),-90),b=(b+180)%360+(b<-180||b===180?180:-180)),{lat:x,lng:b}},t.L.LatLng.DEG_TO_RAD=Math.PI/180,t.L.LatLng.RAD_TO_DEG=180/Math.PI,t.LatLngToXYZ=function(p){var g=t.L.LatLng.DEG_TO_RAD,_=p.lat*g,x=p.lng*g,b=Math.cos(_);return[Math.cos(x)*b,Math.sin(x)*b,Math.sin(_)]},t.XYZToLatLng=function(p){var g=t.L.LatLng.RAD_TO_DEG,_=Math.atan2(p[2],Math.sqrt(p[0]*p[0]+p[1]*p[1])),x=Math.atan2(p[1],p[0]);return t.L.LatLng(_*g,x*g)};var i=function(p){var g=[Math.abs(p[0]),Math.abs(p[1]),Math.abs(p[2])];return g[0]>g[1]?g[0]>g[2]?0:2:g[1]>g[2]?1:2},r=function(p,g){var _,x;switch(p){case 0:_=g[1]/g[0],x=g[2]/g[0];break;case 1:_=-g[0]/g[1],x=g[2]/g[1];break;case 2:_=-g[0]/g[2],x=-g[1]/g[2];break;case 3:_=g[2]/g[0],x=g[1]/g[0];break;case 4:_=g[2]/g[1],x=-g[0]/g[1];break;case 5:_=-g[1]/g[2],x=-g[0]/g[2];break;default:throw{error:"Invalid face"}}return[_,x]};t.XYZToFaceUV=function(p){var g=i(p);p[g]<0&&(g+=3);var _=r(g,p);return[g,_]},t.FaceUVToXYZ=function(p,g){var _=g[0],x=g[1];switch(p){case 0:return[1,_,x];case 1:return[-_,1,x];case 2:return[-_,-x,1];case 3:return[-1,-x,-_];case 4:return[x,-1,-_];case 5:return[x,_,-1];default:throw{error:"Invalid face"}}};var o=function(p){return p>=.5?1/3*(4*p*p-1):1/3*(1-4*(1-p)*(1-p))};t.STToUV=function(p){return[o(p[0]),o(p[1])]};var c=function(p){return p>=0?.5*Math.sqrt(1+3*p):1-.5*Math.sqrt(1-3*p)};t.UVToST=function(p){return[c(p[0]),c(p[1])]},t.STToIJ=function(p,g){var _=1<<g,x=function(b){var S=Math.floor(b*_);return Math.max(0,Math.min(_-1,S))};return[x(p[0]),x(p[1])]},t.IJToST=function(p,g,_){var x=1<<g;return[(p[0]+_[0])/x,(p[1]+_[1])/x]};var s=function(p,g,_,x){if(x==0){_==1&&(g.x=p-1-g.x,g.y=p-1-g.y);var b=g.x;g.x=g.y,g.y=b}},d=function(p,g,_,x){var b={a:[[0,"d"],[1,"a"],[3,"b"],[2,"a"]],b:[[2,"b"],[1,"b"],[3,"a"],[0,"c"]],c:[[2,"c"],[3,"d"],[1,"c"],[0,"b"]],d:[[0,"a"],[3,"c"],[1,"d"],[2,"d"]]};typeof x!="number"&&console.warn(new Error("called pointToHilbertQuadList without face value, defaulting to '0'").stack);for(var S=x%2?"d":"a",P=[],L=_-1;L>=0;L--){var E=1<<L,C=p&E?1:0,D=g&E?1:0,O=b[S][C*2+D];P.push(O[0]),S=O[1]}return P};t.S2Cell=function(){},t.S2Cell.FromHilbertQuadKey=function(p){var g=p.split("/"),_=parseInt(g[0]),x=g[1],b=x.length,S={x:0,y:0},P,L,E,C,D,O;for(P=b-1;P>=0;P--)L=b-P,E=x[P],C=0,D=0,E==="1"?D=1:E==="2"?(C=1,D=1):E==="3"&&(C=1),O=Math.pow(2,L-1),s(O,S,C,D),S.x+=O*C,S.y+=O*D;if(_%2===1){var U=S.x;S.x=S.y,S.y=U}return t.S2Cell.FromFaceIJ(parseInt(_),[S.x,S.y],L)},t.S2Cell.FromLatLng=function(p,g){if(!p.lat&&p.lat!==0||!p.lng&&p.lng!==0)throw new Error("Pass { lat: lat, lng: lng } to S2.S2Cell.FromLatLng");var _=t.LatLngToXYZ(p),x=t.XYZToFaceUV(_),b=t.UVToST(x[1]),S=t.STToIJ(b,g);return t.S2Cell.FromFaceIJ(x[0],S,g)},t.S2Cell.FromFaceIJ=function(p,g,_){var x=new t.S2Cell;return x.face=p,x.ij=g,x.level=_,x},t.S2Cell.prototype.toString=function(){return"F"+this.face+"ij["+this.ij[0]+","+this.ij[1]+"]@"+this.level},t.S2Cell.prototype.getLatLng=function(){var p=t.IJToST(this.ij,this.level,[.5,.5]),g=t.STToUV(p),_=t.FaceUVToXYZ(this.face,g);return t.XYZToLatLng(_)},t.S2Cell.prototype.getCornerLatLngs=function(){for(var p=[],g=[[0,0],[0,1],[1,1],[1,0]],_=0;_<4;_++){var x=t.IJToST(this.ij,this.level,g[_]),b=t.STToUV(x),S=t.FaceUVToXYZ(this.face,b);p.push(t.XYZToLatLng(S))}return p},t.S2Cell.prototype.getFaceAndQuads=function(){var p=d(this.ij[0],this.ij[1],this.level,this.face);return[this.face,p]},t.S2Cell.prototype.toHilbertQuadkey=function(){var p=d(this.ij[0],this.ij[1],this.level,this.face);return this.face.toString(10)+"/"+p.join("")},t.latLngToNeighborKeys=t.S2Cell.latLngToNeighborKeys=function(p,g,_){return t.S2Cell.FromLatLng({lat:p,lng:g},_).getNeighbors().map(function(x){return x.toHilbertQuadkey()})},t.S2Cell.prototype.getNeighbors=function(){var p=function(S,P,L){var E=1<<L;if(P[0]>=0&&P[1]>=0&&P[0]<E&&P[1]<E)return t.S2Cell.FromFaceIJ(S,P,L);var C=t.IJToST(P,L,[.5,.5]),D=t.STToUV(C),O=t.FaceUVToXYZ(S,D),U=t.XYZToFaceUV(O);return S=U[0],D=U[1],C=t.UVToST(D),P=t.STToIJ(C,L),t.S2Cell.FromFaceIJ(S,P,L)},g=this.face,_=this.ij[0],x=this.ij[1],b=this.level;return[p(g,[_-1,x],b),p(g,[_,x-1],b),p(g,[_+1,x],b),p(g,[_,x+1],b)]},t.FACE_BITS=3,t.MAX_LEVEL=30,t.POS_BITS=2*t.MAX_LEVEL+1,t.facePosLevelToId=t.S2Cell.facePosLevelToId=t.fromFacePosLevel=function(p,g,_){var x=e.dcodeIO&&e.dcodeIO.Long||Yx.exports,b,S,P;for(_||(_=g.length),g.length>_&&(g=g.substr(0,_)),b=x.fromString(p.toString(10),!0,10).toString(2);b.length<t.FACE_BITS;)b="0"+b;for(S=x.fromString(g,!0,4).toString(2);S.length<2*_;)S="0"+S;for(P=b+S,P+="1";P.length<t.FACE_BITS+t.POS_BITS;)P+="0";return x.fromString(P,!0,2).toString(10)},t.keyToId=t.S2Cell.keyToId=t.toId=t.toCellId=t.fromKey=function(p){var g=p.split("/");return t.fromFacePosLevel(g[0],g[1],g[1].length)},t.idToKey=t.S2Cell.idToKey=t.S2Cell.toKey=t.toKey=t.fromId=t.fromCellId=t.S2Cell.toHilbertQuadkey=t.toHilbertQuadkey=function(p){for(var g=e.dcodeIO&&e.dcodeIO.Long||Yx.exports,_=g.fromString(p,!0,10).toString(2);_.length<t.FACE_BITS+t.POS_BITS;)_="0"+_;for(var x=_.lastIndexOf("1"),b=_.substring(0,3),S=_.substring(3,x),P=S.length/2,L=g.fromString(b,!0,2).toString(10),E=g.fromString(S,!0,2).toString(4);E.length<P;)E="0"+E;return L+"/"+E},t.keyToLatLng=t.S2Cell.keyToLatLng=function(p){var g=t.S2Cell.FromHilbertQuadKey(p);return g.getLatLng()},t.idToLatLng=t.S2Cell.idToLatLng=function(p){var g=t.idToKey(p);return t.keyToLatLng(g)},t.S2Cell.latLngToKey=t.latLngToKey=t.latLngToQuadkey=function(p,g,_){if(isNaN(_)||_<1||_>30)throw new Error("'level' is not a number between 1 and 30 (but it should be)");return t.S2Cell.FromLatLng({lat:p,lng:g},_).toHilbertQuadkey()},t.stepKey=function(p,g){var _=e.dcodeIO&&e.dcodeIO.Long||Yx.exports,x=p.split("/"),b=x[0],S=x[1],P=x[1].length,L=_.fromString(S,!0,4),E;g>0?E=L.add(Math.abs(g)):g<0&&(E=L.subtract(Math.abs(g)));var C=E.toString(4);for(C==="0"&&console.warning(new Error("face/position wrapping is not yet supported"));C.length<P;)C="0"+C;return b+"/"+C},t.S2Cell.prevKey=t.prevKey=function(p){return t.stepKey(p,-1)},t.S2Cell.nextKey=t.nextKey=function(p){return t.stepKey(p,1)}})(n.exports)})(lh);class Koe extends Yoe{constructor(e=17){super(),this._level=e}bboxToCellIds(e,t){return this._approxBboxToCellIds(e,t)}getAdjacent(e){const t=lh.exports.S2.idToKey(e),r=t.split("/")[1].length,[o,c,s,d]=this._getNeighbors(t,r),p=[t,o,c,s,d],g=Array.from(new Set([...this._getNeighbors(o,r),...this._getNeighbors(c,r),...this._getNeighbors(s,r),...this._getNeighbors(d,r)].filter(x=>!p.includes(x)))),_=[o,c,s,d];for(const x of g){let b=0;for(const S of this._getNeighbors(x,r))p.includes(S)&&b++;b===2&&_.push(x)}return _.map(x=>lh.exports.S2.keyToId(x))}getVertices(e){const t=lh.exports.S2.idToKey(e);return lh.exports.S2.S2Cell.FromHilbertQuadKey(t).getCornerLatLngs().map(r=>({lat:r.lat,lng:r.lng}))}lngLatToCellId(e){return this._lngLatToId(e,this._level)}_getNeighbors(e,t){const i=lh.exports.S2.keyToLatLng(e);return lh.exports.S2.latLngToNeighborKeys(i.lat,i.lng,t)}_lngLatToId(e,t){const i=lh.exports.S2.latLngToKey(e.lat,e.lng,t);return lh.exports.S2.keyToId(i)}}function Joe(n){switch(n){case"equirectangular":case"spherical":return"spherical";case"fisheye":return"fisheye";default:return"perspective"}}class Qoe{clusterReconstruction(e){const i=e.points,r=1/255;for(const s in i){if(!i.hasOwnProperty(s))continue;const d=i[s].color;d[0]*=r,d[1]*=r,d[2]*=r}const o=e.reference_lla,c={alt:o.altitude,lat:o.latitude,lng:o.longitude};return{id:null,points:i,reference:c}}coreImage(e){const t=this._geometry(e.geometry),i=this._geometry(e.computed_geometry),r={id:e.sequence},o=e.id;return{computed_geometry:i,geometry:t,id:o,sequence:r}}spatialImage(e){var t,i,r,o,c;e.camera_type=Joe(e.camera_type),e.merge_id=e.merge_cc?e.merge_cc.toString():null,e.private=null;const s=e.camera_type==="spherical"?e.thumb_2048_url:e.thumb_1024_url;return e.thumb=(t=e.thumb)!==null&&t!==void 0?t:{id:null,url:s},e.cluster=(i=e.sfm_cluster)!==null&&i!==void 0?i:{id:null,url:null},e.creator=(r=e.creator)!==null&&r!==void 0?r:{id:null,username:null},e.owner=(o=e.organization)!==null&&o!==void 0?o:{id:null},e.mesh=(c=e.mesh)!==null&&c!==void 0?c:{id:null,url:null},e}_geometry(e){const t=e?.coordinates;return t?{lat:t[1],lng:t[0]}:null}}class eae{constructor(){this.imagesPath="images",this.sequencePath="image_ids",this._imageTilesPath="tiles",this.coreFields=["computed_geometry","geometry","sequence"],this.idFields=["id"],this.spatialFields=["altitude","atomic_scale","camera_parameters","camera_type","captured_at","compass_angle","computed_altitude","computed_compass_angle","computed_rotation","creator","exif_orientation","height","merge_cc","mesh","organization","quality_score","sfm_cluster","thumb_1024_url","thumb_2048_url","width"],this.imageTileFields=["url","z","x","y"]}images(e,t){return`image_ids=${e.join(",")}&fields=${t.join(",")}`}imagesS2(e,t){return`s2=${e}&fields=${t.join(",")}`}imageTiles(e,t){return`z=${e}&fields=${t.join(",")}`}imageTilesPath(e){return`${e}/${this._imageTilesPath}`}sequence(e){return`sequence_id=${e}`}}class tae extends Xoe{constructor(e,t,i,r){var o;super(t??new Koe),this._convert=i??new Qoe,this._query=r??new eae,this._method="GET";const c=e??{};this._endpoint=(o=c.endpoint)!==null&&o!==void 0?o:"https://graph.mapillary.com",this._accessToken=c.accessToken}getCluster(e,t){return wM(e,t).then(i=>{const r=Woe(i);if(r.length<1)throw new Error("Cluster reconstruction empty");return this._convert.clusterReconstruction(r[0])})}getCoreImages(e){const t=[...this._query.idFields,...this._query.coreFields],i=this._query.imagesS2(e,t),r=new URL(this._query.imagesPath,this._endpoint).href;return this._fetchGraphContract(i,r).then(o=>{const c={cell_id:e,images:[]},s=o.data;for(const d of s){const p=this._convert.coreImage(d);c.images.push(p)}return c})}getImageBuffer(e,t){return wM(e,t)}getImages(e){const t=[...this._query.idFields,...this._query.coreFields,...this._query.spatialFields],i=this._query.images(e,t),r=new URL(this._query.imagesPath,this._endpoint).href;return this._fetchGraphContract(i,r).then(o=>{const c=[],s=o.data;for(const d of s){const p=this._convert.coreImage(d),g=this._convert.spatialImage(d),x={node:Object.assign({},g,p),node_id:d.id};c.push(x)}return c})}getImageTiles(e){const t=[...this._query.imageTileFields],i=this._query.imageTiles(e.z,t),r=new URL(this._query.imageTilesPath(e.imageId),this._endpoint).href;return this._fetchGraphContract(i,r).then(o=>({node:o.data,node_id:e.imageId}))}getMesh(e,t){return wM(e,t).then(i=>Hoe(i))}getSequence(e){const t=this._query.sequence(e),i=new URL(this._query.sequencePath,this._endpoint).href;return this._fetchGraphContract(t,i).then(r=>({id:e,image_ids:r.data.map(c=>c.id)}))}getSpatialImages(e){const t=[...this._query.idFields,...this._query.coreFields,...this._query.spatialFields],i=this._query.images(e,t),r=new URL(this._query.imagesPath,this._endpoint).href;return this._fetchGraphContract(i,r).then(o=>{const c=[],s=o.data;for(const d of s){const g={node:this._convert.spatialImage(d),node_id:d.id};c.push(g)}return c})}setAccessToken(e){this._accessToken=e}_createHeaders(){const e=[{name:"Accept",value:"application/json"},{name:"Content-Type",value:"application/x-www-form-urlencoded"}];return this._accessToken&&e.push({name:"Authorization",value:`OAuth ${this._accessToken}`}),e}_fetchGraphContract(e,t){const i=this._method,r=this._createHeaders(),o=`${t}?${e}`;return LN(o,i,"json",r,null,null).catch(c=>{const s=this._makeErrorMessage(c);throw new cr(s)})}_makeErrorMessage(e){const t=e.error;return t?`${t.code} (${t.type}, ${t.fbtrace_id}): ${t.message}`:"Failed to fetch data"}}var xh;(function(n){n[n.Custom=0]="Custom",n[n.Earth=1]="Earth",n[n.Street=2]="Street"})(xh||(xh={}));var e_;(function(n){n[n.Letterbox=0]="Letterbox",n[n.Fill=1]="Fill"})(e_||(e_={}));var _k;(function(n){n[n.Opaque=0]="Opaque"})(_k||(_k={}));var Vw;(function(n){n[n.Default=0]="Default",n[n.Instantaneous=1]="Instantaneous"})(Vw||(Vw={}));class iae{constructor(e,t,i,r,o,c){this._container=e,this._observer=i,this._navigator=t,this._options=o??{},this._key=r,this._navigable=r==null,this._componentService=c||new Mr(this._container,this._navigator),this._coverComponent=this._componentService.getCover(),this._initializeComponents(),r?(this._initilizeCoverComponent(),this._subscribeCoverComponent()):this._navigator.movedToId$.pipe(wi(s=>s!=null)).subscribe(s=>{this._key=s,this._componentService.deactivateCover(),this._coverComponent.configure({id:this._key,state:Qo.Hidden}),this._subscribeCoverComponent(),this._navigator.stateService.start(),this._navigator.cacheService.start(),this._navigator.panService.start(),this._observer.startEmit()})}get navigable(){return this._navigable}get(e){return this._componentService.get(e)}activate(e){this._componentService.activate(e)}activateCover(){this._coverComponent.configure({state:Qo.Visible})}deactivate(e){this._componentService.deactivate(e)}deactivateCover(){this._coverComponent.configure({state:Qo.Loading})}remove(){this._componentService.remove(),this._configurationSubscription!=null&&this._configurationSubscription.unsubscribe()}_initializeComponents(){var e,t;const i=this._options;this._uFalse((e=i.fallback)===null||e===void 0?void 0:e.image,"imagefallback"),this._uFalse((t=i.fallback)===null||t===void 0?void 0:t.navigation,"navigationfallback"),this._uFalse(i.marker,"marker"),this._uFalse(i.popup,"popup"),this._uFalse(i.slider,"slider"),this._uFalse(i.spatial,"spatial"),this._uFalse(i.tag,"tag"),this._uTrue(i.attribution,"attribution"),this._uTrue(i.bearing,"bearing"),this._uTrue(i.cache,"cache"),this._uTrue(i.direction,"direction"),this._uTrue(i.image,"image"),this._uTrue(i.keyboard,"keyboard"),this._uTrue(i.pointer,"pointer"),this._uTrue(i.sequence,"sequence"),this._uTrue(i.zoom,"zoom")}_initilizeCoverComponent(){let e=this._options;this._coverComponent.configure({id:this._key}),e.cover===void 0||e.cover?this.activateCover():this.deactivateCover()}_setNavigable(e){this._navigable!==e&&(this._navigable=e,this._observer.navigable$.next(e))}_subscribeCoverComponent(){this._configurationSubscription=this._coverComponent.configuration$.pipe(yi(void 0,e=>e.state)).subscribe(e=>{e.state===Qo.Loading?this._navigator.stateService.currentId$.pipe(wi(),ei(t=>{const i=t==null||t!==e.id;return i&&this._setNavigable(!1),i?this._navigator.moveTo$(e.id):this._navigator.stateService.currentImage$.pipe(wi())})).subscribe(()=>{this._navigator.stateService.start(),this._navigator.cacheService.start(),this._navigator.panService.start(),this._observer.startEmit(),this._coverComponent.configure({state:Qo.Hidden}),this._componentService.deactivateCover(),this._setNavigable(!0)},t=>{console.error("Failed to deactivate cover.",t),this._coverComponent.configure({state:Qo.Visible})}):e.state===Qo.Visible&&(this._observer.stopEmit(),this._navigator.stateService.stop(),this._navigator.cacheService.stop(),this._navigator.playService.stop(),this._navigator.panService.stop(),this._componentService.activateCover(),this._setNavigable(e.id==null))})}_uFalse(e,t){if(e===void 0){this._componentService.deactivate(t);return}if(typeof e=="boolean"){e?this._componentService.activate(t):this._componentService.deactivate(t);return}this._componentService.configure(t,e),this._componentService.activate(t)}_uTrue(e,t){if(e===void 0){this._componentService.activate(t);return}if(typeof e=="boolean"){e?this._componentService.activate(t):this._componentService.deactivate(t);return}this._componentService.configure(t,e),this._componentService.activate(t)}}class nae{constructor(e,t,i){this._adaptiveOperation$=new ri,this._render$=new ri,this._renderAdaptive$=new ri,this._subscriptions=new yo,this._renderService=t,this._currentFrame$=i;const r=this._subscriptions,o=Gt.create(Gt.h("div.mapillary-dom-renderer",[]));e.appendChild(o),this._offset$=this._adaptiveOperation$.pipe(Vr((d,p)=>p(d),{elementHeight:e.offsetHeight,elementWidth:e.offsetWidth,imageAspect:0,renderMode:e_.Fill}),oi(d=>d.imageAspect>0&&d.elementWidth>0&&d.elementHeight>0),it(d=>{const p=d.elementWidth/d.elementHeight,g=d.imageAspect/p;let _=0,x=0;return d.renderMode===e_.Letterbox?d.imageAspect>p?_=d.elementHeight*(1-1/g)/2:x=d.elementWidth*(1-g)/2:d.imageAspect>p?x=-d.elementWidth*(g-1)/2:_=-d.elementHeight*(1/g-1)/2,{bottom:_,left:x,right:x,top:_}}));const c=this._currentFrame$.pipe(oi(d=>d.state.currentImage!=null),yi((d,p)=>d===p,d=>d.state.currentImage.id),it(d=>d.state.currentTransform.basicAspect),it(d=>p=>(p.imageAspect=d,p))).subscribe(this._adaptiveOperation$),s=Si(this._renderAdaptive$.pipe(Vr((d,p)=>(p.vNode==null?delete d[p.name]:d[p.name]=p.vNode,d),{})),this._offset$).pipe(it(d=>{const p=[],g=d[0];for(const b in g)g.hasOwnProperty(b)&&p.push(g[b]);const _=d[1],x={style:{bottom:_.bottom+"px",left:_.left+"px","pointer-events":"none",position:"absolute",right:_.right+"px",top:_.top+"px"}};return{name:"mapillary-dom-adaptive-renderer",vNode:Gt.h("div.mapillary-dom-adaptive-renderer",x,p)}})).subscribe(this._render$);this._vNode$=this._render$.pipe(Vr((d,p)=>(p.vNode==null?delete d[p.name]:d[p.name]=p.vNode,d),{}),it(d=>{const p=[];for(const g in d)d.hasOwnProperty(g)&&p.push(d[g]);return Gt.h("div.mapillary-dom-renderer",p)})),this._vPatch$=this._vNode$.pipe(Vr((d,p)=>(d.vpatch=Gt.diff(d.vNode,p),d.vNode=p,d),{vNode:Gt.h("div.mapillary-dom-renderer",[]),vpatch:null}),UW("vpatch")),this._element$=this._vPatch$.pipe(Vr((d,p)=>Gt.patch(d,p),o),Pi(1),gi()),r.push(c),r.push(s),r.push(this._element$.subscribe(()=>{})),r.push(this._renderService.size$.pipe(it(d=>p=>(p.elementWidth=d.width,p.elementHeight=d.height,p))).subscribe(this._adaptiveOperation$)),r.push(this._renderService.renderMode$.pipe(it(d=>p=>(p.renderMode=d,p))).subscribe(this._adaptiveOperation$))}get element$(){return this._element$}get render$(){return this._render$}get renderAdaptive$(){return this._renderAdaptive$}clear(e){this._renderAdaptive$.next({name:e,vNode:null}),this._render$.next({name:e,vNode:null})}remove(){this._subscriptions.unsubscribe()}}class rae{constructor(e,t,i){this._renderFrame$=new ri,this._renderCameraOperation$=new ri,this._render$=new ri,this._clear$=new ri,this._renderOperation$=new ri,this._rendererOperation$=new ri,this._eraserOperation$=new ri,this._triggerOperation$=new ri,this._subscriptions=new yo,this._opaqueRender$=new ri,this._renderService=i;const r=this._subscriptions;this._renderer$=this._rendererOperation$.pipe(Vr((S,P)=>P(S),{needsRender:!1,renderer:null}),oi(S=>!!S.renderer)),this._renderCollection$=this._renderOperation$.pipe(Vr((S,P)=>P(S),{}),dn()),this._renderCamera$=this._renderCameraOperation$.pipe(Vr((S,P)=>P(S),{frameId:-1,needsRender:!1,perspective:null})),this._eraser$=this._eraserOperation$.pipe(An(S=>S),Vr((S,P)=>P(S),{needsRender:!1}));const o=this._triggerOperation$.pipe(An(S=>S),Vr((S,P)=>P(S),{needsRender:!1})),c=new Bi(986895),s=Si(this._renderer$,this._renderCollection$,this._renderCamera$,this._eraser$,o).pipe(it(([S,P,L,E,C])=>{const D=Object.keys(P).map(O=>P[O]);return{camera:L,eraser:E,trigger:C,renderer:S,renders:D}}),oi(S=>{let P=S.renderer.needsRender||S.camera.needsRender||S.eraser.needsRender||S.trigger.needsRender;const L=S.camera.frameId;for(const E of S.renders){if(E.frameId!==L)return!1;P=P||E.needsRender}return P}),yi((S,P)=>S===P,S=>S.eraser.needsRender||S.trigger.needsRender?-S.camera.frameId:S.camera.frameId)).subscribe(S=>{S.renderer.needsRender=!1,S.camera.needsRender=!1,S.eraser.needsRender=!1,S.trigger.needsRender=!1;const P=S.camera.perspective,L=[],E=[];for(const D of S.renders)D.pass===Ih.Background?L.push(D.render):D.pass===Ih.Opaque&&E.push(D.render);const C=S.renderer.renderer;C.resetState(),C.setClearColor(c,1),C.clear();for(const D of L)D(P,C);C.clearDepth();for(const D of E)D(P,C);C.resetState(),this._opaqueRender$.next()});r.push(s),r.push(this._renderFrame$.pipe(it(S=>P=>(P.frameId=S.frameId,P.perspective=S.perspective,S.changed===!0&&(P.needsRender=!0),P))).subscribe(this._renderCameraOperation$)),this._renderFrameSubscribe();const d=this._render$.pipe(it(S=>P=>(P[S.name]=S.renderer,P))),p=this._clear$.pipe(it(S=>P=>(delete P[S],P)));r.push(fn(d,p).subscribe(this._renderOperation$)),this._webGLRenderer$=this._render$.pipe(wi(),it(()=>{t.appendChild(e);const S=i.element,P=new hr({canvas:e});return P.setPixelRatio(window.devicePixelRatio),P.setSize(S.offsetWidth,S.offsetHeight),P.autoClear=!1,P}),Pi(1),gi()),r.push(this._webGLRenderer$.subscribe(()=>{}));const g=this._webGLRenderer$.pipe(wi(),it(S=>P=>(P.needsRender=!0,P.renderer=S,P))),_=this._renderService.size$.pipe(it(S=>P=>(P.renderer==null||(P.renderer.setSize(S.width,S.height),P.needsRender=!0),P))),x=this._clear$.pipe(it(()=>S=>(S.renderer==null||(S.needsRender=!0),S)));r.push(fn(g,_,x).subscribe(this._rendererOperation$));const b=this._renderCollection$.pipe(oi(S=>Object.keys(S).length===0),dn());r.push(b.subscribe(()=>{this._renderFrameSubscription!=null&&(this._renderFrameSubscription.unsubscribe(),this._renderFrameSubscription=null,this._renderFrameSubscribe())})),r.push(b.pipe(it(()=>S=>(S.needsRender=!0,S))).subscribe(this._eraserOperation$))}get render$(){return this._render$}get opaqueRender$(){return this._opaqueRender$}get webGLRenderer$(){return this._webGLRenderer$}clear(e){this._clear$.next(e)}remove(){this._rendererOperation$.next(e=>{if(e.renderer!=null){const t=e.renderer.getContext().getExtension("WEBGL_lose_context");t&&t.loseContext(),e.renderer=null}return e}),this._renderFrameSubscription!=null&&this._renderFrameSubscription.unsubscribe(),this._subscriptions.unsubscribe()}triggerRerender(){this._renderService.renderCameraFrame$.pipe(Ys(1),wi()).subscribe(()=>{this._triggerOperation$.next(e=>(e.needsRender=!0,e))})}_renderFrameSubscribe(){this._render$.pipe(wi(),it(()=>e=>(e.needsRender=!0,e))).subscribe(e=>{this._renderCameraOperation$.next(e)}),this._renderFrameSubscription=this._render$.pipe(wi(),Hi(()=>this._renderService.renderCameraFrame$)).subscribe(this._renderFrame$)}}class Md{constructor(e){e!=null?(this._position=new Ue().fromArray(e.unprojectSfM([0,0],0)),this._lookat=new Ue().fromArray(e.unprojectSfM([0,0],10)),this._up=e.upVector(),this._focal=this._getFocal(e)):(this._position=new Ue(0,0,0),this._lookat=new Ue(1,0,0),this._up=new Ue(0,0,1),this._focal=1)}get position(){return this._position}get lookat(){return this._lookat}get up(){return this._up}get focal(){return this._focal}set focal(e){this._focal=e}lerpCameras(e,t,i){this._position.subVectors(t.position,e.position).multiplyScalar(i).add(e.position),this._lookat.subVectors(t.lookat,e.lookat).multiplyScalar(i).add(e.lookat),this._up.subVectors(t.up,e.up).multiplyScalar(i).add(e.up),this._focal=(1-i)*e.focal+i*t.focal}copy(e){this._position.copy(e.position),this._lookat.copy(e.lookat),this._up.copy(e.up),this._focal=e.focal}clone(){let e=new Md;return e.position.copy(this._position),e.lookat.copy(this._lookat),e.up.copy(this._up),e.focal=this._focal,e}diff(e){let t=this._position.distanceToSquared(e.position),i=this._lookat.distanceToSquared(e.lookat),r=this._up.distanceToSquared(e.up),o=100*Math.abs(this._focal-e.focal);return Math.max(t,i,r,o)}_getFocal(e){return ki(e.cameraType)?.5/Math.tan(Math.PI/2):e.focal}}class sae{constructor(e,t,i){this._spatial=new vo,this._viewportCoords=new zo,this._size={width:e,height:t},this._initialFov=60,this._alpha=-1,this._stateTransitionAlpha=-1,this._stateTransitionFov=-1,this._renderMode=i,this._zoom=0,this._frameId=-1,this._changed=!1,this._changedForFrame=-1,this._currentImageId=null,this._previousImageId=null,this._currentSpherical=!1,this._previousSpherical=!1,this._state=null,this._currentProjectedPoints=[],this._previousProjectedPoints=[],this._currentFov=this._initialFov,this._previousFov=this._initialFov,this._camera=new Md,this._perspective=new ea(this._initialFov,this._computeAspect(e,t),.1,1e4),this._perspective.position.copy(this._camera.position),this._perspective.up.copy(this._camera.up),this._perspective.lookAt(this._camera.lookat),this._perspective.updateMatrixWorld(!0),this._perspective.matrixAutoUpdate=!1,this._rotation={phi:0,theta:0}}get alpha(){return this._alpha}get camera(){return this._camera}get changed(){return this._frameId===this._changedForFrame}get frameId(){return this._frameId}get perspective(){return this._perspective}get renderMode(){return this._renderMode}get rotation(){return this._rotation}get zoom(){return this._zoom}get size(){return this._size}getTilt(){return 90-this._spatial.radToDeg(this._rotation.theta)}fovToZoom(e){e=Math.min(90,Math.max(0,e));const t=this._computeCurrentFov(0),i=this._alpha===1?t:this._interpolateFov(t,this._computePreviousFov(0),this._alpha),r=Math.tan(i/2*Math.PI/180),o=Math.tan(e/2*Math.PI/180);return Math.log(r/o)/Math.log(2)}setFrame(e){const t=e.state;if(t.state!==this._state){if(this._state=t.state,this._state!==Oi.Custom&&(this.setRenderMode(this._renderMode),this.setSize(this._size)),this._state===Oi.Earth){const p=this._fovToY(this._perspective.fov,this._zoom);this._stateTransitionFov=this._yToFov(p,0)}this._changed=!0}const i=t.currentImage.id,r=t.previousImage?t.previousImage.id:null;i!==this._currentImageId&&(this._currentImageId=i,this._currentSpherical=ki(t.currentTransform.cameraType),this._currentProjectedPoints=this._computeProjectedPoints(t.currentTransform),this._changed=!0),r!==this._previousImageId&&(this._previousImageId=r,this._previousSpherical=ki(t.previousTransform.cameraType),this._previousProjectedPoints=this._computeProjectedPoints(t.previousTransform),this._changed=!0);const o=t.zoom;o!==this._zoom&&(this._changed=!0),this._changed&&(this._currentFov=this._computeCurrentFov(o),this._previousFov=this._computePreviousFov(o));const c=t.alpha,s=t.stateTransitionAlpha;if(this._changed||c!==this._alpha||s!==this._stateTransitionAlpha){switch(this._alpha=c,this._stateTransitionAlpha=s,this._state){case Oi.Earth:{const p=this._stateTransitionFov,g=this._focalToFov(t.camera.focal),_=Hg.lerp(p,g,s),x=this._fovToY(_,0);this._perspective.fov=this._yToFov(x,o);break}case Oi.Custom:break;default:this._perspective.fov=this._interpolateFov(this._currentFov,this._previousFov,this._alpha),this._changed=!0;break}this._zoom=o,this._state!==Oi.Custom&&this._perspective.updateProjectionMatrix()}const d=t.camera;this._camera.diff(d)>1e-9&&(this._camera.copy(d),this._rotation=this._computeRotation(d),this._perspective.up.copy(d.up),this._perspective.position.copy(d.position),this._perspective.matrixAutoUpdate=!0,this._perspective.lookAt(d.lookat),this._perspective.matrixAutoUpdate=!1,this._perspective.updateMatrix(),this._perspective.updateMatrixWorld(!1),this._changed=!0),this._setFrameId(e.id)}setProjectionMatrix(e){this._perspective.fov=this._focalToFov(e[5]/2),this._perspective.projectionMatrix.fromArray(e),this._perspective.projectionMatrixInverse.copy(this._perspective.projectionMatrix).invert(),this._changed=!0}setRenderMode(e){this._renderMode=e,this._state!==Oi.Custom&&(this._perspective.fov=this._computeFov(),this._perspective.updateProjectionMatrix(),this._changed=!0)}setSize(e){this._size=e,this._state!==Oi.Custom&&(this._perspective.aspect=this._computeAspect(e.width,e.height),this._perspective.fov=this._computeFov(),this._perspective.updateProjectionMatrix(),this._changed=!0)}_computeAspect(e,t){return e===0?0:e/t}_computeCurrentFov(e){return this._perspective.aspect===0?0:this._currentImageId?this._currentSpherical?this._yToFov(1,e):this._computeVerticalFov(this._currentProjectedPoints,this._renderMode,e,this.perspective.aspect):this._initialFov}_computeFov(){return this._currentFov=this._computeCurrentFov(this._zoom),this._previousFov=this._computePreviousFov(this._zoom),this._interpolateFov(this._currentFov,this._previousFov,this._alpha)}_computePreviousFov(e){return this._perspective.aspect===0?0:this._currentImageId?this._previousImageId?this._previousSpherical?this._yToFov(1,e):this._computeVerticalFov(this._previousProjectedPoints,this._renderMode,e,this.perspective.aspect):this._currentFov:this._initialFov}_computeProjectedPoints(e){return ZC(e,[[.5,0],[1,0]],[[.5,0],[0,.5]],100,this._viewportCoords)}_computeRequiredVerticalFov(e,t,i){const r=Math.max(e[0]/i,e[1]);return this._yToFov(r,t)}_computeRotation(e){let t=e.lookat.clone().sub(e.position),i=e.up.clone(),r=this._spatial.azimuthal(t.toArray(),i.toArray()),o=Math.PI/2-this._spatial.angleToPlane(t.toArray(),[0,0,1]);return{phi:r,theta:o}}_computeVerticalFov(e,t,i,r){const o=e.map(s=>this._computeRequiredVerticalFov(s,i,r));return t===e_.Fill?Math.min(...o)*.995:Math.max(...o)}_yToFov(e,t){return 2*Math.atan(e/Math.pow(2,t))*180/Math.PI}_focalToFov(e){return 2*Math.atan2(1,2*e)*180/Math.PI}_fovToY(e,t){return Math.pow(2,t)*Math.tan(Math.PI*e/360)}_interpolateFov(e,t,i){return i*e+(1-i)*t}_setFrameId(e){this._frameId=e,this._changed&&(this._changed=!1,this._changedForFrame=e)}}class oae{constructor(e,t,i,r){this._subscriptions=new yo,this._element=e,this._currentFrame$=t,this._spatial=new vo,i=i??e_.Fill,this._resize$=new ri,this._projectionMatrix$=new ri,this._renderCameraOperation$=new ri,this._size$=new Ah({height:this._element.offsetHeight,width:this._element.offsetWidth});const o=this._subscriptions;o.push(this._resize$.pipe(it(()=>({height:this._element.offsetHeight,width:this._element.offsetWidth}))).subscribe(this._size$)),this._renderMode$=new Ah(i),this._renderCameraHolder$=this._renderCameraOperation$.pipe(An(c=>c),Vr((c,s)=>s(c),r??new sae(this._element.offsetWidth,this._element.offsetHeight,i)),Pi(1),gi()),this._renderCameraFrame$=this._currentFrame$.pipe(Ui(this._renderCameraHolder$),Dr(([c,s])=>{s.setFrame(c)}),it(c=>c[1]),Pi(1),gi()),this._renderCamera$=this._renderCameraFrame$.pipe(oi(c=>c.changed),Pi(1),gi()),this._bearing$=this._renderCamera$.pipe(it(c=>{let s=this._spatial.radToDeg(this._spatial.azimuthalToBearing(c.rotation.phi));return this._spatial.wrap(s,0,360)}),Pi(1),gi()),o.push(this._size$.pipe(Ys(1),it(c=>s=>(s.setSize(c),s))).subscribe(this._renderCameraOperation$)),o.push(this._renderMode$.pipe(Ys(1),it(c=>s=>(s.setRenderMode(c),s))).subscribe(this._renderCameraOperation$)),o.push(this._projectionMatrix$.pipe(it(c=>s=>(s.setProjectionMatrix(c),s))).subscribe(this._renderCameraOperation$)),o.push(this._bearing$.subscribe(()=>{})),o.push(this._renderCameraHolder$.subscribe(()=>{})),o.push(this._size$.subscribe(()=>{})),o.push(this._renderMode$.subscribe(()=>{})),o.push(this._renderCamera$.subscribe(()=>{})),o.push(this._renderCameraFrame$.subscribe(()=>{}))}get bearing$(){return this._bearing$}get element(){return this._element}get projectionMatrix$(){return this._projectionMatrix$}get renderCamera$(){return this._renderCamera$}get renderCameraFrame$(){return this._renderCameraFrame$}get renderMode$(){return this._renderMode$}get resize$(){return this._resize$}get size$(){return this._size$}dispose(){this._subscriptions.unsubscribe()}}class aae{constructor(e){this._keyDown$=Tr(e,"keydown"),this._keyUp$=Tr(e,"keyup")}get keyDown$(){return this._keyDown$}get keyUp$(){return this._keyUp$}}const mg=0,ey=2,lae={[mg]:1,[ey]:2};class cae{constructor(e,t,i,r){this._subscriptions=new yo;const o=this._subscriptions;this._activeSubject$=new Ah(!1),this._active$=this._activeSubject$.pipe(yi(),Pi(1),gi()),this._claimMouse$=new ri,this._claimWheel$=new ri,this._deferPixelClaims$=new ri,this._deferPixels$=this._deferPixelClaims$.pipe(Vr((_,x)=>(x.deferPixels==null?delete _[x.name]:_[x.name]=x.deferPixels,_),{}),it(_=>{let x=-1;for(const b in _){if(!_.hasOwnProperty(b))continue;const S=_[b];S>x&&(x=S)}return x}),An(-1),Pi(1),gi()),o.push(this._deferPixels$.subscribe(()=>{})),this._documentMouseMove$=Tr(r,"pointermove").pipe(oi(this._isMousePen)),this._documentMouseUp$=Tr(r,"pointerup").pipe(oi(this._isMousePen)),this._mouseDown$=Tr(t,"pointerdown").pipe(oi(this._isMousePen)),this._mouseEnter$=Tr(t,"pointerenter").pipe(oi(this._isMousePen)),this._mouseLeave$=Tr(t,"pointerleave").pipe(oi(this._isMousePen)),this._mouseMove$=Tr(t,"pointermove").pipe(oi(this._isMousePen)),this._mouseUp$=Tr(t,"pointerup").pipe(oi(this._isMousePen)),this._mouseOut$=Tr(t,"pointerout").pipe(oi(this._isMousePen)),this._mouseOver$=Tr(t,"pointerover").pipe(oi(this._isMousePen)),this._domMouseDown$=Tr(i,"pointerdown").pipe(oi(this._isMousePen)),this._domMouseMove$=Tr(i,"pointermove").pipe(oi(this._isMousePen)),this._click$=Tr(t,"click"),this._contextMenu$=Tr(t,"contextmenu"),this._windowBlur$=Tr(window,"blur"),this._dblClick$=fn(Tr(e,"click"),Tr(t,"dblclick")).pipe(xw(3,1),oi(_=>{const x=_[0],b=_[1],S=_[2];return x.type==="click"&&b.type==="click"&&S.type==="dblclick"&&x.target.parentNode===t&&b.target.parentNode===t}),it(_=>_[2]),dn()),o.push(fn(this._domMouseDown$,this._domMouseMove$,this._dblClick$,this._contextMenu$).subscribe(_=>{_.preventDefault()})),this._mouseWheel$=fn(Tr(t,"wheel"),Tr(i,"wheel")).pipe(dn()),this._consistentContextMenu$=fn(this._mouseDown$,this._mouseMove$,this._mouseOut$,this._mouseUp$,this._contextMenu$).pipe(xw(3,1),oi(_=>_[0].type==="pointerdown"&&_[1].type==="contextmenu"&&_[2].type==="pointerup"),it(_=>_[1]),dn());const c=fn(this._windowBlur$,this._documentMouseMove$.pipe(oi(_=>this._buttonReleased(_,mg))),this._documentMouseUp$.pipe(oi(_=>this._mouseButton(_)===mg))).pipe(dn()),s=this._createMouseDragInitiate$(mg,this._mouseDown$,c,!0).pipe(dn());this._mouseDragStart$=this._createMouseDragStart$(s).pipe(dn()),this._mouseDrag$=this._createMouseDrag$(s,c).pipe(dn()),this._mouseDragEnd$=this._createMouseDragEnd$(this._mouseDragStart$,c).pipe(dn());const d=this._createMouseDragInitiate$(mg,this._domMouseDown$,c,!1).pipe(dn());this._domMouseDragStart$=this._createMouseDragStart$(d).pipe(dn()),this._domMouseDrag$=this._createMouseDrag$(d,c).pipe(dn()),this._domMouseDragEnd$=this._createMouseDragEnd$(this._domMouseDragStart$,c).pipe(dn());const p=fn(this._windowBlur$,this._documentMouseMove$.pipe(oi(_=>this._buttonReleased(_,ey))),this._documentMouseUp$.pipe(oi(_=>this._mouseButton(_)===ey))).pipe(dn()),g=this._createMouseDragInitiate$(ey,this._mouseDown$,p,!0).pipe(dn());this._mouseRightDragStart$=this._createMouseDragStart$(g).pipe(dn()),this._mouseRightDrag$=this._createMouseDrag$(g,p).pipe(dn()),this._mouseRightDragEnd$=this._createMouseDragEnd$(this._mouseRightDragStart$,p).pipe(dn()),this._proximateClick$=this._mouseDown$.pipe(ei(_=>this._click$.pipe(Td(this._createDeferredMouseMove$(_,this._documentMouseMove$)),$l(1))),dn()),this._staticClick$=this._mouseDown$.pipe(ei(()=>this._click$.pipe(Td(this._documentMouseMove$),$l(1))),dn()),o.push(this._mouseDragStart$.subscribe()),o.push(this._mouseDrag$.subscribe()),o.push(this._mouseDragEnd$.subscribe()),o.push(this._domMouseDragStart$.subscribe()),o.push(this._domMouseDrag$.subscribe()),o.push(this._domMouseDragEnd$.subscribe()),o.push(this._mouseRightDragStart$.subscribe()),o.push(this._mouseRightDrag$.subscribe()),o.push(this._mouseRightDragEnd$.subscribe()),o.push(this._staticClick$.subscribe()),this._mouseOwner$=this._createOwner$(this._claimMouse$).pipe(Pi(1),gi()),this._wheelOwner$=this._createOwner$(this._claimWheel$).pipe(Pi(1),gi()),o.push(this._mouseOwner$.subscribe(()=>{})),o.push(this._wheelOwner$.subscribe(()=>{}))}get active$(){return this._active$}get activate$(){return this._activeSubject$}get documentMouseMove$(){return this._documentMouseMove$}get documentMouseUp$(){return this._documentMouseUp$}get domMouseDragStart$(){return this._domMouseDragStart$}get domMouseDrag$(){return this._domMouseDrag$}get domMouseDragEnd$(){return this._domMouseDragEnd$}get domMouseDown$(){return this._domMouseDown$}get domMouseMove$(){return this._domMouseMove$}get mouseOwner$(){return this._mouseOwner$}get mouseDown$(){return this._mouseDown$}get mouseEnter$(){return this._mouseEnter$}get mouseMove$(){return this._mouseMove$}get mouseLeave$(){return this._mouseLeave$}get mouseOut$(){return this._mouseOut$}get mouseOver$(){return this._mouseOver$}get mouseUp$(){return this._mouseUp$}get click$(){return this._click$}get dblClick$(){return this._dblClick$}get contextMenu$(){return this._consistentContextMenu$}get mouseWheel$(){return this._mouseWheel$}get mouseDragStart$(){return this._mouseDragStart$}get mouseDrag$(){return this._mouseDrag$}get mouseDragEnd$(){return this._mouseDragEnd$}get mouseRightDragStart$(){return this._mouseRightDragStart$}get mouseRightDrag$(){return this._mouseRightDrag$}get mouseRightDragEnd$(){return this._mouseRightDragEnd$}get proximateClick$(){return this._proximateClick$}get staticClick$(){return this._staticClick$}get windowBlur$(){return this._windowBlur$}dispose(){this._subscriptions.unsubscribe()}claimMouse(e,t){this._claimMouse$.next({name:e,zindex:t})}unclaimMouse(e){this._claimMouse$.next({name:e,zindex:null})}deferPixels(e,t){this._deferPixelClaims$.next({name:e,deferPixels:t})}undeferPixels(e){this._deferPixelClaims$.next({name:e,deferPixels:null})}claimWheel(e,t){this._claimWheel$.next({name:e,zindex:t})}unclaimWheel(e){this._claimWheel$.next({name:e,zindex:null})}filtered$(e,t){return this._filtered(e,t,this._mouseOwner$)}filteredWheel$(e,t){return this._filtered(e,t,this._wheelOwner$)}_createDeferredMouseMove$(e,t){return t.pipe(it(i=>{const r=i.clientX-e.clientX,o=i.clientY-e.clientY;return[i,Math.sqrt(r*r+o*o)]}),Ui(this._deferPixels$),oi(([[,i],r])=>i>r),it(([[i]])=>i))}_createMouseDrag$(e,t){return e.pipe(it(([,i])=>i),ei(i=>Ul(Ai(i),this._documentMouseMove$).pipe(Td(t))))}_createMouseDragEnd$(e,t){return e.pipe(ei(()=>t.pipe(wi())))}_createMouseDragStart$(e){return e.pipe(it(([t])=>t))}_createMouseDragInitiate$(e,t,i,r){return t.pipe(oi(o=>this._mouseButton(o)===e),ei(o=>Si(Ai(o),r?this._createDeferredMouseMove$(o,this._documentMouseMove$):this._documentMouseMove$).pipe(Td(i),$l(1))))}_createOwner$(e){return e.pipe(Vr((t,i)=>(i.zindex==null?delete t[i.name]:t[i.name]=i.zindex,t),{}),it(t=>{let i=null,r=-1;for(const o in t)t.hasOwnProperty(o)&&t[o]>r&&(r=t[o],i=o);return i}),An(null))}_filtered(e,t,i){return t.pipe(Ui(i),oi(([,r])=>r===e),it(([r])=>r))}_mouseButton(e){const t=e.type==="pointerdown"||e.type==="pointerup",i=window.InstallTrigger;return t&&typeof i<"u"&&e.button===ey&&e.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?mg:e.button}_buttonReleased(e,t){const i=lae[t];return e.buttons===void 0||(e.buttons&i)!==i}_isMousePen(e){const t=e.pointerType;return t==="mouse"||t==="pen"}}class uae{set json(e){this._json=e}set image(e){this._image=e,this._texture=new Bs(this._image),this._texture.minFilter=Zs}get loaded(){return!!(this._image&&this._json)}getGLSprite(e){if(!this.loaded)throw new Error("Sprites cannot be retrieved before the atlas is loaded.");let t=this._json[e];if(!t)return console.warn("Sprite with key"+e+"does not exist in sprite definition."),new Ln;let i=this._texture.clone();i.needsUpdate=!0;let r=this._image.width,o=this._image.height;i.offset.x=t.x/r,i.offset.y=(o-t.y-t.height)/o,i.repeat.x=t.width/r,i.repeat.y=t.height/o;let c=new FC({map:i});return new Cz(c)}getDOMSprite(e,t){if(!this.loaded)throw new Error("Sprites cannot be retrieved before the atlas is loaded.");t==null&&(t=as.Center);let i=this._json[e];if(!i)return console.warn("Sprite with key"+e+"does not exist in sprite definition."),Gt.h("div",{},[]);let r=i.y,o=i.x+i.width,c=i.y+i.height,s=i.x,d=-i.x,p=-i.y,g=this._image.height,_=this._image.width;switch(t){case as.Bottom:case as.Center:case as.Top:d-=i.width/2;break;case as.BottomLeft:case as.Left:case as.TopLeft:d-=i.width;break;case as.BottomRight:case as.Right:case as.TopRight:}switch(t){case as.Center:case as.Left:case as.Right:p-=i.height/2;break;case as.Top:case as.TopLeft:case as.TopRight:p-=i.height;break;case as.Bottom:case as.BottomLeft:case as.BottomRight:}let x=1/i.pixelRatio;r*=x,o*=x,c*=x,s*=x,d*=x,p*=x,g*=x,_*=x;let b={src:this._image.src,style:{clip:`rect(${r}px, ${o}px, ${c}px, ${s}px)`,height:`${g}px`,left:`${d}px`,position:"absolute",top:`${p}px`,width:`${_}px`}};return Gt.h("img",b,[])}}class hae{constructor(e){if(this._retina=window.devicePixelRatio>1,this._spriteAtlasOperation$=new ri,this._spriteAtlas$=this._spriteAtlasOperation$.pipe(An(o=>o),Vr((o,c)=>c(o),new uae),Pi(1),gi()),this._atlasSubscription=this._spriteAtlas$.subscribe(()=>{}),e==null)return;let t=this._retina?"@2x":"",i=new XMLHttpRequest;i.open("GET",e+t+".png",!0),i.responseType="arraybuffer",i.onload=()=>{let o=new Image;o.onload=()=>{this._spriteAtlasOperation$.next(s=>(s.image=o,s))};let c=new Blob([i.response]);o.src=window.URL.createObjectURL(c)},i.onerror=o=>{console.error(new Error(`Failed to fetch sprite sheet (${e}${t}.png)`))},i.send();let r=new XMLHttpRequest;r.open("GET",e+t+".json",!0),r.responseType="text",r.onload=()=>{let o=JSON.parse(r.response);this._spriteAtlasOperation$.next(c=>(c.json=o,c))},r.onerror=o=>{console.error(new Error(`Failed to fetch sheet (${e}${t}.json)`))},r.send()}get spriteAtlas$(){return this._spriteAtlas$}dispose(){this._atlasSubscription.unsubscribe()}}class dae{constructor(e,t){this._subscriptions=new yo;const i=this._subscriptions;this._activeSubject$=new Ah(!1),this._active$=this._activeSubject$.pipe(yi(),Pi(1),gi()),i.push(Tr(t,"touchmove").subscribe(g=>{g.preventDefault()})),this._touchStart$=Tr(e,"touchstart"),this._touchMove$=Tr(e,"touchmove"),this._touchEnd$=Tr(e,"touchend"),this._touchCancel$=Tr(e,"touchcancel");const r=this._touchStart$.pipe(oi(g=>g.touches.length===1&&g.targetTouches.length===1),dn());this._doubleTap$=r.pipe(zW(()=>r.pipe(wi(),ei(()=>fn(MC(300),r).pipe($l(1))))),oi(g=>g.length===2),it(g=>g[g.length-1]),dn()),i.push(this._doubleTap$.subscribe(g=>{g.preventDefault()})),this._singleTouchMove$=this._touchMove$.pipe(oi(g=>g.touches.length===1&&g.targetTouches.length===1),dn());let o=fn(this._touchStart$,this._touchEnd$,this._touchCancel$).pipe(oi(g=>g.touches.length===1&&g.targetTouches.length===1)),c=fn(this._touchStart$,this._touchEnd$,this._touchCancel$).pipe(oi(g=>g.touches.length>=1)),s=fn(this._touchEnd$,this._touchCancel$).pipe(oi(g=>g.touches.length===0));this._singleTouchDragStart$=o.pipe(Hi(()=>this._singleTouchMove$.pipe(Td(fn(s,c)),$l(1)))),this._singleTouchDragEnd$=o.pipe(Hi(()=>fn(s,c).pipe(wi()))),this._singleTouchDrag$=o.pipe(ei(()=>this._singleTouchMove$.pipe(Ys(1),Td(fn(c,s)))));let d=fn(this._touchStart$,this._touchEnd$,this._touchCancel$);this._pinchStart$=d.pipe(oi(g=>g.touches.length===2&&g.targetTouches.length===2)),this._pinchEnd$=d.pipe(oi(g=>g.touches.length!==2||g.targetTouches.length!==2)),this._pinchOperation$=new ri,this._pinch$=this._pinchOperation$.pipe(Vr((g,_)=>_(g),{changeX:0,changeY:0,clientX:0,clientY:0,distance:0,distanceChange:0,distanceX:0,distanceY:0,originalEvent:null,pageX:0,pageY:0,screenX:0,screenY:0,touch1:null,touch2:null}));const p=this._touchMove$.pipe(oi(g=>g.touches.length===2&&g.targetTouches.length===2),it(g=>_=>{let x=g.touches[0],b=g.touches[1],S=Math.min(x.clientX,b.clientX),P=Math.max(x.clientX,b.clientX),L=Math.min(x.clientY,b.clientY),E=Math.max(x.clientY,b.clientY),C=S+(P-S)/2,D=L+(E-L)/2,O=C+x.pageX-x.clientX,U=D+x.pageY-x.clientY,q=C+x.screenX-x.clientX,G=D+x.screenY-x.clientY,N=Math.abs(x.clientX-b.clientX),V=Math.abs(x.clientY-b.clientY),j=Math.sqrt(N*N+V*V),z=j-_.distance,Q=N-_.distanceX,X=V-_.distanceY;return{changeX:Q,changeY:X,clientX:C,clientY:D,distance:j,distanceChange:z,distanceX:N,distanceY:V,originalEvent:g,pageX:O,pageY:U,screenX:q,screenY:G,touch1:x,touch2:b}})).subscribe(this._pinchOperation$);i.push(p),this._pinchChange$=this._pinchStart$.pipe(ei(()=>this._pinch$.pipe(Ys(1),Td(this._pinchEnd$))))}get active$(){return this._active$}get activate$(){return this._activeSubject$}get doubleTap$(){return this._doubleTap$}get touchStart$(){return this._touchStart$}get touchMove$(){return this._touchMove$}get touchEnd$(){return this._touchEnd$}get touchCancel$(){return this._touchCancel$}get singleTouchDragStart$(){return this._singleTouchDragStart$}get singleTouchDrag$(){return this._singleTouchDrag$}get singleTouchDragEnd$(){return this._singleTouchDragEnd$}get pinch$(){return this._pinchChange$}get pinchStart$(){return this._pinchStart$}get pinchEnd$(){return this._pinchEnd$}dispose(){this._subscriptions.unsubscribe()}}class fae{constructor(e){var t,i,r,o;const c=(i=(t=e?.url)===null||t===void 0?void 0:t.exploreHost)!==null&&i!==void 0?i:"www.mapillary.com",d=`${(o=(r=e?.url)===null||r===void 0?void 0:r.scheme)!==null&&o!==void 0?o:"https"}://${c}`;this._exploreUrl$=Ai(d);const p=e?.imageTiling!==!1;this._imageTiling$=Ai(p)}get exploreUrl$(){return this._exploreUrl$}get imageTiling$(){return this._imageTiling$}}class pae{constructor(e,t,i){var r;if(this._onWindowResize=()=>{this._trackResize&&this.renderService.resize$.next()},this._dom=i??new rE,typeof e.container=="string"){if(this._container=this._dom.document.getElementById(e.container),!this._container)throw new Error(`Container "${e.container}" not found.`)}else if(e.container instanceof HTMLElement)this._container=e.container;else throw new Error('Invalid type: "container" must be a String or HTMLElement.');this._trackResize=e.trackResize!==!1,this.id=(r=this._container.id)!==null&&r!==void 0?r:"mapillary-fallback-container-id",this._container.classList.add("mapillary-viewer"),this._canvasContainer=this._dom.createElement("div","mapillary-interactive",this._container),this._canvas=this._dom.createElement("canvas","mapillary-canvas"),this._canvas.style.position="absolute",this._canvas.setAttribute("tabindex","0"),this._domContainer=this._dom.createElement("div","mapillary-dom",this._container),this.configurationService=new fae(e),this.renderService=new oae(this._container,t.currentState$,e.renderMode),this.glRenderer=new rae(this._canvas,this._canvasContainer,this.renderService),this.domRenderer=new nae(this._domContainer,this.renderService,t.currentState$),this.keyboardService=new aae(this._canvasContainer),this.mouseService=new cae(this._container,this._canvasContainer,this._domContainer,document),this.touchService=new dae(this._canvasContainer,this._domContainer),this.spriteService=new hae(e.sprite),window.addEventListener("resize",this._onWindowResize,!1)}get canvas(){return this._canvas.parentNode?this._canvas:null}get canvasContainer(){return this._canvasContainer}get container(){return this._container}get domContainer(){return this._domContainer}remove(){window.removeEventListener("resize",this._onWindowResize,!1),this.spriteService.dispose(),this.touchService.dispose(),this.mouseService.dispose(),this.glRenderer.remove(),this.domRenderer.remove(),this.renderService.dispose(),this._removeNode(this._canvasContainer),this._removeNode(this._domContainer),this._container.classList.remove("mapillary-viewer")}_removeNode(e){e.parentNode&&e.parentNode.removeChild(e)}}class mae{constructor(e,t,i){this._graphService=e,this._stateService=t,this._api=i,this._subscriptions=new yo,this._started=!1,this._cellDepth=1}get started(){return this._started}configure(e){if(!e){this._cellDepth=1;return}this._cellDepth=Math.max(1,Math.min(3,e.cellDepth))}start(){if(this._started)return;const e=this._subscriptions;e.push(this._stateService.currentState$.pipe(yi(void 0,t=>t.state.currentImage.id),it(t=>{const i=t.state,r=i.trajectory,o=r.map(s=>s.id),c=r[r.length-1].sequenceId;return[o,i.currentImage.originalLngLat,c]}),xw(1,5),Ui(this._graphService.graphMode$),ei(([t,i])=>{const r=t[0][0],o=t[0][1],c=this._api.data.geometry,s=c.lngLatToCellId(o),d=y2(s,this._cellDepth,c),p=i===ra.Sequence?t[0][2]:void 0;return this._graphService.uncache$(r,d,p)})).subscribe(()=>{})),e.push(this._graphService.graphMode$.pipe(Ys(1),Ui(this._stateService.currentState$),ei(([t,i])=>t===ra.Sequence?this._keyToEdges(i.state.currentImage.id,r=>r.sequenceEdges$):Fr(i.state.trajectory.map(r=>r.id).slice(i.state.currentIndex)).pipe(Hi(r=>this._keyToEdges(r,o=>o.spatialEdges$),6)))).subscribe(()=>{})),e.push(this._graphService.dataAdded$.pipe(Ui(this._stateService.currentId$),ei(([t,i])=>this._graphService.cacheImage$(i))).subscribe(()=>{})),this._started=!0}stop(){this._started&&(this._subscriptions.unsubscribe(),this._started=!1)}_keyToEdges(e,t){return this._graphService.cacheImage$(e).pipe(ei(t),wi(i=>i.cached),JM(15e3),$n(i=>(console.error(`Failed to cache edges (${e}).`,i),zi())))}}class gae{constructor(){this._loadersSubject$=new ri,this._loaders$=this._loadersSubject$.pipe(Vr((e,t)=>(t.task!==void 0&&(e[t.task]=t.loading),e),{}),An({}),Pi(1),gi())}get loading$(){return this._loaders$.pipe(it(e=>{for(const t in e)if(e.hasOwnProperty(t)&&e[t])return!0;return!1}),Fy(100),yi())}taskLoading$(e){return this._loaders$.pipe(it(t=>!!t[e]),Fy(100),yi())}startLoading(e){this._loadersSubject$.next({loading:!0,task:e})}stopLoading(e){this._loadersSubject$.next({loading:!1,task:e})}}var Il;(function(n){n[n.Disabled=0]="Disabled",n[n.Enabled=1]="Enabled",n[n.Started=2]="Started"})(Il||(Il={}));class _ae{constructor(e,t,i,r,o,c){this._subscriptions=new yo,this._graphService=e,this._stateService=t,this._graphCalculator=r??new HC,this._spatial=o??new vo,this._viewportCoords=c??new zo,this._mode=i!==!1?Il.Enabled:Il.Disabled,this._panImagesSubject$=new ri,this._panImages$=this._panImagesSubject$.pipe(An([]),Pi(1),gi()),this._subscriptions.push(this._panImages$.subscribe())}get panImages$(){return this._panImages$}dispose(){this.stop(),this._panImagesSubscription!=null&&this._panImagesSubscription.unsubscribe(),this._subscriptions.unsubscribe()}enable(){this._mode===Il.Disabled&&(this._mode=Il.Enabled,this.start())}disable(){this._mode!==Il.Disabled&&(this.stop(),this._mode=Il.Disabled)}start(){if(this._mode!==Il.Enabled)return;const e=this._stateService.currentImage$.pipe(ei(t=>{if(!t.merged||ki(t.cameraType))return Ai([]);const i=Ai(t),r=this._graphCalculator.boundingBoxCorners(t.lngLat,20),o=this._graphService.cacheBoundingBox$(r[0],r[1]).pipe($n(c=>(console.error(`Failed to cache periphery bounding box (${t.id})`,c),zi())),it(c=>{if(ki(t.cameraType))return[];const s=[];for(const d of c)d.id!==t.id&&d.mergeId===t.mergeId&&(ki(d.cameraType)||this._distance(d,t)>4||s.push(d));return s}));return Si(i,o).pipe(Ui(this._stateService.reference$),it(([[c,s],d])=>{const p=this._spatial.viewingDirection(c.rotation),g=Rw({lat:c.lngLat.lat,lng:c.lngLat.lng,alt:c.computedAltitude},c.rotation,d),_=this._createTransform(c,g),x=this._spatial.wrap(this._spatial.azimuthal(p.toArray(),_.upVector().toArray()),0,2*Math.PI),b=this._computeProjectedPoints(_),S=this._computeHorizontalFov(b)/180*Math.PI,P=Math.PI/8;let L,E;for(const D of s){const O=Rw({lat:D.lngLat.lat,lng:D.lngLat.lng,alt:D.computedAltitude},D.rotation,d),U=this._createTransform(D,O),q=this._computeProjectedPoints(U),G=this._computeHorizontalFov(q)/180*Math.PI,N=this._spatial.viewingDirection(D.rotation),V=this._spatial.wrap(this._spatial.azimuthal(N.toArray(),U.upVector().toArray()),0,2*Math.PI),j=this._spatial.angleBetweenVector2(p.x,p.y,N.x,N.y);let z=Number.NEGATIVE_INFINITY;j>0?x>V?z=x-2*Math.PI+S/2-(V-G/2):z=x+S/2-(V-G/2):x<V?z=V+G/2-(x+2*Math.PI-S/2):z=V+G/2-(x-S/2);const Q=Math.abs(G-z),X=this._distance(D,c),re=Math.min(this._timeDifference(D,c),4),se=20*Math.abs(z-P),le=Math.min(5,1/Math.min(G/S,1)),ce=z>0?-2*Q:0,be=X+re+se+le+ce;z>0&&z<.5*S&&z<.5*G&&Q>.5*S&&(j>0?L?be<L[0]&&(L=[be,D,U,G]):L=[be,D,U,G]:E?be<E[0]&&(E=[be,D,U,G]):E=[be,D,U,G])}const C=[];return L&&C.push([L[1],L[2],L[3]]),E&&C.push([E[1],E[2],E[3]]),C}),An([]))}));this._panImagesSubscription=this._stateService.currentState$.pipe(it(t=>t.state.imagesAhead>0),yi(),ei(t=>t?Ai([]):e)).subscribe(t=>{this._panImagesSubject$.next(t)}),this._mode=Il.Started}stop(){this._mode===Il.Started&&(this._panImagesSubscription.unsubscribe(),this._panImagesSubject$.next([]),this._mode=Il.Enabled)}_distance(e,t){const[i,r,o]=ta(e.lngLat.lng,e.lngLat.lat,e.computedAltitude,t.lngLat.lng,t.lngLat.lat,t.computedAltitude);return Math.sqrt(i*i+r*r+o*o)}_timeDifference(e,t){return Math.abs(e.capturedAt-t.capturedAt)/2592e6}_createTransform(e,t){return new Lg(e.exifOrientation,e.width,e.height,e.scale,e.rotation,t,e.assetsCached?e.image:void 0,void 0,e.cameraParameters,e.cameraType)}_computeProjectedPoints(e){return ZC(e,[[1,0]],[[0,.5]],20,this._viewportCoords)}_computeHorizontalFov(e){const t=e.map(r=>this._coordToFov(r[0]));return Math.min(...t)}_coordToFov(e){return 2*Math.atan(e)*180/Math.PI}}class vk{constructor(e){this._data=e}get data(){return this._data}getCoreImages$(e){return this._wrap$(this._data.getCoreImages(e))}getImages$(e){return this._wrap$(this._data.getImages(e))}getImageTiles$(e){return this._wrap$(this._data.getImageTiles(e))}getSequence$(e){return this._wrap$(this._data.getSequence(e))}getSpatialImages$(e){return this._wrap$(this._data.getSpatialImages(e))}setAccessToken(e){this._data.setAccessToken(e)}_wrap$(e){return gr.create(t=>{e.then(i=>{t.next(i),t.complete()},i=>{t.error(i)})})}}class vae{constructor(e){this._dataAdded$=new ri,this._subscriptions=new yo,this._onDataAdded=i=>{this._graph$.pipe(wi(),Hi(r=>r.updateCells$(i.cellIds).pipe(Dr(()=>{r.resetSpatialEdges()})))).subscribe(r=>{this._dataAdded$.next(r)})};const t=this._subscriptions;this._graph$=Ul(Ai(e),e.changed$).pipe(Pi(1),gi()),t.push(this._graph$.subscribe(()=>{})),this._graphMode=ra.Spatial,this._graphModeSubject$=new ri,this._graphMode$=this._graphModeSubject$.pipe(An(this._graphMode),Pi(1),gi()),t.push(this._graphMode$.subscribe(()=>{})),this._firstGraphSubjects$=[],this._initializeCacheSubscriptions=[],this._sequenceSubscriptions=[],this._spatialSubscriptions=[],e.api.data.on("datacreate",this._onDataAdded)}get dataAdded$(){return this._dataAdded$}get filter$(){return this._graph$.pipe(wi(),Hi(e=>e.filter$))}get graphMode$(){return this._graphMode$}cacheBoundingBox$(e,t){return this._graph$.pipe(wi(),Hi(i=>i.cacheBoundingBox$(e,t)))}cacheCell$(e){return this._graph$.pipe(wi(),Hi(t=>t.cacheCell$(e)))}cacheImage$(e){const t=new ri;this._firstGraphSubjects$.push(t);const i=t.pipe(Pi(1),gi()),r=i.pipe(it(d=>d.getNode(e)),Hi(d=>d.assetsCached?Ai(d):d.cacheAssets$()),Pi(1),gi());r.subscribe(void 0,d=>{console.error(`Failed to cache image (${e}).`,d)});let o;o=this._graph$.pipe(wi(),Hi(d=>d.isCachingFull(e)||!d.hasNode(e)?d.cacheFull$(e):d.isCachingFill(e)||!d.getNode(e).complete?d.cacheFill$(e):Ai(d)),Dr(d=>{if(!d.hasNode(e))throw new ar(`Failed to cache image (${e})`);d.hasInitializedCache(e)||d.initializeCache(e)}),ga(()=>{o!=null&&(this._removeFromArray(o,this._initializeCacheSubscriptions),this._removeFromArray(t,this._firstGraphSubjects$))})).subscribe(d=>{t.next(d),t.complete()},d=>{t.error(d)}),o.closed||this._initializeCacheSubscriptions.push(o);const c=i.pipe($n(()=>zi()),Hi(d=>d.isCachingNodeSequence(e)||!d.hasNodeSequence(e)?d.cacheNodeSequence$(e):Ai(d)),Pi(1),gi());let s;if(s=c.pipe(Dr(d=>{d.getNode(e).sequenceEdges.cached||d.cacheSequenceEdges(e)}),ga(()=>{s!=null&&this._removeFromArray(s,this._sequenceSubscriptions)})).subscribe(()=>{},d=>{console.error(`Failed to cache sequence edges (${e}).`,d)}),s.closed||this._sequenceSubscriptions.push(s),this._graphMode===ra.Spatial){let d;d=i.pipe($n(()=>zi()),jO(p=>p.hasTiles(e)?zi():Fr(p.cacheTiles$(e)).pipe(Hi(g=>g.pipe(Hi(_=>_.isCachingTiles(e)?zi():Ai(_)),$n(_=>(console.error(`Failed to cache tile data (${e}).`,_),zi())))))),QM(1),Hi(p=>p.hasSpatialArea(e)?Ai(p):Fr(p.cacheSpatialArea$(e)).pipe(Hi(g=>g.pipe($n(_=>(console.error(`Failed to cache spatial images (${e}).`,_),zi())))))),QM(1),Hi(p=>p.hasNodeSequence(e)?Ai(p):p.cacheNodeSequence$(e)),Dr(p=>{p.getNode(e).spatialEdges.cached||p.cacheSpatialEdges(e)}),ga(()=>{d!=null&&this._removeFromArray(d,this._spatialSubscriptions)})).subscribe(()=>{},p=>{const g=`Failed to cache spatial edges (${e}).`;console.error(g,p)}),d.closed||this._spatialSubscriptions.push(d)}return r.pipe(wi(d=>d.assetsCached))}cacheSequence$(e){return this._graph$.pipe(wi(),Hi(t=>t.isCachingSequence(e)||!t.hasSequence(e)?t.cacheSequence$(e):Ai(t)),it(t=>t.getSequence(e)))}cacheSequenceImages$(e,t){return this._graph$.pipe(wi(),Hi(i=>i.isCachingSequence(e)||!i.hasSequence(e)?i.cacheSequence$(e):Ai(i)),Hi(i=>i.isCachingSequenceNodes(e)||!i.hasSequenceNodes(e)?i.cacheSequenceNodes$(e,t):Ai(i)),it(i=>i.getSequence(e)))}dispose(){this._graph$.pipe(wi()).subscribe(e=>{e.unsubscribe()}),this._subscriptions.unsubscribe()}setFilter$(e){return this._resetSubscriptions(this._spatialSubscriptions),this._graph$.pipe(wi(),Dr(t=>{t.resetSpatialEdges(),t.setFilter(e)}),it(()=>{}))}setGraphMode(e){this._graphMode!==e&&(e===ra.Sequence&&this._resetSubscriptions(this._spatialSubscriptions),this._graphMode=e,this._graphModeSubject$.next(this._graphMode))}reset$(e){return this._abortSubjects(this._firstGraphSubjects$),this._resetSubscriptions(this._initializeCacheSubscriptions),this._resetSubscriptions(this._sequenceSubscriptions),this._resetSubscriptions(this._spatialSubscriptions),this._graph$.pipe(wi(),Dr(t=>{t.reset(e)}),it(()=>{}))}uncache$(e,t,i){return this._graph$.pipe(wi(),Dr(r=>{r.uncache(e,t,i)}),it(()=>{}))}_abortSubjects(e){for(const t of e.slice())this._removeFromArray(t,e),t.error(new Error("Cache image request was aborted."))}_removeFromArray(e,t){const i=t.indexOf(e);i!==-1&&t.splice(i,1)}_resetSubscriptions(e){for(const t of e.slice())this._removeFromArray(t,e),t.closed||t.unsubscribe()}}class yae{constructor(e){e.requestAnimationFrame?(this._cancelAnimationFrame=e.cancelAnimationFrame.bind(e),this._requestAnimationFrame=e.requestAnimationFrame.bind(e)):e.mozRequestAnimationFrame?(this._cancelAnimationFrame=e.mozCancelAnimationFrame.bind(e),this._requestAnimationFrame=e.mozRequestAnimationFrame.bind(e)):e.webkitRequestAnimationFrame?(this._cancelAnimationFrame=e.webkitCancelAnimationFrame.bind(e),this._requestAnimationFrame=e.webkitRequestAnimationFrame.bind(e)):e.msRequestAnimationFrame?(this._cancelAnimationFrame=e.msCancelAnimationFrame.bind(e),this._requestAnimationFrame=e.msRequestAnimationFrame.bind(e)):e.oRequestAnimationFrame?(this._cancelAnimationFrame=e.oCancelAnimationFrame.bind(e),this._requestAnimationFrame=e.oRequestAnimationFrame.bind(e)):(this._cancelAnimationFrame=e.clearTimeout.bind(e),this._requestAnimationFrame=t=>e.setTimeout(t,1e3/60))}get cancelAnimationFrame(){return this._cancelAnimationFrame}get requestAnimationFrame(){return this._requestAnimationFrame}}class E1{constructor(e){this._spatial=new vo,this._referenceThreshold=.01,this._transitionMode=e.transitionMode,this._reference=e.reference,this._alpha=e.alpha,this._stateTransitionAlpha=0,this._camera=e.camera.clone(),this._zoom=e.zoom,this._currentIndex=e.currentIndex,this._trajectory=e.trajectory.slice(),this._trajectoryTransforms=[],this._trajectoryCameras=[];for(let t of this._trajectory){let i=this._imageToTranslation(t,this._reference),r=new Lg(t.exifOrientation,t.width,t.height,t.scale,t.rotation,i,t.image,void 0,t.cameraParameters,t.cameraType);this._trajectoryTransforms.push(r),this._trajectoryCameras.push(new Md(r))}this._currentImage=this._trajectory.length>0?this._trajectory[this._currentIndex]:null,this._previousImage=this._trajectory.length>1&&this.currentIndex>0?this._trajectory[this._currentIndex-1]:null,this._currentCamera=this._trajectoryCameras.length>0?this._trajectoryCameras[this._currentIndex].clone():new Md,this._previousCamera=this._trajectoryCameras.length>1&&this.currentIndex>0?this._trajectoryCameras[this._currentIndex-1].clone():this._currentCamera.clone()}get reference(){return this._reference}get alpha(){return this._getAlpha()}get stateTransitionAlpha(){return this._getStateTransitionAlpha()}get camera(){return this._camera}get zoom(){return this._zoom}get trajectory(){return this._trajectory}get currentIndex(){return this._currentIndex}get currentImage(){return this._currentImage}get previousImage(){return this._previousImage}get currentCamera(){return this._currentCamera}get currentTransform(){return this._trajectoryTransforms.length>0?this._trajectoryTransforms[this.currentIndex]:null}get previousTransform(){return this._trajectoryTransforms.length>1&&this.currentIndex>0?this._trajectoryTransforms[this.currentIndex-1]:null}get motionless(){return this._motionless}get transitionMode(){return this._transitionMode}move(e){}moveTo(e){}rotate(e){}rotateUnbounded(e){}rotateWithoutInertia(e){}rotateBasic(e){}rotateBasicUnbounded(e){}rotateBasicWithoutInertia(e){}rotateToBasic(e){}setSpeed(e){}zoomIn(e,t){}update(e){}setCenter(e){}setZoom(e){}dolly(e){}orbit(e){}setViewMatrix(e){}truck(e){}append(e){if(e.length<1)throw Error("Trajectory can not be empty");this._currentIndex<0?this.set(e):(this._trajectory=this._trajectory.concat(e),this._appendToTrajectories(e))}prepend(e){if(e.length<1)throw Error("Trajectory can not be empty");this._trajectory=e.slice().concat(this._trajectory),this._currentIndex+=e.length,this._setCurrentImage(),this._setReference(this._currentImage)?this._setTrajectories():this._prependToTrajectories(e),this._setCurrentCamera()}remove(e){if(e<0)throw Error("n must be a positive integer");if(this._currentIndex-1<e)throw Error("Current and previous images can not be removed");for(let t=0;t<e;t++)this._trajectory.shift(),this._trajectoryTransforms.shift(),this._trajectoryCameras.shift(),this._currentIndex--;this._setCurrentImage()}clearPrior(){this._currentIndex>0&&this.remove(this._currentIndex-1)}clear(){this.cut(),this._currentIndex>0&&this.remove(this._currentIndex-1)}cut(){for(;this._trajectory.length-1>this._currentIndex;)this._trajectory.pop(),this._trajectoryTransforms.pop(),this._trajectoryCameras.pop()}set(e){this._setTrajectory(e),this._setCurrentImage(),this._setReference(this._currentImage),this._setTrajectories(),this._setCurrentCamera()}getCenter(){return this._currentImage!=null?this.currentTransform.projectBasic(this._camera.lookat.toArray()):[.5,.5]}setTransitionMode(e){this._transitionMode=e}_getAlpha(){return 1}_getStateTransitionAlpha(){return 1}_setCurrent(){this._setCurrentImage(),this._setReference(this._currentImage)&&this._setTrajectories(),this._setCurrentCamera()}_setCurrentCamera(){this._currentCamera=this._trajectoryCameras[this._currentIndex].clone(),this._previousCamera=this._currentIndex>0?this._trajectoryCameras[this._currentIndex-1].clone():this._currentCamera.clone()}_motionlessTransition(){return this._currentImage!=null&&this._previousImage!=null&&(this._transitionMode===Vw.Instantaneous||!(this._currentImage.merged&&this._previousImage.merged&&this._withinOriginalDistance()&&this._sameConnectedComponent()))}_setReference(e){return Math.abs(e.lngLat.lat-this.reference.lat)<this._referenceThreshold&&Math.abs(e.lngLat.lng-this.reference.lng)<this._referenceThreshold||this._previousImage!=null&&!this._motionlessTransition()?!1:(this._reference.lat=e.lngLat.lat,this._reference.lng=e.lngLat.lng,this._reference.alt=e.computedAltitude,!0)}_setCurrentImage(){this._currentImage=this._trajectory.length>0?this._trajectory[this._currentIndex]:null,this._previousImage=this._currentIndex>0?this._trajectory[this._currentIndex-1]:null}_setTrajectory(e){if(e.length<1)throw new ma("Trajectory can not be empty");this._currentImage!=null?(this._trajectory=[this._currentImage].concat(e),this._currentIndex=1):(this._trajectory=e.slice(),this._currentIndex=0)}_setTrajectories(){this._trajectoryTransforms.length=0,this._trajectoryCameras.length=0,this._appendToTrajectories(this._trajectory)}_appendToTrajectories(e){for(let t of e){if(!t.assetsCached)throw new ma("Assets must be cached when image is added to trajectory");let i=this._imageToTranslation(t,this.reference),r=new Lg(t.exifOrientation,t.width,t.height,t.scale,t.rotation,i,t.image,void 0,t.cameraParameters,t.cameraType);this._trajectoryTransforms.push(r),this._trajectoryCameras.push(new Md(r))}}_prependToTrajectories(e){for(let t of e.reverse()){if(!t.assetsCached)throw new ma("Assets must be cached when added to trajectory");let i=this._imageToTranslation(t,this.reference),r=new Lg(t.exifOrientation,t.width,t.height,t.scale,t.rotation,i,t.image,void 0,t.cameraParameters,t.cameraType);this._trajectoryTransforms.unshift(r),this._trajectoryCameras.unshift(new Md(r))}}_imageToTranslation(e,t){return Rw({alt:e.computedAltitude,lat:e.lngLat.lat,lng:e.lngLat.lng},e.rotation,t)}_sameConnectedComponent(){let e=this._currentImage,t=this._previousImage;return!!e&&!!t&&e.mergeId===t.mergeId}_withinOriginalDistance(){let e=this._currentImage,t=this._previousImage;return!e||!t?!0:this._spatial.distanceFromLngLat(e.originalLngLat.lng,e.originalLngLat.lat,t.originalLngLat.lng,t.originalLngLat.lat)<25}}class yk extends E1{constructor(e){super(e)}setViewMatrix(e){const i=new Li().fromArray(e).invert().elements,r=new Ue(i[12],i[13],i[14]),o=new Ue(-i[8],-i[9],-i[10]),c=new Ue(i[4],i[5],i[6]),s=this._camera;s.position.copy(r),s.lookat.copy(r.clone().add(o)),s.up.copy(c);const d=.5/Math.tan(Math.PI/3);s.focal=d}}class bk extends E1{constructor(e){super(e),this._transition=0;const t=this._camera.position.clone(),i=this._camera.lookat.clone().sub(t).normalize(),r=Math.sqrt(i.x*i.x+i.y*i.y),o=Math.atan2(i.z,r),c=new Ue;if(o>-Math.PI/45)c.copy(t),t.add(new Ue(i.x,i.y,0).multiplyScalar(-50)),t.z=30;else{const D=t.clone(),O=new Ue(0,0,1),U=new Ue(0,0,-2),q=new Ue().subVectors(U,D).dot(O)/i.dot(O),N=D.clone().add(i.clone().multiplyScalar(Math.min(1e4,q)));c.copy(N);const V=t.clone().sub(N).normalize();t.copy(N.add(V.multiplyScalar(Math.max(50,V.length()))))}const s=this._camera.position.clone(),d=s.clone().add(i.clone().normalize().multiplyScalar(10)),p=this._camera.up.clone(),g=d.clone(),_=g.clone().add(i.clone().normalize().multiplyScalar(10)),x=p.clone(),b=t.clone(),S=c.clone(),P=new Ue(0,0,1),L=t.clone().add(S.clone().sub(b).normalize().multiplyScalar(-10)),E=S.clone(),C=P.clone();this._curveE=new _y([g,s,b,L]),this._curveL=new _y([_,d,S,E]),this._curveU=new _y([x,p,P,C]),this._zoom0=this._zoom,this._zoom1=0,this._camera.focal=.5/Math.tan(Math.PI/4)}get _isTransitioning(){return this._transition<1}dolly(e){if(this._isTransitioning)return;const t=this._camera,i=t.position.clone().sub(t.lookat),o=i.length()*Math.pow(2,-e),c=Math.max(1,Math.min(o,4e3));i.normalize(),i.multiplyScalar(c),t.position.copy(t.lookat).add(i)}orbit(e){if(this._isTransitioning)return;const t=this._camera,i=new go().setFromUnitVectors(t.up,new Ue(0,0,1)),r=i.clone().invert(),o=t.position.clone().sub(t.lookat);o.applyQuaternion(i);const c=o.length();let s=Math.atan2(o.y,o.x);s+=e.phi;let d=Math.atan2(Math.sqrt(o.x*o.x+o.y*o.y),o.z);d+=e.theta;const p=Math.PI/36;d=Math.max(p,Math.min(Math.PI/2-p,d)),o.x=Math.sin(d)*Math.cos(s),o.y=Math.sin(d)*Math.sin(s),o.z=Math.cos(d),o.applyQuaternion(r),t.position.copy(t.lookat).add(o.multiplyScalar(c))}truck(e){if(this._isTransitioning)return;const t=this._camera;t.position.add(new Ue().fromArray(e)),t.lookat.add(new Ue().fromArray(e))}update(e){if(!this._isTransitioning)return;this._transition=Math.min(this._transition+2*e/3,1);const t=Hg.smootherstep(this._transition,0,1),i=(t+1)/3,r=this._curveE.getPoint(i),o=this._curveL.getPoint(i),c=this._curveU.getPoint(i);this._camera.position.copy(r),this._camera.lookat.copy(o),this._camera.up.copy(c),this._zoom=Hg.lerp(this._zoom0,this._zoom1,t),this._stateTransitionAlpha=t}_getStateTransitionAlpha(){return this._stateTransitionAlpha}}class xk{constructor(e,t){this._phi=e,this._theta=t}get phi(){return this._phi}set phi(e){this._phi=e}get theta(){return this._theta}set theta(e){this._theta=e}get isZero(){return this._phi===0&&this._theta===0}copy(e){this._phi=e.phi,this._theta=e.theta}lerp(e,t){this._phi=(1-t)*this._phi+t*e.phi,this._theta=(1-t)*this._theta+t*e.theta}multiply(e){this._phi*=e,this._theta*=e}threshold(e){this._phi=Math.abs(this._phi)>e?this._phi:0,this._theta=Math.abs(this._theta)>e?this._theta:0}lengthSquared(){return this._phi*this._phi+this._theta*this._theta}reset(){this._phi=0,this._theta=0}}class kN extends E1{constructor(e){super(e),this._animationSpeed=1/40,this._rotationDelta=new xk(0,0),this._requestedRotationDelta=null,this._basicRotation=[0,0],this._requestedBasicRotation=null,this._requestedBasicRotationUnbounded=null,this._rotationAcceleration=.86,this._rotationIncreaseAlpha=.97,this._rotationDecreaseAlpha=.9,this._rotationThreshold=.001,this._unboundedRotationAlpha=.8,this._desiredZoom=e.zoom,this._minZoom=0,this._maxZoom=3,this._lookatDepth=10,this._desiredLookat=null,this._desiredCenter=null}rotate(e){this._currentImage!=null&&(e.phi===0&&e.theta===0||(this._desiredZoom=this._zoom,this._desiredLookat=null,this._requestedBasicRotation=null,this._requestedRotationDelta!=null?(this._requestedRotationDelta.phi=this._requestedRotationDelta.phi+e.phi,this._requestedRotationDelta.theta=this._requestedRotationDelta.theta+e.theta):this._requestedRotationDelta=new xk(e.phi,e.theta)))}rotateUnbounded(e){if(this._currentImage==null||(this._requestedBasicRotation=null,this._requestedRotationDelta=null,this._applyRotation(e,this._currentCamera),this._applyRotation(e,this._previousCamera),!this._desiredLookat))return;const t=new go().setFromUnitVectors(this._currentCamera.up,new Ue(0,0,1)),i=t.clone().invert(),r=new Ue().copy(this._desiredLookat).sub(this._camera.position).applyQuaternion(t),o=r.length();let c=Math.atan2(r.y,r.x);c+=e.phi;let s=Math.atan2(Math.sqrt(r.x*r.x+r.y*r.y),r.z);s+=e.theta,s=Math.max(.1,Math.min(Math.PI-.1,s)),r.x=Math.sin(s)*Math.cos(c),r.y=Math.sin(s)*Math.sin(c),r.z=Math.cos(s),r.applyQuaternion(i),this._desiredLookat.copy(this._camera.position).add(r.multiplyScalar(o))}rotateWithoutInertia(e){if(this._currentImage==null)return;this._desiredZoom=this._zoom,this._desiredLookat=null,this._requestedBasicRotation=null,this._requestedRotationDelta=null;const t=Math.PI/(10*Math.pow(2,this._zoom)),i={phi:this._spatial.clamp(e.phi,-t,t),theta:this._spatial.clamp(e.theta,-t,t)};this._applyRotation(i,this._currentCamera),this._applyRotation(i,this._previousCamera)}rotateBasic(e){if(this._currentImage!=null)if(this._desiredZoom=this._zoom,this._desiredLookat=null,this._requestedRotationDelta=null,this._requestedBasicRotation!=null){this._requestedBasicRotation[0]+=e[0],this._requestedBasicRotation[1]+=e[1];let t=.05/Math.pow(2,this._zoom);this._requestedBasicRotation[0]=this._spatial.clamp(this._requestedBasicRotation[0],-t,t),this._requestedBasicRotation[1]=this._spatial.clamp(this._requestedBasicRotation[1],-t,t)}else this._requestedBasicRotation=e.slice()}rotateBasicUnbounded(e){this._currentImage!=null&&(this._requestedBasicRotationUnbounded!=null?(this._requestedBasicRotationUnbounded[0]+=e[0],this._requestedBasicRotationUnbounded[1]+=e[1]):this._requestedBasicRotationUnbounded=e.slice())}rotateBasicWithoutInertia(e){if(this._currentImage==null)return;this._desiredZoom=this._zoom,this._desiredLookat=null,this._requestedRotationDelta=null,this._requestedBasicRotation=null;const t=.05/Math.pow(2,this._zoom),i=e.slice();i[0]=this._spatial.clamp(i[0],-t,t),i[1]=this._spatial.clamp(i[1],-t,t),this._applyRotationBasic(i)}rotateToBasic(e){if(this._currentImage==null)return;this._desiredZoom=this._zoom,this._desiredLookat=null,e[0]=this._spatial.clamp(e[0],0,1),e[1]=this._spatial.clamp(e[1],0,1);let t=this.currentTransform.unprojectBasic(e,this._lookatDepth);this._currentCamera.lookat.fromArray(t)}zoomIn(e,t){if(this._currentImage==null)return;this._desiredZoom=Math.max(this._minZoom,Math.min(this._maxZoom,this._desiredZoom+e));let i=this.currentTransform.projectBasic(this._currentCamera.lookat.toArray()),r=i[0],o=i[1],c=Math.pow(2,this._zoom),s=Math.pow(2,this._desiredZoom),d=t[0],p=t[1];ki(this.currentTransform.cameraType)&&(d-r>.5?d=d-1:r-d>.5&&(d=1+d));let g=d-c/s*(d-r),_=p-c/s*(p-o);ki(this._currentImage.cameraType)?(g=this._spatial.wrap(g+this._basicRotation[0],0,1),_=this._spatial.clamp(_+this._basicRotation[1],.05,.95)):(g=this._spatial.clamp(g,0,1),_=this._spatial.clamp(_,0,1)),this._desiredLookat=new Ue().fromArray(this.currentTransform.unprojectBasic([g,_],this._lookatDepth))}setCenter(e){this._desiredLookat=null,this._requestedRotationDelta=null,this._requestedBasicRotation=null,this._desiredZoom=this._zoom;let t=[this._spatial.clamp(e[0],0,1),this._spatial.clamp(e[1],0,1)];if(this._currentImage==null){this._desiredCenter=t;return}this._desiredCenter=null;let i=new Ue().fromArray(this.currentTransform.unprojectBasic(t,this._lookatDepth)),r=this.previousTransform!=null?this.previousTransform:this.currentTransform,o=new Ue().fromArray(r.unprojectBasic(t,this._lookatDepth));this._currentCamera.lookat.copy(i),this._previousCamera.lookat.copy(o)}setZoom(e){this._desiredLookat=null,this._requestedRotationDelta=null,this._requestedBasicRotation=null,this._zoom=this._spatial.clamp(e,this._minZoom,this._maxZoom),this._desiredZoom=this._zoom}_applyRotation(e,t){if(t==null)return;let i=new go().setFromUnitVectors(t.up,new Ue(0,0,1)),r=i.clone().invert(),o=new Ue;o.copy(t.lookat).sub(t.position),o.applyQuaternion(i);let c=o.length(),s=Math.atan2(o.y,o.x);s+=e.phi;let d=Math.atan2(Math.sqrt(o.x*o.x+o.y*o.y),o.z);d+=e.theta,d=Math.max(.1,Math.min(Math.PI-.1,d)),o.x=Math.sin(d)*Math.cos(s),o.y=Math.sin(d)*Math.sin(s),o.z=Math.cos(d),o.applyQuaternion(r),t.lookat.copy(t.position).add(o.multiplyScalar(c))}_applyRotationBasic(e){let t=this._currentImage,i=this._previousImage!=null?this.previousImage:this.currentImage,r=this._currentCamera,o=this._previousCamera,c=this.currentTransform,s=this.previousTransform!=null?this.previousTransform:this.currentTransform,d=c.projectBasic(r.lookat.toArray()),p=s.projectBasic(o.lookat.toArray());ki(t.cameraType)?(d[0]=this._spatial.wrap(d[0]+e[0],0,1),d[1]=this._spatial.clamp(d[1]+e[1],.05,.95)):(d[0]=this._spatial.clamp(d[0]+e[0],0,1),d[1]=this._spatial.clamp(d[1]+e[1],0,1)),ki(i.cameraType)?(p[0]=this._spatial.wrap(p[0]+e[0],0,1),p[1]=this._spatial.clamp(p[1]+e[1],.05,.95)):(p[0]=this._spatial.clamp(p[0]+e[0],0,1),p[1]=this._spatial.clamp(d[1]+e[1],0,1));let g=c.unprojectBasic(d,this._lookatDepth);r.lookat.fromArray(g);let _=s.unprojectBasic(p,this._lookatDepth);o.lookat.fromArray(_)}_updateZoom(e){let t=this._desiredZoom-this._zoom,i=t>0?1:t<0?-1:0;t!==0&&(Math.abs(t)<.002?(this._zoom=this._desiredZoom,this._desiredLookat!=null&&(this._desiredLookat=null)):this._zoom+=i*Math.max(Math.abs(5*e*t),.002))}_updateLookat(e){if(this._desiredLookat===null)return;let t=this._desiredLookat.distanceToSquared(this._currentCamera.lookat);Math.abs(t)<1e-6?(this._currentCamera.lookat.copy(this._desiredLookat),this._desiredLookat=null):this._currentCamera.lookat.lerp(this._desiredLookat,5*e)}_updateRotation(){if(this._requestedRotationDelta!=null){let t=this._rotationDelta.lengthSquared();this._requestedRotationDelta.lengthSquared()>t?this._rotationDelta.lerp(this._requestedRotationDelta,this._rotationIncreaseAlpha):this._rotationDelta.lerp(this._requestedRotationDelta,this._rotationDecreaseAlpha),this._requestedRotationDelta=null;return}if(this._rotationDelta.isZero)return;const e=ki(this.currentImage.cameraType)?1:this._alpha;this._rotationDelta.multiply(this._rotationAcceleration*e),this._rotationDelta.threshold(this._rotationThreshold)}_updateRotationBasic(){if(this._requestedBasicRotation!=null){let e=this._basicRotation[0],t=this._basicRotation[1],i=this._requestedBasicRotation[0],r=this._requestedBasicRotation[1];Math.abs(i)>Math.abs(e)?this._basicRotation[0]=(1-this._rotationIncreaseAlpha)*e+this._rotationIncreaseAlpha*i:this._basicRotation[0]=(1-this._rotationDecreaseAlpha)*e+this._rotationDecreaseAlpha*i,Math.abs(r)>Math.abs(t)?this._basicRotation[1]=(1-this._rotationIncreaseAlpha)*t+this._rotationIncreaseAlpha*r:this._basicRotation[1]=(1-this._rotationDecreaseAlpha)*t+this._rotationDecreaseAlpha*r,this._requestedBasicRotation=null;return}if(this._requestedBasicRotationUnbounded!=null){let e=this._requestedBasicRotationUnbounded[0],t=this._requestedBasicRotationUnbounded[1];if(Math.abs(e)>0&&(this._basicRotation[0]=(1-this._unboundedRotationAlpha)*this._basicRotation[0]+this._unboundedRotationAlpha*e),Math.abs(t)>0&&(this._basicRotation[1]=(1-this._unboundedRotationAlpha)*this._basicRotation[1]+this._unboundedRotationAlpha*t),this._desiredLookat!=null){let i=this.currentTransform.projectBasic(this._desiredLookat.toArray());i[0]+=e,i[1]+=t,this._desiredLookat=new Ue().fromArray(this.currentTransform.unprojectBasic(i,this._lookatDepth))}this._requestedBasicRotationUnbounded=null}this._basicRotation[0]===0&&this._basicRotation[1]===0||(this._basicRotation[0]=this._rotationAcceleration*this._basicRotation[0],this._basicRotation[1]=this._rotationAcceleration*this._basicRotation[1],Math.abs(this._basicRotation[0])<this._rotationThreshold/Math.pow(2,this._zoom)&&Math.abs(this._basicRotation[1])<this._rotationThreshold/Math.pow(2,this._zoom)&&(this._basicRotation=[0,0]))}_clearRotation(){ki(this._currentImage.cameraType)||(this._requestedRotationDelta!=null&&(this._requestedRotationDelta=null),this._rotationDelta.isZero||this._rotationDelta.reset(),this._requestedBasicRotation!=null&&(this._requestedBasicRotation=null),(this._basicRotation[0]>0||this._basicRotation[1]>0)&&(this._basicRotation=[0,0]))}_setDesiredCenter(){if(this._desiredCenter==null)return;let e=new Ue().fromArray(this.currentTransform.unprojectBasic(this._desiredCenter,this._lookatDepth)).sub(this._currentCamera.position);this._currentCamera.lookat.copy(this._currentCamera.position.clone().add(e)),this._previousCamera.lookat.copy(this._previousCamera.position.clone().add(e)),this._desiredCenter=null}_setDesiredZoom(){this._desiredZoom=ki(this._currentImage.cameraType)||this._previousImage==null?this._zoom:0}}class wk extends kN{constructor(e){super(e),this._adjustCameras(),this._motionless=this._motionlessTransition()}prepend(e){super.prepend(e),this._motionless=this._motionlessTransition()}set(e){super.set(e),this._motionless=this._motionlessTransition()}move(e){this._alpha=Math.max(0,Math.min(1,this._alpha+e))}moveTo(e){this._alpha=Math.max(0,Math.min(1,e))}update(e){this._updateRotation(),this._rotationDelta.isZero||(this._applyRotation(this._rotationDelta,this._previousCamera),this._applyRotation(this._rotationDelta,this._currentCamera)),this._updateRotationBasic(),(this._basicRotation[0]!==0||this._basicRotation[1]!==0)&&this._applyRotationBasic(this._basicRotation);let t=this._animationSpeed*e/.1*6;this._updateZoom(t),this._updateLookat(t),this._camera.lerpCameras(this._previousCamera,this._currentCamera,this.alpha)}_getAlpha(){return this._motionless?Math.round(this._alpha):this._alpha}_setCurrentCamera(){super._setCurrentCamera(),this._adjustCameras()}_adjustCameras(){if(this._previousImage!=null){if(ki(this._currentImage.cameraType)){let e=this._camera.lookat.clone().sub(this._camera.position);this._currentCamera.lookat.copy(e.clone().add(this._currentCamera.position))}if(ki(this._previousImage.cameraType)){let e=this._currentCamera.lookat.clone().sub(this._currentCamera.position);this._previousCamera.lookat.copy(e.clone().add(this._previousCamera.position))}}}}class Sk extends kN{constructor(e){super(e),this._adjustCameras(),this._motionless=this._motionlessTransition(),this._baseAlpha=this._alpha,this._speedCoefficient=1,this._smoothing=!1}append(e){let t=this._trajectory.length===0;t&&this._resetTransition(),super.append(e),t&&(this._setDesiredCenter(),this._setDesiredZoom())}prepend(e){let t=this._trajectory.length===0;t&&this._resetTransition(),super.prepend(e),t&&(this._setDesiredCenter(),this._setDesiredZoom())}set(e){super.set(e),this._desiredLookat=null,this._resetTransition(),this._clearRotation(),this._setDesiredCenter(),this._setDesiredZoom(),this._trajectory.length<3&&(this._smoothing=!0)}setSpeed(e){this._speedCoefficient=this._spatial.clamp(e,0,10)}update(e){this._alpha===1&&this._currentIndex+this._alpha<this._trajectory.length&&(this._currentIndex+=1,this._smoothing=this._trajectory.length<3&&this._currentIndex+1===this._trajectory.length,this._setCurrent(),this._resetTransition(),this._clearRotation(),this._desiredZoom=ki(this._currentImage.cameraType)?this._zoom:0,this._desiredLookat=null);let t=this._animationSpeed*e/.1*6;this._baseAlpha=Math.min(1,this._baseAlpha+this._speedCoefficient*t),this._smoothing?this._alpha=Hg.smootherstep(this._baseAlpha,0,1):this._alpha=this._baseAlpha,this._updateRotation(),this._rotationDelta.isZero||(this._applyRotation(this._rotationDelta,this._previousCamera),this._applyRotation(this._rotationDelta,this._currentCamera)),this._updateRotationBasic(),(this._basicRotation[0]!==0||this._basicRotation[1]!==0)&&this._applyRotationBasic(this._basicRotation),this._updateZoom(t),this._updateLookat(t),this._camera.lerpCameras(this._previousCamera,this._currentCamera,this.alpha)}_getAlpha(){return this._motionless?Math.ceil(this._alpha):this._alpha}_setCurrentCamera(){super._setCurrentCamera(),this._adjustCameras()}_adjustCameras(){if(this._previousImage==null)return;let e=this._camera.lookat.clone().sub(this._camera.position);this._previousCamera.lookat.copy(e.clone().add(this._previousCamera.position)),ki(this._currentImage.cameraType)&&this._currentCamera.lookat.copy(e.clone().add(this._currentCamera.position))}_resetTransition(){this._alpha=0,this._baseAlpha=0,this._motionless=this._motionlessTransition()}}class Tk extends E1{constructor(e){super(e),this._zoom=0,this._adjustCameras(),this._motionless=this._motionlessTransition()}prepend(e){super.prepend(e),this._motionless=this._motionlessTransition()}set(e){super.set(e),this._motionless=this._motionlessTransition()}move(e){this._alpha=Math.max(0,Math.min(1,this._alpha+e))}moveTo(e){this._alpha=Math.max(0,Math.min(1,e))}update(){this._camera.lerpCameras(this._previousCamera,this._currentCamera,this.alpha)}_getAlpha(){return this._motionless?Math.round(this._alpha):this._alpha}_setCurrentCamera(){super._setCurrentCamera(),this._adjustCameras()}_adjustCameras(){if(this._previousImage!=null){if(ki(this._currentImage.cameraType)){let e=this._camera.lookat.clone().sub(this._camera.position);this._currentCamera.lookat.copy(e.clone().add(this._currentCamera.position))}if(ki(this._previousImage.cameraType)){let e=this._currentCamera.lookat.clone().sub(this._currentCamera.position);this._previousCamera.lookat.copy(e.clone().add(this._previousCamera.position))}}}}class bae{constructor(){const e=Oi[Oi.Custom],t=Oi[Oi.Earth],i=Oi[Oi.Traversing],r=Oi[Oi.Waiting],o=Oi[Oi.WaitingInteractively];this._creators=new Map;const c=this._creators;c.set(e,yk),c.set(t,bk),c.set(i,Sk),c.set(r,Tk),c.set(o,wk),this._transitions=new Map;const s=this._transitions;s.set(e,[t,i]),s.set(t,[e,i]),s.set(i,[e,t,r,o]),s.set(r,[i,o]),s.set(o,[i,r])}getState(e){if(e instanceof yk)return Oi.Custom;if(e instanceof bk)return Oi.Earth;if(e instanceof Sk)return Oi.Traversing;if(e instanceof Tk)return Oi.Waiting;if(e instanceof wk)return Oi.WaitingInteractively;throw new Error("Invalid state instance")}generate(e,t){const i=this._creators.get(Oi[e]);return new i(t)}transition(e,t){if(!this.validate(e,t))throw new Error("Invalid transition");return this.generate(t,e)}validate(e,t){const i=Oi[this.getState(e)],r=Oi[t],o=this._transitions;return o.has(i)&&o.get(i).includes(r)}}class xae{constructor(e,t){this._transitions=new bae,this._state=this._transitions.generate(e,{alpha:1,camera:new Md,currentIndex:-1,reference:{alt:0,lat:0,lng:0},trajectory:[],transitionMode:t??Vw.Default,zoom:0})}get state(){return this._transitions.getState(this._state)}get reference(){return this._state.reference}get alpha(){return this._state.alpha}get stateTransitionAlpha(){return this._state.stateTransitionAlpha}get camera(){return this._state.camera}get zoom(){return this._state.zoom}get currentImage(){return this._state.currentImage}get previousImage(){return this._state.previousImage}get currentCamera(){return this._state.currentCamera}get currentTransform(){return this._state.currentTransform}get previousTransform(){return this._state.previousTransform}get trajectory(){return this._state.trajectory}get currentIndex(){return this._state.currentIndex}get lastImage(){return this._state.trajectory[this._state.trajectory.length-1]}get imagesAhead(){return this._state.trajectory.length-1-this._state.currentIndex}get motionless(){return this._state.motionless}custom(){this._transition(Oi.Custom)}earth(){this._transition(Oi.Earth)}traverse(){this._transition(Oi.Traversing)}wait(){this._transition(Oi.Waiting)}waitInteractively(){this._transition(Oi.WaitingInteractively)}getCenter(){return this._state.getCenter()}setCenter(e){this._state.setCenter(e)}setZoom(e){this._state.setZoom(e)}update(e){this._state.update(e)}append(e){this._state.append(e)}prepend(e){this._state.prepend(e)}remove(e){this._state.remove(e)}clear(){this._state.clear()}clearPrior(){this._state.clearPrior()}cut(){this._state.cut()}set(e){this._state.set(e)}setViewMatrix(e){this._state.setViewMatrix(e)}rotate(e){this._state.rotate(e)}rotateUnbounded(e){this._state.rotateUnbounded(e)}rotateWithoutInertia(e){this._state.rotateWithoutInertia(e)}rotateBasic(e){this._state.rotateBasic(e)}rotateBasicUnbounded(e){this._state.rotateBasicUnbounded(e)}rotateBasicWithoutInertia(e){this._state.rotateBasicWithoutInertia(e)}rotateToBasic(e){this._state.rotateToBasic(e)}move(e){this._state.move(e)}moveTo(e){this._state.moveTo(e)}zoomIn(e,t){this._state.zoomIn(e,t)}setSpeed(e){this._state.setSpeed(e)}setTransitionMode(e){this._state.setTransitionMode(e)}dolly(e){this._state.dolly(e)}orbit(e){this._state.orbit(e)}truck(e){this._state.truck(e)}_transition(e){if(!this._transitions.validate(this._state,e)){const i=this._transitions.getState(this._state);console.warn(`Transition not valid (${Oi[i]} - ${Oi[e]})`);return}const t=this._transitions.transition(this._state,e);this._state=t}}class wae{constructor(e,t){this._appendImage$=new ri,this._clock=new kQ,this._subscriptions=new yo;const i=this._subscriptions;this._start$=new ri,this._frame$=new ri,this._contextOperation$=new Ah(c=>c),this._context$=this._contextOperation$.pipe(Vr((c,s)=>s(c),new xae(e,t)),Pi(1),gi()),this._state$=this._context$.pipe(it(c=>c.state),yi(),Pi(1),gi()),this._currentState$=this._frame$.pipe(Ui(this._context$,(c,s)=>[c,s]),oi(c=>c[1].currentImage!=null),Dr(c=>{c[1].update(this._clock.getDelta())}),it(c=>({fps:60,id:c[0],state:c[1]})),dn()),this._lastState$=this._currentState$.pipe(Pi(1),gi());let r=this._currentState$.pipe(yi(void 0,c=>c.state.currentImage.id),Pi(1),gi()),o=new ri;i.push(r.subscribe(o)),this._currentId$=new Ah(null),i.push(o.pipe(it(c=>c.state.currentImage.id)).subscribe(this._currentId$)),this._currentImage$=o.pipe(it(c=>c.state.currentImage),Pi(1),gi()),this._currentCamera$=o.pipe(it(c=>c.state.currentCamera),Pi(1),gi()),this._currentTransform$=o.pipe(it(c=>c.state.currentTransform),Pi(1),gi()),this._reference$=o.pipe(it(c=>c.state.reference),yi((c,s)=>c.lat===s.lat&&c.lng===s.lng,c=>({lat:c.lat,lng:c.lng})),Pi(1),gi()),this._currentImageExternal$=r.pipe(it(c=>c.state.currentImage),Pi(1),gi()),i.push(this._appendImage$.pipe(it(c=>s=>(s.append([c]),s))).subscribe(this._contextOperation$)),this._inMotionOperation$=new ri,i.push(r.pipe(it(()=>!0)).subscribe(this._inMotionOperation$)),i.push(this._inMotionOperation$.pipe(yi(),oi(c=>c),ei(()=>this._currentState$.pipe(oi(c=>c.state.imagesAhead===0),it(c=>[c.state.camera.clone(),c.state.zoom]),il(),it(c=>{let s=c[0][0],d=c[1][0],p=c[0][1],g=c[1][1];return s.diff(d)>1e-5||Math.abs(p-g)>1e-5}),wi(c=>!c)))).subscribe(this._inMotionOperation$)),this._inMotion$=this._inMotionOperation$.pipe(yi(),Pi(1),gi()),this._inTranslationOperation$=new ri,i.push(r.pipe(it(()=>!0)).subscribe(this._inTranslationOperation$)),i.push(this._inTranslationOperation$.pipe(yi(),oi(c=>c),ei(()=>this._currentState$.pipe(oi(c=>c.state.imagesAhead===0),it(c=>c.state.camera.position.clone()),il(),it(c=>c[0].distanceToSquared(c[1])!==0),wi(c=>!c)))).subscribe(this._inTranslationOperation$)),this._inTranslation$=this._inTranslationOperation$.pipe(yi(),Pi(1),gi()),i.push(this._state$.subscribe(()=>{})),i.push(this._currentImage$.subscribe(()=>{})),i.push(this._currentCamera$.subscribe(()=>{})),i.push(this._currentTransform$.subscribe(()=>{})),i.push(this._reference$.subscribe(()=>{})),i.push(this._currentImageExternal$.subscribe(()=>{})),i.push(this._lastState$.subscribe(()=>{})),i.push(this._inMotion$.subscribe(()=>{})),i.push(this._inTranslation$.subscribe(()=>{})),this._frameId=null,this._frameGenerator=new yae(window)}get currentState$(){return this._currentState$}get currentImage$(){return this._currentImage$}get currentId$(){return this._currentId$}get currentImageExternal$(){return this._currentImageExternal$}get currentCamera$(){return this._currentCamera$}get currentTransform$(){return this._currentTransform$}get state$(){return this._state$}get reference$(){return this._reference$}get inMotion$(){return this._inMotion$}get inTranslation$(){return this._inTranslation$}get appendImage$(){return this._appendImage$}dispose(){this.stop(),this._subscriptions.unsubscribe()}custom(){this._inMotionOperation$.next(!0),this._invokeContextOperation(e=>{e.custom()})}earth(){this._inMotionOperation$.next(!0),this._invokeContextOperation(e=>{e.earth()})}traverse(){this._inMotionOperation$.next(!0),this._invokeContextOperation(e=>{e.traverse()})}wait(){this._invokeContextOperation(e=>{e.wait()})}waitInteractively(){this._invokeContextOperation(e=>{e.waitInteractively()})}appendImagess(e){this._invokeContextOperation(t=>{t.append(e)})}prependImages(e){this._invokeContextOperation(t=>{t.prepend(e)})}removeImages(e){this._invokeContextOperation(t=>{t.remove(e)})}clearImages(){this._invokeContextOperation(e=>{e.clear()})}clearPriorImages(){this._invokeContextOperation(e=>{e.clearPrior()})}cutImages(){this._invokeContextOperation(e=>{e.cut()})}setImages(e){this._invokeContextOperation(t=>{t.set(e)})}setViewMatrix(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(t=>{t.setViewMatrix(e)})}rotate(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(t=>{t.rotate(e)})}rotateUnbounded(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(t=>{t.rotateUnbounded(e)})}rotateWithoutInertia(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(t=>{t.rotateWithoutInertia(e)})}rotateBasic(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(t=>{t.rotateBasic(e)})}rotateBasicUnbounded(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(t=>{t.rotateBasicUnbounded(e)})}rotateBasicWithoutInertia(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(t=>{t.rotateBasicWithoutInertia(e)})}rotateToBasic(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(t=>{t.rotateToBasic(e)})}move(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(t=>{t.move(e)})}moveTo(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(t=>{t.moveTo(e)})}dolly(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(t=>{t.dolly(e)})}orbit(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(t=>{t.orbit(e)})}truck(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(t=>{t.truck(e)})}zoomIn(e,t){this._inMotionOperation$.next(!0),this._invokeContextOperation(i=>{i.zoomIn(e,t)})}getCenter(){return this._lastState$.pipe(wi(),it(e=>e.state.getCenter()))}getZoom(){return this._lastState$.pipe(wi(),it(e=>e.state.zoom))}setCenter(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(t=>{t.setCenter(e)})}setSpeed(e){this._invokeContextOperation(t=>{t.setSpeed(e)})}setTransitionMode(e){this._invokeContextOperation(t=>{t.setTransitionMode(e)})}setZoom(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(t=>{t.setZoom(e)})}start(){this._clock.start(),this._frameId==null&&(this._start$.next(null),this._frameId=this._frameGenerator.requestAnimationFrame(this._frame.bind(this)),this._frame$.next(this._frameId))}stop(){this._clock.stop(),this._frameId!=null&&(this._frameGenerator.cancelAnimationFrame(this._frameId),this._frameId=null)}_invokeContextOperation(e){this._contextOperation$.next(t=>(e(t),t))}_frame(){this._frameId=this._frameGenerator.requestAnimationFrame(this._frame.bind(this)),this._frame$.next(this._frameId)}}function DN(n){switch(n){case xh.Custom:return Oi.Custom;case xh.Earth:return Oi.Earth;case xh.Street:return Oi.Traversing;default:return null}}class Sae{constructor(e,t,i,r,o,c,s,d){var p;t?this._api=t:e.dataProvider?this._api=new vk(e.dataProvider):this._api=new vk(new tae({accessToken:e.accessToken})),this._graphService=i??new vae(new jy(this.api)),this._loadingName="navigator",this._loadingService=r??new gae;const g=(p=e.cameraControls)!==null&&p!==void 0?p:xh.Street;this._stateService=o??new wae(DN(g),e.transitionMode),this._cacheService=c??new mae(this._graphService,this._stateService,this._api),this._playService=s??new w0(this._graphService,this._stateService),this._panService=d??new _ae(this._graphService,this._stateService,e.combinedPanning),this._idRequested$=new Ah(null),this._movedToId$=new Ah(null),this._request$=null,this._requestSubscription=null,this._imageRequestSubscription=null}get api(){return this._api}get cacheService(){return this._cacheService}get graphService(){return this._graphService}get loadingService(){return this._loadingService}get movedToId$(){return this._movedToId$}get panService(){return this._panService}get playService(){return this._playService}get stateService(){return this._stateService}dispose(){this._abortRequest("viewer removed"),this._cacheService.stop(),this._graphService.dispose(),this._panService.dispose(),this._playService.dispose(),this._stateService.dispose()}moveTo$(e){this._abortRequest(`to id ${e}`),this._loadingService.startLoading(this._loadingName);const t=this._moveTo$(e);return this._makeRequest$(t)}moveDir$(e){this._abortRequest(`in dir ${Vt[e]}`),this._loadingService.startLoading(this._loadingName);const t=this.stateService.currentImage$.pipe(wi(),Hi(i=>([Vt.Next,Vt.Prev].indexOf(e)>-1?i.sequenceEdges$:i.spatialEdges$).pipe(wi(),it(r=>{for(let o of r.edges)if(o.data.direction===e)return o.target;return null}))),Hi(i=>i==null?(this._loadingService.stopLoading(this._loadingName),qx(new Error(`Direction (${e}) does not exist for current image.`))):this._moveTo$(i)));return this._makeRequest$(t)}setFilter$(e){return this._stateService.clearImages(),this._movedToId$.pipe(wi(),Hi(t=>t!=null?this._trajectoryIds$().pipe(Hi(i=>this._graphService.setFilter$(e).pipe(Hi(()=>this._cacheIds$(i)))),qg()):this._idRequested$.pipe(wi(),Hi(i=>i!=null?this._graphService.setFilter$(e).pipe(Hi(()=>this._graphService.cacheImage$(i))):this._graphService.setFilter$(e).pipe(it(()=>{}))))),it(()=>{}))}setAccessToken$(e){return this._abortRequest("to set user token"),this._stateService.clearImages(),this._movedToId$.pipe(wi(),Dr(()=>{this._api.setAccessToken(e)}),Hi(t=>t==null?this._graphService.reset$([]):this._trajectoryIds$().pipe(Hi(i=>this._graphService.reset$(i).pipe(Hi(()=>this._cacheIds$(i)))),qg(),it(()=>{}))))}_cacheIds$(e){const t=e.map(i=>this._graphService.cacheImage$(i));return Fr(t).pipe(op())}_abortRequest(e){this._requestSubscription!=null&&(this._requestSubscription.unsubscribe(),this._requestSubscription=null),this._imageRequestSubscription!=null&&(this._imageRequestSubscription.unsubscribe(),this._imageRequestSubscription=null),this._request$!=null&&(this._request$.isStopped||this._request$.hasError||this._request$.error(new Vl(`Request aborted by a subsequent request ${e}.`)),this._request$=null)}_makeRequest$(e){const t=new bO(1);return this._requestSubscription=t.subscribe(void 0,()=>{}),this._request$=t,this._imageRequestSubscription=e.subscribe(i=>{this._request$=null,t.next(i),t.complete()},i=>{this._request$=null,t.error(i)}),t}_moveTo$(e){return this._idRequested$.next(e),this._graphService.cacheImage$(e).pipe(Dr(t=>{this._stateService.setImages([t]),this._movedToId$.next(t.id)}),ga(()=>{this._loadingService.stopLoading(this._loadingName)}))}_trajectoryIds$(){return this._stateService.currentState$.pipe(wi(),it(e=>e.state.trajectory.map(t=>t.id)))}}class Tae{constructor(e,t){this._spatial=t??new vo,this._viewportCoords=e??new zo}basicToCanvas(e,t,i,r){return this._viewportCoords.basicToCanvasSafe(e[0],e[1],t,r,i.perspective)}canvasToBasic(e,t,i,r){let o=this._viewportCoords.canvasToBasic(e[0],e[1],t,r,i.perspective);return(o[0]<0||o[0]>1||o[1]<0||o[1]>1)&&(o=null),o}eventToUnprojection(e,t,i,r,o){const c=this._viewportCoords.canvasPosition(e,t);return this.canvasToUnprojection(c,t,i,r,o)}canvasToUnprojection(e,t,i,r,o){const c=e[0],s=e[1],[d,p]=this._viewportCoords.canvasToViewport(c,s,t),g=new Ue(d,p,1).unproject(i.perspective);let _=o.projectBasic(g.toArray());(_[0]<0||_[0]>1||_[1]<0||_[1]>1)&&(_=null);const x=g.clone().sub(i.camera.position).normalize(),b=-2/x.z;let S=null;if(b>0&&b<100&&_){const L=x.clone().multiplyScalar(b).add(i.camera.position),[E,C]=_p(L.x,L.y,L.z,r.lng,r.lat,r.alt);S={lat:C,lng:E}}return{basicPoint:_,lngLat:S,pixelPoint:[c,s]}}cameraToLngLat(e,t){const i=e.camera.position,[r,o]=_p(i.x,i.y,i.z,t.lng,t.lat,t.alt);return{lat:o,lng:r}}lngLatToCanvas(e,t,i,r){const o=ta(e.lng,e.lat,0,r.lng,r.lat,r.alt);return this._viewportCoords.projectToCanvasSafe(o,t,i.perspective)}distanceBetweenLngLats(e,t){return this._spatial.distanceFromLngLat(e.lng,e.lat,t.lng,t.lat)}}class Mae{constructor(e,t,i){this._subscriptions=new yo,this._emitSubscriptions=new yo,this._container=i,this._viewer=e,this._navigator=t,this._projection=new Tae,this._started=!1,this._navigable$=new ri;const r=this._subscriptions;r.push(this._navigable$.subscribe(o=>{const c="navigable",s={navigable:o,target:this._viewer,type:c};this._viewer.fire(c,s)})),r.push(this._navigator.loadingService.loading$.subscribe(o=>{const c="dataloading",s={loading:o,target:this._viewer,type:c};this._viewer.fire(c,s)})),r.push(this._container.glRenderer.opaqueRender$.pipe(wi()).subscribe(()=>{const o="load",c={target:this._viewer,type:o};this._viewer.fire(o,c)}))}get started(){return this._started}get navigable$(){return this._navigable$}get projection(){return this._projection}dispose(){this.stopEmit(),this._subscriptions.unsubscribe()}project$(e){return Si(this._container.renderService.renderCamera$,this._navigator.stateService.currentImage$,this._navigator.stateService.reference$).pipe(wi(),it(([t,i,r])=>{if(this._projection.distanceBetweenLngLats(e,i.lngLat)>1e3)return null;const o=this._projection.lngLatToCanvas(e,this._container.container,t,r);return o?[Math.round(o[0]),Math.round(o[1])]:null}))}projectBasic$(e){return Si(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$).pipe(wi(),it(([t,i])=>{const r=this._projection.basicToCanvas(e,this._container.container,t,i);return r?[Math.round(r[0]),Math.round(r[1])]:null}))}startEmit(){if(this._started)return;this._started=!0;const e=this._emitSubscriptions;e.push(this._navigator.stateService.currentImageExternal$.subscribe(i=>{const r="image",o={image:i,target:this._viewer,type:r};this._viewer.fire(r,o)})),e.push(this._navigator.stateService.currentImageExternal$.pipe(ei(i=>i.sequenceEdges$)).subscribe(i=>{const r="sequenceedges",o={status:i,target:this._viewer,type:r};this._viewer.fire(r,o)})),e.push(this._navigator.stateService.currentImageExternal$.pipe(ei(i=>i.spatialEdges$)).subscribe(i=>{const r="spatialedges",o={status:i,target:this._viewer,type:r};this._viewer.fire(r,o)})),e.push(this._navigator.stateService.reference$.subscribe(i=>{const r="reference",o={reference:i,target:this._viewer,type:r};this._viewer.fire(r,o)})),e.push(Si(this._navigator.stateService.inMotion$,this._container.mouseService.active$,this._container.touchService.active$).pipe(it(i=>i[0]||i[1]||i[2]),yi()).subscribe(i=>{const r=i?"movestart":"moveend",o={target:this._viewer,type:r};this._viewer.fire(r,o)})),e.push(this._container.renderService.bearing$.pipe(BO(100),yi((i,r)=>Math.abs(r-i)<1)).subscribe(i=>{const r="bearing",o={bearing:i,target:this._viewer,type:r};this._viewer.fire(r,o)}));const t=this._container.mouseService.active$.pipe(ei(i=>i?zi():this._container.mouseService.mouseMove$));e.push(fn(this._mapMouseEvent$("click",this._container.mouseService.staticClick$),this._mapMouseEvent$("contextmenu",this._container.mouseService.contextMenu$),this._mapMouseEvent$("dblclick",this._container.mouseService.dblClick$),this._mapMouseEvent$("mousedown",this._container.mouseService.mouseDown$),this._mapMouseEvent$("mousemove",t),this._mapMouseEvent$("mouseout",this._container.mouseService.mouseOut$),this._mapMouseEvent$("mouseover",this._container.mouseService.mouseOver$),this._mapMouseEvent$("mouseup",this._container.mouseService.mouseUp$)).pipe(Ui(this._container.renderService.renderCamera$,this._navigator.stateService.reference$,this._navigator.stateService.currentTransform$,this._navigator.stateService.state$),it(([[i,r],o,c,s,d])=>{const p=this._projection.eventToUnprojection(r,this._container.container,o,c,s);return{basicPoint:d===Oi.Traversing?p.basicPoint:null,lngLat:p.lngLat,originalEvent:r,pixelPoint:p.pixelPoint,target:this._viewer,type:i}})).subscribe(i=>{this._viewer.fire(i.type,i)})),e.push(this._container.renderService.renderCamera$.pipe(yi(([i,r],[o,c])=>this._closeTo(i,o,.01)&&this._closeTo(r,c,.01),i=>i.camera.position.toArray())).subscribe(()=>{const i="position",r={target:this._viewer,type:i};this._viewer.fire(i,r)})),e.push(this._container.renderService.renderCamera$.pipe(yi(([i,r],[o,c])=>this._closeTo(i,o,.001)&&this._closeTo(r,c,.001),i=>[i.rotation.phi,i.rotation.theta])).subscribe(()=>{const r={target:this._viewer,type:"pov"};this._viewer.fire("pov",r)})),e.push(this._container.renderService.renderCamera$.pipe(yi((i,r)=>this._closeTo(i,r,.01),i=>i.perspective.fov)).subscribe(()=>{const r={target:this._viewer,type:"fov"};this._viewer.fire("fov",r)}))}stopEmit(){this.started&&(this._emitSubscriptions.unsubscribe(),this._started=!1)}unproject$(e){return Si(this._container.renderService.renderCamera$,this._navigator.stateService.reference$,this._navigator.stateService.currentTransform$).pipe(wi(),it(([t,i,r])=>this._projection.canvasToUnprojection(e,this._container.container,t,i,r).lngLat))}unprojectBasic$(e){return Si(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$).pipe(wi(),it(([t,i])=>this._projection.canvasToBasic(e,this._container.container,t,i)))}_closeTo(e,t,i){return Math.abs(e-t)<=i}_mapMouseEvent$(e,t){return t.pipe(it(i=>[e,i]))}}class Cae{constructor(e,t){this._container=e,this._navigator=t,this._renderers={}}add(e,t){const i=new yo;this._renderers[e.id]={subs:i,renderer:e},i.push(Si([this._container.glRenderer.webGLRenderer$,this._navigator.stateService.reference$]).pipe($l(1)).subscribe(([r,o])=>{e.onAdd(t,o,r.getContext())})),i.push(this._container.glRenderer.opaqueRender$.pipe(Ui(this._container.renderService.renderCamera$,this._container.glRenderer.webGLRenderer$)).subscribe(([,r,o])=>{const c=o.getContext(),s=r.perspective.matrixWorldInverse,d=r.perspective.projectionMatrix;e.render(c,s.toArray(),d.toArray())})),i.push(this._navigator.stateService.reference$.pipe(Ys(1)).subscribe(r=>{e.onReference(t,r)}))}dispose(e){for(const t of Object.keys(this._renderers))this.remove(t,e)}has(e){return e in this._renderers}remove(e,t){this._renderers[e].subs.unsubscribe();const i=this._renderers[e].renderer;delete this._renderers[e],this._container.glRenderer.webGLRenderer$.subscribe(r=>{i.onRemove(t,r.getContext())})}}class Eae{constructor(e,t){this._container=e,this._navigator=t,this._controls=null,this._subscriptions=new yo}attach(e,t){if(this._controls)throw new cr("Custom camera controls already attached");this._controls=e;const i=new ri,r=i.pipe(ei(()=>this._navigator.stateService.state$),it(c=>c===Oi.Custom),yi()),o=this._subscriptions;o.push(r.pipe(An(!1),il(),Ui(this._navigator.stateService.reference$,this._container.renderService.renderCamera$)).subscribe(([[c,s],d,p])=>{s?e.onActivate(t,p.perspective.matrixWorldInverse.toArray(),p.perspective.projectionMatrix.toArray(),d):c&&e.onDeactivate(t)})),o.push(r.pipe(ei(c=>c?this._navigator.stateService.currentState$.pipe(Ys(1)):zi())).subscribe(c=>{e.onAnimationFrame(t,c.id)})),o.push(r.pipe(ei(c=>c?this._navigator.stateService.reference$.pipe(Ys(1)):zi())).subscribe(c=>e.onReference(t,c))),o.push(r.pipe(ei(c=>c?this._container.renderService.size$.pipe(Ys(1)):zi())).subscribe(()=>e.onResize(t))),o.push(Si([this._container.glRenderer.webGLRenderer$,this._container.renderService.renderCamera$,this._navigator.stateService.reference$,this._navigator.stateService.state$]).pipe(wi()).subscribe(()=>{const c=d=>{!this._controls||e!==this._controls||this._updateProjectionMatrix(d)},s=d=>{!this._controls||e!==this._controls||this._updateViewMatrix(d)};e.onAttach(t,s,c),i.next(),i.complete()}))}detach(e){const t=this._controls;return this._controls=null,this._subscriptions.unsubscribe(),new Promise(i=>{this._navigator.stateService.state$.pipe($l(1)).subscribe(r=>{if(!t){i(null);return}r===Oi.Custom&&t.onDeactivate(e),t.onDetach(e),i(t)})})}dispose(e){this.detach(e)}has(e){return!!this._controls&&e===this._controls}_updateProjectionMatrix(e){this._navigator.stateService.state$.pipe(wi()).subscribe(t=>{if(t!==Oi.Custom){console.warn("Incorrect camera control mode for projection matrix update");return}this._container.renderService.projectionMatrix$.next(e)})}_updateViewMatrix(e){this._navigator.stateService.state$.pipe(wi()).subscribe(t=>{if(t!==Oi.Custom){console.warn("Incorrect camera control mode for view matrix update");return}this._navigator.stateService.setViewMatrix(e)})}}class Aae extends S1{constructor(e){super(),this._navigator=new Sae(e),this._container=new pae(e,this._navigator.stateService),this._observer=new Mae(this,this._navigator,this._container),this._componentController=new iae(this._container,this._navigator,this._observer,e.imageId,e.component),this._customRenderer=new Cae(this._container,this._navigator),this._customCameraControls=new Eae(this._container,this._navigator)}get dataProvider(){return this._navigator.api.data}get isNavigable(){return this._componentController.navigable}activateCombinedPanning(){this._navigator.panService.enable()}activateComponent(e){this._componentController.activate(e)}activateCover(){this._componentController.activateCover()}addCustomRenderer(e){this._customRenderer.add(e,this)}attachCustomCameraControls(e){this._customCameraControls.attach(e,this)}deactivateCombinedPanning(){this._navigator.panService.disable()}deactivateComponent(e){this._componentController.deactivate(e)}deactivateCover(){this._componentController.deactivateCover()}detachCustomCameraControls(){return this._customCameraControls.detach(this)}fire(e,t){super.fire(e,t)}getBearing(){return new Promise((e,t)=>{this._container.renderService.bearing$.pipe(wi()).subscribe(i=>{e(i)},i=>{t(i)})})}getCameraControls(){return new Promise((e,t)=>{this._navigator.stateService.state$.pipe(wi()).subscribe(i=>{switch(i){case Oi.Custom:e(xh.Custom);break;case Oi.Earth:e(xh.Earth);break;default:e(xh.Street);break}},i=>{t(i)})})}getCanvas(){return this._container.canvas}getCanvasContainer(){return this._container.canvasContainer}getCenter(){return new Promise((e,t)=>{this._navigator.stateService.getCenter().subscribe(i=>{e(i)},i=>{t(i)})})}getComponent(e){return this._componentController.get(e)}getContainer(){return this._container.container}getFieldOfView(){return new Promise((e,t)=>{this._container.renderService.renderCamera$.pipe(wi()).subscribe(i=>{e(i.perspective.fov)},i=>{t(i)})})}getImage(){return new Promise((e,t)=>{this._navigator.stateService.currentImage$.pipe(wi()).subscribe(i=>{e(i)},i=>{t(i)})})}getPointOfView(){return new Promise((e,t)=>{Si(this._container.renderService.renderCamera$,this._container.renderService.bearing$).pipe(wi()).subscribe(([i,r])=>{e({bearing:r,tilt:i.getTilt()})},i=>{t(i)})})}getPosition(){return new Promise((e,t)=>{Si(this._container.renderService.renderCamera$,this._navigator.stateService.reference$).pipe(wi()).subscribe(([i,r])=>{e(this._observer.projection.cameraToLngLat(i,r))},i=>{t(i)})})}getReference(){return new Promise((e,t)=>{this._navigator.stateService.reference$.pipe(wi()).subscribe(i=>{e(i)},i=>{t(i)})})}getZoom(){return new Promise((e,t)=>{this._navigator.stateService.getZoom().subscribe(i=>{e(i)},i=>{t(i)})})}hasCustomCameraControls(e){return this._customCameraControls.has(e)}hasCustomRenderer(e){return this._customRenderer.has(e)}moveDir(e){const t=this.isNavigable?this._navigator.moveDir$(e):qx(new Error("Calling moveDir is not supported when viewer is not navigable."));return new Promise((i,r)=>{t.subscribe(o=>{i(o)},o=>{r(o)})})}moveTo(e){const t=this.isNavigable?this._navigator.moveTo$(e):qx(new Error("Calling moveTo is not supported when viewer is not navigable."));return new Promise((i,r)=>{t.subscribe(o=>{i(o)},o=>{r(o)})})}off(e,t){super.off(e,t)}on(e,t){super.on(e,t)}project(e){return new Promise((t,i)=>{this._observer.project$(e).subscribe(r=>{t(r)},r=>{i(r)})})}projectFromBasic(e){return new Promise((t,i)=>{this._observer.projectBasic$(e).subscribe(r=>{t(r)},r=>{i(r)})})}remove(){this._customRenderer.dispose(this),this._customCameraControls.dispose(this),this._observer.dispose(),this._componentController.remove(),this._navigator.dispose(),this._container.remove();const e="remove",t={target:this,type:e};this.fire(e,t)}removeCustomRenderer(e){this._customRenderer.remove(e,this)}resize(){this._container.renderService.resize$.next()}setCameraControls(e){const t=DN(e);t===Oi.Traversing?this._navigator.stateService.traverse():t===Oi.Earth?this._navigator.stateService.earth():t===Oi.Custom?this._navigator.stateService.custom():console.warn(`Unsupported camera control transition (${e})`)}setCenter(e){this._navigator.stateService.setCenter(e)}setFieldOfView(e){this._container.renderService.renderCamera$.pipe(wi()).subscribe(t=>{const i=t.fovToZoom(e);this._navigator.stateService.setZoom(i)})}setFilter(e){return new Promise((t,i)=>{this._navigator.setFilter$(e).subscribe(()=>{t(void 0)},r=>{i(r)})})}setRenderMode(e){this._container.renderService.renderMode$.next(e)}setTransitionMode(e){this._navigator.stateService.setTransitionMode(e)}setAccessToken(e){const t=this.isNavigable?this._navigator.setAccessToken$(e):qx(new Error("Calling setAccessToken is not supported when viewer is not navigable."));return new Promise((i,r)=>{t.subscribe(()=>{i(void 0)},o=>{r(o)})})}setZoom(e){this._navigator.stateService.setZoom(e)}triggerRerender(){this._container.glRenderer.triggerRerender()}unproject(e){return new Promise((t,i)=>{this._observer.unproject$(e).subscribe(r=>{t(r)},r=>{i(r)})})}unprojectToBasic(e){return new Promise((t,i)=>{this._observer.unprojectBasic$(e).subscribe(r=>{t(r)},r=>{i(r)})})}}jy.register(Xz);Gy.register(Xz);Mr.registerCover(EB);Mr.register(AB);Mr.register(PB);Mr.register(IB);Mr.register(RB);Mr.register(NB);Mr.register($B);Mr.register(VB);Mr.register(jB);Mr.register(GB);Mr.register(qB);Mr.register(WB);Mr.register(XB);Mr.register(uN);Mr.register(hN);Mr.register(dN);Mr.register(fN);const Pae="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20100%20100'%20height='256'%20width='256'%20version='1.1'%3e%3cpath%20d='M0,0%20h100%20v100%20h-100z'%20fill='%2335af6d'/%3e%3cpath%20d='M42.71,66.19A2.5,2.5%200,0,1%2039.32,67.2L5.08,48.69A2.5,2.5%200,0,1%205.48,44.12L33.27,34.85A2.5,2.5%200,0,0%2034.85,33.27L44.12,5.48A2.5,2.5%200,0,1%2048.69,5.08L67.2,39.32A2.5,2.5%200,0,1%2066.19,42.71L61.79,45.09A2.5,2.5%200,0,1%2058.4,44.08L50.88,30.15A2.5,2.5%200,0,0%2046.3,30.55L42.76,41.18A2.5,2.5%200,0,1%2041.18,42.76L30.55,46.3A2.5,2.5%200,0,0%2030.15,50.88L44.08,58.4A2.5,2.5%200,0,1%2045.09,61.79zM68.33,46.67A2.5,2.5%200,0,1%2071.72,47.68L96.01,92.63A2.5,2.5%200,0,1%2092.63,96.01L47.68,71.72A2.5,2.5%200,0,1%2046.67,68.33L49.05,63.93A2.5,2.5%200,0,1%2052.43,62.92L67.89,71.27A2.5,2.5%200,0,0%2071.27,67.89L62.92,52.43A2.5,2.5%200,0,1%2063.93,49.05z'%20fill='%23fff'%20transform='scale(.79)%20translate(10.5,10.5)'/%3e%3c/svg%3e";function FN(n,e,t,i={}){const r=Tg(n),o=fh(r[0]),c=fh(r[1]),s=fh(t),d=kV(e,i.units),p=Math.asin(Math.sin(c)*Math.cos(d)+Math.cos(c)*Math.sin(d)*Math.cos(s)),g=o+Math.atan2(Math.sin(s)*Math.sin(d)*Math.cos(c),Math.cos(d)-Math.sin(c)*Math.sin(p)),_=nw(g),x=nw(p);return r[2]!==void 0?Yf([_,x,r[2]],i.properties):Yf([_,x],i.properties)}function Iae(n,e,t={}){const i=t.steps||64,r=t.properties?t.properties:!Array.isArray(n)&&n.type==="Feature"&&n.properties?n.properties:{},o=[];for(let c=0;c<i;c++)o.push(FN(n,e,c*-360/i,t).geometry.coordinates);return o.push(o[0]),RV([o],r)}function Rae(n,e,t,i,r={}){const o=r.steps||64,c=Mk(t),s=Mk(i),d=!Array.isArray(n)&&n.type==="Feature"?n.properties:{};if(c===s)return YP(Iae(n,e,r).geometry.coordinates[0],d);const p=c,g=c<s?s:s+360;let _=p;const x=[];let b=0;const S=(g-p)/o;for(;_<=g;)x.push(FN(n,e,_,r).geometry.coordinates),b++,_=p+b*S;return YP(x,d)}function Mk(n){let e=n%360;return e<0&&(e+=360),e}var Lae=Rae,kae=qt("<!> <!> <!> <!>",1),Dae=qt("<!> <!>",1),Fae=qt('<button class="btn btn-secondary"><img alt="Mapillary" height="30px"/></button> <!> <!> <div class="viewer-container svelte-cogdew"><button class="btn btn-primary">X</button> <div style="width: 100%; height: 100%"></div></div>',1);function Oae(n,e){Qi(e,!0);let t=ii(!1),i=ii(void 0),r=ii(void 0),o=ii(void 0),c=ii(0);wa(()=>{te(r)?.remove()}),cn(()=>{te(i)&&bs(()=>{Ct(r,new Aae({accessToken:s,container:te(i)}),!0),te(r).on("position",async D=>{let O=await te(r).getPosition();Ct(o,[O.lng,O.lat],!0)}),te(r).on("bearing",D=>{Ct(c,D.bearing,!0)})})});let s="MLY|25548189401504437|3c9576aa434c09888b5de1c28f13b1df";async function d(D){te(r)?.resize(),await te(r)?.moveTo(D)}let p=Kt(()=>{if(!te(o))return no();let O=Lae(Yf(te(o)),30,te(c)-30,te(c)+30,{units:"meters"});return{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[te(o),...O.geometry.coordinates,te(o)]]}}});var g=Fae(),_=ci(g);_.__click=()=>Ct(t,!0);var x=zt(_),b=_t(_,2);AU(b,{tiles:[`https://tiles.mapillary.com/maps/vtp/mly1_public/2/{z}/{x}/{y}?access_token=${s}`],maxzoom:14,children:(D,O)=>{var U=kae(),q=ci(U);{let j=Kt(()=>({visibility:te(t)?"visible":"none"}));zl(q,{sourceLayer:"sequence",paint:{"line-width":2,"line-color":["case",["get","is_pano"],"blue","green"]},get layout(){return te(j)}})}var G=_t(q,2);{let j=Kt(()=>({visibility:te(t)?"visible":"none","icon-image":"chevron","icon-rotate":["get","compass_angle"],"icon-offset":[15,0]}));Vv(G,{minzoom:16,sourceLayer:"image",get layout(){return te(j)}})}var N=_t(G,2);{let j=Kt(()=>({"circle-radius":8,"circle-color":jg("transparent","orange"),"circle-stroke-color":"black","circle-stroke-width":jg(0,2)})),z=Kt(()=>({visibility:te(t)?"visible":"none"}));au(N,{sourceLayer:"image",manageHoverState:!0,get paint(){return te(j)},get layout(){return te(z)},hoverCursor:"pointer",onclick:Q=>d(Q.features[0].properties.id)})}var V=_t(N,2);{let j=Kt(()=>({visibility:te(t)?"visible":"none"}));au(V,{sourceLayer:"image",paint:{"circle-radius":4,"circle-color":["case",["get","is_pano"],"blue","green"],"circle-stroke-color":"black","circle-stroke-width":1},get layout(){return te(j)}})}bt(D,U)},$$slots:{default:!0}});var S=_t(b,2);Hs(S,{get data(){return te(p)},children:(D,O)=>{var U=Dae(),q=ci(U);{let N=Kt(()=>({visibility:te(t)?"visible":"none"}));sC(q,{paint:{"fill-color":"orange","fill-opacity":.8},get layout(){return te(N)}})}var G=_t(q,2);{let N=Kt(()=>({visibility:te(t)?"visible":"none"}));zl(G,{paint:{"line-width":2,"line-color":"black"},get layout(){return te(N)}})}bt(D,U)},$$slots:{default:!0}});var P=_t(S,2);let L;var E=zt(P);E.__click=()=>Ct(t,!1);var C=_t(E,2);wc(C,D=>Ct(i,D),()=>te(i)),Zi(()=>{_.disabled=te(t),Bl(x,"src",Pae),L=_h(P,"",L,{visibility:te(t)?"visible":"hidden"})}),bt(n,g),en()}ds(["click"]);var zae=qt('<div class="action-bar svelte-1pbywzu"><!> <!> <!> <!></div>');function Bae(n,e){Qi(e,!0);let t=ft(e,"basemap",15),i="60px";var r=zae();_h(r,"",{},{bottom:i});var o=zt(r);b7(o,{get basemap(){return t()},set basemap(p){t(p)}});var c=_t(o,2);P7(c,{});var s=_t(c,2);Oae(s,{});var d=_t(s,2);V7(d),bt(n,r),en()}let cp={RoadWithSeparate:"purple",RoadWithTags:"blue",RoadWithoutSidewalksExplicit:"#8B4000",RoadWithoutSidewalksImplicit:"orange",RoadUnknown:"#ff69b4",Sidewalk:"black",Crossing:"green",Other:"grey"},Nae={RoadWithSeparate:"With separate sidewalks",RoadWithTags:"With tagged sidewalks",RoadWithoutSidewalksExplicit:"Tagged as no sidewalks",RoadWithoutSidewalksImplicit:"Assumed as no sidewalks",RoadUnknown:"Totally unknown",Sidewalk:"Separate sidewalk",Crossing:"Crossing",Other:"Other"};function Qf(n){return["interpolate",["linear"],["zoom"],5,.5+n,10,1+n,12,1.5+n,14,4+n,16,Ry(["get","kind"],{Sidewalk:4+n,Crossing:5+n,Other:5+n},7+n),20,Ry(["get","kind"],{Sidewalk:7+n,Crossing:10+n,Other:10+n},24+n)]}var $ae=qt("<!> <!>",1),Vae=qt("<!> <!>",1),Uae=qt("<!> <!> <!> <!> <!> <!> <!> <!>",1);function jae(n,e){Qi(e,!0);const t=()=>nn(Dh,"$map",c),i=()=>nn(zs,"$backend",c),r=()=>nn(vw,"$debugMode",c),o=()=>nn(na,"$mutationCounter",c),[c,s]=is();let d=ft(e,"pinnedWay",15),p=ft(e,"drawProblemDetails",15);function g(G){d(null);for(let N of t().queryRenderedFeatures(G.point,{layers:["speedwalk-ways"]})){d(e.ways.features.find(V=>V.id==N.id));break}}let _=Kt(()=>i()&&d()?JSON.parse(i().getSideLocations(BigInt(d().properties.id))):no());cn(()=>{let G=no();if(d())for(let N of d().properties.problems)G.features=[...G.features,...N.details];p(G)});function x(G){let N=no();if(G)for(let[V,j]of G.properties.node_ids.entries()){let z=e.nodes.features.find(Q=>Q.properties.id==j);N.features.push({type:"Feature",geometry:z.geometry,properties:{idx:V}})}return N}function b(G,N){if(!G||!N)return no();let V=parseInt(G.properties.tags["tmp:closest_way"]);if(!V)return no();for(let j of e.ways.features)if(j.properties.id==V){let z=JSON.parse(JSON.stringify(j));return z.properties.left=G.properties.tags["tmp:side"]=="Left",{type:"FeatureCollection",features:[z]}}return no()}var S=Uae(),P=ci(S);uF(P,{onclick:g});var L=_t(P,2);{let G=Kt(()=>d()||no());Hs(L,{get data(){return te(G)},children:(N,V)=>{var j=$ae(),z=ci(j);{let X=Kt(()=>({"line-width":Qf(10),"line-color":"cyan","line-opacity":.5}));zl(z,{beforeId:"Road labels",get paint(){return te(X)}})}var Q=_t(z,2);Vv(Q,{minzoom:12,layout:{"icon-image":"arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0}}),bt(N,j)},$$slots:{default:!0}})}var E=_t(L,2);{let G=Kt(()=>b(d(),r()));Hs(E,{get data(){return te(G)},children:(N,V)=>{{let j=Kt(()=>({"line-width":Qf(10),"line-color":"blue","line-opacity":.5,"line-offset":["case",["get","left"],-5,5]}));zl(N,{beforeId:"Road labels",get paint(){return te(j)}})}},$$slots:{default:!0}})}var C=_t(E,2);Hs(C,{get data(){return e.ways},children:(G,N)=>{{let V=Kt(()=>({"line-width":Qf(0),"line-color":Ry(["get","kind"],cp,"cyan")}));zl(G,{id:"speedwalk-ways",beforeId:"Road labels",manageHoverState:!0,hoverCursor:"pointer",get filter(){return e.filterWays},get paint(){return te(V)}})}},$$slots:{default:!0}});var D=_t(C,2);s0(D,o,G=>{{let N=Kt(()=>i()?JSON.parse(i().getRoadSides()):no());Hs(G,{get data(){return te(N)},children:(V,j)=>{{let z=Kt(()=>({visibility:e.showRoadSides?"visible":"none","text-field":["get","sidewalks"],"text-size":15,"symbol-placement":"line","symbol-spacing":30,"text-allow-overlap":!0,"text-rotation-alignment":"viewport"}));Vv(V,{minzoom:16,paint:{"text-color":"white","text-halo-color":"black","text-halo-width":2},get layout(){return te(z)}})}},$$slots:{default:!0}})}});var O=_t(D,2);Hs(O,{get data(){return te(_)},children:(G,N)=>{Vv(G,{paint:{"text-color":"black","text-halo-color":"cyan","text-halo-width":4},layout:{"text-field":["get","side"],"text-size":16,"symbol-placement":"line"}})},$$slots:{default:!0}});var U=_t(O,2);{let G=Kt(()=>x(d()));Hs(U,{get data(){return te(G)},children:(N,V)=>{{let j=Kt(()=>({"text-field":["get","idx"],"text-size":16,visibility:r()?"visible":"none"}));Vv(N,{paint:{"text-color":"white","text-halo-color":"blue","text-halo-width":5},get layout(){return te(j)}})}},$$slots:{default:!0}})}var q=_t(U,2);Hs(q,{get data(){return p()},children:(G,N)=>{var V=Vae(),j=ci(V);{let Q=Kt(()=>({visibility:e.showProblemDetails?"visible":"none"}));au(j,{get filter(){return WF},paint:{"circle-radius":20,"circle-color":["get","color"],"circle-opacity":.5},get layout(){return te(Q)}})}var z=_t(j,2);{let Q=Kt(()=>({"line-width":Qf(5),"line-color":["get","color"],"line-opacity":.5})),X=Kt(()=>({visibility:e.showProblemDetails?"visible":"none"}));zl(z,{get filter(){return HM},get paint(){return te(Q)},get layout(){return te(X)}})}bt(G,V)},$$slots:{default:!0}}),bt(n,S),en(),s()}const ho=[];for(let n=0;n<256;++n)ho.push((n+256).toString(16).slice(1));function Gae(n,e=0){return(ho[n[e+0]]+ho[n[e+1]]+ho[n[e+2]]+ho[n[e+3]]+"-"+ho[n[e+4]]+ho[n[e+5]]+"-"+ho[n[e+6]]+ho[n[e+7]]+"-"+ho[n[e+8]]+ho[n[e+9]]+"-"+ho[n[e+10]]+ho[n[e+11]]+ho[n[e+12]]+ho[n[e+13]]+ho[n[e+14]]+ho[n[e+15]]).toLowerCase()}let SM;const qae=new Uint8Array(16);function Wae(){if(!SM){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");SM=crypto.getRandomValues.bind(crypto)}return SM(qae)}const Hae=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ck={randomUUID:Hae};function Zae(n,e,t){n=n||{};const i=n.random??n.rng?.()??Wae();if(i.length<16)throw new Error("Random bytes length must be >= 16");return i[6]=i[6]&15|64,i[8]=i[8]&63|128,Gae(i)}function Xae(n,e,t){return Ck.randomUUID&&!n?Ck.randomUUID():Zae(n)}var Yae=qt('<div class="accordion mb-3"><div class="accordion-item"><div class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" aria-expanded="true"><!></button></div> <div><div class="accordion-body"><!></div></div></div></div>');function qd(n,e){Qi(e,!0);let t=ft(e,"open",3,!0),i=Xae();var r=Yae(),o=zt(r),c=zt(o),s=zt(c),d=zt(s);hs(d,()=>e.header);var p=_t(c,2);let g;var _=zt(p),x=zt(_);hs(x,()=>e.body),Zi(()=>{Bl(s,"data-bs-target",`#${i}`),Bl(s,"aria-controls",i),Bl(p,"id",i),g=fp(p,1,"accordion-collapse collapse",null,g,{show:t()})}),bt(n,r),en()}var Kae=qt("<option> </option>"),Jae=qt('<button class="btn btn-sm btn-primary">Pick next</button>'),Qae=qt('<div class="problem-header svelte-fc5ubw"><p class="problem-count svelte-fc5ubw"> </p> <!></div>'),ele=qt(`<p>When a crossing way hits a road, the node should be tagged as a
        crossing. Instructions to fix are TODO.</p>`),tle=qt(`<p>Here are places where part of a road has separate sidewalks tagged, but
        then the next part of the road doesn't. It's best to be consistent about
        separate sidewalks along the entire length of a road. To fix:</p> <ol><li>Go map separate sidewalks along the entire road (in another editor)</li> <li>Update the road tagging to indicate those separate sidewalks (here or
          in another editor)</li> <li>Refresh the data here to verify</li></ol> <p>(This problem is detected when the road names are the same, so there are
        some false positives you can ignore.)</p>`,1),ile=qt(`<p>Here are footways with a crossing node, but the way needs to be split
        and tagged as <i>footway=crossing</i> .</p> <ol><li>Open in another editor</li> <li>Split the way around the crossing</li> <li>Tag <i>footway=crossing</i> on the smaller segment</li> <li>Refresh the data here to verify</li></ol>`,1),nle=qt(`<p>These roads aren't tagged as having separate sidewalks, but it looks
        like there's a parallel separate sidewalk already mapped.</p> <ol><li>Check each segment. If separate sidewalks are already there, update
          the tagging here.</li> <li>If the separate sidewalks don't cover the entire length of the road,
          ideally go finish drawing the separate sidewalks in another tool, then
          update the tagging on the road.</li></ol> <p>There are false positives. Check the full length of the road.</p>`,1),rle=qt(`<p><i>sidewalk=separate</i> is ambiguous. Update the tagging to specify if there are separate sidewalks
        on both sides or just one.</p>`),sle=qt(`<p>These roads have separate sidewalks tagged on one side, but the other
        side is unspecified or not drawn separately. Be consistent on each road
        and use another editor to draw separate sidewalks on both sides.</p>`),ole=qt('<select class="form-select"><option>Show a type of problem</option><!></select> <!> <!>',1);function ale(n,e){Qi(e,!0);const t=()=>nn(Dh,"$map",i),[i,r]=is();let o=ft(e,"drawProblems",15),c=["missing crossing node","separate sidewalks should be continued here"],s=["missing footway=crossing","possible separate sidewalk near way without it tagged","sidewalk=separate is ambiguous about the side","sidewalk:left and sidewalk:right should each be tagged as separate or no"],d=Kt(()=>{let x={};for(let b of[...c,...s])x[b]=0;for(let b of[...e.nodes.features,...e.ways.features])for(let S of b.properties.problems)x[S.note]+=1;return x}),p=ii(""),g=ii(0);cn(()=>{let x={type:"FeatureCollection",features:[]};for(let b of[...e.nodes.features,...e.ways.features])b.properties.problems.some(S=>S.note==te(p))&&x.features.push(b);o(x)});function _(){if(!t()||!te(p)||o().features.length===0)return;const x=o().features[te(g)];Ct(g,(te(g)+1)%o().features.length);try{if(x.geometry.type==="Point"){const b=x.geometry.coordinates;t().flyTo({center:[b[0],b[1]],zoom:19,animate:!0})}else{const b=HF(x);t().fitBounds(b,{animate:!0,padding:50})}}catch(b){console.error("Error focusing on problem:",b)}}qd(n,{header:S=>{var P=Nn("Problems");bt(S,P)},body:S=>{var P=ole(),L=ci(P),E=zt(L);E.value=E.__value="";var C=_t(E);ws(C,17,()=>Object.entries(te(d)),xs,(N,V)=>{var j=Kt(()=>tl(te(V),2));let z=()=>te(j)[0],Q=()=>te(j)[1];var X=Kae(),re=zt(X),se={};Zi(()=>{X.disabled=Q()==0,sn(re,`${z()??""} (${Q()??""})`),se!==(se=z())&&(X.value=(X.__value=z())??"")}),bt(N,X)});var D=_t(L,2);{var O=N=>{var V=Qae(),j=zt(V),z=zt(j),Q=_t(j,2);{var X=re=>{var se=Jae();se.__click=_,bt(re,se)};Ji(Q,re=>{o().features.length>0&&re(X)})}Zi(()=>sn(z,`${te(d)[te(p)]??""} problems`)),bt(N,V)};Ji(D,N=>{te(p)&&N(O)})}var U=_t(D,2);{var q=N=>{var V=ele();bt(N,V)},G=N=>{var V=tr(),j=ci(V);{var z=X=>{var re=tle();bt(X,re)},Q=X=>{var re=tr(),se=ci(re);{var le=be=>{var Ee=ile();bt(be,Ee)},ce=be=>{var Ee=tr(),$e=ci(Ee);{var Ve=He=>{var De=nle();bt(He,De)},nt=He=>{var De=tr(),ot=ci(De);{var xe=Je=>{var ct=rle();bt(Je,ct)},Be=Je=>{var ct=tr(),xt=ci(ct);{var Se=me=>{var qe=sle();bt(me,qe)};Ji(xt,me=>{te(p)=="sidewalk:left and sidewalk:right should each be tagged as separate or no"&&me(Se)},!0)}bt(Je,ct)};Ji(ot,Je=>{te(p)=="sidewalk=separate is ambiguous about the side"?Je(xe):Je(Be,!1)},!0)}bt(He,De)};Ji($e,He=>{te(p)=="possible separate sidewalk near way without it tagged"?He(Ve):He(nt,!1)},!0)}bt(be,Ee)};Ji(se,be=>{te(p)=="missing footway=crossing"?be(le):be(ce,!1)},!0)}bt(X,re)};Ji(j,X=>{te(p)=="separate sidewalks should be continued here"?X(z):X(Q,!1)},!0)}bt(N,V)};Ji(U,N=>{te(p)=="missing crossing node"?N(q):N(G,!1)})}A6(L,()=>te(p),N=>{Ct(p,N,!0),Ct(g,0)}),bt(S,P)},$$slots:{header:!0,body:!0}}),en(),r()}ds(["click"]);var lle=qt("<!> <!> <!>",1);function cle(n,e){Qi(e,!0);let t=ii(.5);function i(r){let o=2500,c=.35,s=.85,d=(Math.sin(r/o*Math.PI*2)+1)/2;Ct(t,c+d*(s-c)),requestAnimationFrame(i)}requestAnimationFrame(i),Hs(n,{get data(){return e.drawProblems},children:(r,o)=>{var c=lle(),s=ci(c);au(s,{get filter(){return WF},paint:{"circle-radius":10,"circle-color":"red","circle-opacity":.5,"circle-stroke-color":"black","circle-stroke-width":1}});var d=_t(s,2);{let g=Kt(()=>({"line-width":Qf(15),"line-color":"red","line-opacity":te(t),"line-blur":5})),_=Kt(()=>({visibility:e.pinnedWay?"none":"visible"}));zl(d,{get filter(){return HM},maxzoom:16,get paint(){return te(g)},get layout(){return te(_)}})}var p=_t(d,2);{let g=Kt(()=>({"line-width":Qf(20),"line-color":"red","line-opacity":te(t),"line-blur":5})),_=Kt(()=>({visibility:e.pinnedWay?"none":"visible"}));zl(p,{get filter(){return HM},beforeId:"Road labels",minzoom:16,get paint(){return te(g)},get layout(){return te(_)}})}bt(r,c)},$$slots:{default:!0}}),en()}function kx(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var TM={exports:{}},Ek;function ule(){return Ek||(Ek=1,(function(n,e){(function(t){n.exports=t()})(function(){return(function(){function t(i,r,o){function c(p,g){if(!r[p]){if(!i[p]){var _=typeof kx=="function"&&kx;if(!g&&_)return _(p,!0);if(s)return s(p,!0);var x=new Error("Cannot find module '"+p+"'");throw x.code="MODULE_NOT_FOUND",x}var b=r[p]={exports:{}};i[p][0].call(b.exports,function(S){var P=i[p][1][S];return c(P||S)},b,b.exports,t,i,r,o)}return r[p].exports}for(var s=typeof kx=="function"&&kx,d=0;d<o.length;d++)c(o[d]);return c}return t})()({1:[function(t,i,r){r.byteLength=x,r.toByteArray=S,r.fromByteArray=E;for(var o=[],c=[],s=typeof Uint8Array<"u"?Uint8Array:Array,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",p=0,g=d.length;p<g;++p)o[p]=d[p],c[d.charCodeAt(p)]=p;c[45]=62,c[95]=63;function _(C){var D=C.length;if(D%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var O=C.indexOf("=");O===-1&&(O=D);var U=O===D?0:4-O%4;return[O,U]}function x(C){var D=_(C),O=D[0],U=D[1];return(O+U)*3/4-U}function b(C,D,O){return(D+O)*3/4-O}function S(C){var D,O=_(C),U=O[0],q=O[1],G=new s(b(C,U,q)),N=0,V=q>0?U-4:U,j;for(j=0;j<V;j+=4)D=c[C.charCodeAt(j)]<<18|c[C.charCodeAt(j+1)]<<12|c[C.charCodeAt(j+2)]<<6|c[C.charCodeAt(j+3)],G[N++]=D>>16&255,G[N++]=D>>8&255,G[N++]=D&255;return q===2&&(D=c[C.charCodeAt(j)]<<2|c[C.charCodeAt(j+1)]>>4,G[N++]=D&255),q===1&&(D=c[C.charCodeAt(j)]<<10|c[C.charCodeAt(j+1)]<<4|c[C.charCodeAt(j+2)]>>2,G[N++]=D>>8&255,G[N++]=D&255),G}function P(C){return o[C>>18&63]+o[C>>12&63]+o[C>>6&63]+o[C&63]}function L(C,D,O){for(var U,q=[],G=D;G<O;G+=3)U=(C[G]<<16&16711680)+(C[G+1]<<8&65280)+(C[G+2]&255),q.push(P(U));return q.join("")}function E(C){for(var D,O=C.length,U=O%3,q=[],G=16383,N=0,V=O-U;N<V;N+=G)q.push(L(C,N,N+G>V?V:N+G));return U===1?(D=C[O-1],q.push(o[D>>2]+o[D<<4&63]+"==")):U===2&&(D=(C[O-2]<<8)+C[O-1],q.push(o[D>>10]+o[D>>4&63]+o[D<<2&63]+"=")),q.join("")}},{}],2:[function(t,i,r){(function(o){(function(){var c=t("base64-js"),s=t("ieee754");r.Buffer=_,r.SlowBuffer=U,r.INSPECT_MAX_BYTES=50;var d=2147483647;r.kMaxLength=d,_.TYPED_ARRAY_SUPPORT=p(),!_.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function p(){try{var ye=new Uint8Array(1);return ye.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},ye.foo()===42}catch{return!1}}Object.defineProperty(_.prototype,"parent",{enumerable:!0,get:function(){if(_.isBuffer(this))return this.buffer}}),Object.defineProperty(_.prototype,"offset",{enumerable:!0,get:function(){if(_.isBuffer(this))return this.byteOffset}});function g(ye){if(ye>d)throw new RangeError('The value "'+ye+'" is invalid for option "size"');var ie=new Uint8Array(ye);return ie.__proto__=_.prototype,ie}function _(ye,ie,ae){if(typeof ye=="number"){if(typeof ie=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return P(ye)}return x(ye,ie,ae)}typeof Symbol<"u"&&Symbol.species!=null&&_[Symbol.species]===_&&Object.defineProperty(_,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),_.poolSize=8192;function x(ye,ie,ae){if(typeof ye=="string")return L(ye,ie);if(ArrayBuffer.isView(ye))return E(ye);if(ye==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof ye);if(we(ye,ArrayBuffer)||ye&&we(ye.buffer,ArrayBuffer))return C(ye,ie,ae);if(typeof ye=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var ke=ye.valueOf&&ye.valueOf();if(ke!=null&&ke!==ye)return _.from(ke,ie,ae);var Ze=D(ye);if(Ze)return Ze;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof ye[Symbol.toPrimitive]=="function")return _.from(ye[Symbol.toPrimitive]("string"),ie,ae);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof ye)}_.from=function(ye,ie,ae){return x(ye,ie,ae)},_.prototype.__proto__=Uint8Array.prototype,_.__proto__=Uint8Array;function b(ye){if(typeof ye!="number")throw new TypeError('"size" argument must be of type number');if(ye<0)throw new RangeError('The value "'+ye+'" is invalid for option "size"')}function S(ye,ie,ae){return b(ye),ye<=0?g(ye):ie!==void 0?typeof ae=="string"?g(ye).fill(ie,ae):g(ye).fill(ie):g(ye)}_.alloc=function(ye,ie,ae){return S(ye,ie,ae)};function P(ye){return b(ye),g(ye<0?0:O(ye)|0)}_.allocUnsafe=function(ye){return P(ye)},_.allocUnsafeSlow=function(ye){return P(ye)};function L(ye,ie){if((typeof ie!="string"||ie==="")&&(ie="utf8"),!_.isEncoding(ie))throw new TypeError("Unknown encoding: "+ie);var ae=q(ye,ie)|0,ke=g(ae),Ze=ke.write(ye,ie);return Ze!==ae&&(ke=ke.slice(0,Ze)),ke}function E(ye){for(var ie=ye.length<0?0:O(ye.length)|0,ae=g(ie),ke=0;ke<ie;ke+=1)ae[ke]=ye[ke]&255;return ae}function C(ye,ie,ae){if(ie<0||ye.byteLength<ie)throw new RangeError('"offset" is outside of buffer bounds');if(ye.byteLength<ie+(ae||0))throw new RangeError('"length" is outside of buffer bounds');var ke;return ie===void 0&&ae===void 0?ke=new Uint8Array(ye):ae===void 0?ke=new Uint8Array(ye,ie):ke=new Uint8Array(ye,ie,ae),ke.__proto__=_.prototype,ke}function D(ye){if(_.isBuffer(ye)){var ie=O(ye.length)|0,ae=g(ie);return ae.length===0||ye.copy(ae,0,0,ie),ae}if(ye.length!==void 0)return typeof ye.length!="number"||vt(ye.length)?g(0):E(ye);if(ye.type==="Buffer"&&Array.isArray(ye.data))return E(ye.data)}function O(ye){if(ye>=d)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+d.toString(16)+" bytes");return ye|0}function U(ye){return+ye!=ye&&(ye=0),_.alloc(+ye)}_.isBuffer=function(ie){return ie!=null&&ie._isBuffer===!0&&ie!==_.prototype},_.compare=function(ie,ae){if(we(ie,Uint8Array)&&(ie=_.from(ie,ie.offset,ie.byteLength)),we(ae,Uint8Array)&&(ae=_.from(ae,ae.offset,ae.byteLength)),!_.isBuffer(ie)||!_.isBuffer(ae))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(ie===ae)return 0;for(var ke=ie.length,Ze=ae.length,yt=0,Me=Math.min(ke,Ze);yt<Me;++yt)if(ie[yt]!==ae[yt]){ke=ie[yt],Ze=ae[yt];break}return ke<Ze?-1:Ze<ke?1:0},_.isEncoding=function(ie){switch(String(ie).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},_.concat=function(ie,ae){if(!Array.isArray(ie))throw new TypeError('"list" argument must be an Array of Buffers');if(ie.length===0)return _.alloc(0);var ke;if(ae===void 0)for(ae=0,ke=0;ke<ie.length;++ke)ae+=ie[ke].length;var Ze=_.allocUnsafe(ae),yt=0;for(ke=0;ke<ie.length;++ke){var Me=ie[ke];if(we(Me,Uint8Array)&&(Me=_.from(Me)),!_.isBuffer(Me))throw new TypeError('"list" argument must be an Array of Buffers');Me.copy(Ze,yt),yt+=Me.length}return Ze};function q(ye,ie){if(_.isBuffer(ye))return ye.length;if(ArrayBuffer.isView(ye)||we(ye,ArrayBuffer))return ye.byteLength;if(typeof ye!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof ye);var ae=ye.length,ke=arguments.length>2&&arguments[2]===!0;if(!ke&&ae===0)return 0;for(var Ze=!1;;)switch(ie){case"ascii":case"latin1":case"binary":return ae;case"utf8":case"utf-8":return qe(ye).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ae*2;case"hex":return ae>>>1;case"base64":return gt(ye).length;default:if(Ze)return ke?-1:qe(ye).length;ie=(""+ie).toLowerCase(),Ze=!0}}_.byteLength=q;function G(ye,ie,ae){var ke=!1;if((ie===void 0||ie<0)&&(ie=0),ie>this.length||((ae===void 0||ae>this.length)&&(ae=this.length),ae<=0)||(ae>>>=0,ie>>>=0,ae<=ie))return"";for(ye||(ye="utf8");;)switch(ye){case"hex":return He(this,ie,ae);case"utf8":case"utf-8":return be(this,ie,ae);case"ascii":return Ve(this,ie,ae);case"latin1":case"binary":return nt(this,ie,ae);case"base64":return ce(this,ie,ae);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return De(this,ie,ae);default:if(ke)throw new TypeError("Unknown encoding: "+ye);ye=(ye+"").toLowerCase(),ke=!0}}_.prototype._isBuffer=!0;function N(ye,ie,ae){var ke=ye[ie];ye[ie]=ye[ae],ye[ae]=ke}_.prototype.swap16=function(){var ie=this.length;if(ie%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var ae=0;ae<ie;ae+=2)N(this,ae,ae+1);return this},_.prototype.swap32=function(){var ie=this.length;if(ie%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var ae=0;ae<ie;ae+=4)N(this,ae,ae+3),N(this,ae+1,ae+2);return this},_.prototype.swap64=function(){var ie=this.length;if(ie%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var ae=0;ae<ie;ae+=8)N(this,ae,ae+7),N(this,ae+1,ae+6),N(this,ae+2,ae+5),N(this,ae+3,ae+4);return this},_.prototype.toString=function(){var ie=this.length;return ie===0?"":arguments.length===0?be(this,0,ie):G.apply(this,arguments)},_.prototype.toLocaleString=_.prototype.toString,_.prototype.equals=function(ie){if(!_.isBuffer(ie))throw new TypeError("Argument must be a Buffer");return this===ie?!0:_.compare(this,ie)===0},_.prototype.inspect=function(){var ie="",ae=r.INSPECT_MAX_BYTES;return ie=this.toString("hex",0,ae).replace(/(.{2})/g,"$1 ").trim(),this.length>ae&&(ie+=" ... "),"<Buffer "+ie+">"},_.prototype.compare=function(ie,ae,ke,Ze,yt){if(we(ie,Uint8Array)&&(ie=_.from(ie,ie.offset,ie.byteLength)),!_.isBuffer(ie))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof ie);if(ae===void 0&&(ae=0),ke===void 0&&(ke=ie?ie.length:0),Ze===void 0&&(Ze=0),yt===void 0&&(yt=this.length),ae<0||ke>ie.length||Ze<0||yt>this.length)throw new RangeError("out of range index");if(Ze>=yt&&ae>=ke)return 0;if(Ze>=yt)return-1;if(ae>=ke)return 1;if(ae>>>=0,ke>>>=0,Ze>>>=0,yt>>>=0,this===ie)return 0;for(var Me=yt-Ze,ee=ke-ae,de=Math.min(Me,ee),pe=this.slice(Ze,yt),Le=ie.slice(ae,ke),Oe=0;Oe<de;++Oe)if(pe[Oe]!==Le[Oe]){Me=pe[Oe],ee=Le[Oe];break}return Me<ee?-1:ee<Me?1:0};function V(ye,ie,ae,ke,Ze){if(ye.length===0)return-1;if(typeof ae=="string"?(ke=ae,ae=0):ae>2147483647?ae=2147483647:ae<-2147483648&&(ae=-2147483648),ae=+ae,vt(ae)&&(ae=Ze?0:ye.length-1),ae<0&&(ae=ye.length+ae),ae>=ye.length){if(Ze)return-1;ae=ye.length-1}else if(ae<0)if(Ze)ae=0;else return-1;if(typeof ie=="string"&&(ie=_.from(ie,ke)),_.isBuffer(ie))return ie.length===0?-1:j(ye,ie,ae,ke,Ze);if(typeof ie=="number")return ie=ie&255,typeof Uint8Array.prototype.indexOf=="function"?Ze?Uint8Array.prototype.indexOf.call(ye,ie,ae):Uint8Array.prototype.lastIndexOf.call(ye,ie,ae):j(ye,[ie],ae,ke,Ze);throw new TypeError("val must be string, number or Buffer")}function j(ye,ie,ae,ke,Ze){var yt=1,Me=ye.length,ee=ie.length;if(ke!==void 0&&(ke=String(ke).toLowerCase(),ke==="ucs2"||ke==="ucs-2"||ke==="utf16le"||ke==="utf-16le")){if(ye.length<2||ie.length<2)return-1;yt=2,Me/=2,ee/=2,ae/=2}function de(pt,rt){return yt===1?pt[rt]:pt.readUInt16BE(rt*yt)}var pe;if(Ze){var Le=-1;for(pe=ae;pe<Me;pe++)if(de(ye,pe)===de(ie,Le===-1?0:pe-Le)){if(Le===-1&&(Le=pe),pe-Le+1===ee)return Le*yt}else Le!==-1&&(pe-=pe-Le),Le=-1}else for(ae+ee>Me&&(ae=Me-ee),pe=ae;pe>=0;pe--){for(var Oe=!0,dt=0;dt<ee;dt++)if(de(ye,pe+dt)!==de(ie,dt)){Oe=!1;break}if(Oe)return pe}return-1}_.prototype.includes=function(ie,ae,ke){return this.indexOf(ie,ae,ke)!==-1},_.prototype.indexOf=function(ie,ae,ke){return V(this,ie,ae,ke,!0)},_.prototype.lastIndexOf=function(ie,ae,ke){return V(this,ie,ae,ke,!1)};function z(ye,ie,ae,ke){ae=Number(ae)||0;var Ze=ye.length-ae;ke?(ke=Number(ke),ke>Ze&&(ke=Ze)):ke=Ze;var yt=ie.length;ke>yt/2&&(ke=yt/2);for(var Me=0;Me<ke;++Me){var ee=parseInt(ie.substr(Me*2,2),16);if(vt(ee))return Me;ye[ae+Me]=ee}return Me}function Q(ye,ie,ae,ke){return Ae(qe(ie,ye.length-ae),ye,ae,ke)}function X(ye,ie,ae,ke){return Ae(st(ie),ye,ae,ke)}function re(ye,ie,ae,ke){return X(ye,ie,ae,ke)}function se(ye,ie,ae,ke){return Ae(gt(ie),ye,ae,ke)}function le(ye,ie,ae,ke){return Ae(Rt(ie,ye.length-ae),ye,ae,ke)}_.prototype.write=function(ie,ae,ke,Ze){if(ae===void 0)Ze="utf8",ke=this.length,ae=0;else if(ke===void 0&&typeof ae=="string")Ze=ae,ke=this.length,ae=0;else if(isFinite(ae))ae=ae>>>0,isFinite(ke)?(ke=ke>>>0,Ze===void 0&&(Ze="utf8")):(Ze=ke,ke=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var yt=this.length-ae;if((ke===void 0||ke>yt)&&(ke=yt),ie.length>0&&(ke<0||ae<0)||ae>this.length)throw new RangeError("Attempt to write outside buffer bounds");Ze||(Ze="utf8");for(var Me=!1;;)switch(Ze){case"hex":return z(this,ie,ae,ke);case"utf8":case"utf-8":return Q(this,ie,ae,ke);case"ascii":return X(this,ie,ae,ke);case"latin1":case"binary":return re(this,ie,ae,ke);case"base64":return se(this,ie,ae,ke);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return le(this,ie,ae,ke);default:if(Me)throw new TypeError("Unknown encoding: "+Ze);Ze=(""+Ze).toLowerCase(),Me=!0}},_.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function ce(ye,ie,ae){return ie===0&&ae===ye.length?c.fromByteArray(ye):c.fromByteArray(ye.slice(ie,ae))}function be(ye,ie,ae){ae=Math.min(ye.length,ae);for(var ke=[],Ze=ie;Ze<ae;){var yt=ye[Ze],Me=null,ee=yt>239?4:yt>223?3:yt>191?2:1;if(Ze+ee<=ae){var de,pe,Le,Oe;switch(ee){case 1:yt<128&&(Me=yt);break;case 2:de=ye[Ze+1],(de&192)===128&&(Oe=(yt&31)<<6|de&63,Oe>127&&(Me=Oe));break;case 3:de=ye[Ze+1],pe=ye[Ze+2],(de&192)===128&&(pe&192)===128&&(Oe=(yt&15)<<12|(de&63)<<6|pe&63,Oe>2047&&(Oe<55296||Oe>57343)&&(Me=Oe));break;case 4:de=ye[Ze+1],pe=ye[Ze+2],Le=ye[Ze+3],(de&192)===128&&(pe&192)===128&&(Le&192)===128&&(Oe=(yt&15)<<18|(de&63)<<12|(pe&63)<<6|Le&63,Oe>65535&&Oe<1114112&&(Me=Oe))}}Me===null?(Me=65533,ee=1):Me>65535&&(Me-=65536,ke.push(Me>>>10&1023|55296),Me=56320|Me&1023),ke.push(Me),Ze+=ee}return $e(ke)}var Ee=4096;function $e(ye){var ie=ye.length;if(ie<=Ee)return String.fromCharCode.apply(String,ye);for(var ae="",ke=0;ke<ie;)ae+=String.fromCharCode.apply(String,ye.slice(ke,ke+=Ee));return ae}function Ve(ye,ie,ae){var ke="";ae=Math.min(ye.length,ae);for(var Ze=ie;Ze<ae;++Ze)ke+=String.fromCharCode(ye[Ze]&127);return ke}function nt(ye,ie,ae){var ke="";ae=Math.min(ye.length,ae);for(var Ze=ie;Ze<ae;++Ze)ke+=String.fromCharCode(ye[Ze]);return ke}function He(ye,ie,ae){var ke=ye.length;(!ie||ie<0)&&(ie=0),(!ae||ae<0||ae>ke)&&(ae=ke);for(var Ze="",yt=ie;yt<ae;++yt)Ze+=me(ye[yt]);return Ze}function De(ye,ie,ae){for(var ke=ye.slice(ie,ae),Ze="",yt=0;yt<ke.length;yt+=2)Ze+=String.fromCharCode(ke[yt]+ke[yt+1]*256);return Ze}_.prototype.slice=function(ie,ae){var ke=this.length;ie=~~ie,ae=ae===void 0?ke:~~ae,ie<0?(ie+=ke,ie<0&&(ie=0)):ie>ke&&(ie=ke),ae<0?(ae+=ke,ae<0&&(ae=0)):ae>ke&&(ae=ke),ae<ie&&(ae=ie);var Ze=this.subarray(ie,ae);return Ze.__proto__=_.prototype,Ze};function ot(ye,ie,ae){if(ye%1!==0||ye<0)throw new RangeError("offset is not uint");if(ye+ie>ae)throw new RangeError("Trying to access beyond buffer length")}_.prototype.readUIntLE=function(ie,ae,ke){ie=ie>>>0,ae=ae>>>0,ke||ot(ie,ae,this.length);for(var Ze=this[ie],yt=1,Me=0;++Me<ae&&(yt*=256);)Ze+=this[ie+Me]*yt;return Ze},_.prototype.readUIntBE=function(ie,ae,ke){ie=ie>>>0,ae=ae>>>0,ke||ot(ie,ae,this.length);for(var Ze=this[ie+--ae],yt=1;ae>0&&(yt*=256);)Ze+=this[ie+--ae]*yt;return Ze},_.prototype.readUInt8=function(ie,ae){return ie=ie>>>0,ae||ot(ie,1,this.length),this[ie]},_.prototype.readUInt16LE=function(ie,ae){return ie=ie>>>0,ae||ot(ie,2,this.length),this[ie]|this[ie+1]<<8},_.prototype.readUInt16BE=function(ie,ae){return ie=ie>>>0,ae||ot(ie,2,this.length),this[ie]<<8|this[ie+1]},_.prototype.readUInt32LE=function(ie,ae){return ie=ie>>>0,ae||ot(ie,4,this.length),(this[ie]|this[ie+1]<<8|this[ie+2]<<16)+this[ie+3]*16777216},_.prototype.readUInt32BE=function(ie,ae){return ie=ie>>>0,ae||ot(ie,4,this.length),this[ie]*16777216+(this[ie+1]<<16|this[ie+2]<<8|this[ie+3])},_.prototype.readIntLE=function(ie,ae,ke){ie=ie>>>0,ae=ae>>>0,ke||ot(ie,ae,this.length);for(var Ze=this[ie],yt=1,Me=0;++Me<ae&&(yt*=256);)Ze+=this[ie+Me]*yt;return yt*=128,Ze>=yt&&(Ze-=Math.pow(2,8*ae)),Ze},_.prototype.readIntBE=function(ie,ae,ke){ie=ie>>>0,ae=ae>>>0,ke||ot(ie,ae,this.length);for(var Ze=ae,yt=1,Me=this[ie+--Ze];Ze>0&&(yt*=256);)Me+=this[ie+--Ze]*yt;return yt*=128,Me>=yt&&(Me-=Math.pow(2,8*ae)),Me},_.prototype.readInt8=function(ie,ae){return ie=ie>>>0,ae||ot(ie,1,this.length),this[ie]&128?(255-this[ie]+1)*-1:this[ie]},_.prototype.readInt16LE=function(ie,ae){ie=ie>>>0,ae||ot(ie,2,this.length);var ke=this[ie]|this[ie+1]<<8;return ke&32768?ke|4294901760:ke},_.prototype.readInt16BE=function(ie,ae){ie=ie>>>0,ae||ot(ie,2,this.length);var ke=this[ie+1]|this[ie]<<8;return ke&32768?ke|4294901760:ke},_.prototype.readInt32LE=function(ie,ae){return ie=ie>>>0,ae||ot(ie,4,this.length),this[ie]|this[ie+1]<<8|this[ie+2]<<16|this[ie+3]<<24},_.prototype.readInt32BE=function(ie,ae){return ie=ie>>>0,ae||ot(ie,4,this.length),this[ie]<<24|this[ie+1]<<16|this[ie+2]<<8|this[ie+3]},_.prototype.readFloatLE=function(ie,ae){return ie=ie>>>0,ae||ot(ie,4,this.length),s.read(this,ie,!0,23,4)},_.prototype.readFloatBE=function(ie,ae){return ie=ie>>>0,ae||ot(ie,4,this.length),s.read(this,ie,!1,23,4)},_.prototype.readDoubleLE=function(ie,ae){return ie=ie>>>0,ae||ot(ie,8,this.length),s.read(this,ie,!0,52,8)},_.prototype.readDoubleBE=function(ie,ae){return ie=ie>>>0,ae||ot(ie,8,this.length),s.read(this,ie,!1,52,8)};function xe(ye,ie,ae,ke,Ze,yt){if(!_.isBuffer(ye))throw new TypeError('"buffer" argument must be a Buffer instance');if(ie>Ze||ie<yt)throw new RangeError('"value" argument is out of bounds');if(ae+ke>ye.length)throw new RangeError("Index out of range")}_.prototype.writeUIntLE=function(ie,ae,ke,Ze){if(ie=+ie,ae=ae>>>0,ke=ke>>>0,!Ze){var yt=Math.pow(2,8*ke)-1;xe(this,ie,ae,ke,yt,0)}var Me=1,ee=0;for(this[ae]=ie&255;++ee<ke&&(Me*=256);)this[ae+ee]=ie/Me&255;return ae+ke},_.prototype.writeUIntBE=function(ie,ae,ke,Ze){if(ie=+ie,ae=ae>>>0,ke=ke>>>0,!Ze){var yt=Math.pow(2,8*ke)-1;xe(this,ie,ae,ke,yt,0)}var Me=ke-1,ee=1;for(this[ae+Me]=ie&255;--Me>=0&&(ee*=256);)this[ae+Me]=ie/ee&255;return ae+ke},_.prototype.writeUInt8=function(ie,ae,ke){return ie=+ie,ae=ae>>>0,ke||xe(this,ie,ae,1,255,0),this[ae]=ie&255,ae+1},_.prototype.writeUInt16LE=function(ie,ae,ke){return ie=+ie,ae=ae>>>0,ke||xe(this,ie,ae,2,65535,0),this[ae]=ie&255,this[ae+1]=ie>>>8,ae+2},_.prototype.writeUInt16BE=function(ie,ae,ke){return ie=+ie,ae=ae>>>0,ke||xe(this,ie,ae,2,65535,0),this[ae]=ie>>>8,this[ae+1]=ie&255,ae+2},_.prototype.writeUInt32LE=function(ie,ae,ke){return ie=+ie,ae=ae>>>0,ke||xe(this,ie,ae,4,4294967295,0),this[ae+3]=ie>>>24,this[ae+2]=ie>>>16,this[ae+1]=ie>>>8,this[ae]=ie&255,ae+4},_.prototype.writeUInt32BE=function(ie,ae,ke){return ie=+ie,ae=ae>>>0,ke||xe(this,ie,ae,4,4294967295,0),this[ae]=ie>>>24,this[ae+1]=ie>>>16,this[ae+2]=ie>>>8,this[ae+3]=ie&255,ae+4},_.prototype.writeIntLE=function(ie,ae,ke,Ze){if(ie=+ie,ae=ae>>>0,!Ze){var yt=Math.pow(2,8*ke-1);xe(this,ie,ae,ke,yt-1,-yt)}var Me=0,ee=1,de=0;for(this[ae]=ie&255;++Me<ke&&(ee*=256);)ie<0&&de===0&&this[ae+Me-1]!==0&&(de=1),this[ae+Me]=(ie/ee>>0)-de&255;return ae+ke},_.prototype.writeIntBE=function(ie,ae,ke,Ze){if(ie=+ie,ae=ae>>>0,!Ze){var yt=Math.pow(2,8*ke-1);xe(this,ie,ae,ke,yt-1,-yt)}var Me=ke-1,ee=1,de=0;for(this[ae+Me]=ie&255;--Me>=0&&(ee*=256);)ie<0&&de===0&&this[ae+Me+1]!==0&&(de=1),this[ae+Me]=(ie/ee>>0)-de&255;return ae+ke},_.prototype.writeInt8=function(ie,ae,ke){return ie=+ie,ae=ae>>>0,ke||xe(this,ie,ae,1,127,-128),ie<0&&(ie=255+ie+1),this[ae]=ie&255,ae+1},_.prototype.writeInt16LE=function(ie,ae,ke){return ie=+ie,ae=ae>>>0,ke||xe(this,ie,ae,2,32767,-32768),this[ae]=ie&255,this[ae+1]=ie>>>8,ae+2},_.prototype.writeInt16BE=function(ie,ae,ke){return ie=+ie,ae=ae>>>0,ke||xe(this,ie,ae,2,32767,-32768),this[ae]=ie>>>8,this[ae+1]=ie&255,ae+2},_.prototype.writeInt32LE=function(ie,ae,ke){return ie=+ie,ae=ae>>>0,ke||xe(this,ie,ae,4,2147483647,-2147483648),this[ae]=ie&255,this[ae+1]=ie>>>8,this[ae+2]=ie>>>16,this[ae+3]=ie>>>24,ae+4},_.prototype.writeInt32BE=function(ie,ae,ke){return ie=+ie,ae=ae>>>0,ke||xe(this,ie,ae,4,2147483647,-2147483648),ie<0&&(ie=4294967295+ie+1),this[ae]=ie>>>24,this[ae+1]=ie>>>16,this[ae+2]=ie>>>8,this[ae+3]=ie&255,ae+4};function Be(ye,ie,ae,ke,Ze,yt){if(ae+ke>ye.length)throw new RangeError("Index out of range");if(ae<0)throw new RangeError("Index out of range")}function Je(ye,ie,ae,ke,Ze){return ie=+ie,ae=ae>>>0,Ze||Be(ye,ie,ae,4),s.write(ye,ie,ae,ke,23,4),ae+4}_.prototype.writeFloatLE=function(ie,ae,ke){return Je(this,ie,ae,!0,ke)},_.prototype.writeFloatBE=function(ie,ae,ke){return Je(this,ie,ae,!1,ke)};function ct(ye,ie,ae,ke,Ze){return ie=+ie,ae=ae>>>0,Ze||Be(ye,ie,ae,8),s.write(ye,ie,ae,ke,52,8),ae+8}_.prototype.writeDoubleLE=function(ie,ae,ke){return ct(this,ie,ae,!0,ke)},_.prototype.writeDoubleBE=function(ie,ae,ke){return ct(this,ie,ae,!1,ke)},_.prototype.copy=function(ie,ae,ke,Ze){if(!_.isBuffer(ie))throw new TypeError("argument should be a Buffer");if(ke||(ke=0),!Ze&&Ze!==0&&(Ze=this.length),ae>=ie.length&&(ae=ie.length),ae||(ae=0),Ze>0&&Ze<ke&&(Ze=ke),Ze===ke||ie.length===0||this.length===0)return 0;if(ae<0)throw new RangeError("targetStart out of bounds");if(ke<0||ke>=this.length)throw new RangeError("Index out of range");if(Ze<0)throw new RangeError("sourceEnd out of bounds");Ze>this.length&&(Ze=this.length),ie.length-ae<Ze-ke&&(Ze=ie.length-ae+ke);var yt=Ze-ke;if(this===ie&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(ae,ke,Ze);else if(this===ie&&ke<ae&&ae<Ze)for(var Me=yt-1;Me>=0;--Me)ie[Me+ae]=this[Me+ke];else Uint8Array.prototype.set.call(ie,this.subarray(ke,Ze),ae);return yt},_.prototype.fill=function(ie,ae,ke,Ze){if(typeof ie=="string"){if(typeof ae=="string"?(Ze=ae,ae=0,ke=this.length):typeof ke=="string"&&(Ze=ke,ke=this.length),Ze!==void 0&&typeof Ze!="string")throw new TypeError("encoding must be a string");if(typeof Ze=="string"&&!_.isEncoding(Ze))throw new TypeError("Unknown encoding: "+Ze);if(ie.length===1){var yt=ie.charCodeAt(0);(Ze==="utf8"&&yt<128||Ze==="latin1")&&(ie=yt)}}else typeof ie=="number"&&(ie=ie&255);if(ae<0||this.length<ae||this.length<ke)throw new RangeError("Out of range index");if(ke<=ae)return this;ae=ae>>>0,ke=ke===void 0?this.length:ke>>>0,ie||(ie=0);var Me;if(typeof ie=="number")for(Me=ae;Me<ke;++Me)this[Me]=ie;else{var ee=_.isBuffer(ie)?ie:_.from(ie,Ze),de=ee.length;if(de===0)throw new TypeError('The value "'+ie+'" is invalid for argument "value"');for(Me=0;Me<ke-ae;++Me)this[Me+ae]=ee[Me%de]}return this};var xt=/[^+/0-9A-Za-z-_]/g;function Se(ye){if(ye=ye.split("=")[0],ye=ye.trim().replace(xt,""),ye.length<2)return"";for(;ye.length%4!==0;)ye=ye+"=";return ye}function me(ye){return ye<16?"0"+ye.toString(16):ye.toString(16)}function qe(ye,ie){ie=ie||1/0;for(var ae,ke=ye.length,Ze=null,yt=[],Me=0;Me<ke;++Me){if(ae=ye.charCodeAt(Me),ae>55295&&ae<57344){if(!Ze){if(ae>56319){(ie-=3)>-1&&yt.push(239,191,189);continue}else if(Me+1===ke){(ie-=3)>-1&&yt.push(239,191,189);continue}Ze=ae;continue}if(ae<56320){(ie-=3)>-1&&yt.push(239,191,189),Ze=ae;continue}ae=(Ze-55296<<10|ae-56320)+65536}else Ze&&(ie-=3)>-1&&yt.push(239,191,189);if(Ze=null,ae<128){if((ie-=1)<0)break;yt.push(ae)}else if(ae<2048){if((ie-=2)<0)break;yt.push(ae>>6|192,ae&63|128)}else if(ae<65536){if((ie-=3)<0)break;yt.push(ae>>12|224,ae>>6&63|128,ae&63|128)}else if(ae<1114112){if((ie-=4)<0)break;yt.push(ae>>18|240,ae>>12&63|128,ae>>6&63|128,ae&63|128)}else throw new Error("Invalid code point")}return yt}function st(ye){for(var ie=[],ae=0;ae<ye.length;++ae)ie.push(ye.charCodeAt(ae)&255);return ie}function Rt(ye,ie){for(var ae,ke,Ze,yt=[],Me=0;Me<ye.length&&!((ie-=2)<0);++Me)ae=ye.charCodeAt(Me),ke=ae>>8,Ze=ae%256,yt.push(Ze),yt.push(ke);return yt}function gt(ye){return c.toByteArray(Se(ye))}function Ae(ye,ie,ae,ke){for(var Ze=0;Ze<ke&&!(Ze+ae>=ie.length||Ze>=ye.length);++Ze)ie[Ze+ae]=ye[Ze];return Ze}function we(ye,ie){return ye instanceof ie||ye!=null&&ye.constructor!=null&&ye.constructor.name!=null&&ye.constructor.name===ie.name}function vt(ye){return ye!==ye}}).call(this)}).call(this,t("buffer").Buffer)},{"base64-js":1,buffer:2,ieee754:14}],3:[function(t,i,r){const o=t("./validator"),c=t("./xmlparser/XMLParser"),s=t("./xmlbuilder/json2xml");i.exports={XMLParser:c,XMLValidator:o,XMLBuilder:s}},{"./validator":5,"./xmlbuilder/json2xml":6,"./xmlparser/XMLParser":11}],4:[function(t,i,r){const o=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",c=o+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",s="["+o+"]["+c+"]*",d=new RegExp("^"+s+"$"),p=function(_,x){const b=[];let S=x.exec(_);for(;S;){const P=[];P.startIndex=x.lastIndex-S[0].length;const L=S.length;for(let E=0;E<L;E++)P.push(S[E]);b.push(P),S=x.exec(_)}return b},g=function(_){const x=d.exec(_);return!(x===null||typeof x>"u")};r.isExist=function(_){return typeof _<"u"},r.isEmptyObject=function(_){return Object.keys(_).length===0},r.merge=function(_,x,b){if(x){const S=Object.keys(x),P=S.length;for(let L=0;L<P;L++)b==="strict"?_[S[L]]=[x[S[L]]]:_[S[L]]=x[S[L]]}},r.getValue=function(_){return r.isExist(_)?_:""},r.isName=g,r.getAllMatches=p,r.nameRegexp=s},{}],5:[function(t,i,r){const o=t("./util"),c={allowBooleanAttributes:!1,unpairedTags:[]};r.validate=function(q,G){G=Object.assign({},c,G);const N=[];let V=!1,j=!1;q[0]==="\uFEFF"&&(q=q.substr(1));for(let z=0;z<q.length;z++)if(q[z]==="<"&&q[z+1]==="?"){if(z+=2,z=d(q,z),z.err)return z}else if(q[z]==="<"){let Q=z;if(z++,q[z]==="!"){z=p(q,z);continue}else{let X=!1;q[z]==="/"&&(X=!0,z++);let re="";for(;z<q.length&&q[z]!==">"&&q[z]!==" "&&q[z]!=="	"&&q[z]!==`
`&&q[z]!=="\r";z++)re+=q[z];if(re=re.trim(),re[re.length-1]==="/"&&(re=re.substring(0,re.length-1),z--),!D(re)){let ce;return re.trim().length===0?ce="Invalid space after '<'.":ce="Tag '"+re+"' is an invalid name.",E("InvalidTag",ce,O(q,z))}const se=x(q,z);if(se===!1)return E("InvalidAttr","Attributes for '"+re+"' have open quote.",O(q,z));let le=se.value;if(z=se.index,le[le.length-1]==="/"){const ce=z-le.length;le=le.substring(0,le.length-1);const be=S(le,G);if(be===!0)V=!0;else return E(be.err.code,be.err.msg,O(q,ce+be.err.line))}else if(X)if(se.tagClosed){if(le.trim().length>0)return E("InvalidTag","Closing tag '"+re+"' can't have attributes or invalid starting.",O(q,Q));if(N.length===0)return E("InvalidTag","Closing tag '"+re+"' has not been opened.",O(q,Q));{const ce=N.pop();if(re!==ce.tagName){let be=O(q,ce.tagStartPos);return E("InvalidTag","Expected closing tag '"+ce.tagName+"' (opened in line "+be.line+", col "+be.col+") instead of closing tag '"+re+"'.",O(q,Q))}N.length==0&&(j=!0)}}else return E("InvalidTag","Closing tag '"+re+"' doesn't have proper closing.",O(q,z));else{const ce=S(le,G);if(ce!==!0)return E(ce.err.code,ce.err.msg,O(q,z-le.length+ce.err.line));if(j===!0)return E("InvalidXml","Multiple possible root nodes found.",O(q,z));G.unpairedTags.indexOf(re)!==-1||N.push({tagName:re,tagStartPos:Q}),V=!0}for(z++;z<q.length;z++)if(q[z]==="<")if(q[z+1]==="!"){z++,z=p(q,z);continue}else if(q[z+1]==="?"){if(z=d(q,++z),z.err)return z}else break;else if(q[z]==="&"){const ce=L(q,z);if(ce==-1)return E("InvalidChar","char '&' is not expected.",O(q,z));z=ce}else if(j===!0&&!s(q[z]))return E("InvalidXml","Extra text at the end",O(q,z));q[z]==="<"&&z--}}else{if(s(q[z]))continue;return E("InvalidChar","char '"+q[z]+"' is not expected.",O(q,z))}if(V){if(N.length==1)return E("InvalidTag","Unclosed tag '"+N[0].tagName+"'.",O(q,N[0].tagStartPos));if(N.length>0)return E("InvalidXml","Invalid '"+JSON.stringify(N.map(z=>z.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return E("InvalidXml","Start tag expected.",1);return!0};function s(q){return q===" "||q==="	"||q===`
`||q==="\r"}function d(q,G){const N=G;for(;G<q.length;G++)if(q[G]=="?"||q[G]==" "){const V=q.substr(N,G-N);if(G>5&&V==="xml")return E("InvalidXml","XML declaration allowed only at the start of the document.",O(q,G));if(q[G]=="?"&&q[G+1]==">"){G++;break}else continue}return G}function p(q,G){if(q.length>G+5&&q[G+1]==="-"&&q[G+2]==="-"){for(G+=3;G<q.length;G++)if(q[G]==="-"&&q[G+1]==="-"&&q[G+2]===">"){G+=2;break}}else if(q.length>G+8&&q[G+1]==="D"&&q[G+2]==="O"&&q[G+3]==="C"&&q[G+4]==="T"&&q[G+5]==="Y"&&q[G+6]==="P"&&q[G+7]==="E"){let N=1;for(G+=8;G<q.length;G++)if(q[G]==="<")N++;else if(q[G]===">"&&(N--,N===0))break}else if(q.length>G+9&&q[G+1]==="["&&q[G+2]==="C"&&q[G+3]==="D"&&q[G+4]==="A"&&q[G+5]==="T"&&q[G+6]==="A"&&q[G+7]==="["){for(G+=8;G<q.length;G++)if(q[G]==="]"&&q[G+1]==="]"&&q[G+2]===">"){G+=2;break}}return G}const g='"',_="'";function x(q,G){let N="",V="",j=!1;for(;G<q.length;G++){if(q[G]===g||q[G]===_)V===""?V=q[G]:V!==q[G]||(V="");else if(q[G]===">"&&V===""){j=!0;break}N+=q[G]}return V!==""?!1:{value:N,index:G,tagClosed:j}}const b=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function S(q,G){const N=o.getAllMatches(q,b),V={};for(let j=0;j<N.length;j++){if(N[j][1].length===0)return E("InvalidAttr","Attribute '"+N[j][2]+"' has no space in starting.",U(N[j]));if(N[j][3]!==void 0&&N[j][4]===void 0)return E("InvalidAttr","Attribute '"+N[j][2]+"' is without value.",U(N[j]));if(N[j][3]===void 0&&!G.allowBooleanAttributes)return E("InvalidAttr","boolean attribute '"+N[j][2]+"' is not allowed.",U(N[j]));const z=N[j][2];if(!C(z))return E("InvalidAttr","Attribute '"+z+"' is an invalid name.",U(N[j]));if(!V.hasOwnProperty(z))V[z]=1;else return E("InvalidAttr","Attribute '"+z+"' is repeated.",U(N[j]))}return!0}function P(q,G){let N=/\d/;for(q[G]==="x"&&(G++,N=/[\da-fA-F]/);G<q.length;G++){if(q[G]===";")return G;if(!q[G].match(N))break}return-1}function L(q,G){if(G++,q[G]===";")return-1;if(q[G]==="#")return G++,P(q,G);let N=0;for(;G<q.length;G++,N++)if(!(q[G].match(/\w/)&&N<20)){if(q[G]===";")break;return-1}return G}function E(q,G,N){return{err:{code:q,msg:G,line:N.line||N,col:N.col}}}function C(q){return o.isName(q)}function D(q){return o.isName(q)}function O(q,G){const N=q.substring(0,G).split(/\r?\n/);return{line:N.length,col:N[N.length-1].length+1}}function U(q){return q.startIndex+q[1].length}},{"./util":4}],6:[function(t,i,r){const o=t("./orderedJs2Xml"),c={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(_,x){return x},attributeValueProcessor:function(_,x){return x},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function s(_){this.options=Object.assign({},c,_),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=g),this.processTextOrObjNode=d,this.options.format?(this.indentate=p,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}s.prototype.build=function(_){return this.options.preserveOrder?o(_,this.options):(Array.isArray(_)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(_={[this.options.arrayNodeName]:_}),this.j2x(_,0).val)},s.prototype.j2x=function(_,x){let b="",S="";for(let P in _)if(Object.prototype.hasOwnProperty.call(_,P))if(typeof _[P]>"u")this.isAttribute(P)&&(S+="");else if(_[P]===null)this.isAttribute(P)?S+="":P[0]==="?"?S+=this.indentate(x)+"<"+P+"?"+this.tagEndChar:S+=this.indentate(x)+"<"+P+"/"+this.tagEndChar;else if(_[P]instanceof Date)S+=this.buildTextValNode(_[P],P,"",x);else if(typeof _[P]!="object"){const L=this.isAttribute(P);if(L)b+=this.buildAttrPairStr(L,""+_[P]);else if(P===this.options.textNodeName){let E=this.options.tagValueProcessor(P,""+_[P]);S+=this.replaceEntitiesValue(E)}else S+=this.buildTextValNode(_[P],P,"",x)}else if(Array.isArray(_[P])){const L=_[P].length;let E="",C="";for(let D=0;D<L;D++){const O=_[P][D];if(!(typeof O>"u"))if(O===null)P[0]==="?"?S+=this.indentate(x)+"<"+P+"?"+this.tagEndChar:S+=this.indentate(x)+"<"+P+"/"+this.tagEndChar;else if(typeof O=="object")if(this.options.oneListGroup){const U=this.j2x(O,x+1);E+=U.val,this.options.attributesGroupName&&O.hasOwnProperty(this.options.attributesGroupName)&&(C+=U.attrStr)}else E+=this.processTextOrObjNode(O,P,x);else if(this.options.oneListGroup){let U=this.options.tagValueProcessor(P,O);U=this.replaceEntitiesValue(U),E+=U}else E+=this.buildTextValNode(O,P,"",x)}this.options.oneListGroup&&(E=this.buildObjectNode(E,P,C,x)),S+=E}else if(this.options.attributesGroupName&&P===this.options.attributesGroupName){const L=Object.keys(_[P]),E=L.length;for(let C=0;C<E;C++)b+=this.buildAttrPairStr(L[C],""+_[P][L[C]])}else S+=this.processTextOrObjNode(_[P],P,x);return{attrStr:b,val:S}},s.prototype.buildAttrPairStr=function(_,x){return x=this.options.attributeValueProcessor(_,""+x),x=this.replaceEntitiesValue(x),this.options.suppressBooleanAttributes&&x==="true"?" "+_:" "+_+'="'+x+'"'};function d(_,x,b){const S=this.j2x(_,b+1);return _[this.options.textNodeName]!==void 0&&Object.keys(_).length===1?this.buildTextValNode(_[this.options.textNodeName],x,S.attrStr,b):this.buildObjectNode(S.val,x,S.attrStr,b)}s.prototype.buildObjectNode=function(_,x,b,S){if(_==="")return x[0]==="?"?this.indentate(S)+"<"+x+b+"?"+this.tagEndChar:this.indentate(S)+"<"+x+b+this.closeTag(x)+this.tagEndChar;{let P="</"+x+this.tagEndChar,L="";return x[0]==="?"&&(L="?",P=""),(b||b==="")&&_.indexOf("<")===-1?this.indentate(S)+"<"+x+b+L+">"+_+P:this.options.commentPropName!==!1&&x===this.options.commentPropName&&L.length===0?this.indentate(S)+`<!--${_}-->`+this.newLine:this.indentate(S)+"<"+x+b+L+this.tagEndChar+_+this.indentate(S)+P}},s.prototype.closeTag=function(_){let x="";return this.options.unpairedTags.indexOf(_)!==-1?this.options.suppressUnpairedNode||(x="/"):this.options.suppressEmptyNode?x="/":x=`></${_}`,x},s.prototype.buildTextValNode=function(_,x,b,S){if(this.options.cdataPropName!==!1&&x===this.options.cdataPropName)return this.indentate(S)+`<![CDATA[${_}]]>`+this.newLine;if(this.options.commentPropName!==!1&&x===this.options.commentPropName)return this.indentate(S)+`<!--${_}-->`+this.newLine;if(x[0]==="?")return this.indentate(S)+"<"+x+b+"?"+this.tagEndChar;{let P=this.options.tagValueProcessor(x,_);return P=this.replaceEntitiesValue(P),P===""?this.indentate(S)+"<"+x+b+this.closeTag(x)+this.tagEndChar:this.indentate(S)+"<"+x+b+">"+P+"</"+x+this.tagEndChar}},s.prototype.replaceEntitiesValue=function(_){if(_&&_.length>0&&this.options.processEntities)for(let x=0;x<this.options.entities.length;x++){const b=this.options.entities[x];_=_.replace(b.regex,b.val)}return _};function p(_){return this.options.indentBy.repeat(_)}function g(_){return _.startsWith(this.options.attributeNamePrefix)&&_!==this.options.textNodeName?_.substr(this.attrPrefixLen):!1}i.exports=s},{"./orderedJs2Xml":7}],7:[function(t,i,r){function c(x,b){let S="";return b.format&&b.indentBy.length>0&&(S=`
`),s(x,b,"",S)}function s(x,b,S,P){let L="",E=!1;for(let C=0;C<x.length;C++){const D=x[C],O=d(D);if(O===void 0)continue;let U="";if(S.length===0?U=O:U=`${S}.${O}`,O===b.textNodeName){let j=D[O];g(U,b)||(j=b.tagValueProcessor(O,j),j=_(j,b)),E&&(L+=P),L+=j,E=!1;continue}else if(O===b.cdataPropName){E&&(L+=P),L+=`<![CDATA[${D[O][0][b.textNodeName]}]]>`,E=!1;continue}else if(O===b.commentPropName){L+=P+`<!--${D[O][0][b.textNodeName]}-->`,E=!0;continue}else if(O[0]==="?"){const j=p(D[":@"],b),z=O==="?xml"?"":P;let Q=D[O][0][b.textNodeName];Q=Q.length!==0?" "+Q:"",L+=z+`<${O}${Q}${j}?>`,E=!0;continue}let q=P;q!==""&&(q+=b.indentBy);const G=p(D[":@"],b),N=P+`<${O}${G}`,V=s(D[O],b,U,q);b.unpairedTags.indexOf(O)!==-1?b.suppressUnpairedNode?L+=N+">":L+=N+"/>":(!V||V.length===0)&&b.suppressEmptyNode?L+=N+"/>":V&&V.endsWith(">")?L+=N+`>${V}${P}</${O}>`:(L+=N+">",V&&P!==""&&(V.includes("/>")||V.includes("</"))?L+=P+b.indentBy+V+P:L+=V,L+=`</${O}>`),E=!0}return L}function d(x){const b=Object.keys(x);for(let S=0;S<b.length;S++){const P=b[S];if(x.hasOwnProperty(P)&&P!==":@")return P}}function p(x,b){let S="";if(x&&!b.ignoreAttributes)for(let P in x){if(!x.hasOwnProperty(P))continue;let L=b.attributeValueProcessor(P,x[P]);L=_(L,b),L===!0&&b.suppressBooleanAttributes?S+=` ${P.substr(b.attributeNamePrefix.length)}`:S+=` ${P.substr(b.attributeNamePrefix.length)}="${L}"`}return S}function g(x,b){x=x.substr(0,x.length-b.textNodeName.length-1);let S=x.substr(x.lastIndexOf(".")+1);for(let P in b.stopNodes)if(b.stopNodes[P]===x||b.stopNodes[P]==="*."+S)return!0;return!1}function _(x,b){if(x&&x.length>0&&b.processEntities)for(let S=0;S<b.entities.length;S++){const P=b.entities[S];x=x.replace(P.regex,P.val)}return x}i.exports=c},{}],8:[function(t,i,r){const o=t("../util");function c(S,P){const L={};if(S[P+3]==="O"&&S[P+4]==="C"&&S[P+5]==="T"&&S[P+6]==="Y"&&S[P+7]==="P"&&S[P+8]==="E"){P=P+9;let E=1,C=!1,D=!1,O="";for(;P<S.length;P++)if(S[P]==="<"&&!D){if(C&&p(S,P))P+=7,[entityName,val,P]=s(S,P+1),val.indexOf("&")===-1&&(L[b(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(C&&g(S,P))P+=8;else if(C&&_(S,P))P+=8;else if(C&&x(S,P))P+=9;else if(d)D=!0;else throw new Error("Invalid DOCTYPE");E++,O=""}else if(S[P]===">"){if(D?S[P-1]==="-"&&S[P-2]==="-"&&(D=!1,E--):E--,E===0)break}else S[P]==="["?C=!0:O+=S[P];if(E!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:L,i:P}}function s(S,P){let L="";for(;P<S.length&&S[P]!=="'"&&S[P]!=='"';P++)L+=S[P];if(L=L.trim(),L.indexOf(" ")!==-1)throw new Error("External entites are not supported");const E=S[P++];let C="";for(;P<S.length&&S[P]!==E;P++)C+=S[P];return[L,C,P]}function d(S,P){return S[P+1]==="!"&&S[P+2]==="-"&&S[P+3]==="-"}function p(S,P){return S[P+1]==="!"&&S[P+2]==="E"&&S[P+3]==="N"&&S[P+4]==="T"&&S[P+5]==="I"&&S[P+6]==="T"&&S[P+7]==="Y"}function g(S,P){return S[P+1]==="!"&&S[P+2]==="E"&&S[P+3]==="L"&&S[P+4]==="E"&&S[P+5]==="M"&&S[P+6]==="E"&&S[P+7]==="N"&&S[P+8]==="T"}function _(S,P){return S[P+1]==="!"&&S[P+2]==="A"&&S[P+3]==="T"&&S[P+4]==="T"&&S[P+5]==="L"&&S[P+6]==="I"&&S[P+7]==="S"&&S[P+8]==="T"}function x(S,P){return S[P+1]==="!"&&S[P+2]==="N"&&S[P+3]==="O"&&S[P+4]==="T"&&S[P+5]==="A"&&S[P+6]==="T"&&S[P+7]==="I"&&S[P+8]==="O"&&S[P+9]==="N"}function b(S){if(o.isName(S))return S;throw new Error(`Invalid entity name ${S}`)}i.exports=c},{"../util":4}],9:[function(t,i,r){const o={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(s,d){return d},attributeValueProcessor:function(s,d){return d},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(s,d,p){return s}},c=function(s){return Object.assign({},o,s)};r.buildOptions=c,r.defaultOptions=o},{}],10:[function(t,i,r){const o=t("../util"),c=t("./xmlNode"),s=t("./DocTypeReader"),d=t("strnum");class p{constructor(j){this.options=j,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"Â¢"},pound:{regex:/&(pound|#163);/g,val:"Â£"},yen:{regex:/&(yen|#165);/g,val:"Â¥"},euro:{regex:/&(euro|#8364);/g,val:"â¬"},copyright:{regex:/&(copy|#169);/g,val:"Â©"},reg:{regex:/&(reg|#174);/g,val:"Â®"},inr:{regex:/&(inr|#8377);/g,val:"â¹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(z,Q)=>String.fromCharCode(Number.parseInt(Q,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(z,Q)=>String.fromCharCode(Number.parseInt(Q,16))}},this.addExternalEntities=g,this.parseXml=P,this.parseTextData=_,this.resolveNameSpace=x,this.buildAttributesMap=S,this.isItStopNode=D,this.replaceEntitiesValue=E,this.readStopNodeData=G,this.saveTextToParentTag=C,this.addChild=L}}function g(V){const j=Object.keys(V);for(let z=0;z<j.length;z++){const Q=j[z];this.lastEntities[Q]={regex:new RegExp("&"+Q+";","g"),val:V[Q]}}}function _(V,j,z,Q,X,re,se){if(V!==void 0&&(this.options.trimValues&&!Q&&(V=V.trim()),V.length>0)){se||(V=this.replaceEntitiesValue(V));const le=this.options.tagValueProcessor(j,V,z,X,re);return le==null?V:typeof le!=typeof V||le!==V?le:this.options.trimValues?N(V,this.options.parseTagValue,this.options.numberParseOptions):V.trim()===V?N(V,this.options.parseTagValue,this.options.numberParseOptions):V}}function x(V){if(this.options.removeNSPrefix){const j=V.split(":"),z=V.charAt(0)==="/"?"/":"";if(j[0]==="xmlns")return"";j.length===2&&(V=z+j[1])}return V}const b=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function S(V,j,z){if(!this.options.ignoreAttributes&&typeof V=="string"){const Q=o.getAllMatches(V,b),X=Q.length,re={};for(let se=0;se<X;se++){const le=this.resolveNameSpace(Q[se][1]);let ce=Q[se][4],be=this.options.attributeNamePrefix+le;if(le.length)if(this.options.transformAttributeName&&(be=this.options.transformAttributeName(be)),be==="__proto__"&&(be="#__proto__"),ce!==void 0){this.options.trimValues&&(ce=ce.trim()),ce=this.replaceEntitiesValue(ce);const Ee=this.options.attributeValueProcessor(le,ce,j);Ee==null?re[be]=ce:typeof Ee!=typeof ce||Ee!==ce?re[be]=Ee:re[be]=N(ce,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(re[be]=!0)}if(!Object.keys(re).length)return;if(this.options.attributesGroupName){const se={};return se[this.options.attributesGroupName]=re,se}return re}}const P=function(V){V=V.replace(/\r\n?/g,`
`);const j=new c("!xml");let z=j,Q="",X="";for(let re=0;re<V.length;re++)if(V[re]==="<")if(V[re+1]==="/"){const le=U(V,">",re,"Closing Tag is not closed.");let ce=V.substring(re+2,le).trim();if(this.options.removeNSPrefix){const $e=ce.indexOf(":");$e!==-1&&(ce=ce.substr($e+1))}this.options.transformTagName&&(ce=this.options.transformTagName(ce)),z&&(Q=this.saveTextToParentTag(Q,z,X));const be=X.substring(X.lastIndexOf(".")+1);if(ce&&this.options.unpairedTags.indexOf(ce)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${ce}>`);let Ee=0;be&&this.options.unpairedTags.indexOf(be)!==-1?(Ee=X.lastIndexOf(".",X.lastIndexOf(".")-1),this.tagsNodeStack.pop()):Ee=X.lastIndexOf("."),X=X.substring(0,Ee),z=this.tagsNodeStack.pop(),Q="",re=le}else if(V[re+1]==="?"){let le=q(V,re,!1,"?>");if(!le)throw new Error("Pi Tag is not closed.");if(Q=this.saveTextToParentTag(Q,z,X),!(this.options.ignoreDeclaration&&le.tagName==="?xml"||this.options.ignorePiTags)){const ce=new c(le.tagName);ce.add(this.options.textNodeName,""),le.tagName!==le.tagExp&&le.attrExpPresent&&(ce[":@"]=this.buildAttributesMap(le.tagExp,X,le.tagName)),this.addChild(z,ce,X)}re=le.closeIndex+1}else if(V.substr(re+1,3)==="!--"){const le=U(V,"-->",re+4,"Comment is not closed.");if(this.options.commentPropName){const ce=V.substring(re+4,le-2);Q=this.saveTextToParentTag(Q,z,X),z.add(this.options.commentPropName,[{[this.options.textNodeName]:ce}])}re=le}else if(V.substr(re+1,2)==="!D"){const le=s(V,re);this.docTypeEntities=le.entities,re=le.i}else if(V.substr(re+1,2)==="!["){const le=U(V,"]]>",re,"CDATA is not closed.")-2,ce=V.substring(re+9,le);Q=this.saveTextToParentTag(Q,z,X);let be=this.parseTextData(ce,z.tagname,X,!0,!1,!0,!0);be==null&&(be=""),this.options.cdataPropName?z.add(this.options.cdataPropName,[{[this.options.textNodeName]:ce}]):z.add(this.options.textNodeName,be),re=le+2}else{let le=q(V,re,this.options.removeNSPrefix),ce=le.tagName;const be=le.rawTagName;let Ee=le.tagExp,$e=le.attrExpPresent,Ve=le.closeIndex;this.options.transformTagName&&(ce=this.options.transformTagName(ce)),z&&Q&&z.tagname!=="!xml"&&(Q=this.saveTextToParentTag(Q,z,X,!1));const nt=z;if(nt&&this.options.unpairedTags.indexOf(nt.tagname)!==-1&&(z=this.tagsNodeStack.pop(),X=X.substring(0,X.lastIndexOf("."))),ce!==j.tagname&&(X+=X?"."+ce:ce),this.isItStopNode(this.options.stopNodes,X,ce)){let He="";if(Ee.length>0&&Ee.lastIndexOf("/")===Ee.length-1)ce[ce.length-1]==="/"?(ce=ce.substr(0,ce.length-1),X=X.substr(0,X.length-1),Ee=ce):Ee=Ee.substr(0,Ee.length-1),re=le.closeIndex;else if(this.options.unpairedTags.indexOf(ce)!==-1)re=le.closeIndex;else{const ot=this.readStopNodeData(V,be,Ve+1);if(!ot)throw new Error(`Unexpected end of ${be}`);re=ot.i,He=ot.tagContent}const De=new c(ce);ce!==Ee&&$e&&(De[":@"]=this.buildAttributesMap(Ee,X,ce)),He&&(He=this.parseTextData(He,ce,X,!0,$e,!0,!0)),X=X.substr(0,X.lastIndexOf(".")),De.add(this.options.textNodeName,He),this.addChild(z,De,X)}else{if(Ee.length>0&&Ee.lastIndexOf("/")===Ee.length-1){ce[ce.length-1]==="/"?(ce=ce.substr(0,ce.length-1),X=X.substr(0,X.length-1),Ee=ce):Ee=Ee.substr(0,Ee.length-1),this.options.transformTagName&&(ce=this.options.transformTagName(ce));const He=new c(ce);ce!==Ee&&$e&&(He[":@"]=this.buildAttributesMap(Ee,X,ce)),this.addChild(z,He,X),X=X.substr(0,X.lastIndexOf("."))}else{const He=new c(ce);this.tagsNodeStack.push(z),ce!==Ee&&$e&&(He[":@"]=this.buildAttributesMap(Ee,X,ce)),this.addChild(z,He,X),z=He}Q="",re=Ve}}else Q+=V[re];return j.child};function L(V,j,z){const Q=this.options.updateTag(j.tagname,z,j[":@"]);Q===!1||(typeof Q=="string"&&(j.tagname=Q),V.addChild(j))}const E=function(V){if(this.options.processEntities){for(let j in this.docTypeEntities){const z=this.docTypeEntities[j];V=V.replace(z.regx,z.val)}for(let j in this.lastEntities){const z=this.lastEntities[j];V=V.replace(z.regex,z.val)}if(this.options.htmlEntities)for(let j in this.htmlEntities){const z=this.htmlEntities[j];V=V.replace(z.regex,z.val)}V=V.replace(this.ampEntity.regex,this.ampEntity.val)}return V};function C(V,j,z,Q){return V&&(Q===void 0&&(Q=Object.keys(j.child).length===0),V=this.parseTextData(V,j.tagname,z,!1,j[":@"]?Object.keys(j[":@"]).length!==0:!1,Q),V!==void 0&&V!==""&&j.add(this.options.textNodeName,V),V=""),V}function D(V,j,z){const Q="*."+z;for(const X in V){const re=V[X];if(Q===re||j===re)return!0}return!1}function O(V,j,z=">"){let Q,X="";for(let re=j;re<V.length;re++){let se=V[re];if(Q)se===Q&&(Q="");else if(se==='"'||se==="'")Q=se;else if(se===z[0])if(z[1]){if(V[re+1]===z[1])return{data:X,index:re}}else return{data:X,index:re};else se==="	"&&(se=" ");X+=se}}function U(V,j,z,Q){const X=V.indexOf(j,z);if(X===-1)throw new Error(Q);return X+j.length-1}function q(V,j,z,Q=">"){const X=O(V,j+1,Q);if(!X)return;let re=X.data;const se=X.index,le=re.search(/\s/);let ce=re,be=!0;le!==-1&&(ce=re.substring(0,le),re=re.substring(le+1).trimStart());const Ee=ce;if(z){const $e=ce.indexOf(":");$e!==-1&&(ce=ce.substr($e+1),be=ce!==X.data.substr($e+1))}return{tagName:ce,tagExp:re,closeIndex:se,attrExpPresent:be,rawTagName:Ee}}function G(V,j,z){const Q=z;let X=1;for(;z<V.length;z++)if(V[z]==="<")if(V[z+1]==="/"){const re=U(V,">",z,`${j} is not closed`);if(V.substring(z+2,re).trim()===j&&(X--,X===0))return{tagContent:V.substring(Q,z),i:re};z=re}else if(V[z+1]==="?")z=U(V,"?>",z+1,"StopNode is not closed.");else if(V.substr(z+1,3)==="!--")z=U(V,"-->",z+3,"StopNode is not closed.");else if(V.substr(z+1,2)==="![")z=U(V,"]]>",z,"StopNode is not closed.")-2;else{const re=q(V,z,">");re&&((re&&re.tagName)===j&&re.tagExp[re.tagExp.length-1]!=="/"&&X++,z=re.closeIndex)}}function N(V,j,z){if(j&&typeof V=="string"){const Q=V.trim();return Q==="true"?!0:Q==="false"?!1:d(V,z)}else return o.isExist(V)?V:""}i.exports=p},{"../util":4,"./DocTypeReader":8,"./xmlNode":13,strnum:15}],11:[function(t,i,r){const{buildOptions:o}=t("./OptionsBuilder"),c=t("./OrderedObjParser"),{prettify:s}=t("./node2json"),d=t("../validator");class p{constructor(_){this.externalEntities={},this.options=o(_)}parse(_,x){if(typeof _!="string")if(_.toString)_=_.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(x){x===!0&&(x={});const P=d.validate(_,x);if(P!==!0)throw Error(`${P.err.msg}:${P.err.line}:${P.err.col}`)}const b=new c(this.options);b.addExternalEntities(this.externalEntities);const S=b.parseXml(_);return this.options.preserveOrder||S===void 0?S:s(S,this.options)}addEntity(_,x){if(x.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(_.indexOf("&")!==-1||_.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(x==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[_]=x}}i.exports=p},{"../validator":5,"./OptionsBuilder":9,"./OrderedObjParser":10,"./node2json":12}],12:[function(t,i,r){function o(g,_){return c(g,_)}function c(g,_,x){let b;const S={};for(let P=0;P<g.length;P++){const L=g[P],E=s(L);let C="";if(x===void 0?C=E:C=x+"."+E,E===_.textNodeName)b===void 0?b=L[E]:b+=""+L[E];else{if(E===void 0)continue;if(L[E]){let D=c(L[E],_,C);const O=p(D,_);L[":@"]?d(D,L[":@"],C,_):Object.keys(D).length===1&&D[_.textNodeName]!==void 0&&!_.alwaysCreateTextNode?D=D[_.textNodeName]:Object.keys(D).length===0&&(_.alwaysCreateTextNode?D[_.textNodeName]="":D=""),S[E]!==void 0&&S.hasOwnProperty(E)?(Array.isArray(S[E])||(S[E]=[S[E]]),S[E].push(D)):_.isArray(E,C,O)?S[E]=[D]:S[E]=D}}}return typeof b=="string"?b.length>0&&(S[_.textNodeName]=b):b!==void 0&&(S[_.textNodeName]=b),S}function s(g){const _=Object.keys(g);for(let x=0;x<_.length;x++){const b=_[x];if(b!==":@")return b}}function d(g,_,x,b){if(_){const S=Object.keys(_),P=S.length;for(let L=0;L<P;L++){const E=S[L];b.isArray(E,x+"."+E,!0,!0)?g[E]=[_[E]]:g[E]=_[E]}}}function p(g,_){const{textNodeName:x}=_,b=Object.keys(g).length;return!!(b===0||b===1&&(g[x]||typeof g[x]=="boolean"||g[x]===0))}r.prettify=o},{}],13:[function(t,i,r){class o{constructor(s){this.tagname=s,this.child=[],this[":@"]={}}add(s,d){s==="__proto__"&&(s="#__proto__"),this.child.push({[s]:d})}addChild(s){s.tagname==="__proto__"&&(s.tagname="#__proto__"),s[":@"]&&Object.keys(s[":@"]).length>0?this.child.push({[s.tagname]:s.child,":@":s[":@"]}):this.child.push({[s.tagname]:s.child})}}i.exports=o},{}],14:[function(t,i,r){r.read=function(o,c,s,d,p){var g,_,x=p*8-d-1,b=(1<<x)-1,S=b>>1,P=-7,L=s?p-1:0,E=s?-1:1,C=o[c+L];for(L+=E,g=C&(1<<-P)-1,C>>=-P,P+=x;P>0;g=g*256+o[c+L],L+=E,P-=8);for(_=g&(1<<-P)-1,g>>=-P,P+=d;P>0;_=_*256+o[c+L],L+=E,P-=8);if(g===0)g=1-S;else{if(g===b)return _?NaN:(C?-1:1)*(1/0);_=_+Math.pow(2,d),g=g-S}return(C?-1:1)*_*Math.pow(2,g-d)},r.write=function(o,c,s,d,p,g){var _,x,b,S=g*8-p-1,P=(1<<S)-1,L=P>>1,E=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,C=d?0:g-1,D=d?1:-1,O=c<0||c===0&&1/c<0?1:0;for(c=Math.abs(c),isNaN(c)||c===1/0?(x=isNaN(c)?1:0,_=P):(_=Math.floor(Math.log(c)/Math.LN2),c*(b=Math.pow(2,-_))<1&&(_--,b*=2),_+L>=1?c+=E/b:c+=E*Math.pow(2,1-L),c*b>=2&&(_++,b/=2),_+L>=P?(x=0,_=P):_+L>=1?(x=(c*b-1)*Math.pow(2,p),_=_+L):(x=c*Math.pow(2,L-1)*Math.pow(2,p),_=0));p>=8;o[s+C]=x&255,C+=D,x/=256,p-=8);for(_=_<<p|x,S+=p;S>0;o[s+C]=_&255,C+=D,_/=256,S-=8);o[s+C-D]|=O*128}},{}],15:[function(t,i,r){const o=/^[-+]?0x[a-fA-F0-9]+$/,c=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const s={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function d(g,_={}){if(_=Object.assign({},s,_),!g||typeof g!="string")return g;let x=g.trim();if(_.skipLike!==void 0&&_.skipLike.test(x))return g;if(_.hex&&o.test(x))return Number.parseInt(x,16);{const b=c.exec(x);if(b){const S=b[1],P=b[2];let L=p(b[3]);const E=b[4]||b[6];if(!_.leadingZeros&&P.length>0&&S&&x[2]!==".")return g;if(!_.leadingZeros&&P.length>0&&!S&&x[1]!==".")return g;{const C=Number(x),D=""+C;return D.search(/[eE]/)!==-1||E?_.eNotation?C:g:x.indexOf(".")!==-1?D==="0"&&L===""||D===L||S&&D==="-"+L?C:g:P?L===D||S+L===D?C:g:x===D||x===S+D?C:g}}else return g}}function p(g){return g&&g.indexOf(".")!==-1&&(g=g.replace(/0+$/,""),g==="."?g="0":g[0]==="."?g="0"+g:g[g.length-1]==="."&&(g=g.substr(0,g.length-1))),g}i.exports=d},{}],16:[function(t,i,r){i.exports={name:"osm-api",version:"3.3.1",contributors:["Kyle Hensel (https://github.com/k-yle)"],description:"ðºï¸ð Javascript/Typescript wrapper around the OpenStreetMap API",main:"dist",unpkg:"dist/index.min.js",types:"dist/src/index.d.ts",license:"MIT",files:["dist"],keywords:["osm","openstreetmap","openstreetmap api"],repository:"https://github.com/osmlab/osm-api-js",scripts:{build:"rm -rf dist && tsc --emitDeclarationOnly && rm -rf dist/__tests__ && browserify -s OSM src/index.ts -p tsify > dist/index.js && uglifyjs dist/index.js > dist/index.min.js",lint:"eslint .",test:"vitest",trypublish:"npm publish --provenance || true"},engines:{node:">=18"},dependencies:{"@types/geojson":"^7946.0.13","fast-xml-parser":"^4.4.1"},devDependencies:{"@types/node":"^22.5.5",browserify:"^17.0.0",eslint:"^9.10.0","eslint-config-kyle":"^25.0.0-beta3",tsify:"^5.0.4",typescript:"^5.6.2","uglify-js":"^3.19.3",vitest:"^2.1.1"},prettier:{trailingComma:"es5"}}},{}],17:[function(t,i,r){(function(o){(function(){var c=this&&this.__awaiter||function(x,b,S,P){function L(E){return E instanceof S?E:new S(function(C){C(E)})}return new(S||(S=Promise))(function(E,C){function D(q){try{U(P.next(q))}catch(G){C(G)}}function O(q){try{U(P.throw(q))}catch(G){C(G)}}function U(q){q.done?E(q.value):L(q.value).then(D,O)}U((P=P.apply(x,b||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.osmFetch=_;const s=t("../auth"),d=t("../config"),p=t("./_xml"),g=x=>typeof btoa>"u"?o.from(x,"binary").toString("base64"):btoa(x);function _(x,b,S){return c(this,void 0,void 0,function*(){const{apiUrl:P,authHeader:L,basicAuth:E,userAgent:C}=(0,d.getConfig)(),D=E&&`Basic ${g(`${E.username}:${E.password}`)}`,O=(0,s.getAuthToken)()&&`Bearer ${(0,s.getAuthToken)()}`;let U=new URLSearchParams(b).toString();U&&(U=`?${U}`);const q=yield fetch(`${P}/api${x}${U}`,Object.assign(Object.assign({},S),{headers:Object.assign({Authorization:L||D||O||"","User-Agent":C},S?.headers)})),G=q.headers.get("Content-Type");if(G?.startsWith("application/xml")){const V=yield q.text();return yield p.xmlParser.parse(V)}if(G?.startsWith("application/json"))return q.json();if(q.ok)return yield q.text();const N=new Error(`OSM API: ${yield q.text()}`);throw N.cause=q.status,N})}}).call(this)}).call(this,t("buffer").Buffer)},{"../auth":58,"../config":60,"./_xml":18,buffer:2}],18:[function(t,i,r){Object.defineProperty(r,"__esModule",{value:!0}),r.xmlParser=void 0;const o=t("fast-xml-parser");r.xmlParser=new o.XMLParser({ignoreAttributes:!1,attributesGroupName:"$",attributeNamePrefix:"",isArray:c=>c!=="$",attributeValueProcessor(c,s){return s.replaceAll(/&#(x9|9);/g,"	").replaceAll(/&#(xA|10);/g,`
`).replaceAll(/&#(xD|13);/g,"\r")}})},{"fast-xml-parser":3}],19:[function(t,i,r){Object.defineProperty(r,"__esModule",{value:!0}),r.createChangesetMetaXml=s,r.createOsmChangeXml=p;const o=t("fast-xml-parser"),c=new o.XMLBuilder({ignoreAttributes:!1,attributeNamePrefix:"$",format:!0,suppressEmptyNode:!0,suppressBooleanAttributes:!1,entities:[{regex:/&/g,val:"&amp;"},{regex:/>/g,val:"&gt;"},{regex:/</g,val:"&lt;"},{regex:/'/g,val:"&apos;"},{regex:/"/g,val:"&quot;"},{regex:/\t/g,val:"&#9;"},{regex:/\n/g,val:"&#10;"},{regex:/\r/g,val:"&#13;"}]});function s(g){return c.build({osm:{changeset:{tag:Object.entries(g).map(([_,x])=>({$k:_,$v:x}))}}})}const d=(g,_,x)=>{const b=["node","way","relation"];return x==="delete"&&b.reverse(),_.reduce((S,P)=>{const L={$id:P.id,$version:x==="create"?0:P.version,$changeset:g,tag:Object.entries(P.tags||{}).map(([E,C])=>({$k:E,$v:C}))};switch(P.type){case"node":{const E=Object.assign(Object.assign({},L),{$lat:P.lat,$lon:P.lon});return Object.assign(Object.assign({},S),{node:[...S.node,E]})}case"way":{if(!P.nodes)throw new Error("Way has no nodes");const E=Object.assign(Object.assign({},L),{nd:P.nodes.map(C=>({$ref:C}))});return Object.assign(Object.assign({},S),{way:[...S.way,E]})}case"relation":{if(!P.members)throw new Error("Relation has no members");const E=Object.assign(Object.assign({},L),{member:P.members.map(C=>({$type:C.type,$ref:C.ref,$role:C.role}))});return Object.assign(Object.assign({},S),{relation:[...S.relation,E]})}default:return S}},Object.fromEntries(b.map(S=>[S,[]])))};function p(g,_,x){return c.build({osmChange:{$version:"0.6",$generator:"osm-api-js",changeset:x?{tag:Object.entries(x).map(([b,S])=>({$k:b,$v:S}))}:void 0,create:[d(g,_.create,"create")],modify:[d(g,_.modify,"modify")],delete:[Object.assign({"$if-unused":!0},d(g,_.delete,"delete"))]}})}},{"fast-xml-parser":3}],20:[function(t,i,r){Object.defineProperty(r,"__esModule",{value:!0}),r.parseOsmChangeJson=p,r.parseOsmChangeXml=g;const o=t("../_xml");function c(_){if(_?.tag)return Object.fromEntries(_.tag.map(x=>[x.$.k,x.$.v]))}function s(_){return{changeset:+_.$.changeset,id:+_.$.id,timestamp:_.$.timestamp,uid:+_.$.uid,user:_.$.user,version:+_.$.version,tags:c(_)}}const d=_=>{const x=[];if(_.node){const b=_.node.map(S=>Object.assign(Object.assign({type:"node"},s(S)),{lat:+S.$.lat,lon:+S.$.lon}));x.push(...b)}if(_.way){const b=_.way.map(S=>{var P;return Object.assign(Object.assign({type:"way"},s(S)),{nodes:((P=S.nd)===null||P===void 0?void 0:P.map(L=>+L.$.ref))||[]})});x.push(...b)}if(_.relation){const b=_.relation.map(S=>{var P;return Object.assign(Object.assign({type:"relation"},s(S)),{members:((P=S.member)===null||P===void 0?void 0:P.map(L=>({ref:+L.$.ref,role:L.$.role,type:L.$.type})))||[]})});x.push(...b)}return x};function p(_){var x,b,S,P;const L=c((x=_.osmChange[0].changeset)===null||x===void 0?void 0:x[0]),E={create:((b=_.osmChange[0].create)===null||b===void 0?void 0:b.flatMap(d))||[],modify:((S=_.osmChange[0].modify)===null||S===void 0?void 0:S.flatMap(d))||[],delete:((P=_.osmChange[0].delete)===null||P===void 0?void 0:P.flatMap(d))||[]};return L&&(E.changeset=L),E}function g(_){const x=o.xmlParser.parse(_);return p(x)}},{"../_xml":18}],21:[function(t,i,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getOsmChangeSize=d,r.chunkOsmChange=p;const o=["create","modify","delete"],c=["create-node","create-way","create-relation","delete-relation","delete-way","delete-node","modify-node","modify-way","modify-relation"],s=()=>({create:[],modify:[],delete:[]});function d(g){return g.create.length+g.modify.length+g.delete.length}function p(g,_){var x;const b=(x=_?.api.changesets.maximum_elements)!==null&&x!==void 0?x:p.DEFAULT_LIMIT;if(d(g)<=b)return[g];const S={};for(const C of o)for(const D of g[C]){const O=`${C}-${D.type}`;S[O]||(S[O]=[]),S[O].push(D)}const P=[s()];function L(){var C;for(const D of c){const O=D.split("-")[0],U=(C=S[D])===null||C===void 0?void 0:C.pop();if(U)return{action:O,feature:U}}}let E;for(;E=L();){const C=P[0];C[E.action].push(E.feature),d(C)>=b&&P.unshift(s())}return P.reverse()}p.DEFAULT_LIMIT=1e4},{}],22:[function(t,i,r){var o=this&&this.__awaiter||function(p,g,_,x){function b(S){return S instanceof _?S:new _(function(P){P(S)})}return new(_||(_=Promise))(function(S,P){function L(D){try{C(x.next(D))}catch(O){P(O)}}function E(D){try{C(x.throw(D))}catch(O){P(O)}}function C(D){D.done?S(D.value):b(D.value).then(L,E)}C((x=x.apply(p,g||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.createChangesetComment=d;const c=t("../_osmFetch"),s=t("./getChangesets");function d(p,g,_){return o(this,void 0,void 0,function*(){const x=yield(0,c.osmFetch)(`/0.6/changeset/${p}/comment.json`,void 0,Object.assign(Object.assign({},_),{method:"POST",body:`text=${encodeURIComponent(g)}`,headers:Object.assign(Object.assign({},_?.headers),{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"})}));return(0,s.mapRawChangeset)(x.changeset)})}},{"../_osmFetch":17,"./getChangesets":24}],23:[function(t,i,r){var o=this&&this.__awaiter||function(p,g,_,x){function b(S){return S instanceof _?S:new _(function(P){P(S)})}return new(_||(_=Promise))(function(S,P){function L(D){try{C(x.next(D))}catch(O){P(O)}}function E(D){try{C(x.throw(D))}catch(O){P(O)}}function C(D){D.done?S(D.value):b(D.value).then(L,E)}C((x=x.apply(p,g||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.getChangesetDiff=d;const c=t("../_osmFetch"),s=t("./_parseOsmChangeXml");function d(p,g){return o(this,void 0,void 0,function*(){const _=yield(0,c.osmFetch)(`/0.6/changeset/${p}/download`,void 0,g);return(0,s.parseOsmChangeJson)(_)})}},{"../_osmFetch":17,"./_parseOsmChangeXml":20}],24:[function(t,i,r){var o=this&&this.__awaiter||function(_,x,b,S){function P(L){return L instanceof b?L:new b(function(E){E(L)})}return new(b||(b=Promise))(function(L,E){function C(U){try{O(S.next(U))}catch(q){E(q)}}function D(U){try{O(S.throw(U))}catch(q){E(q)}}function O(U){U.done?L(U.value):P(U.value).then(C,D)}O((S=S.apply(_,x||[])).next())})},c=this&&this.__rest||function(_,x){var b={};for(var S in _)Object.prototype.hasOwnProperty.call(_,S)&&x.indexOf(S)<0&&(b[S]=_[S]);if(_!=null&&typeof Object.getOwnPropertySymbols=="function")for(var P=0,S=Object.getOwnPropertySymbols(_);P<S.length;P++)x.indexOf(S[P])<0&&Object.prototype.propertyIsEnumerable.call(_,S[P])&&(b[S[P]]=_[S[P]]);return b};Object.defineProperty(r,"__esModule",{value:!0}),r.mapRawChangeset=void 0,r.listChangesets=p,r.getChangeset=g;const s=t("../_osmFetch"),d=_=>{var{comments:x}=_,b=c(_,["comments"]);return Object.assign(Object.assign({},b),{created_at:new Date(b.created_at),closed_at:b.closed_at?new Date(b.closed_at):void 0,discussion:x?.map(S=>Object.assign(Object.assign({},S),{date:new Date(S.date),uid:`${S.uid}`}))})};r.mapRawChangeset=d;function p(_,x){return o(this,void 0,void 0,function*(){const{only:b}=_,S=c(_,["only"]);return(yield(0,s.osmFetch)("/0.6/changesets.json",Object.assign(Object.assign({},b&&{[b]:!0}),S),x)).changesets.map(r.mapRawChangeset)})}function g(_){return o(this,arguments,void 0,function*(x,b=!0,S){const P=yield(0,s.osmFetch)(`/0.6/changeset/${x}.json`,b?{include_discussion:1}:{},S);return(0,r.mapRawChangeset)(P.changeset)})}},{"../_osmFetch":17}],25:[function(t,i,r){var o=this&&this.__createBinding||(Object.create?(function(p,g,_,x){x===void 0&&(x=_);var b=Object.getOwnPropertyDescriptor(g,_);(!b||("get"in b?!g.__esModule:b.writable||b.configurable))&&(b={enumerable:!0,get:function(){return g[_]}}),Object.defineProperty(p,x,b)}):(function(p,g,_,x){x===void 0&&(x=_),p[x]=g[_]})),c=this&&this.__exportStar||function(p,g){for(var _ in p)_!=="default"&&!Object.prototype.hasOwnProperty.call(g,_)&&o(g,p,_)};Object.defineProperty(r,"__esModule",{value:!0}),r.createOsmChangeXml=r.parseOsmChangeXml=void 0,c(t("./chunkOsmChange"),r),c(t("./createChangesetComment"),r),c(t("./getChangesetDiff"),r),c(t("./getChangesets"),r),c(t("./subscription"),r),c(t("./uploadChangeset"),r);var s=t("./_parseOsmChangeXml");Object.defineProperty(r,"parseOsmChangeXml",{enumerable:!0,get:function(){return s.parseOsmChangeXml}});var d=t("./_createOsmChangeXml");Object.defineProperty(r,"createOsmChangeXml",{enumerable:!0,get:function(){return d.createOsmChangeXml}})},{"./_createOsmChangeXml":19,"./_parseOsmChangeXml":20,"./chunkOsmChange":21,"./createChangesetComment":22,"./getChangesetDiff":23,"./getChangesets":24,"./subscription":26,"./uploadChangeset":27}],26:[function(t,i,r){var o=this&&this.__awaiter||function(p,g,_,x){function b(S){return S instanceof _?S:new _(function(P){P(S)})}return new(_||(_=Promise))(function(S,P){function L(D){try{C(x.next(D))}catch(O){P(O)}}function E(D){try{C(x.throw(D))}catch(O){P(O)}}function C(D){D.done?S(D.value):b(D.value).then(L,E)}C((x=x.apply(p,g||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.subscribeToChangeset=s,r.unsubscribeFromChangeset=d;const c=t("../_osmFetch");function s(p,g){return o(this,void 0,void 0,function*(){yield(0,c.osmFetch)(`/0.6/changeset/${p}/subscribe`,{},Object.assign(Object.assign({},g),{method:"POST"}))})}function d(p,g){return o(this,void 0,void 0,function*(){yield(0,c.osmFetch)(`/0.6/changeset/${p}/unsubscribe`,{},Object.assign(Object.assign({},g),{method:"POST"}))})}},{"../_osmFetch":17}],27:[function(t,i,r){var o=this&&this.__awaiter||function(b,S,P,L){function E(C){return C instanceof P?C:new P(function(D){D(C)})}return new(P||(P=Promise))(function(C,D){function O(G){try{q(L.next(G))}catch(N){D(N)}}function U(G){try{q(L.throw(G))}catch(N){D(N)}}function q(G){G.done?C(G.value):E(G.value).then(O,U)}q((L=L.apply(b,S||[])).next())})},c=this&&this.__rest||function(b,S){var P={};for(var L in b)Object.prototype.hasOwnProperty.call(b,L)&&S.indexOf(L)<0&&(P[L]=b[L]);if(b!=null&&typeof Object.getOwnPropertySymbols=="function")for(var E=0,L=Object.getOwnPropertySymbols(b);E<L.length;E++)S.indexOf(L[E])<0&&Object.prototype.propertyIsEnumerable.call(b,L[E])&&(P[L[E]]=b[L[E]]);return P};Object.defineProperty(r,"__esModule",{value:!0}),r.compress=_,r.uploadChangeset=x;const s=t("../_osmFetch"),d=t("../../../package.json"),p=t("./_createOsmChangeXml"),g=t("./chunkOsmChange");function _(b){if(!globalThis.CompressionStream)return;const S=new Response(b).body.pipeThrough(new CompressionStream("gzip"));return new Response(S).blob()}function x(b,S,P){return o(this,void 0,void 0,function*(){const L=P||{},{onChunk:E,onProgress:C,disableCompression:D}=L,O=c(L,["onChunk","onProgress","disableCompression"]),U=(0,g.chunkOsmChange)(S),q=[],G=(0,g.getOsmChangeSize)(S);for(const[N,V]of U.entries()){let j=b;U.length>1&&(E?j=E({featureCount:G,changesetIndex:N,changesetTotal:U.length}):j.chunk=`${N+1}/${U.length}`),j.created_by||(j.created_by=`osm-api-js ${d.version}`),C?.({phase:"upload",step:N+1,total:U.length});const z=+(yield(0,s.osmFetch)("/0.6/changeset/create",void 0,Object.assign(Object.assign({},O),{method:"PUT",body:(0,p.createChangesetMetaXml)(j),headers:Object.assign(Object.assign({},O.headers),{"content-type":"application/xml; charset=utf-8"})}))),Q=(0,p.createOsmChangeXml)(z,V),X=!D&&(yield _(Q));yield(0,s.osmFetch)(`/0.6/changeset/${z}/upload`,void 0,Object.assign(Object.assign({},O),{method:"POST",body:X||Q,headers:Object.assign(Object.assign(Object.assign({},O.headers),X&&{"Content-Encoding":"gzip"}),{"content-type":"application/xml; charset=utf-8"})})),yield(0,s.osmFetch)(`/0.6/changeset/${z}/close`,void 0,Object.assign(Object.assign({},O),{method:"PUT"})),q.push(z)}return q[0]})}},{"../../../package.json":16,"../_osmFetch":17,"./_createOsmChangeXml":19,"./chunkOsmChange":21}],28:[function(t,i,r){var o=this&&this.__awaiter||function(d,p,g,_){function x(b){return b instanceof g?b:new g(function(S){S(b)})}return new(g||(g=Promise))(function(b,S){function P(C){try{E(_.next(C))}catch(D){S(D)}}function L(C){try{E(_.throw(C))}catch(D){S(D)}}function E(C){C.done?b(C.value):x(C.value).then(P,L)}E((_=_.apply(d,p||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.createUserBlock=s;const c=t("../_osmFetch");function s(d,p){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)("/0.6/user_blocks.json",d,Object.assign(Object.assign({},p),{method:"POST"}))).user_block})}},{"../_osmFetch":17}],29:[function(t,i,r){var o=this&&this.__awaiter||function(d,p,g,_){function x(b){return b instanceof g?b:new g(function(S){S(b)})}return new(g||(g=Promise))(function(b,S){function P(C){try{E(_.next(C))}catch(D){S(D)}}function L(C){try{E(_.throw(C))}catch(D){S(D)}}function E(C){C.done?b(C.value):x(C.value).then(P,L)}E((_=_.apply(d,p||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.getUserBlock=s;const c=t("../_osmFetch");function s(d,p){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)(`/0.6/user_blocks/${d}.json`,{},p)).user_block})}},{"../_osmFetch":17}],30:[function(t,i,r){var o=this&&this.__awaiter||function(p,g,_,x){function b(S){return S instanceof _?S:new _(function(P){P(S)})}return new(_||(_=Promise))(function(S,P){function L(D){try{C(x.next(D))}catch(O){P(O)}}function E(D){try{C(x.throw(D))}catch(O){P(O)}}function C(D){D.done?S(D.value):b(D.value).then(L,E)}C((x=x.apply(p,g||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.hideChangesetComment=d;const c=t("../_osmFetch"),s=t("../changesets");function d(p,g,_){return o(this,void 0,void 0,function*(){const x=yield(0,c.osmFetch)(`/0.6/changeset_comments/${p}/visibility.json`,{},Object.assign(Object.assign({},_),{method:g==="unhide"?"POST":"DELETE"}));return(0,s.mapRawChangeset)(x.changeset)})}},{"../_osmFetch":17,"../changesets":25}],31:[function(t,i,r){var o=this&&this.__awaiter||function(p,g,_,x){function b(S){return S instanceof _?S:new _(function(P){P(S)})}return new(_||(_=Promise))(function(S,P){function L(D){try{C(x.next(D))}catch(O){P(O)}}function E(D){try{C(x.throw(D))}catch(O){P(O)}}function C(D){D.done?S(D.value):b(D.value).then(L,E)}C((x=x.apply(p,g||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.hideNote=d;const c=t("../_osmFetch"),s=t("../notes");function d(p,g,_){return o(this,void 0,void 0,function*(){const x=yield(0,c.osmFetch)(`/0.6/notes/${p}.json`,g?{text:g}:{},Object.assign(Object.assign({},_),{method:"DELETE"}));return(0,s.featureToNote)(x)})}},{"../_osmFetch":17,"../notes":48}],32:[function(t,i,r){var o=this&&this.__createBinding||(Object.create?(function(s,d,p,g){g===void 0&&(g=p);var _=Object.getOwnPropertyDescriptor(d,p);(!_||("get"in _?!d.__esModule:_.writable||_.configurable))&&(_={enumerable:!0,get:function(){return d[p]}}),Object.defineProperty(s,g,_)}):(function(s,d,p,g){g===void 0&&(g=p),s[g]=d[p]})),c=this&&this.__exportStar||function(s,d){for(var p in s)p!=="default"&&!Object.prototype.hasOwnProperty.call(d,p)&&o(d,s,p)};Object.defineProperty(r,"__esModule",{value:!0}),c(t("./createUserBlock"),r),c(t("./getUserBlock"),r),c(t("./hideChangesetComment"),r),c(t("./hideNote"),r),c(t("./redactFeature"),r)},{"./createUserBlock":28,"./getUserBlock":29,"./hideChangesetComment":30,"./hideNote":31,"./redactFeature":33}],33:[function(t,i,r){var o=this&&this.__awaiter||function(d,p,g,_){function x(b){return b instanceof g?b:new g(function(S){S(b)})}return new(g||(g=Promise))(function(b,S){function P(C){try{E(_.next(C))}catch(D){S(D)}}function L(C){try{E(_.throw(C))}catch(D){S(D)}}function E(C){C.done?b(C.value):x(C.value).then(P,L)}E((_=_.apply(d,p||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.redactFeature=s;const c=t("../_osmFetch");function s(d,p){return o(this,arguments,void 0,function*({featureType:g,featureId:_,featureVersion:x,redactionId:b},S){yield(0,c.osmFetch)(`/0.6/${g}/${_}/${x}/redact`,b?{redaction:b}:{},Object.assign(Object.assign({},S),{method:"POST"}))})}},{"../_osmFetch":17}],34:[function(t,i,r){var o=this&&this.__awaiter||function(p,g,_,x){function b(S){return S instanceof _?S:new _(function(P){P(S)})}return new(_||(_=Promise))(function(S,P){function L(D){try{C(x.next(D))}catch(O){P(O)}}function E(D){try{C(x.throw(D))}catch(O){P(O)}}function C(D){D.done?S(D.value):b(D.value).then(L,E)}C((x=x.apply(p,g||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.getApiCapabilities=s,r.getCapabilities=d;const c=t("./_osmFetch");function s(p){return o(this,void 0,void 0,function*(){return(0,c.osmFetch)("/capabilities.json",void 0,p)})}function d(){return o(this,void 0,void 0,function*(){const p=yield s();return{limits:{maxArea:p.api.area.maximum,maxNoteArea:p.api.note_area.maximum,maxTracepointPerPage:p.api.tracepoints.per_page,maxWayNodes:p.api.waynodes.maximum,maxChangesetElements:p.api.changesets.maximum_elements,maxTimeout:p.api.timeout.seconds},policy:{imageryBlacklist:p.policy.imagery.blacklist.map(_=>_.regex)}}})}},{"./_osmFetch":17}],35:[function(t,i,r){var o=this&&this.__awaiter||function(b,S,P,L){function E(C){return C instanceof P?C:new P(function(D){D(C)})}return new(P||(P=Promise))(function(C,D){function O(G){try{q(L.next(G))}catch(N){D(N)}}function U(G){try{q(L.throw(G))}catch(N){D(N)}}function q(G){G.done?C(G.value):E(G.value).then(O,U)}q((L=L.apply(b,S||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.getFeature=s,r.getFeatures=d,r.getFeatureAtVersion=p,r.getFeatureHistory=g,r.getWaysForNode=_,r.getRelationsForElement=x;const c=t("./_osmFetch");function s(b,S,P,L){return o(this,void 0,void 0,function*(){const E=P&&b!=="node"?"/full":"";return(yield(0,c.osmFetch)(`/0.6/${b}/${S}${E}.json`,void 0,L)).elements})}function d(b,S,P){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)(`/0.6/${b}s.json?${b}s=${S.join(",")}`,void 0,P)).elements})}function p(b,S,P,L){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)(`/0.6/${b}/${S}/${P}.json`,void 0,L)).elements[0]})}function g(b,S,P){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)(`/0.6/${b}/${S}/history.json`,void 0,P)).elements})}function _(b,S){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)(`/0.6/node/${b}/ways.json`,void 0,S)).elements})}function x(b,S,P){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)(`/0.6/${b}/${S}/relations.json`,void 0,P)).elements})}},{"./_osmFetch":17}],36:[function(t,i,r){var o=this&&this.__awaiter||function(d,p,g,_){function x(b){return b instanceof g?b:new g(function(S){S(b)})}return new(g||(g=Promise))(function(b,S){function P(C){try{E(_.next(C))}catch(D){S(D)}}function L(C){try{E(_.throw(C))}catch(D){S(D)}}function E(C){C.done?b(C.value):x(C.value).then(P,L)}E((_=_.apply(d,p||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.getMapData=s;const c=t("./_osmFetch");function s(d,p){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)("/0.6/map.json",{bbox:d},p)).elements})}},{"./_osmFetch":17}],37:[function(t,i,r){var o=this&&this.__awaiter||function(d,p,g,_){function x(b){return b instanceof g?b:new g(function(S){S(b)})}return new(g||(g=Promise))(function(b,S){function P(C){try{E(_.next(C))}catch(D){S(D)}}function L(C){try{E(_.throw(C))}catch(D){S(D)}}function E(C){C.done?b(C.value):x(C.value).then(P,L)}E((_=_.apply(d,p||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.getPermissions=s;const c=t("./_osmFetch");function s(d){return o(this,void 0,void 0,function*(){return(0,c.osmFetch)("/0.6/permissions.json",void 0,d)})}},{"./_osmFetch":17}],38:[function(t,i,r){var o=this&&this.__awaiter||function(d,p,g,_){function x(b){return b instanceof g?b:new g(function(S){S(b)})}return new(g||(g=Promise))(function(b,S){function P(C){try{E(_.next(C))}catch(D){S(D)}}function L(C){try{E(_.throw(C))}catch(D){S(D)}}function E(C){C.done?b(C.value):x(C.value).then(P,L)}E((_=_.apply(d,p||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.getUIdFromDisplayName=s;const c=t("./changesets");function s(d){return o(this,void 0,void 0,function*(){const p=yield(0,c.listChangesets)({display_name:d});if(!p.length)throw new Error("Could not get uid because the user has never edited the map");return p[0].uid})}},{"./changesets":25}],39:[function(t,i,r){var o=this&&this.__awaiter||function(_,x,b,S){function P(L){return L instanceof b?L:new b(function(E){E(L)})}return new(b||(b=Promise))(function(L,E){function C(U){try{O(S.next(U))}catch(q){E(q)}}function D(U){try{O(S.throw(U))}catch(q){E(q)}}function O(U){U.done?L(U.value):P(U.value).then(C,D)}O((S=S.apply(_,x||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.getUser=s,r.getUsers=d,r.getUserBlockById=p,r.getOwnUserBlocks=g;const c=t("./_osmFetch");function s(_,x){return o(this,void 0,void 0,function*(){const b=yield(0,c.osmFetch)(`/0.6/user/${_==="me"?"details":_}.json`,void 0,x);return Object.assign(Object.assign({},b.user),{account_created:new Date(b.user.account_created)})})}function d(_,x){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)("/0.6/users",{users:_},x)).users.map(S=>Object.assign(Object.assign({},S),{account_created:new Date(S.account_created)}))})}function p(_,x){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)(`/0.6/user_blocks/${_}.json`,void 0,x)).user_block})}function g(_){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)("/0.6/user/blocks/active",void 0,_)).user_blocks})}},{"./_osmFetch":17}],40:[function(t,i,r){var o=this&&this.__createBinding||(Object.create?(function(s,d,p,g){g===void 0&&(g=p);var _=Object.getOwnPropertyDescriptor(d,p);(!_||("get"in _?!d.__esModule:_.writable||_.configurable))&&(_={enumerable:!0,get:function(){return d[p]}}),Object.defineProperty(s,g,_)}):(function(s,d,p,g){g===void 0&&(g=p),s[g]=d[p]})),c=this&&this.__exportStar||function(s,d){for(var p in s)p!=="default"&&!Object.prototype.hasOwnProperty.call(d,p)&&o(d,s,p)};Object.defineProperty(r,"__esModule",{value:!0}),c(t("./changesets"),r),c(t("./dwg"),r),c(t("./messages"),r),c(t("./notes"),r),c(t("./preferences"),r),c(t("./getCapabilities"),r),c(t("./getFeature"),r),c(t("./getMapData"),r),c(t("./getPermissions"),r),c(t("./getUIdFromDisplayName"),r),c(t("./getUser"),r)},{"./changesets":25,"./dwg":32,"./getCapabilities":34,"./getFeature":35,"./getMapData":36,"./getPermissions":37,"./getUIdFromDisplayName":38,"./getUser":39,"./messages":43,"./notes":48,"./preferences":53}],41:[function(t,i,r){var o=this&&this.__awaiter||function(d,p,g,_){function x(b){return b instanceof g?b:new g(function(S){S(b)})}return new(g||(g=Promise))(function(b,S){function P(C){try{E(_.next(C))}catch(D){S(D)}}function L(C){try{E(_.throw(C))}catch(D){S(D)}}function E(C){C.done?b(C.value):x(C.value).then(P,L)}E((_=_.apply(d,p||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.deleteMessage=s;const c=t("../_osmFetch");function s(d,p){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)(`/0.6/user/messages/${d}.json`,{},Object.assign(Object.assign({},p),{method:"DELETE"}))).message})}},{"../_osmFetch":17}],42:[function(t,i,r){var o=this&&this.__awaiter||function(d,p,g,_){function x(b){return b instanceof g?b:new g(function(S){S(b)})}return new(g||(g=Promise))(function(b,S){function P(C){try{E(_.next(C))}catch(D){S(D)}}function L(C){try{E(_.throw(C))}catch(D){S(D)}}function E(C){C.done?b(C.value):x(C.value).then(P,L)}E((_=_.apply(d,p||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.getMessage=s;const c=t("../_osmFetch");function s(d,p){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)(`/0.6/user/messages/${d}.json`,void 0,p)).message})}},{"../_osmFetch":17}],43:[function(t,i,r){var o=this&&this.__createBinding||(Object.create?(function(s,d,p,g){g===void 0&&(g=p);var _=Object.getOwnPropertyDescriptor(d,p);(!_||("get"in _?!d.__esModule:_.writable||_.configurable))&&(_={enumerable:!0,get:function(){return d[p]}}),Object.defineProperty(s,g,_)}):(function(s,d,p,g){g===void 0&&(g=p),s[g]=d[p]})),c=this&&this.__exportStar||function(s,d){for(var p in s)p!=="default"&&!Object.prototype.hasOwnProperty.call(d,p)&&o(d,s,p)};Object.defineProperty(r,"__esModule",{value:!0}),c(t("./deleteMessage"),r),c(t("./getMessage"),r),c(t("./listMessages"),r),c(t("./sendMessage"),r),c(t("./updateMessageReadStatus"),r)},{"./deleteMessage":41,"./getMessage":42,"./listMessages":44,"./sendMessage":45,"./updateMessageReadStatus":46}],44:[function(t,i,r){var o=this&&this.__awaiter||function(d,p,g,_){function x(b){return b instanceof g?b:new g(function(S){S(b)})}return new(g||(g=Promise))(function(b,S){function P(C){try{E(_.next(C))}catch(D){S(D)}}function L(C){try{E(_.throw(C))}catch(D){S(D)}}function E(C){C.done?b(C.value):x(C.value).then(P,L)}E((_=_.apply(d,p||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.listMessages=s;const c=t("../_osmFetch");function s(d,p){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)(`/0.6/user/messages/${d}.json`,void 0,p)).messages})}},{"../_osmFetch":17}],45:[function(t,i,r){var o=this&&this.__awaiter||function(d,p,g,_){function x(b){return b instanceof g?b:new g(function(S){S(b)})}return new(g||(g=Promise))(function(b,S){function P(C){try{E(_.next(C))}catch(D){S(D)}}function L(C){try{E(_.throw(C))}catch(D){S(D)}}function E(C){C.done?b(C.value):x(C.value).then(P,L)}E((_=_.apply(d,p||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.sendMessage=s;const c=t("../_osmFetch");function s(d,p){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)("/0.6/user/messages.json",d,Object.assign(Object.assign({},p),{method:"POST"}))).message})}},{"../_osmFetch":17}],46:[function(t,i,r){var o=this&&this.__awaiter||function(d,p,g,_){function x(b){return b instanceof g?b:new g(function(S){S(b)})}return new(g||(g=Promise))(function(b,S){function P(C){try{E(_.next(C))}catch(D){S(D)}}function L(C){try{E(_.throw(C))}catch(D){S(D)}}function E(C){C.done?b(C.value):x(C.value).then(P,L)}E((_=_.apply(d,p||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.updateMessageReadStatus=s;const c=t("../_osmFetch");function s(d,p,g){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)(`/0.6/user/messages/${d}.json`,{read_status:p},Object.assign(Object.assign({},g),{method:"POST"}))).message})}},{"../_osmFetch":17}],47:[function(t,i,r){var o=this&&this.__awaiter||function(x,b,S,P){function L(E){return E instanceof S?E:new S(function(C){C(E)})}return new(S||(S=Promise))(function(E,C){function D(q){try{U(P.next(q))}catch(G){C(G)}}function O(q){try{U(P.throw(q))}catch(G){C(G)}}function U(q){q.done?E(q.value):L(q.value).then(D,O)}U((P=P.apply(x,b||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.featureToNote=void 0,r.getNotesForQuery=p,r.getNotesForArea=g,r.getNote=_;const c=t("../_osmFetch"),s=x=>{const[b,S]=x.geometry.coordinates;return Object.assign(Object.assign({},x.properties),{location:{lat:S,lng:b}})};r.featureToNote=s;function d(x,b,S){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)(`/0.6/notes${b?"/search":""}.json`,x,S)).features.map(r.featureToNote)})}function p(x,b){return d(x,!0,b)}function g(x,b){return d({bbox:x},!1,b)}function _(x,b){return o(this,void 0,void 0,function*(){const S=yield(0,c.osmFetch)(`/0.6/notes/${x}.json`,void 0,b);return(0,r.featureToNote)(S)})}},{"../_osmFetch":17}],48:[function(t,i,r){var o=this&&this.__createBinding||(Object.create?(function(s,d,p,g){g===void 0&&(g=p);var _=Object.getOwnPropertyDescriptor(d,p);(!_||("get"in _?!d.__esModule:_.writable||_.configurable))&&(_={enumerable:!0,get:function(){return d[p]}}),Object.defineProperty(s,g,_)}):(function(s,d,p,g){g===void 0&&(g=p),s[g]=d[p]})),c=this&&this.__exportStar||function(s,d){for(var p in s)p!=="default"&&!Object.prototype.hasOwnProperty.call(d,p)&&o(d,s,p)};Object.defineProperty(r,"__esModule",{value:!0}),c(t("./getNotes"),r),c(t("./noteActions"),r),c(t("./subscription"),r)},{"./getNotes":47,"./noteActions":49,"./subscription":50}],49:[function(t,i,r){var o=this&&this.__awaiter||function(x,b,S,P){function L(E){return E instanceof S?E:new S(function(C){C(E)})}return new(S||(S=Promise))(function(E,C){function D(q){try{U(P.next(q))}catch(G){C(G)}}function O(q){try{U(P.throw(q))}catch(G){C(G)}}function U(q){q.done?E(q.value):L(q.value).then(D,O)}U((P=P.apply(x,b||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.createNote=d,r.commentOnNote=p,r.closeNote=g,r.reopenNote=_;const c=t("../_osmFetch"),s=t("./getNotes");function d(x,b,S,P){return o(this,void 0,void 0,function*(){const L=yield(0,c.osmFetch)("/0.6/notes.json",{lat:x,lon:b,text:S},Object.assign(Object.assign({},P),{method:"POST"}));return(0,s.featureToNote)(L)})}function p(x,b,S){return o(this,void 0,void 0,function*(){const P=yield(0,c.osmFetch)(`/0.6/notes/${x}/comment.json`,b?{text:b}:{},Object.assign(Object.assign({},S),{method:"POST"}));return(0,s.featureToNote)(P)})}function g(x,b,S){return o(this,void 0,void 0,function*(){const P=yield(0,c.osmFetch)(`/0.6/notes/${x}/close.json`,b?{text:b}:{},Object.assign(Object.assign({},S),{method:"POST"}));return(0,s.featureToNote)(P)})}function _(x,b,S){return o(this,void 0,void 0,function*(){const P=yield(0,c.osmFetch)(`/0.6/notes/${x}/reopen.json`,b?{text:b}:{},Object.assign(Object.assign({},S),{method:"POST"}));return(0,s.featureToNote)(P)})}},{"../_osmFetch":17,"./getNotes":47}],50:[function(t,i,r){var o=this&&this.__awaiter||function(p,g,_,x){function b(S){return S instanceof _?S:new _(function(P){P(S)})}return new(_||(_=Promise))(function(S,P){function L(D){try{C(x.next(D))}catch(O){P(O)}}function E(D){try{C(x.throw(D))}catch(O){P(O)}}function C(D){D.done?S(D.value):b(D.value).then(L,E)}C((x=x.apply(p,g||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.subscribeToNote=s,r.unsubscribeFromNote=d;const c=t("../_osmFetch");function s(p,g){return o(this,void 0,void 0,function*(){yield(0,c.osmFetch)(`/0.6/notes/${p}/subscription`,{},Object.assign(Object.assign({},g),{method:"POST"}))})}function d(p,g){return o(this,void 0,void 0,function*(){yield(0,c.osmFetch)(`/0.6/notes/${p}/subscription`,{},Object.assign(Object.assign({},g),{method:"DELETE"}))})}},{"../_osmFetch":17}],51:[function(t,i,r){var o=this&&this.__awaiter||function(d,p,g,_){function x(b){return b instanceof g?b:new g(function(S){S(b)})}return new(g||(g=Promise))(function(b,S){function P(C){try{E(_.next(C))}catch(D){S(D)}}function L(C){try{E(_.throw(C))}catch(D){S(D)}}function E(C){C.done?b(C.value):x(C.value).then(P,L)}E((_=_.apply(d,p||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.deletePreferences=s;const c=t("../_osmFetch");function s(d,p){return o(this,void 0,void 0,function*(){yield(0,c.osmFetch)(`/0.6/user/preferences/${d}.json`,{},Object.assign(Object.assign({},p),{method:"DELETE"}))})}},{"../_osmFetch":17}],52:[function(t,i,r){var o=this&&this.__awaiter||function(d,p,g,_){function x(b){return b instanceof g?b:new g(function(S){S(b)})}return new(g||(g=Promise))(function(b,S){function P(C){try{E(_.next(C))}catch(D){S(D)}}function L(C){try{E(_.throw(C))}catch(D){S(D)}}function E(C){C.done?b(C.value):x(C.value).then(P,L)}E((_=_.apply(d,p||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.getPreferences=s;const c=t("../_osmFetch");function s(d){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)("/0.6/user/preferences.json",void 0,d)).preferences})}},{"../_osmFetch":17}],53:[function(t,i,r){var o=this&&this.__createBinding||(Object.create?(function(s,d,p,g){g===void 0&&(g=p);var _=Object.getOwnPropertyDescriptor(d,p);(!_||("get"in _?!d.__esModule:_.writable||_.configurable))&&(_={enumerable:!0,get:function(){return d[p]}}),Object.defineProperty(s,g,_)}):(function(s,d,p,g){g===void 0&&(g=p),s[g]=d[p]})),c=this&&this.__exportStar||function(s,d){for(var p in s)p!=="default"&&!Object.prototype.hasOwnProperty.call(d,p)&&o(d,s,p)};Object.defineProperty(r,"__esModule",{value:!0}),c(t("./deletePreferences"),r),c(t("./getPreferences"),r),c(t("./updatePreferences"),r)},{"./deletePreferences":51,"./getPreferences":52,"./updatePreferences":54}],54:[function(t,i,r){var o=this&&this.__awaiter||function(d,p,g,_){function x(b){return b instanceof g?b:new g(function(S){S(b)})}return new(g||(g=Promise))(function(b,S){function P(C){try{E(_.next(C))}catch(D){S(D)}}function L(C){try{E(_.throw(C))}catch(D){S(D)}}function E(C){C.done?b(C.value):x(C.value).then(P,L)}E((_=_.apply(d,p||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.updatePreferences=s;const c=t("../_osmFetch");function s(d,p,g){return o(this,void 0,void 0,function*(){yield(0,c.osmFetch)(`/0.6/user/preferences/${d}.json`,{},Object.assign(Object.assign({},g),{method:"PUT",body:p}))})}},{"../_osmFetch":17}],55:[function(t,i,r){Object.defineProperty(r,"__esModule",{value:!0}),r.createPopup=c;const o="osm-api-auth-complete";function c(s){let d=!1;return new Promise(p=>{const[g,_]=[600,550],x=Object.entries({width:g,height:_,left:window.screen.width/2-g/2,top:window.screen.height/2-_/2}).map(([L,E])=>`${L}=${E}`).join(","),b=window.open("about:blank","oauth_window",x);if(!b)throw new Error("Popup was blocked");b.location=s;const S=new BroadcastChannel(o),P=L=>{d||(p(L.data),d=!0,S.removeEventListener("message",P),S.close())};S.addEventListener("message",P)})}},{}],56:[function(t,i,r){var o=this&&this.__awaiter||function(d,p,g,_){function x(b){return b instanceof g?b:new g(function(S){S(b)})}return new(g||(g=Promise))(function(b,S){function P(C){try{E(_.next(C))}catch(D){S(D)}}function L(C){try{E(_.throw(C))}catch(D){S(D)}}function E(C){C.done?b(C.value):x(C.value).then(P,L)}E((_=_.apply(d,p||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.exchangeCode=s;const c=t("./helpers");function s(d,p){return o(this,arguments,void 0,function*(g,{options:_,pkceVerifier:x,state:b}){const S=new URL(g).searchParams,P=S.get("error_description"),L=S.get("code"),E=S.get("state");if(P)throw new Error(P);if(!L)throw new Error("No code in OAuth response");if(!x||!b)throw new Error("No login in progress");if(b!==E)throw new Error("State Mismatch");const C={grant_type:"authorization_code",code:L,redirect_uri:_.redirectUrl,client_id:_.clientId,code_verifier:x},D=`${(0,c.getOAuthBaseUrl)()}/oauth2/token?${new URLSearchParams(C).toString()}`,U=yield(yield fetch(D,{method:"POST",body:"",headers:{"Content-Type":"application/x-www-form-urlencoded"}})).json();if("error_description"in U)throw new Error(U.error_description);const q={issuedAt:new Date(U.created_at*1e3).toISOString(),accessToken:U.access_token,scopes:U.scope.split(" ")};return localStorage.setItem("__osmAuth",JSON.stringify(q)),q})}},{"./helpers":57}],57:[function(t,i,r){var o=this&&this.__awaiter||function(g,_,x,b){function S(P){return P instanceof x?P:new x(function(L){L(P)})}return new(x||(x=Promise))(function(P,L){function E(O){try{D(b.next(O))}catch(U){L(U)}}function C(O){try{D(b.throw(O))}catch(U){L(U)}}function D(O){O.done?P(O.value):S(O.value).then(E,C)}D((b=b.apply(g,_||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.sha256=s,r.getRandomString=d,r.getOAuthBaseUrl=p;const c=t("../config");function s(g){return o(this,void 0,void 0,function*(){const _=new TextEncoder().encode(g),x=yield window.crypto.subtle.digest("SHA-256",_);return btoa(String.fromCharCode(...new Uint8Array(x))).replaceAll("+","-").replaceAll("/","_").replaceAll("=","")})}function d(){return[...window.crypto.getRandomValues(new Uint32Array(32))].map(g=>`0${g.toString(16)}`.slice(-2)).join("")}function p(){let g=(0,c.getConfig)().apiUrl;return g==="https://api.openstreetmap.org"&&(g="https://www.openstreetmap.org"),g}},{"../config":60}],58:[function(t,i,r){var o=this&&this.__createBinding||(Object.create?(function(s,d,p,g){g===void 0&&(g=p);var _=Object.getOwnPropertyDescriptor(d,p);(!_||("get"in _?!d.__esModule:_.writable||_.configurable))&&(_={enumerable:!0,get:function(){return d[p]}}),Object.defineProperty(s,g,_)}):(function(s,d,p,g){g===void 0&&(g=p),s[g]=d[p]})),c=this&&this.__exportStar||function(s,d){for(var p in s)p!=="default"&&!Object.prototype.hasOwnProperty.call(d,p)&&o(d,s,p)};Object.defineProperty(r,"__esModule",{value:!0}),c(t("./oauth2"),r)},{"./oauth2":59}],59:[function(t,i,r){var o=this&&this.__awaiter||function(b,S,P,L){function E(C){return C instanceof P?C:new P(function(D){D(C)})}return new(P||(P=Promise))(function(C,D){function O(G){try{q(L.next(G))}catch(N){D(N)}}function U(G){try{q(L.throw(G))}catch(N){D(N)}}function q(G){G.done?C(G.value):E(G.value).then(O,U)}q((L=L.apply(b,S||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.isLoggedIn=r.getAuthToken=r.authReady=void 0,r.login=p,r.logout=x;const c=t("./createPopup"),s=t("./exchangeCode"),d=t("./helpers");function p(b){return o(this,void 0,void 0,function*(){if(!b.redirectUrl)throw new Error("You must include the 'redirectUrl' option");if(!b.clientId)throw new Error("You must include the 'clientId' option");if(!b.scopes)throw new Error("You must include the 'scopes' option");const S=(0,d.getRandomString)(),P=(0,d.getRandomString)(),L=yield(0,d.sha256)(P),E={scope:b.scopes.join(" "),include_granted_scopes:"true",response_type:"code",state:S,redirect_uri:b.redirectUrl,client_id:b.clientId,code_challenge_method:"S256",code_challenge:L},C=`/oauth2/authorize?${new URLSearchParams(E).toString()}`,D=b.switchUser?`/logout?referer=${encodeURIComponent(`/login?referer=${encodeURIComponent(C)}`)}`:C,O=(0,d.getOAuthBaseUrl)()+D,U={state:S,pkceVerifier:P,options:b};if(b.mode==="popup"){const q=yield(0,c.createPopup)(O);return(0,s.exchangeCode)(q,U)}if(b.mode==="redirect"){localStorage.setItem("__osmAuthTemp",JSON.stringify(U)),window.location.replace(O);return}throw new Error("options.mode must be 'popup' or 'redirect'")})}r.authReady=o(void 0,void 0,void 0,function*(){if(typeof window>"u")return;const b=window.location.href,S=localStorage.getItem("__osmAuthTemp");if(new URL(b).searchParams.get("code")&&S)try{const P=JSON.parse(S);yield(0,s.exchangeCode)(b,P),localStorage.removeItem("__osmAuthTemp")}catch(P){console.error("OSM Auth Error",P)}});const g=()=>{try{const b=localStorage.getItem("__osmAuth");return b?JSON.parse(b).accessToken:void 0}catch{return}};r.getAuthToken=g;const _=()=>!!(0,r.getAuthToken)();r.isLoggedIn=_;function x(){localStorage.removeItem("__osmAuth")}},{"./createPopup":55,"./exchangeCode":56,"./helpers":57}],60:[function(t,i,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getConfig=void 0,r.configure=s;const o={apiUrl:"https://api.openstreetmap.org",userAgent:"https://github.com/osmlab/osm-api-js"},c=()=>o;r.getConfig=c;function s(d){Object.assign(o,d)}},{}],61:[function(t,i,r){var o=this&&this.__createBinding||(Object.create?(function(s,d,p,g){g===void 0&&(g=p);var _=Object.getOwnPropertyDescriptor(d,p);(!_||("get"in _?!d.__esModule:_.writable||_.configurable))&&(_={enumerable:!0,get:function(){return d[p]}}),Object.defineProperty(s,g,_)}):(function(s,d,p,g){g===void 0&&(g=p),s[g]=d[p]})),c=this&&this.__exportStar||function(s,d){for(var p in s)p!=="default"&&!Object.prototype.hasOwnProperty.call(d,p)&&o(d,s,p)};Object.defineProperty(r,"__esModule",{value:!0}),c(t("./api"),r),c(t("./auth"),r),c(t("./config"),r),c(t("./types"),r)},{"./api":40,"./auth":58,"./config":60,"./types":65}],62:[function(t,i,r){Object.defineProperty(r,"__esModule",{value:!0})},{}],63:[function(t,i,r){arguments[4][62][0].apply(r,arguments)},{dup:62}],64:[function(t,i,r){arguments[4][62][0].apply(r,arguments)},{dup:62}],65:[function(t,i,r){var o=this&&this.__createBinding||(Object.create?(function(s,d,p,g){g===void 0&&(g=p);var _=Object.getOwnPropertyDescriptor(d,p);(!_||("get"in _?!d.__esModule:_.writable||_.configurable))&&(_={enumerable:!0,get:function(){return d[p]}}),Object.defineProperty(s,g,_)}):(function(s,d,p,g){g===void 0&&(g=p),s[g]=d[p]})),c=this&&this.__exportStar||function(s,d){for(var p in s)p!=="default"&&!Object.prototype.hasOwnProperty.call(d,p)&&o(d,s,p)};Object.defineProperty(r,"__esModule",{value:!0}),c(t("./changesets"),r),c(t("./features"),r),c(t("./general"),r),c(t("./messages"),r),c(t("./notes"),r),c(t("./osmPatch"),r),c(t("./user"),r)},{"./changesets":62,"./features":63,"./general":64,"./messages":66,"./notes":67,"./osmPatch":68,"./user":69}],66:[function(t,i,r){arguments[4][62][0].apply(r,arguments)},{dup:62}],67:[function(t,i,r){arguments[4][62][0].apply(r,arguments)},{dup:62}],68:[function(t,i,r){arguments[4][62][0].apply(r,arguments)},{dup:62}],69:[function(t,i,r){arguments[4][62][0].apply(r,arguments)},{dup:62}]},{},[61])(61)})})(TM)),TM.exports}var ty=ule(),hle=qt('<div class="mb-1"><button class="btn btn-danger">Clear edits</button> <button class="btn btn-danger"> </button></div> <div class="mb-1"><button class="btn btn-secondary">Download .osc</button> <button class="btn btn-secondary">Upload changeset</button></div>',1),dle=qt("<!> <!>",1);function fle(n,e){Qi(e,!0);const t=()=>nn(na,"$mutationCounter",o),i=()=>nn(zs,"$backend",o),r=()=>nn(dy,"$loggedInUser",o),[o,c]=is();let s=ii(Ss([])),d=ii("");cn(()=>{t(),bs(()=>{Ct(s,i()?JSON.parse(i().getEdits()):[],!0),ia(gw,te(s).length>0)})});async function p(){if(window.confirm("Do you really want to clear your edits?")){Ct(d,"Clearing edits"),await sl();try{i().editClear(),ip(na,t())}finally{Ct(d,"")}}}async function g(){Ct(d,"Undoing last edit"),await sl();try{i().editUndo(),ip(na,t())}finally{Ct(d,"")}}function _(){e1("changes.osc",i().toOsc())}async function x(){if(!r()){window.alert("You have to log in first");return}if(te(s).some(C=>!("SetTags"in C))){window.alert("You've done a bulk operation. You should NOT upload this to OSM -- it's only for testing or usage in you own tool that consumes OSM data.");return}if(!window.confirm("Do you really know what you're doing and want to upload this?"))return;let E=window.prompt("Please describe this changeset");if(E)try{let C=await ty.uploadChangeset({created_by:"Speedwalk",comment:E},JSON.parse(i().toOsmChangeJson()));window.open(`https://www.openstreetmap.org/changeset/${C}`,"_blank"),ia(zs,null),ia(gw,!1)}catch(C){window.alert(`Upload failed: ${C}`)}}async function b(E){E.key=="z"&&E.ctrlKey&&te(s).length>0&&await g()}var S=dle();Zw("keydown",xy,b);var P=ci(S);Yd(P,{get loading(){return te(d)}});var L=_t(P,2);qd(L,{header:D=>{var O=Nn();Zi(()=>sn(O,`${te(s).length??""}
    ${te(s).length==1?"edit":"edits"}`)),bt(D,O)},body:D=>{var O=tr(),U=ci(O);{var q=G=>{var N=hle(),V=ci(N),j=zt(V);j.__click=p;var z=_t(j,2);z.__click=g;var Q=zt(z),X=_t(V,2),re=zt(X);re.__click=_;var se=_t(re,2);se.__click=x,Zi(()=>{z.disabled=te(s).length==0,sn(Q,`Undo (${te(s).length??""})`)}),bt(G,N)};Ji(U,G=>{te(s).length>0&&G(q)})}bt(D,O)},$$slots:{header:!0,body:!0}}),bt(n,S),en(),c()}ds(["click"]);var ple=qt('<div style="display: flex; align-items: center; gap: 6px;"><!> <i class="fa-solid fa-hard-drive" style="font-size: 0.85em; color: #6c757d; cursor: help; flex-shrink: 0;" title="This setting is saved locally" aria-label="This setting is saved locally"></i></div>');function mE(n,e){var t=ple(),i=zt(t);hs(i,()=>e.children),bt(n,t)}var mle=qt('<div class="card mb-3"><div class="card-header">Assume old-style tags on one-ways</div> <div class="card-body"><!> <button class="btn btn-secondary">Autoset tags on one-ways</button></div></div> <div class="card mb-3"><div class="card-header">Make all sidewalks</div> <div class="card-body"><!> <button class="btn btn-secondary">Make sidewalks</button></div></div> <div class="card"><div class="card-header">Connect all crossing nodes</div> <div class="card-body"><!> <button class="btn btn-secondary">Create a way for every crossing node</button></div></div>',1),gle=qt('<button class="btn btn-secondary">Bulk operations</button>'),_le=qt("<h2>Bulk operations</h2>"),vle=qt(`<!> <p>Speedwalk has some experimental features that can automatically generate
    separate sidewalks on roads tagged with <i>sidewalk = left,right,both</i> . This is intended for use in routers and other tools that require separate sidewalks.
    This generation is very error-prone and not meant to ever replace mapping sidewalks
    properly, just as a stop-gap for areas with low coverage. Feel free to test it
    out, but do not ever upload the results to OSM.</p> <button class="btn btn-primary">I understand</button> <button class="btn btn-secondary">Cancel</button>`,1),yle=qt("<!> <!> <!>",1);function ble(n,e){Qi(e,!0);const t=()=>nn(_w,"$enabledBulkOps",o),i=()=>nn(zs,"$backend",o),r=()=>nn(na,"$mutationCounter",o),[o,c]=is();let s=ii(!1);function d(){ia(_w,!0),Ct(s,!1)}let p=ii(""),g=ii(!0),_=ii(!0),x=ii(!1);async function b(){Ct(p,"Generating sidewalks"),await sl();try{i().editMakeAllSidewalks(te(_)),ip(na,r())}catch(q){window.alert(`Error: ${q}`)}finally{Ct(p,"")}}async function S(){Ct(p,"Connecting crossings"),await sl();try{i().editConnectAllCrossings(te(x)),ip(na,r())}catch(q){window.alert(`Error: ${q}`)}finally{Ct(p,"")}}async function P(){Ct(p,"Inferring sidewalks around one-ways"),await sl();try{i().editAssumeTags(te(g)),ip(na,r())}catch(q){window.alert(`Error: ${q}`)}finally{Ct(p,"")}}var L=yle(),E=ci(L);Yd(E,{get loading(){return te(p)}});var C=_t(E,2);{var D=q=>{qd(q,{header:V=>{var j=Nn("Bulk operations");bt(V,j)},body:V=>{var j=mle(),z=ci(j),Q=_t(zt(z),2),X=zt(Q);ls(X,{get checked(){return te(g)},set checked(He){Ct(g,He,!0)},children:(He,De)=>{var ot=Nn("Drive on the left");bt(He,ot)},$$slots:{default:!0}});var re=_t(X,2);re.__click=P;var se=_t(z,2),le=_t(zt(se),2),ce=zt(le);ls(ce,{get checked(){return te(_)},set checked(He){Ct(_,He,!0)},children:(He,De)=>{var ot=Nn("Only for major roads");bt(He,ot)},$$slots:{default:!0}});var be=_t(ce,2);be.__click=b;var Ee=_t(se,2),$e=_t(zt(Ee),2),Ve=zt($e);ls(Ve,{get checked(){return te(x)},set checked(He){Ct(x,He,!0)},children:(He,De)=>{var ot=Nn("Include crossing=no");bt(He,ot)},$$slots:{default:!0}});var nt=_t(Ve,2);nt.__click=S,bt(V,j)},$$slots:{header:!0,body:!0}})},O=q=>{var G=gle();G.__click=()=>Ct(s,!0),bt(q,G)};Ji(C,q=>{t()?q(D):q(O,!1)})}var U=_t(C,2);gp(U,{get show(){return te(s)},set show(q){Ct(s,q,!0)},children:(q,G)=>{var N=vle(),V=ci(N);mE(V,{children:(Q,X)=>{var re=_le();bt(Q,re)}});var j=_t(V,4);j.__click=d;var z=_t(j,2);z.__click=()=>Ct(s,!1),bt(q,N)},$$slots:{default:!0}}),bt(n,L),en(),c()}ds(["click"]);var xle=qt('<span class="svelte-1jjc18c"></span>'),wle=qt('<span class="color-swatch svelte-1jjc18c"></span> ',1),Sle=qt('<div style="display: flex; align-items: center; gap: 6px;"><!></div>'),Tle=qt('<span class="color-swatch svelte-1jjc18c"></span> ',1),Mle=qt('<div style="display: flex; align-items: center; gap: 6px;"><!></div>'),Cle=qt('<div class="card mb-3"><div class="card-header">Roads</div> <div class="card-body"><div class="row mb-1 svelte-1jjc18c"></div> <!> <div class="mb-3"></div> <!></div></div> <!>',1);function Ele(n,e){Qi(e,!0);const t=()=>nn(na,"$mutationCounter",r),i=()=>nn(zs,"$backend",r),[r,o]=is();let c=ft(e,"showKinds",15),s=[["RoadWithSeparate","With separate sidewalks"],["RoadWithTags","With tagged sidewalks"],["RoadWithoutSidewalksExplicit","Tagged as no sidewalks"],["RoadWithoutSidewalksImplicit","Assumed as no sidewalks"],["RoadUnknown","Totally unknown"]],d=[["Sidewalk","Sidewalks"],["Crossing","Crossings"],["Other","Other"]],p=Kt(()=>(t(),JSON.parse(i().getMetrics()))),g=Kt(()=>ZG(s.map(([D,O])=>te(p).total_length_meters[D])));function _(D){return D}var x=Cle(),b=ci(x),S=_t(zt(b),2),P=zt(S);ws(P,21,()=>s,xs,(D,O)=>{var U=Kt(()=>tl(te(O),2));let q=()=>te(U)[0];const G=Kt(()=>te(p).total_length_meters[q()]);var N=xle();let V;Zi(j=>V=_h(N,"",V,j),[()=>({width:`${100*te(G)/te(g)}%`,height:"100%","background-color":cp[q()]})]),bt(D,N)});var L=_t(P,2);ws(L,17,()=>s,xs,(D,O)=>{var U=Kt(()=>tl(te(O),2));let q=()=>te(U)[0],G=()=>te(U)[1];var N=Sle(),V=zt(N);ls(V,{get checked(){return c()[q()]},set checked(j){c(c()[q()]=j,!0)},children:(j,z)=>{var Q=wle(),X=ci(Q);let re;var se=_t(X);Zi((le,ce)=>{re=_h(X,"",re,le),sn(se,` ${G()??""}: ${ce??""}`)},[()=>({background:cp[q()]}),()=>yw(te(p).total_length_meters[q()])]),bt(j,Q)},$$slots:{default:!0}}),bt(D,N)});var E=_t(L,4);hs(E,()=>e.extraControls);var C=_t(b,2);ws(C,17,()=>d,xs,(D,O)=>{var U=Kt(()=>tl(te(O),2));let q=()=>te(U)[0],G=()=>te(U)[1];var N=Mle(),V=zt(N);ls(V,{get checked(){return c()[q()]},set checked(j){c(c()[q()]=j,!0)},children:(j,z)=>{var Q=Tle(),X=ci(Q);let re;var se=_t(X);Zi((le,ce)=>{re=_h(X,"",re,le),sn(se,` ${G()??""}: ${ce??""}`)},[()=>({background:cp[q()]}),()=>yw(te(p).total_length_meters[q()])]),bt(j,Q)},$$slots:{default:!0}}),bt(D,N)}),bt(n,x),en(),o()}var Ale=qt("<p> </p>"),Ple=qt("<u>Problems:</u> <!> <!> <!>",1),Ile=qt("<li> </li>"),Rle=qt('<div><button class="btn btn-secondary mb-1"><kbd> </kbd> </button></div>'),Lle=qt("<u>Current sidewalk tags</u> <ul></ul> <u>Override to these tags</u> <!>",1),kle=qt('<div><button class="btn btn-secondary mb-1"><kbd> </kbd> </button></div>'),Dle=qt("<u>Set these tags</u> <!>",1),Fle=qt("<tr><td> </td><td> </td></tr>"),Ole=qt("<p> </p>"),zle=qt('<!> <div class="card mb-5"><div class="card-header"><a target="_blank"> </a> ( <a target="_blank" title="Edit way"><i class="fa-solid fa-pencil"></i></a> </div> <div class="card-body"><!> <!> <table class="table table-bordered"><thead><tr><th>Key</th><th>Value</th></tr></thead><tbody></tbody></table> <!></div></div>',1);function Ble(n,e){Qi(e,!0);const t=()=>nn(zs,"$backend",o),i=()=>nn(na,"$mutationCounter",o),r=()=>nn(vw,"$debugMode",o),[o,c]=is();let s=ft(e,"showProblemDetails",15),d=ii("");async function p(se){Ct(d,"Setting tags"),await sl();try{t().editSetTags(BigInt(e.pinnedWay.properties.id),se),ip(na,i())}finally{Ct(d,"")}}let g=[[["sidewalk:both","separate"]],[["sidewalk:left","separate"],["sidewalk:right","no"]],[["sidewalk:right","separate"],["sidewalk:left","no"]],[["sidewalk","both"]],[["sidewalk","left"]],[["sidewalk","right"]],[["sidewalk","no"]]],_=[[["footway","sidewalk"]],[["footway","crossing"]]];async function x(se){let le=[];e.pinnedWay.properties.kind.startsWith("Road")?le=g:e.pinnedWay.properties.tags.highway=="footway"&&(le=_);let ce=parseInt(se.key);Number.isInteger(ce)&&ce<=le.length&&await p(le[ce-1])}var b=zle();Zw("keypress",xy,x);var S=ci(b);Yd(S,{get loading(){return te(d)}});var P=_t(S,2),L=zt(P),E=zt(L),C=zt(E),D=_t(E,2),O=_t(D),U=_t(L,2),q=zt(U);{var G=se=>{var le=Ple(),ce=_t(ci(le),2);ws(ce,17,()=>e.pinnedWay.properties.problems,xs,(Ve,nt)=>{var He=Ale(),De=zt(He);Zi(()=>sn(De,te(nt).note)),bt(Ve,He)});var be=_t(ce,2);{var Ee=Ve=>{ls(Ve,{get checked(){return s()},set checked(nt){s(nt)},children:(nt,He)=>{var De=Nn("Show problem details");bt(nt,De)},$$slots:{default:!0}})};Ji(be,Ve=>{e.drawProblemDetails.features.length&&Ve(Ee)})}var $e=_t(be,2);{let Ve=Kt(()=>Object.fromEntries(e.drawProblemDetails.features.map(nt=>[nt.properties.label,nt.properties.color])));dC($e,{get labelColors(){return te(Ve)},itemsPerRow:1})}bt(se,le)};Ji(q,se=>{e.pinnedWay.properties.problems.length&&se(G)})}var N=_t(q,2);{var V=se=>{var le=Lle(),ce=_t(ci(le),2);ws(ce,21,()=>Object.entries(e.pinnedWay.properties.tags),xs,(Ee,$e)=>{var Ve=Kt(()=>tl(te($e),2));let nt=()=>te(Ve)[0],He=()=>te(Ve)[1];var De=tr(),ot=ci(De);{var xe=Be=>{var Je=Ile(),ct=zt(Je);Zi(()=>sn(ct,`${nt()??""} = ${He()??""}`)),bt(Be,Je)};Ji(ot,Be=>{nt().startsWith("sidewalk")&&Be(xe)})}bt(Ee,De)});var be=_t(ce,4);ws(be,17,()=>g.entries(),xs,(Ee,$e)=>{var Ve=Kt(()=>tl(te($e),2));let nt=()=>te(Ve)[0],He=()=>te(Ve)[1];var De=Rle(),ot=zt(De);ot.__click=()=>p(He());var xe=zt(ot),Be=zt(xe),Je=_t(xe);Zi(ct=>{sn(Be,nt()+1),sn(Je,` ${ct??""}`)},[()=>He().map(ct=>`${ct[0]} = ${ct[1]}`).join(", ")]),bt(Ee,De)}),bt(se,le)},j=se=>{var le=tr(),ce=ci(le);{var be=Ee=>{var $e=Dle(),Ve=_t(ci($e),2);ws(Ve,17,()=>_.entries(),xs,(nt,He)=>{var De=Kt(()=>tl(te(He),2));let ot=()=>te(De)[0],xe=()=>te(De)[1];var Be=kle(),Je=zt(Be);Je.__click=()=>p(xe());var ct=zt(Je),xt=zt(ct),Se=_t(ct);Zi(me=>{sn(xt,ot()+1),sn(Se,` ${me??""}`)},[()=>xe().map(me=>`${me[0]} = ${me[1]}`).join(", ")]),bt(nt,Be)}),bt(Ee,$e)};Ji(ce,Ee=>{e.pinnedWay.properties.tags.highway=="footway"&&Ee(be)},!0)}bt(se,le)};Ji(N,se=>{e.pinnedWay.properties.kind.startsWith("Road")?se(V):se(j,!1)})}var z=_t(N,2),Q=_t(zt(z));ws(Q,21,()=>Object.entries(e.pinnedWay.properties.tags),xs,(se,le)=>{var ce=Kt(()=>tl(te(le),2));let be=()=>te(ce)[0],Ee=()=>te(ce)[1];var $e=Fle(),Ve=zt($e),nt=zt(Ve),He=_t(Ve),De=zt(He);Zi(()=>{sn(nt,be()),sn(De,Ee())}),bt(se,$e)});var X=_t(z,2);{var re=se=>{var le=Ole(),ce=zt(le);Zi(be=>sn(ce,`Nodes: ${be??""}`),[()=>e.pinnedWay.properties.node_ids.join(", ")]),bt(se,le)};Ji(X,se=>{r()&&se(re)})}Zi(()=>{Bl(E,"href",`https://www.openstreetmap.org/way/${e.pinnedWay.properties.id??""}`),sn(C,`Way ${e.pinnedWay.properties.id??""}`),Bl(D,"href",`https://www.openstreetmap.org/edit?way=${e.pinnedWay.properties.id??""}`),sn(O,` ) : ${Nae[e.pinnedWay.properties.kind]??""}`)}),bt(n,b),en(),c()}ds(["click"]);var Nle=qt("<!> <!> <!> <!>",1),$le=qt("<tr><td> </td><td> </td></tr>"),Vle=qt("<p> </p>"),Ule=qt("<u>Problems:</u> <!>",1),jle=qt('<h4> </h4> <p> </p> <table class="table table-bordered"><tbody></tbody></table> <!>',1),Gle=qt("<!> <!> <!>",1),qle=qt("<!> <!> <!> <!>",1),Wle=qt("<!> <!> <!> <!>",1),Hle=qt("<!> <!>",1);function Zle(n,e){Qi(e,!0);const t=()=>nn(na,"$mutationCounter",o),i=()=>nn(zs,"$backend",o),r=()=>nn(vw,"$debugMode",o),[o,c]=is();let s=ii({type:"FeatureCollection",features:[]}),d=ii({type:"FeatureCollection",features:[]}),p=ii(null),g=ii(!1),_=ii(!1),x=ii(!1),b=ii(!0),S=ii(Ss(Object.fromEntries(Object.keys(cp).map(N=>[N,!0])))),P=ii(!0),L=ii(Ss(no())),E=ii(!1),C=ii(""),D=ii(Ss(no()));cn(()=>{t(),Ct(C,"Recalculating model"),sl().then(()=>{try{Ct(s,JSON.parse(i().getNodes())),Ct(d,JSON.parse(i().getWays()))}finally{Ct(C,"")}if(te(p)){let N=te(p).id;Ct(p,te(d).features.find(V=>V.id==N),!0)}})});function O(){let N=[];return te(x)&&N.push(["any",["in",["get","kind"],["literal",["Sidewalk","Crossing","Other"]]],["get","is_severance"]]),te(b)||N.push(["!",["get","is_service"]]),te(_)&&N.push(["get","modified"]),N.push(["in",["get","kind"],["literal",Object.entries(te(S)).filter(V=>V[1]).map(V=>V[0])]]),["all",...N]}var U=Hle(),q=ci(U);Yd(q,{get loading(){return te(C)}});var G=_t(q,2);l0(G,{left:j=>{var z=Nle(),Q=ci(z);fle(Q,{});var X=_t(Q,2);ale(X,{get nodes(){return te(s)},get ways(){return te(d)},get drawProblems(){return te(D)},set drawProblems(ce){Ct(D,ce,!0)}});var re=_t(X,2);{var se=ce=>{Ble(ce,{get pinnedWay(){return te(p)},get drawProblemDetails(){return te(L)},get showProblemDetails(){return te(P)},set showProblemDetails(be){Ct(P,be,!0)}})};Ji(re,ce=>{te(p)&&ce(se)})}var le=_t(re,2);ble(le,{}),bt(j,z)},main:j=>{var z=Wle(),Q=ci(z);{let le=Kt(O);jae(Q,{get showProblemDetails(){return te(P)},get nodes(){return te(s)},get ways(){return te(d)},get showRoadSides(){return te(E)},get filterWays(){return te(le)},get pinnedWay(){return te(p)},set pinnedWay(ce){Ct(p,ce,!0)},get drawProblemDetails(){return te(L)},set drawProblemDetails(ce){Ct(L,ce,!0)}})}var X=_t(Q,2);cle(X,{get drawProblems(){return te(D)},get pinnedWay(){return te(p)}});var re=_t(X,2);Hs(re,{get data(){return te(s)},children:(le,ce)=>{{let be=Kt(()=>({"circle-radius":7,"circle-color":["case",["any",["get","is_crossing"],["get","is_explicit_crossing_no"]],"yellow","grey"],"circle-opacity":["case",["any",["get","is_crossing"],["get","is_explicit_crossing_no"]],te(_)?["case",["get","modified"],1,.5]:1,0],"circle-stroke-color":["case",["has","tags"],"black","grey"],"circle-stroke-width":1})),Ee=Kt(()=>({visibility:te(g)?"visible":"none"}));au(le,{beforeId:"Road labels",manageHoverState:!0,get paint(){return te(be)},get layout(){return te(Ee)},children:($e,Ve)=>{aC($e,{openOn:"hover",children:(He,De)=>{let ot=()=>De?.().data;const xe=Kt(()=>ot()?.properties??{}),Be=Kt(()=>JSON.parse(te(xe).problems));var Je=jle(),ct=ci(Je),xt=zt(ct),Se=_t(ct,2),me=zt(Se),qe=_t(Se,2),st=zt(qe);ws(st,21,()=>Object.entries(JSON.parse(te(xe).tags||"{}")),xs,(Ae,we)=>{var vt=Kt(()=>tl(te(we),2));let ye=()=>te(vt)[0],ie=()=>te(vt)[1];var ae=$le(),ke=zt(ae),Ze=zt(ke),yt=_t(ke),Me=zt(yt);Zi(()=>{sn(Ze,ye()),sn(Me,ie())}),bt(Ae,ae)});var Rt=_t(qe,2);{var gt=Ae=>{var we=Ule(),vt=_t(ci(we),2);ws(vt,17,()=>te(Be),xs,(ye,ie)=>{var ae=Vle(),ke=zt(ae);Zi(()=>sn(ke,te(ie).note)),bt(ye,ae)}),bt(Ae,we)};Ji(Rt,Ae=>{te(Be).length&&Ae(gt)})}Zi(()=>{sn(xt,`Node ${te(xe).id??""}`),sn(me,`Ways: ${te(xe).way_ids??""}`)}),bt(He,Je)},$$slots:{default:!0}})},$$slots:{default:!0}})}},$$slots:{default:!0}});var se=_t(re,2);aF(se,{position:"top-right",children:(le,ce)=>{qd(le,{header:$e=>{var Ve=Nn("Layers");bt($e,Ve)},body:$e=>{var Ve=qle(),nt=ci(Ve);ls(nt,{get checked(){return xD(),r()},set checked(xe){ia(vw,xe)},children:(xe,Be)=>{var Je=Nn("Debug mode");bt(xe,Je)},$$slots:{default:!0}});var He=_t(nt,2);ls(He,{get checked(){return te(g)},set checked(xe){Ct(g,xe,!0)},children:(xe,Be)=>{var Je=Nn("Nodes");bt(xe,Je)},$$slots:{default:!0}});var De=_t(He,2);ls(De,{get checked(){return te(_)},set checked(xe){Ct(_,xe,!0)},children:(xe,Be)=>{var Je=Nn("Only modified objects");bt(xe,Je)},$$slots:{default:!0}});var ot=_t(De,2);Ele(ot,{get showKinds(){return te(S)},set showKinds(Be){Ct(S,Be,!0)},extraControls:Be=>{var Je=Gle(),ct=ci(Je);ls(ct,{get checked(){return te(x)},set checked(me){Ct(x,me,!0)},children:(me,qe)=>{var st=Nn("Only show major roads");bt(me,st)},$$slots:{default:!0}});var xt=_t(ct,2);ls(xt,{get checked(){return te(b)},set checked(me){Ct(b,me,!0)},children:(me,qe)=>{var st=Nn("Show service roads");bt(me,st)},$$slots:{default:!0}});var Se=_t(xt,2);ls(Se,{get checked(){return te(E)},set checked(me){Ct(E,me,!0)},children:(me,qe)=>{var st=Nn("Show each side with sidewalks â or not â");bt(me,st)},$$slots:{default:!0}}),bt(Be,Je)},$$slots:{extraControls:!0}}),bt($e,Ve)},$$slots:{header:!0,body:!0}})},$$slots:{default:!0}}),bt(j,z)},$$slots:{left:!0,main:!0}}),bt(n,U),en(),c()}var Xle=qt(`<button class="btn btn-secondary">Generate imaginary crossings where they're missing</button>`),Yle=qt('<button class="btn btn-secondary">Bulk operations</button>'),Kle=qt("<h2>Bulk operations</h2>"),Jle=qt(`<!> <p>Speedwalk has some experimental features that can automatically generate
    crossing nodes on every arm of a junction where they're expected. This is
    intended <b>only</b> for use in other projects to study the potential benefits of having more crossings.
    Do not ever upload the results of this to OSM.</p> <button class="btn btn-primary">I understand</button> <button class="btn btn-secondary">Cancel</button>`,1),Qle=qt("<!> <!> <!>",1);function ece(n,e){Qi(e,!0);const t=()=>nn(_w,"$enabledBulkOps",o),i=()=>nn(zs,"$backend",o),r=()=>nn(na,"$mutationCounter",o),[o,c]=is();let s=ii(!1);function d(){ia(_w,!0),Ct(s,!1)}let p=ii("");async function g(){Ct(p,"Generating missing crossings"),await sl();try{i().editGenerateMissingCrossings(e.options),ip(na,r())}catch(E){window.alert(`Error: ${E}`)}finally{Ct(p,"")}}var _=Qle(),x=ci(_);Yd(x,{get loading(){return te(p)}});var b=_t(x,2);{var S=E=>{qd(E,{header:O=>{var U=Nn("Bulk operations");bt(O,U)},body:O=>{var U=Xle();U.__click=g,bt(O,U)},$$slots:{header:!0,body:!0}})},P=E=>{var C=Yle();C.__click=()=>Ct(s,!0),bt(E,C)};Ji(b,E=>{t()?E(S):E(P,!1)})}var L=_t(b,2);gp(L,{get show(){return te(s)},set show(E){Ct(s,E,!0)},children:(E,C)=>{var D=Jle(),O=ci(D);mE(O,{children:(G,N)=>{var V=Kle();bt(G,V)}});var U=_t(O,4);U.__click=d;var q=_t(U,2);q.__click=()=>Ct(s,!1),bt(E,D)},$$slots:{default:!0}}),bt(n,_),en(),c()}ds(["click"]);var tce=qt('<p> <!> <!>.</p> <p class="mb-3"><i> </i></p>',1),ice=qt(`<h4>Crossings audit</h4> <p> </p> <!> <hr/> <p>For each junction shown, this tool looks for crossing nodes on each arm
      (road) of the junction. Please map a crossing node on each arm by clicking
      to open in iD, then refreshing data here to check. If there's no way to
      cross an arm, use <a href="https://wiki.openstreetmap.org/wiki/Tag:crossing=no" target="_blank">crossing=no</a> to indicate a lack of a crossing. Please ignore cases where you would not expect
      any crossing to be (and report a bug to improve this tool). And note that there
      might be mid-block crossings anywhere along a road; this tool only audits junctions.</p> <!>`,1),nce=qt("<tr><td> </td><td> </td></tr>"),rce=qt('<h4> </h4> <table class="table table-bordered"><tbody></tbody></table>',1),sce=qt("Ignore <code>service</code> , <code>track</code> roads",1),oce=qt("Ignore <code>footway</code> and <code>path</code>",1),ace=qt('<!> <!> <!> <!> <!> <!> <div><label class="form-label">How far away can a crossing be? (m): <input class="form-control" type="number" min="1" max="100"/></label></div> <div class="card card-body mt-3"><!></div>',1),lce=qt("<!> <!> <!> <!> <!> <!>",1);function cce(n,e){Qi(e,!0);const t=()=>nn(zs,"$backend",o),i=()=>nn(na,"$mutationCounter",o),r=()=>nn(Dh,"$map",o),[o,c]=is();let s=Ss({only_major_roads:!0,ignore_utility_roads:!0,ignore_cycleways:!0,ignore_footways:!0,ignore_roundabouts:!0,ignore_motorways:!0,max_distance:40}),d=Kt(()=>t()&&s.max_distance&&i()>=0?JSON.parse(t().auditCrossings(s)):no()),p=Kt(()=>te(d).features.filter(O=>O.properties.complete).length),g=ii(void 0),_=Kt(()=>te(g)?JSON.parse(te(g).properties.arms):no()),x=Kt(()=>te(g)?JSON.parse(te(g).properties.crossings):no()),b=Kt(()=>te(g)?JSON.parse(te(g).properties.explicit_non_crossings):no()),S=Kt(()=>te(x).features.length),P=Kt(()=>te(b).features.length),L=Kt(()=>te(g)?te(g).properties.number_ignored_arms:0),E=Kt(()=>{if(i(),!t())return no();let O=JSON.parse(t().getNodes());return O.features=O.features.filter(U=>U.properties.is_crossing||U.properties.is_explicit_crossing_no),O});function C(){let O=dO(r());if(O){let U=fO(O.zoom,O.lat,O.lng);window.open(U,"_blank","noopener,noreferrer")}}let D={"Junction to audit":"black","Fully mapped junction":"green",Crossing:"yellow","crossing=no":"purple","crossing=generated":"cyan"};l0(n,{left:q=>{var G=ice(),N=_t(ci(G),2),V=zt(N),j=_t(N,2);{var z=X=>{var re=tce(),se=ci(re),le=zt(se),ce=_t(le);{var be=ot=>{var xe=Nn();Zi(()=>sn(xe,`(plus ${te(L)??""}
          ${te(L)==1?"arm":"arms"} not expected to have crossings)`)),bt(ot,xe)};Ji(ce,ot=>{te(L)>0&&ot(be)})}var Ee=_t(ce),$e=_t(Ee);{var Ve=ot=>{var xe=Nn();Zi(()=>sn(xe,`, ${te(P)??""} explicit ${te(P)==1?"non-crossing":"non-crossings"}`)),bt(ot,xe)};Ji($e,ot=>{te(P)>0&&ot(Ve)})}var nt=_t(se,2),He=zt(nt),De=zt(He);Zi(()=>{sn(le,`Junction has ${te(_).features.length-te(L)} arms `),sn(Ee,`,
        ${te(S)??""}
        ${te(S)==1?"crossing":"crossings"} `),sn(De,`Arms are up to ${s.max_distance??""}m away from the junction along
          the same OSM way. If the way is split before a crossing, the crossing
          won't be counted. Only the first crossing is counted per arm.`)}),bt(X,re)};Ji(j,X=>{te(g)&&X(z)})}var Q=_t(j,6);ece(Q,{get options(){return s}}),Zi((X,re)=>sn(V,`${X??""} / ${re??""}
      junctions have all possible crossings mapped`),[()=>te(p).toLocaleString(),()=>te(d).features.length.toLocaleString()]),bt(q,G)},main:q=>{var G=lce(),N=ci(G);Hs(N,{get data(){return te(d)},generateId:!0,children:(re,se)=>{{let le=Kt(()=>({"circle-radius":15,"circle-color":["case",["get","complete"],D["Fully mapped junction"],D["Junction to audit"]],"circle-opacity":jg(.5,1),"circle-stroke-color":"black","circle-stroke-width":3}));au(re,{manageHoverState:!0,get paint(){return te(le)},hoverCursor:"pointer",onclick:C,get hovered(){return te(g)},set hovered(ce){Ct(g,ce,!0)}})}},$$slots:{default:!0}});var V=_t(N,2);Hs(V,{get data(){return te(_)},children:(re,se)=>{zl(re,{paint:{"line-width":6,"line-color":["case",["get","has_crossing"],"blue","red"]}})},$$slots:{default:!0}});var j=_t(V,2);Hs(j,{get data(){return te(E)},generateId:!0,children:(re,se)=>{{let le=Kt(()=>({"circle-radius":7,"circle-color":["case",["get","is_explicit_crossing_no"],D["crossing=no"],["get","is_generated_crossing"],D["crossing=generated"],D.Crossing],"circle-opacity":jg(.3,1),"circle-stroke-color":"black","circle-stroke-width":1}));au(re,{manageHoverState:!0,get paint(){return te(le)},children:(ce,be)=>{aC(ce,{openOn:"hover",children:($e,Ve)=>{let nt=()=>Ve?.().data;const He=Kt(()=>nt()?.properties??{});var De=rce(),ot=ci(De),xe=zt(ot),Be=_t(ot,2),Je=zt(Be);ws(Je,21,()=>Object.entries(JSON.parse(te(He).tags||"{}")),xs,(ct,xt)=>{var Se=Kt(()=>tl(te(xt),2));let me=()=>te(Se)[0],qe=()=>te(Se)[1];var st=nce(),Rt=zt(st),gt=zt(Rt),Ae=_t(Rt),we=zt(Ae);Zi(()=>{sn(gt,me()),sn(we,qe())}),bt(ct,st)}),Zi(()=>sn(xe,`Node ${te(He).id??""}`)),bt($e,De)},$$slots:{default:!0}})},$$slots:{default:!0}})}},$$slots:{default:!0}});var z=_t(j,2);Hs(z,{get data(){return te(x)},children:(re,se)=>{au(re,{paint:{"circle-radius":10,"circle-opacity":0,"circle-stroke-color":"black","circle-stroke-width":3}})},$$slots:{default:!0}});var Q=_t(z,2);Hs(Q,{get data(){return te(b)},children:(re,se)=>{au(re,{paint:{"circle-radius":10,"circle-opacity":0,"circle-stroke-color":"purple","circle-stroke-width":3}})},$$slots:{default:!0}});var X=_t(Q,2);aF(X,{position:"top-right",children:(re,se)=>{qd(re,{header:be=>{var Ee=Nn("Settings");bt(be,Ee)},body:be=>{var Ee=ace(),$e=ci(Ee);ls($e,{get checked(){return s.only_major_roads},set checked(Se){s.only_major_roads=Se},children:(Se,me)=>{var qe=Nn("Only junctions on major roads");bt(Se,qe)},$$slots:{default:!0}});var Ve=_t($e,2);ls(Ve,{get checked(){return s.ignore_utility_roads},set checked(Se){s.ignore_utility_roads=Se},children:(Se,me)=>{var qe=sce();bt(Se,qe)},$$slots:{default:!0}});var nt=_t(Ve,2);ls(nt,{get checked(){return s.ignore_cycleways},set checked(Se){s.ignore_cycleways=Se},children:(Se,me)=>{var qe=Nn("Ignore cycleways");bt(Se,qe)},$$slots:{default:!0}});var He=_t(nt,2);ls(He,{get checked(){return s.ignore_footways},set checked(Se){s.ignore_footways=Se},children:(Se,me)=>{var qe=oce();bt(Se,qe)},$$slots:{default:!0}});var De=_t(He,2);ls(De,{get checked(){return s.ignore_roundabouts},set checked(Se){s.ignore_roundabouts=Se},children:(Se,me)=>{var qe=Nn("Don't expect crossings on roundabouts");bt(Se,qe)},$$slots:{default:!0}});var ot=_t(De,2);ls(ot,{get checked(){return s.ignore_motorways},set checked(Se){s.ignore_motorways=Se},children:(Se,me)=>{var qe=Nn("Don't expect crossings on motorways");bt(Se,qe)},$$slots:{default:!0}});var xe=_t(ot,2),Be=zt(xe),Je=_t(zt(Be)),ct=_t(xe,2),xt=zt(ct);dC(xt,{get labelColors(){return D},itemsPerRow:1,swatchClass:"circle"}),Sg(Je,()=>s.max_distance,Se=>s.max_distance=Se),bt(be,Ee)},$$slots:{header:!0,body:!0}})},$$slots:{default:!0}}),bt(q,G)},$$slots:{left:!0,main:!0}}),en(),c()}var uce=qt('<div class="card"><div class="card-body"><div class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio"/> Everything</label></div> <div class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio"/> Only footways</label></div> <div class="form-check mb-3"><label class="form-check-label"><input class="form-check-input" type="radio"/> Anything routeable for walking</label></div> <!></div></div>');function ON(n,e){Qi(e,!1);const t=()=>nn(Hf,"$networkFilter",i),[i,r]=is(),o=[];Xw();var c=uce(),s=zt(c),d=zt(s),p=zt(d),g=zt(p);g.value=g.__value="Everything";var _=_t(d,2),x=zt(_),b=zt(x);b.value=b.__value="OnlyExplicitFootways";var S=_t(_,2),P=zt(S),L=zt(P);L.value=L.__value="RouteableNetwork";var E=_t(S,2);ls(E,{get checked(){return t().ignore_deadends},set checked(C){Sb(Hf,bs(t).ignore_deadends=C,bs(t))},children:(C,D)=>{var O=Nn("Ignore dead ends under 10m and disconnected segments under 100m");bt(C,O)},$$slots:{default:!0},$$legacy:!0}),Dx(o,[],g,()=>t().include,C=>Sb(Hf,bs(t).include=C,bs(t))),Dx(o,[],b,()=>t().include,C=>Sb(Hf,bs(t).include=C,bs(t))),Dx(o,[],L,()=>t().include,C=>Sb(Hf,bs(t).include=C,bs(t))),bt(n,c),en(),r()}var hce=qt('<li><a href="#"> </a></li>'),dce=qt("<h4>Network disconnections</h4> <p>This shows where the network is disconnected. Click a piece to see it.</p> <!> <ul></ul>",1),fce=qt("<!> <!>",1);function pce(n,e){Qi(e,!0);const t=()=>nn(zs,"$backend",o),i=()=>nn(Hf,"$networkFilter",o),r=()=>nn(Dh,"$map",o),[o,c]=is();let s=Kt(()=>t()?JSON.parse(t().findConnectedComponents(i())):{...no(),component_lengths:[]}),d=["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],p=Ry(["to-string",["%",["get","component"],d.length]],Object.fromEntries(d.map((S,P)=>[P.toString(),S])),"black"),g=ii(null);function _(S){return S==null?p:["case",["==",["get","component"],S],p,"black"]}function x(S){Ct(g,S.features[0].properties.component,!0)}function b(S){r().queryRenderedFeatures(S.point,{layers:["speedwalk-disconnections"]}).length==0&&Ct(g,null)}l0(n,{left:L=>{var E=dce(),C=_t(ci(E),4);ON(C,{});var D=_t(C,2);ws(D,21,()=>te(s).component_lengths,xs,(O,U,q)=>{var G=hce(),N=zt(G);N.__click=z=>{z.preventDefault(),r()?.fitBounds(te(s).component_bboxes[q]),Ct(g,q,!0)};let V;var j=zt(N);Zi(z=>{V=_h(N,"",V,{color:d[q%d.length]}),sn(j,z)},[()=>yw(te(U))]),bt(O,G)}),bt(L,E)},main:L=>{var E=fce(),C=ci(E);uF(C,{onclick:b});var D=_t(C,2);Hs(D,{get data(){return te(s)},generateId:!0,children:(O,U)=>{{let q=Kt(()=>({"line-width":jg(5,10),"line-color":_(te(g))}));zl(O,{id:"speedwalk-disconnections",get paint(){return te(q)},manageHoverState:!0,hoverCursor:"pointer",onclick:x})}},$$slots:{default:!0}}),bt(L,E)},$$slots:{left:!0,main:!0}}),en(),c()}ds(["click"]);var mce=qt(`<p>The output will have a LineString for each edge in the network. An
          edge goes between exactly two graph nodes, so one OSM way usually
          becomes many edges. Each LineString will have these properties:</p> <ul><li><b>node1</b> : The OSM node ID of the beginning of the edge. This is safer to use to
            form a graph than the first coordinate.</li> <li><b>node2</b> : The OSM node ID of the end of the edge. This is safer to use to form
            a graph than the last coordinate.</li> <li><b>way</b> : The OSM way ID where this edge comes from.</li> <li><b>osm_id</b> : For bulk generated crossing ways, this will be <i>node/123</i> pointing to the crossing node. For bulk generated sidewalks, this will
            be <i>way/123</i> of the road that the sidewalk is parallel to. For regular existing ways,
            this will be <i>way/123</i> matching the <b>way</b> property.</li> <li><b>kind</b> : Speedwalk's classification of this edge</li> <li>Each tag from the OSM way will appear as a key and value</li></ul> <p>Note that OSM IDs <b>node1</b> , <b>node2</b> , and <b>way</b> will be negative if you have run bulk operations and generated synthetic
          sidewalks or crossings.</p>`,1),gce=qt('<h4>Export network</h4> <p>You can export the routeable walking network as a GeoJSON file.</p> <!> <button class="btn btn-primary mt-3 mb-3">Download GeoJSON</button> <!> <!>',1),_ce=qt("<tr><td> </td><td> </td></tr>"),vce=qt('<table class="table table-bordered"><tbody></tbody></table> <div style="margin-top: 8px;"><strong>Length:</strong> </div>',1);function yce(n,e){Qi(e,!0);const t=()=>nn(zs,"$backend",r),i=()=>nn(Hf,"$networkFilter",r),[r,o]=is();let c=Kt(()=>t()?JSON.parse(t().exportNetwork(i())):no());function s(){e1("network.geojson",JSON.stringify(te(c)))}l0(n,{left:g=>{var _=gce(),x=_t(ci(_),4);ON(x,{});var b=_t(x,2);b.__click=s;var S=_t(b,2);qd(S,{open:!1,header:C=>{var D=Nn("Details");bt(C,D)},body:C=>{var D=mce();bt(C,D)},$$slots:{header:!0,body:!0}});var P=_t(S,2);qd(P,{header:C=>{var D=Nn("Legend");bt(C,D)},body:C=>{dC(C,{get labelColors(){return cp},itemsPerRow:1})},$$slots:{header:!0,body:!0}}),bt(g,_)},main:g=>{Hs(g,{get data(){return te(c)},generateId:!0,children:(_,x)=>{{let b=Kt(()=>({"line-width":Qf(0),"line-color":Ry(["get","kind"],cp,"cyan"),"line-opacity":jg(1,.5)}));zl(_,{manageHoverState:!0,get paint(){return te(b)},children:(S,P)=>{aC(S,{openOn:"hover",children:(E,C)=>{let D=()=>C?.().data;var O=vce(),U=ci(O),q=zt(U);ws(q,21,()=>Object.entries(D().properties),xs,(V,j)=>{var z=Kt(()=>tl(te(j),2));let Q=()=>te(z)[0],X=()=>te(z)[1];var re=_ce(),se=zt(re),le=zt(se),ce=_t(se),be=zt(ce);Zi(()=>{sn(le,Q()),sn(be,X())}),bt(V,re)});var G=_t(U,2),N=_t(zt(G));Zi(V=>sn(N,` ${V??""}`),[()=>D().properties.length!=null?yw(D().properties.length):"-"]),bt(E,O)},$$slots:{default:!0}})},$$slots:{default:!0}})}},$$slots:{default:!0}})},$$slots:{left:!0,main:!0}}),en(),o()}ds(["click"]);function bce(n,e){Qi(e,!1);const t=()=>nn(zs,"$backend",i),[i,r]=is();let o=JSON.parse(t().getBoundary()),c={type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]],o.geometry.coordinates[0]]}};Xw(),Hs(n,{get data(){return c},children:(s,d)=>{sC(s,{paint:{"fill-color":"black","fill-opacity":.3}})},$$slots:{default:!0}}),en(),r()}var xce=qt('<img alt="OSM avatar" height="30"/>'),wce=qt('<div class="nav-item dropdown"><button class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"><!> </button> <ul class="dropdown-menu"><li><a class="dropdown-item" href="#">Logout</a></li></ul></div>'),Sce=qt('<button class="btn btn-primary">Login to OSM</button>');function Tce(n,e){Qi(e,!1);const t=()=>nn(dy,"$loggedInUser",i),[i,r]=is();G2(o);async function o(){if(ty.isLoggedIn()){let x=await ty.getUser("me");ia(dy,{name:x.display_name,uid:x.id,avatarUrl:x.img?.href||""})}}async function c(){try{await ty.login({mode:"popup",clientId:"vyCV0t-IiskqNBgpiHvuSAmf2nC8K-zfByeFL6XtAzc",redirectUrl:`${window.location.origin}/speedwalk/land.html`,scopes:["read_prefs","write_api"]}),await o()}catch(x){window.alert(`Login failed: ${x}`)}}async function s(){ia(dy,void 0),await ty.logout()}Xw();var d=tr(),p=ci(d);{var g=x=>{var b=wce(),S=zt(b),P=zt(S);{var L=U=>{var q=xce();Zi(()=>Bl(q,"src",t().avatarUrl)),bt(U,q)};Ji(P,U=>{t().avatarUrl&&U(L)})}var E=_t(P),C=_t(S,2),D=zt(C),O=zt(D);O.__click=s,Zi(()=>sn(E,` ${t().name??""}`)),bt(x,b)},_=x=>{var b=Sce();b.__click=c,bt(x,b)};Ji(p,x=>{t()?x(g):x(_,!1)})}bt(n,d),en(),r()}ds(["click"]);const Mce="/speedwalk/assets/logo-3MjkCCFo.svg";var Cce=qt('<h1>Choose an area to work on</h1> <div class="mb-3"><button class="btn btn-secondary">Import a new area</button></div> <div class="card card-body mb-3"><p> </p> <button class="btn btn-secondary">Refresh OSM data</button> <!> <!></div> <button class="btn btn-primary">Cancel</button>',1),Ece=qt('<!> <!> <button class="btn btn-outline-secondary">&larr; Load another area</button>',1);function Ace(n,e){Qi(e,!0);const t=()=>nn(gw,"$anyEdits",o),i=()=>nn(zs,"$backend",o),r=()=>nn(p,"$saveCopy",o),[o,c]=is();let s=ii(!1),d=ii(""),p=KF("saveCopy",!1);function g(C){if(C){let D=new Date(1e3*Number(C));return`${D.toLocaleString()} (${_(D)} ago)`}return"unknown"}function _(C){let D=Date.now()-C.getTime(),O=Math.floor(D/1e3),U=Math.floor(O/60),q=Math.floor(U/60),G=Math.floor(q/24);return G?G==1?"1 day":`${G} days`:q?q==1?"1 hour":`${q} hours`:U?U==1?"1 minute":`${U} minutes`:"a few seconds"}function x(){t()&&!window.confirm("Changing areas will discard your current edits. Do you want to clear the edits?")||(ia(zs,null),ia(gw,!1))}async function b(){if(!(t()&&!window.confirm("Refreshing OSM data will discard your current edits. Do you want to clear the edits?"))){Ct(s,!1);try{Ct(d,"Grabbing new OSM data from Overpass");let C=JSON.parse(i().getBoundary()),O=await(await t1(fC(C))).bytes();if(r()){let U=new TextDecoder().decode(O);e1("refreshed_import.osm.xml",U)}Ct(d,"Processing Overpass data"),await sl(),ia(zs,new Ly(new Uint8Array(O),C))}catch(C){window.alert(`Couldn't import from Overpass: ${C}`)}finally{Ct(d,"")}}}var S=Ece(),P=ci(S);Yd(P,{get loading(){return te(d)}});var L=_t(P,2);gp(L,{get show(){return te(s)},set show(C){Ct(s,C,!0)},children:(C,D)=>{var O=Cce(),U=_t(ci(O),2),q=zt(U);q.__click=x;var G=_t(U,2),N=zt(G),V=zt(N),j=_t(N,2);j.__click=b;var z=_t(j,2);mE(z,{children:(re,se)=>{ls(re,{get checked(){return xD(),r()},set checked(le){ia(p,le)},children:(le,ce)=>{var be=Nn("Save a copy of the latest osm.xml after refreshing");bt(le,be)},$$slots:{default:!0}})}});var Q=_t(z,2);ZF(Q);var X=_t(G,2);X.__click=()=>Ct(s,!1),Zi(re=>sn(V,`OSM data is from ${re??""}`),[()=>g(i()?.getOsmTimestamp())]),bt(C,O)},$$slots:{default:!0}});var E=_t(L,2);E.__click=()=>Ct(s,!0),bt(n,S),en(),c()}ds(["click"]);var Pce=qt('<li class="nav-item"><a href="#"> </a></li>'),Ice=qt("<!> <!>",1),Rce=qt(`<h1>Welcome to Speedwalk</h1> <p>This tool helps you quickly assess how sidewalks are mapped in OSM. You can
    find and fix common tagging problems. The tool assumes you understand the
    correct <a href="https://wiki.openstreetmap.org/wiki/Sidewalks" target="_blank">sidewalk mapping conventions</a> . If you are unsure about some edits you make, you can download the changeset
    file and check in JOSM, rather than uploading directly.</p> <p>This is an <a href="https://github.com/a-b-street/speedwalk" target="_blank">open source project</a> developed by <a href="https://abstreet.uk" target="_blank">A/B Street Ltd</a> and <a href="https://fixmycity.de/" target="_blank">FixMyCity GmbH</a> , partly funded by FixMyCity. Please <a href="https://github.com/a-b-street/speedwalk/issues/" target="_blank">file a Github issue</a> or contact <a href="mailto:dustin@abstreet.uk" target="_blank">dustin@abstreet.uk</a> with feedback. <b>This is an alpha tool; there will be problems!</b></p> <button class="btn btn-primary">Start</button>`,1),Lce=qt('<ul class="nav nav-underline"><img style="height: 30px" alt="A/B Street logo"/> <h3>Speedwalk</h3> <!> <li class="nav-item ms-auto"><a class="nav-link" href="#"><i class="fa-solid fa-circle-info"></i> About</a></li> <!></ul> <!>',1);function kce(n){const e=()=>nn(zs,"$backend",i),t=()=>nn(XM,"$mode",i),[i,r]=is();let o=ii(!1),c=[[{kind:"sidewalks"},"Sidewalks"],[{kind:"crossings"},"Crossings"],[{kind:"disconnections"},"Network disconnections"],[{kind:"export"},"Export"]];var s=Lce(),d=ci(s),p=zt(d),g=_t(p,4);{var _=L=>{var E=Ice(),C=ci(E);Ace(C,{});var D=_t(C,2);ws(D,17,()=>c,xs,(O,U)=>{var q=Kt(()=>tl(te(U),2));let G=()=>te(q)[0],N=()=>te(q)[1];var V=Pce(),j=zt(V);let z;j.__click=()=>ia(XM,G());var Q=zt(j);Zi(X=>{z=fp(j,1,"nav-link",null,z,X),sn(Q,N())},[()=>({active:JSON.stringify(t())==JSON.stringify(G())})]),bt(O,V)}),bt(L,E)};Ji(g,L=>{e()&&L(_)})}var x=_t(g,2),b=zt(x);b.__click=()=>Ct(o,!0);var S=_t(x,2);Tce(S,{});var P=_t(d,2);gp(P,{get show(){return te(o)},set show(L){Ct(o,L,!0)},children:(L,E)=>{var C=Rce(),D=_t(ci(C),6);D.__click=()=>Ct(o,!1),bt(L,C)},$$slots:{default:!0}}),Zi(()=>Bl(p,"src",Mce)),bt(n,s),r()}ds(["click"]);var Dce=qt('<link rel="icon" type="image/x-icon"/>'),Fce=qt("<div></div>"),Oce=qt('<div class="p-3"><!></div>'),zce=qt("<!> <!>",1),Bce=qt("<!> <!> <!> <!>",1),Nce=qt('<div style="position:relative; width: 100%; height: 100vh;"><!></div>');function $ce(n,e){Qi(e,!0);const t=()=>nn(zs,"$backend",r),i=()=>nn(XM,"$mode",r),[r,o]=is();G2(async()=>{await YF()});let c=ii(void 0),s=ii(!1);cn(()=>{te(c)&&Dh.set(te(c))});let d=ii("Maptiler OpenStreetMap"),p=rp.get(te(d));cn(()=>{te(d)&&bs(()=>{te(c)?.setStyle(rp.get(te(d)),{transformStyle:(g,_)=>{if(!g)return _;let x=g.layers.filter(P=>["circle-","line-","fill-","heatmap-","symbol-","speedwalk-","edit-polygon-"].some(L=>P.id.startsWith(L))),b=_.layers.concat(x),S=_.sources;for(let[P,L]of Object.entries(g.sources||{}))(P.startsWith("geojson-")||P.startsWith("heatmap")||P.startsWith("vector-"))&&(S[P]=L);return{..._,sources:S,layers:b}}})})}),w6("1n46o8q",g=>{var _=Dce();Zi(()=>Bl(_,"href",u7)),bt(g,_)}),LU(n,{top:b=>{kce(b)},left:b=>{var S=Oce(),P=zt(S);{var L=E=>{var C=Fce();wc(C,D=>cy.value=D,()=>cy?.value),bt(E,C)};Ji(P,E=>{te(c)&&E(L)})}bt(b,S)},main:b=>{var S=Nce(),P=zt(S);{let L=Kt(()=>[{id:"arrow",url:h7},{id:"chevron",url:d7}]);N8(P,{get style(){return p},hash:!0,onerror:E=>{console.log(E.error)},get images(){return te(L)},get map(){return te(c)},set map(E){Ct(c,E,!0)},get loaded(){return te(s)},set loaded(E){Ct(s,E,!0)},children:(E,C)=>{var D=Bce(),O=ci(D);MG(O,{get map(){return te(c)}});var U=_t(O,2);SG(U,{get map(){return te(c)},get loaded(){return te(s)}});var q=_t(U,2);Bae(q,{get basemap(){return te(d)},set basemap(V){Ct(d,V,!0)}});var G=_t(q,2);{var N=V=>{var j=tr(),z=ci(j);{var Q=re=>{var se=zce(),le=ci(se);bce(le,{});var ce=_t(le,2);s0(ce,i,be=>{var Ee=tr(),$e=ci(Ee);{var Ve=He=>{Zle(He,{})},nt=He=>{var De=tr(),ot=ci(De);{var xe=Je=>{cce(Je,{})},Be=Je=>{var ct=tr(),xt=ci(ct);{var Se=qe=>{pce(qe,{})},me=qe=>{var st=tr(),Rt=ci(st);{var gt=Ae=>{yce(Ae,{})};Ji(Rt,Ae=>{i().kind=="export"&&Ae(gt)},!0)}bt(qe,st)};Ji(xt,qe=>{i().kind=="disconnections"?qe(Se):qe(me,!1)},!0)}bt(Je,ct)};Ji(ot,Je=>{i().kind=="crossings"?Je(xe):Je(Be,!1)},!0)}bt(He,De)};Ji($e,He=>{i().kind=="sidewalks"?He(Ve):He(nt,!1)})}bt(be,Ee)}),bt(re,se)},X=re=>{c7(re,{})};Ji(z,re=>{t()?re(Q):re(X,!1)})}bt(V,j)};Ji(G,V=>{te(c)&&V(N)})}bt(E,D)},$$slots:{default:!0}})}bt(b,S)},$$slots:{top:!0,left:!0,main:!0}}),en(),o()}g6($ce,{target:document.getElementById("app")});
